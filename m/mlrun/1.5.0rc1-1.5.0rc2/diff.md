# Comparing `tmp/mlrun-1.5.0rc1-py3-none-any.whl.zip` & `tmp/mlrun-1.5.0rc2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,449 +1,458 @@
-Zip file size: 1280599 bytes, number of entries: 447
--rw-r--r--  2.0 unx     8770 b- defN 23-Jul-20 14:54 mlrun/__init__.py
--rw-r--r--  2.0 unx    49544 b- defN 23-Jul-20 14:54 mlrun/__main__.py
--rw-r--r--  2.0 unx    56719 b- defN 23-Jul-20 14:54 mlrun/config.py
--rw-r--r--  2.0 unx     6780 b- defN 23-Jul-20 14:54 mlrun/errors.py
--rw-r--r--  2.0 unx    39600 b- defN 23-Jul-20 14:54 mlrun/execution.py
--rw-r--r--  2.0 unx    15624 b- defN 23-Jul-20 14:54 mlrun/features.py
--rw-r--r--  2.0 unx     4876 b- defN 23-Jul-20 14:54 mlrun/k8s_utils.py
--rw-r--r--  2.0 unx    29701 b- defN 23-Jul-20 14:54 mlrun/kfpops.py
--rw-r--r--  2.0 unx     8779 b- defN 23-Jul-20 14:54 mlrun/lists.py
--rw-r--r--  2.0 unx    60635 b- defN 23-Jul-20 14:54 mlrun/model.py
--rw-r--r--  2.0 unx    13016 b- defN 23-Jul-20 14:54 mlrun/render.py
--rw-r--r--  2.0 unx    51474 b- defN 23-Jul-20 14:54 mlrun/run.py
--rw-r--r--  2.0 unx     7783 b- defN 23-Jul-20 14:54 mlrun/secrets.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/__init__.py
--rw-r--r--  2.0 unx     2105 b- defN 23-Jul-20 14:54 mlrun/api/alembic.ini
--rw-r--r--  2.0 unx      685 b- defN 23-Jul-20 14:54 mlrun/api/constants.py
--rw-r--r--  2.0 unx    25653 b- defN 23-Jul-20 14:54 mlrun/api/initial_data.py
--rw-r--r--  2.0 unx     8068 b- defN 23-Jul-20 14:54 mlrun/api/launcher.py
--rw-r--r--  2.0 unx    27304 b- defN 23-Jul-20 14:54 mlrun/api/main.py
--rw-r--r--  2.0 unx     5289 b- defN 23-Jul-20 14:54 mlrun/api/middlewares.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/api/__init__.py
--rw-r--r--  2.0 unx     4243 b- defN 23-Jul-20 14:54 mlrun/api/api/api.py
--rw-r--r--  2.0 unx     3197 b- defN 23-Jul-20 14:54 mlrun/api/api/deps.py
--rw-r--r--  2.0 unx    40172 b- defN 23-Jul-20 14:54 mlrun/api/api/utils.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/__init__.py
--rw-r--r--  2.0 unx    10452 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/artifacts.py
--rw-r--r--  2.0 unx     1199 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/auth.py
--rw-r--r--  2.0 unx     3618 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/background_tasks.py
--rw-r--r--  2.0 unx     1214 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/client_spec.py
--rw-r--r--  2.0 unx     1175 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/clusterization_spec.py
--rw-r--r--  2.0 unx    29192 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/feature_store.py
--rw-r--r--  2.0 unx     6370 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/files.py
--rw-r--r--  2.0 unx     5946 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/frontend_spec.py
--rw-r--r--  2.0 unx    38107 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/functions.py
--rw-r--r--  2.0 unx     6086 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/grafana_proxy.py
--rw-r--r--  2.0 unx     1344 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/healthz.py
--rw-r--r--  2.0 unx    10312 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/hub.py
--rw-r--r--  2.0 unx     2445 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/logs.py
--rw-r--r--  2.0 unx    15734 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/model_endpoints.py
--rw-r--r--  2.0 unx     3756 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/operations.py
--rw-r--r--  2.0 unx     9231 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/pipelines.py
--rw-r--r--  2.0 unx    11494 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/projects.py
--rw-r--r--  2.0 unx    10372 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/runs.py
--rw-r--r--  2.0 unx     9035 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/runtime_resources.py
--rw-r--r--  2.0 unx    12544 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/schedules.py
--rw-r--r--  2.0 unx     6061 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/secrets.py
--rw-r--r--  2.0 unx     5327 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/submit.py
--rw-r--r--  2.0 unx     4849 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/tags.py
--rw-r--r--  2.0 unx     1203 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/internal/__init__.py
--rw-r--r--  2.0 unx     1043 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/internal/config.py
--rw-r--r--  2.0 unx     1718 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/internal/memory_reports.py
--rw-r--r--  2.0 unx     1209 b- defN 23-Jul-20 14:54 mlrun/api/crud/__init__.py
--rw-r--r--  2.0 unx     5610 b- defN 23-Jul-20 14:54 mlrun/api/crud/artifacts.py
--rw-r--r--  2.0 unx     7378 b- defN 23-Jul-20 14:54 mlrun/api/crud/client_spec.py
--rw-r--r--  2.0 unx     1055 b- defN 23-Jul-20 14:54 mlrun/api/crud/clusterization_spec.py
--rw-r--r--  2.0 unx    18971 b- defN 23-Jul-20 14:54 mlrun/api/crud/feature_store.py
--rw-r--r--  2.0 unx     3556 b- defN 23-Jul-20 14:54 mlrun/api/crud/functions.py
--rw-r--r--  2.0 unx    12025 b- defN 23-Jul-20 14:54 mlrun/api/crud/hub.py
--rw-r--r--  2.0 unx     9409 b- defN 23-Jul-20 14:54 mlrun/api/crud/logs.py
--rw-r--r--  2.0 unx     5498 b- defN 23-Jul-20 14:54 mlrun/api/crud/notifications.py
--rw-r--r--  2.0 unx    14999 b- defN 23-Jul-20 14:54 mlrun/api/crud/pipelines.py
--rw-r--r--  2.0 unx    15240 b- defN 23-Jul-20 14:54 mlrun/api/crud/projects.py
--rw-r--r--  2.0 unx     5963 b- defN 23-Jul-20 14:54 mlrun/api/crud/runs.py
--rw-r--r--  2.0 unx     5575 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtime_resources.py
--rw-r--r--  2.0 unx    21560 b- defN 23-Jul-20 14:54 mlrun/api/crud/secrets.py
--rw-r--r--  2.0 unx     3277 b- defN 23-Jul-20 14:54 mlrun/api/crud/tags.py
--rw-r--r--  2.0 unx      759 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/__init__.py
--rw-r--r--  2.0 unx    19956 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/deployment.py
--rw-r--r--  2.0 unx    17486 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/grafana.py
--rw-r--r--  2.0 unx     4613 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/helpers.py
--rw-r--r--  2.0 unx    30723 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/model_endpoints.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtimes/__init__.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtimes/nuclio/__init__.py
--rw-r--r--  2.0 unx    18762 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtimes/nuclio/function.py
--rw-r--r--  2.0 unx    11510 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtimes/nuclio/helpers.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/db/__init__.py
--rw-r--r--  2.0 unx    15311 b- defN 23-Jul-20 14:54 mlrun/api/db/base.py
--rw-r--r--  2.0 unx      739 b- defN 23-Jul-20 14:54 mlrun/api/db/init_db.py
--rw-r--r--  2.0 unx      994 b- defN 23-Jul-20 14:54 mlrun/api/db/session.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/__init__.py
--rw-r--r--  2.0 unx   148913 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/db.py
--rw-r--r--  2.0 unx     2340 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/helpers.py
--rw-r--r--  2.0 unx     1105 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/models/__init__.py
--rw-r--r--  2.0 unx    21345 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/models/models_mysql.py
--rw-r--r--  2.0 unx    19014 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/models/models_sqlite.py
--rw-r--r--  2.0 unx     2906 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/env.py
--rw-r--r--  2.0 unx     1203 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py
--rw-r--r--  2.0 unx     4614 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py
--rw-r--r--  2.0 unx     1936 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py
--rw-r--r--  2.0 unx     1909 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py
--rw-r--r--  2.0 unx     1415 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py
--rw-r--r--  2.0 unx     1504 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py
--rw-r--r--  2.0 unx     1649 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py
--rw-r--r--  2.0 unx    24057 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py
--rw-r--r--  2.0 unx     2662 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py
--rw-r--r--  2.0 unx     1351 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py
--rw-r--r--  2.0 unx     2906 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/env.py
--rw-r--r--  2.0 unx    11473 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py
--rw-r--r--  2.0 unx     1348 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py
--rw-r--r--  2.0 unx     5180 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py
--rw-r--r--  2.0 unx     2595 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py
--rw-r--r--  2.0 unx     1388 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py
--rw-r--r--  2.0 unx     1767 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py
--rw-r--r--  2.0 unx     1360 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py
--rw-r--r--  2.0 unx     1259 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py
--rw-r--r--  2.0 unx     2352 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py
--rw-r--r--  2.0 unx     1482 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py
--rw-r--r--  2.0 unx     1892 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py
--rw-r--r--  2.0 unx     1882 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py
--rw-r--r--  2.0 unx     1420 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py
--rw-r--r--  2.0 unx     2034 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py
--rw-r--r--  2.0 unx     1828 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py
--rw-r--r--  2.0 unx     1380 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py
--rw-r--r--  2.0 unx     1831 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py
--rw-r--r--  2.0 unx     3936 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py
--rw-r--r--  2.0 unx     2588 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py
--rw-r--r--  2.0 unx    13571 b- defN 23-Jul-20 14:54 mlrun/api/schemas/__init__.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/__init__.py
--rw-r--r--  2.0 unx     1092 b- defN 23-Jul-20 14:54 mlrun/api/utils/asyncio.py
--rw-r--r--  2.0 unx     7371 b- defN 23-Jul-20 14:54 mlrun/api/utils/background_tasks.py
--rw-r--r--  2.0 unx    26977 b- defN 23-Jul-20 14:54 mlrun/api/utils/builder.py
--rw-r--r--  2.0 unx     2512 b- defN 23-Jul-20 14:54 mlrun/api/utils/helpers.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Jul-20 14:54 mlrun/api/utils/memory_reports.py
--rw-r--r--  2.0 unx     2760 b- defN 23-Jul-20 14:54 mlrun/api/utils/periodic.py
--rw-r--r--  2.0 unx    42624 b- defN 23-Jul-20 14:54 mlrun/api/utils/scheduler.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/__init__.py
--rw-r--r--  2.0 unx    12383 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/verifier.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/providers/__init__.py
--rw-r--r--  2.0 unx     1381 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/providers/base.py
--rw-r--r--  2.0 unx     1460 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/providers/nop.py
--rw-r--r--  2.0 unx    10883 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/providers/opa.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/__init__.py
--rw-r--r--  2.0 unx    13688 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/chief.py
--rw-r--r--  2.0 unx    32674 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/iguazio.py
--rw-r--r--  2.0 unx    12281 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/log_collector.py
--rw-r--r--  2.0 unx     9911 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/nuclio.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/protocols/__init__.py
--rw-r--r--  2.0 unx     2567 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/protocols/grpc.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/__init__.py
--rw-r--r--  2.0 unx     3305 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/alembic.py
--rw-r--r--  2.0 unx     8214 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/backup.py
--rw-r--r--  2.0 unx     3787 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/mysql.py
--rw-r--r--  2.0 unx      992 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/sql_collation.py
--rw-r--r--  2.0 unx     3861 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/sqlite_migration.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/__init__.py
--rw-r--r--  2.0 unx     1721 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/base.py
--rw-r--r--  2.0 unx     1630 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/events_factory.py
--rw-r--r--  2.0 unx     8798 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/iguazio.py
--rw-r--r--  2.0 unx     1739 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/nop.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/__init__.py
--rw-r--r--  2.0 unx    17760 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/follower.py
--rw-r--r--  2.0 unx    19412 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/leader.py
--rw-r--r--  2.0 unx     7133 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/member.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/__init__.py
--rw-r--r--  2.0 unx     2659 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/follower.py
--rw-r--r--  2.0 unx     2094 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/leader.py
--rw-r--r--  2.0 unx     4995 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/nop_follower.py
--rw-r--r--  2.0 unx     3854 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/nop_leader.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/runtimes/__init__.py
--rw-r--r--  2.0 unx     1675 b- defN 23-Jul-20 14:54 mlrun/api/utils/runtimes/nuclio.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/__init__.py
--rw-r--r--  2.0 unx     1203 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/db.py
--rw-r--r--  2.0 unx    24570 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/k8s.py
--rw-r--r--  2.0 unx      840 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/logs_dir.py
--rw-r--r--  2.0 unx     1312 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/project_member.py
--rw-r--r--  2.0 unx     1064 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/scheduler.py
--rw-r--r--  2.0 unx     1123 b- defN 23-Jul-20 14:54 mlrun/artifacts/__init__.py
--rw-r--r--  2.0 unx    31144 b- defN 23-Jul-20 14:54 mlrun/artifacts/base.py
--rw-r--r--  2.0 unx    20485 b- defN 23-Jul-20 14:54 mlrun/artifacts/dataset.py
--rw-r--r--  2.0 unx    12594 b- defN 23-Jul-20 14:54 mlrun/artifacts/manager.py
--rw-r--r--  2.0 unx    24241 b- defN 23-Jul-20 14:54 mlrun/artifacts/model.py
--rw-r--r--  2.0 unx    15383 b- defN 23-Jul-20 14:54 mlrun/artifacts/plots.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/common/__init__.py
--rw-r--r--  2.0 unx      660 b- defN 23-Jul-20 14:54 mlrun/common/constants.py
--rw-r--r--  2.0 unx     1108 b- defN 23-Jul-20 14:54 mlrun/common/helpers.py
--rw-r--r--  2.0 unx      790 b- defN 23-Jul-20 14:54 mlrun/common/types.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/common/db/__init__.py
--rw-r--r--  2.0 unx     2542 b- defN 23-Jul-20 14:54 mlrun/common/db/sql_session.py
--rw-r--r--  2.0 unx      721 b- defN 23-Jul-20 14:54 mlrun/common/model_monitoring/__init__.py
--rw-r--r--  2.0 unx     2312 b- defN 23-Jul-20 14:54 mlrun/common/model_monitoring/helpers.py
--rw-r--r--  2.0 unx     4384 b- defN 23-Jul-20 14:54 mlrun/common/schemas/__init__.py
--rw-r--r--  2.0 unx     1923 b- defN 23-Jul-20 14:54 mlrun/common/schemas/artifact.py
--rw-r--r--  2.0 unx     5490 b- defN 23-Jul-20 14:54 mlrun/common/schemas/auth.py
--rw-r--r--  2.0 unx     1553 b- defN 23-Jul-20 14:54 mlrun/common/schemas/background_task.py
--rw-r--r--  2.0 unx     2751 b- defN 23-Jul-20 14:54 mlrun/common/schemas/client_spec.py
--rw-r--r--  2.0 unx      888 b- defN 23-Jul-20 14:54 mlrun/common/schemas/clusterization_spec.py
--rw-r--r--  2.0 unx     6243 b- defN 23-Jul-20 14:54 mlrun/common/schemas/constants.py
--rw-r--r--  2.0 unx     1026 b- defN 23-Jul-20 14:54 mlrun/common/schemas/events.py
--rw-r--r--  2.0 unx     3723 b- defN 23-Jul-20 14:54 mlrun/common/schemas/feature_store.py
--rw-r--r--  2.0 unx     2546 b- defN 23-Jul-20 14:54 mlrun/common/schemas/frontend_spec.py
--rw-r--r--  2.0 unx     4432 b- defN 23-Jul-20 14:54 mlrun/common/schemas/function.py
--rw-r--r--  2.0 unx      705 b- defN 23-Jul-20 14:54 mlrun/common/schemas/http.py
--rw-r--r--  2.0 unx     4245 b- defN 23-Jul-20 14:54 mlrun/common/schemas/hub.py
--rw-r--r--  2.0 unx     1395 b- defN 23-Jul-20 14:54 mlrun/common/schemas/k8s.py
--rw-r--r--  2.0 unx      920 b- defN 23-Jul-20 14:54 mlrun/common/schemas/memory_reports.py
--rw-r--r--  2.0 unx     1518 b- defN 23-Jul-20 14:54 mlrun/common/schemas/notification.py
--rw-r--r--  2.0 unx     1986 b- defN 23-Jul-20 14:54 mlrun/common/schemas/object.py
--rw-r--r--  2.0 unx     1184 b- defN 23-Jul-20 14:54 mlrun/common/schemas/pipeline.py
--rw-r--r--  2.0 unx     4177 b- defN 23-Jul-20 14:54 mlrun/common/schemas/project.py
--rw-r--r--  2.0 unx      776 b- defN 23-Jul-20 14:54 mlrun/common/schemas/regex.py
--rw-r--r--  2.0 unx     1010 b- defN 23-Jul-20 14:54 mlrun/common/schemas/runs.py
--rw-r--r--  2.0 unx     1636 b- defN 23-Jul-20 14:54 mlrun/common/schemas/runtime_resource.py
--rw-r--r--  2.0 unx     4556 b- defN 23-Jul-20 14:54 mlrun/common/schemas/schedule.py
--rw-r--r--  2.0 unx     1484 b- defN 23-Jul-20 14:54 mlrun/common/schemas/secret.py
--rw-r--r--  2.0 unx      905 b- defN 23-Jul-20 14:54 mlrun/common/schemas/tag.py
--rw-r--r--  2.0 unx     1300 b- defN 23-Jul-20 14:54 mlrun/common/schemas/model_monitoring/__init__.py
--rw-r--r--  2.0 unx     5068 b- defN 23-Jul-20 14:54 mlrun/common/schemas/model_monitoring/constants.py
--rw-r--r--  2.0 unx     1444 b- defN 23-Jul-20 14:54 mlrun/common/schemas/model_monitoring/grafana.py
--rw-r--r--  2.0 unx    11152 b- defN 23-Jul-20 14:54 mlrun/common/schemas/model_monitoring/model_endpoints.py
--rw-r--r--  2.0 unx     1087 b- defN 23-Jul-20 14:54 mlrun/data_types/__init__.py
--rw-r--r--  2.0 unx     4647 b- defN 23-Jul-20 14:54 mlrun/data_types/data_types.py
--rw-r--r--  2.0 unx     5813 b- defN 23-Jul-20 14:54 mlrun/data_types/infer.py
--rw-r--r--  2.0 unx     9426 b- defN 23-Jul-20 14:54 mlrun/data_types/spark.py
--rw-r--r--  2.0 unx     4089 b- defN 23-Jul-20 14:54 mlrun/datastore/__init__.py
--rw-r--r--  2.0 unx     6946 b- defN 23-Jul-20 14:54 mlrun/datastore/azure_blob.py
--rw-r--r--  2.0 unx    22471 b- defN 23-Jul-20 14:54 mlrun/datastore/base.py
--rw-r--r--  2.0 unx     8377 b- defN 23-Jul-20 14:54 mlrun/datastore/datastore.py
--rw-r--r--  2.0 unx     6302 b- defN 23-Jul-20 14:54 mlrun/datastore/dbfs_store.py
--rw-r--r--  2.0 unx     3791 b- defN 23-Jul-20 14:54 mlrun/datastore/filestore.py
--rw-r--r--  2.0 unx     5114 b- defN 23-Jul-20 14:54 mlrun/datastore/google_cloud_storage.py
--rw-r--r--  2.0 unx      622 b- defN 23-Jul-20 14:54 mlrun/datastore/helpers.py
--rw-r--r--  2.0 unx     2779 b- defN 23-Jul-20 14:54 mlrun/datastore/inmem.py
--rw-r--r--  2.0 unx     4873 b- defN 23-Jul-20 14:54 mlrun/datastore/redis.py
--rw-r--r--  2.0 unx     7035 b- defN 23-Jul-20 14:54 mlrun/datastore/s3.py
--rw-r--r--  2.0 unx    37671 b- defN 23-Jul-20 14:54 mlrun/datastore/sources.py
--rw-r--r--  2.0 unx     1498 b- defN 23-Jul-20 14:54 mlrun/datastore/spark_udf.py
--rw-r--r--  2.0 unx     6906 b- defN 23-Jul-20 14:54 mlrun/datastore/store_resources.py
--rw-r--r--  2.0 unx    63310 b- defN 23-Jul-20 14:54 mlrun/datastore/targets.py
--rw-r--r--  2.0 unx     5438 b- defN 23-Jul-20 14:54 mlrun/datastore/utils.py
--rw-r--r--  2.0 unx     8099 b- defN 23-Jul-20 14:54 mlrun/datastore/v3io.py
--rw-r--r--  2.0 unx     1343 b- defN 23-Jul-20 14:54 mlrun/datastore/wasbfs/__init__.py
--rw-r--r--  2.0 unx     6152 b- defN 23-Jul-20 14:54 mlrun/datastore/wasbfs/fs.py
--rw-r--r--  2.0 unx     2816 b- defN 23-Jul-20 14:54 mlrun/db/__init__.py
--rw-r--r--  2.0 unx    16194 b- defN 23-Jul-20 14:54 mlrun/db/base.py
--rw-r--r--  2.0 unx   133910 b- defN 23-Jul-20 14:54 mlrun/db/httpdb.py
--rw-r--r--  2.0 unx    13209 b- defN 23-Jul-20 14:54 mlrun/db/nopdb.py
--rw-r--r--  2.0 unx    25590 b- defN 23-Jul-20 14:54 mlrun/db/sqldb.py
--rw-r--r--  2.0 unx     1501 b- defN 23-Jul-20 14:54 mlrun/feature_store/__init__.py
--rw-r--r--  2.0 unx    44918 b- defN 23-Jul-20 14:54 mlrun/feature_store/api.py
--rw-r--r--  2.0 unx    12809 b- defN 23-Jul-20 14:54 mlrun/feature_store/common.py
--rw-r--r--  2.0 unx    48102 b- defN 23-Jul-20 14:54 mlrun/feature_store/feature_set.py
--rw-r--r--  2.0 unx    22173 b- defN 23-Jul-20 14:54 mlrun/feature_store/feature_vector.py
--rw-r--r--  2.0 unx    11681 b- defN 23-Jul-20 14:54 mlrun/feature_store/ingestion.py
--rw-r--r--  2.0 unx    29357 b- defN 23-Jul-20 14:54 mlrun/feature_store/steps.py
--rw-r--r--  2.0 unx     1260 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/__init__.py
--rw-r--r--  2.0 unx    30286 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/base.py
--rw-r--r--  2.0 unx     4623 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/dask_merger.py
--rw-r--r--  2.0 unx     7657 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/job.py
--rw-r--r--  2.0 unx     4252 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/local_merger.py
--rw-r--r--  2.0 unx     9565 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/spark_merger.py
--rw-r--r--  2.0 unx     6296 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/storey_merger.py
--rw-r--r--  2.0 unx      743 b- defN 23-Jul-20 14:54 mlrun/frameworks/__init__.py
--rw-r--r--  2.0 unx    11466 b- defN 23-Jul-20 14:54 mlrun/frameworks/parallel_coordinates.py
--rw-r--r--  2.0 unx      962 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/__init__.py
--rw-r--r--  2.0 unx     8515 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/artifacts_library.py
--rw-r--r--  2.0 unx    21018 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/mlrun_interface.py
--rw-r--r--  2.0 unx    55376 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/model_handler.py
--rw-r--r--  2.0 unx     3469 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/plan.py
--rw-r--r--  2.0 unx     5757 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/producer.py
--rw-r--r--  2.0 unx     9209 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/utils.py
--rw-r--r--  2.0 unx      750 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/__init__.py
--rw-r--r--  2.0 unx     1151 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/model_handler.py
--rw-r--r--  2.0 unx      996 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/utils.py
--rw-r--r--  2.0 unx      787 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/loggers/__init__.py
--rw-r--r--  2.0 unx    11531 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/loggers/logger.py
--rw-r--r--  2.0 unx    14777 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/loggers/mlrun_logger.py
--rw-r--r--  2.0 unx    28414 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py
--rw-r--r--  2.0 unx      956 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/__init__.py
--rw-r--r--  2.0 unx     3169 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/artifacts_library.py
--rw-r--r--  2.0 unx    16957 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/model_handler.py
--rw-r--r--  2.0 unx     2723 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/pkl_model_server.py
--rw-r--r--  2.0 unx     4881 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plan.py
--rw-r--r--  2.0 unx     4061 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/producer.py
--rw-r--r--  2.0 unx    10490 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/utils.py
--rw-r--r--  2.0 unx      737 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/loggers/__init__.py
--rw-r--r--  2.0 unx     5684 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/loggers/logger.py
--rw-r--r--  2.0 unx     6453 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/loggers/mlrun_logger.py
--rw-r--r--  2.0 unx      922 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/__init__.py
--rw-r--r--  2.0 unx     4943 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py
--rw-r--r--  2.0 unx     6078 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py
--rw-r--r--  2.0 unx     6658 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/dataset_plan.py
--rw-r--r--  2.0 unx     5318 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/feature_importance_plan.py
--rw-r--r--  2.0 unx     6993 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/roc_curve_plan.py
--rw-r--r--  2.0 unx      706 b- defN 23-Jul-20 14:54 mlrun/frameworks/auto_mlrun/__init__.py
--rw-r--r--  2.0 unx    23796 b- defN 23-Jul-20 14:54 mlrun/frameworks/auto_mlrun/auto_mlrun.py
--rw-r--r--  2.0 unx      721 b- defN 23-Jul-20 14:54 mlrun/frameworks/huggingface/__init__.py
--rw-r--r--  2.0 unx     6083 b- defN 23-Jul-20 14:54 mlrun/frameworks/huggingface/model_server.py
--rw-r--r--  2.0 unx    15883 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/__init__.py
--rw-r--r--  2.0 unx    13891 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/model_handler.py
--rw-r--r--  2.0 unx     9189 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/model_server.py
--rw-r--r--  2.0 unx     8278 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/utils.py
--rw-r--r--  2.0 unx      857 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/callbacks/__init__.py
--rw-r--r--  2.0 unx     4081 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/callbacks/callback.py
--rw-r--r--  2.0 unx     5156 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     4137 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx      842 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py
--rw-r--r--  2.0 unx     1624 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py
--rw-r--r--  2.0 unx    14256 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py
--rw-r--r--  2.0 unx     1333 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py
--rw-r--r--  2.0 unx      791 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/__init__.py
--rw-r--r--  2.0 unx     6098 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/dataset.py
--rw-r--r--  2.0 unx     2405 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/mlrun_interface.py
--rw-r--r--  2.0 unx     6203 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/model_handler.py
--rw-r--r--  2.0 unx     7061 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/model_server.py
--rw-r--r--  2.0 unx    22056 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/__init__.py
--rw-r--r--  2.0 unx    27904 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks_handler.py
--rw-r--r--  2.0 unx    44639 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/mlrun_interface.py
--rw-r--r--  2.0 unx    22465 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/model_handler.py
--rw-r--r--  2.0 unx    10136 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/model_server.py
--rw-r--r--  2.0 unx     4515 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/utils.py
--rw-r--r--  2.0 unx      896 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/__init__.py
--rw-r--r--  2.0 unx    11524 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/callback.py
--rw-r--r--  2.0 unx    23166 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     9310 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx    26661 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py
--rw-r--r--  2.0 unx    10892 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/__init__.py
--rw-r--r--  2.0 unx     5852 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/estimator.py
--rw-r--r--  2.0 unx     7117 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/metric.py
--rw-r--r--  2.0 unx    12215 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/metrics_library.py
--rw-r--r--  2.0 unx    14126 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/mlrun_interface.py
--rw-r--r--  2.0 unx     4745 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/model_handler.py
--rw-r--r--  2.0 unx     1209 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/utils.py
--rw-r--r--  2.0 unx    10455 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/__init__.py
--rw-r--r--  2.0 unx    16627 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/mlrun_interface.py
--rw-r--r--  2.0 unx    28247 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/model_handler.py
--rw-r--r--  2.0 unx     9565 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/model_server.py
--rw-r--r--  2.0 unx     4284 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/utils.py
--rw-r--r--  2.0 unx      844 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/callbacks/__init__.py
--rw-r--r--  2.0 unx    21886 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     8791 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx    28728 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py
--rw-r--r--  2.0 unx    10287 b- defN 23-Jul-20 14:54 mlrun/frameworks/xgboost/__init__.py
--rw-r--r--  2.0 unx      878 b- defN 23-Jul-20 14:54 mlrun/frameworks/xgboost/mlrun_interface.py
--rw-r--r--  2.0 unx    11617 b- defN 23-Jul-20 14:54 mlrun/frameworks/xgboost/model_handler.py
--rw-r--r--  2.0 unx     1069 b- defN 23-Jul-20 14:54 mlrun/frameworks/xgboost/utils.py
--rw-r--r--  2.0 unx      577 b- defN 23-Jul-20 14:54 mlrun/launcher/__init__.py
--rw-r--r--  2.0 unx    15792 b- defN 23-Jul-20 14:54 mlrun/launcher/base.py
--rw-r--r--  2.0 unx     6169 b- defN 23-Jul-20 14:54 mlrun/launcher/client.py
--rw-r--r--  2.0 unx     2182 b- defN 23-Jul-20 14:54 mlrun/launcher/factory.py
--rw-r--r--  2.0 unx    10815 b- defN 23-Jul-20 14:54 mlrun/launcher/local.py
--rw-r--r--  2.0 unx     6770 b- defN 23-Jul-20 14:54 mlrun/launcher/remote.py
--rw-r--r--  2.0 unx      760 b- defN 23-Jul-20 14:54 mlrun/mlutils/__init__.py
--rw-r--r--  2.0 unx     5325 b- defN 23-Jul-20 14:54 mlrun/mlutils/data.py
--rw-r--r--  2.0 unx     2598 b- defN 23-Jul-20 14:54 mlrun/mlutils/models.py
--rw-r--r--  2.0 unx    30120 b- defN 23-Jul-20 14:54 mlrun/mlutils/plots.py
--rw-r--r--  2.0 unx      872 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/__init__.py
--rw-r--r--  2.0 unx    23970 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/features_drift_table.py
--rw-r--r--  2.0 unx     2388 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/helpers.py
--rw-r--r--  2.0 unx     5214 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/model_endpoint.py
--rw-r--r--  2.0 unx    37289 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/model_monitoring_batch.py
--rw-r--r--  2.0 unx    43133 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stream_processing.py
--rw-r--r--  2.0 unx     4475 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/tracking_policy.py
--rw-r--r--  2.0 unx     4248 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/__init__.py
--rw-r--r--  2.0 unx    20351 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/kv_model_endpoint_store.py
--rw-r--r--  2.0 unx     5695 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/model_endpoint_store.py
--rw-r--r--  2.0 unx    15960 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/sql_model_endpoint_store.py
--rw-r--r--  2.0 unx      884 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/models/__init__.py
--rw-r--r--  2.0 unx      655 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/models/base.py
--rw-r--r--  2.0 unx     4153 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/models/mysql.py
--rw-r--r--  2.0 unx     4070 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/models/sqlite.py
--rw-r--r--  2.0 unx     7101 b- defN 23-Jul-20 14:54 mlrun/package/__init__.py
--rw-r--r--  2.0 unx    13974 b- defN 23-Jul-20 14:54 mlrun/package/context_handler.py
--rw-r--r--  2.0 unx     1204 b- defN 23-Jul-20 14:54 mlrun/package/errors.py
--rw-r--r--  2.0 unx    12606 b- defN 23-Jul-20 14:54 mlrun/package/packager.py
--rw-r--r--  2.0 unx    37275 b- defN 23-Jul-20 14:54 mlrun/package/packagers_manager.py
--rw-r--r--  2.0 unx      769 b- defN 23-Jul-20 14:54 mlrun/package/packagers/__init__.py
--rw-r--r--  2.0 unx    20060 b- defN 23-Jul-20 14:54 mlrun/package/packagers/default_packager.py
--rw-r--r--  2.0 unx    20618 b- defN 23-Jul-20 14:54 mlrun/package/packagers/numpy_packagers.py
--rw-r--r--  2.0 unx    35951 b- defN 23-Jul-20 14:54 mlrun/package/packagers/pandas_packagers.py
--rw-r--r--  2.0 unx    21528 b- defN 23-Jul-20 14:54 mlrun/package/packagers/python_standard_library_packagers.py
--rw-r--r--  2.0 unx     1722 b- defN 23-Jul-20 14:54 mlrun/package/utils/__init__.py
--rw-r--r--  2.0 unx     7567 b- defN 23-Jul-20 14:54 mlrun/package/utils/_archiver.py
--rw-r--r--  2.0 unx     6393 b- defN 23-Jul-20 14:54 mlrun/package/utils/_formatter.py
--rw-r--r--  2.0 unx    10926 b- defN 23-Jul-20 14:54 mlrun/package/utils/_pickler.py
--rw-r--r--  2.0 unx     2379 b- defN 23-Jul-20 14:54 mlrun/package/utils/_supported_format.py
--rw-r--r--  2.0 unx     3709 b- defN 23-Jul-20 14:54 mlrun/package/utils/log_hint_utils.py
--rw-r--r--  2.0 unx    14825 b- defN 23-Jul-20 14:54 mlrun/package/utils/type_hint_utils.py
--rw-r--r--  2.0 unx     2400 b- defN 23-Jul-20 14:54 mlrun/platforms/__init__.py
--rw-r--r--  2.0 unx    23997 b- defN 23-Jul-20 14:54 mlrun/platforms/iguazio.py
--rw-r--r--  2.0 unx    11852 b- defN 23-Jul-20 14:54 mlrun/platforms/other.py
--rw-r--r--  2.0 unx     1153 b- defN 23-Jul-20 14:54 mlrun/projects/__init__.py
--rw-r--r--  2.0 unx    17602 b- defN 23-Jul-20 14:54 mlrun/projects/operations.py
--rw-r--r--  2.0 unx    38781 b- defN 23-Jul-20 14:54 mlrun/projects/pipelines.py
--rw-r--r--  2.0 unx   127746 b- defN 23-Jul-20 14:54 mlrun/projects/project.py
--rw-r--r--  2.0 unx     8692 b- defN 23-Jul-20 14:54 mlrun/runtimes/__init__.py
--rw-r--r--  2.0 unx    86542 b- defN 23-Jul-20 14:54 mlrun/runtimes/base.py
--rw-r--r--  2.0 unx     6689 b- defN 23-Jul-20 14:54 mlrun/runtimes/constants.py
--rw-r--r--  2.0 unx    30353 b- defN 23-Jul-20 14:54 mlrun/runtimes/daskjob.py
--rw-r--r--  2.0 unx     9994 b- defN 23-Jul-20 14:54 mlrun/runtimes/funcdoc.py
--rw-r--r--  2.0 unx    44880 b- defN 23-Jul-20 14:54 mlrun/runtimes/function.py
--rw-r--r--  2.0 unx     4911 b- defN 23-Jul-20 14:54 mlrun/runtimes/function_reference.py
--rw-r--r--  2.0 unx     6530 b- defN 23-Jul-20 14:54 mlrun/runtimes/generators.py
--rw-r--r--  2.0 unx    15482 b- defN 23-Jul-20 14:54 mlrun/runtimes/kubejob.py
--rw-r--r--  2.0 unx    19579 b- defN 23-Jul-20 14:54 mlrun/runtimes/local.py
--rw-r--r--  2.0 unx     2885 b- defN 23-Jul-20 14:54 mlrun/runtimes/nuclio.py
--rw-r--r--  2.0 unx    61740 b- defN 23-Jul-20 14:54 mlrun/runtimes/pod.py
--rw-r--r--  2.0 unx     7695 b- defN 23-Jul-20 14:54 mlrun/runtimes/remotesparkjob.py
--rw-r--r--  2.0 unx    30505 b- defN 23-Jul-20 14:54 mlrun/runtimes/serving.py
--rw-r--r--  2.0 unx    20801 b- defN 23-Jul-20 14:54 mlrun/runtimes/utils.py
--rw-r--r--  2.0 unx      790 b- defN 23-Jul-20 14:54 mlrun/runtimes/mpijob/__init__.py
--rw-r--r--  2.0 unx    14713 b- defN 23-Jul-20 14:54 mlrun/runtimes/mpijob/abstract.py
--rw-r--r--  2.0 unx    13845 b- defN 23-Jul-20 14:54 mlrun/runtimes/mpijob/v1.py
--rw-r--r--  2.0 unx     8460 b- defN 23-Jul-20 14:54 mlrun/runtimes/mpijob/v1alpha1.py
--rw-r--r--  2.0 unx      751 b- defN 23-Jul-20 14:54 mlrun/runtimes/sparkjob/__init__.py
--rw-r--r--  2.0 unx    35028 b- defN 23-Jul-20 14:54 mlrun/runtimes/sparkjob/abstract.py
--rw-r--r--  2.0 unx    28746 b- defN 23-Jul-20 14:54 mlrun/runtimes/sparkjob/spark3job.py
--rw-r--r--  2.0 unx     1078 b- defN 23-Jul-20 14:54 mlrun/serving/__init__.py
--rw-r--r--  2.0 unx     6116 b- defN 23-Jul-20 14:54 mlrun/serving/merger.py
--rw-r--r--  2.0 unx    18038 b- defN 23-Jul-20 14:54 mlrun/serving/remote.py
--rw-r--r--  2.0 unx    55318 b- defN 23-Jul-20 14:54 mlrun/serving/routers.py
--rw-r--r--  2.0 unx    20439 b- defN 23-Jul-20 14:54 mlrun/serving/server.py
--rw-r--r--  2.0 unx      836 b- defN 23-Jul-20 14:54 mlrun/serving/serving_wrapper.py
--rw-r--r--  2.0 unx    54310 b- defN 23-Jul-20 14:54 mlrun/serving/states.py
--rw-r--r--  2.0 unx     3902 b- defN 23-Jul-20 14:54 mlrun/serving/utils.py
--rw-r--r--  2.0 unx    11814 b- defN 23-Jul-20 14:54 mlrun/serving/v1_serving.py
--rw-r--r--  2.0 unx    21823 b- defN 23-Jul-20 14:54 mlrun/serving/v2_serving.py
--rw-r--r--  2.0 unx      826 b- defN 23-Jul-20 14:54 mlrun/utils/__init__.py
--rw-r--r--  2.0 unx    10636 b- defN 23-Jul-20 14:54 mlrun/utils/async_http.py
--rw-r--r--  2.0 unx     3456 b- defN 23-Jul-20 14:54 mlrun/utils/azure_vault.py
--rw-r--r--  2.0 unx     6245 b- defN 23-Jul-20 14:54 mlrun/utils/clones.py
--rw-r--r--  2.0 unx     1920 b- defN 23-Jul-20 14:54 mlrun/utils/condition_evaluator.py
--rw-r--r--  2.0 unx     1702 b- defN 23-Jul-20 14:54 mlrun/utils/db.py
--rw-r--r--  2.0 unx    47157 b- defN 23-Jul-20 14:54 mlrun/utils/helpers.py
--rw-r--r--  2.0 unx     8241 b- defN 23-Jul-20 14:54 mlrun/utils/http.py
--rw-r--r--  2.0 unx     7035 b- defN 23-Jul-20 14:54 mlrun/utils/logger.py
--rw-r--r--  2.0 unx     4303 b- defN 23-Jul-20 14:54 mlrun/utils/regex.py
--rw-r--r--  2.0 unx      883 b- defN 23-Jul-20 14:54 mlrun/utils/singleton.py
--rw-r--r--  2.0 unx     1319 b- defN 23-Jul-20 14:54 mlrun/utils/v3io_clients.py
--rw-r--r--  2.0 unx    10447 b- defN 23-Jul-20 14:54 mlrun/utils/vault.py
--rw-r--r--  2.0 unx      990 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/__init__.py
--rw-r--r--  2.0 unx    19870 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification_pusher.py
--rw-r--r--  2.0 unx     2113 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/__init__.py
--rw-r--r--  2.0 unx     2293 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/base.py
--rw-r--r--  2.0 unx     1971 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/console.py
--rw-r--r--  2.0 unx     5221 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/git.py
--rw-r--r--  2.0 unx     1962 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/ipython.py
--rw-r--r--  2.0 unx     3898 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/slack.py
--rw-r--r--  2.0 unx     1865 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/webhook.py
--rw-r--r--  2.0 unx      614 b- defN 23-Jul-20 14:54 mlrun/utils/version/__init__.py
--rw-r--r--  2.0 unx       88 b- defN 23-Jul-20 14:55 mlrun/utils/version/version.json
--rw-r--r--  2.0 unx     1970 b- defN 23-Jul-20 14:54 mlrun/utils/version/version.py
--rw-r--r--  2.0 unx    11357 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/LICENSE
--rw-r--r--  2.0 unx    17014 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/WHEEL
--rw-r--r--  2.0 unx       47 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx    41956 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/RECORD
-447 files, 4772684 bytes uncompressed, 1213687 bytes compressed:  74.6%
+Zip file size: 1292302 bytes, number of entries: 456
+-rw-r--r--  2.0 unx     7279 b- defN 23-Jul-27 15:35 mlrun/__init__.py
+-rw-r--r--  2.0 unx    48410 b- defN 23-Jul-27 15:35 mlrun/__main__.py
+-rw-r--r--  2.0 unx    56571 b- defN 23-Jul-27 15:35 mlrun/config.py
+-rw-r--r--  2.0 unx     6780 b- defN 23-Jul-27 15:35 mlrun/errors.py
+-rw-r--r--  2.0 unx    39723 b- defN 23-Jul-27 15:35 mlrun/execution.py
+-rw-r--r--  2.0 unx    15624 b- defN 23-Jul-27 15:35 mlrun/features.py
+-rw-r--r--  2.0 unx     4876 b- defN 23-Jul-27 15:35 mlrun/k8s_utils.py
+-rw-r--r--  2.0 unx    29489 b- defN 23-Jul-27 15:35 mlrun/kfpops.py
+-rw-r--r--  2.0 unx     8390 b- defN 23-Jul-27 15:35 mlrun/lists.py
+-rw-r--r--  2.0 unx    60317 b- defN 23-Jul-27 15:35 mlrun/model.py
+-rw-r--r--  2.0 unx    13016 b- defN 23-Jul-27 15:35 mlrun/render.py
+-rw-r--r--  2.0 unx    47007 b- defN 23-Jul-27 15:35 mlrun/run.py
+-rw-r--r--  2.0 unx     7783 b- defN 23-Jul-27 15:35 mlrun/secrets.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/__init__.py
+-rw-r--r--  2.0 unx     2105 b- defN 23-Jul-27 15:35 mlrun/api/alembic.ini
+-rw-r--r--  2.0 unx      685 b- defN 23-Jul-27 15:35 mlrun/api/constants.py
+-rw-r--r--  2.0 unx    25653 b- defN 23-Jul-27 15:35 mlrun/api/initial_data.py
+-rw-r--r--  2.0 unx     8681 b- defN 23-Jul-27 15:35 mlrun/api/launcher.py
+-rw-r--r--  2.0 unx    27263 b- defN 23-Jul-27 15:35 mlrun/api/main.py
+-rw-r--r--  2.0 unx     5289 b- defN 23-Jul-27 15:35 mlrun/api/middlewares.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/api/__init__.py
+-rw-r--r--  2.0 unx     4402 b- defN 23-Jul-27 15:35 mlrun/api/api/api.py
+-rw-r--r--  2.0 unx     3197 b- defN 23-Jul-27 15:35 mlrun/api/api/deps.py
+-rw-r--r--  2.0 unx    40170 b- defN 23-Jul-27 15:35 mlrun/api/api/utils.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/__init__.py
+-rw-r--r--  2.0 unx    10452 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/artifacts.py
+-rw-r--r--  2.0 unx     1199 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/auth.py
+-rw-r--r--  2.0 unx     3618 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/background_tasks.py
+-rw-r--r--  2.0 unx     1214 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/client_spec.py
+-rw-r--r--  2.0 unx     1175 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/clusterization_spec.py
+-rw-r--r--  2.0 unx    28853 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/feature_store.py
+-rw-r--r--  2.0 unx     6709 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/files.py
+-rw-r--r--  2.0 unx     5946 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/frontend_spec.py
+-rw-r--r--  2.0 unx    38214 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/functions.py
+-rw-r--r--  2.0 unx     6086 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/grafana_proxy.py
+-rw-r--r--  2.0 unx     1344 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/healthz.py
+-rw-r--r--  2.0 unx    10312 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/hub.py
+-rw-r--r--  2.0 unx     2975 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/logs.py
+-rw-r--r--  2.0 unx    15734 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/model_endpoints.py
+-rw-r--r--  2.0 unx     3756 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/operations.py
+-rw-r--r--  2.0 unx     9098 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/pipelines.py
+-rw-r--r--  2.0 unx    14736 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/projects.py
+-rw-r--r--  2.0 unx    11881 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/runs.py
+-rw-r--r--  2.0 unx     9035 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/runtime_resources.py
+-rw-r--r--  2.0 unx    12544 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/schedules.py
+-rw-r--r--  2.0 unx     6061 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/secrets.py
+-rw-r--r--  2.0 unx     5327 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/submit.py
+-rw-r--r--  2.0 unx     4849 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/tags.py
+-rw-r--r--  2.0 unx    13795 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/workflows.py
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/internal/__init__.py
+-rw-r--r--  2.0 unx     1043 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/internal/config.py
+-rw-r--r--  2.0 unx     1718 b- defN 23-Jul-27 15:35 mlrun/api/api/endpoints/internal/memory_reports.py
+-rw-r--r--  2.0 unx     1248 b- defN 23-Jul-27 15:35 mlrun/api/crud/__init__.py
+-rw-r--r--  2.0 unx     5610 b- defN 23-Jul-27 15:35 mlrun/api/crud/artifacts.py
+-rw-r--r--  2.0 unx     7536 b- defN 23-Jul-27 15:35 mlrun/api/crud/client_spec.py
+-rw-r--r--  2.0 unx     1055 b- defN 23-Jul-27 15:35 mlrun/api/crud/clusterization_spec.py
+-rw-r--r--  2.0 unx    18971 b- defN 23-Jul-27 15:35 mlrun/api/crud/feature_store.py
+-rw-r--r--  2.0 unx     3556 b- defN 23-Jul-27 15:35 mlrun/api/crud/functions.py
+-rw-r--r--  2.0 unx    12025 b- defN 23-Jul-27 15:35 mlrun/api/crud/hub.py
+-rw-r--r--  2.0 unx     9409 b- defN 23-Jul-27 15:35 mlrun/api/crud/logs.py
+-rw-r--r--  2.0 unx     5739 b- defN 23-Jul-27 15:35 mlrun/api/crud/notifications.py
+-rw-r--r--  2.0 unx    14781 b- defN 23-Jul-27 15:35 mlrun/api/crud/pipelines.py
+-rw-r--r--  2.0 unx    15240 b- defN 23-Jul-27 15:35 mlrun/api/crud/projects.py
+-rw-r--r--  2.0 unx     5963 b- defN 23-Jul-27 15:35 mlrun/api/crud/runs.py
+-rw-r--r--  2.0 unx     5645 b- defN 23-Jul-27 15:35 mlrun/api/crud/runtime_resources.py
+-rw-r--r--  2.0 unx    22158 b- defN 23-Jul-27 15:35 mlrun/api/crud/secrets.py
+-rw-r--r--  2.0 unx     3277 b- defN 23-Jul-27 15:35 mlrun/api/crud/tags.py
+-rw-r--r--  2.0 unx    13193 b- defN 23-Jul-27 15:35 mlrun/api/crud/workflows.py
+-rw-r--r--  2.0 unx      759 b- defN 23-Jul-27 15:35 mlrun/api/crud/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx    21692 b- defN 23-Jul-27 15:35 mlrun/api/crud/model_monitoring/deployment.py
+-rw-r--r--  2.0 unx    17494 b- defN 23-Jul-27 15:35 mlrun/api/crud/model_monitoring/grafana.py
+-rw-r--r--  2.0 unx     5581 b- defN 23-Jul-27 15:35 mlrun/api/crud/model_monitoring/helpers.py
+-rw-r--r--  2.0 unx    31573 b- defN 23-Jul-27 15:35 mlrun/api/crud/model_monitoring/model_endpoints.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/crud/runtimes/__init__.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/crud/runtimes/nuclio/__init__.py
+-rw-r--r--  2.0 unx    18762 b- defN 23-Jul-27 15:35 mlrun/api/crud/runtimes/nuclio/function.py
+-rw-r--r--  2.0 unx    11510 b- defN 23-Jul-27 15:35 mlrun/api/crud/runtimes/nuclio/helpers.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/db/__init__.py
+-rw-r--r--  2.0 unx    15769 b- defN 23-Jul-27 15:35 mlrun/api/db/base.py
+-rw-r--r--  2.0 unx      739 b- defN 23-Jul-27 15:35 mlrun/api/db/init_db.py
+-rw-r--r--  2.0 unx      994 b- defN 23-Jul-27 15:35 mlrun/api/db/session.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/db/sqldb/__init__.py
+-rw-r--r--  2.0 unx   151630 b- defN 23-Jul-27 15:35 mlrun/api/db/sqldb/db.py
+-rw-r--r--  2.0 unx     2340 b- defN 23-Jul-27 15:35 mlrun/api/db/sqldb/helpers.py
+-rw-r--r--  2.0 unx     1105 b- defN 23-Jul-27 15:35 mlrun/api/db/sqldb/models/__init__.py
+-rw-r--r--  2.0 unx    21345 b- defN 23-Jul-27 15:35 mlrun/api/db/sqldb/models/models_mysql.py
+-rw-r--r--  2.0 unx    19014 b- defN 23-Jul-27 15:35 mlrun/api/db/sqldb/models/models_sqlite.py
+-rw-r--r--  2.0 unx     2906 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/env.py
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py
+-rw-r--r--  2.0 unx     4614 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py
+-rw-r--r--  2.0 unx     1936 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py
+-rw-r--r--  2.0 unx     1909 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py
+-rw-r--r--  2.0 unx     1415 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py
+-rw-r--r--  2.0 unx     1504 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py
+-rw-r--r--  2.0 unx     1649 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py
+-rw-r--r--  2.0 unx    24057 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py
+-rw-r--r--  2.0 unx     2662 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py
+-rw-r--r--  2.0 unx     1351 b- defN 23-Jul-27 15:35 mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py
+-rw-r--r--  2.0 unx     2906 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/env.py
+-rw-r--r--  2.0 unx    11473 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py
+-rw-r--r--  2.0 unx     1348 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py
+-rw-r--r--  2.0 unx     5180 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py
+-rw-r--r--  2.0 unx     2595 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py
+-rw-r--r--  2.0 unx     1388 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py
+-rw-r--r--  2.0 unx     1767 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py
+-rw-r--r--  2.0 unx     1360 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py
+-rw-r--r--  2.0 unx     1259 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py
+-rw-r--r--  2.0 unx     2352 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py
+-rw-r--r--  2.0 unx     1482 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py
+-rw-r--r--  2.0 unx     1892 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py
+-rw-r--r--  2.0 unx     1882 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py
+-rw-r--r--  2.0 unx     1420 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py
+-rw-r--r--  2.0 unx     2034 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py
+-rw-r--r--  2.0 unx     1828 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py
+-rw-r--r--  2.0 unx     1380 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py
+-rw-r--r--  2.0 unx     1831 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py
+-rw-r--r--  2.0 unx     3936 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py
+-rw-r--r--  2.0 unx     2588 b- defN 23-Jul-27 15:35 mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py
+-rw-r--r--  2.0 unx      577 b- defN 23-Jul-27 15:35 mlrun/api/rundb/__init__.py
+-rw-r--r--  2.0 unx    25246 b- defN 23-Jul-27 15:35 mlrun/api/rundb/sqldb.py
+-rw-r--r--  2.0 unx     2523 b- defN 23-Jul-27 15:35 mlrun/api/runtime_handlers/__init__.py
+-rw-r--r--  2.0 unx    50942 b- defN 23-Jul-27 15:35 mlrun/api/runtime_handlers/base.py
+-rw-r--r--  2.0 unx     7886 b- defN 23-Jul-27 15:35 mlrun/api/runtime_handlers/daskjob.py
+-rw-r--r--  2.0 unx     1309 b- defN 23-Jul-27 15:35 mlrun/api/runtime_handlers/kubejob.py
+-rw-r--r--  2.0 unx     5433 b- defN 23-Jul-27 15:35 mlrun/api/runtime_handlers/mpijob.py
+-rw-r--r--  2.0 unx     1036 b- defN 23-Jul-27 15:35 mlrun/api/runtime_handlers/remotesparkjob.py
+-rw-r--r--  2.0 unx     5440 b- defN 23-Jul-27 15:35 mlrun/api/runtime_handlers/sparkjob.py
+-rw-r--r--  2.0 unx    13571 b- defN 23-Jul-27 15:35 mlrun/api/schemas/__init__.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/__init__.py
+-rw-r--r--  2.0 unx     1092 b- defN 23-Jul-27 15:35 mlrun/api/utils/asyncio.py
+-rw-r--r--  2.0 unx     7371 b- defN 23-Jul-27 15:35 mlrun/api/utils/background_tasks.py
+-rw-r--r--  2.0 unx    26821 b- defN 23-Jul-27 15:35 mlrun/api/utils/builder.py
+-rw-r--r--  2.0 unx     2512 b- defN 23-Jul-27 15:35 mlrun/api/utils/helpers.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jul-27 15:35 mlrun/api/utils/memory_reports.py
+-rw-r--r--  2.0 unx     2760 b- defN 23-Jul-27 15:35 mlrun/api/utils/periodic.py
+-rw-r--r--  2.0 unx    45705 b- defN 23-Jul-27 15:35 mlrun/api/utils/scheduler.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/auth/__init__.py
+-rw-r--r--  2.0 unx    12383 b- defN 23-Jul-27 15:35 mlrun/api/utils/auth/verifier.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/auth/providers/__init__.py
+-rw-r--r--  2.0 unx     1381 b- defN 23-Jul-27 15:35 mlrun/api/utils/auth/providers/base.py
+-rw-r--r--  2.0 unx     1460 b- defN 23-Jul-27 15:35 mlrun/api/utils/auth/providers/nop.py
+-rw-r--r--  2.0 unx    10883 b- defN 23-Jul-27 15:35 mlrun/api/utils/auth/providers/opa.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/clients/__init__.py
+-rw-r--r--  2.0 unx    14075 b- defN 23-Jul-27 15:35 mlrun/api/utils/clients/chief.py
+-rw-r--r--  2.0 unx    32674 b- defN 23-Jul-27 15:35 mlrun/api/utils/clients/iguazio.py
+-rw-r--r--  2.0 unx    12281 b- defN 23-Jul-27 15:35 mlrun/api/utils/clients/log_collector.py
+-rw-r--r--  2.0 unx     9911 b- defN 23-Jul-27 15:35 mlrun/api/utils/clients/nuclio.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/clients/protocols/__init__.py
+-rw-r--r--  2.0 unx     2567 b- defN 23-Jul-27 15:35 mlrun/api/utils/clients/protocols/grpc.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/db/__init__.py
+-rw-r--r--  2.0 unx     3305 b- defN 23-Jul-27 15:35 mlrun/api/utils/db/alembic.py
+-rw-r--r--  2.0 unx     8214 b- defN 23-Jul-27 15:35 mlrun/api/utils/db/backup.py
+-rw-r--r--  2.0 unx     3787 b- defN 23-Jul-27 15:35 mlrun/api/utils/db/mysql.py
+-rw-r--r--  2.0 unx      992 b- defN 23-Jul-27 15:35 mlrun/api/utils/db/sql_collation.py
+-rw-r--r--  2.0 unx     3861 b- defN 23-Jul-27 15:35 mlrun/api/utils/db/sqlite_migration.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/events/__init__.py
+-rw-r--r--  2.0 unx     1721 b- defN 23-Jul-27 15:35 mlrun/api/utils/events/base.py
+-rw-r--r--  2.0 unx     1630 b- defN 23-Jul-27 15:35 mlrun/api/utils/events/events_factory.py
+-rw-r--r--  2.0 unx     8798 b- defN 23-Jul-27 15:35 mlrun/api/utils/events/iguazio.py
+-rw-r--r--  2.0 unx     1739 b- defN 23-Jul-27 15:35 mlrun/api/utils/events/nop.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/__init__.py
+-rw-r--r--  2.0 unx    17760 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/follower.py
+-rw-r--r--  2.0 unx    19412 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/leader.py
+-rw-r--r--  2.0 unx     7133 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/member.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/remotes/__init__.py
+-rw-r--r--  2.0 unx     2659 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/remotes/follower.py
+-rw-r--r--  2.0 unx     2094 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/remotes/leader.py
+-rw-r--r--  2.0 unx     4995 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/remotes/nop_follower.py
+-rw-r--r--  2.0 unx     3854 b- defN 23-Jul-27 15:35 mlrun/api/utils/projects/remotes/nop_leader.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/runtimes/__init__.py
+-rw-r--r--  2.0 unx     1675 b- defN 23-Jul-27 15:35 mlrun/api/utils/runtimes/nuclio.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/api/utils/singletons/__init__.py
+-rw-r--r--  2.0 unx     1313 b- defN 23-Jul-27 15:35 mlrun/api/utils/singletons/db.py
+-rw-r--r--  2.0 unx    24570 b- defN 23-Jul-27 15:35 mlrun/api/utils/singletons/k8s.py
+-rw-r--r--  2.0 unx      840 b- defN 23-Jul-27 15:35 mlrun/api/utils/singletons/logs_dir.py
+-rw-r--r--  2.0 unx     1312 b- defN 23-Jul-27 15:35 mlrun/api/utils/singletons/project_member.py
+-rw-r--r--  2.0 unx     1064 b- defN 23-Jul-27 15:35 mlrun/api/utils/singletons/scheduler.py
+-rw-r--r--  2.0 unx     1123 b- defN 23-Jul-27 15:35 mlrun/artifacts/__init__.py
+-rw-r--r--  2.0 unx    31144 b- defN 23-Jul-27 15:35 mlrun/artifacts/base.py
+-rw-r--r--  2.0 unx    20485 b- defN 23-Jul-27 15:35 mlrun/artifacts/dataset.py
+-rw-r--r--  2.0 unx    12573 b- defN 23-Jul-27 15:35 mlrun/artifacts/manager.py
+-rw-r--r--  2.0 unx    24241 b- defN 23-Jul-27 15:35 mlrun/artifacts/model.py
+-rw-r--r--  2.0 unx    15383 b- defN 23-Jul-27 15:35 mlrun/artifacts/plots.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/common/__init__.py
+-rw-r--r--  2.0 unx      660 b- defN 23-Jul-27 15:35 mlrun/common/constants.py
+-rw-r--r--  2.0 unx     1108 b- defN 23-Jul-27 15:35 mlrun/common/helpers.py
+-rw-r--r--  2.0 unx      790 b- defN 23-Jul-27 15:35 mlrun/common/types.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-27 15:35 mlrun/common/db/__init__.py
+-rw-r--r--  2.0 unx     2542 b- defN 23-Jul-27 15:35 mlrun/common/db/sql_session.py
+-rw-r--r--  2.0 unx      721 b- defN 23-Jul-27 15:35 mlrun/common/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx     2312 b- defN 23-Jul-27 15:35 mlrun/common/model_monitoring/helpers.py
+-rw-r--r--  2.0 unx     4496 b- defN 23-Jul-27 15:35 mlrun/common/schemas/__init__.py
+-rw-r--r--  2.0 unx     1923 b- defN 23-Jul-27 15:35 mlrun/common/schemas/artifact.py
+-rw-r--r--  2.0 unx     5730 b- defN 23-Jul-27 15:35 mlrun/common/schemas/auth.py
+-rw-r--r--  2.0 unx     1553 b- defN 23-Jul-27 15:35 mlrun/common/schemas/background_task.py
+-rw-r--r--  2.0 unx     2813 b- defN 23-Jul-27 15:35 mlrun/common/schemas/client_spec.py
+-rw-r--r--  2.0 unx      888 b- defN 23-Jul-27 15:35 mlrun/common/schemas/clusterization_spec.py
+-rw-r--r--  2.0 unx     6243 b- defN 23-Jul-27 15:35 mlrun/common/schemas/constants.py
+-rw-r--r--  2.0 unx     1026 b- defN 23-Jul-27 15:35 mlrun/common/schemas/events.py
+-rw-r--r--  2.0 unx     3723 b- defN 23-Jul-27 15:35 mlrun/common/schemas/feature_store.py
+-rw-r--r--  2.0 unx     2546 b- defN 23-Jul-27 15:35 mlrun/common/schemas/frontend_spec.py
+-rw-r--r--  2.0 unx     4432 b- defN 23-Jul-27 15:35 mlrun/common/schemas/function.py
+-rw-r--r--  2.0 unx      705 b- defN 23-Jul-27 15:35 mlrun/common/schemas/http.py
+-rw-r--r--  2.0 unx     4245 b- defN 23-Jul-27 15:35 mlrun/common/schemas/hub.py
+-rw-r--r--  2.0 unx     1395 b- defN 23-Jul-27 15:35 mlrun/common/schemas/k8s.py
+-rw-r--r--  2.0 unx      920 b- defN 23-Jul-27 15:35 mlrun/common/schemas/memory_reports.py
+-rw-r--r--  2.0 unx     1518 b- defN 23-Jul-27 15:35 mlrun/common/schemas/notification.py
+-rw-r--r--  2.0 unx     1986 b- defN 23-Jul-27 15:35 mlrun/common/schemas/object.py
+-rw-r--r--  2.0 unx     1184 b- defN 23-Jul-27 15:35 mlrun/common/schemas/pipeline.py
+-rw-r--r--  2.0 unx     4224 b- defN 23-Jul-27 15:35 mlrun/common/schemas/project.py
+-rw-r--r--  2.0 unx      776 b- defN 23-Jul-27 15:35 mlrun/common/schemas/regex.py
+-rw-r--r--  2.0 unx      745 b- defN 23-Jul-27 15:35 mlrun/common/schemas/runs.py
+-rw-r--r--  2.0 unx     1636 b- defN 23-Jul-27 15:35 mlrun/common/schemas/runtime_resource.py
+-rw-r--r--  2.0 unx     4293 b- defN 23-Jul-27 15:35 mlrun/common/schemas/schedule.py
+-rw-r--r--  2.0 unx     1484 b- defN 23-Jul-27 15:35 mlrun/common/schemas/secret.py
+-rw-r--r--  2.0 unx      905 b- defN 23-Jul-27 15:35 mlrun/common/schemas/tag.py
+-rw-r--r--  2.0 unx     1729 b- defN 23-Jul-27 15:35 mlrun/common/schemas/workflow.py
+-rw-r--r--  2.0 unx     1322 b- defN 23-Jul-27 15:35 mlrun/common/schemas/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx     5376 b- defN 23-Jul-27 15:35 mlrun/common/schemas/model_monitoring/constants.py
+-rw-r--r--  2.0 unx     1444 b- defN 23-Jul-27 15:35 mlrun/common/schemas/model_monitoring/grafana.py
+-rw-r--r--  2.0 unx    11152 b- defN 23-Jul-27 15:35 mlrun/common/schemas/model_monitoring/model_endpoints.py
+-rw-r--r--  2.0 unx     1087 b- defN 23-Jul-27 15:35 mlrun/data_types/__init__.py
+-rw-r--r--  2.0 unx     4647 b- defN 23-Jul-27 15:35 mlrun/data_types/data_types.py
+-rw-r--r--  2.0 unx     5813 b- defN 23-Jul-27 15:35 mlrun/data_types/infer.py
+-rw-r--r--  2.0 unx     9426 b- defN 23-Jul-27 15:35 mlrun/data_types/spark.py
+-rw-r--r--  2.0 unx     4089 b- defN 23-Jul-27 15:35 mlrun/datastore/__init__.py
+-rw-r--r--  2.0 unx     6946 b- defN 23-Jul-27 15:35 mlrun/datastore/azure_blob.py
+-rw-r--r--  2.0 unx    22471 b- defN 23-Jul-27 15:35 mlrun/datastore/base.py
+-rw-r--r--  2.0 unx     8377 b- defN 23-Jul-27 15:35 mlrun/datastore/datastore.py
+-rw-r--r--  2.0 unx     6302 b- defN 23-Jul-27 15:35 mlrun/datastore/dbfs_store.py
+-rw-r--r--  2.0 unx     3791 b- defN 23-Jul-27 15:35 mlrun/datastore/filestore.py
+-rw-r--r--  2.0 unx     5114 b- defN 23-Jul-27 15:35 mlrun/datastore/google_cloud_storage.py
+-rw-r--r--  2.0 unx      622 b- defN 23-Jul-27 15:35 mlrun/datastore/helpers.py
+-rw-r--r--  2.0 unx     2779 b- defN 23-Jul-27 15:35 mlrun/datastore/inmem.py
+-rw-r--r--  2.0 unx     4873 b- defN 23-Jul-27 15:35 mlrun/datastore/redis.py
+-rw-r--r--  2.0 unx     7035 b- defN 23-Jul-27 15:35 mlrun/datastore/s3.py
+-rw-r--r--  2.0 unx    37649 b- defN 23-Jul-27 15:35 mlrun/datastore/sources.py
+-rw-r--r--  2.0 unx     1498 b- defN 23-Jul-27 15:35 mlrun/datastore/spark_udf.py
+-rw-r--r--  2.0 unx     6906 b- defN 23-Jul-27 15:35 mlrun/datastore/store_resources.py
+-rw-r--r--  2.0 unx    63310 b- defN 23-Jul-27 15:35 mlrun/datastore/targets.py
+-rw-r--r--  2.0 unx     5438 b- defN 23-Jul-27 15:35 mlrun/datastore/utils.py
+-rw-r--r--  2.0 unx     8099 b- defN 23-Jul-27 15:35 mlrun/datastore/v3io.py
+-rw-r--r--  2.0 unx     1343 b- defN 23-Jul-27 15:35 mlrun/datastore/wasbfs/__init__.py
+-rw-r--r--  2.0 unx     6152 b- defN 23-Jul-27 15:35 mlrun/datastore/wasbfs/fs.py
+-rw-r--r--  2.0 unx     1145 b- defN 23-Jul-27 15:35 mlrun/db/__init__.py
+-rw-r--r--  2.0 unx    16494 b- defN 23-Jul-27 15:35 mlrun/db/base.py
+-rw-r--r--  2.0 unx     2117 b- defN 23-Jul-27 15:35 mlrun/db/factory.py
+-rw-r--r--  2.0 unx   139637 b- defN 23-Jul-27 15:35 mlrun/db/httpdb.py
+-rw-r--r--  2.0 unx    13378 b- defN 23-Jul-27 15:35 mlrun/db/nopdb.py
+-rw-r--r--  2.0 unx     1516 b- defN 23-Jul-27 15:35 mlrun/feature_store/__init__.py
+-rw-r--r--  2.0 unx    44899 b- defN 23-Jul-27 15:35 mlrun/feature_store/api.py
+-rw-r--r--  2.0 unx    12809 b- defN 23-Jul-27 15:35 mlrun/feature_store/common.py
+-rw-r--r--  2.0 unx    47773 b- defN 23-Jul-27 15:35 mlrun/feature_store/feature_set.py
+-rw-r--r--  2.0 unx    34934 b- defN 23-Jul-27 15:35 mlrun/feature_store/feature_vector.py
+-rw-r--r--  2.0 unx    11185 b- defN 23-Jul-27 15:35 mlrun/feature_store/ingestion.py
+-rw-r--r--  2.0 unx    29357 b- defN 23-Jul-27 15:35 mlrun/feature_store/steps.py
+-rw-r--r--  2.0 unx     1260 b- defN 23-Jul-27 15:35 mlrun/feature_store/retrieval/__init__.py
+-rw-r--r--  2.0 unx    30622 b- defN 23-Jul-27 15:35 mlrun/feature_store/retrieval/base.py
+-rw-r--r--  2.0 unx     4895 b- defN 23-Jul-27 15:35 mlrun/feature_store/retrieval/dask_merger.py
+-rw-r--r--  2.0 unx     7714 b- defN 23-Jul-27 15:35 mlrun/feature_store/retrieval/job.py
+-rw-r--r--  2.0 unx     4218 b- defN 23-Jul-27 15:35 mlrun/feature_store/retrieval/local_merger.py
+-rw-r--r--  2.0 unx     9819 b- defN 23-Jul-27 15:35 mlrun/feature_store/retrieval/spark_merger.py
+-rw-r--r--  2.0 unx     6539 b- defN 23-Jul-27 15:35 mlrun/feature_store/retrieval/storey_merger.py
+-rw-r--r--  2.0 unx      743 b- defN 23-Jul-27 15:35 mlrun/frameworks/__init__.py
+-rw-r--r--  2.0 unx    11466 b- defN 23-Jul-27 15:35 mlrun/frameworks/parallel_coordinates.py
+-rw-r--r--  2.0 unx      962 b- defN 23-Jul-27 15:35 mlrun/frameworks/_common/__init__.py
+-rw-r--r--  2.0 unx     8515 b- defN 23-Jul-27 15:35 mlrun/frameworks/_common/artifacts_library.py
+-rw-r--r--  2.0 unx    21018 b- defN 23-Jul-27 15:35 mlrun/frameworks/_common/mlrun_interface.py
+-rw-r--r--  2.0 unx    55376 b- defN 23-Jul-27 15:35 mlrun/frameworks/_common/model_handler.py
+-rw-r--r--  2.0 unx     3469 b- defN 23-Jul-27 15:35 mlrun/frameworks/_common/plan.py
+-rw-r--r--  2.0 unx     5757 b- defN 23-Jul-27 15:35 mlrun/frameworks/_common/producer.py
+-rw-r--r--  2.0 unx     9209 b- defN 23-Jul-27 15:35 mlrun/frameworks/_common/utils.py
+-rw-r--r--  2.0 unx      750 b- defN 23-Jul-27 15:35 mlrun/frameworks/_dl_common/__init__.py
+-rw-r--r--  2.0 unx     1151 b- defN 23-Jul-27 15:35 mlrun/frameworks/_dl_common/model_handler.py
+-rw-r--r--  2.0 unx      996 b- defN 23-Jul-27 15:35 mlrun/frameworks/_dl_common/utils.py
+-rw-r--r--  2.0 unx      787 b- defN 23-Jul-27 15:35 mlrun/frameworks/_dl_common/loggers/__init__.py
+-rw-r--r--  2.0 unx    11531 b- defN 23-Jul-27 15:35 mlrun/frameworks/_dl_common/loggers/logger.py
+-rw-r--r--  2.0 unx    14777 b- defN 23-Jul-27 15:35 mlrun/frameworks/_dl_common/loggers/mlrun_logger.py
+-rw-r--r--  2.0 unx    28414 b- defN 23-Jul-27 15:35 mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py
+-rw-r--r--  2.0 unx      956 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/__init__.py
+-rw-r--r--  2.0 unx     3169 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/artifacts_library.py
+-rw-r--r--  2.0 unx    16957 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/model_handler.py
+-rw-r--r--  2.0 unx     2723 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/pkl_model_server.py
+-rw-r--r--  2.0 unx     4881 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/plan.py
+-rw-r--r--  2.0 unx     4061 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/producer.py
+-rw-r--r--  2.0 unx    10490 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/utils.py
+-rw-r--r--  2.0 unx      737 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/loggers/__init__.py
+-rw-r--r--  2.0 unx     5684 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/loggers/logger.py
+-rw-r--r--  2.0 unx     6453 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/loggers/mlrun_logger.py
+-rw-r--r--  2.0 unx      922 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/plans/__init__.py
+-rw-r--r--  2.0 unx     4943 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py
+-rw-r--r--  2.0 unx     6078 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py
+-rw-r--r--  2.0 unx     6658 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/plans/dataset_plan.py
+-rw-r--r--  2.0 unx     5318 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/plans/feature_importance_plan.py
+-rw-r--r--  2.0 unx     6993 b- defN 23-Jul-27 15:35 mlrun/frameworks/_ml_common/plans/roc_curve_plan.py
+-rw-r--r--  2.0 unx      706 b- defN 23-Jul-27 15:35 mlrun/frameworks/auto_mlrun/__init__.py
+-rw-r--r--  2.0 unx    23796 b- defN 23-Jul-27 15:35 mlrun/frameworks/auto_mlrun/auto_mlrun.py
+-rw-r--r--  2.0 unx      721 b- defN 23-Jul-27 15:35 mlrun/frameworks/huggingface/__init__.py
+-rw-r--r--  2.0 unx     6083 b- defN 23-Jul-27 15:35 mlrun/frameworks/huggingface/model_server.py
+-rw-r--r--  2.0 unx    15883 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/__init__.py
+-rw-r--r--  2.0 unx    13891 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/model_handler.py
+-rw-r--r--  2.0 unx     9189 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/model_server.py
+-rw-r--r--  2.0 unx     8278 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/utils.py
+-rw-r--r--  2.0 unx      857 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/callbacks/__init__.py
+-rw-r--r--  2.0 unx     4081 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/callbacks/callback.py
+-rw-r--r--  2.0 unx     5156 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     4137 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx      842 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py
+-rw-r--r--  2.0 unx     1624 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py
+-rw-r--r--  2.0 unx    14256 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py
+-rw-r--r--  2.0 unx     1333 b- defN 23-Jul-27 15:35 mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py
+-rw-r--r--  2.0 unx      791 b- defN 23-Jul-27 15:35 mlrun/frameworks/onnx/__init__.py
+-rw-r--r--  2.0 unx     6098 b- defN 23-Jul-27 15:35 mlrun/frameworks/onnx/dataset.py
+-rw-r--r--  2.0 unx     2405 b- defN 23-Jul-27 15:35 mlrun/frameworks/onnx/mlrun_interface.py
+-rw-r--r--  2.0 unx     6203 b- defN 23-Jul-27 15:35 mlrun/frameworks/onnx/model_handler.py
+-rw-r--r--  2.0 unx     7061 b- defN 23-Jul-27 15:35 mlrun/frameworks/onnx/model_server.py
+-rw-r--r--  2.0 unx    22056 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/__init__.py
+-rw-r--r--  2.0 unx    27904 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/callbacks_handler.py
+-rw-r--r--  2.0 unx    44639 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/mlrun_interface.py
+-rw-r--r--  2.0 unx    22465 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/model_handler.py
+-rw-r--r--  2.0 unx    10136 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/model_server.py
+-rw-r--r--  2.0 unx     4515 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/utils.py
+-rw-r--r--  2.0 unx      896 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/callbacks/__init__.py
+-rw-r--r--  2.0 unx    11524 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/callbacks/callback.py
+-rw-r--r--  2.0 unx    23166 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     9310 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx    26661 b- defN 23-Jul-27 15:35 mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py
+-rw-r--r--  2.0 unx    10892 b- defN 23-Jul-27 15:35 mlrun/frameworks/sklearn/__init__.py
+-rw-r--r--  2.0 unx     5852 b- defN 23-Jul-27 15:35 mlrun/frameworks/sklearn/estimator.py
+-rw-r--r--  2.0 unx     7117 b- defN 23-Jul-27 15:35 mlrun/frameworks/sklearn/metric.py
+-rw-r--r--  2.0 unx    12215 b- defN 23-Jul-27 15:35 mlrun/frameworks/sklearn/metrics_library.py
+-rw-r--r--  2.0 unx    14126 b- defN 23-Jul-27 15:35 mlrun/frameworks/sklearn/mlrun_interface.py
+-rw-r--r--  2.0 unx     4745 b- defN 23-Jul-27 15:35 mlrun/frameworks/sklearn/model_handler.py
+-rw-r--r--  2.0 unx     1209 b- defN 23-Jul-27 15:35 mlrun/frameworks/sklearn/utils.py
+-rw-r--r--  2.0 unx    10455 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/__init__.py
+-rw-r--r--  2.0 unx    16627 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/mlrun_interface.py
+-rw-r--r--  2.0 unx    28247 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/model_handler.py
+-rw-r--r--  2.0 unx     9565 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/model_server.py
+-rw-r--r--  2.0 unx     4284 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/utils.py
+-rw-r--r--  2.0 unx      844 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/callbacks/__init__.py
+-rw-r--r--  2.0 unx    21886 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     8791 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx    28728 b- defN 23-Jul-27 15:35 mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py
+-rw-r--r--  2.0 unx    10287 b- defN 23-Jul-27 15:35 mlrun/frameworks/xgboost/__init__.py
+-rw-r--r--  2.0 unx      878 b- defN 23-Jul-27 15:35 mlrun/frameworks/xgboost/mlrun_interface.py
+-rw-r--r--  2.0 unx    11617 b- defN 23-Jul-27 15:35 mlrun/frameworks/xgboost/model_handler.py
+-rw-r--r--  2.0 unx     1069 b- defN 23-Jul-27 15:35 mlrun/frameworks/xgboost/utils.py
+-rw-r--r--  2.0 unx      577 b- defN 23-Jul-27 15:35 mlrun/launcher/__init__.py
+-rw-r--r--  2.0 unx    15798 b- defN 23-Jul-27 15:35 mlrun/launcher/base.py
+-rw-r--r--  2.0 unx     6174 b- defN 23-Jul-27 15:35 mlrun/launcher/client.py
+-rw-r--r--  2.0 unx     2344 b- defN 23-Jul-27 15:35 mlrun/launcher/factory.py
+-rw-r--r--  2.0 unx    10815 b- defN 23-Jul-27 15:35 mlrun/launcher/local.py
+-rw-r--r--  2.0 unx     6770 b- defN 23-Jul-27 15:35 mlrun/launcher/remote.py
+-rw-r--r--  2.0 unx      872 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx    23970 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/features_drift_table.py
+-rw-r--r--  2.0 unx     1902 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/helpers.py
+-rw-r--r--  2.0 unx     5214 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/model_endpoint.py
+-rw-r--r--  2.0 unx    39798 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/model_monitoring_batch.py
+-rw-r--r--  2.0 unx     7605 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/prometheus.py
+-rw-r--r--  2.0 unx    48755 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stream_processing.py
+-rw-r--r--  2.0 unx     4475 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/tracking_policy.py
+-rw-r--r--  2.0 unx     4525 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stores/__init__.py
+-rw-r--r--  2.0 unx    20351 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stores/kv_model_endpoint_store.py
+-rw-r--r--  2.0 unx     5695 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stores/model_endpoint_store.py
+-rw-r--r--  2.0 unx    16123 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stores/sql_model_endpoint_store.py
+-rw-r--r--  2.0 unx      884 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stores/models/__init__.py
+-rw-r--r--  2.0 unx      655 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stores/models/base.py
+-rw-r--r--  2.0 unx     4153 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stores/models/mysql.py
+-rw-r--r--  2.0 unx     4070 b- defN 23-Jul-27 15:35 mlrun/model_monitoring/stores/models/sqlite.py
+-rw-r--r--  2.0 unx     7101 b- defN 23-Jul-27 15:35 mlrun/package/__init__.py
+-rw-r--r--  2.0 unx    13974 b- defN 23-Jul-27 15:35 mlrun/package/context_handler.py
+-rw-r--r--  2.0 unx     1204 b- defN 23-Jul-27 15:35 mlrun/package/errors.py
+-rw-r--r--  2.0 unx    12578 b- defN 23-Jul-27 15:35 mlrun/package/packager.py
+-rw-r--r--  2.0 unx    37275 b- defN 23-Jul-27 15:35 mlrun/package/packagers_manager.py
+-rw-r--r--  2.0 unx      769 b- defN 23-Jul-27 15:35 mlrun/package/packagers/__init__.py
+-rw-r--r--  2.0 unx    24227 b- defN 23-Jul-27 15:35 mlrun/package/packagers/default_packager.py
+-rw-r--r--  2.0 unx    20618 b- defN 23-Jul-27 15:35 mlrun/package/packagers/numpy_packagers.py
+-rw-r--r--  2.0 unx    35951 b- defN 23-Jul-27 15:35 mlrun/package/packagers/pandas_packagers.py
+-rw-r--r--  2.0 unx    21528 b- defN 23-Jul-27 15:35 mlrun/package/packagers/python_standard_library_packagers.py
+-rw-r--r--  2.0 unx     1722 b- defN 23-Jul-27 15:35 mlrun/package/utils/__init__.py
+-rw-r--r--  2.0 unx     7567 b- defN 23-Jul-27 15:35 mlrun/package/utils/_archiver.py
+-rw-r--r--  2.0 unx     6393 b- defN 23-Jul-27 15:35 mlrun/package/utils/_formatter.py
+-rw-r--r--  2.0 unx    10926 b- defN 23-Jul-27 15:35 mlrun/package/utils/_pickler.py
+-rw-r--r--  2.0 unx     2379 b- defN 23-Jul-27 15:35 mlrun/package/utils/_supported_format.py
+-rw-r--r--  2.0 unx     3709 b- defN 23-Jul-27 15:35 mlrun/package/utils/log_hint_utils.py
+-rw-r--r--  2.0 unx    14825 b- defN 23-Jul-27 15:35 mlrun/package/utils/type_hint_utils.py
+-rw-r--r--  2.0 unx     2352 b- defN 23-Jul-27 15:35 mlrun/platforms/__init__.py
+-rw-r--r--  2.0 unx    21581 b- defN 23-Jul-27 15:35 mlrun/platforms/iguazio.py
+-rw-r--r--  2.0 unx    11852 b- defN 23-Jul-27 15:35 mlrun/platforms/other.py
+-rw-r--r--  2.0 unx     1153 b- defN 23-Jul-27 15:35 mlrun/projects/__init__.py
+-rw-r--r--  2.0 unx    17602 b- defN 23-Jul-27 15:35 mlrun/projects/operations.py
+-rw-r--r--  2.0 unx    34337 b- defN 23-Jul-27 15:35 mlrun/projects/pipelines.py
+-rw-r--r--  2.0 unx   126661 b- defN 23-Jul-27 15:35 mlrun/projects/project.py
+-rw-r--r--  2.0 unx     7174 b- defN 23-Jul-27 15:35 mlrun/runtimes/__init__.py
+-rw-r--r--  2.0 unx    36681 b- defN 23-Jul-27 15:35 mlrun/runtimes/base.py
+-rw-r--r--  2.0 unx     6689 b- defN 23-Jul-27 15:35 mlrun/runtimes/constants.py
+-rw-r--r--  2.0 unx    22830 b- defN 23-Jul-27 15:35 mlrun/runtimes/daskjob.py
+-rw-r--r--  2.0 unx     9994 b- defN 23-Jul-27 15:35 mlrun/runtimes/funcdoc.py
+-rw-r--r--  2.0 unx    45208 b- defN 23-Jul-27 15:35 mlrun/runtimes/function.py
+-rw-r--r--  2.0 unx     4911 b- defN 23-Jul-27 15:35 mlrun/runtimes/function_reference.py
+-rw-r--r--  2.0 unx     6530 b- defN 23-Jul-27 15:35 mlrun/runtimes/generators.py
+-rw-r--r--  2.0 unx    14634 b- defN 23-Jul-27 15:35 mlrun/runtimes/kubejob.py
+-rw-r--r--  2.0 unx    19579 b- defN 23-Jul-27 15:35 mlrun/runtimes/local.py
+-rw-r--r--  2.0 unx     2877 b- defN 23-Jul-27 15:35 mlrun/runtimes/nuclio.py
+-rw-r--r--  2.0 unx    61396 b- defN 23-Jul-27 15:35 mlrun/runtimes/pod.py
+-rw-r--r--  2.0 unx     7289 b- defN 23-Jul-27 15:35 mlrun/runtimes/remotesparkjob.py
+-rw-r--r--  2.0 unx    30483 b- defN 23-Jul-27 15:35 mlrun/runtimes/serving.py
+-rw-r--r--  2.0 unx    20801 b- defN 23-Jul-27 15:35 mlrun/runtimes/utils.py
+-rw-r--r--  2.0 unx      742 b- defN 23-Jul-27 15:35 mlrun/runtimes/mpijob/__init__.py
+-rw-r--r--  2.0 unx    15147 b- defN 23-Jul-27 15:35 mlrun/runtimes/mpijob/abstract.py
+-rw-r--r--  2.0 unx    10916 b- defN 23-Jul-27 15:35 mlrun/runtimes/mpijob/v1.py
+-rw-r--r--  2.0 unx     5650 b- defN 23-Jul-27 15:35 mlrun/runtimes/mpijob/v1alpha1.py
+-rw-r--r--  2.0 unx      709 b- defN 23-Jul-27 15:35 mlrun/runtimes/sparkjob/__init__.py
+-rw-r--r--  2.0 unx    30404 b- defN 23-Jul-27 15:35 mlrun/runtimes/sparkjob/abstract.py
+-rw-r--r--  2.0 unx    28746 b- defN 23-Jul-27 15:35 mlrun/runtimes/sparkjob/spark3job.py
+-rw-r--r--  2.0 unx     1078 b- defN 23-Jul-27 15:35 mlrun/serving/__init__.py
+-rw-r--r--  2.0 unx     6116 b- defN 23-Jul-27 15:35 mlrun/serving/merger.py
+-rw-r--r--  2.0 unx    18038 b- defN 23-Jul-27 15:35 mlrun/serving/remote.py
+-rw-r--r--  2.0 unx    55318 b- defN 23-Jul-27 15:35 mlrun/serving/routers.py
+-rw-r--r--  2.0 unx    20439 b- defN 23-Jul-27 15:35 mlrun/serving/server.py
+-rw-r--r--  2.0 unx      836 b- defN 23-Jul-27 15:35 mlrun/serving/serving_wrapper.py
+-rw-r--r--  2.0 unx    54288 b- defN 23-Jul-27 15:35 mlrun/serving/states.py
+-rw-r--r--  2.0 unx     3902 b- defN 23-Jul-27 15:35 mlrun/serving/utils.py
+-rw-r--r--  2.0 unx    11814 b- defN 23-Jul-27 15:35 mlrun/serving/v1_serving.py
+-rw-r--r--  2.0 unx    21823 b- defN 23-Jul-27 15:35 mlrun/serving/v2_serving.py
+-rw-r--r--  2.0 unx      826 b- defN 23-Jul-27 15:35 mlrun/utils/__init__.py
+-rw-r--r--  2.0 unx    10636 b- defN 23-Jul-27 15:35 mlrun/utils/async_http.py
+-rw-r--r--  2.0 unx     3456 b- defN 23-Jul-27 15:35 mlrun/utils/azure_vault.py
+-rw-r--r--  2.0 unx     6245 b- defN 23-Jul-27 15:35 mlrun/utils/clones.py
+-rw-r--r--  2.0 unx     1920 b- defN 23-Jul-27 15:35 mlrun/utils/condition_evaluator.py
+-rw-r--r--  2.0 unx     1662 b- defN 23-Jul-27 15:35 mlrun/utils/db.py
+-rw-r--r--  2.0 unx    47314 b- defN 23-Jul-27 15:35 mlrun/utils/helpers.py
+-rw-r--r--  2.0 unx     8241 b- defN 23-Jul-27 15:35 mlrun/utils/http.py
+-rw-r--r--  2.0 unx     7035 b- defN 23-Jul-27 15:35 mlrun/utils/logger.py
+-rw-r--r--  2.0 unx     4430 b- defN 23-Jul-27 15:35 mlrun/utils/regex.py
+-rw-r--r--  2.0 unx      883 b- defN 23-Jul-27 15:35 mlrun/utils/singleton.py
+-rw-r--r--  2.0 unx     1319 b- defN 23-Jul-27 15:35 mlrun/utils/v3io_clients.py
+-rw-r--r--  2.0 unx    10447 b- defN 23-Jul-27 15:35 mlrun/utils/vault.py
+-rw-r--r--  2.0 unx      990 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/__init__.py
+-rw-r--r--  2.0 unx    19251 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/notification_pusher.py
+-rw-r--r--  2.0 unx     2113 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/notification/__init__.py
+-rw-r--r--  2.0 unx     2293 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/notification/base.py
+-rw-r--r--  2.0 unx     1971 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/notification/console.py
+-rw-r--r--  2.0 unx     5221 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/notification/git.py
+-rw-r--r--  2.0 unx     1962 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/notification/ipython.py
+-rw-r--r--  2.0 unx     3898 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/notification/slack.py
+-rw-r--r--  2.0 unx     1865 b- defN 23-Jul-27 15:35 mlrun/utils/notifications/notification/webhook.py
+-rw-r--r--  2.0 unx      614 b- defN 23-Jul-27 15:35 mlrun/utils/version/__init__.py
+-rw-r--r--  2.0 unx       88 b- defN 23-Jul-27 15:35 mlrun/utils/version/version.json
+-rw-r--r--  2.0 unx     1970 b- defN 23-Jul-27 15:35 mlrun/utils/version/version.py
+-rw-r--r--  2.0 unx    11357 b- defN 23-Jul-27 15:35 mlrun-1.5.0rc2.dist-info/LICENSE
+-rw-r--r--  2.0 unx    17062 b- defN 23-Jul-27 15:35 mlrun-1.5.0rc2.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-27 15:35 mlrun-1.5.0rc2.dist-info/WHEEL
+-rw-r--r--  2.0 unx       47 b- defN 23-Jul-27 15:35 mlrun-1.5.0rc2.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-Jul-27 15:35 mlrun-1.5.0rc2.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx    42827 b- defN 23-Jul-27 15:35 mlrun-1.5.0rc2.dist-info/RECORD
+456 files, 4808627 bytes uncompressed, 1223992 bytes compressed:  74.6%
```

## zipnote {}

```diff
@@ -138,14 +138,17 @@
 
 Filename: mlrun/api/api/endpoints/submit.py
 Comment: 
 
 Filename: mlrun/api/api/endpoints/tags.py
 Comment: 
 
+Filename: mlrun/api/api/endpoints/workflows.py
+Comment: 
+
 Filename: mlrun/api/api/endpoints/internal/__init__.py
 Comment: 
 
 Filename: mlrun/api/api/endpoints/internal/config.py
 Comment: 
 
 Filename: mlrun/api/api/endpoints/internal/memory_reports.py
@@ -192,14 +195,17 @@
 
 Filename: mlrun/api/crud/secrets.py
 Comment: 
 
 Filename: mlrun/api/crud/tags.py
 Comment: 
 
+Filename: mlrun/api/crud/workflows.py
+Comment: 
+
 Filename: mlrun/api/crud/model_monitoring/__init__.py
 Comment: 
 
 Filename: mlrun/api/crud/model_monitoring/deployment.py
 Comment: 
 
 Filename: mlrun/api/crud/model_monitoring/grafana.py
@@ -342,14 +348,41 @@
 
 Filename: mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py
 Comment: 
 
 Filename: mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py
 Comment: 
 
+Filename: mlrun/api/rundb/__init__.py
+Comment: 
+
+Filename: mlrun/api/rundb/sqldb.py
+Comment: 
+
+Filename: mlrun/api/runtime_handlers/__init__.py
+Comment: 
+
+Filename: mlrun/api/runtime_handlers/base.py
+Comment: 
+
+Filename: mlrun/api/runtime_handlers/daskjob.py
+Comment: 
+
+Filename: mlrun/api/runtime_handlers/kubejob.py
+Comment: 
+
+Filename: mlrun/api/runtime_handlers/mpijob.py
+Comment: 
+
+Filename: mlrun/api/runtime_handlers/remotesparkjob.py
+Comment: 
+
+Filename: mlrun/api/runtime_handlers/sparkjob.py
+Comment: 
+
 Filename: mlrun/api/schemas/__init__.py
 Comment: 
 
 Filename: mlrun/api/utils/__init__.py
 Comment: 
 
 Filename: mlrun/api/utils/asyncio.py
@@ -609,14 +642,17 @@
 
 Filename: mlrun/common/schemas/secret.py
 Comment: 
 
 Filename: mlrun/common/schemas/tag.py
 Comment: 
 
+Filename: mlrun/common/schemas/workflow.py
+Comment: 
+
 Filename: mlrun/common/schemas/model_monitoring/__init__.py
 Comment: 
 
 Filename: mlrun/common/schemas/model_monitoring/constants.py
 Comment: 
 
 Filename: mlrun/common/schemas/model_monitoring/grafana.py
@@ -696,21 +732,21 @@
 
 Filename: mlrun/db/__init__.py
 Comment: 
 
 Filename: mlrun/db/base.py
 Comment: 
 
-Filename: mlrun/db/httpdb.py
+Filename: mlrun/db/factory.py
 Comment: 
 
-Filename: mlrun/db/nopdb.py
+Filename: mlrun/db/httpdb.py
 Comment: 
 
-Filename: mlrun/db/sqldb.py
+Filename: mlrun/db/nopdb.py
 Comment: 
 
 Filename: mlrun/feature_store/__init__.py
 Comment: 
 
 Filename: mlrun/feature_store/api.py
 Comment: 
@@ -1017,26 +1053,14 @@
 
 Filename: mlrun/launcher/local.py
 Comment: 
 
 Filename: mlrun/launcher/remote.py
 Comment: 
 
-Filename: mlrun/mlutils/__init__.py
-Comment: 
-
-Filename: mlrun/mlutils/data.py
-Comment: 
-
-Filename: mlrun/mlutils/models.py
-Comment: 
-
-Filename: mlrun/mlutils/plots.py
-Comment: 
-
 Filename: mlrun/model_monitoring/__init__.py
 Comment: 
 
 Filename: mlrun/model_monitoring/features_drift_table.py
 Comment: 
 
 Filename: mlrun/model_monitoring/helpers.py
@@ -1044,14 +1068,17 @@
 
 Filename: mlrun/model_monitoring/model_endpoint.py
 Comment: 
 
 Filename: mlrun/model_monitoring/model_monitoring_batch.py
 Comment: 
 
+Filename: mlrun/model_monitoring/prometheus.py
+Comment: 
+
 Filename: mlrun/model_monitoring/stream_processing.py
 Comment: 
 
 Filename: mlrun/model_monitoring/tracking_policy.py
 Comment: 
 
 Filename: mlrun/model_monitoring/stores/__init__.py
@@ -1317,26 +1344,26 @@
 
 Filename: mlrun/utils/version/version.json
 Comment: 
 
 Filename: mlrun/utils/version/version.py
 Comment: 
 
-Filename: mlrun-1.5.0rc1.dist-info/LICENSE
+Filename: mlrun-1.5.0rc2.dist-info/LICENSE
 Comment: 
 
-Filename: mlrun-1.5.0rc1.dist-info/METADATA
+Filename: mlrun-1.5.0rc2.dist-info/METADATA
 Comment: 
 
-Filename: mlrun-1.5.0rc1.dist-info/WHEEL
+Filename: mlrun-1.5.0rc2.dist-info/WHEEL
 Comment: 
 
-Filename: mlrun-1.5.0rc1.dist-info/entry_points.txt
+Filename: mlrun-1.5.0rc2.dist-info/entry_points.txt
 Comment: 
 
-Filename: mlrun-1.5.0rc1.dist-info/top_level.txt
+Filename: mlrun-1.5.0rc2.dist-info/top_level.txt
 Comment: 
 
-Filename: mlrun-1.5.0rc1.dist-info/RECORD
+Filename: mlrun-1.5.0rc2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mlrun/__init__.py

```diff
@@ -32,22 +32,15 @@
 from .config import config as mlconf
 from .datastore import DataItem, store_manager
 from .db import get_run_db
 from .errors import MLRunInvalidArgumentError, MLRunNotFoundError
 from .execution import MLClientCtx
 from .model import RunObject, RunTemplate, new_task
 from .package import ArtifactType, DefaultPackager, Packager, handler
-from .platforms import (
-    VolumeMount,
-    auto_mount,
-    mount_v3io,
-    mount_v3io_extended,
-    mount_v3io_legacy,
-    v3io_cred,
-)
+from .platforms import VolumeMount, auto_mount, mount_v3io, v3io_cred
 from .projects import (
     ProjectMetadata,
     build_function,
     deploy_function,
     get_or_create_project,
     load_project,
     new_project,
@@ -62,15 +55,14 @@
     get_dataitem,
     get_object,
     get_or_create_ctx,
     get_pipeline,
     import_function,
     new_function,
     run_local,
-    run_pipeline,
     wait_for_pipeline_completion,
 )
 from .runtimes import new_model_server
 from .secrets import get_secret_or_env
 from .utils.version import Version
 
 __version__ = Version().get()["version"]
@@ -87,17 +79,15 @@
     environ["KF_PIPELINES_UI_ENDPOINT"] = kfp_ep
     mlconf.remote_host = mlconf.remote_host or igz_domain
 
 
 def set_environment(
     api_path: str = None,
     artifact_path: str = "",
-    project: str = "",
     access_key: str = None,
-    user_project=False,
     username: str = None,
     env_file: str = None,
     mock_functions: str = None,
 ):
     """set and test default config for: api path, artifact_path and project
 
     this function will try and read the configuration from the environment/api
@@ -105,42 +95,30 @@
     it returns the configured artifacts path, this can be used to define sub paths.
 
     Note: the artifact path is an mlrun data uri (e.g. `s3://bucket/path`) and can not be used with file utils.
 
     example::
 
         from os import path
-        project_name, artifact_path = set_environment(project='my-project')
+        project_name, artifact_path = set_environment()
         set_environment("http://localhost:8080", artifact_path="./")
         set_environment(env_file="mlrun.env")
         set_environment("<remote-service-url>", access_key="xyz", username="joe")
 
     :param api_path:       location/url of mlrun api service
     :param artifact_path:  path/url for storing experiment artifacts
-    :param project:        default project name (deprecated in 1.3.0 and will be removed in 1.5.0) - use project
-                           APIs such as `get_or_create_project`, `load_project` to configure the active project
     :param access_key:     set the remote cluster access key (V3IO_ACCESS_KEY)
-    :param user_project:   add the current user name to the provided project name (making it unique per user)
-                           (deprecated in 1.3.0 and will be removed in 1.5.0)
     :param username:       name of the user to authenticate
     :param env_file:       path/url to .env file (holding MLRun config and other env vars), see: set_env_from_file()
     :param mock_functions: set to True to create local/mock functions instead of real containers,
                            set to "auto" to auto determine based on the presence of k8s/Nuclio
     :returns:
         default project name
         actual artifact path/url, can be used to create subpaths per task or group of artifacts
     """
-    if user_project or project:
-        warnings.warn(
-            "'user_project' and 'project' are deprecated in 1.3.0, and will be removed in 1.5.0, use project "
-            "APIs such as 'get_or_create_project', 'load_project' to configure the active project.",
-            # TODO: Remove in 1.5.0
-            FutureWarning,
-        )
-
     if env_file:
         set_env_from_file(env_file)
 
     # set before the dbpath (so it will re-connect with the new credentials)
     if access_key:
         environ["V3IO_ACCESS_KEY"] = access_key
     if username:
@@ -156,25 +134,14 @@
         mlconf.mock_nuclio_deployment = mock_functions
 
     # check connectivity and load remote defaults
     get_run_db()
     if api_path:
         environ["MLRUN_DBPATH"] = mlconf.dbpath
 
-    project = _add_username_to_project_name_if_needed(project, user_project)
-    if project:
-        ProjectMetadata.validate_project_name(project)
-
-    mlconf.default_project = project or mlconf.default_project
-    # We want to ensure the project exists, and verify we're authorized to work on it
-    # if it doesn't exist this will create it (and obviously if we created it, we're authorized to work on it)
-    # if it does exist - this will get it, which will fail if we're not authorized to work on it
-    if project:
-        get_or_create_project(mlconf.default_project, "./")
-
     if not mlconf.artifact_path and not artifact_path:
         raise ValueError(
             "default artifact_path was not configured, please specify a valid artifact_path"
         )
 
     if artifact_path:
         if artifact_path.startswith("./"):
```

## mlrun/__main__.py

```diff
@@ -13,15 +13,14 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import json
 import pathlib
 import socket
 import traceback
-import warnings
 from ast import literal_eval
 from base64 import b64decode, b64encode
 from os import environ, path, remove
 from pprint import pprint
 from subprocess import Popen
 from sys import executable
 from urllib.parse import urlparse
@@ -588,20 +587,14 @@
 @click.option("--source", "-s", default="", help="location/url of the source")
 @click.option(
     "--func-url",
     "-f",
     default="",
     help="path/url of function yaml or function " "yaml or db://<project>/<name>[:tag]",
 )
-@click.option(
-    "--dashboard",
-    "-d",
-    default="",
-    help="Deprecated. Keep empty to allow auto-detect by MLRun API",
-)
 @click.option("--project", "-p", default="", help="project name")
 @click.option("--model", "-m", multiple=True, help="model name and path (name=path)")
 @click.option("--kind", "-k", default=None, help="runtime sub kind")
 @click.option("--tag", default="", help="version tag")
 @click.option("--env", "-e", multiple=True, help="environment variables")
 @click.option("--verbose", is_flag=True, help="verbose log")
 @click.option(
@@ -612,15 +605,14 @@
     is_flag=True,
     help="ensure the project exists, if not, create project",
 )
 def deploy(
     spec,
     source,
     func_url,
-    dashboard,
     project,
     model,
     tag,
     kind,
     env,
     verbose,
     env_file,
@@ -673,24 +665,16 @@
 
     function.spec.source = source
     if env:
         for k, v in list2dict(env).items():
             function.set_env(k, v)
     function.verbose = verbose
 
-    if dashboard:
-        warnings.warn(
-            "'--dashboard' is deprecated in 1.3.0, and will be removed in 1.5.0, "
-            "Keep '--dashboard' value empty to allow auto-detection by MLRun API.",
-            # TODO: Remove in 1.5.0
-            FutureWarning,
-        )
-
     try:
-        addr = function.deploy(dashboard=dashboard, project=project, tag=tag)
+        addr = function.deploy(project=project, tag=tag)
     except Exception as err:
         print(f"deploy error: {err_to_str(err)}")
         exit(1)
 
     print(f"function deployed, address={addr}")
     with open("/tmp/output", "w") as fp:
         fp.write(addr)
@@ -1001,41 +985,28 @@
     type=int,
     default=None,
     help="timeout in seconds to wait for pipeline completion (used when watch=True)",
 )
 @click.option(
     "--env-file", default="", help="path to .env file to load config/variables from"
 )
-# TODO: Remove --ensure-project in 1.5.0
-@click.option(
-    "--ensure-project",
-    is_flag=True,
-    help="ensure the project exists, if not, create project",
-)
 @click.option(
     "--save/--no-save",
     default=True,
     help="create and save the project if not exist",
 )
 @click.option(
     "--schedule",
     type=str,
     default=None,
     help="To create a schedule define a standard crontab expression string."
     "for help see: "
     "https://apscheduler.readthedocs.io/en/3.x/modules/triggers/cron.html#module-apscheduler.triggers.cron."
     "For using the pre-defined workflow's schedule, set --schedule 'true'",
 )
-# TODO: Remove in 1.5.0
-@click.option(
-    "--overwrite-schedule",
-    "-os",
-    is_flag=True,
-    help="Overwrite a schedule when submitting a new one with the same name.",
-)
 @click.option(
     "--save-secrets",
     is_flag=True,
     help="Store the project secrets as k8s secrets",
 )
 @click.option(
     "--notifications",
@@ -1065,32 +1036,23 @@
     git_repo,
     git_issue,
     handler,
     engine,
     local,
     env_file,
     timeout,
-    ensure_project,
     schedule,
     notifications,
-    overwrite_schedule,
     save_secrets,
     save,
 ):
     """load and/or run a project"""
     if env_file:
         mlrun.set_env_from_file(env_file)
 
-    if ensure_project:
-        warnings.warn(
-            "'ensure_project' is deprecated and will be removed in 1.5.0, use 'save' (True by default) instead. ",
-            # TODO: Remove this in 1.5.0
-            FutureWarning,
-        )
-
     if db:
         mlconf.dbpath = db
 
     # set the CLI/GIT parameters in load_project() so they can be used by project setup scripts
     parameters = fill_params(param) if param else {}
     if git_repo:
         parameters["git_repo"] = git_repo
@@ -1165,15 +1127,14 @@
                 watch=watch,
                 dirty=dirty,
                 workflow_handler=handler,
                 engine=engine,
                 local=local,
                 schedule=schedule,
                 timeout=timeout,
-                overwrite=overwrite_schedule,
             )
         except Exception as err:
             print(traceback.format_exc())
             send_workflow_error_notification(run, proj, err)
             exit(1)
 
     elif sync:
```

## mlrun/config.py

```diff
@@ -23,16 +23,16 @@
 
 import base64
 import binascii
 import copy
 import json
 import os
 import typing
-import urllib.parse
 from collections.abc import Mapping
+from datetime import timedelta
 from distutils.util import strtobool
 from os.path import expanduser
 from threading import Lock
 
 import dotenv
 import semver
 import yaml
@@ -145,15 +145,15 @@
     # set to "auto" will use mock of Nuclio if not detected (no nuclio_version)
     "mock_nuclio_deployment": "",
     "background_tasks": {
         # enabled / disabled
         "timeout_mode": "enabled",
         # timeout in seconds to wait for background task to be updated / finished by the worker responsible for the task
         "default_timeouts": {
-            "operations": {"migrations": "3600"},
+            "operations": {"migrations": "3600", "load_project": "60"},
             "runtimes": {"dask": "600"},
         },
     },
     "function": {
         "spec": {
             "image_pull_secret": {"default": None},
             "security_context": {
@@ -413,14 +413,15 @@
         # storage such as the parquet file which is generated from the monitoring stream function for the drift analysis
         "offline_storage_path": "model-endpoints/{kind}",
         # Default http path that points to the monitoring stream nuclio function. Will be used as a stream path
         # when the user is working in CE environment and has not provided any stream path.
         "default_http_sink": "http://nuclio-{project}-model-monitoring-stream.mlrun.svc.cluster.local:8080",
         "batch_processing_function_branch": "master",
         "parquet_batching_max_events": 10000,
+        "parquet_batching_timeout_secs": timedelta(minutes=30).total_seconds(),
         # See mlrun.model_monitoring.stores.ModelEndpointStoreType for available options
         "store_type": "v3io-nosql",
         "endpoint_store_connection": "",
     },
     "secret_stores": {
         "vault": {
             # URLs to access Vault. For example, in a local env (Minikube on Mac) these would be:
@@ -512,15 +513,19 @@
         # not possible to call this "version" because the Config class has a "version" property
         # which returns the version from the version.json file
         "release": "",
     },
     "debug": {
         "expose_internal_api_endpoints": False,
     },
-    "default_workflow_runner_name": "workflow-runner-{}",
+    "workflows": {
+        "default_workflow_runner_name": "workflow-runner-{}",
+        # Default timeout seconds for retrieving workflow id after execution:
+        "timeouts": {"local": 120, "kfp": 30},
+    },
     "log_collector": {
         "address": "localhost:8282",
         # log collection mode can be one of: "sidecar", "legacy", "best-effort"
         # "sidecar" - use the sidecar to collect logs
         # "legacy" - use the legacy log collection method (logs are collected straight from the pod)
         # "best-effort" - use the sidecar, but if for some reason it's not available use the legacy method
         # note that this mode also effects the log querying method as well, meaning if the mode is "best-effort"
@@ -772,15 +777,14 @@
         except ValueError:
             # iguazio version is semver compatible only from 3.2, before that it will be something
             # like 3.0_b177_20210806003728
             semver_compatible_igz_version = config.igz_version.split("_")[0]
             return semver.VersionInfo.parse(f"{semver_compatible_igz_version}.0")
 
     def verify_security_context_enrichment_mode_is_allowed(self):
-
         # TODO: move SecurityContextEnrichmentModes to a different package so that we could use it here without
         #  importing mlrun.api
         if config.function.spec.security_context.enrichment_mode == "disabled":
             return
 
         igz_version = self.get_parsed_igz_version()
         if not igz_version:
@@ -929,44 +933,14 @@
         if value:
             # importing here to avoid circular dependency
             import mlrun.db
 
             # when dbpath is set we want to connect to it which will sync configuration from it to the client
             mlrun.db.get_run_db(value, force_reconnect=True)
 
-    @property
-    def iguazio_api_url(self):
-        """
-        we want to be able to run with old versions of the service who runs the API (which doesn't configure this
-        value) so we're doing best effort to try and resolve it from other configurations
-        TODO: Remove this hack when 0.6.x is old enough
-        """
-        if not self._iguazio_api_url:
-            if self.httpdb.builder.docker_registry and self.igz_version:
-                return self._extract_iguazio_api_from_docker_registry_url()
-        return self._iguazio_api_url
-
-    def _extract_iguazio_api_from_docker_registry_url(self):
-        docker_registry_url = self.httpdb.builder.docker_registry
-        # add schema otherwise parsing go wrong
-        if "://" not in docker_registry_url:
-            docker_registry_url = f"http://{docker_registry_url}"
-        parsed_registry_url = urllib.parse.urlparse(docker_registry_url)
-        registry_hostname = parsed_registry_url.hostname
-        # replace the first domain section (app service name) with dashboard
-        first_dot_index = registry_hostname.find(".")
-        if first_dot_index < 0:
-            # if not found it's not the format we know - can't resolve the api url from the registry url
-            return ""
-        return f"https://dashboard{registry_hostname[first_dot_index:]}"
-
-    @iguazio_api_url.setter
-    def iguazio_api_url(self, value):
-        self._iguazio_api_url = value
-
     def is_api_running_on_k8s(self):
         # determine if the API service is attached to K8s cluster
         # when there is a cluster the .namespace is set
         return bool(mlrun.mlconf.namespace)
 
     def is_nuclio_detected(self):
         # determine is Nuclio service is detected, when the nuclio_version is not set
@@ -1041,14 +1015,48 @@
 
     def is_ce_mode(self) -> bool:
         # True if the setup is in CE environment
         return isinstance(mlrun.mlconf.ce, mlrun.config.Config) and any(
             ver in mlrun.mlconf.ce.mode for ver in ["lite", "full"]
         )
 
+    def get_s3_storage_options(self) -> typing.Dict[str, typing.Any]:
+        """
+        Generate storage options dictionary as required for handling S3 path in fsspec. The model monitoring stream
+        graph uses this method for generating the storage options for S3 parquet target path.
+        :return: A storage options dictionary in which each key-value pair  represents a particular configuration,
+        such as endpoint_url or aws access key.
+        """
+        key = mlrun.get_secret_or_env("AWS_ACCESS_KEY_ID")
+        secret = mlrun.get_secret_or_env("AWS_SECRET_ACCESS_KEY")
+
+        force_non_anonymous = mlrun.get_secret_or_env("S3_NON_ANONYMOUS")
+        profile = mlrun.get_secret_or_env("AWS_PROFILE")
+
+        storage_options = dict(
+            anon=not (force_non_anonymous or (key and secret)),
+            key=key,
+            secret=secret,
+        )
+
+        endpoint_url = mlrun.get_secret_or_env("S3_ENDPOINT_URL")
+        if endpoint_url:
+            client_kwargs = {"endpoint_url": endpoint_url}
+            storage_options["client_kwargs"] = client_kwargs
+
+        if profile:
+            storage_options["profile"] = profile
+
+        return storage_options
+
+    def is_explicit_ack(self) -> bool:
+        return self.httpdb.nuclio.explicit_ack == "enabled" and (
+            not self.nuclio_version or self.nuclio_version >= "1.11.20"
+        )
+
 
 # Global configuration
 config = Config.from_dict(default_config)
 
 
 def _populate(skip_errors=False):
     """Populate configuration from config file (if exists in environment) and
@@ -1088,20 +1096,14 @@
 
         config.update(data, skip_errors=skip_errors)
 
     data = read_env(env)
     if data:
         config.update(data, skip_errors=skip_errors)
 
-    # HACK to enable config property to both have dynamic default and to use the value from dict/env like other
-    # configurations - we just need a key in the dict that is different than the property name, so simply adding prefix
-    # underscore
-    config._cfg["_iguazio_api_url"] = config._cfg["iguazio_api_url"]
-    del config._cfg["iguazio_api_url"]
-
     _validate_config(config)
 
 
 def _validate_config(config):
     try:
         limits_gpu = config.default_function_pod_resources.limits.gpu
         requests_gpu = config.default_function_pod_resources.requests.gpu
```

## mlrun/execution.py

```diff
@@ -1034,16 +1034,18 @@
         if self._rundb:
             self._rundb.store_run(
                 self.to_dict(), self._uid, self.project, iter=self._iteration
             )
 
     def _update_run(self, commit=False, message=""):
         """
-        update the required fields in the run object (using mlrun.utils.helpers.update_in)
-        instead of overwriting existing
+        update the required fields in the run object instead of overwriting existing values with empty ones
+
+        :param commit:  commit the changes to the DB if autocommit is not set or update the tmpfile alone
+        :param message: commit message
         """
         self._merge_tmpfile()
         if commit or self._autocommit:
             self._commit = message
             if self._rundb:
                 self._rundb.update_run(
                     self._get_updates(), self._uid, self.project, iter=self._iteration
```

## mlrun/kfpops.py

```diff
@@ -22,15 +22,14 @@
 from kfp import dsl
 from kubernetes import client as k8s_client
 
 import mlrun
 from mlrun.errors import err_to_str
 
 from .config import config
-from .db import get_or_set_dburl, get_run_db
 from .model import HyperParamOptions, RunSpec
 from .utils import (
     dict_to_yaml,
     gen_md_table,
     get_artifact_target,
     get_in,
     get_workflow_url,
@@ -293,15 +292,15 @@
     if hyper_param_options and isinstance(hyper_param_options, dict):
         hyper_param_options = HyperParamOptions.from_dict(hyper_param_options)
     inputs = {} if inputs is None else inputs
     returns = [] if returns is None else returns
     outputs = [] if outputs is None else outputs
     labels = {} if labels is None else labels
 
-    rundb = rundb or get_or_set_dburl()
+    rundb = rundb or mlrun.db.get_or_set_dburl()
     cmd = [
         "python",
         "-m",
         "mlrun",
         "run",
         "--kfp",
         "--from-env",
@@ -728,28 +727,23 @@
             record["function"] = templates[name].get("function")
             record["run_type"] = templates[name].get("run_type")
         dag[node["id"]] = record
 
     return dag, project, workflow["status"].get("message", "")
 
 
-def format_summary_from_kfp_run(kfp_run, project=None, session=None):
+def format_summary_from_kfp_run(kfp_run, project=None):
     override_project = project if project and project != "*" else None
     dag, project, message = generate_kfp_dag_and_resolve_project(
         kfp_run, override_project
     )
     run_id = get_in(kfp_run, "run.id")
 
     # enrich DAG with mlrun run info
-    if session:
-        runs = mlrun.api.utils.singletons.db.get_db().list_runs(
-            session, project=project, labels=f"workflow={run_id}"
-        )
-    else:
-        runs = get_run_db().list_runs(project=project, labels=f"workflow={run_id}")
+    runs = mlrun.db.get_run_db().list_runs(project=project, labels=f"workflow={run_id}")
 
     for run in runs:
         step = get_in(run, ["metadata", "labels", "mlrun/runner-pod"])
         if step and step in dag:
             dag[step]["run_uid"] = get_in(run, "metadata.uid")
             dag[step]["kind"] = get_in(run, "metadata.labels.kind")
             error = get_in(run, "status.error")
```

## mlrun/lists.py

```diff
@@ -7,15 +7,14 @@
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-import warnings
 from copy import copy
 from typing import List
 
 import pandas as pd
 
 import mlrun
 import mlrun.frameworks
@@ -216,24 +215,14 @@
         if not display:
             return html
 
     def to_objects(self) -> List[Artifact]:
         """return as a list of artifact objects"""
         return [dict_to_artifact(artifact) for artifact in self]
 
-    def objects(self) -> List[Artifact]:
-        """return as a list of artifact objects"""
-        warnings.warn(
-            "'objects' is deprecated in 1.3.0 and will be removed in 1.5.0. "
-            "Use 'to_objects' instead.",
-            # TODO: remove in 1.5.0
-            FutureWarning,
-        )
-        return [dict_to_artifact(artifact) for artifact in self]
-
     def dataitems(self) -> List["mlrun.DataItem"]:
         """return as a list of DataItem objects"""
         dataitems = []
         for item in self:
             artifact = get_artifact_target(item)
             if artifact:
                 dataitems.append(mlrun.get_dataitem(artifact))
```

## mlrun/model.py

```diff
@@ -133,14 +133,16 @@
     def copy(self):
         """create a copy of the object"""
         return deepcopy(self)
 
 
 # model class for building ModelObj dictionaries
 class ObjectDict:
+    kind = "object_dict"
+
     def __init__(self, classes_map, default_kind=""):
         self._children = OrderedDict()
         self._default_kind = default_kind
         self._classes_map = classes_map
 
     def values(self):
         return self._children.values()
@@ -1305,33 +1307,25 @@
         db = mlrun.get_run_db()
         db.list_runs(uid=self.metadata.uid, project=self.metadata.project).show()
 
     def logs(self, watch=True, db=None, offset=0):
         """return or watch on the run logs"""
         if not db:
             db = mlrun.get_run_db()
+
         if not db:
-            print("DB is not configured, cannot show logs")
+            logger.warning("DB is not configured, cannot show logs")
             return None
 
-        new_offset = 0
-        if db.kind == "http":
-            state, new_offset = db.watch_log(
-                self.metadata.uid, self.metadata.project, watch=watch, offset=offset
-            )
-        # not expected to reach this else, as FileDB is not supported any more and because we don't watch logs on API
-        else:
-            state, text = db.get_log(
-                self.metadata.uid, self.metadata.project, offset=offset
-            )
-            if text:
-                print(text.decode())
-
+        state, new_offset = db.watch_log(
+            self.metadata.uid, self.metadata.project, watch=watch, offset=offset
+        )
         if state:
-            print(f"final state: {state}")
+            logger.debug("Run reached terminal state", state=state)
+
         return state, new_offset
 
     def wait_for_completion(
         self,
         sleep=3,
         timeout=0,
         raise_on_failure=True,
```

## mlrun/render.py

```diff
@@ -117,15 +117,15 @@
     :return:                the generated HTML
     """
     if not artifacts:
         return ""
     html = ""
 
     for artifact in artifacts:
-        # TODO: remove this in 1.5.0 once we no longer support legacy format
+        # TODO: remove this in 1.6.0 once we no longer support legacy format
         if mlrun.utils.is_legacy_artifact(artifact):
             attribute_value = artifact.get(attribute_name)
         else:
             attribute_value = artifact["spec"].get(attribute_name)
 
         if mlrun.utils.is_legacy_artifact(artifact):
             key = artifact["key"]
```

## mlrun/run.py

```diff
@@ -15,15 +15,14 @@
 import json
 import os
 import pathlib
 import socket
 import tempfile
 import time
 import uuid
-import warnings
 from base64 import b64decode
 from copy import deepcopy
 from os import environ, makedirs, path
 from pathlib import Path
 from typing import Dict, List, Optional, Tuple, Union
 
 import nuclio
@@ -35,15 +34,14 @@
 import mlrun.errors
 import mlrun.utils.helpers
 from mlrun.kfpops import format_summary_from_kfp_run, show_kfp_run
 
 from .common.helpers import parse_versioned_object_uri
 from .config import config as mlconf
 from .datastore import store_manager
-from .db import get_or_set_dburl, get_run_db
 from .errors import MLRunInvalidArgumentError, MLRunTimeoutError
 from .execution import MLClientCtx
 from .model import BaseMetadata, RunObject, RunTemplate
 from .runtimes import (
     DaskCluster,
     HandlerRuntime,
     KubejobRuntime,
@@ -60,15 +58,14 @@
 from .runtimes.funcdoc import update_function_entry_points
 from .runtimes.serving import serving_subkind
 from .runtimes.utils import add_code_metadata, global_context
 from .utils import (
     extend_hub_uri_if_needed,
     get_in,
     logger,
-    new_pipe_metadata,
     retry_until_successful,
     run_keys,
     update_in,
 )
 
 
 class RunStatuses(object):
@@ -472,15 +469,15 @@
 
     :returns: function object
     """
     is_hub_uri = False
     if url.startswith("db://"):
         url = url[5:]
         _project, name, tag, hash_key = parse_versioned_object_uri(url)
-        db = get_run_db(db or get_or_set_dburl(), secrets=secrets)
+        db = mlrun.db.get_run_db(db or mlrun.db.get_or_set_dburl(), secrets=secrets)
         runtime = db.get_function(name, _project, tag, hash_key)
         if not runtime:
             raise KeyError(f"function {name}:{tag} not found in the DB")
     else:
         url, is_hub_uri = extend_hub_uri_if_needed(url)
         runtime = import_function_to_dict(url, secrets)
     function = new_function(runtime=runtime)
@@ -859,15 +856,15 @@
         handler=handler or "handler",
         kind=subkind,
         ignored_tags=ignored_tags,
     )
     spec["spec"]["env"].append(
         {
             "name": "MLRUN_HTTPDB__NUCLIO__EXPLICIT_ACK",
-            "value": mlrun.mlconf.httpdb.nuclio.explicit_ack == "enabled",
+            "value": mlrun.mlconf.is_explicit_ack(),
         }
     )
     spec_kind = get_in(spec, "kind", "")
     if not kind and spec_kind not in ["", "Function"]:
         kind = spec_kind.lower()
 
         # if its a nuclio subkind, redo nb parsing
@@ -945,133 +942,14 @@
 
     if with_doc:
         update_function_entry_points(r, code)
     r.spec.default_handler = handler
     return r
 
 
-@deprecated(
-    version="1.3.0",
-    reason="'run_pipeline' will be removed in 1.5.0, use 'project.run' instead",
-    category=FutureWarning,
-)
-def run_pipeline(
-    pipeline,
-    arguments=None,
-    project=None,
-    experiment=None,
-    run=None,
-    namespace=None,
-    artifact_path=None,
-    ops=None,
-    url=None,
-    # TODO: deprecated, remove in 1.5.0
-    ttl=None,
-    remote: bool = True,
-    cleanup_ttl=None,
-):
-    """
-    remote KubeFlow pipeline execution
-
-    Submit a workflow task to KFP via mlrun API service
-
-    :param pipeline:   KFP pipeline function or path to .yaml/.zip pipeline file
-    :param arguments:  pipeline arguments
-    :param project:    name of project
-    :param experiment: experiment name
-    :param run:        optional, run name
-    :param namespace:  Kubernetes namespace (if not using default)
-    :param url:        optional, url to mlrun API service
-    :param artifact_path:  target location/url for mlrun artifacts
-    :param ops:        additional operators (.apply() to all pipeline functions)
-    :param ttl:        pipeline cleanup ttl in secs (time to wait after workflow completion, at which point the
-                       workflow and all its resources are deleted) (deprecated, use cleanup_ttl instead)
-    :param remote:     read kfp data from mlrun service (default=True). Run pipeline from local kfp data (remote=False)
-      is deprecated. Should not be used
-    :param cleanup_ttl:
-                       pipeline cleanup ttl in secs (time to wait after workflow completion, at which point the
-                       workflow and all its resources are deleted)
-
-    :returns: kubeflow pipeline id
-    """
-    if ttl:
-        warnings.warn(
-            "'ttl' is deprecated, use 'cleanup_ttl' instead. "
-            "This will be removed in 1.5.0",
-            # TODO: Remove this in 1.5.0
-            FutureWarning,
-        )
-
-    artifact_path = artifact_path or mlconf.artifact_path
-    project = project or mlconf.default_project
-    artifact_path = mlrun.utils.helpers.fill_artifact_path_template(
-        artifact_path, project or mlconf.default_project
-    )
-    if artifact_path and "{{run.uid}}" in artifact_path:
-        artifact_path.replace("{{run.uid}}", "{{workflow.uid}}")
-    if not artifact_path:
-        raise ValueError("artifact path was not specified")
-
-    namespace = namespace or mlconf.namespace
-    arguments = arguments or {}
-
-    if remote or url:
-        from .projects.pipelines import WorkflowSpec, pipeline_context
-
-        clear_pipeline_context = False
-        # if pipeline_context.workflow isn't set it means the `run_pipeline` method was called directly
-        # so to make sure the pipeline and functions inside are being run in the KFP pipeline we set the pipeline
-        # context with KFP engine
-        if not pipeline_context.workflow:
-            workflow_spec = WorkflowSpec(engine="kfp")
-            pipeline_context.set(pipeline_context.project, workflow=workflow_spec)
-            clear_pipeline_context = True
-
-        pipeline_run_id = _run_pipeline(
-            pipeline=pipeline,
-            arguments=arguments,
-            project=project,
-            experiment=experiment,
-            run=run,
-            namespace=namespace,
-            artifact_path=artifact_path,
-            ops=ops,
-            url=url,
-            cleanup_ttl=cleanup_ttl or ttl,
-        )
-
-        if clear_pipeline_context:
-            pipeline_context.clear()
-
-    # this shouldn't be used, keeping for backwards compatibility until the entire method is deprecated
-    else:
-        client = Client(namespace=namespace)
-        if isinstance(pipeline, str):
-            experiment = client.create_experiment(name=experiment)
-            run_result = client.run_pipeline(
-                experiment.id, run, pipeline, params=arguments
-            )
-        else:
-            conf = new_pipe_metadata(
-                artifact_path=artifact_path, cleanup_ttl=ttl, op_transformers=ops
-            )
-            run_result = client.create_run_from_pipeline_func(
-                pipeline,
-                arguments,
-                run_name=run,
-                experiment_name=experiment,
-                pipeline_conf=conf,
-            )
-
-        pipeline_run_id = run_result.run_id
-        logger.info(f"Pipeline run id={id}, check UI for progress")
-
-    return pipeline_run_id
-
-
 def _run_pipeline(
     pipeline,
     arguments=None,
     project=None,
     experiment=None,
     run=None,
     namespace=None,
```

## mlrun/api/launcher.py

```diff
@@ -9,41 +9,48 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 from typing import Dict, List, Optional, Union
 
+from dependency_injector import containers, providers
+
 import mlrun.api.crud
 import mlrun.common.db.sql_session
 import mlrun.common.schemas.schedule
 import mlrun.config
 import mlrun.execution
 import mlrun.launcher.base as launcher
 import mlrun.launcher.factory
 import mlrun.runtimes
 import mlrun.runtimes.generators
 import mlrun.runtimes.utils
 import mlrun.utils
 import mlrun.utils.regex
 
-
-def initialize_launcher():
-    """Set the factory custom launcher to the server side launcher"""
-    mlrun.launcher.factory.LauncherFactory().set_launcher(ServerSideLauncher)
+# must be at the bottom to avoid circular import conflicts and can't use 'from' notation because unit tests mock this
+import mlrun.api.api.utils  # isort:skip
 
 
 class ServerSideLauncher(launcher.BaseLauncher):
-    def __init__(self, local: bool = False, **kwargs):
+    def __init__(
+        self,
+        local: bool = False,
+        auth_info: Optional[mlrun.common.schemas.AuthInfo] = None,
+        **kwargs,
+    ):
         super().__init__(**kwargs)
         if local:
             raise mlrun.errors.MLRunInternalServerError(
                 "Launch of local run inside the server is not allowed"
             )
 
+        self._auth_info = auth_info
+
     def launch(
         self,
         runtime: mlrun.runtimes.BaseRuntime,
         task: Optional[
             Union["mlrun.run.RunTemplate", "mlrun.run.RunObject", dict]
         ] = None,
         handler: Optional[str] = None,
@@ -154,23 +161,29 @@
 
         self._save_notifications(run)
 
         runtime._post_run(result, execution)  # hook for runtime specific cleanup
 
         return self._wrap_run_result(runtime, result, run, err=last_err)
 
-    @staticmethod
     def enrich_runtime(
-        runtime: "mlrun.runtimes.base.BaseRuntime", project_name: Optional[str] = ""
+        self,
+        runtime: "mlrun.runtimes.base.BaseRuntime",
+        project_name: Optional[str] = "",
     ):
         """
         Enrich the runtime object with the project spec and metadata.
         This is done only on the server side, since it's the source of truth for the project, and we want to keep the
         client side enrichment as minimal as possible.
         """
+        if self._auth_info:
+            mlrun.api.api.utils.apply_enrichment_and_validation_on_function(
+                runtime, self._auth_info
+            )
+
         # ensure the runtime has a project before we enrich it with the project's spec
         runtime.metadata.project = (
             project_name
             or runtime.metadata.project
             or mlrun.config.config.default_project
         )
         project = runtime._get_db().get_project(runtime.metadata.project)
@@ -203,7 +216,13 @@
         db = runtime._get_db()
         if db and runtime.kind != "handler":
             struct = runtime.to_dict()
             hash_key = db.store_function(
                 struct, runtime.metadata.name, runtime.metadata.project, versioned=True
             )
             run.spec.function = runtime._function_uri(hash_key=hash_key)
+
+
+# Once this file is imported it will set the container server side launcher
+@containers.override(mlrun.launcher.factory.LauncherContainer)
+class ServerSideLauncherContainer(containers.DeclarativeContainer):
+    server_side_launcher = providers.Factory(ServerSideLauncher)
```

## mlrun/api/main.py

```diff
@@ -32,16 +32,16 @@
 import mlrun.lists
 import mlrun.utils
 import mlrun.utils.notifications
 import mlrun.utils.version
 from mlrun.api.api.api import api_router
 from mlrun.api.db.session import close_session, create_session
 from mlrun.api.initial_data import init_data
-from mlrun.api.launcher import initialize_launcher
 from mlrun.api.middlewares import init_middlewares
+from mlrun.api.runtime_handlers import get_runtime_handler
 from mlrun.api.utils.periodic import (
     cancel_all_periodic_functions,
     cancel_periodic_function,
     run_function_periodically,
 )
 from mlrun.api.utils.singletons.db import get_db, initialize_db
 from mlrun.api.utils.singletons.k8s import get_k8s_helper
@@ -49,15 +49,15 @@
 from mlrun.api.utils.singletons.project_member import (
     get_project_member,
     initialize_project_member,
 )
 from mlrun.api.utils.singletons.scheduler import get_scheduler, initialize_scheduler
 from mlrun.config import config
 from mlrun.errors import err_to_str
-from mlrun.runtimes import RuntimeClassMode, RuntimeKinds, get_runtime_handler
+from mlrun.runtimes import RuntimeClassMode, RuntimeKinds
 from mlrun.utils import logger
 
 API_PREFIX = "/api"
 BASE_VERSIONED_API_PREFIX = f"{API_PREFIX}/v1"
 
 # When pushing notifications, push notifications only for runs that entered a terminal state
 # since the last time we pushed notifications.
@@ -137,15 +137,14 @@
         concurrent.futures.ThreadPoolExecutor(
             max_workers=int(config.httpdb.max_workers)
         )
     )
 
     initialize_logs_dir()
     initialize_db()
-    initialize_launcher()
 
     if (
         config.httpdb.clusterization.worker.sync_with_chief.mode
         == mlrun.common.schemas.WaitForChiefToReachOnlineStateFeatureFlag.enabled
         and config.httpdb.clusterization.role
         == mlrun.common.schemas.ClusterizationRole.worker
     ):
@@ -614,15 +613,15 @@
         )
         for run in runs
     ]
 
     logger.debug(
         "Got terminal runs with configured notifications", runs_amount=len(runs)
     )
-    mlrun.utils.notifications.NotificationPusher(unmasked_runs).push(db)
+    mlrun.utils.notifications.NotificationPusher(unmasked_runs).push()
 
     _last_notification_push_time = now
 
 
 async def _stop_logs():
     """
     Stop logs for runs that are in terminal state and last updated in the previous interval
```

## mlrun/api/api/api.py

```diff
@@ -37,14 +37,15 @@
     projects,
     runs,
     runtime_resources,
     schedules,
     secrets,
     submit,
     tags,
+    workflows,
 )
 
 api_router = APIRouter(dependencies=[Depends(mlrun.api.api.deps.verify_api_state)])
 api_router.include_router(
     artifacts.router,
     tags=["artifacts"],
     dependencies=[Depends(mlrun.api.api.deps.authenticate_request)],
@@ -141,7 +142,12 @@
 )
 
 api_router.include_router(
     internal.internal_router,
     tags=["internal"],
     dependencies=[Depends(mlrun.api.api.deps.authenticate_request)],
 )
+api_router.include_router(
+    workflows.router,
+    tags=["workflows"],
+    dependencies=[Depends(mlrun.api.api.deps.authenticate_request)],
+)
```

## mlrun/api/api/utils.py

```diff
@@ -33,20 +33,20 @@
 import mlrun.api.utils.clients.iguazio
 import mlrun.api.utils.singletons.k8s
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.runtimes.pod
 import mlrun.utils.helpers
 from mlrun.api.db.sqldb.db import SQLDB
+from mlrun.api.rundb.sqldb import SQLRunDB
 from mlrun.api.utils.singletons.db import get_db
 from mlrun.api.utils.singletons.logs_dir import get_logs_dir
 from mlrun.api.utils.singletons.scheduler import get_scheduler
 from mlrun.common.helpers import parse_versioned_object_uri
 from mlrun.config import config
-from mlrun.db.sqldb import SQLDB as SQLRunDB
 from mlrun.errors import err_to_str
 from mlrun.run import import_function, new_function
 from mlrun.runtimes.utils import enrich_function_from_dict
 from mlrun.utils import get_in, logger
 
 
 def log_and_raise(status=HTTPStatus.BAD_REQUEST.value, **kw):
```

## mlrun/api/api/endpoints/feature_store.py

```diff
@@ -404,18 +404,14 @@
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
             mlrun.common.schemas.AuthorizationResourceTypes.function,
             function.metadata.project,
             function.metadata.name,
             mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
-    # Need to override the default rundb since we're in the server.
-    # this is done so further down the flow when running the function created for ingestion we won't access the httpdb
-    # but rather "understand" that we are running on server side and call the DB.
-    await run_in_threadpool(feature_set._override_run_db, db_session)
 
     if ingest_parameters.targets:
         data_targets = [
             DataTargetBase.from_dict(data_target.dict())
             for data_target in ingest_parameters.targets
         ]
```

## mlrun/api/api/endpoints/files.py

```diff
@@ -27,15 +27,21 @@
 from mlrun.datastore import store_manager
 from mlrun.errors import err_to_str
 from mlrun.utils import logger
 
 router = fastapi.APIRouter()
 
 
-@router.get("/files")
+# TODO: Remove in 1.7.0
+@router.get(
+    "/files",
+    deprecated=True,
+    description="'/files' and '/filestat' will be removed in 1.7.0, "
+    "use /projects/{project}/files instead.",
+)
 def get_files(
     schema: str = "",
     objpath: str = fastapi.Query("", alias="path"),
     user: str = "",
     size: int = 0,
     offset: int = 0,
     auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
@@ -69,15 +75,21 @@
         secrets = await _verify_and_get_project_secrets(project, auth_info)
 
     return await run_in_threadpool(
         _get_files, schema, objpath, user, size, offset, auth_info, secrets=secrets
     )
 
 
-@router.get("/filestat")
+# TODO: Remove in 1.7.0
+@router.get(
+    "/filestat",
+    deprecated=True,
+    description="'/files' and '/filestat' will be removed in 1.7.0, "
+    "use /projects/{project}/filestat instead.",
+)
 def get_filestat(
     schema: str = "",
     path: str = "",
     auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     user: str = "",
```

## mlrun/api/api/endpoints/functions.py

```diff
@@ -702,17 +702,22 @@
     except Exception as err:
         logger.error(traceback.format_exc())
         log_and_raise(
             HTTPStatus.BAD_REQUEST.value,
             reason=f"runtime error: {err_to_str(err)}",
         )
     try:
+        # connect to run db
         run_db = get_run_db_instance(db_session)
         fn.set_db_connection(run_db)
-        mlrun.api.launcher.ServerSideLauncher.enrich_runtime(runtime=fn)
+
+        # enrich runtime with project defaults
+        launcher = mlrun.api.launcher.ServerSideLauncher()
+        launcher.enrich_runtime(runtime=fn)
+
         fn.save(versioned=False)
         if fn.kind in RuntimeKinds.nuclio_runtimes():
             mlrun.api.api.utils.apply_enrichment_and_validation_on_function(
                 fn,
                 auth_info,
             )
```

## mlrun/api/api/endpoints/logs.py

```diff
@@ -17,18 +17,25 @@
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.api.deps
 import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
 import mlrun.common.schemas
 
-router = fastapi.APIRouter(prefix="/log/{project}")
+router = fastapi.APIRouter()
 
 
-@router.post("/{uid}")
+# TODO: remove /log/{project}/{uid} in 1.7.0
+@router.post(
+    "/log/{project}/{uid}",
+    deprecated=True,
+    description="/log/{project}/{uid} is deprecated in 1.5.0 and will be removed in 1.7.0, "
+    "use /projects/{project}/logs/{uid} instead",
+)
+@router.post("/projects/{project}/logs/{uid}")
 async def store_log(
     request: fastapi.Request,
     project: str,
     uid: str,
     append: bool = True,
     auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
@@ -48,15 +55,22 @@
         project,
         uid,
         append,
     )
     return {}
 
 
-@router.get("/{uid}")
+# TODO: remove /log/{project}/{uid} in 1.7.0
+@router.get(
+    "/log/{project}/{uid}",
+    deprecated=True,
+    description="/log/{project}/{uid} is deprecated in 1.5.0 and will be removed in 1.7.0, "
+    "use /projects/{project}/logs/{uid} instead",
+)
+@router.get("/projects/{project}/logs/{uid}")
 async def get_log(
     project: str,
     uid: str,
     size: int = -1,
     offset: int = 0,
     auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
```

## mlrun/api/api/endpoints/pipelines.py

```diff
@@ -125,56 +125,52 @@
     namespace: str = Query(config.namespace),
     format_: mlrun.common.schemas.PipelinesFormat = Query(
         mlrun.common.schemas.PipelinesFormat.summary, alias="format"
     ),
     auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
-    db_session: Session = Depends(deps.get_db_session),
 ):
     pipeline = await run_in_threadpool(
         mlrun.api.crud.Pipelines().get_pipeline,
-        db_session,
         run_id,
         project,
         namespace,
         format_,
     )
     if project == "*":
         # In some flows the user may use SDK functions that won't require them to specify the pipeline's project (for
         # backwards compatibility reasons), so the client will just send * in the project, in that case we use the
         # legacy flow in which we first get the pipeline, resolve the project out of it, and only then query permissions
         # we don't use the return value from this function since the user may have asked for a different format than
         # summary which is the one used inside
-        await _get_pipeline_without_project(db_session, auth_info, run_id, namespace)
+        await _get_pipeline_without_project(auth_info, run_id, namespace)
     else:
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
             mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
             project,
             run_id,
             mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     return pipeline
 
 
 async def _get_pipeline_without_project(
-    db_session: Session,
     auth_info: mlrun.common.schemas.AuthInfo,
     run_id: str,
     namespace: str,
 ):
     """
     This function is for when we receive a get pipeline request without the client specifying the project
     So we first get the pipeline, resolve the project out of it, and now that we know the project, we can verify
     permissions
     """
     run = await run_in_threadpool(
         mlrun.api.crud.Pipelines().get_pipeline,
-        db_session,
         run_id,
         namespace=namespace,
         # minimal format that includes the project
         format_=mlrun.common.schemas.PipelinesFormat.summary,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
         mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
```

## mlrun/api/api/endpoints/projects.py

```diff
@@ -16,14 +16,15 @@
 import typing
 
 import fastapi
 import sqlalchemy.orm
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.api.deps
+import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.chief
 import mlrun.common.schemas
 from mlrun.api.utils.singletons.project_member import get_project_member
 from mlrun.utils import logger
 
 router = fastapi.APIRouter()
@@ -319,13 +320,100 @@
             name,
             mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     return project_summary
 
 
+@router.post("/projects/{name}/load")
+async def load_project(
+    name: str,
+    url: str,
+    secrets: mlrun.common.schemas.SecretsData = None,
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
+        mlrun.api.api.deps.authenticate_request
+    ),
+    db_session: sqlalchemy.orm.Session = fastapi.Depends(
+        mlrun.api.api.deps.get_db_session
+    ),
+):
+    """
+    Loading a project remotely from a given source.
+
+    :param name:                project name
+    :param url:                 git or tar.gz or .zip sources archive path e.g.:
+                                git://github.com/mlrun/demo-xgb-project.git
+                                http://mysite/archived-project.zip
+                                The git project should include the project yaml file.
+    :param secrets:             Secrets to store in project in order to load it from the provided url.
+                                For more information see :py:func:`mlrun.load_project` function.
+    :param auth_info:           auth info of the request
+    :param db_session:          session that manages the current dialog with the database
+
+    :returns: a Run object of the load project function
+    """
+
+    project = mlrun.common.schemas.Project(
+        metadata=mlrun.common.schemas.ProjectMetadata(name=name),
+        spec=mlrun.common.schemas.ProjectSpec(source=url),
+    )
+
+    # We must create the project before we run the remote load_project function because
+    # we want this function will be running under the project itself instead of the default project.
+    project, _ = await fastapi.concurrency.run_in_threadpool(
+        get_project_member().create_project,
+        db_session=db_session,
+        project=project,
+        projects_role=auth_info.projects_role,
+        leader_session=auth_info.session,
+    )
+
+    # Storing secrets in project
+    if secrets is not None:
+        await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
+            mlrun.common.schemas.AuthorizationResourceTypes.secret,
+            project.metadata.name,
+            secrets.provider,
+            mlrun.common.schemas.AuthorizationAction.create,
+            auth_info,
+        )
+
+        await run_in_threadpool(
+            mlrun.api.crud.Secrets().store_project_secrets,
+            project.metadata.name,
+            secrets,
+        )
+
+    # Creating the auxiliary function for loading the project:
+    load_project_runner = await fastapi.concurrency.run_in_threadpool(
+        mlrun.api.crud.WorkflowRunners().create_runner,
+        run_name=f"load-{name}",
+        project=name,
+        db_session=db_session,
+        auth_info=auth_info,
+        image=mlrun.mlconf.default_base_image,
+    )
+
+    logger.debug(
+        "Saved function for loading project",
+        project_name=name,
+        function_name=load_project_runner.metadata.name,
+        kind=load_project_runner.kind,
+        source=project.spec.source,
+    )
+
+    run = await fastapi.concurrency.run_in_threadpool(
+        mlrun.api.crud.WorkflowRunners().run,
+        runner=load_project_runner,
+        project=project,
+        workflow_request=None,
+        load_only=True,
+    )
+    return {"data": run.to_dict()}
+
+
 def _is_request_from_leader(
     projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole],
 ) -> bool:
     if projects_role and projects_role.value == mlrun.mlconf.httpdb.projects.leader:
         return True
     return False
```

## mlrun/api/api/endpoints/runs.py

```diff
@@ -27,15 +27,22 @@
 from mlrun.api.api import deps
 from mlrun.api.api.utils import log_and_raise
 from mlrun.utils.helpers import datetime_from_iso
 
 router = APIRouter()
 
 
-@router.post("/run/{project}/{uid}")
+# TODO: remove /run/{project}/{uid} in 1.7.0
+@router.post(
+    "/run/{project}/{uid}",
+    deprecated=True,
+    description="/run/{project}/{uid} is deprecated in 1.5.0 and will be removed in 1.7.0, "
+    "use /projects/{project}/runs/{uid} instead",
+)
+@router.post("/projects/{project}/runs/{uid}")
 async def store_run(
     request: Request,
     project: str,
     uid: str,
     iter: int = 0,
     auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
@@ -66,15 +73,22 @@
         uid,
         iter,
         project,
     )
     return {}
 
 
-@router.patch("/run/{project}/{uid}")
+# TODO: remove /run/{project}/{uid} in 1.7.0
+@router.patch(
+    "/run/{project}/{uid}",
+    deprecated=True,
+    description="/run/{project}/{uid} is deprecated in 1.5.0 and will be removed in 1.7.0, "
+    "use /projects/{project}/runs/{uid} instead",
+)
+@router.patch("/projects/{project}/runs/{uid}")
 async def update_run(
     request: Request,
     project: str,
     uid: str,
     iter: int = 0,
     auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
@@ -99,15 +113,22 @@
         uid,
         iter,
         data,
     )
     return {}
 
 
-@router.get("/run/{project}/{uid}")
+# TODO: remove /run/{project}/{uid} in 1.7.0
+@router.get(
+    "/run/{project}/{uid}",
+    deprecated=True,
+    description="/run/{project}/{uid} is deprecated in 1.5.0 and will be removed in 1.7.0, "
+    "use /projects/{project}/runs/{uid} instead",
+)
+@router.get("/projects/{project}/runs/{uid}")
 async def get_run(
     project: str,
     uid: str,
     iter: int = 0,
     auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
@@ -122,15 +143,22 @@
         auth_info,
     )
     return {
         "data": data,
     }
 
 
-@router.delete("/run/{project}/{uid}")
+# TODO: remove /run/{project}/{uid} in 1.7.0
+@router.delete(
+    "/run/{project}/{uid}",
+    deprecated=True,
+    description="/run/{project}/{uid} is deprecated in 1.5.0 and will be removed in 1.7.0, "
+    "use /projects/{project}/runs/{uid} instead",
+)
+@router.delete("/projects/{project}/runs/{uid}")
 async def delete_run(
     project: str,
     uid: str,
     iter: int = 0,
     auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
@@ -147,15 +175,22 @@
         uid,
         iter,
         project,
     )
     return {}
 
 
-@router.get("/runs")
+# TODO: remove /runs in 1.7.0
+@router.get(
+    "/runs",
+    deprecated=True,
+    description="/runs is deprecated in 1.5.0 and will be removed in 1.7.0, "
+    "use /projects/{project}/runs/{uid} instead",
+)
+@router.get("/projects/{project}/runs")
 async def list_runs(
     project: str = None,
     name: str = None,
     uid: List[str] = Query([]),
     labels: List[str] = Query([], alias="label"),
     state: str = None,
     last: int = 0,
@@ -218,15 +253,22 @@
         auth_info,
     )
     return {
         "runs": filtered_runs,
     }
 
 
-@router.delete("/runs")
+# TODO: remove /runs in 1.7.0
+@router.delete(
+    "/runs",
+    deprecated=True,
+    description="/runs is deprecated in 1.5.0 and will be removed in 1.7.0, "
+    "use /projects/{project}/runs/{uid} instead",
+)
+@router.delete("/projects/{project}/runs")
 async def delete_runs(
     project: str = None,
     name: str = None,
     labels: List[str] = Query([], alias="label"),
     state: str = None,
     days_ago: int = None,
     auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
```

## mlrun/api/crud/__init__.py

```diff
@@ -25,7 +25,8 @@
 from .notifications import Notifications
 from .pipelines import Pipelines
 from .projects import Projects
 from .runs import Runs
 from .runtime_resources import RuntimeResources
 from .secrets import Secrets, SecretsClientType
 from .tags import Tags
+from .workflows import WorkflowRunners
```

## mlrun/api/crud/client_spec.py

```diff
@@ -98,14 +98,17 @@
             # ce_mode is deprecated, we will use the full ce config instead and ce_mode will be removed in 1.6.0
             ce_mode=config.ce.mode,
             ce=config.ce.to_dict(),
             logs=self._get_config_value_if_not_default("httpdb.logs"),
             feature_store_data_prefixes=self._get_config_value_if_not_default(
                 "feature_store.data_prefixes"
             ),
+            model_endpoint_monitoring_store_type=self._get_config_value_if_not_default(
+                "model_endpoint_monitoring.store_type"
+            ),
         )
 
     @staticmethod
     def _resolve_image_by_client_versions(
         image: str, client_version: str = None, client_python_version=None
     ):
         """
```

## mlrun/api/crud/notifications.py

```diff
@@ -30,21 +30,26 @@
 ):
     def store_run_notifications(
         self,
         session: sqlalchemy.orm.Session,
         notification_objects: typing.List[mlrun.model.Notification],
         run_uid: str,
         project: str = None,
+        mask_params: bool = True,
     ):
         project = project or mlrun.mlconf.default_project
-        notification_objects_to_store = (
-            mlrun.api.api.utils.validate_and_mask_notification_list(
-                notification_objects, run_uid, project
+
+        # we don't mask the notification params when it's a status update as they are already masked
+        notification_objects_to_store = notification_objects
+        if mask_params:
+            notification_objects_to_store = (
+                mlrun.api.api.utils.validate_and_mask_notification_list(
+                    notification_objects, run_uid, project
+                )
             )
-        )
 
         mlrun.api.utils.singletons.db.get_db().store_run_notifications(
             session, notification_objects_to_store, run_uid, project
         )
 
     def list_run_notifications(
         self,
```

## mlrun/api/crud/pipelines.py

```diff
@@ -91,15 +91,15 @@
                 or mlrun.common.schemas.PipelinesPagination.default_page_size,
                 sort_by=sort_by,
                 filter=filter_,
             )
             runs = [run.to_dict() for run in response.runs or []]
             total_size = response.total_size
             next_page_token = response.next_page_token
-        runs = self._format_runs(db_session, runs, format_)
+        runs = self._format_runs(runs, format_)
 
         return total_size, next_page_token, runs
 
     def delete_pipelines_runs(self, db_session: sqlalchemy.orm.Session, project: str):
         _, _, project_pipeline_runs = self.list_pipelines(
             db_session=db_session,
             project=project,
@@ -127,15 +127,14 @@
                     pipeline_run_id=pipeline_run["id"],
                     exc_info=exc,
                 )
         logger.debug("Finished deleting pipeline runs", project=project)
 
     def get_pipeline(
         self,
-        db_session: sqlalchemy.orm.Session,
         run_id: str,
         project: typing.Optional[str] = None,
         namespace: typing.Optional[str] = None,
         format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.summary,
     ):
         kfp_client = self.initialize_kfp_client(namespace)
         run = None
@@ -145,17 +144,15 @@
                 run = api_run_detail.to_dict()["run"]
                 if project and project != "*":
                     run_project = self.resolve_project_from_pipeline(run)
                     if run_project != project:
                         raise mlrun.errors.MLRunNotFoundError(
                             f"Pipeline run with id {run_id} is not of project {project}"
                         )
-                run = self._format_run(
-                    db_session, run, format_, api_run_detail.to_dict()
-                )
+                run = self._format_run(run, format_, api_run_detail.to_dict())
         except kfp_server_api.ApiException as exc:
             mlrun.errors.raise_for_status_code(int(exc.status), err_to_str(exc))
         except mlrun.errors.MLRunHTTPStatusError:
             raise
         except Exception as exc:
             raise mlrun.errors.MLRunRuntimeError(
                 f"Failed getting kfp run: {err_to_str(exc)}"
@@ -224,26 +221,24 @@
             raise mlrun.errors.MLRunNotFoundError(
                 "KubeFlow Pipelines is not configured"
             )
         return kfp.Client(host=kfp_url)
 
     def _format_runs(
         self,
-        db_session: sqlalchemy.orm.Session,
         runs: typing.List[dict],
         format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
     ) -> typing.List[dict]:
         formatted_runs = []
         for run in runs:
-            formatted_runs.append(self._format_run(db_session, run, format_))
+            formatted_runs.append(self._format_run(run, format_))
         return formatted_runs
 
     def _format_run(
         self,
-        db_session: sqlalchemy.orm.Session,
         run: dict,
         format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
         api_run_detail: typing.Optional[dict] = None,
     ) -> dict:
         run["project"] = self.resolve_project_from_pipeline(run)
         if format_ == mlrun.common.schemas.PipelinesFormat.full:
             return run
@@ -254,15 +249,15 @@
             return run.get("name")
         elif format_ == mlrun.common.schemas.PipelinesFormat.summary:
             if not api_run_detail:
                 raise mlrun.errors.MLRunRuntimeError(
                     "The full kfp api_run_detail object is needed to generate the summary format"
                 )
             return mlrun.kfpops.format_summary_from_kfp_run(
-                api_run_detail, run["project"], db_session
+                api_run_detail, run["project"]
             )
         else:
             raise NotImplementedError(
                 f"Provided format is not supported. format={format_}"
             )
 
     def _resolve_project_from_command(
```

## mlrun/api/crud/runtime_resources.py

```diff
@@ -14,14 +14,15 @@
 #
 import typing
 
 import mergedeep
 import sqlalchemy.orm
 
 import mlrun.api.api.utils
+import mlrun.api.runtime_handlers
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.db
 import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.runtimes
 import mlrun.utils.singleton
@@ -46,15 +47,15 @@
     ]:
         response = [] if group_by is None else {}
         kinds = mlrun.runtimes.RuntimeKinds.runtime_with_handlers()
         if kind is not None:
             self.validate_runtime_resources_kind(kind)
             kinds = [kind]
         for kind in kinds:
-            runtime_handler = mlrun.runtimes.get_runtime_handler(kind)
+            runtime_handler = mlrun.api.runtime_handlers.get_runtime_handler(kind)
             resources = runtime_handler.list_resources(
                 project, object_id, label_selector, group_by
             )
             if group_by is None:
                 response.append(
                     mlrun.common.schemas.KindRuntimeResources(
                         kind=kind, resources=resources
@@ -84,15 +85,15 @@
             for kind, runtime_resources in kind_runtime_resources_map.items():
                 if project in allowed_projects:
                     runtime_resources_by_kind.setdefault(kind, []).append(
                         runtime_resources
                     )
         runtimes_resources_output = [] if group_by is None else {}
         for kind, runtime_resources_list in runtime_resources_by_kind.items():
-            runtime_handler = mlrun.runtimes.get_runtime_handler(kind)
+            runtime_handler = mlrun.api.runtime_handlers.get_runtime_handler(kind)
             resources = runtime_handler.build_output_from_runtime_resources(
                 runtime_resources_list, group_by
             )
             if group_by is None:
                 runtimes_resources_output.append(
                     mlrun.common.schemas.KindRuntimeResources(
                         kind=kind, resources=resources
@@ -118,15 +119,15 @@
         grace_period: int = mlrun.config.config.runtime_resources_deletion_grace_period,
     ):
         kinds = mlrun.runtimes.RuntimeKinds.runtime_with_handlers()
         if kind is not None:
             self.validate_runtime_resources_kind(kind)
             kinds = [kind]
         for kind in kinds:
-            runtime_handler = mlrun.runtimes.get_runtime_handler(kind)
+            runtime_handler = mlrun.api.runtime_handlers.get_runtime_handler(kind)
             if object_id:
                 runtime_handler.delete_runtime_object_resources(
                     mlrun.api.utils.singletons.db.get_db(),
                     db_session,
                     object_id,
                     label_selector,
                     force,
```

## mlrun/api/crud/secrets.py

```diff
@@ -13,17 +13,19 @@
 # limitations under the License.
 #
 import enum
 import json
 import typing
 import uuid
 
+import mlrun.api
 import mlrun.api.utils.clients.iguazio
 import mlrun.api.utils.events.events_factory as events_factory
 import mlrun.api.utils.singletons.k8s
+import mlrun.common
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 import mlrun.utils.regex
 import mlrun.utils.singleton
 import mlrun.utils.vault
 
@@ -527,7 +529,26 @@
 
     def _is_key_map_project_secret_key(self, key: str) -> bool:
         return key.startswith(self.key_map_secrets_key_prefix)
 
     @staticmethod
     def _generate_uuid() -> str:
         return str(uuid.uuid4())
+
+
+def get_project_secret_provider(project: str) -> typing.Callable:
+    """Implement secret provider for handle the related project secret on the API side.
+
+    :param project: Project name.
+
+    :return: A secret provider function.
+    """
+
+    def secret_provider(key: str):
+        return mlrun.api.crud.secrets.Secrets().get_project_secret(
+            project=project,
+            provider=mlrun.common.schemas.secret.SecretProviderName.kubernetes,
+            allow_secrets_from_k8s=True,
+            secret_key=key,
+        )
+
+    return secret_provider
```

## mlrun/api/crud/model_monitoring/deployment.py

```diff
@@ -24,26 +24,45 @@
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.k8s
 import mlrun.common.schemas.model_monitoring
 import mlrun.model_monitoring.stream_processing
 import mlrun.model_monitoring.tracking_policy
 from mlrun import feature_store as fstore
 from mlrun.api.api import deps
+from mlrun.api.crud.model_monitoring.helpers import Seconds, seconds2minutes
 from mlrun.utils import logger
 
 _MODEL_MONITORING_COMMON_PATH = pathlib.Path(__file__).parents[3] / "model_monitoring"
 _STREAM_PROCESSING_FUNCTION_PATH = (
     _MODEL_MONITORING_COMMON_PATH / "stream_processing.py"
 )
 _MONITORING_BATCH_FUNCTION_PATH = (
     _MODEL_MONITORING_COMMON_PATH / "model_monitoring_batch.py"
 )
 
 
 class MonitoringDeployment:
+    def __init__(
+        self,
+        parquet_batching_max_events: int = mlrun.mlconf.model_endpoint_monitoring.parquet_batching_max_events,
+        max_parquet_save_interval: int = mlrun.mlconf.model_endpoint_monitoring.parquet_batching_timeout_secs,
+    ) -> None:
+        self._parquet_batching_max_events = parquet_batching_max_events
+        self._max_parquet_save_interval = max_parquet_save_interval
+        """
+        Initialize a MonitoringDeployment object, which handles the deployment of both model monitoring stream nuclio
+        function and the scheduled batch drift job.
+
+        :param parquet_batching_max_events: Maximum number of events that will be used for writing the monitoring
+                                            parquet by the monitoring stream function.
+        :param max_parquet_save_interval:   Maximum number of seconds to hold events before they are written to the
+                                            monitoring parquet target. Note that this value will be used to handle the
+                                            offset by the scheduled batch job.
+        """
+
     def deploy_monitoring_functions(
         self,
         project: str,
         model_monitoring_access_key: str,
         db_session: sqlalchemy.orm.Session,
         auth_info: mlrun.common.schemas.AuthInfo,
         tracking_policy: mlrun.model_monitoring.tracking_policy.TrackingPolicy,
@@ -66,24 +85,25 @@
         )
         self.deploy_model_monitoring_batch_processing(
             project=project,
             model_monitoring_access_key=model_monitoring_access_key,
             db_session=db_session,
             auth_info=auth_info,
             tracking_policy=tracking_policy,
+            tracking_offset=Seconds(self._max_parquet_save_interval),
         )
 
     def deploy_model_monitoring_stream_processing(
         self,
         project: str,
         model_monitoring_access_key: str,
         db_session: sqlalchemy.orm.Session,
         auth_info: mlrun.common.schemas.AuthInfo,
         tracking_policy: mlrun.model_monitoring.tracking_policy.TrackingPolicy,
-    ):
+    ) -> None:
         """
         Deploying model monitoring stream real time nuclio function. The goal of this real time function is
         to monitor the log of the data stream. It is triggered when a new log entry is detected.
         It processes the new events into statistics that are then written to statistics databases.
 
         :param project:                     The name of the project.
         :param model_monitoring_access_key: Access key to apply the model monitoring process.
@@ -125,37 +145,42 @@
             project=project,
             model_monitoring_access_key=model_monitoring_access_key,
             tracking_policy=tracking_policy,
             auth_info=auth_info,
             parquet_target=parquet_target,
         )
 
+        # Adding label to the function - will be used to identify the stream pod
+        fn.metadata.labels = {"type": "model-monitoring-stream"}
+
         mlrun.api.api.endpoints.functions._build_function(
             db_session=db_session, auth_info=auth_info, function=fn
         )
 
     def deploy_model_monitoring_batch_processing(
         self,
         project: str,
         model_monitoring_access_key: str,
         db_session: sqlalchemy.orm.Session,
         auth_info: mlrun.common.schemas.AuthInfo,
         tracking_policy: mlrun.model_monitoring.tracking_policy.TrackingPolicy,
+        tracking_offset: Seconds = Seconds(0),
     ):
         """
         Deploying model monitoring batch job. The goal of this job is to identify drift in the data
         based on the latest batch of events. By default, this job is executed on the hour every hour.
         Note that if the monitoring batch job was already deployed then you will have to delete the
         old monitoring batch job before deploying a new one.
 
         :param project:                     The name of the project.
         :param model_monitoring_access_key: Access key to apply the model monitoring process.
         :param db_session:                  A session that manages the current dialog with the database.
         :param auth_info:                   The auth info of the request.
         :param tracking_policy:             Model monitoring configurations.
+        :param tracking_offset:             Offset for the tracking policy (for synchronization with the stream)
         """
 
         logger.info(
             "Checking if model monitoring batch processing function is already deployed",
             project=project,
         )
 
@@ -206,15 +231,16 @@
         task.spec.parameters[
             mlrun.common.schemas.model_monitoring.EventFieldType.BATCH_INTERVALS_DICT
         ] = batch_dict
 
         data = {
             "task": task.to_dict(),
             "schedule": mlrun.api.crud.model_monitoring.helpers.convert_to_cron_string(
-                tracking_policy.default_batch_intervals
+                tracking_policy.default_batch_intervals,
+                minute_delay=seconds2minutes(tracking_offset),
             ),
         }
 
         logger.info(
             "Deploying model monitoring batch processing function", project=project
         )
 
@@ -243,19 +269,22 @@
                                             monitoring stream nuclio function.
 
         :return:                            A function object from a mlrun runtime class
 
         """
 
         # Initialize Stream Processor object
-        stream_processor = mlrun.model_monitoring.stream_processing.EventStreamProcessor(
-            project=project,
-            parquet_batching_max_events=mlrun.mlconf.model_endpoint_monitoring.parquet_batching_max_events,
-            parquet_target=parquet_target,
-            model_monitoring_access_key=model_monitoring_access_key,
+        stream_processor = (
+            mlrun.model_monitoring.stream_processing.EventStreamProcessor(
+                project=project,
+                parquet_batching_max_events=self._parquet_batching_max_events,
+                parquet_batching_timeout_secs=self._max_parquet_save_interval,
+                parquet_target=parquet_target,
+                model_monitoring_access_key=model_monitoring_access_key,
+            )
         )
 
         # Create a new serving function for the streaming process
         function = mlrun.code_to_function(
             name="model-monitoring-stream",
             project=project,
             filename=str(_STREAM_PROCESSING_FUNCTION_PATH),
```

## mlrun/api/crud/model_monitoring/grafana.py

```diff
@@ -145,15 +145,15 @@
     ]
 
     table = mlrun.common.schemas.model_monitoring.grafana.GrafanaTable(columns=columns)
     for endpoint in endpoint_list.endpoints:
         if (
             filter_router
             and endpoint.status.endpoint_type
-            == mlrun.common.model_monitoring.EndpointType.ROUTER
+            == mlrun.common.schemas.model_monitoring.EndpointType.ROUTER
         ):
             continue
         row = [
             endpoint.metadata.uid,
             endpoint.spec.function_uri,
             endpoint.spec.model,
             endpoint.spec.model_class,
```

## mlrun/api/crud/model_monitoring/helpers.py

```diff
@@ -9,24 +9,35 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import json
+import math
 import typing
 
 import sqlalchemy.orm
 
 import mlrun.api
 import mlrun.common
 import mlrun.common.model_monitoring.helpers
 import mlrun.common.schemas.schedule
 import mlrun.errors
 
+Seconds = typing.NewType("Seconds", int)
+Minutes = typing.NewType("Minutes", int)
+
+_SECONDS_IN_MINUTE: Seconds = Seconds(60)
+_MINUTES_IN_HOUR: Minutes = Minutes(60)
+
+
+def seconds2minutes(seconds: Seconds) -> Minutes:
+    return Minutes(math.ceil(seconds / _SECONDS_IN_MINUTE))
+
 
 def get_batching_interval_param(intervals_list: typing.List):
     """Convert each value in the intervals list into a float number. None
     Values will be converted into 0.0.
 
     param intervals_list: A list of values based on the ScheduleCronTrigger expression. Note that at the moment
                           it supports minutes, hours, and days. e.g. [0, '*/1', None] represents on the hour
@@ -43,20 +54,39 @@
             if isinstance(interval, (float, int)) or interval is None
             else float(f"0{interval.partition('/')[-1]}")
             for interval in intervals_list
         ]
     )
 
 
+def _add_minutes_offset(
+    minute: typing.Optional[typing.Union[int, str]],
+    offset: Minutes,
+) -> typing.Optional[typing.Union[int, str]]:
+    """
+    :param minute: the minute specification in the cron schedule, e.g. "0".
+    :param offset: the offset in minutes to add to the cron minute specification.
+    :return: the minute cron with the offset applied (if supported).
+    """
+    if minute and (
+        (isinstance(minute, str) and str.isdigit(minute)) or isinstance(minute, int)
+    ):
+        minute = (int(minute) + offset) % _MINUTES_IN_HOUR
+    return minute
+
+
 def convert_to_cron_string(
     cron_trigger: mlrun.common.schemas.schedule.ScheduleCronTrigger,
-):
+    minute_delay: Minutes = Minutes(0),
+) -> str:
     """Convert the batch interval `ScheduleCronTrigger` into a cron trigger expression"""
     return "{} {} {} * *".format(
-        cron_trigger.minute, cron_trigger.hour, cron_trigger.day
+        _add_minutes_offset(cron_trigger.minute, minute_delay),
+        cron_trigger.hour,
+        cron_trigger.day,
     ).replace("None", "*")
 
 
 def clean_feature_name(feature_name):
     return feature_name.replace(" ", "_").replace("(", "").replace(")", "")
```

## mlrun/api/crud/model_monitoring/model_endpoints.py

```diff
@@ -18,14 +18,16 @@
 import warnings
 
 import sqlalchemy.orm
 
 import mlrun.api.api.utils
 import mlrun.api.crud.model_monitoring.deployment
 import mlrun.api.crud.model_monitoring.helpers
+import mlrun.api.crud.secrets
+import mlrun.api.rundb.sqldb
 import mlrun.artifacts
 import mlrun.common.helpers
 import mlrun.common.schemas.model_monitoring
 import mlrun.feature_store
 from mlrun.model_monitoring.stores import get_model_endpoint_store
 from mlrun.utils import logger
 
@@ -151,14 +153,17 @@
         # If none of the above was supplied, feature names will be assigned on first contact with the model monitoring
         # system
         logger.info("Creating model endpoint", endpoint_id=model_endpoint.metadata.uid)
 
         # Write the new model endpoint
         model_endpoint_store = get_model_endpoint_store(
             project=model_endpoint.metadata.project,
+            secret_provider=mlrun.api.crud.secrets.get_project_secret_provider(
+                project=model_endpoint.metadata.project
+            ),
         )
         model_endpoint_store.write_model_endpoint(endpoint=model_endpoint.flat_dict())
 
         logger.info("Model endpoint created", endpoint_id=model_endpoint.metadata.uid)
 
         return model_endpoint
 
@@ -180,14 +185,17 @@
 
         :return: A patched `ModelEndpoint` object.
         """
 
         # Generate a model endpoint store object and apply the update process
         model_endpoint_store = get_model_endpoint_store(
             project=project,
+            secret_provider=mlrun.api.crud.secrets.get_project_secret_provider(
+                project=project
+            ),
         )
         model_endpoint_store.update_model_endpoint(
             endpoint_id=endpoint_id, attributes=attributes
         )
 
         logger.info("Model endpoint table updated", endpoint_id=endpoint_id)
 
@@ -199,15 +207,15 @@
         return self._convert_into_model_endpoint_object(endpoint=model_endpoint_record)
 
     @staticmethod
     def create_monitoring_feature_set(
         model_endpoint: mlrun.common.schemas.ModelEndpoint,
         model_obj: mlrun.artifacts.ModelArtifact,
         db_session: sqlalchemy.orm.Session,
-        run_db: mlrun.db.sqldb.SQLDB,
+        run_db: mlrun.api.rundb.sqldb.SQLRunDB,
     ):
         """
         Create monitoring feature set with the relevant parquet target.
 
         :param model_endpoint:    An object representing the model endpoint.
         :param model_obj:         An object representing the deployed model.
         :param db_session:        A session that manages the current dialog with the database.
@@ -286,15 +294,14 @@
         feature_set.set_targets(
             [mlrun.datastore.targets.ParquetTarget(path=parquet_path)],
             with_defaults=False,
         )
         driver.update_resource_status("created")
 
         # Save the new feature set
-        feature_set._override_run_db(db_session)
         feature_set.save()
         logger.info(
             "Monitoring feature set created",
             model_endpoint=model_endpoint.spec.model,
             parquet_target=parquet_path,
         )
 
@@ -309,14 +316,17 @@
         Delete the record of a given model endpoint based on endpoint id.
 
         :param project:     The name of the project.
         :param endpoint_id: The id of the endpoint.
         """
         model_endpoint_store = get_model_endpoint_store(
             project=project,
+            secret_provider=mlrun.api.crud.secrets.get_project_secret_provider(
+                project=project
+            ),
         )
 
         model_endpoint_store.delete_model_endpoint(endpoint_id=endpoint_id)
 
         logger.info("Model endpoint table cleared", endpoint_id=endpoint_id)
 
     def get_model_endpoint(
@@ -357,15 +367,19 @@
         logger.info(
             "Getting model endpoint record from DB",
             endpoint_id=endpoint_id,
         )
 
         # Generate a model endpoint store object and get the model endpoint record as a dictionary
         model_endpoint_store = get_model_endpoint_store(
-            project=project, access_key=auth_info.data_session
+            project=project,
+            access_key=auth_info.data_session,
+            secret_provider=mlrun.api.crud.secrets.get_project_secret_provider(
+                project=project
+            ),
         )
 
         model_endpoint_record = model_endpoint_store.get_model_endpoint(
             endpoint_id=endpoint_id,
         )
 
         # Convert to `ModelEndpoint` object
@@ -450,15 +464,19 @@
         )
 
         # Initialize an empty model endpoints list
         endpoint_list = mlrun.common.schemas.ModelEndpointList(endpoints=[])
 
         # Generate a model endpoint store object and get a list of model endpoint dictionaries
         endpoint_store = get_model_endpoint_store(
-            access_key=auth_info.data_session, project=project
+            access_key=auth_info.data_session,
+            project=project,
+            secret_provider=mlrun.api.crud.secrets.get_project_secret_provider(
+                project=project
+            ),
         )
 
         endpoint_dictionary_list = endpoint_store.list_model_endpoints(
             function=function,
             model=model,
             labels=labels,
             top_level=top_level,
@@ -519,15 +537,19 @@
         # We would ideally base on config.v3io_api but can't for backwards compatibility reasons,
         # we're using the igz version heuristic
         if not mlrun.mlconf.igz_version or not mlrun.mlconf.v3io_api:
             return
 
         # Generate a model endpoint store object and get a list of model endpoint dictionaries
         endpoint_store = get_model_endpoint_store(
-            access_key=auth_info.data_session, project=project_name
+            access_key=auth_info.data_session,
+            project=project_name,
+            secret_provider=mlrun.api.crud.secrets.get_project_secret_provider(
+                project=project_name
+            ),
         )
         endpoints = endpoint_store.list_model_endpoints()
 
         # Delete model endpoints resources from databases using the model endpoint store object
         endpoint_store.delete_model_endpoints_resources(endpoints)
 
     @staticmethod
```

## mlrun/api/db/base.py

```diff
@@ -255,28 +255,43 @@
         labels: Dict = None,
         last_run_uri: str = None,
         concurrency_limit: int = None,
         next_run_time: datetime.datetime = None,
     ):
         pass
 
+    def store_schedule(
+        self,
+        session,
+        project: str,
+        name: str,
+        kind: mlrun.common.schemas.ScheduleKinds = None,
+        scheduled_object: Any = None,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger = None,
+        labels: Dict = None,
+        last_run_uri: str = None,
+        concurrency_limit: int = None,
+        next_run_time: datetime = None,
+    ):
+        pass
+
     @abstractmethod
     def list_schedules(
         self,
         session,
         project: str = None,
         name: str = None,
         labels: str = None,
         kind: mlrun.common.schemas.ScheduleKinds = None,
     ) -> List[mlrun.common.schemas.ScheduleRecord]:
         pass
 
     @abstractmethod
     def get_schedule(
-        self, session, project: str, name: str
+        self, session, project: str, name: str, raise_on_not_found: bool = True
     ) -> mlrun.common.schemas.ScheduleRecord:
         pass
 
     @abstractmethod
     def delete_schedule(self, session, project: str, name: str):
         pass
```

## mlrun/api/db/sqldb/db.py

```diff
@@ -1170,14 +1170,71 @@
                         artifact["spec"].get("db_key"),
                         artifact["metadata"].get("tag"),
                     )
                 )
 
         return results
 
+    def store_schedule(
+        self,
+        session: Session,
+        project: str,
+        name: str,
+        kind: mlrun.common.schemas.ScheduleKinds = None,
+        scheduled_object: Any = None,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger = None,
+        labels: Dict = None,
+        last_run_uri: str = None,
+        concurrency_limit: int = None,
+        next_run_time: datetime = None,
+    ) -> typing.Optional[mlrun.common.schemas.ScheduleRecord]:
+        schedule = self.get_schedule(
+            session=session, project=project, name=name, raise_on_not_found=False
+        )
+        schedule_exist = schedule is not None
+
+        if not schedule_exist:
+            schedule = Schedule(
+                project=project,
+                name=name,
+                kind=kind.value,
+                creation_time=datetime.now(timezone.utc),
+                concurrency_limit=concurrency_limit,
+                next_run_time=next_run_time,
+                scheduled_object=scheduled_object,
+                cron_trigger=cron_trigger,
+            )
+            labels = labels or {}
+
+        self._update_schedule_body(
+            schedule=schedule,
+            scheduled_object=scheduled_object,
+            cron_trigger=cron_trigger,
+            labels=labels,
+            last_run_uri=last_run_uri,
+            concurrency_limit=concurrency_limit,
+            next_run_time=next_run_time,
+        )
+
+        logger.debug(
+            "Storing schedule to db",
+            project=project,
+            name=name,
+            kind=kind,
+            cron_trigger=cron_trigger,
+            labels=labels,
+            concurrency_limit=concurrency_limit,
+            scheduled_object=scheduled_object,
+        )
+
+        self._upsert(session, [schedule])
+
+        if schedule_exist:
+            return schedule
+
     def create_schedule(
         self,
         session: Session,
         project: str,
         name: str,
         kind: mlrun.common.schemas.ScheduleKinds,
         scheduled_object: Any,
@@ -1228,14 +1285,45 @@
         labels: Dict = None,
         last_run_uri: str = None,
         concurrency_limit: int = None,
         next_run_time: datetime = None,
     ):
         schedule = self._get_schedule_record(session, project, name)
 
+        self._update_schedule_body(
+            schedule=schedule,
+            scheduled_object=scheduled_object,
+            cron_trigger=cron_trigger,
+            labels=labels,
+            last_run_uri=last_run_uri,
+            concurrency_limit=concurrency_limit,
+            next_run_time=next_run_time,
+        )
+
+        logger.debug(
+            "Updating schedule in db",
+            project=project,
+            name=name,
+            cron_trigger=cron_trigger,
+            labels=labels,
+            concurrency_limit=concurrency_limit,
+            next_run_time=next_run_time,
+        )
+        self._upsert(session, [schedule])
+
+    @staticmethod
+    def _update_schedule_body(
+        schedule: mlrun.common.schemas.ScheduleRecord,
+        scheduled_object: Any = None,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger = None,
+        labels: Dict = None,
+        last_run_uri: str = None,
+        concurrency_limit: int = None,
+        next_run_time: datetime = None,
+    ):
         # explicitly ensure the updated fields are not None, as they can be empty strings/dictionaries etc.
         if scheduled_object is not None:
             schedule.scheduled_object = scheduled_object
 
         if cron_trigger is not None:
             schedule.cron_trigger = cron_trigger
 
@@ -1249,25 +1337,14 @@
             schedule.concurrency_limit = concurrency_limit
 
         if next_run_time is not None:
             # We receive the next_run_time with localized timezone info (e.g +03:00). All the timestamps should be
             # saved in the DB in UTC timezone, therefore we transform next_run_time to UTC as well.
             schedule.next_run_time = next_run_time.astimezone(pytz.utc)
 
-        logger.debug(
-            "Updating schedule in db",
-            project=project,
-            name=name,
-            cron_trigger=cron_trigger,
-            labels=labels,
-            concurrency_limit=concurrency_limit,
-            next_run_time=next_run_time,
-        )
-        self._upsert(session, [schedule])
-
     def list_schedules(
         self,
         session: Session,
         project: str = None,
         name: str = None,
         labels: str = None,
         kind: mlrun.common.schemas.ScheduleKinds = None,
@@ -1282,27 +1359,31 @@
         schedules = [
             self._transform_schedule_record_to_scheme(db_schedule)
             for db_schedule in query
         ]
         return schedules
 
     def get_schedule(
-        self, session: Session, project: str, name: str
-    ) -> mlrun.common.schemas.ScheduleRecord:
+        self, session: Session, project: str, name: str, raise_on_not_found: bool = True
+    ) -> typing.Optional[mlrun.common.schemas.ScheduleRecord]:
         logger.debug("Getting schedule from db", project=project, name=name)
-        schedule_record = self._get_schedule_record(session, project, name)
+        schedule_record = self._get_schedule_record(
+            session, project, name, raise_on_not_found
+        )
+        if not schedule_record:
+            return
         schedule = self._transform_schedule_record_to_scheme(schedule_record)
         return schedule
 
     def _get_schedule_record(
-        self, session: Session, project: str, name: str
+        self, session: Session, project: str, name: str, raise_on_not_found: bool = True
     ) -> mlrun.common.schemas.ScheduleRecord:
         query = self._query(session, Schedule, project=project, name=name)
         schedule_record = query.one_or_none()
-        if not schedule_record:
+        if not schedule_record and raise_on_not_found:
             raise mlrun.errors.MLRunNotFoundError(
                 f"Schedule not found: project={project}, name={name}"
             )
         return schedule_record
 
     def delete_schedule(self, session: Session, project: str, name: str):
         logger.debug("Removing schedule from db", project=project, name=name)
```

## mlrun/api/utils/builder.py

```diff
@@ -416,18 +416,15 @@
     if source_to_copy and (
         not runtime.spec.clone_target_dir
         or not os.path.isabs(runtime.spec.clone_target_dir)
     ):
         # use a temp dir for permissions and set it as the workdir
         tmpdir = tempfile.mkdtemp()
         relative_workdir = runtime.spec.clone_target_dir or ""
-        if relative_workdir.startswith("./"):
-            # TODO: use 'removeprefix' when we drop python 3.7 support
-            # relative_workdir.removeprefix("./")
-            relative_workdir = relative_workdir[2:]
+        relative_workdir = relative_workdir.removeprefix("./")
 
         runtime.spec.clone_target_dir = path.join(tmpdir, "mlrun", relative_workdir)
 
     dock = make_dockerfile(
         base_image,
         commands,
         source=source_to_copy,
```

## mlrun/api/utils/scheduler.py

```diff
@@ -138,22 +138,22 @@
         # We use the schedule labels to keep track of the access-key to use. Note that this is the name of the secret,
         # not the secret value itself. Therefore, it can be kept in a non-secure field.
         labels = self._append_access_key_secret_to_labels(labels, secret_name)
 
         self._enrich_schedule_notifications(project, name, scheduled_object)
 
         get_db().create_schedule(
-            db_session,
-            project,
-            name,
-            kind,
-            scheduled_object,
-            cron_trigger,
-            concurrency_limit,
-            labels,
+            session=db_session,
+            project=project,
+            name=name,
+            kind=kind,
+            scheduled_object=scheduled_object,
+            cron_trigger=cron_trigger,
+            concurrency_limit=concurrency_limit,
+            labels=labels,
         )
         job = self._create_schedule_in_scheduler(
             project,
             name,
             kind,
             scheduled_object,
             cron_trigger,
@@ -213,21 +213,21 @@
         self._ensure_auth_info_has_access_key(auth_info, db_schedule.kind)
         secret_name = self._store_schedule_secrets_using_auth_secret(auth_info)
         labels = self._append_access_key_secret_to_labels(labels, secret_name)
 
         self._enrich_schedule_notifications(project, name, scheduled_object)
 
         get_db().update_schedule(
-            db_session,
-            project,
-            name,
-            scheduled_object,
-            cron_trigger,
-            labels,
-            concurrency_limit,
+            session=db_session,
+            project=project,
+            name=name,
+            scheduled_object=scheduled_object,
+            cron_trigger=cron_trigger,
+            labels=labels,
+            concurrency_limit=concurrency_limit,
         )
         db_schedule = get_db().get_schedule(db_session, project, name)
 
         updated_schedule = self._transform_and_enrich_db_schedule(
             db_session, db_schedule
         )
 
@@ -299,14 +299,97 @@
         logger.debug("Deleting schedules", project=project)
         for schedule in schedules.schedules:
             self._remove_schedule_scheduler_resources(
                 db_session, schedule.project, schedule.name
             )
         get_db().delete_schedules(db_session, project)
 
+    @mlrun.api.utils.helpers.ensure_running_on_chief
+    def store_schedule(
+        self,
+        db_session: Session,
+        auth_info: mlrun.common.schemas.AuthInfo,
+        project: str,
+        name: str,
+        scheduled_object: Union[Dict, Callable] = None,
+        cron_trigger: Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
+        labels: Dict = None,
+        concurrency_limit: int = None,
+        kind: mlrun.common.schemas.ScheduleKinds = None,
+    ):
+        if isinstance(cron_trigger, str):
+            cron_trigger = mlrun.common.schemas.ScheduleCronTrigger.from_crontab(
+                cron_trigger
+            )
+
+        if cron_trigger is not None:
+            self._validate_cron_trigger(cron_trigger)
+
+        logger.debug(
+            "Storing schedule",
+            project=project,
+            name=name,
+            kind=kind,
+            scheduled_object=scheduled_object,
+            cron_trigger=cron_trigger,
+            labels=labels,
+            concurrency_limit=concurrency_limit,
+        )
+
+        if not kind:
+            # TODO: Need to think of a way to not use `get_schedule`
+            #  in this function or in `get_db().store_function()` in this flow
+            #  because we must have kind to ensure that auth info has access key.
+            db_schedule = get_db().get_schedule(
+                db_session, project, name, raise_on_not_found=False
+            )
+            kind = db_schedule.kind
+
+        self._ensure_auth_info_has_access_key(auth_info, kind)
+        secret_name = self._store_schedule_secrets_using_auth_secret(auth_info)
+        labels = self._append_access_key_secret_to_labels(labels, secret_name)
+        self._enrich_schedule_notifications(project, name, scheduled_object)
+
+        db_schedule = get_db().store_schedule(
+            session=db_session,
+            project=project,
+            name=name,
+            kind=kind,
+            scheduled_object=scheduled_object,
+            cron_trigger=cron_trigger,
+            labels=labels,
+            concurrency_limit=concurrency_limit,
+        )
+        if db_schedule:
+            updated_schedule = self._transform_and_enrich_db_schedule(
+                db_session, db_schedule
+            )
+
+            job = self._update_schedule_in_scheduler(
+                project,
+                name,
+                updated_schedule.kind,
+                updated_schedule.scheduled_object,
+                updated_schedule.cron_trigger,
+                updated_schedule.concurrency_limit,
+                auth_info,
+            )
+        else:
+            job = self._create_schedule_in_scheduler(
+                project,
+                name,
+                kind,
+                scheduled_object,
+                cron_trigger,
+                concurrency_limit,
+                auth_info,
+            )
+
+        self.update_schedule_next_run_time(db_session, name, project, job)
+
     def _remove_schedule_scheduler_resources(self, db_session: Session, project, name):
         self._remove_schedule_from_scheduler(project, name)
         # This is kept for backwards compatibility - if schedule was using the "old" format of storing secrets, then
         # this is a good opportunity to remove them. Using the new method we don't remove secrets since they are per
         # access-key and there may be other entities (runtimes, for example) using the same secret.
         self._remove_schedule_secrets(project, name)
         self._remove_schedule_notification_secrets(db_session, project, name)
```

## mlrun/api/utils/clients/chief.py

```diff
@@ -94,14 +94,28 @@
         """
         Schedules are running only on chief
         """
         return await self._proxy_request_to_chief(
             "DELETE", f"projects/{project}/schedules/{name}", request
         )
 
+    async def submit_workflow(
+        self,
+        project: str,
+        name: str,
+        request: fastapi.Request,
+        json: dict,
+    ) -> fastapi.Response:
+        """
+        Workflow schedules are running only on chief
+        """
+        return await self._proxy_request_to_chief(
+            "POST", f"projects/{project}/workflows/{name}/submit", request, json
+        )
+
     async def delete_schedules(
         self, project: str, request: fastapi.Request
     ) -> fastapi.Response:
         """
         Schedules are running only on chief
         """
         return await self._proxy_request_to_chief(
```

## mlrun/api/utils/singletons/db.py

```diff
@@ -8,14 +8,15 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
+import mlrun.db
 from mlrun.api.db.base import DBInterface
 from mlrun.api.db.sqldb.db import SQLDB
 from mlrun.common.db.sql_session import create_session
 from mlrun.config import config
 from mlrun.utils import logger
 
 # TODO: something nicer
@@ -30,13 +31,16 @@
 def initialize_db(override_db=None):
     global db
     if override_db:
         db = override_db
         return
     logger.info("Creating sql db")
     db = SQLDB(config.httpdb.dsn)
+    # set the run db path to the sql db dsn
+    mlrun.db.get_or_set_dburl(config.httpdb.dsn)
+
     db_session = None
     try:
         db_session = create_session()
         db.initialize(db_session)
     finally:
         db_session.close()
```

## mlrun/artifacts/manager.py

```diff
@@ -13,15 +13,14 @@
 # limitations under the License.
 import pathlib
 import typing
 from os.path import isdir
 
 import mlrun.config
 
-from ..db import RunDBInterface
 from ..utils import (
     is_legacy_artifact,
     is_relative_path,
     logger,
     validate_artifact_key_name,
     validate_tag_name,
 )
@@ -107,15 +106,15 @@
 
     return artifact_class.from_dict(struct)
 
 
 class ArtifactManager:
     def __init__(
         self,
-        db: RunDBInterface = None,
+        db: "mlrun.db.RunDBInterface" = None,
         calc_hash=True,
     ):
         self.calc_hash = calc_hash
 
         self.artifact_db = db
         self.input_artifacts = {}
         self.artifacts = {}
```

## mlrun/common/schemas/__init__.py

```diff
@@ -167,7 +167,13 @@
     AuthSecretData,
     SecretKeysData,
     SecretProviderName,
     SecretsData,
     UserSecretCreationRequest,
 )
 from .tag import Tag, TagObjects
+from .workflow import (
+    GetWorkflowResponse,
+    WorkflowRequest,
+    WorkflowResponse,
+    WorkflowSpec,
+)
```

## mlrun/common/schemas/auth.py

```diff
@@ -53,14 +53,15 @@
     background_task = "background-task"
     schedule = "schedule"
     secret = "secret"
     run = "run"
     model_endpoint = "model-endpoint"
     pipeline = "pipeline"
     hub_source = "hub-source"
+    workflow = "workflow"
 
     def to_resource_string(
         self,
         project_name: str,
         resource_name: str,
     ):
         return {
@@ -83,16 +84,18 @@
             AuthorizationResourceTypes.run: "/projects/{project_name}/runs/{resource_name}",
             # runtime resource doesn't have an identifier, we don't need any auth granularity behind project level
             AuthorizationResourceTypes.runtime_resource: "/projects/{project_name}/runtime-resources",
             AuthorizationResourceTypes.model_endpoint: "/projects/{project_name}/model-endpoints/{resource_name}",
             AuthorizationResourceTypes.pipeline: "/projects/{project_name}/pipelines/{resource_name}",
             # Hub sources are not project-scoped, and auth is globally on the sources endpoint.
             # TODO - this was reverted to /marketplace since MLRun needs to be able to run with old igz versions. Once
-            # we only have support for igz versions that support /hub (>=3.5.4), change this to "/hub/sources".
+            #  we only have support for igz versions that support /hub (>=3.5.4), change this to "/hub/sources".
             AuthorizationResourceTypes.hub_source: "/marketplace/sources",
+            # workflow define how to run a pipeline and can be considered as the specification of a pipeline.
+            AuthorizationResourceTypes.workflow: "/projects/{project_name}/workflows/{resource_name}",
         }[self].format(project_name=project_name, resource_name=resource_name)
 
 
 class AuthorizationVerificationInput(pydantic.BaseModel):
     resource: str
     action: AuthorizationAction
```

## mlrun/common/schemas/client_spec.py

```diff
@@ -53,15 +53,15 @@
     preemptible_nodes_tolerations: typing.Optional[str]
     default_preemption_mode: typing.Optional[str]
     force_run_local: typing.Optional[str]
     function: typing.Optional[Function]
     redis_url: typing.Optional[str]
     redis_type: typing.Optional[str]
     sql_url: typing.Optional[str]
-
+    model_endpoint_monitoring_store_type: typing.Optional[str]
     # ce_mode is deprecated, we will use the full ce config instead and ce_mode will be removed in 1.6.0
     ce_mode: typing.Optional[str]
     ce: typing.Optional[dict]
     # not passing them as one object as it possible client user would like to override only one of the params
     calculate_artifact_hash: typing.Optional[str]
     generate_artifact_target_path_from_artifact_hash: typing.Optional[str]
     logs: typing.Optional[dict]
```

## mlrun/common/schemas/project.py

```diff
@@ -80,14 +80,15 @@
     artifact_path: typing.Optional[str] = None
     conda: typing.Optional[str] = None
     source: typing.Optional[str] = None
     subpath: typing.Optional[str] = None
     origin_url: typing.Optional[str] = None
     desired_state: typing.Optional[ProjectDesiredState] = ProjectDesiredState.online
     custom_packagers: typing.Optional[typing.List[typing.Tuple[str, bool]]] = None
+    default_image: typing.Optional[str] = None
 
     class Config:
         extra = pydantic.Extra.allow
 
 
 class Project(pydantic.BaseModel):
     kind: ObjectKind = pydantic.Field(ObjectKind.project, const=True)
```

## mlrun/common/schemas/runs.py

```diff
@@ -10,21 +10,14 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import typing
 
-# TODO: When we remove support for python 3.7, we can use Literal from the typing package.
-#       Remove the following try/except block with import from typing_extensions.
-try:
-    from typing import Literal
-except ImportError:
-    from typing_extensions import Literal
-
 import pydantic
 
 
 class RunIdentifier(pydantic.BaseModel):
-    kind: Literal["run"] = "run"
+    kind: typing.Literal["run"] = "run"
     uid: typing.Optional[str]
     iter: typing.Optional[int]
```

## mlrun/common/schemas/schedule.py

```diff
@@ -9,22 +9,15 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 from datetime import datetime
-from typing import Any, List, Optional, Union
-
-# TODO: When we remove support for python 3.7, we can use Literal from the typing package.
-#       Remove the following try/except block with import from typing_extensions.
-try:
-    from typing import Literal
-except ImportError:
-    from typing_extensions import Literal
+from typing import Any, List, Literal, Optional, Union
 
 from pydantic import BaseModel
 
 import mlrun.common.types
 from mlrun.common.schemas.auth import Credentials
 from mlrun.common.schemas.object import LabelRecord
```

## mlrun/common/schemas/model_monitoring/__init__.py

```diff
@@ -21,14 +21,15 @@
     EventKeyMetrics,
     EventLiveStats,
     FileTargetKind,
     FunctionURI,
     ModelMonitoringMode,
     ModelMonitoringStoreKinds,
     ProjectSecretKeys,
+    PrometheusMetric,
     TimeSeriesTarget,
     VersionedModel,
 )
 from .grafana import (
     GrafanaColumn,
     GrafanaDataPoint,
     GrafanaNumberColumn,
```

## mlrun/common/schemas/model_monitoring/constants.py

```diff
@@ -45,14 +45,15 @@
     PREDICTION = "prediction"
     PREDICTIONS = "predictions"
     NAMED_PREDICTIONS = "named_predictions"
     ERROR_COUNT = "error_count"
     ENTITIES = "entities"
     FIRST_REQUEST = "first_request"
     LAST_REQUEST = "last_request"
+    METRIC = "metric"
     METRICS = "metrics"
     TIME_FORMAT = "%Y-%m-%d %H:%M:%S.%f"
     BATCH_INTERVALS_DICT = "batch_intervals_dict"
     DEFAULT_BATCH_INTERVALS = "default_batch_intervals"
     MINUTES = "minutes"
     HOURS = "hours"
     DAYS = "days"
@@ -67,14 +68,15 @@
     CHILDREN = "children"
     CHILDREN_UIDS = "children_uids"
     DRIFT_MEASURES = "drift_measures"
     DRIFT_STATUS = "drift_status"
     MONITOR_CONFIGURATION = "monitor_configuration"
     FEATURE_SET_URI = "monitoring_feature_set_uri"
     ALGORITHM = "algorithm"
+    VALUE = "value"
 
 
 class EventLiveStats:
     LATENCY_AVG_5M = "latency_avg_5m"
     LATENCY_AVG_1H = "latency_avg_1h"
     PREDICTIONS_PER_SECOND = "predictions_per_second"
     PREDICTIONS_COUNT_5M = "predictions_count_5m"
@@ -125,14 +127,23 @@
 
 class EndpointType(enum.IntEnum):
     NODE_EP = 1  # end point that is not a child of a router
     ROUTER = 2  # endpoint that is router
     LEAF_EP = 3  # end point that is a child of a router
 
 
+class PrometheusMetric:
+    PREDICTIONS_TOTAL = "predictions_total"
+    MODEL_LATENCY_SECONDS = "model_latency_seconds"
+    INCOME_FEATURES = "income_features"
+    ERRORS_TOTAL = "errors_total"
+    DRIFT_METRICS = "drift_metrics"
+    DRIFT_STATUS = "drift_status"
+
+
 @dataclass
 class FunctionURI:
     project: str
     function: str
     tag: Optional[str] = None
     hash_key: Optional[str] = None
```

## mlrun/datastore/sources.py

```diff
@@ -789,15 +789,15 @@
         )
         source_args = self.attributes.get("source_args", {})
 
         src_class = source_class(
             context=context,
             key_field=self.key_field,
             full_event=True,
-            explicit_ack=mlrun.mlconf.httpdb.nuclio.explicit_ack == "enabled",
+            explicit_ack=mlrun.mlconf.is_explicit_ack(),
             **source_args,
         )
 
         return src_class
 
     def add_nuclio_trigger(self, function):
         raise mlrun.errors.MLRunInvalidArgumentError(
```

## mlrun/db/__init__.py

```diff
@@ -8,90 +8,26 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 from os import environ
-from urllib.parse import urlparse
 
 from ..config import config
-from ..platforms import add_or_refresh_credentials
-from ..utils import logger
 from .base import RunDBError, RunDBInterface  # noqa
-from .nopdb import NopDB
-from .sqldb import SQLDB
 
 
 def get_or_set_dburl(default=""):
     if not config.dbpath and default:
         config.dbpath = default
         environ["MLRUN_DBPATH"] = default
     return config.dbpath
 
 
-def get_httpdb_kwargs(host, username, password):
-    username = username or config.httpdb.user
-    password = password or config.httpdb.password
-
-    username, password, token = add_or_refresh_credentials(
-        host, username, password, config.httpdb.token
-    )
-
-    return {
-        "user": username,
-        "password": password,
-        "token": token,
-    }
-
-
-_run_db = None
-_last_db_url = None
-
-
 def get_run_db(url="", secrets=None, force_reconnect=False):
     """Returns the runtime database"""
-    global _run_db, _last_db_url
-
-    if not url:
-        url = get_or_set_dburl("./")
+    # import here to avoid circular import
+    import mlrun.db.factory
 
-    if (
-        _last_db_url is not None
-        and url == _last_db_url
-        and _run_db
-        and not force_reconnect
-    ):
-        return _run_db
-    _last_db_url = url
-
-    parsed_url = urlparse(url)
-    scheme = parsed_url.scheme.lower()
-    kwargs = {}
-    if "://" not in str(url) or scheme in ["file", "s3", "v3io", "v3ios"]:
-        logger.warning(
-            "Could not detect path to API server, not connected to API server!"
-        )
-        logger.warning(
-            "MLRUN_DBPATH is not set. Set this environment variable to the URL of the API server"
-            " in order to connect"
-        )
-        cls = NopDB
-
-    elif scheme in ("http", "https"):
-        # import here to avoid circular imports
-        from .httpdb import HTTPRunDB
-
-        cls = HTTPRunDB
-        kwargs = get_httpdb_kwargs(
-            parsed_url.hostname, parsed_url.username, parsed_url.password
-        )
-        endpoint = parsed_url.hostname
-        if parsed_url.port:
-            endpoint += f":{parsed_url.port}"
-        url = f"{parsed_url.scheme}://{endpoint}{parsed_url.path}"
-    else:
-        cls = SQLDB
-
-    _run_db = cls(url, **kwargs)
-    _run_db.connect(secrets=secrets)
-    return _run_db
+    run_db_factory = mlrun.db.factory.RunDBFactory()
+    return run_db_factory.create_run_db(url, secrets, force_reconnect)
```

## mlrun/db/base.py

```diff
@@ -617,7 +617,19 @@
     def set_run_notifications(
         self,
         project: str,
         runs: typing.List[mlrun.model.RunObject],
         notifications: typing.List[mlrun.model.Notification],
     ):
         pass
+
+    def store_run_notifications(
+        self,
+        notification_objects: typing.List[mlrun.model.Notification],
+        run_uid: str,
+        project: str = None,
+        mask_params: bool = True,
+    ):
+        pass
+
+    def watch_log(self, uid, project="", watch=True, offset=0):
+        pass
```

## mlrun/db/httpdb.py

```diff
@@ -35,8336 +35,8694 @@
 00000220: 7469 6f6e 7320 756e 6465 7220 7468 6520  tions under the 
 00000230: 4c69 6365 6e73 652e 0a69 6d70 6f72 7420  License..import 
 00000240: 656e 756d 0a69 6d70 6f72 7420 6874 7470  enum.import http
 00000250: 0a69 6d70 6f72 7420 7265 0a69 6d70 6f72  .import re.impor
 00000260: 7420 7465 6d70 6669 6c65 0a69 6d70 6f72  t tempfile.impor
 00000270: 7420 7469 6d65 0a69 6d70 6f72 7420 7472  t time.import tr
 00000280: 6163 6562 6163 6b0a 696d 706f 7274 2074  aceback.import t
-00000290: 7970 696e 670a 696d 706f 7274 2077 6172  yping.import war
-000002a0: 6e69 6e67 730a 6672 6f6d 2064 6174 6574  nings.from datet
-000002b0: 696d 6520 696d 706f 7274 2064 6174 6574  ime import datet
-000002c0: 696d 650a 6672 6f6d 206f 7320 696d 706f  ime.from os impo
-000002d0: 7274 2070 6174 682c 2072 656d 6f76 650a  rt path, remove.
-000002e0: 6672 6f6d 2074 7970 696e 6720 696d 706f  from typing impo
-000002f0: 7274 2044 6963 742c 204c 6973 742c 204f  rt Dict, List, O
-00000300: 7074 696f 6e61 6c2c 2055 6e69 6f6e 0a0a  ptional, Union..
-00000310: 696d 706f 7274 206b 6670 0a69 6d70 6f72  import kfp.impor
-00000320: 7420 7265 7175 6573 7473 0a69 6d70 6f72  t requests.impor
-00000330: 7420 7365 6d76 6572 0a0a 696d 706f 7274  t semver..import
-00000340: 206d 6c72 756e 0a69 6d70 6f72 7420 6d6c   mlrun.import ml
-00000350: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-00000360: 6173 0a69 6d70 6f72 7420 6d6c 7275 6e2e  as.import mlrun.
-00000370: 6d6f 6465 6c5f 6d6f 6e69 746f 7269 6e67  model_monitoring
-00000380: 2e6d 6f64 656c 5f65 6e64 706f 696e 740a  .model_endpoint.
-00000390: 696d 706f 7274 206d 6c72 756e 2e70 726f  import mlrun.pro
-000003a0: 6a65 6374 730a 6672 6f6d 206d 6c72 756e  jects.from mlrun
-000003b0: 2e65 7272 6f72 7320 696d 706f 7274 204d  .errors import M
-000003c0: 4c52 756e 496e 7661 6c69 6441 7267 756d  LRunInvalidArgum
-000003d0: 656e 7445 7272 6f72 2c20 6572 725f 746f  entError, err_to
-000003e0: 5f73 7472 0a0a 6672 6f6d 202e 2e61 7274  _str..from ..art
-000003f0: 6966 6163 7473 2069 6d70 6f72 7420 4172  ifacts import Ar
-00000400: 7469 6661 6374 0a66 726f 6d20 2e2e 636f  tifact.from ..co
-00000410: 6e66 6967 2069 6d70 6f72 7420 636f 6e66  nfig import conf
-00000420: 6967 0a66 726f 6d20 2e2e 6665 6174 7572  ig.from ..featur
-00000430: 655f 7374 6f72 6520 696d 706f 7274 2046  e_store import F
-00000440: 6561 7475 7265 5365 742c 2046 6561 7475  eatureSet, Featu
-00000450: 7265 5665 6374 6f72 0a66 726f 6d20 2e2e  reVector.from ..
-00000460: 6c69 7374 7320 696d 706f 7274 2041 7274  lists import Art
-00000470: 6966 6163 744c 6973 742c 2052 756e 4c69  ifactList, RunLi
-00000480: 7374 0a66 726f 6d20 2e2e 7275 6e74 696d  st.from ..runtim
-00000490: 6573 2069 6d70 6f72 7420 4261 7365 5275  es import BaseRu
-000004a0: 6e74 696d 650a 6672 6f6d 202e 2e75 7469  ntime.from ..uti
-000004b0: 6c73 2069 6d70 6f72 7420 280a 2020 2020  ls import (.    
-000004c0: 6461 7465 7469 6d65 5f74 6f5f 6973 6f2c  datetime_to_iso,
-000004d0: 0a20 2020 2064 6963 745f 746f 5f6a 736f  .    dict_to_jso
-000004e0: 6e2c 0a20 2020 206c 6f67 6765 722c 0a20  n,.    logger,. 
-000004f0: 2020 206e 6577 5f70 6970 655f 6d65 7461     new_pipe_meta
-00000500: 6461 7461 2c0a 2020 2020 6e6f 726d 616c  data,.    normal
-00000510: 697a 655f 6e61 6d65 2c0a 2020 2020 7665  ize_name,.    ve
-00000520: 7273 696f 6e2c 0a29 0a66 726f 6d20 2e62  rsion,.).from .b
-00000530: 6173 6520 696d 706f 7274 2052 756e 4442  ase import RunDB
-00000540: 4572 726f 722c 2052 756e 4442 496e 7465  Error, RunDBInte
-00000550: 7266 6163 650a 0a5f 6172 7469 6661 6374  rface.._artifact
-00000560: 5f6b 6579 7320 3d20 5b0a 2020 2020 2266  _keys = [.    "f
-00000570: 6f72 6d61 7422 2c0a 2020 2020 2269 6e6c  ormat",.    "inl
-00000580: 696e 6522 2c0a 2020 2020 226b 6579 222c  ine",.    "key",
-00000590: 0a20 2020 2022 7372 635f 7061 7468 222c  .    "src_path",
-000005a0: 0a20 2020 2022 7461 7267 6574 5f70 6174  .    "target_pat
-000005b0: 6822 2c0a 2020 2020 2276 6965 7765 7222  h",.    "viewer"
-000005c0: 2c0a 5d0a 0a0a 6465 6620 626f 6f6c 3273  ,.]...def bool2s
-000005d0: 7472 2876 616c 293a 0a20 2020 2072 6574  tr(val):.    ret
-000005e0: 7572 6e20 2279 6573 2220 6966 2076 616c  urn "yes" if val
-000005f0: 2065 6c73 6520 226e 6f22 0a0a 0a63 6c61   else "no"...cla
-00000600: 7373 2048 5454 5052 756e 4442 2852 756e  ss HTTPRunDB(Run
-00000610: 4442 496e 7465 7266 6163 6529 3a0a 2020  DBInterface):.  
-00000620: 2020 2222 2249 6e74 6572 6661 6365 2066    """Interface f
-00000630: 6f72 2061 6363 6573 7369 6e67 2061 6e64  or accessing and
-00000640: 206d 616e 6970 756c 6174 696e 6720 7468   manipulating th
-00000650: 6520 3a70 793a 6d6f 643a 606d 6c72 756e  e :py:mod:`mlrun
-00000660: 6020 7065 7273 6973 7465 6e74 2073 746f  ` persistent sto
-00000670: 7265 2c20 6d61 696e 7461 696e 696e 6720  re, maintaining 
-00000680: 7468 6520 6675 6c6c 2073 7461 7465 0a20  the full state. 
-00000690: 2020 2061 6e64 2063 6174 616c 6f67 206f     and catalog o
-000006a0: 6620 6f62 6a65 6374 7320 7468 6174 204d  f objects that M
-000006b0: 4c52 756e 2075 7365 732e 2054 6865 203a  LRun uses. The :
-000006c0: 7079 3a63 6c61 7373 3a60 4854 5450 5275  py:class:`HTTPRu
-000006d0: 6e44 4260 2063 6c61 7373 2073 6572 7665  nDB` class serve
-000006e0: 7320 6173 2061 2063 6c69 656e 742d 7369  s as a client-si
-000006f0: 6465 2070 726f 7879 2074 6f20 7468 6520  de proxy to the 
-00000700: 4d4c 5275 6e0a 2020 2020 4150 4920 7365  MLRun.    API se
-00000710: 7276 6963 6520 7768 6963 6820 6d61 696e  rvice which main
-00000720: 7461 696e 7320 7468 6520 6163 7475 616c  tains the actual
-00000730: 2064 6174 612d 7374 6f72 652c 2061 6363   data-store, acc
-00000740: 6573 7365 7320 7468 6520 7365 7276 6572  esses the server
-00000750: 2074 6872 6f75 6768 2052 4553 5420 4150   through REST AP
-00000760: 4973 2e0a 0a20 2020 2054 6865 2063 6c61  Is...    The cla
-00000770: 7373 2070 726f 7669 6465 7320 6675 6e63  ss provides func
-00000780: 7469 6f6e 7320 666f 7220 6163 6365 7373  tions for access
-00000790: 696e 6720 616e 6420 6d6f 6469 6679 696e  ing and modifyin
-000007a0: 6720 7468 6520 7661 7269 6f75 7320 6f62  g the various ob
-000007b0: 6a65 6374 7320 7468 6174 2061 7265 2075  jects that are u
-000007c0: 7365 6420 6279 204d 4c52 756e 2069 6e20  sed by MLRun in 
-000007d0: 6974 730a 2020 2020 6f70 6572 6174 696f  its.    operatio
-000007e0: 6e2e 2054 6865 2066 756e 6374 696f 6e73  n. The functions
-000007f0: 2070 726f 7669 6465 6420 666f 6c6c 6f77   provided follow
-00000800: 2073 6f6d 6520 7374 616e 6461 7264 2067   some standard g
-00000810: 7569 6465 6c69 6e65 732c 2077 6869 6368  uidelines, which
-00000820: 2061 7265 3a0a 0a20 2020 202d 2045 7665   are:..    - Eve
-00000830: 7279 206f 626a 6563 7420 696e 204d 4c52  ry object in MLR
-00000840: 756e 2065 7869 7374 7320 696e 2074 6865  un exists in the
-00000850: 2063 6f6e 7465 7874 206f 6620 6120 7072   context of a pr
-00000860: 6f6a 6563 7420 2865 7863 6570 7420 7072  oject (except pr
-00000870: 6f6a 6563 7473 2074 6865 6d73 656c 7665  ojects themselve
-00000880: 7329 2e20 5768 656e 2072 6566 6572 656e  s). When referen
-00000890: 6369 6e67 2061 6e20 6f62 6a65 6374 0a20  cing an object. 
-000008a0: 2020 2020 2074 6872 6f75 6768 2061 6e79       through any
-000008b0: 2041 5049 2c20 6120 7072 6f6a 6563 7420   API, a project 
-000008c0: 6e61 6d65 206d 7573 7420 6265 2070 726f  name must be pro
-000008d0: 7669 6465 642e 2054 6865 2064 6566 6175  vided. The defau
-000008e0: 6c74 2066 6f72 206d 6f73 7420 4150 4973  lt for most APIs
-000008f0: 2069 7320 666f 7220 616e 2065 6d70 7479   is for an empty
-00000900: 2070 726f 6a65 6374 206e 616d 652c 2077   project name, w
-00000910: 6869 6368 0a20 2020 2020 2077 696c 6c20  hich.      will 
-00000920: 6265 2072 6570 6c61 6365 6420 6279 2074  be replaced by t
-00000930: 6865 206e 616d 6520 6f66 2074 6865 2064  he name of the d
-00000940: 6566 6175 6c74 2070 726f 6a65 6374 2028  efault project (
-00000950: 7573 7561 6c6c 7920 6060 6465 6661 756c  usually ``defaul
-00000960: 7460 6029 2e20 5468 6572 6566 6f72 652c  t``). Therefore,
-00000970: 2069 6620 7065 7266 6f72 6d69 6e67 2061   if performing a
-00000980: 6e20 4150 4920 746f 0a20 2020 2020 206c  n API to.      l
-00000990: 6973 7420 6675 6e63 7469 6f6e 732c 2066  ist functions, f
-000009a0: 6f72 2065 7861 6d70 6c65 2c20 616e 6420  or example, and 
-000009b0: 6e6f 7420 7072 6f76 6964 696e 6720 6120  not providing a 
-000009c0: 7072 6f6a 6563 7420 6e61 6d65 202d 2074  project name - t
-000009d0: 6865 2072 6573 756c 7420 7769 6c6c 206e  he result will n
-000009e0: 6f74 2062 6520 6675 6e63 7469 6f6e 7320  ot be functions 
-000009f0: 6672 6f6d 2061 6c6c 0a20 2020 2020 2070  from all.      p
-00000a00: 726f 6a65 6374 7320 6275 7420 7261 7468  rojects but rath
-00000a10: 6572 2066 726f 6d20 7468 6520 6060 6465  er from the ``de
-00000a20: 6661 756c 7460 6020 7072 6f6a 6563 742e  fault`` project.
-00000a30: 0a20 2020 202d 204d 616e 7920 6f62 6a65  .    - Many obje
-00000a40: 6374 7320 6361 6e20 6265 2061 7373 6967  cts can be assig
-00000a50: 6e65 6420 6c61 6265 6c73 2c20 616e 6420  ned labels, and 
-00000a60: 6c69 7374 6564 2f71 7565 7269 6564 2062  listed/queried b
-00000a70: 7920 6c61 6265 6c2e 2054 6865 206c 6162  y label. The lab
-00000a80: 656c 2070 6172 616d 6574 6572 2066 6f72  el parameter for
-00000a90: 2071 7565 7279 2041 5049 7320 616c 6c6f   query APIs allo
-00000aa0: 7773 2066 6f72 0a20 2020 2020 206c 6973  ws for.      lis
-00000ab0: 7469 6e67 206f 626a 6563 7473 2074 6861  ting objects tha
-00000ac0: 743a 0a0a 2020 2020 2020 2d20 4861 7665  t:..      - Have
-00000ad0: 2061 2073 7065 6369 6669 6320 6c61 6265   a specific labe
-00000ae0: 6c2c 2062 7920 6173 6b69 6e67 2066 6f72  l, by asking for
-00000af0: 2060 606c 6162 656c 3d22 3c6c 6162 656c   ``label="<label
-00000b00: 5f6e 616d 653e 2260 602e 2049 6e20 7468  _name>"``. In th
-00000b10: 6973 2063 6173 6520 7468 6520 6163 7475  is case the actu
-00000b20: 616c 2076 616c 7565 206f 6620 7468 6520  al value of the 
-00000b30: 6c61 6265 6c0a 2020 2020 2020 2020 646f  label.        do
-00000b40: 6573 6e27 7420 6d61 7474 6572 2061 6e64  esn't matter and
-00000b50: 2065 7665 7279 206f 626a 6563 7420 7769   every object wi
-00000b60: 7468 2074 6861 7420 6c61 6265 6c20 7769  th that label wi
-00000b70: 6c6c 2062 6520 7265 7475 726e 6564 0a20  ll be returned. 
-00000b80: 2020 2020 202d 2048 6176 6520 6120 6c61       - Have a la
-00000b90: 6265 6c20 7769 7468 2061 2073 7065 6369  bel with a speci
-00000ba0: 6669 6320 7661 6c75 652e 2054 6869 7320  fic value. This 
-00000bb0: 6973 2064 6f6e 6520 6279 2073 7065 6369  is done by speci
-00000bc0: 6679 696e 6720 6060 6c61 6265 6c3d 223c  fying ``label="<
-00000bd0: 6c61 6265 6c5f 6e61 6d65 3e3d 3c6c 6162  label_name>=<lab
-00000be0: 656c 5f76 616c 7565 3e22 6060 2e20 496e  el_value>"``. In
-00000bf0: 2074 6869 730a 2020 2020 2020 2020 6361   this.        ca
-00000c00: 7365 206f 6e6c 7920 6f62 6a65 6374 7320  se only objects 
-00000c10: 7768 6f73 6520 6c61 6265 6c20 6d61 7463  whose label matc
-00000c20: 6865 7320 7468 6520 7661 6c75 6520 7769  hes the value wi
-00000c30: 6c6c 2062 6520 7265 7475 726e 6564 0a0a  ll be returned..
-00000c40: 2020 2020 2d20 4d6f 7374 206f 626a 6563      - Most objec
-00000c50: 7473 2068 6176 6520 6120 6060 6372 6561  ts have a ``crea
-00000c60: 7465 6060 206d 6574 686f 6420 6173 2077  te`` method as w
-00000c70: 656c 6c20 6173 2061 2060 6073 746f 7265  ell as a ``store
-00000c80: 6060 206d 6574 686f 642e 2043 7265 6174  `` method. Creat
-00000c90: 6520 6361 6e20 6f6e 6c79 2062 6520 6361  e can only be ca
-00000ca0: 6c6c 6564 2077 6865 6e20 7375 6368 2061  lled when such a
-00000cb0: 6e0a 2020 2020 2020 646f 6573 206e 6f74  n.      does not
-00000cc0: 2065 7869 7374 2079 6574 2c20 7768 696c   exist yet, whil
-00000cd0: 6520 7374 6f72 6520 616c 6c6f 7773 2066  e store allows f
-00000ce0: 6f72 2065 6974 6865 7220 6372 6561 7469  or either creati
-00000cf0: 6e67 2061 206e 6577 206f 626a 6563 7420  ng a new object 
-00000d00: 6f72 206f 7665 7277 7269 7469 6e67 2061  or overwriting a
-00000d10: 6e20 6578 6973 7469 6e67 206f 626a 6563  n existing objec
-00000d20: 742e 0a20 2020 202d 2053 6f6d 6520 6f62  t..    - Some ob
-00000d30: 6a65 6374 7320 6861 7665 2061 2060 6076  jects have a ``v
-00000d40: 6572 7369 6f6e 6564 6060 206f 7074 696f  ersioned`` optio
-00000d50: 6e2c 2069 6e20 7768 6963 6820 6361 7365  n, in which case
-00000d60: 206f 7665 7277 7269 7469 6e67 2074 6865   overwriting the
-00000d70: 2073 616d 6520 6f62 6a65 6374 2077 6974   same object wit
-00000d80: 6820 6120 6469 6666 6572 656e 7420 7665  h a different ve
-00000d90: 7273 696f 6e20 6f66 0a20 2020 2020 2069  rsion of.      i
-00000da0: 7420 646f 6573 206e 6f74 2064 656c 6574  t does not delet
-00000db0: 6520 7468 6520 7072 6576 696f 7573 2076  e the previous v
-00000dc0: 6572 7369 6f6e 2c20 6275 7420 7261 7468  ersion, but rath
-00000dd0: 6572 2063 7265 6174 6573 2061 206e 6577  er creates a new
-00000de0: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
-00000df0: 6f62 6a65 6374 2061 6e64 206b 6565 7073  object and keeps
-00000e00: 2062 6f74 6820 7665 7273 696f 6e73 2e0a   both versions..
-00000e10: 2020 2020 2020 5665 7273 696f 6e65 6420        Versioned 
-00000e20: 6f62 6a65 6374 7320 7573 7561 6c6c 7920  objects usually 
-00000e30: 6861 7665 2061 2060 6075 6964 6060 2070  have a ``uid`` p
-00000e40: 726f 7065 7274 7920 7768 6963 6820 6973  roperty which is
-00000e50: 2062 6173 6564 206f 6e20 7468 6569 7220   based on their 
-00000e60: 636f 6e74 656e 7420 616e 6420 616c 6c6f  content and allo
-00000e70: 7773 2074 6f20 7265 6665 7265 6e63 6520  ws to reference 
-00000e80: 610a 2020 2020 2020 7370 6563 6966 6963  a.      specific
-00000e90: 2076 6572 7369 6f6e 206f 6620 616e 206f   version of an o
-00000ea0: 626a 6563 7420 286f 7468 6572 2074 6861  bject (other tha
-00000eb0: 6e20 7461 6767 696e 6720 6f62 6a65 6374  n tagging object
-00000ec0: 732c 2077 6869 6368 2061 6c73 6f20 616c  s, which also al
-00000ed0: 6c6f 7773 2066 6f72 2065 6173 7920 7265  lows for easy re
-00000ee0: 6665 7265 6e63 696e 6729 2e0a 2020 2020  ferencing)..    
-00000ef0: 2d20 4d61 6e79 206f 626a 6563 7473 2068  - Many objects h
-00000f00: 6176 6520 626f 7468 2061 2060 6073 746f  ave both a ``sto
-00000f10: 7265 6060 2066 756e 6374 696f 6e20 616e  re`` function an
-00000f20: 6420 6120 6060 7061 7463 6860 6020 6675  d a ``patch`` fu
-00000f30: 6e63 7469 6f6e 2e20 5468 6573 6520 6172  nction. These ar
-00000f40: 6520 7573 6564 2069 6e20 7468 6520 7361  e used in the sa
-00000f50: 6d65 2077 6179 2061 7320 7468 650a 2020  me way as the.  
-00000f60: 2020 2020 636f 7272 6573 706f 6e64 696e      correspondin
-00000f70: 6720 5245 5354 2076 6572 6273 202d 2061  g REST verbs - a
-00000f80: 2060 6073 746f 7265 6060 2069 7320 7061   ``store`` is pa
-00000f90: 7373 6564 2061 2066 756c 6c20 6f62 6a65  ssed a full obje
-00000fa0: 6374 2061 6e64 2077 696c 6c20 6261 7369  ct and will basi
-00000fb0: 6361 6c6c 7920 7065 7266 6f72 6d20 6120  cally perform a 
-00000fc0: 5055 5420 6f70 6572 6174 696f 6e2c 0a20  PUT operation,. 
-00000fd0: 2020 2020 2072 6570 6c61 6369 6e67 2074       replacing t
-00000fe0: 6865 2066 756c 6c20 6f62 6a65 6374 2028  he full object (
-00000ff0: 6966 2069 7420 6578 6973 7473 2920 7768  if it exists) wh
-00001000: 696c 6520 6060 7061 7463 6860 6020 7265  ile ``patch`` re
-00001010: 6365 6976 6573 206a 7573 7420 6120 6469  ceives just a di
-00001020: 6374 696f 6e61 7279 2063 6f6e 7461 696e  ctionary contain
-00001030: 696e 6720 7468 6520 6469 6666 6572 656e  ing the differen
-00001040: 6365 7320 746f 0a20 2020 2020 2062 6520  ces to.      be 
-00001050: 6170 706c 6965 6420 746f 2074 6865 206f  applied to the o
-00001060: 626a 6563 742c 2061 6e64 2077 696c 6c20  bject, and will 
-00001070: 6d65 7267 6520 7468 6f73 6520 6368 616e  merge those chan
-00001080: 6765 7320 746f 2074 6865 2065 7869 7374  ges to the exist
-00001090: 696e 6720 6f62 6a65 6374 2e20 5468 6520  ing object. The 
-000010a0: 6060 7061 7463 6860 600a 2020 2020 2020  ``patch``.      
-000010b0: 6f70 6572 6174 696f 6e20 616c 736f 2068  operation also h
-000010c0: 6173 2061 2073 7472 6174 6567 7920 6173  as a strategy as
-000010d0: 7369 676e 6564 2074 6f20 6974 2077 6869  signed to it whi
-000010e0: 6368 2064 6574 6572 6d69 6e65 7320 686f  ch determines ho
-000010f0: 7720 7468 6520 6d65 7267 6520 6c6f 6769  w the merge logi
-00001100: 6320 7368 6f75 6c64 2062 6568 6176 652e  c should behave.
-00001110: 0a20 2020 2020 2054 6865 2073 7472 6174  .      The strat
-00001120: 6567 7920 6361 6e20 6265 2065 6974 6865  egy can be eithe
-00001130: 7220 6060 7265 706c 6163 6560 6020 6f72  r ``replace`` or
-00001140: 2060 6061 6464 6974 6976 6560 602e 2046   ``additive``. F
-00001150: 6f72 2066 7572 7468 6572 2064 6574 6169  or further detai
-00001160: 6c73 206f 6e20 7468 6f73 6520 7374 7261  ls on those stra
-00001170: 7465 6769 6573 2c20 7265 6665 720a 2020  tegies, refer.  
-00001180: 2020 2020 746f 2068 7474 7073 3a2f 2f70      to https://p
-00001190: 7970 692e 6f72 672f 7072 6f6a 6563 742f  ypi.org/project/
-000011a0: 6d65 7267 6564 6565 702f 0a20 2020 2022  mergedeep/.    "
-000011b0: 2222 0a0a 2020 2020 6b69 6e64 203d 2022  ""..    kind = "
-000011c0: 6874 7470 220a 2020 2020 2320 6279 2064  http".    # by d
-000011d0: 6566 6175 6c74 2077 6520 646f 6e27 7420  efault we don't 
-000011e0: 7265 7472 7920 6f6e 2050 4f53 5420 7265  retry on POST re
-000011f0: 7175 6573 7420 6173 2074 6865 7920 6172  quest as they ar
-00001200: 6520 7573 7561 6c6c 7920 6e6f 7420 6964  e usually not id
-00001210: 656d 706f 7465 6e74 0a20 2020 2023 2068  empotent.    # h
-00001220: 6572 6520 6973 2061 206c 6973 7420 6f66  ere is a list of
-00001230: 2069 6465 6e74 6966 6965 6420 504f 5354   identified POST
-00001240: 2072 6571 7565 7374 7320 7468 6174 2061   requests that a
-00001250: 7265 2069 6465 6d70 6f74 656e 7420 2827  re idempotent ('
-00001260: 7374 6f72 6527 2076 7320 2763 7265 6174  store' vs 'creat
-00001270: 6527 2920 616e 6420 6361 6e20 6265 2072  e') and can be r
-00001280: 6574 7269 6564 0a20 2020 2052 4554 5249  etried.    RETRI
-00001290: 4142 4c45 5f50 4f53 545f 5041 5448 5320  ABLE_POST_PATHS 
-000012a0: 3d20 5b0a 2020 2020 2020 2020 7222 5c2f  = [.        r"\/
-000012b0: 3f70 726f 6a65 6374 735c 2f2e 2b5c 2f61  ?projects\/.+\/a
-000012c0: 7274 6966 6163 7473 5c2f 2e2b 5c2f 2e2b  rtifacts\/.+\/.+
-000012d0: 222c 0a20 2020 2020 2020 2072 225c 2f3f  ",.        r"\/?
-000012e0: 7275 6e5c 2f2e 2b5c 2f2e 2b22 2c0a 2020  run\/.+\/.+",.  
-000012f0: 2020 5d0a 0a20 2020 2064 6566 205f 5f69    ]..    def __i
-00001300: 6e69 745f 5f28 7365 6c66 2c20 6261 7365  nit__(self, base
-00001310: 5f75 726c 2c20 7573 6572 3d22 222c 2070  _url, user="", p
-00001320: 6173 7377 6f72 643d 2222 2c20 746f 6b65  assword="", toke
-00001330: 6e3d 2222 293a 0a20 2020 2020 2020 2073  n=""):.        s
-00001340: 656c 662e 6261 7365 5f75 726c 203d 2062  elf.base_url = b
-00001350: 6173 655f 7572 6c0a 2020 2020 2020 2020  ase_url.        
-00001360: 7365 6c66 2e75 7365 7220 3d20 7573 6572  self.user = user
-00001370: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-00001380: 7373 776f 7264 203d 2070 6173 7377 6f72  ssword = passwor
-00001390: 640a 2020 2020 2020 2020 7365 6c66 2e74  d.        self.t
-000013a0: 6f6b 656e 203d 2074 6f6b 656e 0a20 2020  oken = token.   
-000013b0: 2020 2020 2073 656c 662e 7365 7276 6572       self.server
-000013c0: 5f76 6572 7369 6f6e 203d 2022 220a 2020  _version = "".  
-000013d0: 2020 2020 2020 7365 6c66 2e73 6573 7369        self.sessi
-000013e0: 6f6e 203d 204e 6f6e 650a 2020 2020 2020  on = None.      
-000013f0: 2020 7365 6c66 2e5f 7761 6974 5f66 6f72    self._wait_for
-00001400: 5f70 726f 6a65 6374 5f74 6572 6d69 6e61  _project_termina
-00001410: 6c5f 7374 6174 655f 7265 7472 795f 696e  l_state_retry_in
-00001420: 7465 7276 616c 203d 2033 0a20 2020 2020  terval = 3.     
-00001430: 2020 2073 656c 662e 5f77 6169 745f 666f     self._wait_fo
-00001440: 725f 6261 636b 6772 6f75 6e64 5f74 6173  r_background_tas
-00001450: 6b5f 7465 726d 696e 616c 5f73 7461 7465  k_terminal_state
-00001460: 5f72 6574 7279 5f69 6e74 6572 7661 6c20  _retry_interval 
-00001470: 3d20 330a 2020 2020 2020 2020 7365 6c66  = 3.        self
-00001480: 2e5f 7761 6974 5f66 6f72 5f70 726f 6a65  ._wait_for_proje
-00001490: 6374 5f64 656c 6574 696f 6e5f 696e 7465  ct_deletion_inte
-000014a0: 7276 616c 203d 2033 0a20 2020 2020 2020  rval = 3.       
-000014b0: 2073 656c 662e 636c 6965 6e74 5f76 6572   self.client_ver
-000014c0: 7369 6f6e 203d 2076 6572 7369 6f6e 2e56  sion = version.V
-000014d0: 6572 7369 6f6e 2829 2e67 6574 2829 5b22  ersion().get()["
-000014e0: 7665 7273 696f 6e22 5d0a 2020 2020 2020  version"].      
-000014f0: 2020 7365 6c66 2e70 7974 686f 6e5f 7665    self.python_ve
-00001500: 7273 696f 6e20 3d20 7374 7228 7665 7273  rsion = str(vers
-00001510: 696f 6e2e 5665 7273 696f 6e28 292e 6765  ion.Version().ge
-00001520: 745f 7079 7468 6f6e 5f76 6572 7369 6f6e  t_python_version
-00001530: 2829 290a 0a20 2020 2064 6566 205f 5f72  ())..    def __r
-00001540: 6570 725f 5f28 7365 6c66 293a 0a20 2020  epr__(self):.   
-00001550: 2020 2020 2063 6c73 203d 2073 656c 662e       cls = self.
-00001560: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00001570: 5f5f 0a20 2020 2020 2020 2072 6574 7572  __.        retur
-00001580: 6e20 6622 7b63 6c73 7d28 7b73 656c 662e  n f"{cls}({self.
-00001590: 6261 7365 5f75 726c 2172 7d29 220a 0a20  base_url!r})".. 
-000015a0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-000015b0: 0a20 2020 2064 6566 2067 6574 5f61 7069  .    def get_api
-000015c0: 5f70 6174 685f 7072 6566 6978 2876 6572  _path_prefix(ver
-000015d0: 7369 6f6e 3a20 7374 7220 3d20 4e6f 6e65  sion: str = None
-000015e0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-000015f0: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-00001600: 6172 616d 2076 6572 7369 6f6e 3a20 4150  aram version: AP
-00001610: 4920 7665 7273 696f 6e20 746f 2075 7365  I version to use
-00001620: 2c20 4e6f 6e65 2028 7468 6520 6465 6661  , None (the defa
-00001630: 756c 7429 2077 696c 6c20 6d65 616e 2074  ult) will mean t
-00001640: 6f20 7573 6520 7468 6520 6465 6661 756c  o use the defaul
-00001650: 7420 7661 6c75 6520 6672 6f6d 206d 6c63  t value from mlc
-00001660: 6f6e 662c 0a20 2020 2020 2020 2020 666f  onf,.         fo
-00001670: 7220 756e 2d76 6572 7369 6f6e 6564 2061  r un-versioned a
-00001680: 7069 2073 6574 2061 6e20 656d 7074 7920  pi set an empty 
-00001690: 7374 7269 6e67 2e0a 2020 2020 2020 2020  string..        
-000016a0: 2222 220a 2020 2020 2020 2020 6966 2076  """.        if v
-000016b0: 6572 7369 6f6e 2069 7320 6e6f 7420 4e6f  ersion is not No
-000016c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000016d0: 7265 7475 726e 2066 2261 7069 2f7b 7665  return f"api/{ve
-000016e0: 7273 696f 6e7d 2220 6966 2076 6572 7369  rsion}" if versi
-000016f0: 6f6e 2065 6c73 6520 2261 7069 220a 0a20  on else "api".. 
-00001700: 2020 2020 2020 2061 7069 5f76 6572 7369         api_versi
-00001710: 6f6e 5f70 6174 6820 3d20 280a 2020 2020  on_path = (.    
-00001720: 2020 2020 2020 2020 6622 6170 692f 7b63          f"api/{c
-00001730: 6f6e 6669 672e 6170 695f 6261 7365 5f76  onfig.api_base_v
-00001740: 6572 7369 6f6e 7d22 2069 6620 636f 6e66  ersion}" if conf
-00001750: 6967 2e61 7069 5f62 6173 655f 7665 7273  ig.api_base_vers
-00001760: 696f 6e20 656c 7365 2022 6170 6922 0a20  ion else "api". 
-00001770: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00001780: 2072 6574 7572 6e20 6170 695f 7665 7273   return api_vers
-00001790: 696f 6e5f 7061 7468 0a0a 2020 2020 6465  ion_path..    de
-000017a0: 6620 6765 745f 6261 7365 5f61 7069 5f75  f get_base_api_u
-000017b0: 726c 2873 656c 662c 2070 6174 683a 2073  rl(self, path: s
-000017c0: 7472 2c20 7665 7273 696f 6e3a 2073 7472  tr, version: str
-000017d0: 203d 204e 6f6e 6529 202d 3e20 7374 723a   = None) -> str:
-000017e0: 0a20 2020 2020 2020 2070 6174 685f 7072  .        path_pr
-000017f0: 6566 6978 203d 2073 656c 662e 6765 745f  efix = self.get_
-00001800: 6170 695f 7061 7468 5f70 7265 6669 7828  api_path_prefix(
-00001810: 7665 7273 696f 6e29 0a20 2020 2020 2020  version).       
-00001820: 2075 726c 203d 2066 227b 7365 6c66 2e62   url = f"{self.b
-00001830: 6173 655f 7572 6c7d 2f7b 7061 7468 5f70  ase_url}/{path_p
-00001840: 7265 6669 787d 2f7b 7061 7468 7d22 0a20  refix}/{path}". 
-00001850: 2020 2020 2020 2072 6574 7572 6e20 7572         return ur
-00001860: 6c0a 0a20 2020 2064 6566 2061 7069 5f63  l..    def api_c
-00001870: 616c 6c28 0a20 2020 2020 2020 2073 656c  all(.        sel
-00001880: 662c 0a20 2020 2020 2020 206d 6574 686f  f,.        metho
-00001890: 642c 0a20 2020 2020 2020 2070 6174 682c  d,.        path,
-000018a0: 0a20 2020 2020 2020 2065 7272 6f72 3d4e  .        error=N
-000018b0: 6f6e 652c 0a20 2020 2020 2020 2070 6172  one,.        par
-000018c0: 616d 733d 4e6f 6e65 2c0a 2020 2020 2020  ams=None,.      
-000018d0: 2020 626f 6479 3d4e 6f6e 652c 0a20 2020    body=None,.   
-000018e0: 2020 2020 206a 736f 6e3d 4e6f 6e65 2c0a       json=None,.
-000018f0: 2020 2020 2020 2020 6865 6164 6572 733d          headers=
-00001900: 4e6f 6e65 2c0a 2020 2020 2020 2020 7469  None,.        ti
-00001910: 6d65 6f75 743d 3435 2c0a 2020 2020 2020  meout=45,.      
-00001920: 2020 7665 7273 696f 6e3d 4e6f 6e65 2c0a    version=None,.
-00001930: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-00001940: 2222 5065 7266 6f72 6d20 6120 6469 7265  ""Perform a dire
-00001950: 6374 2052 4553 5420 4150 4920 6361 6c6c  ct REST API call
-00001960: 206f 6e20 7468 6520 3a70 793a 6d6f 643a   on the :py:mod:
-00001970: 606d 6c72 756e 6020 4150 4920 7365 7276  `mlrun` API serv
-00001980: 6572 2e0a 0a20 2020 2020 2020 2043 6175  er...        Cau
-00001990: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-000019a0: 2020 466f 7220 6164 7661 6e63 6564 2075    For advanced u
-000019b0: 7361 6765 202d 2070 7265 6665 7220 7573  sage - prefer us
-000019c0: 696e 6720 7468 6520 7661 7269 6f75 7320  ing the various 
-000019d0: 4150 4973 2065 7870 6f73 6564 2074 6872  APIs exposed thr
-000019e0: 6f75 6768 2074 6869 7320 636c 6173 732c  ough this class,
-000019f0: 2072 6174 6865 7220 7468 616e 0a20 2020   rather than.   
-00001a00: 2020 2020 2020 2020 2064 6972 6563 746c           directl
-00001a10: 7920 696e 766f 6b69 6e67 2052 4553 5420  y invoking REST 
-00001a20: 6361 6c6c 732e 0a0a 2020 2020 2020 2020  calls...        
-00001a30: 3a70 6172 616d 206d 6574 686f 643a 2052  :param method: R
-00001a40: 4553 5420 6d65 7468 6f64 2028 504f 5354  EST method (POST
-00001a50: 2c20 4745 542c 2050 5554 2e2e 2e29 0a20  , GET, PUT...). 
-00001a60: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-00001a70: 7468 3a20 5061 7468 2074 6f20 656e 6470  th: Path to endp
-00001a80: 6f69 6e74 2065 7865 6375 7465 642c 2066  oint executed, f
-00001a90: 6f72 2065 7861 6d70 6c65 2060 6022 7072  or example ``"pr
-00001aa0: 6f6a 6563 7473 2260 600a 2020 2020 2020  ojects"``.      
-00001ab0: 2020 3a70 6172 616d 2065 7272 6f72 3a20    :param error: 
-00001ac0: 4572 726f 7220 746f 2072 6574 7572 6e20  Error to return 
-00001ad0: 6966 2041 5049 2069 6e76 6f63 6174 696f  if API invocatio
-00001ae0: 6e20 6661 696c 730a 2020 2020 2020 2020  n fails.        
-00001af0: 3a70 6172 616d 2070 6172 616d 733a 2052  :param params: R
-00001b00: 6573 7420 7061 7261 6d65 7465 7273 2c20  est parameters, 
-00001b10: 7061 7373 6564 2061 7320 6120 6469 6374  passed as a dict
-00001b20: 696f 6e61 7279 3a20 6060 7b22 3c70 6172  ionary: ``{"<par
-00001b30: 616d 2d6e 616d 653e 223a 203c 2270 6172  am-name>": <"par
-00001b40: 616d 2d76 616c 7565 223e 7d60 600a 2020  am-value">}``.  
-00001b50: 2020 2020 2020 3a70 6172 616d 2062 6f64        :param bod
-00001b60: 793a 2050 6179 6c6f 6164 2074 6f20 6265  y: Payload to be
-00001b70: 2070 6173 7365 6420 696e 2074 6865 2063   passed in the c
-00001b80: 616c 6c2e 2049 6620 7573 696e 6720 4a53  all. If using JS
-00001b90: 4f4e 206f 626a 6563 7473 2c20 7072 6566  ON objects, pref
-00001ba0: 6572 2075 7369 6e67 2074 6865 2060 606a  er using the ``j
-00001bb0: 736f 6e60 6020 7061 7261 6d0a 2020 2020  son`` param.    
-00001bc0: 2020 2020 3a70 6172 616d 206a 736f 6e3a      :param json:
-00001bd0: 204a 534f 4e20 7061 796c 6f61 6420 746f   JSON payload to
-00001be0: 2062 6520 7061 7373 6564 2069 6e20 7468   be passed in th
-00001bf0: 6520 6361 6c6c 0a20 2020 2020 2020 203a  e call.        :
-00001c00: 7061 7261 6d20 6865 6164 6572 733a 2052  param headers: R
-00001c10: 4553 5420 6865 6164 6572 732c 2070 6173  EST headers, pas
-00001c20: 7365 6420 6173 2061 2064 6963 7469 6f6e  sed as a diction
-00001c30: 6172 793a 2060 607b 223c 6865 6164 6572  ary: ``{"<header
-00001c40: 2d6e 616d 653e 223a 2022 3c68 6561 6465  -name>": "<heade
-00001c50: 722d 7661 6c75 653e 227d 6060 0a20 2020  r-value>"}``.   
-00001c60: 2020 2020 203a 7061 7261 6d20 7469 6d65       :param time
-00001c70: 6f75 743a 2041 5049 2063 616c 6c20 7469  out: API call ti
-00001c80: 6d65 6f75 740a 2020 2020 2020 2020 3a70  meout.        :p
-00001c90: 6172 616d 2076 6572 7369 6f6e 3a20 4150  aram version: AP
-00001ca0: 4920 7665 7273 696f 6e20 746f 2075 7365  I version to use
-00001cb0: 2c20 4e6f 6e65 2028 7468 6520 6465 6661  , None (the defa
-00001cc0: 756c 7429 2077 696c 6c20 6d65 616e 2074  ult) will mean t
-00001cd0: 6f20 7573 6520 7468 6520 6465 6661 756c  o use the defaul
-00001ce0: 7420 7661 6c75 6520 6672 6f6d 2063 6f6e  t value from con
-00001cf0: 6669 672c 0a20 2020 2020 2020 2020 666f  fig,.         fo
-00001d00: 7220 756e 2d76 6572 7369 6f6e 6564 2061  r un-versioned a
-00001d10: 7069 2073 6574 2061 6e20 656d 7074 7920  pi set an empty 
-00001d20: 7374 7269 6e67 2e0a 0a20 2020 2020 2020  string...       
-00001d30: 203a 7265 7475 726e 3a20 5079 7468 6f6e   :return: Python
-00001d40: 2048 5454 5020 7265 7370 6f6e 7365 206f   HTTP response o
-00001d50: 626a 6563 740a 2020 2020 2020 2020 2222  bject.        ""
-00001d60: 220a 2020 2020 2020 2020 7572 6c20 3d20  ".        url = 
-00001d70: 7365 6c66 2e67 6574 5f62 6173 655f 6170  self.get_base_ap
-00001d80: 695f 7572 6c28 7061 7468 2c20 7665 7273  i_url(path, vers
-00001d90: 696f 6e29 0a20 2020 2020 2020 206b 7720  ion).        kw 
-00001da0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00001db0: 6b65 793a 2076 616c 7565 0a20 2020 2020  key: value.     
-00001dc0: 2020 2020 2020 2066 6f72 206b 6579 2c20         for key, 
-00001dd0: 7661 6c75 6520 696e 2028 0a20 2020 2020  value in (.     
-00001de0: 2020 2020 2020 2020 2020 2028 2270 6172             ("par
-00001df0: 616d 7322 2c20 7061 7261 6d73 292c 0a20  ams", params),. 
-00001e00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00001e10: 2264 6174 6122 2c20 626f 6479 292c 0a20  "data", body),. 
-00001e20: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00001e30: 226a 736f 6e22 2c20 6a73 6f6e 292c 0a20  "json", json),. 
-00001e40: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00001e50: 2268 6561 6465 7273 222c 2068 6561 6465  "headers", heade
-00001e60: 7273 292c 0a20 2020 2020 2020 2020 2020  rs),.           
-00001e70: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
-00001e80: 6620 7661 6c75 6520 6973 206e 6f74 204e  f value is not N
-00001e90: 6f6e 650a 2020 2020 2020 2020 7d0a 0a20  one.        }.. 
-00001ea0: 2020 2020 2020 2069 6620 7365 6c66 2e75         if self.u
-00001eb0: 7365 723a 0a20 2020 2020 2020 2020 2020  ser:.           
-00001ec0: 206b 775b 2261 7574 6822 5d20 3d20 2873   kw["auth"] = (s
-00001ed0: 656c 662e 7573 6572 2c20 7365 6c66 2e70  elf.user, self.p
-00001ee0: 6173 7377 6f72 6429 0a20 2020 2020 2020  assword).       
-00001ef0: 2065 6c69 6620 7365 6c66 2e74 6f6b 656e   elif self.token
-00001f00: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00001f10: 4967 7561 7a69 6f20 6175 7468 2064 6f65  Iguazio auth doe
-00001f20: 736e 2774 2073 7570 706f 7274 2070 6173  sn't support pas
-00001f30: 7369 6e67 2074 6f6b 656e 2074 6872 6f75  sing token throu
-00001f40: 6768 2062 6561 7265 722c 2073 6f20 7573  gh bearer, so us
-00001f50: 6520 636f 6f6b 6965 2069 6e73 7465 6164  e cookie instead
-00001f60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00001f70: 6d6c 7275 6e2e 706c 6174 666f 726d 732e  mlrun.platforms.
-00001f80: 6967 7561 7a69 6f2e 6973 5f69 6775 617a  iguazio.is_iguaz
-00001f90: 696f 5f73 6573 7369 6f6e 2873 656c 662e  io_session(self.
-00001fa0: 746f 6b65 6e29 3a0a 2020 2020 2020 2020  token):.        
-00001fb0: 2020 2020 2020 2020 7365 7373 696f 6e5f          session_
-00001fc0: 636f 6f6b 6965 203d 2066 276a 3a7b 7b22  cookie = f'j:{{"
-00001fd0: 7369 6422 3a20 227b 7365 6c66 2e74 6f6b  sid": "{self.tok
-00001fe0: 656e 7d22 7d7d 270a 2020 2020 2020 2020  en}"}}'.        
-00001ff0: 2020 2020 2020 2020 636f 6f6b 6965 7320          cookies 
-00002000: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00002010: 2020 2020 2020 2020 2273 6573 7369 6f6e          "session
-00002020: 223a 2073 6573 7369 6f6e 5f63 6f6f 6b69  ": session_cooki
-00002030: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00002040: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00002050: 2020 2020 206b 775b 2263 6f6f 6b69 6573       kw["cookies
-00002060: 225d 203d 2063 6f6f 6b69 6573 0a20 2020  "] = cookies.   
-00002070: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00002080: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002090: 6620 2241 7574 686f 7269 7a61 7469 6f6e  f "Authorization
-000020a0: 2220 6e6f 7420 696e 206b 772e 7365 7464  " not in kw.setd
-000020b0: 6566 6175 6c74 2822 6865 6164 6572 7322  efault("headers"
-000020c0: 2c20 7b7d 293a 0a20 2020 2020 2020 2020  , {}):.         
-000020d0: 2020 2020 2020 2020 2020 206b 775b 2268             kw["h
-000020e0: 6561 6465 7273 225d 2e75 7064 6174 6528  eaders"].update(
-000020f0: 7b22 4175 7468 6f72 697a 6174 696f 6e22  {"Authorization"
-00002100: 3a20 2242 6561 7265 7220 2220 2b20 7365  : "Bearer " + se
-00002110: 6c66 2e74 6f6b 656e 7d29 0a0a 2020 2020  lf.token})..    
-00002120: 2020 2020 6966 206d 6c72 756e 2e63 6f6d      if mlrun.com
-00002130: 6d6f 6e2e 7363 6865 6d61 732e 4865 6164  mon.schemas.Head
-00002140: 6572 4e61 6d65 732e 636c 6965 6e74 5f76  erNames.client_v
-00002150: 6572 7369 6f6e 206e 6f74 2069 6e20 6b77  ersion not in kw
-00002160: 2e73 6574 6465 6661 756c 7428 0a20 2020  .setdefault(.   
-00002170: 2020 2020 2020 2020 2022 6865 6164 6572           "header
-00002180: 7322 2c20 7b7d 0a20 2020 2020 2020 2029  s", {}.        )
-00002190: 3a0a 2020 2020 2020 2020 2020 2020 6b77  :.            kw
-000021a0: 5b22 6865 6164 6572 7322 5d2e 7570 6461  ["headers"].upda
-000021b0: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-000021c0: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-000021d0: 2020 2020 2020 2020 2020 6d6c 7275 6e2e            mlrun.
-000021e0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e48  common.schemas.H
-000021f0: 6561 6465 724e 616d 6573 2e63 6c69 656e  eaderNames.clien
-00002200: 745f 7665 7273 696f 6e3a 2073 656c 662e  t_version: self.
-00002210: 636c 6965 6e74 5f76 6572 7369 6f6e 2c0a  client_version,.
-00002220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002230: 2020 2020 6d6c 7275 6e2e 636f 6d6d 6f6e      mlrun.common
-00002240: 2e73 6368 656d 6173 2e48 6561 6465 724e  .schemas.HeaderN
-00002250: 616d 6573 2e70 7974 686f 6e5f 7665 7273  ames.python_vers
-00002260: 696f 6e3a 2073 656c 662e 7079 7468 6f6e  ion: self.python
-00002270: 5f76 6572 7369 6f6e 2c0a 2020 2020 2020  _version,.      
-00002280: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-00002290: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000022a0: 2020 2023 2072 6571 7565 7374 7320 6e6f     # requests no
-000022b0: 206c 6f6e 6765 7220 7375 7070 6f72 7473   longer supports
-000022c0: 2068 6561 6465 7220 7661 6c75 6573 2074   header values t
-000022d0: 6f20 6265 2065 6e75 6d20 2868 7474 7073  o be enum (https
-000022e0: 3a2f 2f67 6974 6875 622e 636f 6d2f 7073  ://github.com/ps
-000022f0: 662f 7265 7175 6573 7473 2f70 756c 6c2f  f/requests/pull/
-00002300: 3631 3534 290a 2020 2020 2020 2020 2320  6154).        # 
-00002310: 636f 6e76 6572 7420 746f 2073 7472 696e  convert to strin
-00002320: 6773 2e20 446f 2074 6865 2073 616d 6520  gs. Do the same 
-00002330: 666f 7220 7061 7261 6d73 2066 6f72 206e  for params for n
-00002340: 6963 656e 6573 730a 2020 2020 2020 2020  iceness.        
-00002350: 666f 7220 6469 6374 5f20 696e 205b 6865  for dict_ in [he
-00002360: 6164 6572 732c 2070 6172 616d 735d 3a0a  aders, params]:.
-00002370: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00002380: 6963 745f 2069 7320 6e6f 7420 4e6f 6e65  ict_ is not None
-00002390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000023a0: 2020 666f 7220 6b65 7920 696e 2064 6963    for key in dic
-000023b0: 745f 2e6b 6579 7328 293a 0a20 2020 2020  t_.keys():.     
-000023c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000023d0: 6620 6973 696e 7374 616e 6365 2864 6963  f isinstance(dic
-000023e0: 745f 5b6b 6579 5d2c 2065 6e75 6d2e 456e  t_[key], enum.En
-000023f0: 756d 293a 0a20 2020 2020 2020 2020 2020  um):.           
-00002400: 2020 2020 2020 2020 2020 2020 2064 6963               dic
-00002410: 745f 5b6b 6579 5d20 3d20 6469 6374 5f5b  t_[key] = dict_[
-00002420: 6b65 795d 2e76 616c 7565 0a0a 2020 2020  key].value..    
-00002430: 2020 2020 2320 6966 2074 6865 206d 6574      # if the met
-00002440: 686f 6420 6973 2050 4f53 542c 2077 6520  hod is POST, we 
-00002450: 6e65 6564 2074 6f20 7570 6461 7465 2074  need to update t
-00002460: 6865 2073 6573 7369 6f6e 2077 6974 6820  he session with 
-00002470: 7468 6520 6170 7072 6f70 7269 6174 6520  the appropriate 
-00002480: 7265 7472 7920 706f 6c69 6379 0a20 2020  retry policy.   
-00002490: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-000024a0: 2e73 6573 7369 6f6e 206f 7220 6d65 7468  .session or meth
-000024b0: 6f64 203d 3d20 2250 4f53 5422 3a0a 2020  od == "POST":.  
-000024c0: 2020 2020 2020 2020 2020 7265 7472 795f            retry_
-000024d0: 6f6e 5f70 6f73 7420 3d20 7365 6c66 2e5f  on_post = self._
-000024e0: 6973 5f72 6574 7279 5f6f 6e5f 706f 7374  is_retry_on_post
-000024f0: 5f61 6c6c 6f77 6564 286d 6574 686f 642c  _allowed(method,
-00002500: 2070 6174 6829 0a20 2020 2020 2020 2020   path).         
-00002510: 2020 2073 656c 662e 7365 7373 696f 6e20     self.session 
-00002520: 3d20 7365 6c66 2e5f 696e 6974 5f73 6573  = self._init_ses
-00002530: 7369 6f6e 2872 6574 7279 5f6f 6e5f 706f  sion(retry_on_po
-00002540: 7374 290a 0a20 2020 2020 2020 2074 7279  st)..        try
-00002550: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00002560: 7370 6f6e 7365 203d 2073 656c 662e 7365  sponse = self.se
-00002570: 7373 696f 6e2e 7265 7175 6573 7428 0a20  ssion.request(. 
-00002580: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00002590: 6574 686f 642c 2075 726c 2c20 7469 6d65  ethod, url, time
-000025a0: 6f75 743d 7469 6d65 6f75 742c 2076 6572  out=timeout, ver
-000025b0: 6966 793d 4661 6c73 652c 202a 2a6b 770a  ify=False, **kw.
-000025c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000025d0: 2020 2020 2020 6578 6365 7074 2072 6571        except req
-000025e0: 7565 7374 732e 5265 7175 6573 7445 7863  uests.RequestExc
-000025f0: 6570 7469 6f6e 2061 7320 6578 633a 0a20  eption as exc:. 
-00002600: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00002610: 203d 2066 227b 6572 725f 746f 5f73 7472   = f"{err_to_str
-00002620: 2865 7863 297d 3a20 7b65 7272 6f72 7d22  (exc)}: {error}"
-00002630: 2069 6620 6572 726f 7220 656c 7365 2065   if error else e
-00002640: 7272 5f74 6f5f 7374 7228 6578 6329 0a20  rr_to_str(exc). 
-00002650: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00002660: 206d 6c72 756e 2e65 7272 6f72 732e 4d4c   mlrun.errors.ML
-00002670: 5275 6e52 756e 7469 6d65 4572 726f 7228  RunRuntimeError(
-00002680: 6572 726f 7229 2066 726f 6d20 6578 630a  error) from exc.
-00002690: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000026a0: 7265 7370 6f6e 7365 2e6f 6b3a 0a20 2020  response.ok:.   
-000026b0: 2020 2020 2020 2020 2069 6620 7265 7370           if resp
-000026c0: 6f6e 7365 2e63 6f6e 7465 6e74 3a0a 2020  onse.content:.  
-000026d0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-000026e0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000026f0: 2020 2020 2020 2064 6174 6120 3d20 7265         data = re
-00002700: 7370 6f6e 7365 2e6a 736f 6e28 290a 2020  sponse.json().  
-00002710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002720: 2020 6572 726f 725f 6465 7461 696c 7320    error_details 
-00002730: 3d20 6461 7461 2e67 6574 2822 6465 7461  = data.get("deta
-00002740: 696c 222c 207b 7d29 0a20 2020 2020 2020  il", {}).       
-00002750: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00002760: 6e6f 7420 6572 726f 725f 6465 7461 696c  not error_detail
-00002770: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00002780: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00002790: 722e 7761 726e 696e 6728 2246 6169 6c65  r.warning("Faile
-000027a0: 6420 7061 7273 696e 6720 6572 726f 7220  d parsing error 
-000027b0: 7265 7370 6f6e 7365 2062 6f64 7922 2c20  response body", 
-000027c0: 6461 7461 3d64 6174 6129 0a20 2020 2020  data=data).     
-000027d0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000027e0: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-000027f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002800: 2065 7272 6f72 5f64 6574 6169 6c73 203d   error_details =
-00002810: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
-00002820: 2020 2020 6966 2065 7272 6f72 5f64 6574      if error_det
-00002830: 6169 6c73 3a0a 2020 2020 2020 2020 2020  ails:.          
-00002840: 2020 2020 2020 2020 2020 6572 726f 725f            error_
-00002850: 6465 7461 696c 7320 3d20 6622 6465 7461  details = f"deta
-00002860: 696c 733a 207b 6572 726f 725f 6465 7461  ils: {error_deta
-00002870: 696c 737d 220a 2020 2020 2020 2020 2020  ils}".          
-00002880: 2020 2020 2020 2020 2020 6572 726f 7220            error 
-00002890: 3d20 6622 7b65 7272 6f72 7d20 7b65 7272  = f"{error} {err
-000028a0: 6f72 5f64 6574 6169 6c73 7d22 2069 6620  or_details}" if 
-000028b0: 6572 726f 7220 656c 7365 2065 7272 6f72  error else error
-000028c0: 5f64 6574 6169 6c73 0a20 2020 2020 2020  _details.       
-000028d0: 2020 2020 2020 2020 2020 2020 206d 6c72               mlr
-000028e0: 756e 2e65 7272 6f72 732e 7261 6973 655f  un.errors.raise_
-000028f0: 666f 725f 7374 6174 7573 2872 6573 706f  for_status(respo
-00002900: 6e73 652c 2065 7272 6f72 290a 0a20 2020  nse, error)..   
-00002910: 2020 2020 2020 2020 206d 6c72 756e 2e65           mlrun.e
-00002920: 7272 6f72 732e 7261 6973 655f 666f 725f  rrors.raise_for_
-00002930: 7374 6174 7573 2872 6573 706f 6e73 652c  status(response,
-00002940: 2065 7272 6f72 290a 0a20 2020 2020 2020   error)..       
-00002950: 2072 6574 7572 6e20 7265 7370 6f6e 7365   return response
-00002960: 0a0a 2020 2020 6465 6620 5f69 6e69 745f  ..    def _init_
-00002970: 7365 7373 696f 6e28 7365 6c66 2c20 7265  session(self, re
-00002980: 7472 795f 6f6e 5f70 6f73 743a 2062 6f6f  try_on_post: boo
-00002990: 6c20 3d20 4661 6c73 6529 3a0a 2020 2020  l = False):.    
-000029a0: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
-000029b0: 2e75 7469 6c73 2e48 5454 5053 6573 7369  .utils.HTTPSessi
-000029c0: 6f6e 5769 7468 5265 7472 7928 0a20 2020  onWithRetry(.   
-000029d0: 2020 2020 2020 2020 2072 6574 7279 5f6f           retry_o
-000029e0: 6e5f 6578 6365 7074 696f 6e3d 636f 6e66  n_exception=conf
-000029f0: 6967 2e68 7474 7064 622e 7265 7472 795f  ig.httpdb.retry_
-00002a00: 6170 695f 6361 6c6c 5f6f 6e5f 6578 6365  api_call_on_exce
-00002a10: 7074 696f 6e0a 2020 2020 2020 2020 2020  ption.          
-00002a20: 2020 3d3d 206d 6c72 756e 2e63 6f6d 6d6f    == mlrun.commo
-00002a30: 6e2e 7363 6865 6d61 732e 4854 5450 5365  n.schemas.HTTPSe
-00002a40: 7373 696f 6e52 6574 7279 4d6f 6465 2e65  ssionRetryMode.e
-00002a50: 6e61 626c 6564 2e76 616c 7565 2c0a 2020  nabled.value,.  
-00002a60: 2020 2020 2020 2020 2020 7265 7472 795f            retry_
-00002a70: 6f6e 5f70 6f73 743d 7265 7472 795f 6f6e  on_post=retry_on
-00002a80: 5f70 6f73 742c 0a20 2020 2020 2020 2029  _post,.        )
-00002a90: 0a0a 2020 2020 6465 6620 5f70 6174 685f  ..    def _path_
-00002aa0: 6f66 2873 656c 662c 2070 7265 6669 782c  of(self, prefix,
-00002ab0: 2070 726f 6a65 6374 2c20 7569 6429 3a0a   project, uid):.
-00002ac0: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
-00002ad0: 3d20 7072 6f6a 6563 7420 6f72 2063 6f6e  = project or con
-00002ae0: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
-00002af0: 6563 740a 2020 2020 2020 2020 7265 7475  ect.        retu
-00002b00: 726e 2066 227b 7072 6566 6978 7d2f 7b70  rn f"{prefix}/{p
-00002b10: 726f 6a65 6374 7d2f 7b75 6964 7d22 0a0a  roject}/{uid}"..
-00002b20: 2020 2020 6465 6620 5f69 735f 7265 7472      def _is_retr
-00002b30: 795f 6f6e 5f70 6f73 745f 616c 6c6f 7765  y_on_post_allowe
-00002b40: 6428 7365 6c66 2c20 6d65 7468 6f64 2c20  d(self, method, 
-00002b50: 7061 7468 3a20 7374 7229 3a0a 2020 2020  path: str):.    
-00002b60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00002b70: 4368 6563 6b20 6966 2074 6865 2067 6976  Check if the giv
-00002b80: 656e 2070 6174 6820 6973 2061 6c6c 6f77  en path is allow
-00002b90: 6564 2074 6f20 6265 2072 6574 7269 6564  ed to be retried
-00002ba0: 206f 6e20 504f 5354 206d 6574 686f 640a   on POST method.
-00002bb0: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
-00002bc0: 6574 686f 643a 2020 7573 6564 2074 6f20  ethod:  used to 
-00002bd0: 7665 7269 6679 2074 6861 7420 7468 6520  verify that the 
-00002be0: 6d65 7468 6f64 2069 7320 504f 5354 2073  method is POST s
-00002bf0: 696e 6365 2069 6620 7468 6572 6520 6973  ince if there is
-00002c00: 206e 6f20 7365 7373 696f 6e20 696e 6974   no session init
-00002c10: 6961 6c69 7a65 6420 7468 6572 6520 6973  ialized there is
-00002c20: 206e 6f0a 2020 2020 2020 2020 2020 2020   no.            
-00002c30: 2020 2020 2020 2020 2020 2020 6e65 6564              need
-00002c40: 2074 6f20 696e 6974 6961 6c69 7a65 2069   to initialize i
-00002c50: 7420 7769 7468 2072 6574 7279 2070 6f6c  t with retry pol
-00002c60: 6963 7920 666f 7220 504f 5354 2077 6865  icy for POST whe
-00002c70: 6e20 7468 6520 6d65 7468 6f64 2069 7320  n the method is 
-00002c80: 6e6f 7420 504f 5354 0a20 2020 2020 2020  not POST.       
-00002c90: 203a 7061 7261 6d20 7061 7468 3a20 2020   :param path:   
-00002ca0: 2074 6865 2070 6174 6820 746f 2063 6865   the path to che
-00002cb0: 636b 0a20 2020 2020 2020 203a 7265 7475  ck.        :retu
-00002cc0: 726e 3a20 2020 2020 2020 2054 7275 6520  rn:        True 
-00002cd0: 6966 2074 6865 2070 6174 6820 6973 2061  if the path is a
-00002ce0: 6c6c 6f77 6564 2074 6f20 6265 2072 6574  llowed to be ret
-00002cf0: 7269 6564 206f 6e20 504f 5354 206d 6574  ried on POST met
-00002d00: 686f 6420 616e 6420 6d65 7468 6f64 2069  hod and method i
-00002d10: 7320 504f 5354 2c20 4661 6c73 6520 6f74  s POST, False ot
-00002d20: 6865 7277 6973 650a 2020 2020 2020 2020  herwise.        
-00002d30: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00002d40: 726e 206d 6574 686f 6420 3d3d 2022 504f  rn method == "PO
-00002d50: 5354 2220 616e 6420 616e 7928 0a20 2020  ST" and any(.   
-00002d60: 2020 2020 2020 2020 2072 652e 6d61 7463           re.matc
-00002d70: 6828 7265 6765 782c 2070 6174 6829 2066  h(regex, path) f
-00002d80: 6f72 2072 6567 6578 2069 6e20 7365 6c66  or regex in self
-00002d90: 2e52 4554 5249 4142 4c45 5f50 4f53 545f  .RETRIABLE_POST_
-00002da0: 5041 5448 530a 2020 2020 2020 2020 290a  PATHS.        ).
-00002db0: 0a20 2020 2064 6566 2063 6f6e 6e65 6374  .    def connect
-00002dc0: 2873 656c 662c 2073 6563 7265 7473 3d4e  (self, secrets=N
-00002dd0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00002de0: 2243 6f6e 6e65 6374 2074 6f20 7468 6520  "Connect to the 
-00002df0: 4d4c 5275 6e20 4150 4920 7365 7276 6572  MLRun API server
-00002e00: 2e20 4d75 7374 2062 6520 6361 6c6c 6564  . Must be called
-00002e10: 2070 7269 6f72 2074 6f20 6578 6563 7574   prior to execut
-00002e20: 696e 6720 616e 7920 6f74 6865 7220 6d65  ing any other me
-00002e30: 7468 6f64 2e0a 2020 2020 2020 2020 5468  thod..        Th
-00002e40: 6520 636f 6465 2075 7469 6c69 7a65 7320  e code utilizes 
-00002e50: 7468 6520 5552 4c20 666f 7220 7468 6520  the URL for the 
-00002e60: 4150 4920 7365 7276 6572 2066 726f 6d20  API server from 
-00002e70: 7468 6520 636f 6e66 6967 7572 6174 696f  the configuratio
-00002e80: 6e20 2d20 6060 6d6c 636f 6e66 2e64 6270  n - ``mlconf.dbp
-00002e90: 6174 6860 602e 0a0a 2020 2020 2020 2020  ath``...        
-00002ea0: 466f 7220 6578 616d 706c 653a 3a0a 0a20  For example::.. 
-00002eb0: 2020 2020 2020 2020 2020 206d 6c63 6f6e             mlcon
-00002ec0: 662e 6462 7061 7468 203d 206d 6c63 6f6e  f.dbpath = mlcon
-00002ed0: 662e 6462 7061 7468 206f 7220 2768 7474  f.dbpath or 'htt
-00002ee0: 703a 2f2f 6d6c 7275 6e2d 6170 693a 3830  p://mlrun-api:80
-00002ef0: 3830 270a 2020 2020 2020 2020 2020 2020  80'.            
-00002f00: 6462 203d 2067 6574 5f72 756e 5f64 6228  db = get_run_db(
-00002f10: 292e 636f 6e6e 6563 7428 290a 2020 2020  ).connect().    
-00002f20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00002f30: 2320 6861 636b 2074 6f20 616c 6c6f 7720  # hack to allow 
-00002f40: 756e 6974 2074 6573 7473 2074 6f20 696e  unit tests to in
-00002f50: 7374 616e 7469 6174 6520 4854 5450 5275  stantiate HTTPRu
-00002f60: 6e44 4220 7769 7468 6f75 7420 6120 7265  nDB without a re
-00002f70: 616c 2073 6572 7665 7220 6265 6869 6e64  al server behind
-00002f80: 0a20 2020 2020 2020 2069 6620 226d 6f63  .        if "moc
-00002f90: 6b2d 7365 7276 6572 2220 696e 2073 656c  k-server" in sel
-00002fa0: 662e 6261 7365 5f75 726c 3a0a 2020 2020  f.base_url:.    
-00002fb0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00002fc0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-00002fd0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
-00002fe0: 222c 2022 636c 6965 6e74 2d73 7065 6322  ", "client-spec"
-00002ff0: 2c20 7469 6d65 6f75 743d 3529 0a20 2020  , timeout=5).   
-00003000: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00003010: 2020 2020 2020 7365 7276 6572 5f63 6667        server_cfg
-00003020: 203d 2072 6573 702e 6a73 6f6e 2829 0a20   = resp.json(). 
-00003030: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00003040: 7365 7276 6572 5f76 6572 7369 6f6e 203d  server_version =
-00003050: 2073 6572 7665 725f 6366 675b 2276 6572   server_cfg["ver
-00003060: 7369 6f6e 225d 0a20 2020 2020 2020 2020  sion"].         
-00003070: 2020 2073 656c 662e 5f76 616c 6964 6174     self._validat
-00003080: 655f 7665 7273 696f 6e5f 636f 6d70 6174  e_version_compat
-00003090: 6962 696c 6974 7928 7365 6c66 2e73 6572  ibility(self.ser
-000030a0: 7665 725f 7665 7273 696f 6e2c 2063 6f6e  ver_version, con
-000030b0: 6669 672e 7665 7273 696f 6e29 0a20 2020  fig.version).   
-000030c0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-000030d0: 6e61 6d65 7370 6163 6520 3d20 636f 6e66  namespace = conf
-000030e0: 6967 2e6e 616d 6573 7061 6365 206f 7220  ig.namespace or 
-000030f0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-00003100: 6e61 6d65 7370 6163 6522 290a 2020 2020  namespace").    
-00003110: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00003120: 2020 2020 2020 2020 2020 2020 2022 6e61               "na
-00003130: 6d65 7370 6163 6522 2069 6e20 7365 7276  mespace" in serv
-00003140: 6572 5f63 6667 0a20 2020 2020 2020 2020  er_cfg.         
-00003150: 2020 2020 2020 2061 6e64 2073 6572 7665         and serve
-00003160: 725f 6366 675b 226e 616d 6573 7061 6365  r_cfg["namespace
-00003170: 225d 2021 3d20 636f 6e66 6967 2e6e 616d  "] != config.nam
-00003180: 6573 7061 6365 0a20 2020 2020 2020 2020  espace.         
-00003190: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-000031a0: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-000031b0: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
-000031c0: 2020 2020 2020 2020 2020 6622 7761 726e            f"warn
-000031d0: 696e 6721 2c20 7365 7276 6572 2028 7b73  ing!, server ({s
-000031e0: 6572 7665 725f 6366 675b 276e 616d 6573  erver_cfg['names
-000031f0: 7061 6365 275d 7d29 2061 6e64 2063 6c69  pace']}) and cli
-00003200: 656e 7420 287b 636f 6e66 6967 2e6e 616d  ent ({config.nam
-00003210: 6573 7061 6365 7d29 220a 2020 2020 2020  espace})".      
-00003220: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00003230: 6e61 6d65 7370 6163 6520 646f 6e27 7420  namespace don't 
-00003240: 6d61 7463 6822 0a20 2020 2020 2020 2020  match".         
-00003250: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00003260: 2020 2020 2069 6620 636f 6e66 6967 2e63       if config.c
-00003270: 652e 6d6f 6465 2061 6e64 2063 6f6e 6669  e.mode and confi
-00003280: 672e 6365 2e6d 6f64 6520 213d 2073 6572  g.ce.mode != ser
-00003290: 7665 725f 6366 672e 6765 7428 2263 655f  ver_cfg.get("ce_
-000032a0: 6d6f 6465 222c 2022 2229 3a0a 2020 2020  mode", ""):.    
-000032b0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-000032c0: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
-000032d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000032e0: 6622 7761 726e 696e 6721 2c20 7365 7276  f"warning!, serv
-000032f0: 6572 2028 7b73 6572 7665 725f 6366 675b  er ({server_cfg[
-00003300: 2763 655f 6d6f 6465 275d 7d29 2061 6e64  'ce_mode']}) and
-00003310: 2063 6c69 656e 7420 287b 636f 6e66 6967   client ({config
-00003320: 2e63 652e 6d6f 6465 7d29 220a 2020 2020  .ce.mode})".    
-00003330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003340: 2220 4345 206d 6f64 6520 646f 6e27 7420  " CE mode don't 
-00003350: 6d61 7463 6822 0a20 2020 2020 2020 2020  match".         
-00003360: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00003370: 2020 2020 2063 6f6e 6669 672e 6365 203d       config.ce =
-00003380: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00003390: 2263 6522 2920 6f72 2063 6f6e 6669 672e  "ce") or config.
-000033a0: 6365 0a0a 2020 2020 2020 2020 2020 2020  ce..            
-000033b0: 2320 6765 7420 6465 6661 756c 7473 2066  # get defaults f
-000033c0: 726f 6d20 7265 6d6f 7465 2073 6572 7665  rom remote serve
-000033d0: 720a 2020 2020 2020 2020 2020 2020 636f  r.            co
-000033e0: 6e66 6967 2e72 656d 6f74 655f 686f 7374  nfig.remote_host
-000033f0: 203d 2063 6f6e 6669 672e 7265 6d6f 7465   = config.remote
-00003400: 5f68 6f73 7420 6f72 2073 6572 7665 725f  _host or server_
-00003410: 6366 672e 6765 7428 2272 656d 6f74 655f  cfg.get("remote_
-00003420: 686f 7374 2229 0a20 2020 2020 2020 2020  host").         
-00003430: 2020 2063 6f6e 6669 672e 6d70 696a 6f62     config.mpijob
-00003440: 5f63 7264 5f76 6572 7369 6f6e 203d 2063  _crd_version = c
-00003450: 6f6e 6669 672e 6d70 696a 6f62 5f63 7264  onfig.mpijob_crd
-00003460: 5f76 6572 7369 6f6e 206f 7220 7365 7276  _version or serv
-00003470: 6572 5f63 6667 2e67 6574 280a 2020 2020  er_cfg.get(.    
-00003480: 2020 2020 2020 2020 2020 2020 226d 7069              "mpi
-00003490: 6a6f 625f 6372 645f 7665 7273 696f 6e22  job_crd_version"
-000034a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000034b0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-000034c0: 672e 7569 2e75 726c 203d 2063 6f6e 6669  g.ui.url = confi
-000034d0: 672e 7265 736f 6c76 655f 7569 5f75 726c  g.resolve_ui_url
-000034e0: 2829 206f 7220 7365 7276 6572 5f63 6667  () or server_cfg
-000034f0: 2e67 6574 2822 7569 5f75 726c 2229 0a20  .get("ui_url"). 
-00003500: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00003510: 672e 6172 7469 6661 6374 5f70 6174 6820  g.artifact_path 
-00003520: 3d20 636f 6e66 6967 2e61 7274 6966 6163  = config.artifac
-00003530: 745f 7061 7468 206f 7220 7365 7276 6572  t_path or server
-00003540: 5f63 6667 2e67 6574 280a 2020 2020 2020  _cfg.get(.      
-00003550: 2020 2020 2020 2020 2020 2261 7274 6966            "artif
-00003560: 6163 745f 7061 7468 220a 2020 2020 2020  act_path".      
-00003570: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00003580: 2020 2020 636f 6e66 6967 2e66 6561 7475      config.featu
-00003590: 7265 5f73 746f 7265 2e64 6174 615f 7072  re_store.data_pr
-000035a0: 6566 6978 6573 203d 2028 0a20 2020 2020  efixes = (.     
-000035b0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-000035c0: 672e 6665 6174 7572 655f 7374 6f72 652e  g.feature_store.
-000035d0: 6461 7461 5f70 7265 6669 7865 730a 2020  data_prefixes.  
-000035e0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-000035f0: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00003600: 2266 6561 7475 7265 5f73 746f 7265 5f64  "feature_store_d
-00003610: 6174 615f 7072 6566 6978 6573 2229 0a20  ata_prefixes"). 
-00003620: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00003630: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00003640: 7370 6172 6b5f 6170 705f 696d 6167 6520  spark_app_image 
-00003650: 3d20 636f 6e66 6967 2e73 7061 726b 5f61  = config.spark_a
-00003660: 7070 5f69 6d61 6765 206f 7220 7365 7276  pp_image or serv
-00003670: 6572 5f63 6667 2e67 6574 280a 2020 2020  er_cfg.get(.    
-00003680: 2020 2020 2020 2020 2020 2020 2273 7061              "spa
-00003690: 726b 5f61 7070 5f69 6d61 6765 220a 2020  rk_app_image".  
-000036a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000036b0: 2020 2020 2020 2020 636f 6e66 6967 2e73          config.s
-000036c0: 7061 726b 5f61 7070 5f69 6d61 6765 5f74  park_app_image_t
-000036d0: 6167 203d 2063 6f6e 6669 672e 7370 6172  ag = config.spar
-000036e0: 6b5f 6170 705f 696d 6167 655f 7461 6720  k_app_image_tag 
-000036f0: 6f72 2073 6572 7665 725f 6366 672e 6765  or server_cfg.ge
-00003700: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00003710: 2020 2022 7370 6172 6b5f 6170 705f 696d     "spark_app_im
-00003720: 6167 655f 7461 6722 0a20 2020 2020 2020  age_tag".       
-00003730: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00003740: 2020 2063 6f6e 6669 672e 7370 6172 6b5f     config.spark_
-00003750: 6869 7374 6f72 795f 7365 7276 6572 5f70  history_server_p
-00003760: 6174 6820 3d20 280a 2020 2020 2020 2020  ath = (.        
-00003770: 2020 2020 2020 2020 636f 6e66 6967 2e73          config.s
-00003780: 7061 726b 5f68 6973 746f 7279 5f73 6572  park_history_ser
-00003790: 7665 725f 7061 7468 0a20 2020 2020 2020  ver_path.       
-000037a0: 2020 2020 2020 2020 206f 7220 7365 7276           or serv
-000037b0: 6572 5f63 6667 2e67 6574 2822 7370 6172  er_cfg.get("spar
-000037c0: 6b5f 6869 7374 6f72 795f 7365 7276 6572  k_history_server
-000037d0: 5f70 6174 6822 290a 2020 2020 2020 2020  _path").        
-000037e0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000037f0: 2020 636f 6e66 6967 2e68 7474 7064 622e    config.httpdb.
-00003800: 6275 696c 6465 722e 646f 636b 6572 5f72  builder.docker_r
-00003810: 6567 6973 7472 7920 3d20 280a 2020 2020  egistry = (.    
-00003820: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00003830: 6967 2e68 7474 7064 622e 6275 696c 6465  ig.httpdb.builde
-00003840: 722e 646f 636b 6572 5f72 6567 6973 7472  r.docker_registr
-00003850: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-00003860: 2020 6f72 2073 6572 7665 725f 6366 672e    or server_cfg.
-00003870: 6765 7428 2264 6f63 6b65 725f 7265 6769  get("docker_regi
-00003880: 7374 7279 2229 0a20 2020 2020 2020 2020  stry").         
-00003890: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000038a0: 2063 6f6e 6669 672e 6874 7470 6462 2e61   config.httpdb.a
-000038b0: 7069 5f75 726c 203d 2063 6f6e 6669 672e  pi_url = config.
-000038c0: 6874 7470 6462 2e61 7069 5f75 726c 206f  httpdb.api_url o
-000038d0: 7220 7365 7276 6572 5f63 6667 2e67 6574  r server_cfg.get
-000038e0: 2822 6170 695f 7572 6c22 290a 2020 2020  ("api_url").    
-000038f0: 2020 2020 2020 2020 636f 6e66 6967 2e6e          config.n
-00003900: 7563 6c69 6f5f 7665 7273 696f 6e20 3d20  uclio_version = 
-00003910: 636f 6e66 6967 2e6e 7563 6c69 6f5f 7665  config.nuclio_ve
-00003920: 7273 696f 6e20 6f72 2073 6572 7665 725f  rsion or server_
-00003930: 6366 672e 6765 7428 0a20 2020 2020 2020  cfg.get(.       
-00003940: 2020 2020 2020 2020 2022 6e75 636c 696f           "nuclio
-00003950: 5f76 6572 7369 6f6e 220a 2020 2020 2020  _version".      
-00003960: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00003970: 2020 2020 636f 6e66 6967 2e64 6566 6175      config.defau
-00003980: 6c74 5f66 756e 6374 696f 6e5f 7072 696f  lt_function_prio
-00003990: 7269 7479 5f63 6c61 7373 5f6e 616d 6520  rity_class_name 
-000039a0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-000039b0: 2020 2020 636f 6e66 6967 2e64 6566 6175      config.defau
-000039c0: 6c74 5f66 756e 6374 696f 6e5f 7072 696f  lt_function_prio
-000039d0: 7269 7479 5f63 6c61 7373 5f6e 616d 650a  rity_class_name.
-000039e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039f0: 6f72 2073 6572 7665 725f 6366 672e 6765  or server_cfg.ge
-00003a00: 7428 2264 6566 6175 6c74 5f66 756e 6374  t("default_funct
-00003a10: 696f 6e5f 7072 696f 7269 7479 5f63 6c61  ion_priority_cla
-00003a20: 7373 5f6e 616d 6522 290a 2020 2020 2020  ss_name").      
-00003a30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00003a40: 2020 2020 636f 6e66 6967 2e76 616c 6964      config.valid
-00003a50: 5f66 756e 6374 696f 6e5f 7072 696f 7269  _function_priori
-00003a60: 7479 5f63 6c61 7373 5f6e 616d 6573 203d  ty_class_names =
-00003a70: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00003a80: 2020 2063 6f6e 6669 672e 7661 6c69 645f     config.valid_
-00003a90: 6675 6e63 7469 6f6e 5f70 7269 6f72 6974  function_priorit
-00003aa0: 795f 636c 6173 735f 6e61 6d65 730a 2020  y_class_names.  
-00003ab0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00003ac0: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00003ad0: 2276 616c 6964 5f66 756e 6374 696f 6e5f  "valid_function_
-00003ae0: 7072 696f 7269 7479 5f63 6c61 7373 5f6e  priority_class_n
-00003af0: 616d 6573 2229 0a20 2020 2020 2020 2020  ames").         
-00003b00: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00003b10: 2063 6f6e 6669 672e 6172 7469 6661 6374   config.artifact
-00003b20: 732e 6361 6c63 756c 6174 655f 6861 7368  s.calculate_hash
-00003b30: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00003b40: 2020 2020 2063 6f6e 6669 672e 6172 7469       config.arti
-00003b50: 6661 6374 732e 6361 6c63 756c 6174 655f  facts.calculate_
-00003b60: 6861 7368 0a20 2020 2020 2020 2020 2020  hash.           
-00003b70: 2020 2020 2069 6620 636f 6e66 6967 2e61       if config.a
-00003b80: 7274 6966 6163 7473 2e63 616c 6375 6c61  rtifacts.calcula
-00003b90: 7465 5f68 6173 6820 6973 206e 6f74 204e  te_hash is not N
-00003ba0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00003bb0: 2020 2020 656c 7365 2073 6572 7665 725f      else server_
-00003bc0: 6366 672e 6765 7428 2263 616c 6375 6c61  cfg.get("calcula
-00003bd0: 7465 5f61 7274 6966 6163 745f 6861 7368  te_artifact_hash
-00003be0: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
-00003bf0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00003c00: 6669 672e 6172 7469 6661 6374 732e 6765  fig.artifacts.ge
-00003c10: 6e65 7261 7465 5f74 6172 6765 745f 7061  nerate_target_pa
-00003c20: 7468 5f66 726f 6d5f 6172 7469 6661 6374  th_from_artifact
-00003c30: 5f68 6173 6820 3d20 280a 2020 2020 2020  _hash = (.      
-00003c40: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00003c50: 2e61 7274 6966 6163 7473 2e67 656e 6572  .artifacts.gener
-00003c60: 6174 655f 7461 7267 6574 5f70 6174 685f  ate_target_path_
-00003c70: 6672 6f6d 5f61 7274 6966 6163 745f 6861  from_artifact_ha
-00003c80: 7368 0a20 2020 2020 2020 2020 2020 2020  sh.             
-00003c90: 2020 2069 6620 636f 6e66 6967 2e61 7274     if config.art
-00003ca0: 6966 6163 7473 2e67 656e 6572 6174 655f  ifacts.generate_
-00003cb0: 7461 7267 6574 5f70 6174 685f 6672 6f6d  target_path_from
-00003cc0: 5f61 7274 6966 6163 745f 6861 7368 2069  _artifact_hash i
-00003cd0: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
-00003ce0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-00003cf0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-00003d00: 6765 6e65 7261 7465 5f61 7274 6966 6163  generate_artifac
-00003d10: 745f 7461 7267 6574 5f70 6174 685f 6672  t_target_path_fr
-00003d20: 6f6d 5f61 7274 6966 6163 745f 6861 7368  om_artifact_hash
-00003d30: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
-00003d40: 0a0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00003d50: 6e66 6967 2e72 6564 6973 2e75 726c 203d  nfig.redis.url =
-00003d60: 2063 6f6e 6669 672e 7265 6469 732e 7572   config.redis.ur
-00003d70: 6c20 6f72 2073 6572 7665 725f 6366 672e  l or server_cfg.
-00003d80: 6765 7428 2272 6564 6973 5f75 726c 2229  get("redis_url")
-00003d90: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
-00003da0: 6c6c 6f77 2063 6c69 656e 7420 746f 2073  llow client to s
-00003db0: 6574 2074 6865 2064 6566 6175 6c74 2070  et the default p
-00003dc0: 6172 7469 616c 2057 4120 666f 7220 6c61  artial WA for la
-00003dd0: 636b 206f 6620 7375 7070 6f72 7420 6f66  ck of support of
-00003de0: 2070 6572 2d74 6172 6765 7420 6175 7869   per-target auxi
-00003df0: 6c69 6172 7920 6f70 7469 6f6e 730a 2020  liary options.  
-00003e00: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00003e10: 2e72 6564 6973 2e74 7970 6520 3d20 636f  .redis.type = co
-00003e20: 6e66 6967 2e72 6564 6973 2e74 7970 6520  nfig.redis.type 
-00003e30: 6f72 2073 6572 7665 725f 6366 672e 6765  or server_cfg.ge
-00003e40: 7428 2272 6564 6973 5f74 7970 6522 290a  t("redis_type").
-00003e50: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00003e60: 6669 672e 7371 6c2e 7572 6c20 3d20 636f  fig.sql.url = co
-00003e70: 6e66 6967 2e73 716c 2e75 726c 206f 7220  nfig.sql.url or 
-00003e80: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-00003e90: 7371 6c5f 7572 6c22 290a 2020 2020 2020  sql_url").      
-00003ea0: 2020 2020 2020 2320 5468 6573 6520 6861        # These ha
-00003eb0: 7665 2061 2064 6566 6175 6c74 2076 616c  ve a default val
-00003ec0: 7565 2c20 7468 6572 6566 6f72 6520 6c6f  ue, therefore lo
-00003ed0: 6361 6c20 636f 6e66 6967 2077 696c 6c20  cal config will 
-00003ee0: 616c 7761 7973 2068 6176 6520 6120 7661  always have a va
-00003ef0: 6c75 652c 2070 7269 6f72 6974 697a 6520  lue, prioritize 
-00003f00: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00003f10: 2320 4150 4920 7661 6c75 6520 6669 7273  # API value firs
-00003f20: 740a 2020 2020 2020 2020 2020 2020 636f  t.            co
-00003f30: 6e66 6967 2e75 692e 7072 6f6a 6563 7473  nfig.ui.projects
-00003f40: 5f70 7265 6669 7820 3d20 280a 2020 2020  _prefix = (.    
-00003f50: 2020 2020 2020 2020 2020 2020 7365 7276              serv
-00003f60: 6572 5f63 6667 2e67 6574 2822 7569 5f70  er_cfg.get("ui_p
-00003f70: 726f 6a65 6374 735f 7072 6566 6978 2229  rojects_prefix")
-00003f80: 206f 7220 636f 6e66 6967 2e75 692e 7072   or config.ui.pr
-00003f90: 6f6a 6563 7473 5f70 7265 6669 780a 2020  ojects_prefix.  
-00003fa0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00003fb0: 2020 2020 2020 2020 636f 6e66 6967 2e6b          config.k
-00003fc0: 6670 5f69 6d61 6765 203d 2073 6572 7665  fp_image = serve
-00003fd0: 725f 6366 672e 6765 7428 226b 6670 5f69  r_cfg.get("kfp_i
-00003fe0: 6d61 6765 2229 206f 7220 636f 6e66 6967  mage") or config
-00003ff0: 2e6b 6670 5f69 6d61 6765 0a20 2020 2020  .kfp_image.     
-00004000: 2020 2020 2020 2063 6f6e 6669 672e 6b66         config.kf
-00004010: 705f 7572 6c20 3d20 7365 7276 6572 5f63  p_url = server_c
-00004020: 6667 2e67 6574 2822 6b66 705f 7572 6c22  fg.get("kfp_url"
-00004030: 2920 6f72 2063 6f6e 6669 672e 6b66 705f  ) or config.kfp_
-00004040: 7572 6c0a 2020 2020 2020 2020 2020 2020  url.            
-00004050: 636f 6e66 6967 2e64 6173 6b5f 6b66 705f  config.dask_kfp_
-00004060: 696d 6167 6520 3d20 280a 2020 2020 2020  image = (.      
-00004070: 2020 2020 2020 2020 2020 7365 7276 6572            server
-00004080: 5f63 6667 2e67 6574 2822 6461 736b 5f6b  _cfg.get("dask_k
-00004090: 6670 5f69 6d61 6765 2229 206f 7220 636f  fp_image") or co
-000040a0: 6e66 6967 2e64 6173 6b5f 6b66 705f 696d  nfig.dask_kfp_im
-000040b0: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
-000040c0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-000040d0: 6e66 6967 2e73 6372 6170 655f 6d65 7472  nfig.scrape_metr
-000040e0: 6963 7320 3d20 280a 2020 2020 2020 2020  ics = (.        
-000040f0: 2020 2020 2020 2020 7365 7276 6572 5f63          server_c
-00004100: 6667 2e67 6574 2822 7363 7261 7065 5f6d  fg.get("scrape_m
-00004110: 6574 7269 6373 2229 0a20 2020 2020 2020  etrics").       
-00004120: 2020 2020 2020 2020 2069 6620 7365 7276           if serv
-00004130: 6572 5f63 6667 2e67 6574 2822 7363 7261  er_cfg.get("scra
-00004140: 7065 5f6d 6574 7269 6373 2229 2069 7320  pe_metrics") is 
-00004150: 6e6f 7420 4e6f 6e65 0a20 2020 2020 2020  not None.       
-00004160: 2020 2020 2020 2020 2065 6c73 6520 636f           else co
-00004170: 6e66 6967 2e73 6372 6170 655f 6d65 7472  nfig.scrape_metr
-00004180: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
-00004190: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-000041a0: 6e66 6967 2e68 7562 5f75 726c 203d 2073  nfig.hub_url = s
-000041b0: 6572 7665 725f 6366 672e 6765 7428 2268  erver_cfg.get("h
-000041c0: 7562 5f75 726c 2229 206f 7220 636f 6e66  ub_url") or conf
-000041d0: 6967 2e68 7562 5f75 726c 0a20 2020 2020  ig.hub_url.     
-000041e0: 2020 2020 2020 2063 6f6e 6669 672e 6465         config.de
-000041f0: 6661 756c 745f 6675 6e63 7469 6f6e 5f6e  fault_function_n
-00004200: 6f64 655f 7365 6c65 6374 6f72 203d 2028  ode_selector = (
-00004210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004220: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00004230: 2264 6566 6175 6c74 5f66 756e 6374 696f  "default_functio
-00004240: 6e5f 6e6f 6465 5f73 656c 6563 746f 7222  n_node_selector"
-00004250: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004260: 2020 6f72 2063 6f6e 6669 672e 6465 6661    or config.defa
-00004270: 756c 745f 6675 6e63 7469 6f6e 5f6e 6f64  ult_function_nod
-00004280: 655f 7365 6c65 6374 6f72 0a20 2020 2020  e_selector.     
-00004290: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000042a0: 2020 2020 2063 6f6e 6669 672e 6967 7a5f       config.igz_
-000042b0: 7665 7273 696f 6e20 3d20 7365 7276 6572  version = server
-000042c0: 5f63 6667 2e67 6574 2822 6967 7a5f 7665  _cfg.get("igz_ve
-000042d0: 7273 696f 6e22 2920 6f72 2063 6f6e 6669  rsion") or confi
-000042e0: 672e 6967 7a5f 7665 7273 696f 6e0a 2020  g.igz_version.  
-000042f0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00004300: 2e73 746f 7261 6765 2e61 7574 6f5f 6d6f  .storage.auto_mo
-00004310: 756e 745f 7479 7065 203d 2028 0a20 2020  unt_type = (.   
-00004320: 2020 2020 2020 2020 2020 2020 2073 6572               ser
-00004330: 7665 725f 6366 672e 6765 7428 2261 7574  ver_cfg.get("aut
-00004340: 6f5f 6d6f 756e 745f 7479 7065 2229 206f  o_mount_type") o
-00004350: 7220 636f 6e66 6967 2e73 746f 7261 6765  r config.storage
-00004360: 2e61 7574 6f5f 6d6f 756e 745f 7479 7065  .auto_mount_type
-00004370: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00004380: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00004390: 672e 7374 6f72 6167 652e 6175 746f 5f6d  g.storage.auto_m
-000043a0: 6f75 6e74 5f70 6172 616d 7320 3d20 280a  ount_params = (.
-000043b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043c0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-000043d0: 6175 746f 5f6d 6f75 6e74 5f70 6172 616d  auto_mount_param
-000043e0: 7322 2920 6f72 2063 6f6e 6669 672e 7374  s") or config.st
-000043f0: 6f72 6167 652e 6175 746f 5f6d 6f75 6e74  orage.auto_mount
-00004400: 5f70 6172 616d 730a 2020 2020 2020 2020  _params.        
-00004410: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00004420: 2020 636f 6e66 6967 2e73 7061 726b 5f6f    config.spark_o
-00004430: 7065 7261 746f 725f 7665 7273 696f 6e20  perator_version 
-00004440: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00004450: 2020 2020 7365 7276 6572 5f63 6667 2e67      server_cfg.g
-00004460: 6574 2822 7370 6172 6b5f 6f70 6572 6174  et("spark_operat
-00004470: 6f72 5f76 6572 7369 6f6e 2229 0a20 2020  or_version").   
-00004480: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-00004490: 636f 6e66 6967 2e73 7061 726b 5f6f 7065  config.spark_ope
-000044a0: 7261 746f 725f 7665 7273 696f 6e0a 2020  rator_version.  
-000044b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000044c0: 2020 2020 2020 2020 636f 6e66 6967 2e64          config.d
-000044d0: 6566 6175 6c74 5f74 656e 736f 7262 6f61  efault_tensorboa
-000044e0: 7264 5f6c 6f67 735f 7061 7468 203d 2028  rd_logs_path = (
-000044f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004500: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00004510: 2264 6566 6175 6c74 5f74 656e 736f 7262  "default_tensorb
-00004520: 6f61 7264 5f6c 6f67 735f 7061 7468 2229  oard_logs_path")
-00004530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004540: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
-00004550: 6c74 5f74 656e 736f 7262 6f61 7264 5f6c  lt_tensorboard_l
-00004560: 6f67 735f 7061 7468 0a20 2020 2020 2020  ogs_path.       
-00004570: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00004580: 2020 2063 6f6e 6669 672e 6465 6661 756c     config.defaul
-00004590: 745f 6675 6e63 7469 6f6e 5f70 6f64 5f72  t_function_pod_r
-000045a0: 6573 6f75 7263 6573 203d 2028 0a20 2020  esources = (.   
-000045b0: 2020 2020 2020 2020 2020 2020 2073 6572               ser
-000045c0: 7665 725f 6366 672e 6765 7428 2264 6566  ver_cfg.get("def
-000045d0: 6175 6c74 5f66 756e 6374 696f 6e5f 706f  ault_function_po
-000045e0: 645f 7265 736f 7572 6365 7322 290a 2020  d_resources").  
-000045f0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00004600: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
-00004610: 6675 6e63 7469 6f6e 5f70 6f64 5f72 6573  function_pod_res
-00004620: 6f75 7263 6573 0a20 2020 2020 2020 2020  ources.         
-00004630: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00004640: 2063 6f6e 6669 672e 6675 6e63 7469 6f6e   config.function
-00004650: 5f64 6566 6175 6c74 732e 7072 6565 6d70  _defaults.preemp
-00004660: 7469 6f6e 5f6d 6f64 6520 3d20 280a 2020  tion_mode = (.  
-00004670: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00004680: 7276 6572 5f63 6667 2e67 6574 2822 6465  rver_cfg.get("de
-00004690: 6661 756c 745f 7072 6565 6d70 7469 6f6e  fault_preemption
-000046a0: 5f6d 6f64 6522 290a 2020 2020 2020 2020  _mode").        
-000046b0: 2020 2020 2020 2020 6f72 2063 6f6e 6669          or confi
-000046c0: 672e 6675 6e63 7469 6f6e 5f64 6566 6175  g.function_defau
-000046d0: 6c74 732e 7072 6565 6d70 7469 6f6e 5f6d  lts.preemption_m
-000046e0: 6f64 650a 2020 2020 2020 2020 2020 2020  ode.            
-000046f0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00004700: 6e66 6967 2e70 7265 656d 7074 6962 6c65  nfig.preemptible
-00004710: 5f6e 6f64 6573 2e6e 6f64 655f 7365 6c65  _nodes.node_sele
-00004720: 6374 6f72 203d 2028 0a20 2020 2020 2020  ctor = (.       
-00004730: 2020 2020 2020 2020 2073 6572 7665 725f           server_
-00004740: 6366 672e 6765 7428 2270 7265 656d 7074  cfg.get("preempt
-00004750: 6962 6c65 5f6e 6f64 6573 5f6e 6f64 655f  ible_nodes_node_
-00004760: 7365 6c65 6374 6f72 2229 0a20 2020 2020  selector").     
-00004770: 2020 2020 2020 2020 2020 206f 7220 636f             or co
-00004780: 6e66 6967 2e70 7265 656d 7074 6962 6c65  nfig.preemptible
-00004790: 5f6e 6f64 6573 2e6e 6f64 655f 7365 6c65  _nodes.node_sele
-000047a0: 6374 6f72 0a20 2020 2020 2020 2020 2020  ctor.           
-000047b0: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-000047c0: 6f6e 6669 672e 7072 6565 6d70 7469 626c  onfig.preemptibl
-000047d0: 655f 6e6f 6465 732e 746f 6c65 7261 7469  e_nodes.tolerati
-000047e0: 6f6e 7320 3d20 280a 2020 2020 2020 2020  ons = (.        
-000047f0: 2020 2020 2020 2020 7365 7276 6572 5f63          server_c
-00004800: 6667 2e67 6574 2822 7072 6565 6d70 7469  fg.get("preempti
-00004810: 626c 655f 6e6f 6465 735f 746f 6c65 7261  ble_nodes_tolera
-00004820: 7469 6f6e 7322 290a 2020 2020 2020 2020  tions").        
-00004830: 2020 2020 2020 2020 6f72 2063 6f6e 6669          or confi
-00004840: 672e 7072 6565 6d70 7469 626c 655f 6e6f  g.preemptible_no
-00004850: 6465 732e 746f 6c65 7261 7469 6f6e 730a  des.tolerations.
-00004860: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00004870: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00004880: 2e66 6f72 6365 5f72 756e 5f6c 6f63 616c  .force_run_local
-00004890: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-000048a0: 2020 2020 2073 6572 7665 725f 6366 672e       server_cfg.
-000048b0: 6765 7428 2266 6f72 6365 5f72 756e 5f6c  get("force_run_l
-000048c0: 6f63 616c 2229 206f 7220 636f 6e66 6967  ocal") or config
-000048d0: 2e66 6f72 6365 5f72 756e 5f6c 6f63 616c  .force_run_local
-000048e0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000048f0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00004900: 672e 6675 6e63 7469 6f6e 203d 2073 6572  g.function = ser
-00004910: 7665 725f 6366 672e 6765 7428 2266 756e  ver_cfg.get("fun
-00004920: 6374 696f 6e22 2920 6f72 2063 6f6e 6669  ction") or confi
-00004930: 672e 6675 6e63 7469 6f6e 0a20 2020 2020  g.function.     
-00004940: 2020 2020 2020 2063 6f6e 6669 672e 6874         config.ht
-00004950: 7470 6462 2e6c 6f67 7320 3d20 7365 7276  tpdb.logs = serv
-00004960: 6572 5f63 6667 2e67 6574 2822 6c6f 6773  er_cfg.get("logs
-00004970: 2229 206f 7220 636f 6e66 6967 2e68 7474  ") or config.htt
-00004980: 7064 622e 6c6f 6773 0a0a 2020 2020 2020  pdb.logs..      
-00004990: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-000049a0: 6f6e 2061 7320 6578 633a 0a20 2020 2020  on as exc:.     
-000049b0: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
-000049c0: 726e 696e 6728 0a20 2020 2020 2020 2020  rning(.         
-000049d0: 2020 2020 2020 2022 4661 696c 6564 2073         "Failed s
-000049e0: 796e 6369 6e67 2063 6f6e 6669 6720 6672  yncing config fr
-000049f0: 6f6d 2073 6572 7665 7222 2c0a 2020 2020  om server",.    
-00004a00: 2020 2020 2020 2020 2020 2020 6578 633d              exc=
-00004a10: 6572 725f 746f 5f73 7472 2865 7863 292c  err_to_str(exc),
-00004a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004a30: 2074 7261 6365 6261 636b 3d74 7261 6365   traceback=trace
-00004a40: 6261 636b 2e66 6f72 6d61 745f 6578 6328  back.format_exc(
-00004a50: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
-00004a60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004a70: 7365 6c66 0a0a 2020 2020 6465 6620 7374  self..    def st
-00004a80: 6f72 655f 6c6f 6728 7365 6c66 2c20 7569  ore_log(self, ui
-00004a90: 642c 2070 726f 6a65 6374 3d22 222c 2062  d, project="", b
-00004aa0: 6f64 793d 4e6f 6e65 2c20 6170 7065 6e64  ody=None, append
-00004ab0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-00004ac0: 2022 2222 5361 7665 2061 206c 6f67 2070   """Save a log p
-00004ad0: 6572 7369 7374 656e 746c 792e 0a0a 2020  ersistently...  
-00004ae0: 2020 2020 2020 3a70 6172 616d 2075 6964        :param uid
-00004af0: 3a20 4c6f 6720 756e 6971 7565 2049 440a  : Log unique ID.
-00004b00: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00004b10: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
-00004b20: 6e61 6d65 2066 6f72 2077 6869 6368 2074  name for which t
-00004b30: 6869 7320 6c6f 6720 6265 6c6f 6e67 730a  his log belongs.
-00004b40: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
-00004b50: 6f64 793a 2054 6865 2061 6374 7561 6c20  ody: The actual 
-00004b60: 6c6f 6720 746f 2073 746f 7265 0a20 2020  log to store.   
-00004b70: 2020 2020 203a 7061 7261 6d20 6170 7065       :param appe
-00004b80: 6e64 3a20 5768 6574 6865 7220 746f 2061  nd: Whether to a
-00004b90: 7070 656e 6420 7468 6520 6c6f 6720 7072  ppend the log pr
-00004ba0: 6f76 6964 6564 2069 6e20 6060 626f 6479  ovided in ``body
-00004bb0: 6060 2074 6f20 616e 2065 7869 7374 696e  `` to an existin
-00004bc0: 6720 6c6f 6720 7769 7468 2074 6865 2073  g log with the s
-00004bd0: 616d 6520 6060 7569 6460 6020 6f72 2074  ame ``uid`` or t
-00004be0: 6f0a 2020 2020 2020 2020 2020 2020 6372  o.            cr
-00004bf0: 6561 7465 2061 206e 6577 206c 6f67 2e20  eate a new log. 
-00004c00: 4966 2073 6574 2074 6f20 6060 4661 6c73  If set to ``Fals
-00004c10: 6560 602c 2061 6e20 6578 6973 7469 6e67  e``, an existing
-00004c20: 206c 6f67 2077 6974 6820 7361 6d65 2060   log with same `
-00004c30: 6075 6964 6060 2077 696c 6c20 6265 206f  `uid`` will be o
-00004c40: 7665 7277 7269 7474 656e 0a20 2020 2020  verwritten.     
-00004c50: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00004c60: 6966 206e 6f74 2062 6f64 793a 0a20 2020  if not body:.   
-00004c70: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00004c80: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00004c90: 7365 6c66 2e5f 7061 7468 5f6f 6628 226c  self._path_of("l
-00004ca0: 6f67 222c 2070 726f 6a65 6374 2c20 7569  og", project, ui
-00004cb0: 6429 0a20 2020 2020 2020 2070 6172 616d  d).        param
-00004cc0: 7320 3d20 7b22 6170 7065 6e64 223a 2062  s = {"append": b
-00004cd0: 6f6f 6c32 7374 7228 6170 7065 6e64 297d  ool2str(append)}
-00004ce0: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
-00004cf0: 2066 2273 746f 7265 206c 6f67 207b 7072   f"store log {pr
-00004d00: 6f6a 6563 747d 2f7b 7569 647d 220a 2020  oject}/{uid}".  
-00004d10: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
-00004d20: 616c 6c28 2250 4f53 5422 2c20 7061 7468  all("POST", path
-00004d30: 2c20 6572 726f 722c 2070 6172 616d 732c  , error, params,
-00004d40: 2062 6f64 7929 0a0a 2020 2020 6465 6620   body)..    def 
-00004d50: 6765 745f 6c6f 6728 7365 6c66 2c20 7569  get_log(self, ui
-00004d60: 642c 2070 726f 6a65 6374 3d22 222c 206f  d, project="", o
-00004d70: 6666 7365 743d 302c 2073 697a 653d 2d31  ffset=0, size=-1
-00004d80: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-00004d90: 7472 6965 7665 2061 206c 6f67 2e0a 0a20  trieve a log... 
-00004da0: 2020 2020 2020 203a 7061 7261 6d20 7569         :param ui
-00004db0: 643a 204c 6f67 2075 6e69 7175 6520 4944  d: Log unique ID
-00004dc0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00004dd0: 7072 6f6a 6563 743a 2050 726f 6a65 6374  project: Project
-00004de0: 206e 616d 6520 666f 7220 7768 6963 6820   name for which 
-00004df0: 7468 6520 6c6f 6720 6265 6c6f 6e67 730a  the log belongs.
-00004e00: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-00004e10: 6666 7365 743a 2052 6574 7269 6576 6520  ffset: Retrieve 
-00004e20: 7061 7274 6961 6c20 6c6f 672c 2067 6574  partial log, get
-00004e30: 2075 7020 746f 2060 6073 697a 6560 6020   up to ``size`` 
-00004e40: 6279 7465 7320 7374 6172 7469 6e67 2061  bytes starting a
-00004e50: 7420 6f66 6673 6574 2060 606f 6666 7365  t offset ``offse
-00004e60: 7460 600a 2020 2020 2020 2020 2020 2020  t``.            
-00004e70: 6672 6f6d 2062 6567 696e 6e69 6e67 206f  from beginning o
-00004e80: 6620 6c6f 670a 2020 2020 2020 2020 3a70  f log.        :p
-00004e90: 6172 616d 2073 697a 653a 2053 6565 2060  aram size: See `
-00004ea0: 606f 6666 7365 7460 602e 2049 6620 7365  `offset``. If se
-00004eb0: 7420 746f 2060 602d 3160 6020 2874 6865  t to ``-1`` (the
-00004ec0: 2064 6566 6175 6c74 2920 7769 6c6c 2072   default) will r
-00004ed0: 6574 7269 6576 6520 616c 6c20 6461 7461  etrieve all data
-00004ee0: 2074 6f20 656e 6420 6f66 206c 6f67 2e0a   to end of log..
-00004ef0: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
-00004f00: 3a20 5468 6520 666f 6c6c 6f77 696e 6720  : The following 
-00004f10: 6f62 6a65 6374 733a 0a0a 2020 2020 2020  objects:..      
-00004f20: 2020 2020 2020 2d20 7374 6174 6520 2d20        - state - 
-00004f30: 5468 6520 7374 6174 6520 6f66 2074 6865  The state of the
-00004f40: 2072 756e 7469 6d65 206f 626a 6563 7420   runtime object 
-00004f50: 7768 6963 6820 6765 6e65 7261 7465 7320  which generates 
-00004f60: 7468 6973 206c 6f67 2c20 6966 2069 7420  this log, if it 
-00004f70: 6578 6973 7473 2e20 496e 2063 6173 6520  exists. In case 
-00004f80: 6e6f 206b 6e6f 776e 2073 7461 7465 0a20  no known state. 
-00004f90: 2020 2020 2020 2020 2020 2020 2065 7869               exi
-00004fa0: 7374 732c 2074 6869 7320 7769 6c6c 2062  sts, this will b
-00004fb0: 6520 6060 756e 6b6e 6f77 6e60 602e 0a20  e ``unknown``.. 
-00004fc0: 2020 2020 2020 2020 2020 202d 2063 6f6e             - con
-00004fd0: 7465 6e74 202d 2054 6865 2061 6374 7561  tent - The actua
-00004fe0: 6c20 6c6f 6720 636f 6e74 656e 742e 0a20  l log content.. 
-00004ff0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00005000: 2020 2020 7061 7261 6d73 203d 207b 226f      params = {"o
-00005010: 6666 7365 7422 3a20 6f66 6673 6574 2c20  ffset": offset, 
-00005020: 2273 697a 6522 3a20 7369 7a65 7d0a 2020  "size": size}.  
-00005030: 2020 2020 2020 7061 7468 203d 2073 656c        path = sel
-00005040: 662e 5f70 6174 685f 6f66 2822 6c6f 6722  f._path_of("log"
-00005050: 2c20 7072 6f6a 6563 742c 2075 6964 290a  , project, uid).
-00005060: 2020 2020 2020 2020 6572 726f 7220 3d20          error = 
-00005070: 6622 6765 7420 6c6f 6720 7b70 726f 6a65  f"get log {proje
-00005080: 6374 7d2f 7b75 6964 7d22 0a20 2020 2020  ct}/{uid}".     
-00005090: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
-000050a0: 7069 5f63 616c 6c28 2247 4554 222c 2070  pi_call("GET", p
-000050b0: 6174 682c 2065 7272 6f72 2c20 7061 7261  ath, error, para
-000050c0: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
-000050d0: 2020 2069 6620 7265 7370 2e68 6561 6465     if resp.heade
-000050e0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-000050f0: 7374 6174 6520 3d20 7265 7370 2e68 6561  state = resp.hea
-00005100: 6465 7273 2e67 6574 2822 782d 6d6c 7275  ders.get("x-mlru
-00005110: 6e2d 7275 6e2d 7374 6174 6522 2c20 2222  n-run-state", ""
-00005120: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00005130: 7475 726e 2073 7461 7465 2e6c 6f77 6572  turn state.lower
-00005140: 2829 2c20 7265 7370 2e63 6f6e 7465 6e74  (), resp.content
-00005150: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00005160: 2022 756e 6b6e 6f77 6e22 2c20 7265 7370   "unknown", resp
-00005170: 2e63 6f6e 7465 6e74 0a0a 2020 2020 6465  .content..    de
-00005180: 6620 7761 7463 685f 6c6f 6728 7365 6c66  f watch_log(self
-00005190: 2c20 7569 642c 2070 726f 6a65 6374 3d22  , uid, project="
-000051a0: 222c 2077 6174 6368 3d54 7275 652c 206f  ", watch=True, o
-000051b0: 6666 7365 743d 3029 3a0a 2020 2020 2020  ffset=0):.      
-000051c0: 2020 2222 2252 6574 7269 6576 6520 6c6f    """Retrieve lo
-000051d0: 6773 206f 6620 6120 7275 6e6e 696e 6720  gs of a running 
-000051e0: 7072 6f63 6573 732c 2061 6e64 2077 6174  process, and wat
-000051f0: 6368 2074 6865 2070 726f 6772 6573 7320  ch the progress 
-00005200: 6f66 2074 6865 2065 7865 6375 7469 6f6e  of the execution
-00005210: 2075 6e74 696c 2069 7420 636f 6d70 6c65   until it comple
-00005220: 7465 732e 2054 6869 730a 2020 2020 2020  tes. This.      
-00005230: 2020 6d65 7468 6f64 2077 696c 6c20 7072    method will pr
-00005240: 696e 7420 6f75 7420 7468 6520 6c6f 6773  int out the logs
-00005250: 2061 6e64 2063 6f6e 7469 6e75 6520 746f   and continue to
-00005260: 2070 6572 696f 6469 6361 6c6c 7920 706f   periodically po
-00005270: 6c6c 2066 6f72 2c20 616e 6420 7072 696e  ll for, and prin
-00005280: 742c 206e 6577 206c 6f67 7320 6173 206c  t, new logs as l
-00005290: 6f6e 6720 6173 2074 6865 0a20 2020 2020  ong as the.     
-000052a0: 2020 2073 7461 7465 206f 6620 7468 6520     state of the 
-000052b0: 7275 6e74 696d 6520 7768 6963 6820 6765  runtime which ge
-000052c0: 6e65 7261 7465 7320 7468 6973 206c 6f67  nerates this log
-000052d0: 2069 7320 6569 7468 6572 2060 6070 656e   is either ``pen
-000052e0: 6469 6e67 6060 206f 7220 6060 7275 6e6e  ding`` or ``runn
-000052f0: 696e 6760 602e 0a0a 2020 2020 2020 2020  ing``...        
-00005300: 3a70 6172 616d 2075 6964 3a20 5468 6520  :param uid: The 
-00005310: 7569 6420 6f66 2074 6865 206c 6f67 206f  uid of the log o
-00005320: 626a 6563 7420 746f 2077 6174 6368 2e0a  bject to watch..
-00005330: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00005340: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
-00005350: 7468 6174 2074 6865 206c 6f67 2062 656c  that the log bel
-00005360: 6f6e 6773 2074 6f2e 0a20 2020 2020 2020  ongs to..       
-00005370: 203a 7061 7261 6d20 7761 7463 683a 2049   :param watch: I
-00005380: 6620 7365 7420 746f 2060 6054 7275 6560  f set to ``True`
-00005390: 6020 7769 6c6c 2063 6f6e 7469 6e75 6520  ` will continue 
-000053a0: 7472 6163 6b69 6e67 2074 6865 206c 6f67  tracking the log
-000053b0: 2061 7320 6465 7363 7269 6265 6420 6162   as described ab
-000053c0: 6f76 652e 204f 7468 6572 7769 7365 2074  ove. Otherwise t
-000053d0: 6869 7320 6675 6e63 7469 6f6e 0a20 2020  his function.   
-000053e0: 2020 2020 2020 2020 2069 7320 7072 6163           is prac
-000053f0: 7469 6361 6c6c 7920 6571 7569 7661 6c65  tically equivale
-00005400: 6e74 2074 6f20 7468 6520 3a70 793a 6675  nt to the :py:fu
-00005410: 6e63 3a60 7e67 6574 5f6c 6f67 6020 6675  nc:`~get_log` fu
-00005420: 6e63 7469 6f6e 2e0a 2020 2020 2020 2020  nction..        
-00005430: 3a70 6172 616d 206f 6666 7365 743a 204d  :param offset: M
-00005440: 696e 696d 616c 206f 6666 7365 7420 696e  inimal offset in
-00005450: 2074 6865 206c 6f67 2074 6f20 7761 7463   the log to watc
-00005460: 682e 0a20 2020 2020 2020 203a 7265 7475  h..        :retu
-00005470: 726e 733a 2054 6865 2066 696e 616c 2073  rns: The final s
-00005480: 7461 7465 206f 6620 7468 6520 6c6f 6720  tate of the log 
-00005490: 6265 696e 6720 7761 7463 6865 642e 0a20  being watched.. 
-000054a0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000054b0: 2020 2020 7374 6174 652c 2074 6578 7420      state, text 
-000054c0: 3d20 7365 6c66 2e67 6574 5f6c 6f67 2875  = self.get_log(u
-000054d0: 6964 2c20 7072 6f6a 6563 742c 206f 6666  id, project, off
-000054e0: 7365 743d 6f66 6673 6574 290a 2020 2020  set=offset).    
-000054f0: 2020 2020 6966 2074 6578 743a 0a20 2020      if text:.   
-00005500: 2020 2020 2020 2020 2070 7269 6e74 2874           print(t
-00005510: 6578 742e 6465 636f 6465 2865 7272 6f72  ext.decode(error
-00005520: 733d 6d6c 7275 6e2e 6d6c 636f 6e66 2e68  s=mlrun.mlconf.h
-00005530: 7474 7064 622e 6c6f 6773 2e64 6563 6f64  ttpdb.logs.decod
-00005540: 652e 6572 726f 7273 2929 0a20 2020 2020  e.errors)).     
-00005550: 2020 2069 6620 7761 7463 683a 0a20 2020     if watch:.   
-00005560: 2020 2020 2020 2020 206e 696c 5f72 6573           nil_res
-00005570: 7020 3d20 300a 2020 2020 2020 2020 2020  p = 0.          
-00005580: 2020 7768 696c 6520 7374 6174 6520 696e    while state in
-00005590: 205b 2270 656e 6469 6e67 222c 2022 7275   ["pending", "ru
-000055a0: 6e6e 696e 6722 5d3a 0a20 2020 2020 2020  nning"]:.       
-000055b0: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
-000055c0: 2b3d 206c 656e 2874 6578 7429 0a20 2020  += len(text).   
-000055d0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-000055e0: 6620 7765 2067 6574 2033 206e 696c 2072  f we get 3 nil r
-000055f0: 6573 706f 6e73 6573 2069 6e20 6120 726f  esponses in a ro
-00005600: 772c 2069 6e63 7265 6173 6520 7468 6520  w, increase the 
-00005610: 736c 6565 7020 7469 6d65 2074 6f20 3130  sleep time to 10
-00005620: 2073 6563 6f6e 6473 0a20 2020 2020 2020   seconds.       
-00005630: 2020 2020 2020 2020 2023 2054 4f44 4f3a           # TODO:
-00005640: 2072 6566 6163 746f 7220 7468 6973 2074   refactor this t
-00005650: 6f20 7573 6520 6120 636f 6e64 6974 696f  o use a conditio
-00005660: 6e61 6c20 6261 636b 6f66 6620 6d65 6368  nal backoff mech
-00005670: 616e 6973 6d0a 2020 2020 2020 2020 2020  anism.          
-00005680: 2020 2020 2020 6966 206e 696c 5f72 6573        if nil_res
-00005690: 7020 3c20 333a 0a20 2020 2020 2020 2020  p < 3:.         
-000056a0: 2020 2020 2020 2020 2020 2074 696d 652e             time.
-000056b0: 736c 6565 7028 696e 7428 6d6c 7275 6e2e  sleep(int(mlrun.
-000056c0: 6d6c 636f 6e66 2e68 7474 7064 622e 6c6f  mlconf.httpdb.lo
-000056d0: 6773 2e70 756c 6c5f 6c6f 6773 5f64 6566  gs.pull_logs_def
-000056e0: 6175 6c74 5f69 6e74 6572 7661 6c29 290a  ault_interval)).
-000056f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005700: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00005710: 2020 2020 2020 2020 2020 7469 6d65 2e73            time.s
-00005720: 6c65 6570 280a 2020 2020 2020 2020 2020  leep(.          
-00005730: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00005740: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00005750: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00005760: 6c72 756e 2e6d 6c63 6f6e 662e 6874 7470  lrun.mlconf.http
-00005770: 6462 2e6c 6f67 732e 7075 6c6c 5f6c 6f67  db.logs.pull_log
-00005780: 735f 6261 636b 6f66 665f 6e6f 5f6c 6f67  s_backoff_no_log
-00005790: 735f 6465 6661 756c 745f 696e 7465 7276  s_default_interv
-000057a0: 616c 0a20 2020 2020 2020 2020 2020 2020  al.             
-000057b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000057c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057d0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-000057e0: 2020 2073 7461 7465 2c20 7465 7874 203d     state, text =
-000057f0: 2073 656c 662e 6765 745f 6c6f 6728 7569   self.get_log(ui
-00005800: 642c 2070 726f 6a65 6374 2c20 6f66 6673  d, project, offs
-00005810: 6574 3d6f 6666 7365 7429 0a20 2020 2020  et=offset).     
-00005820: 2020 2020 2020 2020 2020 2069 6620 7465             if te
-00005830: 7874 3a0a 2020 2020 2020 2020 2020 2020  xt:.            
-00005840: 2020 2020 2020 2020 6e69 6c5f 7265 7370          nil_resp
-00005850: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00005860: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00005870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005880: 2020 2020 2020 2020 7465 7874 2e64 6563          text.dec
-00005890: 6f64 6528 6572 726f 7273 3d6d 6c72 756e  ode(errors=mlrun
-000058a0: 2e6d 6c63 6f6e 662e 6874 7470 6462 2e6c  .mlconf.httpdb.l
-000058b0: 6f67 732e 6465 636f 6465 2e65 7272 6f72  ogs.decode.error
-000058c0: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
-000058d0: 2020 2020 2020 2020 2020 2020 656e 643d              end=
-000058e0: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-000058f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00005900: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005920: 2020 2020 6e69 6c5f 7265 7370 202b 3d20      nil_resp += 
-00005930: 310a 2020 2020 2020 2020 656c 7365 3a0a  1.        else:.
-00005940: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
-00005950: 6574 202b 3d20 6c65 6e28 7465 7874 290a  et += len(text).
-00005960: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00005970: 7374 6174 652c 206f 6666 7365 740a 0a20  state, offset.. 
-00005980: 2020 2064 6566 2073 746f 7265 5f72 756e     def store_run
-00005990: 2873 656c 662c 2073 7472 7563 742c 2075  (self, struct, u
-000059a0: 6964 2c20 7072 6f6a 6563 743d 2222 2c20  id, project="", 
-000059b0: 6974 6572 3d30 293a 0a20 2020 2020 2020  iter=0):.       
-000059c0: 2022 2222 5374 6f72 6520 7275 6e20 6465   """Store run de
-000059d0: 7461 696c 7320 696e 2074 6865 2044 422e  tails in the DB.
-000059e0: 2054 6869 7320 6d65 7468 6f64 2069 7320   This method is 
-000059f0: 7573 7561 6c6c 7920 6361 6c6c 6564 2066  usually called f
-00005a00: 726f 6d20 7769 7468 696e 206f 7468 6572  rom within other
-00005a10: 203a 7079 3a6d 6f64 3a60 6d6c 7275 6e60   :py:mod:`mlrun`
-00005a20: 2066 6c6f 7773 0a20 2020 2020 2020 2061   flows.        a
-00005a30: 6e64 206e 6f74 2063 616c 6c65 6420 6469  nd not called di
-00005a40: 7265 6374 6c79 2062 7920 7468 6520 7573  rectly by the us
-00005a50: 6572 2e22 2222 0a0a 2020 2020 2020 2020  er."""..        
-00005a60: 7061 7468 203d 2073 656c 662e 5f70 6174  path = self._pat
-00005a70: 685f 6f66 2822 7275 6e22 2c20 7072 6f6a  h_of("run", proj
-00005a80: 6563 742c 2075 6964 290a 2020 2020 2020  ect, uid).      
-00005a90: 2020 7061 7261 6d73 203d 207b 2269 7465    params = {"ite
-00005aa0: 7222 3a20 6974 6572 7d0a 2020 2020 2020  r": iter}.      
-00005ab0: 2020 6572 726f 7220 3d20 6622 7374 6f72    error = f"stor
-00005ac0: 6520 7275 6e20 7b70 726f 6a65 6374 7d2f  e run {project}/
-00005ad0: 7b75 6964 7d22 0a20 2020 2020 2020 2062  {uid}".        b
-00005ae0: 6f64 7920 3d20 5f61 735f 6a73 6f6e 2873  ody = _as_json(s
-00005af0: 7472 7563 7429 0a20 2020 2020 2020 2073  truct).        s
-00005b00: 656c 662e 6170 695f 6361 6c6c 2822 504f  elf.api_call("PO
-00005b10: 5354 222c 2070 6174 682c 2065 7272 6f72  ST", path, error
-00005b20: 2c20 7061 7261 6d73 3d70 6172 616d 732c  , params=params,
-00005b30: 2062 6f64 793d 626f 6479 290a 0a20 2020   body=body)..   
-00005b40: 2064 6566 2075 7064 6174 655f 7275 6e28   def update_run(
-00005b50: 7365 6c66 2c20 7570 6461 7465 733a 2064  self, updates: d
-00005b60: 6963 742c 2075 6964 2c20 7072 6f6a 6563  ict, uid, projec
-00005b70: 743d 2222 2c20 6974 6572 3d30 2c20 7469  t="", iter=0, ti
-00005b80: 6d65 6f75 743d 3435 293a 0a20 2020 2020  meout=45):.     
-00005b90: 2020 2022 2222 5570 6461 7465 2074 6865     """Update the
-00005ba0: 2064 6574 6169 6c73 206f 6620 6120 7374   details of a st
-00005bb0: 6f72 6564 2072 756e 2069 6e20 7468 6520  ored run in the 
-00005bc0: 4442 2e22 2222 0a0a 2020 2020 2020 2020  DB."""..        
-00005bd0: 7061 7468 203d 2073 656c 662e 5f70 6174  path = self._pat
-00005be0: 685f 6f66 2822 7275 6e22 2c20 7072 6f6a  h_of("run", proj
-00005bf0: 6563 742c 2075 6964 290a 2020 2020 2020  ect, uid).      
-00005c00: 2020 7061 7261 6d73 203d 207b 2269 7465    params = {"ite
-00005c10: 7222 3a20 6974 6572 7d0a 2020 2020 2020  r": iter}.      
-00005c20: 2020 6572 726f 7220 3d20 6622 7570 6461    error = f"upda
-00005c30: 7465 2072 756e 207b 7072 6f6a 6563 747d  te run {project}
-00005c40: 2f7b 7569 647d 220a 2020 2020 2020 2020  /{uid}".        
-00005c50: 626f 6479 203d 205f 6173 5f6a 736f 6e28  body = _as_json(
-00005c60: 7570 6461 7465 7329 0a20 2020 2020 2020  updates).       
-00005c70: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-00005c80: 5041 5443 4822 2c20 7061 7468 2c20 6572  PATCH", path, er
-00005c90: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
-00005ca0: 6d73 2c20 626f 6479 3d62 6f64 792c 2074  ms, body=body, t
-00005cb0: 696d 656f 7574 3d74 696d 656f 7574 290a  imeout=timeout).
-00005cc0: 0a20 2020 2064 6566 2061 626f 7274 5f72  .    def abort_r
-00005cd0: 756e 2873 656c 662c 2075 6964 2c20 7072  un(self, uid, pr
-00005ce0: 6f6a 6563 743d 2222 2c20 6974 6572 3d30  oject="", iter=0
-00005cf0: 2c20 7469 6d65 6f75 743d 3435 293a 0a20  , timeout=45):. 
-00005d00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00005d10: 2020 2041 626f 7274 2061 2072 756e 6e69     Abort a runni
-00005d20: 6e67 2072 756e 202d 2077 696c 6c20 7265  ng run - will re
-00005d30: 6d6f 7665 2074 6865 2072 756e 2773 2072  move the run's r
-00005d40: 756e 7469 6d65 2072 6573 6f75 7263 6573  untime resources
-00005d50: 2061 6e64 206d 6172 6b20 6974 7320 7374   and mark its st
-00005d60: 6174 6520 6173 2061 626f 7274 6564 0a20  ate as aborted. 
-00005d70: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00005d80: 2020 2073 656c 662e 7570 6461 7465 5f72     self.update_r
-00005d90: 756e 280a 2020 2020 2020 2020 2020 2020  un(.            
-00005da0: 7b22 7374 6174 7573 2e73 7461 7465 223a  {"status.state":
-00005db0: 206d 6c72 756e 2e72 756e 7469 6d65 732e   mlrun.runtimes.
-00005dc0: 636f 6e73 7461 6e74 732e 5275 6e53 7461  constants.RunSta
-00005dd0: 7465 732e 6162 6f72 7465 647d 2c0a 2020  tes.aborted},.  
-00005de0: 2020 2020 2020 2020 2020 7569 642c 0a20            uid,. 
-00005df0: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
-00005e00: 6374 2c0a 2020 2020 2020 2020 2020 2020  ct,.            
-00005e10: 6974 6572 2c0a 2020 2020 2020 2020 2020  iter,.          
-00005e20: 2020 7469 6d65 6f75 742c 0a20 2020 2020    timeout,.     
-00005e30: 2020 2029 0a0a 2020 2020 6465 6620 7265     )..    def re
-00005e40: 6164 5f72 756e 2873 656c 662c 2075 6964  ad_run(self, uid
-00005e50: 2c20 7072 6f6a 6563 743d 2222 2c20 6974  , project="", it
-00005e60: 6572 3d30 293a 0a20 2020 2020 2020 2022  er=0):.        "
-00005e70: 2222 5265 6164 2074 6865 2064 6574 6169  ""Read the detai
-00005e80: 6c73 206f 6620 6120 7374 6f72 6564 2072  ls of a stored r
-00005e90: 756e 2066 726f 6d20 7468 6520 4442 2e0a  un from the DB..
-00005ea0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00005eb0: 7569 643a 2054 6865 2072 756e 2773 2075  uid: The run's u
-00005ec0: 6e69 7175 6520 4944 2e0a 2020 2020 2020  nique ID..      
-00005ed0: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
-00005ee0: 3a20 5072 6f6a 6563 7420 6e61 6d65 2e0a  : Project name..
-00005ef0: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-00005f00: 7465 723a 2049 7465 7261 7469 6f6e 2077  ter: Iteration w
-00005f10: 6974 6869 6e20 6120 7370 6563 6966 6963  ithin a specific
-00005f20: 2065 7865 6375 7469 6f6e 2e0a 2020 2020   execution..    
-00005f30: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00005f40: 2070 6174 6820 3d20 7365 6c66 2e5f 7061   path = self._pa
-00005f50: 7468 5f6f 6628 2272 756e 222c 2070 726f  th_of("run", pro
-00005f60: 6a65 6374 2c20 7569 6429 0a20 2020 2020  ject, uid).     
-00005f70: 2020 2070 6172 616d 7320 3d20 7b22 6974     params = {"it
-00005f80: 6572 223a 2069 7465 727d 0a20 2020 2020  er": iter}.     
-00005f90: 2020 2065 7272 6f72 203d 2066 2267 6574     error = f"get
-00005fa0: 2072 756e 207b 7072 6f6a 6563 747d 2f7b   run {project}/{
-00005fb0: 7569 647d 220a 2020 2020 2020 2020 7265  uid}".        re
-00005fc0: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
-00005fd0: 6c6c 2822 4745 5422 2c20 7061 7468 2c20  ll("GET", path, 
-00005fe0: 6572 726f 722c 2070 6172 616d 733d 7061  error, params=pa
-00005ff0: 7261 6d73 290a 2020 2020 2020 2020 7265  rams).        re
-00006000: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
-00006010: 5b22 6461 7461 225d 0a0a 2020 2020 6465  ["data"]..    de
-00006020: 6620 6465 6c5f 7275 6e28 7365 6c66 2c20  f del_run(self, 
-00006030: 7569 642c 2070 726f 6a65 6374 3d22 222c  uid, project="",
-00006040: 2069 7465 723d 3029 3a0a 2020 2020 2020   iter=0):.      
-00006050: 2020 2222 2244 656c 6574 6520 6465 7461    """Delete deta
-00006060: 696c 7320 6f66 2061 2073 7065 6369 6669  ils of a specifi
-00006070: 6320 7275 6e20 6672 6f6d 2044 422e 0a0a  c run from DB...
-00006080: 2020 2020 2020 2020 3a70 6172 616d 2075          :param u
-00006090: 6964 3a20 556e 6971 7565 2049 4420 666f  id: Unique ID fo
-000060a0: 7220 7468 6520 7370 6563 6966 6963 2072  r the specific r
-000060b0: 756e 2074 6f20 6465 6c65 7465 2e0a 2020  un to delete..  
-000060c0: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
-000060d0: 6a65 6374 3a20 5072 6f6a 6563 7420 7468  ject: Project th
-000060e0: 6174 2074 6865 2072 756e 2062 656c 6f6e  at the run belon
-000060f0: 6773 2074 6f2e 0a20 2020 2020 2020 203a  gs to..        :
-00006100: 7061 7261 6d20 6974 6572 3a20 4974 6572  param iter: Iter
-00006110: 6174 696f 6e20 7769 7468 696e 2061 2073  ation within a s
-00006120: 7065 6369 6669 6320 7461 736b 2e0a 2020  pecific task..  
-00006130: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00006140: 2020 2070 6174 6820 3d20 7365 6c66 2e5f     path = self._
-00006150: 7061 7468 5f6f 6628 2272 756e 222c 2070  path_of("run", p
-00006160: 726f 6a65 6374 2c20 7569 6429 0a20 2020  roject, uid).   
-00006170: 2020 2020 2070 6172 616d 7320 3d20 7b22       params = {"
-00006180: 6974 6572 223a 2069 7465 727d 0a20 2020  iter": iter}.   
-00006190: 2020 2020 2065 7272 6f72 203d 2066 2264       error = f"d
-000061a0: 656c 2072 756e 207b 7072 6f6a 6563 747d  el run {project}
-000061b0: 2f7b 7569 647d 220a 2020 2020 2020 2020  /{uid}".        
-000061c0: 7365 6c66 2e61 7069 5f63 616c 6c28 2244  self.api_call("D
-000061d0: 454c 4554 4522 2c20 7061 7468 2c20 6572  ELETE", path, er
-000061e0: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
-000061f0: 6d73 290a 0a20 2020 2064 6566 206c 6973  ms)..    def lis
-00006200: 745f 7275 6e73 280a 2020 2020 2020 2020  t_runs(.        
-00006210: 7365 6c66 2c0a 2020 2020 2020 2020 6e61  self,.        na
-00006220: 6d65 3a20 4f70 7469 6f6e 616c 5b73 7472  me: Optional[str
-00006230: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00006240: 2020 7569 643a 204f 7074 696f 6e61 6c5b    uid: Optional[
-00006250: 556e 696f 6e5b 7374 722c 204c 6973 745b  Union[str, List[
-00006260: 7374 725d 5d5d 203d 204e 6f6e 652c 0a20  str]]] = None,. 
-00006270: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
-00006280: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-00006290: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
-000062a0: 6265 6c73 3a20 4f70 7469 6f6e 616c 5b55  bels: Optional[U
-000062b0: 6e69 6f6e 5b73 7472 2c20 4c69 7374 5b73  nion[str, List[s
-000062c0: 7472 5d5d 5d20 3d20 4e6f 6e65 2c0a 2020  tr]]] = None,.  
-000062d0: 2020 2020 2020 7374 6174 653a 204f 7074        state: Opt
-000062e0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-000062f0: 652c 0a20 2020 2020 2020 2073 6f72 743a  e,.        sort:
-00006300: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-00006310: 2020 2020 2020 6c61 7374 3a20 696e 7420        last: int 
-00006320: 3d20 302c 0a20 2020 2020 2020 2069 7465  = 0,.        ite
-00006330: 723a 2062 6f6f 6c20 3d20 4661 6c73 652c  r: bool = False,
-00006340: 0a20 2020 2020 2020 2073 7461 7274 5f74  .        start_t
-00006350: 696d 655f 6672 6f6d 3a20 4f70 7469 6f6e  ime_from: Option
-00006360: 616c 5b64 6174 6574 696d 655d 203d 204e  al[datetime] = N
-00006370: 6f6e 652c 0a20 2020 2020 2020 2073 7461  one,.        sta
-00006380: 7274 5f74 696d 655f 746f 3a20 4f70 7469  rt_time_to: Opti
-00006390: 6f6e 616c 5b64 6174 6574 696d 655d 203d  onal[datetime] =
-000063a0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
-000063b0: 6173 745f 7570 6461 7465 5f74 696d 655f  ast_update_time_
-000063c0: 6672 6f6d 3a20 4f70 7469 6f6e 616c 5b64  from: Optional[d
-000063d0: 6174 6574 696d 655d 203d 204e 6f6e 652c  atetime] = None,
-000063e0: 0a20 2020 2020 2020 206c 6173 745f 7570  .        last_up
-000063f0: 6461 7465 5f74 696d 655f 746f 3a20 4f70  date_time_to: Op
-00006400: 7469 6f6e 616c 5b64 6174 6574 696d 655d  tional[datetime]
-00006410: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00006420: 2070 6172 7469 7469 6f6e 5f62 793a 204f   partition_by: O
-00006430: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
-00006440: 2020 2020 2055 6e69 6f6e 5b6d 6c72 756e       Union[mlrun
-00006450: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00006460: 5275 6e50 6172 7469 7469 6f6e 4279 4669  RunPartitionByFi
-00006470: 656c 642c 2073 7472 5d0a 2020 2020 2020  eld, str].      
-00006480: 2020 5d20 3d20 4e6f 6e65 2c0a 2020 2020    ] = None,.    
-00006490: 2020 2020 726f 7773 5f70 6572 5f70 6172      rows_per_par
-000064a0: 7469 7469 6f6e 3a20 696e 7420 3d20 312c  tition: int = 1,
-000064b0: 0a20 2020 2020 2020 2070 6172 7469 7469  .        partiti
-000064c0: 6f6e 5f73 6f72 745f 6279 3a20 4f70 7469  on_sort_by: Opti
-000064d0: 6f6e 616c 5b55 6e69 6f6e 5b6d 6c72 756e  onal[Union[mlrun
-000064e0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-000064f0: 536f 7274 4669 656c 642c 2073 7472 5d5d  SortField, str]]
-00006500: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00006510: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-00006520: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
-00006530: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
-00006540: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
-00006550: 7970 652c 2073 7472 0a20 2020 2020 2020  ype, str.       
-00006560: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
-00006570: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
-00006580: 7970 652e 6465 7363 2c0a 2020 2020 2020  ype.desc,.      
-00006590: 2020 6d61 785f 7061 7274 6974 696f 6e73    max_partitions
-000065a0: 3a20 696e 7420 3d20 302c 0a20 2020 2020  : int = 0,.     
-000065b0: 2020 2077 6974 685f 6e6f 7469 6669 6361     with_notifica
-000065c0: 7469 6f6e 733a 2062 6f6f 6c20 3d20 4661  tions: bool = Fa
-000065d0: 6c73 652c 0a20 2020 2029 202d 3e20 5275  lse,.    ) -> Ru
-000065e0: 6e4c 6973 743a 0a20 2020 2020 2020 2022  nList:.        "
-000065f0: 2222 5265 7472 6965 7665 2061 206c 6973  ""Retrieve a lis
-00006600: 7420 6f66 2072 756e 732c 2066 696c 7465  t of runs, filte
-00006610: 7265 6420 6279 2076 6172 696f 7573 206f  red by various o
-00006620: 7074 696f 6e73 2e0a 2020 2020 2020 2020  ptions..        
-00006630: 4578 616d 706c 653a 3a0a 0a20 2020 2020  Example::..     
-00006640: 2020 2020 2020 2072 756e 7320 3d20 6462         runs = db
-00006650: 2e6c 6973 745f 7275 6e73 286e 616d 653d  .list_runs(name=
-00006660: 2764 6f77 6e6c 6f61 6427 2c20 7072 6f6a  'download', proj
-00006670: 6563 743d 2769 7269 7327 2c20 6c61 6265  ect='iris', labe
-00006680: 6c73 3d5b 276f 776e 6572 3d61 646d 696e  ls=['owner=admin
-00006690: 272c 2027 6b69 6e64 3d6a 6f62 275d 290a  ', 'kind=job']).
-000066a0: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-000066b0: 2072 756e 6e69 6e67 2069 6e20 4a75 7079   running in Jupy
-000066c0: 7465 722c 2063 616e 2075 7365 2074 6865  ter, can use the
-000066d0: 202e 7368 6f77 2829 2066 756e 6374 696f   .show() functio
-000066e0: 6e20 746f 2064 6973 706c 6179 2074 6865  n to display the
-000066f0: 2072 6573 756c 7473 0a20 2020 2020 2020   results.       
-00006700: 2020 2020 2064 622e 6c69 7374 5f72 756e       db.list_run
-00006710: 7328 6e61 6d65 3d27 272c 2070 726f 6a65  s(name='', proje
-00006720: 6374 3d70 726f 6a65 6374 5f6e 616d 6529  ct=project_name)
-00006730: 2e73 686f 7728 290a 0a0a 2020 2020 2020  .show()...      
-00006740: 2020 3a70 6172 616d 206e 616d 653a 204e    :param name: N
-00006750: 616d 6520 6f66 2074 6865 2072 756e 2074  ame of the run t
-00006760: 6f20 7265 7472 6965 7665 2e0a 2020 2020  o retrieve..    
-00006770: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
-00006780: 556e 6971 7565 2049 4420 6f66 2074 6865  Unique ID of the
-00006790: 2072 756e 2c20 6f72 2061 206c 6973 7420   run, or a list 
-000067a0: 6f66 2072 756e 2055 4944 732e 0a20 2020  of run UIDs..   
-000067b0: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
-000067c0: 6563 743a 2050 726f 6a65 6374 2074 6861  ect: Project tha
-000067d0: 7420 7468 6520 7275 6e73 2062 656c 6f6e  t the runs belon
-000067e0: 6773 2074 6f2e 0a20 2020 2020 2020 203a  gs to..        :
-000067f0: 7061 7261 6d20 6c61 6265 6c73 3a20 4c69  param labels: Li
-00006800: 7374 2072 756e 7320 7468 6174 2068 6176  st runs that hav
-00006810: 6520 7370 6563 6966 6963 206c 6162 656c  e specific label
-00006820: 7320 6173 7369 676e 6564 2e20 6120 7369  s assigned. a si
-00006830: 6e67 6c65 206f 7220 6d75 6c74 6920 6c61  ngle or multi la
-00006840: 6265 6c20 6669 6c74 6572 2063 616e 2062  bel filter can b
-00006850: 650a 2020 2020 2020 2020 2020 2020 6170  e.            ap
-00006860: 706c 6965 642e 0a20 2020 2020 2020 203a  plied..        :
-00006870: 7061 7261 6d20 7374 6174 653a 204c 6973  param state: Lis
-00006880: 7420 6f6e 6c79 2072 756e 7320 7768 6f73  t only runs whos
-00006890: 6520 7374 6174 6520 6973 2073 7065 6369  e state is speci
-000068a0: 6669 6564 2e0a 2020 2020 2020 2020 3a70  fied..        :p
-000068b0: 6172 616d 2073 6f72 743a 2057 6865 7468  aram sort: Wheth
-000068c0: 6572 2074 6f20 736f 7274 2074 6865 2072  er to sort the r
-000068d0: 6573 756c 7420 6163 636f 7264 696e 6720  esult according 
-000068e0: 746f 2074 6865 6972 2073 7461 7274 2074  to their start t
-000068f0: 696d 652e 204f 7468 6572 7769 7365 2c20  ime. Otherwise, 
-00006900: 7265 7375 6c74 7320 7769 6c6c 2062 650a  results will be.
-00006910: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00006920: 726e 6564 2062 7920 7468 6569 7220 696e  rned by their in
-00006930: 7465 726e 616c 206f 7264 6572 2069 6e20  ternal order in 
-00006940: 7468 6520 4442 2028 6f72 6465 7220 7769  the DB (order wi
-00006950: 6c6c 206e 6f74 2062 6520 6775 6172 616e  ll not be guaran
-00006960: 7465 6564 292e 0a20 2020 2020 2020 203a  teed)..        :
-00006970: 7061 7261 6d20 6c61 7374 3a20 4465 7072  param last: Depr
-00006980: 6563 6174 6564 202d 2063 7572 7265 6e74  ecated - current
-00006990: 6c79 206e 6f74 2075 7365 642e 0a20 2020  ly not used..   
-000069a0: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
-000069b0: 3a20 4966 2060 6054 7275 6560 6020 7265  : If ``True`` re
-000069c0: 7475 726e 2072 756e 7320 6672 6f6d 2061  turn runs from a
-000069d0: 6c6c 2069 7465 7261 7469 6f6e 732e 204f  ll iterations. O
-000069e0: 7468 6572 7769 7365 2c20 7265 7475 726e  therwise, return
-000069f0: 206f 6e6c 7920 7275 6e73 2077 686f 7365   only runs whose
-00006a00: 2060 6069 7465 7260 6020 6973 2030 2e0a   ``iter`` is 0..
-00006a10: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00006a20: 7461 7274 5f74 696d 655f 6672 6f6d 3a20  tart_time_from: 
-00006a30: 4669 6c74 6572 2062 7920 7275 6e20 7374  Filter by run st
-00006a40: 6172 7420 7469 6d65 2069 6e20 6060 5b73  art time in ``[s
-00006a50: 7461 7274 5f74 696d 655f 6672 6f6d 2c20  tart_time_from, 
-00006a60: 7374 6172 745f 7469 6d65 5f74 6f5d 6060  start_time_to]``
-00006a70: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00006a80: 2073 7461 7274 5f74 696d 655f 746f 3a20   start_time_to: 
-00006a90: 4669 6c74 6572 2062 7920 7275 6e20 7374  Filter by run st
-00006aa0: 6172 7420 7469 6d65 2069 6e20 6060 5b73  art time in ``[s
-00006ab0: 7461 7274 5f74 696d 655f 6672 6f6d 2c20  tart_time_from, 
-00006ac0: 7374 6172 745f 7469 6d65 5f74 6f5d 6060  start_time_to]``
-00006ad0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00006ae0: 206c 6173 745f 7570 6461 7465 5f74 696d   last_update_tim
-00006af0: 655f 6672 6f6d 3a20 4669 6c74 6572 2062  e_from: Filter b
-00006b00: 7920 7275 6e20 6c61 7374 2075 7064 6174  y run last updat
-00006b10: 6520 7469 6d65 2069 6e20 6060 286c 6173  e time in ``(las
-00006b20: 745f 7570 6461 7465 5f74 696d 655f 6672  t_update_time_fr
-00006b30: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
-00006b40: 6c61 7374 5f75 7064 6174 655f 7469 6d65  last_update_time
-00006b50: 5f74 6f29 6060 2e0a 2020 2020 2020 2020  _to)``..        
-00006b60: 3a70 6172 616d 206c 6173 745f 7570 6461  :param last_upda
-00006b70: 7465 5f74 696d 655f 746f 3a20 4669 6c74  te_time_to: Filt
-00006b80: 6572 2062 7920 7275 6e20 6c61 7374 2075  er by run last u
-00006b90: 7064 6174 6520 7469 6d65 2069 6e20 6060  pdate time in ``
-00006ba0: 286c 6173 745f 7570 6461 7465 5f74 696d  (last_update_tim
-00006bb0: 655f 6672 6f6d 2c20 6c61 7374 5f75 7064  e_from, last_upd
-00006bc0: 6174 655f 7469 6d65 5f74 6f29 6060 2e0a  ate_time_to)``..
-00006bd0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00006be0: 6172 7469 7469 6f6e 5f62 793a 2046 6965  artition_by: Fie
-00006bf0: 6c64 2074 6f20 6772 6f75 7020 7265 7375  ld to group resu
-00006c00: 6c74 7320 6279 2e20 4f6e 6c79 2061 6c6c  lts by. Only all
-00006c10: 6f77 6564 2076 616c 7565 2069 7320 606e  owed value is `n
-00006c20: 616d 6560 2e20 5768 656e 2060 7061 7274  ame`. When `part
-00006c30: 6974 696f 6e5f 6279 6020 6973 2073 7065  ition_by` is spe
-00006c40: 6369 6669 6564 2c0a 2020 2020 2020 2020  cified,.        
-00006c50: 2020 2020 7468 6520 6070 6172 7469 7469      the `partiti
-00006c60: 6f6e 5f73 6f72 745f 6279 6020 7061 7261  on_sort_by` para
-00006c70: 6d65 7465 7220 6d75 7374 2062 6520 7072  meter must be pr
-00006c80: 6f76 6964 6564 2061 7320 7765 6c6c 2e0a  ovided as well..
-00006c90: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
-00006ca0: 6f77 735f 7065 725f 7061 7274 6974 696f  ows_per_partitio
-00006cb0: 6e3a 2048 6f77 206d 616e 7920 746f 7020  n: How many top 
-00006cc0: 726f 7773 2028 7065 7220 736f 7274 696e  rows (per sortin
-00006cd0: 6720 6465 6669 6e65 6420 6279 2060 7061  g defined by `pa
-00006ce0: 7274 6974 696f 6e5f 736f 7274 5f62 7960  rtition_sort_by`
-00006cf0: 2061 6e64 2060 7061 7274 6974 696f 6e5f   and `partition_
-00006d00: 6f72 6465 7260 290a 2020 2020 2020 2020  order`).        
-00006d10: 2020 2020 746f 2072 6574 7572 6e20 7065      to return pe
-00006d20: 7220 6772 6f75 702e 2044 6566 6175 6c74  r group. Default
-00006d30: 2076 616c 7565 2069 7320 312e 0a20 2020   value is 1..   
-00006d40: 2020 2020 203a 7061 7261 6d20 7061 7274       :param part
-00006d50: 6974 696f 6e5f 736f 7274 5f62 793a 2057  ition_sort_by: W
-00006d60: 6861 7420 6669 656c 6420 746f 2073 6f72  hat field to sor
-00006d70: 7420 7468 6520 7265 7375 6c74 7320 6279  t the results by
-00006d80: 2c20 7769 7468 696e 2065 6163 6820 7061  , within each pa
-00006d90: 7274 6974 696f 6e20 6465 6669 6e65 6420  rtition defined 
-00006da0: 6279 2060 7061 7274 6974 696f 6e5f 6279  by `partition_by
-00006db0: 602e 0a20 2020 2020 2020 2020 2020 2043  `..            C
-00006dc0: 7572 7265 6e74 6c79 2074 6865 206f 6e6c  urrently the onl
-00006dd0: 7920 616c 6c6f 7765 6420 7661 6c75 6573  y allowed values
-00006de0: 2061 7265 2060 6372 6561 7465 6460 2061   are `created` a
-00006df0: 6e64 2060 7570 6461 7465 6460 2e0a 2020  nd `updated`..  
-00006e00: 2020 2020 2020 3a70 6172 616d 2070 6172        :param par
-00006e10: 7469 7469 6f6e 5f6f 7264 6572 3a20 4f72  tition_order: Or
-00006e20: 6465 7220 6f66 2073 6f72 7469 6e67 2077  der of sorting w
-00006e30: 6974 6869 6e20 7061 7274 6974 696f 6e73  ithin partitions
-00006e40: 202d 2060 6173 6360 206f 7220 6064 6573   - `asc` or `des
-00006e50: 6360 2e20 4465 6661 756c 7420 6973 2060  c`. Default is `
-00006e60: 6465 7363 602e 0a20 2020 2020 2020 203a  desc`..        :
-00006e70: 7061 7261 6d20 6d61 785f 7061 7274 6974  param max_partit
-00006e80: 696f 6e73 3a20 4d61 7869 6d61 6c20 6e75  ions: Maximal nu
-00006e90: 6d62 6572 206f 6620 7061 7274 6974 696f  mber of partitio
-00006ea0: 6e73 2074 6f20 696e 636c 7564 6520 696e  ns to include in
-00006eb0: 2074 6865 2072 6573 756c 742e 2044 6566   the result. Def
-00006ec0: 6175 6c74 2069 7320 6030 6020 7768 6963  ault is `0` whic
-00006ed0: 6820 6d65 616e 7320 6e6f 0a20 2020 2020  h means no.     
-00006ee0: 2020 2020 2020 206c 696d 6974 2e0a 2020         limit..  
-00006ef0: 2020 2020 2020 3a70 6172 616d 2077 6974        :param wit
-00006f00: 685f 6e6f 7469 6669 6361 7469 6f6e 733a  h_notifications:
-00006f10: 2052 6574 7572 6e20 7275 6e73 2077 6974   Return runs wit
-00006f20: 6820 6e6f 7469 6669 6361 7469 6f6e 732c  h notifications,
-00006f30: 2061 6e64 206a 6f69 6e20 7468 656d 2074   and join them t
-00006f40: 6f20 7468 6520 7265 7370 6f6e 7365 2e20  o the response. 
-00006f50: 4465 6661 756c 7420 6973 2060 4661 6c73  Default is `Fals
-00006f60: 6560 2e0a 2020 2020 2020 2020 2222 220a  e`..        """.
-00006f70: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00006f80: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-00006f90: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-00006fa0: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
-00006fb0: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
-00006fc0: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
-00006fd0: 2c0a 2020 2020 2020 2020 2020 2020 2275  ,.            "u
-00006fe0: 6964 223a 2075 6964 2c0a 2020 2020 2020  id": uid,.      
-00006ff0: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
-00007000: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
-00007010: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
-00007020: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
-00007030: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
-00007040: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
-00007050: 2020 2020 2022 736f 7274 223a 2062 6f6f       "sort": boo
-00007060: 6c32 7374 7228 736f 7274 292c 0a20 2020  l2str(sort),.   
-00007070: 2020 2020 2020 2020 2022 6974 6572 223a           "iter":
-00007080: 2062 6f6f 6c32 7374 7228 6974 6572 292c   bool2str(iter),
-00007090: 0a20 2020 2020 2020 2020 2020 2022 7374  .            "st
-000070a0: 6172 745f 7469 6d65 5f66 726f 6d22 3a20  art_time_from": 
-000070b0: 6461 7465 7469 6d65 5f74 6f5f 6973 6f28  datetime_to_iso(
-000070c0: 7374 6172 745f 7469 6d65 5f66 726f 6d29  start_time_from)
-000070d0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-000070e0: 7461 7274 5f74 696d 655f 746f 223a 2064  tart_time_to": d
-000070f0: 6174 6574 696d 655f 746f 5f69 736f 2873  atetime_to_iso(s
-00007100: 7461 7274 5f74 696d 655f 746f 292c 0a20  tart_time_to),. 
-00007110: 2020 2020 2020 2020 2020 2022 6c61 7374             "last
-00007120: 5f75 7064 6174 655f 7469 6d65 5f66 726f  _update_time_fro
-00007130: 6d22 3a20 6461 7465 7469 6d65 5f74 6f5f  m": datetime_to_
-00007140: 6973 6f28 6c61 7374 5f75 7064 6174 655f  iso(last_update_
-00007150: 7469 6d65 5f66 726f 6d29 2c0a 2020 2020  time_from),.    
-00007160: 2020 2020 2020 2020 226c 6173 745f 7570          "last_up
-00007170: 6461 7465 5f74 696d 655f 746f 223a 2064  date_time_to": d
-00007180: 6174 6574 696d 655f 746f 5f69 736f 286c  atetime_to_iso(l
-00007190: 6173 745f 7570 6461 7465 5f74 696d 655f  ast_update_time_
-000071a0: 746f 292c 0a20 2020 2020 2020 2020 2020  to),.           
-000071b0: 2022 7769 7468 2d6e 6f74 6966 6963 6174   "with-notificat
-000071c0: 696f 6e73 223a 2077 6974 685f 6e6f 7469  ions": with_noti
-000071d0: 6669 6361 7469 6f6e 732c 0a20 2020 2020  fications,.     
-000071e0: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
-000071f0: 2070 6172 7469 7469 6f6e 5f62 793a 0a20   partition_by:. 
-00007200: 2020 2020 2020 2020 2020 2070 6172 616d             param
-00007210: 732e 7570 6461 7465 280a 2020 2020 2020  s.update(.      
-00007220: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00007230: 6765 6e65 7261 7465 5f70 6172 7469 7469  generate_partiti
-00007240: 6f6e 5f62 795f 7061 7261 6d73 280a 2020  on_by_params(.  
-00007250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007260: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
-00007270: 6368 656d 6173 2e52 756e 5061 7274 6974  chemas.RunPartit
-00007280: 696f 6e42 7946 6965 6c64 2c0a 2020 2020  ionByField,.    
-00007290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000072a0: 7061 7274 6974 696f 6e5f 6279 2c0a 2020  partition_by,.  
-000072b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000072c0: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
-000072d0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-000072e0: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-000072f0: 696f 6e5f 736f 7274 5f62 792c 0a20 2020  ion_sort_by,.   
-00007300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007310: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-00007320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007330: 2020 2020 2020 6d61 785f 7061 7274 6974        max_partit
-00007340: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
-00007350: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00007360: 2020 2020 290a 2020 2020 2020 2020 6572      ).        er
-00007370: 726f 7220 3d20 226c 6973 7420 7275 6e73  ror = "list runs
-00007380: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
-00007390: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-000073a0: 4745 5422 2c20 2272 756e 7322 2c20 6572  GET", "runs", er
-000073b0: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
-000073c0: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
-000073d0: 726e 2052 756e 4c69 7374 2872 6573 702e  rn RunList(resp.
-000073e0: 6a73 6f6e 2829 5b22 7275 6e73 225d 290a  json()["runs"]).
-000073f0: 0a20 2020 2064 6566 2064 656c 5f72 756e  .    def del_run
-00007400: 7328 7365 6c66 2c20 6e61 6d65 3d4e 6f6e  s(self, name=Non
-00007410: 652c 2070 726f 6a65 6374 3d4e 6f6e 652c  e, project=None,
-00007420: 206c 6162 656c 733d 4e6f 6e65 2c20 7374   labels=None, st
-00007430: 6174 653d 4e6f 6e65 2c20 6461 7973 5f61  ate=None, days_a
-00007440: 676f 3d30 293a 0a20 2020 2020 2020 2022  go=0):.        "
-00007450: 2222 4465 6c65 7465 2061 2067 726f 7570  ""Delete a group
-00007460: 206f 6620 7275 6e73 2069 6465 6e74 6966   of runs identif
-00007470: 6965 6420 6279 2074 6865 2070 6172 616d  ied by the param
-00007480: 6574 6572 7320 6f66 2074 6865 2066 756e  eters of the fun
-00007490: 6374 696f 6e2e 0a0a 2020 2020 2020 2020  ction...        
-000074a0: 4578 616d 706c 653a 3a0a 0a20 2020 2020  Example::..     
-000074b0: 2020 2020 2020 2064 622e 6465 6c5f 7275         db.del_ru
-000074c0: 6e73 2873 7461 7465 3d27 636f 6d70 6c65  ns(state='comple
-000074d0: 7465 6427 290a 0a20 2020 2020 2020 203a  ted')..        :
-000074e0: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
-000074f0: 206f 6620 7468 6520 7461 736b 2077 6869   of the task whi
-00007500: 6368 2074 6865 2072 756e 7320 6265 6c6f  ch the runs belo
-00007510: 6e67 2074 6f2e 0a20 2020 2020 2020 203a  ng to..        :
-00007520: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-00007530: 726f 6a65 6374 2074 6f20 7768 6963 6820  roject to which 
-00007540: 7468 6520 7275 6e73 2062 656c 6f6e 672e  the runs belong.
-00007550: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00007560: 6c61 6265 6c73 3a20 4669 6c74 6572 2072  labels: Filter r
-00007570: 756e 7320 7468 6174 2061 7265 206c 6162  uns that are lab
-00007580: 656c 6564 2075 7369 6e67 2074 6865 7365  eled using these
-00007590: 2073 7065 6369 6669 6320 6c61 6265 6c20   specific label 
-000075a0: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
-000075b0: 3a70 6172 616d 2073 7461 7465 3a20 4669  :param state: Fi
-000075c0: 6c74 6572 206f 6e6c 7920 7275 6e73 2077  lter only runs w
-000075d0: 6869 6368 2061 7265 2069 6e20 7468 6973  hich are in this
-000075e0: 2073 7461 7465 2e0a 2020 2020 2020 2020   state..        
-000075f0: 3a70 6172 616d 2064 6179 735f 6167 6f3a  :param days_ago:
-00007600: 2046 696c 7465 7220 7275 6e73 2077 686f   Filter runs who
-00007610: 7365 2073 7461 7274 2074 696d 6520 6973  se start time is
-00007620: 206e 6577 6572 2074 6861 6e20 7468 6973   newer than this
-00007630: 2070 6172 616d 6574 6572 2e0a 2020 2020   parameter..    
-00007640: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00007650: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-00007660: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-00007670: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-00007680: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
-00007690: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
-000076a0: 6522 3a20 6e61 6d65 2c0a 2020 2020 2020  e": name,.      
-000076b0: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
-000076c0: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
-000076d0: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
-000076e0: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
-000076f0: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
-00007700: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
-00007710: 2020 2020 2022 6461 7973 5f61 676f 223a       "days_ago":
-00007720: 2073 7472 2864 6179 735f 6167 6f29 2c0a   str(days_ago),.
-00007730: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00007740: 2020 6572 726f 7220 3d20 2264 656c 2072    error = "del r
-00007750: 756e 7322 0a20 2020 2020 2020 2073 656c  uns".        sel
-00007760: 662e 6170 695f 6361 6c6c 2822 4445 4c45  f.api_call("DELE
-00007770: 5445 222c 2022 7275 6e73 222c 2065 7272  TE", "runs", err
-00007780: 6f72 2c20 7061 7261 6d73 3d70 6172 616d  or, params=param
-00007790: 7329 0a0a 2020 2020 6465 6620 7374 6f72  s)..    def stor
-000077a0: 655f 6172 7469 6661 6374 2873 656c 662c  e_artifact(self,
-000077b0: 206b 6579 2c20 6172 7469 6661 6374 2c20   key, artifact, 
-000077c0: 7569 642c 2069 7465 723d 4e6f 6e65 2c20  uid, iter=None, 
-000077d0: 7461 673d 4e6f 6e65 2c20 7072 6f6a 6563  tag=None, projec
-000077e0: 743d 2222 293a 0a20 2020 2020 2020 2022  t=""):.        "
-000077f0: 2222 5374 6f72 6520 616e 2061 7274 6966  ""Store an artif
-00007800: 6163 7420 696e 2074 6865 2044 422e 0a0a  act in the DB...
-00007810: 2020 2020 2020 2020 3a70 6172 616d 206b          :param k
-00007820: 6579 3a20 4964 656e 7469 6679 696e 6720  ey: Identifying 
-00007830: 6b65 7920 6f66 2074 6865 2061 7274 6966  key of the artif
-00007840: 6163 742e 0a20 2020 2020 2020 203a 7061  act..        :pa
-00007850: 7261 6d20 6172 7469 6661 6374 3a20 5468  ram artifact: Th
-00007860: 6520 6163 7475 616c 2061 7274 6966 6163  e actual artifac
-00007870: 7420 746f 2073 746f 7265 2e0a 2020 2020  t to store..    
-00007880: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
-00007890: 4120 756e 6971 7565 2049 4420 666f 7220  A unique ID for 
-000078a0: 7468 6973 2073 7065 6369 6669 6320 7665  this specific ve
-000078b0: 7273 696f 6e20 6f66 2074 6865 2061 7274  rsion of the art
-000078c0: 6966 6163 742e 0a20 2020 2020 2020 203a  ifact..        :
-000078d0: 7061 7261 6d20 6974 6572 3a20 5468 6520  param iter: The 
-000078e0: 7461 736b 2069 7465 7261 7469 6f6e 2077  task iteration w
-000078f0: 6869 6368 2067 656e 6572 6174 6564 2074  hich generated t
-00007900: 6869 7320 6172 7469 6661 6374 2e20 4966  his artifact. If
-00007910: 2060 6069 7465 7260 6020 6973 206e 6f74   ``iter`` is not
-00007920: 2060 604e 6f6e 6560 6020 7468 6520 6974   ``None`` the it
-00007930: 6572 6174 696f 6e20 7769 6c6c 0a20 2020  eration will.   
-00007940: 2020 2020 2020 2020 2062 6520 6164 6465           be adde
-00007950: 6420 746f 2074 6865 206b 6579 2070 726f  d to the key pro
-00007960: 7669 6465 6420 746f 2067 656e 6572 6174  vided to generat
-00007970: 6520 6120 756e 6971 7565 206b 6579 2066  e a unique key f
-00007980: 6f72 2074 6865 2061 7274 6966 6163 7420  or the artifact 
-00007990: 6f66 2074 6865 2073 7065 6369 6669 6320  of the specific 
-000079a0: 6974 6572 6174 696f 6e2e 0a20 2020 2020  iteration..     
-000079b0: 2020 203a 7061 7261 6d20 7461 673a 2054     :param tag: T
-000079c0: 6167 206f 6620 7468 6520 6172 7469 6661  ag of the artifa
-000079d0: 6374 2e0a 2020 2020 2020 2020 3a70 6172  ct..        :par
-000079e0: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-000079f0: 6563 7420 7468 6174 2074 6865 2061 7274  ect that the art
-00007a00: 6966 6163 7420 6265 6c6f 6e67 7320 746f  ifact belongs to
-00007a10: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00007a20: 2020 2020 2020 2065 6e64 706f 696e 745f         endpoint_
-00007a30: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
-00007a40: 732f 7b70 726f 6a65 6374 7d2f 6172 7469  s/{project}/arti
-00007a50: 6661 6374 732f 7b75 6964 7d2f 7b6b 6579  facts/{uid}/{key
-00007a60: 7d22 0a20 2020 2020 2020 2070 6172 616d  }".        param
-00007a70: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-00007a80: 2020 2274 6167 223a 2074 6167 2c0a 2020    "tag": tag,.  
-00007a90: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00007aa0: 6966 2069 7465 723a 0a20 2020 2020 2020  if iter:.       
-00007ab0: 2020 2020 2070 6172 616d 735b 2269 7465       params["ite
-00007ac0: 7222 5d20 3d20 7374 7228 6974 6572 290a  r"] = str(iter).
-00007ad0: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
-00007ae0: 2066 2273 746f 7265 2061 7274 6966 6163   f"store artifac
-00007af0: 7420 7b70 726f 6a65 6374 7d2f 7b75 6964  t {project}/{uid
-00007b00: 7d2f 7b6b 6579 7d22 0a0a 2020 2020 2020  }/{key}"..      
-00007b10: 2020 626f 6479 203d 205f 6173 5f6a 736f    body = _as_jso
-00007b20: 6e28 6172 7469 6661 6374 290a 2020 2020  n(artifact).    
-00007b30: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
-00007b40: 6c28 2250 4f53 5422 2c20 656e 6470 6f69  l("POST", endpoi
-00007b50: 6e74 5f70 6174 682c 2065 7272 6f72 2c20  nt_path, error, 
-00007b60: 7061 7261 6d73 3d70 6172 616d 732c 2062  params=params, b
-00007b70: 6f64 793d 626f 6479 290a 0a20 2020 2064  ody=body)..    d
-00007b80: 6566 2072 6561 645f 6172 7469 6661 6374  ef read_artifact
-00007b90: 2873 656c 662c 206b 6579 2c20 7461 673d  (self, key, tag=
-00007ba0: 4e6f 6e65 2c20 6974 6572 3d4e 6f6e 652c  None, iter=None,
-00007bb0: 2070 726f 6a65 6374 3d22 2229 3a0a 2020   project=""):.  
-00007bc0: 2020 2020 2020 2222 2252 6561 6420 616e        """Read an
-00007bd0: 2061 7274 6966 6163 742c 2069 6465 6e74   artifact, ident
-00007be0: 6966 6965 6420 6279 2069 7473 206b 6579  ified by its key
-00007bf0: 2c20 7461 6720 616e 6420 6974 6572 6174  , tag and iterat
-00007c00: 696f 6e2e 2222 220a 0a20 2020 2020 2020  ion."""..       
-00007c10: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-00007c20: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-00007c30: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-00007c40: 2020 2020 2074 6167 203d 2074 6167 206f       tag = tag o
-00007c50: 7220 226c 6174 6573 7422 0a20 2020 2020  r "latest".     
-00007c60: 2020 2065 6e64 706f 696e 745f 7061 7468     endpoint_path
-00007c70: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
-00007c80: 726f 6a65 6374 7d2f 6172 7469 6661 6374  roject}/artifact
-00007c90: 732f 7b6b 6579 7d3f 7461 673d 7b74 6167  s/{key}?tag={tag
-00007ca0: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
-00007cb0: 203d 2066 2272 6561 6420 6172 7469 6661   = f"read artifa
-00007cc0: 6374 207b 7072 6f6a 6563 747d 2f7b 6b65  ct {project}/{ke
-00007cd0: 797d 220a 2020 2020 2020 2020 2320 6578  y}".        # ex
-00007ce0: 706c 6963 6974 6c79 2073 6574 2061 7274  plicitly set art
-00007cf0: 6966 6163 7473 2066 6f72 6d61 7420 746f  ifacts format to
-00007d00: 2027 6675 6c6c 2720 7369 6e63 6520 6f6c   'full' since ol
-00007d10: 6420 7365 7276 6572 7320 6d61 7920 6465  d servers may de
-00007d20: 6661 756c 7420 746f 2027 6c65 6761 6379  fault to 'legacy
-00007d30: 270a 2020 2020 2020 2020 7061 7261 6d73  '.        params
-00007d40: 203d 207b 2266 6f72 6d61 7422 3a20 6d6c   = {"format": ml
-00007d50: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-00007d60: 6173 2e41 7274 6966 6163 7473 466f 726d  as.ArtifactsForm
-00007d70: 6174 2e66 756c 6c2e 7661 6c75 657d 0a20  at.full.value}. 
-00007d80: 2020 2020 2020 2069 6620 6974 6572 3a0a         if iter:.
-00007d90: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00007da0: 6d73 5b22 6974 6572 225d 203d 2073 7472  ms["iter"] = str
-00007db0: 2869 7465 7229 0a20 2020 2020 2020 2072  (iter).        r
-00007dc0: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
-00007dd0: 616c 6c28 2247 4554 222c 2065 6e64 706f  all("GET", endpo
-00007de0: 696e 745f 7061 7468 2c20 6572 726f 722c  int_path, error,
-00007df0: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
-00007e00: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00007e10: 6573 702e 6a73 6f6e 2829 5b22 6461 7461  esp.json()["data
-00007e20: 225d 0a0a 2020 2020 6465 6620 6465 6c5f  "]..    def del_
-00007e30: 6172 7469 6661 6374 2873 656c 662c 206b  artifact(self, k
-00007e40: 6579 2c20 7461 673d 4e6f 6e65 2c20 7072  ey, tag=None, pr
-00007e50: 6f6a 6563 743d 2222 293a 0a20 2020 2020  oject=""):.     
-00007e60: 2020 2022 2222 4465 6c65 7465 2061 6e20     """Delete an 
-00007e70: 6172 7469 6661 6374 2e22 2222 0a0a 2020  artifact."""..  
-00007e80: 2020 2020 2020 656e 6470 6f69 6e74 5f70        endpoint_p
-00007e90: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
-00007ea0: 2f7b 7072 6f6a 6563 747d 2f61 7274 6966  /{project}/artif
-00007eb0: 6163 7473 2f7b 6b65 797d 220a 2020 2020  acts/{key}".    
-00007ec0: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
-00007ed0: 2020 2020 2020 2020 2020 2022 6b65 7922             "key"
-00007ee0: 3a20 6b65 792c 0a20 2020 2020 2020 2020  : key,.         
-00007ef0: 2020 2022 7461 6722 3a20 7461 672c 0a20     "tag": tag,. 
-00007f00: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00007f10: 2065 7272 6f72 203d 2066 2264 656c 2061   error = f"del a
-00007f20: 7274 6966 6163 7420 7b70 726f 6a65 6374  rtifact {project
-00007f30: 7d2f 7b6b 6579 7d22 0a20 2020 2020 2020  }/{key}".       
-00007f40: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-00007f50: 4445 4c45 5445 222c 2065 6e64 706f 696e  DELETE", endpoin
-00007f60: 745f 7061 7468 2c20 6572 726f 722c 2070  t_path, error, p
-00007f70: 6172 616d 733d 7061 7261 6d73 290a 0a20  arams=params).. 
-00007f80: 2020 2064 6566 206c 6973 745f 6172 7469     def list_arti
-00007f90: 6661 6374 7328 0a20 2020 2020 2020 2073  facts(.        s
-00007fa0: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
-00007fb0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-00007fc0: 7072 6f6a 6563 743d 4e6f 6e65 2c0a 2020  project=None,.  
-00007fd0: 2020 2020 2020 7461 673d 4e6f 6e65 2c0a        tag=None,.
-00007fe0: 2020 2020 2020 2020 6c61 6265 6c73 3a20          labels: 
-00007ff0: 4f70 7469 6f6e 616c 5b55 6e69 6f6e 5b44  Optional[Union[D
-00008000: 6963 745b 7374 722c 2073 7472 5d2c 204c  ict[str, str], L
-00008010: 6973 745b 7374 725d 5d5d 203d 204e 6f6e  ist[str]]] = Non
-00008020: 652c 0a20 2020 2020 2020 2073 696e 6365  e,.        since
-00008030: 3d4e 6f6e 652c 0a20 2020 2020 2020 2075  =None,.        u
-00008040: 6e74 696c 3d4e 6f6e 652c 0a20 2020 2020  ntil=None,.     
-00008050: 2020 2069 7465 723a 2069 6e74 203d 204e     iter: int = N
-00008060: 6f6e 652c 0a20 2020 2020 2020 2062 6573  one,.        bes
-00008070: 745f 6974 6572 6174 696f 6e3a 2062 6f6f  t_iteration: boo
-00008080: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00008090: 2020 206b 696e 643a 2073 7472 203d 204e     kind: str = N
-000080a0: 6f6e 652c 0a20 2020 2020 2020 2063 6174  one,.        cat
-000080b0: 6567 6f72 793a 2055 6e69 6f6e 5b73 7472  egory: Union[str
-000080c0: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
-000080d0: 6368 656d 6173 2e41 7274 6966 6163 7443  chemas.ArtifactC
-000080e0: 6174 6567 6f72 6965 735d 203d 204e 6f6e  ategories] = Non
-000080f0: 652c 0a20 2020 2029 202d 3e20 4172 7469  e,.    ) -> Arti
-00008100: 6661 6374 4c69 7374 3a0a 2020 2020 2020  factList:.      
-00008110: 2020 2222 224c 6973 7420 6172 7469 6661    """List artifa
-00008120: 6374 7320 6669 6c74 6572 6564 2062 7920  cts filtered by 
-00008130: 7661 7269 6f75 7320 7061 7261 6d65 7465  various paramete
-00008140: 7273 2e0a 0a20 2020 2020 2020 2045 7861  rs...        Exa
-00008150: 6d70 6c65 733a 3a0a 0a20 2020 2020 2020  mples::..       
-00008160: 2020 2020 2023 2053 686f 7720 6c61 7465       # Show late
-00008170: 7374 2076 6572 7369 6f6e 206f 6620 616c  st version of al
-00008180: 6c20 6172 7469 6661 6374 7320 696e 2070  l artifacts in p
-00008190: 726f 6a65 6374 0a20 2020 2020 2020 2020  roject.         
-000081a0: 2020 206c 6174 6573 745f 6172 7469 6661     latest_artifa
-000081b0: 6374 7320 3d20 6462 2e6c 6973 745f 6172  cts = db.list_ar
-000081c0: 7469 6661 6374 7328 2727 2c20 7461 673d  tifacts('', tag=
-000081d0: 276c 6174 6573 7427 2c20 7072 6f6a 6563  'latest', projec
-000081e0: 743d 2769 7269 7327 290a 2020 2020 2020  t='iris').      
-000081f0: 2020 2020 2020 2320 6368 6563 6b20 6469        # check di
-00008200: 6666 6572 656e 7420 6172 7469 6661 6374  fferent artifact
-00008210: 2076 6572 7369 6f6e 7320 666f 7220 6120   versions for a 
-00008220: 7370 6563 6966 6963 2061 7274 6966 6163  specific artifac
-00008230: 740a 2020 2020 2020 2020 2020 2020 7265  t.            re
-00008240: 7375 6c74 5f76 6572 7369 6f6e 7320 3d20  sult_versions = 
-00008250: 6462 2e6c 6973 745f 6172 7469 6661 6374  db.list_artifact
-00008260: 7328 2772 6573 756c 7473 272c 2074 6167  s('results', tag
-00008270: 3d27 2a27 2c20 7072 6f6a 6563 743d 2769  ='*', project='i
-00008280: 7269 7327 290a 2020 2020 2020 2020 2020  ris').          
-00008290: 2020 2320 5368 6f77 2061 7274 6966 6163    # Show artifac
-000082a0: 7473 2077 6974 6820 6c61 6265 6c20 6669  ts with label fi
-000082b0: 6c74 6572 7320 2d20 626f 7468 2075 706c  lters - both upl
-000082c0: 6f61 6465 6420 616e 6420 6f66 2062 696e  oaded and of bin
-000082d0: 6172 7920 7479 7065 0a20 2020 2020 2020  ary type.       
-000082e0: 2020 2020 2072 6573 756c 745f 6c61 6265       result_labe
-000082f0: 6c73 203d 2064 622e 6c69 7374 5f61 7274  ls = db.list_art
-00008300: 6966 6163 7473 2827 7265 7375 6c74 7327  ifacts('results'
-00008310: 2c20 7461 673d 272a 272c 2070 726f 6a65  , tag='*', proje
-00008320: 6374 3d27 6972 6973 272c 206c 6162 656c  ct='iris', label
-00008330: 733d 5b27 7570 6c6f 6164 6564 272c 2027  s=['uploaded', '
-00008340: 7479 7065 3d62 696e 6172 7927 5d29 0a0a  type=binary'])..
-00008350: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
-00008360: 616d 653a 204e 616d 6520 6f66 2061 7274  ame: Name of art
-00008370: 6966 6163 7473 2074 6f20 7265 7472 6965  ifacts to retrie
-00008380: 7665 2e20 4e61 6d65 2077 6974 6820 277e  ve. Name with '~
-00008390: 2720 7072 6566 6978 2069 7320 7573 6564  ' prefix is used
-000083a0: 2061 7320 6120 6c69 6b65 2071 7565 7279   as a like query
-000083b0: 2c20 616e 6420 6973 206e 6f74 0a20 2020  , and is not.   
-000083c0: 2020 2020 2020 2020 2063 6173 652d 7365           case-se
-000083d0: 6e73 6974 6976 652e 2054 6869 7320 6d65  nsitive. This me
-000083e0: 616e 7320 7468 6174 2071 7565 7279 696e  ans that queryin
-000083f0: 6720 666f 7220 6060 7e6e 616d 6560 6020  g for ``~name`` 
-00008400: 6d61 7920 7265 7475 726e 2061 7274 6966  may return artif
-00008410: 6163 7473 206e 616d 6564 0a20 2020 2020  acts named.     
-00008420: 2020 2020 2020 2060 606d 795f 4e61 6d65         ``my_Name
-00008430: 5f31 6060 206f 7220 6060 7375 726e 616d  _1`` or ``surnam
-00008440: 6560 602e 0a20 2020 2020 2020 203a 7061  e``..        :pa
-00008450: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
-00008460: 6a65 6374 206e 616d 652e 0a20 2020 2020  ject name..     
-00008470: 2020 203a 7061 7261 6d20 7461 673a 2052     :param tag: R
-00008480: 6574 7572 6e20 6172 7469 6661 6374 7320  eturn artifacts 
-00008490: 6173 7369 676e 6564 2074 6869 7320 7461  assigned this ta
-000084a0: 672e 0a20 2020 2020 2020 203a 7061 7261  g..        :para
-000084b0: 6d20 6c61 6265 6c73 3a20 5265 7475 726e  m labels: Return
-000084c0: 2061 7274 6966 6163 7473 2074 6861 7420   artifacts that 
-000084d0: 6861 7665 2074 6865 7365 206c 6162 656c  have these label
-000084e0: 732e 204c 6162 656c 7320 6361 6e20 6569  s. Labels can ei
-000084f0: 7468 6572 2062 6520 6120 6469 6374 696f  ther be a dictio
-00008500: 6e61 7279 207b 226c 6162 656c 223a 2022  nary {"label": "
-00008510: 7661 6c75 6522 7d20 6f72 0a20 2020 2020  value"} or.     
-00008520: 2020 2020 2020 2061 206c 6973 7420 6f66         a list of
-00008530: 2022 6c61 6265 6c3d 7661 6c75 6522 2028   "label=value" (
-00008540: 6d61 7463 6820 6c61 6265 6c20 6b65 7920  match label key 
-00008550: 616e 6420 7661 6c75 6529 206f 7220 226c  and value) or "l
-00008560: 6162 656c 2220 286d 6174 6368 206a 7573  abel" (match jus
-00008570: 7420 6c61 6265 6c20 6b65 7929 2073 7472  t label key) str
-00008580: 696e 6773 2e0a 2020 2020 2020 2020 3a70  ings..        :p
-00008590: 6172 616d 2073 696e 6365 3a20 4e6f 7420  aram since: Not 
-000085a0: 696e 2075 7365 2069 6e20 3a70 793a 636c  in use in :py:cl
-000085b0: 6173 733a 6048 5454 5052 756e 4442 602e  ass:`HTTPRunDB`.
-000085c0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000085d0: 756e 7469 6c3a 204e 6f74 2069 6e20 7573  until: Not in us
-000085e0: 6520 696e 203a 7079 3a63 6c61 7373 3a60  e in :py:class:`
-000085f0: 4854 5450 5275 6e44 4260 2e0a 2020 2020  HTTPRunDB`..    
-00008600: 2020 2020 3a70 6172 616d 2069 7465 723a      :param iter:
-00008610: 2052 6574 7572 6e20 6172 7469 6661 6374   Return artifact
-00008620: 7320 6672 6f6d 2061 2073 7065 6369 6669  s from a specifi
-00008630: 6320 6974 6572 6174 696f 6e20 2877 6865  c iteration (whe
-00008640: 7265 2060 6069 7465 723d 3060 6020 6d65  re ``iter=0`` me
-00008650: 616e 7320 7468 6520 726f 6f74 2069 7465  ans the root ite
-00008660: 7261 7469 6f6e 292e 2049 660a 2020 2020  ration). If.    
-00008670: 2020 2020 2020 2020 6060 4e6f 6e65 6060          ``None``
-00008680: 2028 6465 6661 756c 7429 2072 6574 7572   (default) retur
-00008690: 6e20 6172 7469 6661 6374 7320 6672 6f6d  n artifacts from
-000086a0: 2061 6c6c 2069 7465 7261 7469 6f6e 732e   all iterations.
-000086b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000086c0: 6265 7374 5f69 7465 7261 7469 6f6e 3a20  best_iteration: 
-000086d0: 5265 7475 726e 7320 7468 6520 6172 7469  Returns the arti
-000086e0: 6661 6374 2077 6869 6368 2062 656c 6f6e  fact which belon
-000086f0: 6773 2074 6f20 7468 6520 6265 7374 2069  gs to the best i
-00008700: 7465 7261 7469 6f6e 206f 6620 6120 6769  teration of a gi
-00008710: 7665 6e20 7275 6e2c 2069 6e20 7468 6520  ven run, in the 
-00008720: 6361 7365 206f 660a 2020 2020 2020 2020  case of.        
-00008730: 2020 2020 6172 7469 6661 6374 7320 6765      artifacts ge
-00008740: 6e65 7261 7465 6420 6672 6f6d 2061 2068  nerated from a h
-00008750: 7970 6572 2d70 6172 616d 2072 756e 2e20  yper-param run. 
-00008760: 4966 206f 6e6c 7920 6120 7369 6e67 6c65  If only a single
-00008770: 2069 7465 7261 7469 6f6e 2065 7869 7374   iteration exist
-00008780: 732c 2077 696c 6c20 7265 7475 726e 2074  s, will return t
-00008790: 6865 2061 7274 6966 6163 740a 2020 2020  he artifact.    
-000087a0: 2020 2020 2020 2020 6672 6f6d 2074 6861          from tha
-000087b0: 7420 6974 6572 6174 696f 6e2e 2049 6620  t iteration. If 
-000087c0: 7573 696e 6720 6060 6265 7374 5f69 7465  using ``best_ite
-000087d0: 7260 602c 2074 6865 2060 6069 7465 7260  r``, the ``iter`
-000087e0: 6020 7061 7261 6d65 7465 7220 6d75 7374  ` parameter must
-000087f0: 206e 6f74 2062 6520 7573 6564 2e0a 2020   not be used..  
-00008800: 2020 2020 2020 3a70 6172 616d 206b 696e        :param kin
-00008810: 643a 2052 6574 7572 6e20 6172 7469 6661  d: Return artifa
-00008820: 6374 7320 6f66 2074 6865 2072 6571 7565  cts of the reque
-00008830: 7374 6564 206b 696e 642e 0a20 2020 2020  sted kind..     
-00008840: 2020 203a 7061 7261 6d20 6361 7465 676f     :param catego
-00008850: 7279 3a20 5265 7475 726e 2061 7274 6966  ry: Return artif
-00008860: 6163 7473 206f 6620 7468 6520 7265 7175  acts of the requ
-00008870: 6573 7465 6420 6361 7465 676f 7279 2e0a  ested category..
-00008880: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00008890: 2020 2020 2070 726f 6a65 6374 203d 2070       project = p
-000088a0: 726f 6a65 6374 206f 7220 636f 6e66 6967  roject or config
-000088b0: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
-000088c0: 0a0a 2020 2020 2020 2020 6c61 6265 6c73  ..        labels
-000088d0: 203d 206c 6162 656c 7320 6f72 205b 5d0a   = labels or [].
-000088e0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000088f0: 7461 6e63 6528 6c61 6265 6c73 2c20 6469  tance(labels, di
-00008900: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
-00008910: 206c 6162 656c 7320 3d20 5b66 227b 6b65   labels = [f"{ke
-00008920: 797d 3d7b 7661 6c75 657d 2220 666f 7220  y}={value}" for 
-00008930: 6b65 792c 2076 616c 7565 2069 6e20 6c61  key, value in la
-00008940: 6265 6c73 2e69 7465 6d73 2829 5d0a 0a20  bels.items()].. 
-00008950: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-00008960: 7b0a 2020 2020 2020 2020 2020 2020 226e  {.            "n
-00008970: 616d 6522 3a20 6e61 6d65 2c0a 2020 2020  ame": name,.    
-00008980: 2020 2020 2020 2020 2274 6167 223a 2074          "tag": t
-00008990: 6167 2c0a 2020 2020 2020 2020 2020 2020  ag,.            
-000089a0: 226c 6162 656c 223a 206c 6162 656c 732c  "label": labels,
-000089b0: 0a20 2020 2020 2020 2020 2020 2022 6974  .            "it
-000089c0: 6572 223a 2069 7465 722c 0a20 2020 2020  er": iter,.     
-000089d0: 2020 2020 2020 2022 6265 7374 2d69 7465         "best-ite
-000089e0: 7261 7469 6f6e 223a 2062 6573 745f 6974  ration": best_it
-000089f0: 6572 6174 696f 6e2c 0a20 2020 2020 2020  eration,.       
-00008a00: 2020 2020 2022 6b69 6e64 223a 206b 696e       "kind": kin
-00008a10: 642c 0a20 2020 2020 2020 2020 2020 2022  d,.            "
-00008a20: 6361 7465 676f 7279 223a 2063 6174 6567  category": categ
-00008a30: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
-00008a40: 2022 666f 726d 6174 223a 206d 6c72 756e   "format": mlrun
-00008a50: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00008a60: 4172 7469 6661 6374 7346 6f72 6d61 742e  ArtifactsFormat.
-00008a70: 6675 6c6c 2e76 616c 7565 2c0a 2020 2020  full.value,.    
-00008a80: 2020 2020 7d0a 2020 2020 2020 2020 6572      }.        er
-00008a90: 726f 7220 3d20 226c 6973 7420 6172 7469  ror = "list arti
-00008aa0: 6661 6374 7322 0a20 2020 2020 2020 2065  facts".        e
-00008ab0: 6e64 706f 696e 745f 7061 7468 203d 2066  ndpoint_path = f
-00008ac0: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-00008ad0: 6374 7d2f 6172 7469 6661 6374 7322 0a20  ct}/artifacts". 
-00008ae0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-00008af0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
-00008b00: 222c 2065 6e64 706f 696e 745f 7061 7468  ", endpoint_path
-00008b10: 2c20 6572 726f 722c 2070 6172 616d 733d  , error, params=
-00008b20: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
-00008b30: 7661 6c75 6573 203d 2041 7274 6966 6163  values = Artifac
-00008b40: 744c 6973 7428 7265 7370 2e6a 736f 6e28  tList(resp.json(
-00008b50: 295b 2261 7274 6966 6163 7473 225d 290a  )["artifacts"]).
-00008b60: 2020 2020 2020 2020 7661 6c75 6573 2e74          values.t
-00008b70: 6167 203d 2074 6167 0a20 2020 2020 2020  ag = tag.       
-00008b80: 2072 6574 7572 6e20 7661 6c75 6573 0a0a   return values..
-00008b90: 2020 2020 6465 6620 6465 6c5f 6172 7469      def del_arti
-00008ba0: 6661 6374 7328 7365 6c66 2c20 6e61 6d65  facts(self, name
-00008bb0: 3d4e 6f6e 652c 2070 726f 6a65 6374 3d4e  =None, project=N
-00008bc0: 6f6e 652c 2074 6167 3d4e 6f6e 652c 206c  one, tag=None, l
-00008bd0: 6162 656c 733d 4e6f 6e65 2c20 6461 7973  abels=None, days
-00008be0: 5f61 676f 3d30 293a 0a20 2020 2020 2020  _ago=0):.       
-00008bf0: 2022 2222 4465 6c65 7465 2061 7274 6966   """Delete artif
-00008c00: 6163 7473 2072 6566 6572 656e 6365 6420  acts referenced 
-00008c10: 6279 2074 6865 2070 6172 616d 6574 6572  by the parameter
-00008c20: 732e 0a0a 2020 2020 2020 2020 3a70 6172  s...        :par
-00008c30: 616d 206e 616d 653a 204e 616d 6520 6f66  am name: Name of
-00008c40: 2061 7274 6966 6163 7473 2074 6f20 6465   artifacts to de
-00008c50: 6c65 7465 2e20 4e6f 7465 2074 6861 7420  lete. Note that 
-00008c60: 7468 6973 2069 7320 6120 6c69 6b65 2071  this is a like q
-00008c70: 7565 7279 2c20 616e 6420 6973 2063 6173  uery, and is cas
-00008c80: 652d 696e 7365 6e73 6974 6976 652e 2053  e-insensitive. S
-00008c90: 6565 0a20 2020 2020 2020 2020 2020 203a  ee.            :
-00008ca0: 7079 3a66 756e 633a 607e 6c69 7374 5f61  py:func:`~list_a
-00008cb0: 7274 6966 6163 7473 6020 666f 7220 6d6f  rtifacts` for mo
-00008cc0: 7265 2064 6574 6169 6c73 2e0a 2020 2020  re details..    
-00008cd0: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-00008ce0: 6374 3a20 5072 6f6a 6563 7420 7468 6174  ct: Project that
-00008cf0: 2061 7274 6966 6163 7473 2062 656c 6f6e   artifacts belon
-00008d00: 6720 746f 2e0a 2020 2020 2020 2020 3a70  g to..        :p
-00008d10: 6172 616d 2074 6167 3a20 4368 6f6f 7365  aram tag: Choose
-00008d20: 2061 7274 6966 6163 7473 2077 686f 2061   artifacts who a
-00008d30: 7265 2061 7373 6967 6e65 6420 7468 6973  re assigned this
-00008d40: 2074 6167 2e0a 2020 2020 2020 2020 3a70   tag..        :p
-00008d50: 6172 616d 206c 6162 656c 733a 2043 686f  aram labels: Cho
-00008d60: 6f73 6520 6172 7469 6661 6374 7320 7768  ose artifacts wh
-00008d70: 6963 6820 6172 6520 6c61 6265 6c65 642e  ich are labeled.
-00008d80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00008d90: 6461 7973 5f61 676f 3a20 5468 6973 2070  days_ago: This p
-00008da0: 6172 616d 6574 6572 2069 7320 6465 7072  arameter is depr
-00008db0: 6563 6174 6564 2061 6e64 206e 6f74 2075  ecated and not u
-00008dc0: 7365 642e 0a20 2020 2020 2020 2022 2222  sed..        """
-00008dd0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00008de0: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-00008df0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-00008e00: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
-00008e10: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
-00008e20: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
-00008e30: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
-00008e40: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
-00008e50: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
-00008e60: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
-00008e70: 2020 2020 2020 2020 2022 6461 7973 5f61           "days_a
-00008e80: 676f 223a 2073 7472 2864 6179 735f 6167  go": str(days_ag
-00008e90: 6f29 2c0a 2020 2020 2020 2020 7d0a 2020  o),.        }.  
-00008ea0: 2020 2020 2020 6572 726f 7220 3d20 2264        error = "d
-00008eb0: 656c 2061 7274 6966 6163 7473 220a 2020  el artifacts".  
-00008ec0: 2020 2020 2020 656e 6470 6f69 6e74 5f70        endpoint_p
-00008ed0: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
-00008ee0: 2f7b 7072 6f6a 6563 747d 2f61 7274 6966  /{project}/artif
-00008ef0: 6163 7473 220a 2020 2020 2020 2020 7365  acts".        se
-00008f00: 6c66 2e61 7069 5f63 616c 6c28 2244 454c  lf.api_call("DEL
-00008f10: 4554 4522 2c20 656e 6470 6f69 6e74 5f70  ETE", endpoint_p
-00008f20: 6174 682c 2065 7272 6f72 2c20 7061 7261  ath, error, para
-00008f30: 6d73 3d70 6172 616d 7329 0a0a 2020 2020  ms=params)..    
-00008f40: 6465 6620 6c69 7374 5f61 7274 6966 6163  def list_artifac
-00008f50: 745f 7461 6773 280a 2020 2020 2020 2020  t_tags(.        
-00008f60: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
-00008f70: 6f6a 6563 743d 4e6f 6e65 2c0a 2020 2020  oject=None,.    
-00008f80: 2020 2020 6361 7465 676f 7279 3a20 556e      category: Un
-00008f90: 696f 6e5b 7374 722c 206d 6c72 756e 2e63  ion[str, mlrun.c
-00008fa0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4172  ommon.schemas.Ar
-00008fb0: 7469 6661 6374 4361 7465 676f 7269 6573  tifactCategories
-00008fc0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
-00008fd0: 2d3e 204c 6973 745b 7374 725d 3a0a 2020  -> List[str]:.  
-00008fe0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-00008ff0: 6120 6c69 7374 206f 6620 616c 6c20 7468  a list of all th
-00009000: 6520 7461 6773 2061 7373 6967 6e65 6420  e tags assigned 
-00009010: 746f 2061 7274 6966 6163 7473 2069 6e20  to artifacts in 
-00009020: 7468 6520 7363 6f70 6520 6f66 2074 6865  the scope of the
-00009030: 2067 6976 656e 2070 726f 6a65 6374 2e22   given project."
-00009040: 2222 0a0a 2020 2020 2020 2020 7072 6f6a  ""..        proj
-00009050: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
-00009060: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
-00009070: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
-00009080: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-00009090: 6622 4661 696c 6564 206c 6973 7469 6e67  f"Failed listing
-000090a0: 2061 7274 6966 6163 7420 7461 6773 2e20   artifact tags. 
-000090b0: 7072 6f6a 6563 743d 7b70 726f 6a65 6374  project={project
-000090c0: 7d22 0a20 2020 2020 2020 2070 6172 616d  }".        param
-000090d0: 7320 3d20 7b22 6361 7465 676f 7279 223a  s = {"category":
-000090e0: 2063 6174 6567 6f72 797d 2069 6620 6361   category} if ca
-000090f0: 7465 676f 7279 2065 6c73 6520 7b7d 0a0a  tegory else {}..
-00009100: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-00009110: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
-00009120: 280a 2020 2020 2020 2020 2020 2020 2247  (.            "G
-00009130: 4554 222c 2066 2270 726f 6a65 6374 732f  ET", f"projects/
-00009140: 7b70 726f 6a65 6374 7d2f 6172 7469 6661  {project}/artifa
-00009150: 6374 2d74 6167 7322 2c20 6572 726f 725f  ct-tags", error_
-00009160: 6d65 7373 6167 652c 2070 6172 616d 733d  message, params=
-00009170: 7061 7261 6d73 0a20 2020 2020 2020 2029  params.        )
-00009180: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00009190: 7265 7370 6f6e 7365 2e6a 736f 6e28 295b  response.json()[
-000091a0: 2274 6167 7322 5d0a 0a20 2020 2064 6566  "tags"]..    def
-000091b0: 2073 746f 7265 5f66 756e 6374 696f 6e28   store_function(
-000091c0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-000091d0: 2020 2020 2020 2066 756e 6374 696f 6e3a         function:
-000091e0: 2074 7970 696e 672e 556e 696f 6e5b 6d6c   typing.Union[ml
-000091f0: 7275 6e2e 7275 6e74 696d 6573 2e42 6173  run.runtimes.Bas
-00009200: 6552 756e 7469 6d65 2c20 6469 6374 5d2c  eRuntime, dict],
-00009210: 0a20 2020 2020 2020 206e 616d 652c 0a20  .        name,. 
-00009220: 2020 2020 2020 2070 726f 6a65 6374 3d22         project="
-00009230: 222c 0a20 2020 2020 2020 2074 6167 3d4e  ",.        tag=N
-00009240: 6f6e 652c 0a20 2020 2020 2020 2076 6572  one,.        ver
-00009250: 7369 6f6e 6564 3d46 616c 7365 2c0a 2020  sioned=False,.  
-00009260: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00009270: 5374 6f72 6520 6120 6675 6e63 7469 6f6e  Store a function
-00009280: 206f 626a 6563 742e 2046 756e 6374 696f   object. Functio
-00009290: 6e20 6973 2069 6465 6e74 6966 6965 6420  n is identified 
-000092a0: 6279 2069 7473 206e 616d 6520 616e 6420  by its name and 
-000092b0: 7461 672c 2061 6e64 2063 616e 2062 6520  tag, and can be 
-000092c0: 7665 7273 696f 6e65 642e 2222 220a 2020  versioned.""".  
-000092d0: 2020 2020 2020 6e61 6d65 203d 206d 6c72        name = mlr
-000092e0: 756e 2e75 7469 6c73 2e6e 6f72 6d61 6c69  un.utils.normali
-000092f0: 7a65 5f6e 616d 6528 6e61 6d65 290a 2020  ze_name(name).  
-00009300: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-00009310: 2866 756e 6374 696f 6e2c 2022 746f 5f64  (function, "to_d
-00009320: 6963 7422 293a 0a20 2020 2020 2020 2020  ict"):.         
-00009330: 2020 2066 756e 6374 696f 6e20 3d20 6675     function = fu
-00009340: 6e63 7469 6f6e 2e74 6f5f 6469 6374 2829  nction.to_dict()
-00009350: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
-00009360: 203d 207b 2274 6167 223a 2074 6167 2c20   = {"tag": tag, 
-00009370: 2276 6572 7369 6f6e 6564 223a 2076 6572  "versioned": ver
-00009380: 7369 6f6e 6564 7d0a 2020 2020 2020 2020  sioned}.        
-00009390: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
-000093a0: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
-000093b0: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
-000093c0: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
-000093d0: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-000093e0: 6675 6e63 7469 6f6e 732f 7b6e 616d 657d  functions/{name}
-000093f0: 220a 0a20 2020 2020 2020 2065 7272 6f72  "..        error
-00009400: 203d 2066 2273 746f 7265 2066 756e 6374   = f"store funct
-00009410: 696f 6e20 7b70 726f 6a65 6374 7d2f 7b6e  ion {project}/{n
-00009420: 616d 657d 220a 2020 2020 2020 2020 7265  ame}".        re
-00009430: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
-00009440: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-00009450: 2250 4f53 5422 2c20 7061 7468 2c20 6572  "POST", path, er
-00009460: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
-00009470: 6d73 2c20 626f 6479 3d64 6963 745f 746f  ms, body=dict_to
-00009480: 5f6a 736f 6e28 6675 6e63 7469 6f6e 290a  _json(function).
-00009490: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000094a0: 2020 2023 2068 6173 6820 6b65 7920 6f70     # hash key op
-000094b0: 7469 6f6e 616c 2074 6f20 6265 2062 6163  tional to be bac
-000094c0: 6b77 6172 6473 2063 6f6d 7061 7469 626c  kwards compatibl
-000094d0: 6520 746f 2041 5049 2076 3c30 2e34 2e31  e to API v<0.4.1
-000094e0: 3020 696e 2077 6869 6368 2069 7420 7761  0 in which it wa
-000094f0: 736e 2774 2069 6e20 7468 6520 7265 7370  sn't in the resp
-00009500: 6f6e 7365 0a20 2020 2020 2020 2072 6574  onse.        ret
-00009510: 7572 6e20 7265 7370 2e6a 736f 6e28 292e  urn resp.json().
-00009520: 6765 7428 2268 6173 685f 6b65 7922 290a  get("hash_key").
-00009530: 0a20 2020 2064 6566 2067 6574 5f66 756e  .    def get_fun
-00009540: 6374 696f 6e28 7365 6c66 2c20 6e61 6d65  ction(self, name
-00009550: 2c20 7072 6f6a 6563 743d 2222 2c20 7461  , project="", ta
-00009560: 673d 4e6f 6e65 2c20 6861 7368 5f6b 6579  g=None, hash_key
-00009570: 3d22 2229 3a0a 2020 2020 2020 2020 2222  =""):.        ""
-00009580: 2252 6574 7269 6576 6520 6465 7461 696c  "Retrieve detail
-00009590: 7320 6f66 2061 2073 7065 6369 6669 6320  s of a specific 
-000095a0: 6675 6e63 7469 6f6e 2c20 6964 656e 7469  function, identi
-000095b0: 6669 6564 2062 7920 6974 7320 6e61 6d65  fied by its name
-000095c0: 2061 6e64 2070 6f74 656e 7469 616c 6c79   and potentially
-000095d0: 2061 2074 6167 206f 7220 6675 6e63 7469   a tag or functi
-000095e0: 6f6e 2068 6173 682e 2222 220a 0a20 2020  on hash."""..   
-000095f0: 2020 2020 2070 6172 616d 7320 3d20 7b22       params = {"
-00009600: 7461 6722 3a20 7461 672c 2022 6861 7368  tag": tag, "hash
-00009610: 5f6b 6579 223a 2068 6173 685f 6b65 797d  _key": hash_key}
-00009620: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00009630: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-00009640: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-00009650: 6a65 6374 0a20 2020 2020 2020 2070 6174  ject.        pat
-00009660: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-00009670: 7072 6f6a 6563 747d 2f66 756e 6374 696f  project}/functio
-00009680: 6e73 2f7b 6e61 6d65 7d22 0a20 2020 2020  ns/{name}".     
-00009690: 2020 2065 7272 6f72 203d 2066 2267 6574     error = f"get
-000096a0: 2066 756e 6374 696f 6e20 7b70 726f 6a65   function {proje
-000096b0: 6374 7d2f 7b6e 616d 657d 220a 2020 2020  ct}/{name}".    
-000096c0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-000096d0: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
-000096e0: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
-000096f0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
-00009700: 2020 2020 7265 7475 726e 2072 6573 702e      return resp.
-00009710: 6a73 6f6e 2829 5b22 6675 6e63 225d 0a0a  json()["func"]..
-00009720: 2020 2020 6465 6620 6465 6c65 7465 5f66      def delete_f
-00009730: 756e 6374 696f 6e28 7365 6c66 2c20 6e61  unction(self, na
-00009740: 6d65 3a20 7374 722c 2070 726f 6a65 6374  me: str, project
-00009750: 3a20 7374 7220 3d20 2222 293a 0a20 2020  : str = ""):.   
-00009760: 2020 2020 2022 2222 4465 6c65 7465 2061       """Delete a
-00009770: 2066 756e 6374 696f 6e20 6265 6c6f 6e67   function belong
-00009780: 696e 6720 746f 2061 2073 7065 6369 6669  ing to a specifi
-00009790: 6320 7072 6f6a 6563 742e 2222 220a 0a20  c project.""".. 
-000097a0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
-000097b0: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
-000097c0: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
-000097d0: 6374 0a20 2020 2020 2020 2070 6174 6820  ct.        path 
-000097e0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-000097f0: 6f6a 6563 747d 2f66 756e 6374 696f 6e73  oject}/functions
-00009800: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
-00009810: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-00009820: 2066 2246 6169 6c65 6420 6465 6c65 7469   f"Failed deleti
-00009830: 6e67 2066 756e 6374 696f 6e20 7b70 726f  ng function {pro
-00009840: 6a65 6374 7d2f 7b6e 616d 657d 220a 2020  ject}/{name}".  
-00009850: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
-00009860: 616c 6c28 2244 454c 4554 4522 2c20 7061  all("DELETE", pa
-00009870: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
-00009880: 6529 0a0a 2020 2020 6465 6620 6c69 7374  e)..    def list
-00009890: 5f66 756e 6374 696f 6e73 2873 656c 662c  _functions(self,
-000098a0: 206e 616d 653d 4e6f 6e65 2c20 7072 6f6a   name=None, proj
-000098b0: 6563 743d 4e6f 6e65 2c20 7461 673d 4e6f  ect=None, tag=No
-000098c0: 6e65 2c20 6c61 6265 6c73 3d4e 6f6e 6529  ne, labels=None)
-000098d0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-000098e0: 7269 6576 6520 6120 6c69 7374 206f 6620  rieve a list of 
-000098f0: 6675 6e63 7469 6f6e 732c 2066 696c 7465  functions, filte
-00009900: 7265 6420 6279 2073 7065 6369 6669 6320  red by specific 
-00009910: 6372 6974 6572 6961 2e0a 0a20 2020 2020  criteria...     
-00009920: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
-00009930: 5265 7475 726e 206f 6e6c 7920 6675 6e63  Return only func
-00009940: 7469 6f6e 7320 7769 7468 2061 2073 7065  tions with a spe
-00009950: 6369 6669 6320 6e61 6d65 2e0a 2020 2020  cific name..    
-00009960: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-00009970: 6374 3a20 5265 7475 726e 2066 756e 6374  ct: Return funct
-00009980: 696f 6e73 2062 656c 6f6e 6769 6e67 2074  ions belonging t
-00009990: 6f20 7468 6973 2070 726f 6a65 6374 2e20  o this project. 
-000099a0: 4966 206e 6f74 2073 7065 6369 6669 6564  If not specified
-000099b0: 2c20 7468 6520 6465 6661 756c 7420 7072  , the default pr
-000099c0: 6f6a 6563 7420 6973 2075 7365 642e 0a20  oject is used.. 
-000099d0: 2020 2020 2020 203a 7061 7261 6d20 7461         :param ta
-000099e0: 673a 2052 6574 7572 6e20 6675 6e63 7469  g: Return functi
-000099f0: 6f6e 2076 6572 7369 6f6e 7320 7769 7468  on versions with
-00009a00: 2073 7065 6369 6669 6320 7461 6773 2e0a   specific tags..
-00009a10: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-00009a20: 6162 656c 733a 2052 6574 7572 6e20 6675  abels: Return fu
-00009a30: 6e63 7469 6f6e 7320 7468 6174 2068 6176  nctions that hav
-00009a40: 6520 7370 6563 6966 6963 206c 6162 656c  e specific label
-00009a50: 7320 6173 7369 676e 6564 2074 6f20 7468  s assigned to th
-00009a60: 656d 2e0a 2020 2020 2020 2020 3a72 6574  em..        :ret
-00009a70: 7572 6e73 3a20 4c69 7374 206f 6620 6675  urns: List of fu
-00009a80: 6e63 7469 6f6e 206f 626a 6563 7473 2028  nction objects (
-00009a90: 6173 2064 6963 7469 6f6e 6172 7929 2e0a  as dictionary)..
-00009aa0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00009ab0: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-00009ac0: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
-00009ad0: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
-00009ae0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-00009af0: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-00009b00: 6e61 6d65 223a 206e 616d 652c 0a20 2020  name": name,.   
-00009b10: 2020 2020 2020 2020 2022 7461 6722 3a20           "tag": 
-00009b20: 7461 672c 0a20 2020 2020 2020 2020 2020  tag,.           
-00009b30: 2022 6c61 6265 6c22 3a20 6c61 6265 6c73   "label": labels
-00009b40: 206f 7220 5b5d 2c0a 2020 2020 2020 2020   or [],.        
-00009b50: 7d0a 2020 2020 2020 2020 6572 726f 7220  }.        error 
-00009b60: 3d20 226c 6973 7420 6675 6e63 7469 6f6e  = "list function
-00009b70: 7322 0a20 2020 2020 2020 2070 6174 6820  s".        path 
-00009b80: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-00009b90: 6f6a 6563 747d 2f66 756e 6374 696f 6e73  oject}/functions
-00009ba0: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
-00009bb0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-00009bc0: 4745 5422 2c20 7061 7468 2c20 6572 726f  GET", path, erro
-00009bd0: 722c 2070 6172 616d 733d 7061 7261 6d73  r, params=params
-00009be0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00009bf0: 2072 6573 702e 6a73 6f6e 2829 5b22 6675   resp.json()["fu
-00009c00: 6e63 7322 5d0a 0a20 2020 2064 6566 206c  ncs"]..    def l
-00009c10: 6973 745f 7275 6e74 696d 655f 7265 736f  ist_runtime_reso
-00009c20: 7572 6365 7328 0a20 2020 2020 2020 2073  urces(.        s
-00009c30: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
-00009c40: 6a65 6374 3a20 4f70 7469 6f6e 616c 5b73  ject: Optional[s
-00009c50: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-00009c60: 2020 2020 6c61 6265 6c5f 7365 6c65 6374      label_select
-00009c70: 6f72 3a20 4f70 7469 6f6e 616c 5b73 7472  or: Optional[str
-00009c80: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00009c90: 2020 6b69 6e64 3a20 4f70 7469 6f6e 616c    kind: Optional
-00009ca0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
-00009cb0: 2020 2020 2020 6f62 6a65 6374 5f69 643a        object_id:
-00009cc0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00009cd0: 204e 6f6e 652c 0a20 2020 2020 2020 2067   None,.        g
-00009ce0: 726f 7570 5f62 793a 204f 7074 696f 6e61  roup_by: Optiona
-00009cf0: 6c5b 0a20 2020 2020 2020 2020 2020 206d  l[.            m
-00009d00: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-00009d10: 6d61 732e 4c69 7374 5275 6e74 696d 6552  mas.ListRuntimeR
-00009d20: 6573 6f75 7263 6573 4772 6f75 7042 7946  esourcesGroupByF
-00009d30: 6965 6c64 0a20 2020 2020 2020 205d 203d  ield.        ] =
-00009d40: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-00009d50: 556e 696f 6e5b 0a20 2020 2020 2020 206d  Union[.        m
-00009d60: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-00009d70: 6d61 732e 5275 6e74 696d 6552 6573 6f75  mas.RuntimeResou
-00009d80: 7263 6573 4f75 7470 7574 2c0a 2020 2020  rcesOutput,.    
-00009d90: 2020 2020 6d6c 7275 6e2e 636f 6d6d 6f6e      mlrun.common
-00009da0: 2e73 6368 656d 6173 2e47 726f 7570 6564  .schemas.Grouped
-00009db0: 4279 4a6f 6252 756e 7469 6d65 5265 736f  ByJobRuntimeReso
-00009dc0: 7572 6365 734f 7574 7075 742c 0a20 2020  urcesOutput,.   
-00009dd0: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
-00009de0: 6e2e 7363 6865 6d61 732e 4772 6f75 7065  n.schemas.Groupe
-00009df0: 6442 7950 726f 6a65 6374 5275 6e74 696d  dByProjectRuntim
-00009e00: 6552 6573 6f75 7263 6573 4f75 7470 7574  eResourcesOutput
-00009e10: 2c0a 2020 2020 5d3a 0a20 2020 2020 2020  ,.    ]:.       
-00009e20: 2022 2222 4c69 7374 2063 7572 7265 6e74   """List current
-00009e30: 2072 756e 7469 6d65 2072 6573 6f75 7263   runtime resourc
-00009e40: 6573 2c20 7768 6963 6820 6172 6520 7573  es, which are us
-00009e50: 7561 6c6c 7920 2862 7574 206e 6f74 206c  ually (but not l
-00009e60: 696d 6974 6564 2074 6f29 204b 7562 6572  imited to) Kuber
-00009e70: 6e65 7465 7320 706f 6473 206f 7220 4352  netes pods or CR
-00009e80: 4473 2e0a 2020 2020 2020 2020 4675 6e63  Ds..        Func
-00009e90: 7469 6f6e 2061 7070 6c69 6573 2066 6f72  tion applies for
-00009ea0: 2072 756e 7320 6f66 2074 7970 6520 605b   runs of type `[
-00009eb0: 2764 6173 6b27 2c20 276a 6f62 272c 2027  'dask', 'job', '
-00009ec0: 7370 6172 6b27 2c20 2772 656d 6f74 652d  spark', 'remote-
-00009ed0: 7370 6172 6b27 2c20 276d 7069 6a6f 6227  spark', 'mpijob'
-00009ee0: 5d60 2c20 616e 6420 7769 6c6c 2072 6574  ]`, and will ret
-00009ef0: 7572 6e20 7065 720a 2020 2020 2020 2020  urn per.        
-00009f00: 7275 6e74 696d 6520 6b69 6e64 2061 206c  runtime kind a l
-00009f10: 6973 7420 6f66 2074 6865 2072 756e 7469  ist of the runti
-00009f20: 6d65 2072 6573 6f75 7263 6573 2028 7768  me resources (wh
-00009f30: 6963 6820 6d61 7920 6861 7665 2061 6c72  ich may have alr
-00009f40: 6561 6479 2063 6f6d 706c 6574 6564 2074  eady completed t
-00009f50: 6865 6972 2065 7865 6375 7469 6f6e 292e  heir execution).
-00009f60: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00009f70: 2070 726f 6a65 6374 3a20 4765 7420 6f6e   project: Get on
-00009f80: 6c79 2072 756e 7469 6d65 2072 6573 6f75  ly runtime resou
-00009f90: 7263 6573 206f 6620 6120 7370 6563 6966  rces of a specif
-00009fa0: 6963 2070 726f 6a65 6374 2c20 6279 2064  ic project, by d
-00009fb0: 6566 6175 6c74 204e 6f6e 652c 2077 6869  efault None, whi
-00009fc0: 6368 2077 696c 6c20 7265 7475 726e 206f  ch will return o
-00009fd0: 6e6c 7920 7468 650a 2020 2020 2020 2020  nly the.        
-00009fe0: 2020 2020 7072 6f6a 6563 7473 2079 6f75      projects you
-00009ff0: 2772 6520 6175 7468 6f72 697a 6564 2074  're authorized t
-0000a000: 6f20 7365 652e 0a20 2020 2020 2020 203a  o see..        :
-0000a010: 7061 7261 6d20 6c61 6265 6c5f 7365 6c65  param label_sele
-0000a020: 6374 6f72 3a20 4120 6c61 6265 6c20 6669  ctor: A label fi
-0000a030: 6c74 6572 2074 6861 7420 7769 6c6c 2062  lter that will b
-0000a040: 6520 7061 7373 6564 2074 6f20 4b75 6265  e passed to Kube
-0000a050: 726e 6574 6573 2066 6f72 2066 696c 7465  rnetes for filte
-0000a060: 7269 6e67 2074 6865 2072 6573 756c 7473  ring the results
-0000a070: 2061 6363 6f72 6469 6e67 0a20 2020 2020   according.     
-0000a080: 2020 2020 2020 2074 6f20 7468 6569 7220         to their 
-0000a090: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
-0000a0a0: 3a70 6172 616d 206b 696e 643a 2054 6865  :param kind: The
-0000a0b0: 206b 696e 6420 6f66 2072 756e 7469 6d65   kind of runtime
-0000a0c0: 2074 6f20 7175 6572 792e 204d 6179 2062   to query. May b
-0000a0d0: 6520 6f6e 6520 6f66 2060 5b27 6461 736b  e one of `['dask
-0000a0e0: 272c 2027 6a6f 6227 2c20 2773 7061 726b  ', 'job', 'spark
-0000a0f0: 272c 2027 7265 6d6f 7465 2d73 7061 726b  ', 'remote-spark
-0000a100: 272c 2027 6d70 696a 6f62 275d 600a 2020  ', 'mpijob']`.  
-0000a110: 2020 2020 2020 3a70 6172 616d 206f 626a        :param obj
-0000a120: 6563 745f 6964 3a20 5468 6520 6964 656e  ect_id: The iden
-0000a130: 7469 6669 6572 206f 6620 7468 6520 6d6c  tifier of the ml
-0000a140: 7275 6e20 6f62 6a65 6374 2074 6f20 7175  run object to qu
-0000a150: 6572 7920 6974 7320 7275 6e74 696d 6520  ery its runtime 
-0000a160: 7265 736f 7572 6365 732e 2066 6f72 206d  resources. for m
-0000a170: 6f73 7420 6675 6e63 7469 6f6e 2072 756e  ost function run
-0000a180: 7469 6d65 732c 0a20 2020 2020 2020 2020  times,.         
-0000a190: 2020 2072 756e 7469 6d65 2072 6573 6f75     runtime resou
-0000a1a0: 7263 6573 2061 7265 2070 6572 2052 756e  rces are per Run
-0000a1b0: 2c20 666f 7220 7768 6963 6820 7468 6520  , for which the 
-0000a1c0: 6964 656e 7469 6669 6572 2069 7320 7468  identifier is th
-0000a1d0: 6520 5275 6e27 7320 5549 442e 2046 6f72  e Run's UID. For
-0000a1e0: 2064 6173 6b20 7275 6e74 696d 652c 2074   dask runtime, t
-0000a1f0: 6865 2072 756e 7469 6d65 0a20 2020 2020  he runtime.     
-0000a200: 2020 2020 2020 2072 6573 6f75 7263 6573         resources
-0000a210: 2061 7265 2070 6572 2046 756e 6374 696f   are per Functio
-0000a220: 6e2c 2066 6f72 2077 6869 6368 2074 6865  n, for which the
-0000a230: 2069 6465 6e74 6966 6965 7220 6973 2074   identifier is t
-0000a240: 6865 2046 756e 6374 696f 6e27 7320 6e61  he Function's na
-0000a250: 6d65 2e0a 2020 2020 2020 2020 3a70 6172  me..        :par
-0000a260: 616d 2067 726f 7570 5f62 793a 204f 626a  am group_by: Obj
-0000a270: 6563 7420 746f 2067 726f 7570 2072 6573  ect to group res
-0000a280: 756c 7473 2062 792e 2041 6c6c 6f77 6564  ults by. Allowed
-0000a290: 2076 616c 7565 7320 6172 6520 606a 6f62   values are `job
-0000a2a0: 6020 616e 6420 6070 726f 6a65 6374 602e  ` and `project`.
-0000a2b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000a2c0: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
-0000a2d0: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
-0000a2e0: 656c 5f73 656c 6563 746f 7222 3a20 6c61  el_selector": la
-0000a2f0: 6265 6c5f 7365 6c65 6374 6f72 2c0a 2020  bel_selector,.  
-0000a300: 2020 2020 2020 2020 2020 2267 726f 7570            "group
-0000a310: 2d62 7922 3a20 6772 6f75 705f 6279 2c0a  -by": group_by,.
-0000a320: 2020 2020 2020 2020 2020 2020 226b 696e              "kin
-0000a330: 6422 3a20 6b69 6e64 2c0a 2020 2020 2020  d": kind,.      
-0000a340: 2020 2020 2020 226f 626a 6563 742d 6964        "object-id
-0000a350: 223a 206f 626a 6563 745f 6964 2c0a 2020  ": object_id,.  
-0000a360: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0000a370: 7072 6f6a 6563 745f 7061 7468 203d 2070  project_path = p
-0000a380: 726f 6a65 6374 2069 6620 7072 6f6a 6563  roject if projec
-0000a390: 7420 656c 7365 2022 2a22 0a20 2020 2020  t else "*".     
-0000a3a0: 2020 2065 7272 6f72 203d 2022 4661 696c     error = "Fail
-0000a3b0: 6564 206c 6973 7469 6e67 2072 756e 7469  ed listing runti
-0000a3c0: 6d65 2072 6573 6f75 7263 6573 220a 2020  me resources".  
-0000a3d0: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
-0000a3e0: 2073 656c 662e 6170 695f 6361 6c6c 280a   self.api_call(.
-0000a3f0: 2020 2020 2020 2020 2020 2020 2247 4554              "GET
-0000a400: 222c 2066 2270 726f 6a65 6374 732f 7b70  ", f"projects/{p
-0000a410: 726f 6a65 6374 5f70 6174 687d 2f72 756e  roject_path}/run
-0000a420: 7469 6d65 2d72 6573 6f75 7263 6573 222c  time-resources",
-0000a430: 2065 7272 6f72 2c20 7061 7261 6d73 3d70   error, params=p
-0000a440: 6172 616d 730a 2020 2020 2020 2020 290a  arams.        ).
-0000a450: 2020 2020 2020 2020 6966 2067 726f 7570          if group
-0000a460: 5f62 7920 6973 204e 6f6e 653a 0a20 2020  _by is None:.   
-0000a470: 2020 2020 2020 2020 2073 7472 7563 7475           structu
-0000a480: 7265 645f 6c69 7374 203d 205b 0a20 2020  red_list = [.   
-0000a490: 2020 2020 2020 2020 2020 2020 206d 6c72               mlr
-0000a4a0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-0000a4b0: 732e 4b69 6e64 5275 6e74 696d 6552 6573  s.KindRuntimeRes
-0000a4c0: 6f75 7263 6573 282a 2a6b 696e 645f 7275  ources(**kind_ru
-0000a4d0: 6e74 696d 655f 7265 736f 7572 6365 7329  ntime_resources)
-0000a4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a4f0: 2066 6f72 206b 696e 645f 7275 6e74 696d   for kind_runtim
-0000a500: 655f 7265 736f 7572 6365 7320 696e 2072  e_resources in r
-0000a510: 6573 706f 6e73 652e 6a73 6f6e 2829 0a20  esponse.json(). 
-0000a520: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-0000a530: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000a540: 7374 7275 6374 7572 6564 5f6c 6973 740a  structured_list.
-0000a550: 2020 2020 2020 2020 656c 6966 2067 726f          elif gro
-0000a560: 7570 5f62 7920 3d3d 206d 6c72 756e 2e63  up_by == mlrun.c
-0000a570: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4c69  ommon.schemas.Li
-0000a580: 7374 5275 6e74 696d 6552 6573 6f75 7263  stRuntimeResourc
-0000a590: 6573 4772 6f75 7042 7946 6965 6c64 2e6a  esGroupByField.j
-0000a5a0: 6f62 3a0a 2020 2020 2020 2020 2020 2020  ob:.            
-0000a5b0: 7374 7275 6374 7572 6564 5f64 6963 7420  structured_dict 
-0000a5c0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-0000a5d0: 2066 6f72 2070 726f 6a65 6374 2c20 6a6f   for project, jo
-0000a5e0: 625f 7275 6e74 696d 655f 7265 736f 7572  b_runtime_resour
-0000a5f0: 6365 735f 6d61 7020 696e 2072 6573 706f  ces_map in respo
-0000a600: 6e73 652e 6a73 6f6e 2829 2e69 7465 6d73  nse.json().items
-0000a610: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000a620: 2020 2020 666f 7220 6a6f 625f 6964 2c20      for job_id, 
-0000a630: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
-0000a640: 7320 696e 206a 6f62 5f72 756e 7469 6d65  s in job_runtime
-0000a650: 5f72 6573 6f75 7263 6573 5f6d 6170 2e69  _resources_map.i
-0000a660: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0000a670: 2020 2020 2020 2020 2020 2020 7374 7275              stru
-0000a680: 6374 7572 6564 5f64 6963 742e 7365 7464  ctured_dict.setd
-0000a690: 6566 6175 6c74 2870 726f 6a65 6374 2c20  efault(project, 
-0000a6a0: 7b7d 295b 0a20 2020 2020 2020 2020 2020  {})[.           
-0000a6b0: 2020 2020 2020 2020 2020 2020 206a 6f62               job
-0000a6c0: 5f69 640a 2020 2020 2020 2020 2020 2020  _id.            
-0000a6d0: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
-0000a6e0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-0000a6f0: 2e52 756e 7469 6d65 5265 736f 7572 6365  .RuntimeResource
-0000a700: 7328 2a2a 7275 6e74 696d 655f 7265 736f  s(**runtime_reso
-0000a710: 7572 6365 7329 0a20 2020 2020 2020 2020  urces).         
-0000a720: 2020 2072 6574 7572 6e20 7374 7275 6374     return struct
-0000a730: 7572 6564 5f64 6963 740a 2020 2020 2020  ured_dict.      
-0000a740: 2020 656c 6966 2067 726f 7570 5f62 7920    elif group_by 
-0000a750: 3d3d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  == mlrun.common.
-0000a760: 7363 6865 6d61 732e 4c69 7374 5275 6e74  schemas.ListRunt
-0000a770: 696d 6552 6573 6f75 7263 6573 4772 6f75  imeResourcesGrou
-0000a780: 7042 7946 6965 6c64 2e70 726f 6a65 6374  pByField.project
-0000a790: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
-0000a7a0: 7275 6374 7572 6564 5f64 6963 7420 3d20  ructured_dict = 
-0000a7b0: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
-0000a7c0: 6f72 2070 726f 6a65 6374 2c20 6b69 6e64  or project, kind
-0000a7d0: 5f72 756e 7469 6d65 5f72 6573 6f75 7263  _runtime_resourc
-0000a7e0: 6573 5f6d 6170 2069 6e20 7265 7370 6f6e  es_map in respon
-0000a7f0: 7365 2e6a 736f 6e28 292e 6974 656d 7328  se.json().items(
-0000a800: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000a810: 2020 2066 6f72 206b 696e 642c 2072 756e     for kind, run
-0000a820: 7469 6d65 5f72 6573 6f75 7263 6573 2069  time_resources i
-0000a830: 6e20 6b69 6e64 5f72 756e 7469 6d65 5f72  n kind_runtime_r
-0000a840: 6573 6f75 7263 6573 5f6d 6170 2e69 7465  esources_map.ite
-0000a850: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0000a860: 2020 2020 2020 2020 2020 7374 7275 6374            struct
-0000a870: 7572 6564 5f64 6963 742e 7365 7464 6566  ured_dict.setdef
-0000a880: 6175 6c74 2870 726f 6a65 6374 2c20 7b7d  ault(project, {}
-0000a890: 295b 0a20 2020 2020 2020 2020 2020 2020  )[.             
-0000a8a0: 2020 2020 2020 2020 2020 206b 696e 640a             kind.
-0000a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8c0: 2020 2020 5d20 3d20 6d6c 7275 6e2e 636f      ] = mlrun.co
-0000a8d0: 6d6d 6f6e 2e73 6368 656d 6173 2e52 756e  mmon.schemas.Run
-0000a8e0: 7469 6d65 5265 736f 7572 6365 7328 2a2a  timeResources(**
-0000a8f0: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
-0000a900: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-0000a910: 6574 7572 6e20 7374 7275 6374 7572 6564  eturn structured
-0000a920: 5f64 6963 740a 2020 2020 2020 2020 656c  _dict.        el
-0000a930: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000a940: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
-0000a950: 6e74 6564 4572 726f 7228 0a20 2020 2020  ntedError(.     
-0000a960: 2020 2020 2020 2020 2020 2066 2250 726f             f"Pro
-0000a970: 7669 6465 6420 6772 6f75 7020 6279 2066  vided group by f
-0000a980: 6965 6c64 2069 7320 6e6f 7420 7375 7070  ield is not supp
-0000a990: 6f72 7465 642e 2067 726f 7570 5f62 793d  orted. group_by=
-0000a9a0: 7b67 726f 7570 5f62 797d 220a 2020 2020  {group_by}".    
-0000a9b0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-0000a9c0: 6566 2064 656c 6574 655f 7275 6e74 696d  ef delete_runtim
-0000a9d0: 655f 7265 736f 7572 6365 7328 0a20 2020  e_resources(.   
-0000a9e0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000a9f0: 2020 2070 726f 6a65 6374 3a20 4f70 7469     project: Opti
-0000aa00: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-0000aa10: 2c0a 2020 2020 2020 2020 6c61 6265 6c5f  ,.        label_
-0000aa20: 7365 6c65 6374 6f72 3a20 4f70 7469 6f6e  selector: Option
-0000aa30: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0000aa40: 2020 2020 2020 2020 6b69 6e64 3a20 4f70          kind: Op
-0000aa50: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-0000aa60: 6e65 2c0a 2020 2020 2020 2020 6f62 6a65  ne,.        obje
-0000aa70: 6374 5f69 643a 204f 7074 696f 6e61 6c5b  ct_id: Optional[
-0000aa80: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-0000aa90: 2020 2020 2066 6f72 6365 3a20 626f 6f6c       force: bool
-0000aaa0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-0000aab0: 2020 6772 6163 655f 7065 7269 6f64 3a20    grace_period: 
-0000aac0: 696e 7420 3d20 4e6f 6e65 2c0a 2020 2020  int = None,.    
-0000aad0: 2920 2d3e 206d 6c72 756e 2e63 6f6d 6d6f  ) -> mlrun.commo
-0000aae0: 6e2e 7363 6865 6d61 732e 4772 6f75 7065  n.schemas.Groupe
-0000aaf0: 6442 7950 726f 6a65 6374 5275 6e74 696d  dByProjectRuntim
-0000ab00: 6552 6573 6f75 7263 6573 4f75 7470 7574  eResourcesOutput
-0000ab10: 3a0a 2020 2020 2020 2020 2222 2244 656c  :.        """Del
-0000ab20: 6574 6520 616c 6c20 7275 6e74 696d 6520  ete all runtime 
-0000ab30: 7265 736f 7572 6365 7320 7768 6963 6820  resources which 
-0000ab40: 6172 6520 696e 2074 6572 6d69 6e61 6c20  are in terminal 
-0000ab50: 7374 6174 652e 0a0a 2020 2020 2020 2020  state...        
-0000ab60: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
-0000ab70: 4465 6c65 7465 206f 6e6c 7920 7275 6e74  Delete only runt
-0000ab80: 696d 6520 7265 736f 7572 6365 7320 6f66  ime resources of
-0000ab90: 2061 2073 7065 6369 6669 6320 7072 6f6a   a specific proj
-0000aba0: 6563 742c 2062 7920 6465 6661 756c 7420  ect, by default 
-0000abb0: 4e6f 6e65 2c20 7768 6963 6820 7769 6c6c  None, which will
-0000abc0: 2064 656c 6574 6520 6f6e 6c79 0a20 2020   delete only.   
-0000abd0: 2020 2020 2020 2020 2066 726f 6d20 7468           from th
-0000abe0: 6520 7072 6f6a 6563 7473 2079 6f75 2772  e projects you'r
-0000abf0: 6520 6175 7468 6f72 697a 6564 2074 6f20  e authorized to 
-0000ac00: 6465 6c65 7465 2066 726f 6d2e 0a20 2020  delete from..   
-0000ac10: 2020 2020 203a 7061 7261 6d20 6c61 6265       :param labe
-0000ac20: 6c5f 7365 6c65 6374 6f72 3a20 4465 6c65  l_selector: Dele
-0000ac30: 7465 206f 6e6c 7920 7275 6e74 696d 6520  te only runtime 
-0000ac40: 7265 736f 7572 6365 7320 6d61 7463 6869  resources matchi
-0000ac50: 6e67 2074 6865 206c 6162 656c 2073 656c  ng the label sel
-0000ac60: 6563 746f 722e 0a20 2020 2020 2020 203a  ector..        :
-0000ac70: 7061 7261 6d20 6b69 6e64 3a20 5468 6520  param kind: The 
-0000ac80: 6b69 6e64 206f 6620 7275 6e74 696d 6520  kind of runtime 
-0000ac90: 746f 2064 656c 6574 652e 204d 6179 2062  to delete. May b
-0000aca0: 6520 6f6e 6520 6f66 2060 5b27 6461 736b  e one of `['dask
-0000acb0: 272c 2027 6a6f 6227 2c20 2773 7061 726b  ', 'job', 'spark
-0000acc0: 272c 2027 7265 6d6f 7465 2d73 7061 726b  ', 'remote-spark
-0000acd0: 272c 2027 6d70 696a 6f62 275d 600a 2020  ', 'mpijob']`.  
-0000ace0: 2020 2020 2020 3a70 6172 616d 206f 626a        :param obj
-0000acf0: 6563 745f 6964 3a20 5468 6520 6964 656e  ect_id: The iden
-0000ad00: 7469 6669 6572 206f 6620 7468 6520 6d6c  tifier of the ml
-0000ad10: 7275 6e20 6f62 6a65 6374 2074 6f20 6465  run object to de
-0000ad20: 6c65 7465 2069 7473 2072 756e 7469 6d65  lete its runtime
-0000ad30: 2072 6573 6f75 7263 6573 2e20 666f 7220   resources. for 
-0000ad40: 6d6f 7374 2066 756e 6374 696f 6e0a 2020  most function.  
-0000ad50: 2020 2020 2020 2020 2020 7275 6e74 696d            runtim
-0000ad60: 6573 2c20 7275 6e74 696d 6520 7265 736f  es, runtime reso
-0000ad70: 7572 6365 7320 6172 6520 7065 7220 5275  urces are per Ru
-0000ad80: 6e2c 2066 6f72 2077 6869 6368 2074 6865  n, for which the
-0000ad90: 2069 6465 6e74 6966 6965 7220 6973 2074   identifier is t
-0000ada0: 6865 2052 756e 2773 2055 4944 2e20 466f  he Run's UID. Fo
-0000adb0: 7220 6461 736b 2072 756e 7469 6d65 2c20  r dask runtime, 
-0000adc0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-0000add0: 7275 6e74 696d 6520 7265 736f 7572 6365  runtime resource
-0000ade0: 7320 6172 6520 7065 7220 4675 6e63 7469  s are per Functi
-0000adf0: 6f6e 2c20 666f 7220 7768 6963 6820 7468  on, for which th
-0000ae00: 6520 6964 656e 7469 6669 6572 2069 7320  e identifier is 
-0000ae10: 7468 6520 4675 6e63 7469 6f6e 2773 206e  the Function's n
-0000ae20: 616d 652e 0a20 2020 2020 2020 203a 7061  ame..        :pa
-0000ae30: 7261 6d20 666f 7263 653a 2046 6f72 6365  ram force: Force
-0000ae40: 2064 656c 6574 696f 6e20 2d20 6465 6c65   deletion - dele
-0000ae50: 7465 2074 6865 2072 756e 7469 6d65 2072  te the runtime r
-0000ae60: 6573 6f75 7263 6520 6576 656e 2069 6620  esource even if 
-0000ae70: 6974 2773 206e 6f74 2069 6e20 7465 726d  it's not in term
-0000ae80: 696e 616c 2073 7461 7465 206f 7220 6966  inal state or if
-0000ae90: 2074 6865 2067 7261 6365 0a20 2020 2020   the grace.     
-0000aea0: 2020 2020 2020 2070 6572 696f 6420 6469         period di
-0000aeb0: 646e 2774 2070 6173 732e 0a20 2020 2020  dn't pass..     
-0000aec0: 2020 203a 7061 7261 6d20 6772 6163 655f     :param grace_
-0000aed0: 7065 7269 6f64 3a20 4772 6163 6520 7065  period: Grace pe
-0000aee0: 7269 6f64 2067 6976 656e 2074 6f20 7468  riod given to th
-0000aef0: 6520 7275 6e74 696d 6520 7265 736f 7572  e runtime resour
-0000af00: 6365 2062 6566 6f72 6520 7468 6579 2061  ce before they a
-0000af10: 7265 2061 6374 7561 6c6c 7920 7265 6d6f  re actually remo
-0000af20: 7665 642c 2063 6f75 6e74 6564 2066 726f  ved, counted fro
-0000af30: 6d0a 2020 2020 2020 2020 2020 2020 7468  m.            th
-0000af40: 6520 6d6f 6d65 6e74 2074 6865 7920 6d6f  e moment they mo
-0000af50: 7665 6420 746f 2074 6572 6d69 6e61 6c20  ved to terminal 
-0000af60: 7374 6174 6520 2864 6566 6175 6c74 7320  state (defaults 
-0000af70: 746f 206d 6c72 756e 2e6d 6c63 6f6e 662e  to mlrun.mlconf.
-0000af80: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
-0000af90: 735f 6465 6c65 7469 6f6e 5f67 7261 6365  s_deletion_grace
-0000afa0: 5f70 6572 696f 6429 2e0a 0a20 2020 2020  _period)...     
-0000afb0: 2020 203a 7265 7475 726e 733a 203a 7079     :returns: :py
-0000afc0: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e63  :class:`~mlrun.c
-0000afd0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4772  ommon.schemas.Gr
-0000afe0: 6f75 7065 6442 7950 726f 6a65 6374 5275  oupedByProjectRu
-0000aff0: 6e74 696d 6552 6573 6f75 7263 6573 4f75  ntimeResourcesOu
-0000b000: 7470 7574 6020 6c69 7374 696e 6720 7468  tput` listing th
-0000b010: 6520 7275 6e74 696d 6520 7265 736f 7572  e runtime resour
-0000b020: 6365 730a 2020 2020 2020 2020 2020 2020  ces.            
-0000b030: 7468 6174 2077 6572 6520 7265 6d6f 7665  that were remove
-0000b040: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-0000b050: 2020 2020 2020 2069 6620 6772 6163 655f         if grace_
-0000b060: 7065 7269 6f64 2069 7320 4e6f 6e65 3a0a  period is None:.
-0000b070: 2020 2020 2020 2020 2020 2020 6772 6163              grac
-0000b080: 655f 7065 7269 6f64 203d 2063 6f6e 6669  e_period = confi
-0000b090: 672e 7275 6e74 696d 655f 7265 736f 7572  g.runtime_resour
-0000b0a0: 6365 735f 6465 6c65 7469 6f6e 5f67 7261  ces_deletion_gra
-0000b0b0: 6365 5f70 6572 696f 640a 2020 2020 2020  ce_period.      
-0000b0c0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-0000b0d0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-0000b0e0: 2020 2022 5573 696e 6720 6465 6661 756c     "Using defaul
-0000b0f0: 7420 6772 6163 6520 7065 7269 6f64 2066  t grace period f
-0000b100: 6f72 2072 756e 7469 6d65 2072 6573 6f75  or runtime resou
-0000b110: 7263 6573 2064 656c 6574 696f 6e22 2c0a  rces deletion",.
-0000b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b130: 6772 6163 655f 7065 7269 6f64 3d67 7261  grace_period=gra
-0000b140: 6365 5f70 6572 696f 642c 0a20 2020 2020  ce_period,.     
-0000b150: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000b160: 2020 7061 7261 6d73 203d 207b 0a20 2020    params = {.   
-0000b170: 2020 2020 2020 2020 2022 6c61 6265 6c2d           "label-
-0000b180: 7365 6c65 6374 6f72 223a 206c 6162 656c  selector": label
-0000b190: 5f73 656c 6563 746f 722c 0a20 2020 2020  _selector,.     
-0000b1a0: 2020 2020 2020 2022 6b69 6e64 223a 206b         "kind": k
-0000b1b0: 696e 642c 0a20 2020 2020 2020 2020 2020  ind,.           
-0000b1c0: 2022 6f62 6a65 6374 2d69 6422 3a20 6f62   "object-id": ob
-0000b1d0: 6a65 6374 5f69 642c 0a20 2020 2020 2020  ject_id,.       
-0000b1e0: 2020 2020 2022 666f 7263 6522 3a20 666f       "force": fo
-0000b1f0: 7263 652c 0a20 2020 2020 2020 2020 2020  rce,.           
-0000b200: 2022 6772 6163 652d 7065 7269 6f64 223a   "grace-period":
-0000b210: 2067 7261 6365 5f70 6572 696f 642c 0a20   grace_period,. 
-0000b220: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0000b230: 2065 7272 6f72 203d 2022 4661 696c 6564   error = "Failed
-0000b240: 2064 656c 6574 696e 6720 7275 6e74 696d   deleting runtim
-0000b250: 6520 7265 736f 7572 6365 7322 0a20 2020  e resources".   
-0000b260: 2020 2020 2070 726f 6a65 6374 5f70 6174       project_pat
-0000b270: 6820 3d20 7072 6f6a 6563 7420 6966 2070  h = project if p
-0000b280: 726f 6a65 6374 2065 6c73 6520 222a 220a  roject else "*".
-0000b290: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-0000b2a0: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
-0000b2b0: 280a 2020 2020 2020 2020 2020 2020 2244  (.            "D
-0000b2c0: 454c 4554 4522 2c0a 2020 2020 2020 2020  ELETE",.        
-0000b2d0: 2020 2020 6622 7072 6f6a 6563 7473 2f7b      f"projects/{
-0000b2e0: 7072 6f6a 6563 745f 7061 7468 7d2f 7275  project_path}/ru
-0000b2f0: 6e74 696d 652d 7265 736f 7572 6365 7322  ntime-resources"
-0000b300: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
-0000b310: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
-0000b320: 2070 6172 616d 733d 7061 7261 6d73 2c0a   params=params,.
-0000b330: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000b340: 2020 7374 7275 6374 7572 6564 5f64 6963    structured_dic
-0000b350: 7420 3d20 7b7d 0a20 2020 2020 2020 2066  t = {}.        f
-0000b360: 6f72 2070 726f 6a65 6374 2c20 6b69 6e64  or project, kind
-0000b370: 5f72 756e 7469 6d65 5f72 6573 6f75 7263  _runtime_resourc
-0000b380: 6573 5f6d 6170 2069 6e20 7265 7370 6f6e  es_map in respon
-0000b390: 7365 2e6a 736f 6e28 292e 6974 656d 7328  se.json().items(
-0000b3a0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-0000b3b0: 6f72 206b 696e 642c 2072 756e 7469 6d65  or kind, runtime
-0000b3c0: 5f72 6573 6f75 7263 6573 2069 6e20 6b69  _resources in ki
-0000b3d0: 6e64 5f72 756e 7469 6d65 5f72 6573 6f75  nd_runtime_resou
-0000b3e0: 7263 6573 5f6d 6170 2e69 7465 6d73 2829  rces_map.items()
-0000b3f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b400: 2020 7374 7275 6374 7572 6564 5f64 6963    structured_dic
-0000b410: 742e 7365 7464 6566 6175 6c74 2870 726f  t.setdefault(pro
-0000b420: 6a65 6374 2c20 7b7d 295b 0a20 2020 2020  ject, {})[.     
-0000b430: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0000b440: 696e 640a 2020 2020 2020 2020 2020 2020  ind.            
-0000b450: 2020 2020 5d20 3d20 6d6c 7275 6e2e 636f      ] = mlrun.co
-0000b460: 6d6d 6f6e 2e73 6368 656d 6173 2e52 756e  mmon.schemas.Run
-0000b470: 7469 6d65 5265 736f 7572 6365 7328 2a2a  timeResources(**
-0000b480: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
-0000b490: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-0000b4a0: 6e20 7374 7275 6374 7572 6564 5f64 6963  n structured_dic
-0000b4b0: 740a 0a20 2020 2064 6566 2063 7265 6174  t..    def creat
-0000b4c0: 655f 7363 6865 6475 6c65 280a 2020 2020  e_schedule(.    
-0000b4d0: 2020 2020 7365 6c66 2c20 7072 6f6a 6563      self, projec
-0000b4e0: 743a 2073 7472 2c20 7363 6865 6475 6c65  t: str, schedule
-0000b4f0: 3a20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  : mlrun.common.s
-0000b500: 6368 656d 6173 2e53 6368 6564 756c 6549  chemas.ScheduleI
-0000b510: 6e70 7574 0a20 2020 2029 3a0a 2020 2020  nput.    ):.    
-0000b520: 2020 2020 2222 2243 7265 6174 6520 6120      """Create a 
-0000b530: 6e65 7720 7363 6865 6475 6c65 206f 6e20  new schedule on 
-0000b540: 7468 6520 6769 7665 6e20 7072 6f6a 6563  the given projec
-0000b550: 742e 2054 6865 2064 6574 6169 6c73 206f  t. The details o
-0000b560: 6e20 7468 6520 6163 7475 616c 206f 626a  n the actual obj
-0000b570: 6563 7420 746f 2073 6368 6564 756c 6520  ect to schedule 
-0000b580: 6173 2077 656c 6c20 6173 2074 6865 0a20  as well as the. 
-0000b590: 2020 2020 2020 2073 6368 6564 756c 6520         schedule 
-0000b5a0: 6974 7365 6c66 2061 7265 2077 6974 6869  itself are withi
-0000b5b0: 6e20 7468 6520 7363 6865 6475 6c65 206f  n the schedule o
-0000b5c0: 626a 6563 7420 7072 6f76 6964 6564 2e0a  bject provided..
-0000b5d0: 2020 2020 2020 2020 5468 6520 3a70 793a          The :py:
-0000b5e0: 636c 6173 733a 607e 5363 6865 6475 6c65  class:`~Schedule
-0000b5f0: 4372 6f6e 5472 6967 6765 7260 2066 6f6c  CronTrigger` fol
-0000b600: 6c6f 7773 2074 6865 2067 7569 6465 6c69  lows the guideli
-0000b610: 6e65 7320 696e 0a20 2020 2020 2020 2068  nes in.        h
-0000b620: 7474 7073 3a2f 2f61 7073 6368 6564 756c  ttps://apschedul
-0000b630: 6572 2e72 6561 6474 6865 646f 6373 2e69  er.readthedocs.i
-0000b640: 6f2f 656e 2f33 2e78 2f6d 6f64 756c 6573  o/en/3.x/modules
-0000b650: 2f74 7269 6767 6572 732f 6372 6f6e 2e68  /triggers/cron.h
-0000b660: 746d 6c2e 0a20 2020 2020 2020 2049 7420  tml..        It 
-0000b670: 616c 736f 2073 7570 706f 7274 7320 6120  also supports a 
-0000b680: 3a70 793a 6675 6e63 3a60 7e53 6368 6564  :py:func:`~Sched
-0000b690: 756c 6543 726f 6e54 7269 6767 6572 2e66  uleCronTrigger.f
-0000b6a0: 726f 6d5f 6372 6f6e 7461 6260 2066 756e  rom_crontab` fun
-0000b6b0: 6374 696f 6e20 7468 6174 2061 6363 6570  ction that accep
-0000b6c0: 7473 2061 0a20 2020 2020 2020 2063 726f  ts a.        cro
-0000b6d0: 6e74 6162 2d66 6f72 6d61 7474 6564 2073  ntab-formatted s
-0000b6e0: 7472 696e 6720 2873 6565 2068 7474 7073  tring (see https
-0000b6f0: 3a2f 2f65 6e2e 7769 6b69 7065 6469 612e  ://en.wikipedia.
-0000b700: 6f72 672f 7769 6b69 2f43 726f 6e20 666f  org/wiki/Cron fo
-0000b710: 7220 6d6f 7265 2069 6e66 6f72 6d61 7469  r more informati
-0000b720: 6f6e 206f 6e20 7468 6520 666f 726d 6174  on on the format
-0000b730: 2061 6e64 0a20 2020 2020 2020 206e 6f74   and.        not
-0000b740: 6520 7468 6174 2074 6865 2030 2077 6565  e that the 0 wee
-0000b750: 6b64 6179 2069 7320 616c 7761 7973 206d  kday is always m
-0000b760: 6f6e 6461 7929 2e0a 0a0a 2020 2020 2020  onday)....      
-0000b770: 2020 4578 616d 706c 653a 3a0a 0a20 2020    Example::..   
-0000b780: 2020 2020 2020 2020 2066 726f 6d20 6d6c           from ml
-0000b790: 7275 6e2e 636f 6d6d 6f6e 2069 6d70 6f72  run.common impor
-0000b7a0: 7420 7363 6865 6d61 730a 0a20 2020 2020  t schemas..     
-0000b7b0: 2020 2020 2020 2023 2045 7865 6375 7465         # Execute
-0000b7c0: 2074 6865 2067 6574 5f64 6174 615f 6675   the get_data_fu
-0000b7d0: 6e63 2066 756e 6374 696f 6e20 6576 6572  nc function ever
-0000b7e0: 7920 5475 6573 6461 7920 6174 2031 353a  y Tuesday at 15:
-0000b7f0: 3330 0a20 2020 2020 2020 2020 2020 2073  30.            s
-0000b800: 6368 6564 756c 6520 3d20 7363 6865 6d61  chedule = schema
-0000b810: 732e 5363 6865 6475 6c65 496e 7075 7428  s.ScheduleInput(
-0000b820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b830: 206e 616d 653d 2272 756e 5f66 756e 635f   name="run_func_
-0000b840: 6f6e 5f74 7565 7364 6179 7322 2c0a 2020  on_tuesdays",.  
-0000b850: 2020 2020 2020 2020 2020 2020 2020 6b69                ki
-0000b860: 6e64 3d22 6a6f 6222 2c0a 2020 2020 2020  nd="job",.      
-0000b870: 2020 2020 2020 2020 2020 7363 6865 6475            schedu
-0000b880: 6c65 645f 6f62 6a65 6374 3d67 6574 5f64  led_object=get_d
-0000b890: 6174 615f 6675 6e63 2c0a 2020 2020 2020  ata_func,.      
-0000b8a0: 2020 2020 2020 2020 2020 6372 6f6e 5f74            cron_t
-0000b8b0: 7269 6767 6572 3d73 6368 656d 6173 2e53  rigger=schemas.S
-0000b8c0: 6368 6564 756c 6543 726f 6e54 7269 6767  cheduleCronTrigg
-0000b8d0: 6572 2864 6179 5f6f 665f 7765 656b 3d27  er(day_of_week='
-0000b8e0: 7475 6527 2c20 686f 7572 3d31 352c 206d  tue', hour=15, m
-0000b8f0: 696e 7574 653d 3330 292c 0a20 2020 2020  inute=30),.     
-0000b900: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000b910: 2020 2020 2064 622e 6372 6561 7465 5f73       db.create_s
-0000b920: 6368 6564 756c 6528 7072 6f6a 6563 745f  chedule(project_
-0000b930: 6e61 6d65 2c20 7363 6865 6475 6c65 290a  name, schedule).
-0000b940: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000b950: 2020 2020 2070 726f 6a65 6374 203d 2070       project = p
-0000b960: 726f 6a65 6374 206f 7220 636f 6e66 6967  roject or config
-0000b970: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
-0000b980: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-0000b990: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
-0000b9a0: 6563 747d 2f73 6368 6564 756c 6573 220a  ect}/schedules".
-0000b9b0: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
-0000b9c0: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
-0000b9d0: 6420 6372 6561 7469 6e67 2073 6368 6564  d creating sched
-0000b9e0: 756c 6520 7b70 726f 6a65 6374 7d2f 7b73  ule {project}/{s
-0000b9f0: 6368 6564 756c 652e 6e61 6d65 7d22 0a20  chedule.name}". 
-0000ba00: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
-0000ba10: 6361 6c6c 2822 504f 5354 222c 2070 6174  call("POST", pat
-0000ba20: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
-0000ba30: 2c20 626f 6479 3d64 6963 745f 746f 5f6a  , body=dict_to_j
-0000ba40: 736f 6e28 7363 6865 6475 6c65 2e64 6963  son(schedule.dic
-0000ba50: 7428 2929 290a 0a20 2020 2064 6566 2075  t()))..    def u
-0000ba60: 7064 6174 655f 7363 6865 6475 6c65 280a  pdate_schedule(.
-0000ba70: 2020 2020 2020 2020 7365 6c66 2c20 7072          self, pr
-0000ba80: 6f6a 6563 743a 2073 7472 2c20 6e61 6d65  oject: str, name
-0000ba90: 3a20 7374 722c 2073 6368 6564 756c 653a  : str, schedule:
-0000baa0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-0000bab0: 6865 6d61 732e 5363 6865 6475 6c65 5570  hemas.ScheduleUp
-0000bac0: 6461 7465 0a20 2020 2029 3a0a 2020 2020  date.    ):.    
-0000bad0: 2020 2020 2222 2255 7064 6174 6520 616e      """Update an
-0000bae0: 2065 7869 7374 696e 6720 7363 6865 6475   existing schedu
-0000baf0: 6c65 2c20 7265 706c 6163 6520 6974 2077  le, replace it w
-0000bb00: 6974 6820 7468 6520 6465 7461 696c 7320  ith the details 
-0000bb10: 636f 6e74 6169 6e65 6420 696e 2074 6865  contained in the
-0000bb20: 2073 6368 6564 756c 6520 6f62 6a65 6374   schedule object
-0000bb30: 2e22 2222 0a0a 2020 2020 2020 2020 7072  ."""..        pr
-0000bb40: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
-0000bb50: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
-0000bb60: 745f 7072 6f6a 6563 740a 2020 2020 2020  t_project.      
-0000bb70: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
-0000bb80: 6374 732f 7b70 726f 6a65 6374 7d2f 7363  cts/{project}/sc
-0000bb90: 6865 6475 6c65 732f 7b6e 616d 657d 220a  hedules/{name}".
-0000bba0: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
-0000bbb0: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
-0000bbc0: 6420 7570 6461 7469 6e67 2073 6368 6564  d updating sched
-0000bbd0: 756c 6520 7b70 726f 6a65 6374 7d2f 7b6e  ule {project}/{n
-0000bbe0: 616d 657d 220a 2020 2020 2020 2020 7365  ame}".        se
-0000bbf0: 6c66 2e61 7069 5f63 616c 6c28 2250 5554  lf.api_call("PUT
-0000bc00: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
-0000bc10: 6573 7361 6765 2c20 626f 6479 3d64 6963  essage, body=dic
-0000bc20: 745f 746f 5f6a 736f 6e28 7363 6865 6475  t_to_json(schedu
-0000bc30: 6c65 2e64 6963 7428 2929 290a 0a20 2020  le.dict()))..   
-0000bc40: 2064 6566 2067 6574 5f73 6368 6564 756c   def get_schedul
-0000bc50: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0000bc60: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
-0000bc70: 616d 653a 2073 7472 2c20 696e 636c 7564  ame: str, includ
-0000bc80: 655f 6c61 7374 5f72 756e 3a20 626f 6f6c  e_last_run: bool
-0000bc90: 203d 2046 616c 7365 0a20 2020 2029 202d   = False.    ) -
-0000bca0: 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  > mlrun.common.s
-0000bcb0: 6368 656d 6173 2e53 6368 6564 756c 654f  chemas.ScheduleO
-0000bcc0: 7574 7075 743a 0a20 2020 2020 2020 2022  utput:.        "
-0000bcd0: 2222 5265 7472 6965 7665 2064 6574 6169  ""Retrieve detai
-0000bce0: 6c73 206f 6620 7468 6520 7363 6865 6475  ls of the schedu
-0000bcf0: 6c65 2069 6e20 7175 6573 7469 6f6e 2e20  le in question. 
-0000bd00: 4265 7369 6465 7320 7265 7475 726e 696e  Besides returnin
-0000bd10: 6720 7468 6520 6465 7461 696c 7320 6f66  g the details of
-0000bd20: 2074 6865 2073 6368 6564 756c 6520 6f62   the schedule ob
-0000bd30: 6a65 6374 2069 7473 656c 662c 0a20 2020  ject itself,.   
-0000bd40: 2020 2020 2074 6869 7320 6675 6e63 7469       this functi
-0000bd50: 6f6e 2061 6c73 6f20 7265 7475 726e 7320  on also returns 
-0000bd60: 7468 6520 6e65 7874 2073 6368 6564 756c  the next schedul
-0000bd70: 6564 2072 756e 2066 6f72 2074 6869 7320  ed run for this 
-0000bd80: 7370 6563 6966 6963 2073 6368 6564 756c  specific schedul
-0000bd90: 652c 2061 7320 7765 6c6c 2061 7320 706f  e, as well as po
-0000bda0: 7465 6e74 6961 6c6c 7920 7468 650a 2020  tentially the.  
-0000bdb0: 2020 2020 2020 7265 7375 6c74 7320 6f66        results of
-0000bdc0: 2074 6865 206c 6173 7420 7275 6e20 6578   the last run ex
-0000bdd0: 6563 7574 6564 2074 6872 6f75 6768 2074  ecuted through t
-0000bde0: 6869 7320 7363 6865 6475 6c65 2e0a 0a20  his schedule... 
-0000bdf0: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
-0000be00: 6f6a 6563 743a 2050 726f 6a65 6374 206e  oject: Project n
-0000be10: 616d 652e 0a20 2020 2020 2020 203a 7061  ame..        :pa
-0000be20: 7261 6d20 6e61 6d65 3a20 4e61 6d65 206f  ram name: Name o
-0000be30: 6620 7468 6520 7363 6865 6475 6c65 206f  f the schedule o
-0000be40: 626a 6563 7420 746f 2071 7565 7279 2e0a  bject to query..
-0000be50: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-0000be60: 6e63 6c75 6465 5f6c 6173 745f 7275 6e3a  nclude_last_run:
-0000be70: 2057 6865 7468 6572 2074 6f20 696e 636c   Whether to incl
-0000be80: 7564 6520 7468 6520 7265 7375 6c74 7320  ude the results 
-0000be90: 6f66 2074 6865 2073 6368 6564 756c 6527  of the schedule'
-0000bea0: 7320 6c61 7374 2072 756e 2069 6e20 7468  s last run in th
-0000beb0: 6520 7265 7370 6f6e 7365 2e0a 2020 2020  e response..    
-0000bec0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0000bed0: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-0000bee0: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-0000bef0: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-0000bf00: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
-0000bf10: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
-0000bf20: 2f73 6368 6564 756c 6573 2f7b 6e61 6d65  /schedules/{name
-0000bf30: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
-0000bf40: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
-0000bf50: 6c65 6420 6765 7474 696e 6720 7363 6865  led getting sche
-0000bf60: 6475 6c65 2066 6f72 207b 7072 6f6a 6563  dule for {projec
-0000bf70: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
-0000bf80: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
-0000bf90: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
-0000bfa0: 2020 2020 2022 4745 5422 2c20 7061 7468       "GET", path
-0000bfb0: 2c20 6572 726f 725f 6d65 7373 6167 652c  , error_message,
-0000bfc0: 2070 6172 616d 733d 7b22 696e 636c 7564   params={"includ
-0000bfd0: 655f 6c61 7374 5f72 756e 223a 2069 6e63  e_last_run": inc
-0000bfe0: 6c75 6465 5f6c 6173 745f 7275 6e7d 0a20  lude_last_run}. 
-0000bff0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000c000: 2072 6574 7572 6e20 6d6c 7275 6e2e 636f   return mlrun.co
-0000c010: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6368  mmon.schemas.Sch
-0000c020: 6564 756c 654f 7574 7075 7428 2a2a 7265  eduleOutput(**re
-0000c030: 7370 2e6a 736f 6e28 2929 0a0a 2020 2020  sp.json())..    
-0000c040: 6465 6620 6c69 7374 5f73 6368 6564 756c  def list_schedul
-0000c050: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
-0000c060: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-0000c070: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
-0000c080: 6e61 6d65 3a20 7374 7220 3d20 4e6f 6e65  name: str = None
-0000c090: 2c0a 2020 2020 2020 2020 6b69 6e64 3a20  ,.        kind: 
-0000c0a0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-0000c0b0: 656d 6173 2e53 6368 6564 756c 654b 696e  emas.ScheduleKin
-0000c0c0: 6473 203d 204e 6f6e 652c 0a20 2020 2020  ds = None,.     
-0000c0d0: 2020 2069 6e63 6c75 6465 5f6c 6173 745f     include_last_
-0000c0e0: 7275 6e3a 2062 6f6f 6c20 3d20 4661 6c73  run: bool = Fals
-0000c0f0: 652c 0a20 2020 2029 202d 3e20 6d6c 7275  e,.    ) -> mlru
-0000c100: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-0000c110: 2e53 6368 6564 756c 6573 4f75 7470 7574  .SchedulesOutput
-0000c120: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-0000c130: 7269 6576 6520 6c69 7374 206f 6620 7363  rieve list of sc
-0000c140: 6865 6475 6c65 7320 6f66 2073 7065 6369  hedules of speci
-0000c150: 6669 6320 6e61 6d65 206f 7220 6b69 6e64  fic name or kind
-0000c160: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0000c170: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
-0000c180: 6374 206e 616d 652e 0a20 2020 2020 2020  ct name..       
-0000c190: 203a 7061 7261 6d20 6e61 6d65 3a20 4e61   :param name: Na
-0000c1a0: 6d65 206f 6620 7363 6865 6475 6c65 2074  me of schedule t
-0000c1b0: 6f20 7265 7472 6965 7665 2e20 4361 6e20  o retrieve. Can 
-0000c1c0: 6265 206f 6d69 7474 6564 2074 6f20 6c69  be omitted to li
-0000c1d0: 7374 2061 6c6c 2073 6368 6564 756c 6573  st all schedules
-0000c1e0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0000c1f0: 206b 696e 643a 204b 696e 6420 6f66 2073   kind: Kind of s
-0000c200: 6368 6564 756c 6520 6f62 6a65 6374 7320  chedule objects 
-0000c210: 746f 2072 6574 7269 6576 652c 2063 616e  to retrieve, can
-0000c220: 2062 6520 6569 7468 6572 2060 606a 6f62   be either ``job
-0000c230: 6060 206f 7220 6060 7069 7065 6c69 6e65  `` or ``pipeline
-0000c240: 6060 2e0a 2020 2020 2020 2020 3a70 6172  ``..        :par
-0000c250: 616d 2069 6e63 6c75 6465 5f6c 6173 745f  am include_last_
-0000c260: 7275 6e3a 2057 6865 7468 6572 2074 6f20  run: Whether to 
-0000c270: 7265 7475 726e 2066 6f72 2065 6163 6820  return for each 
-0000c280: 7363 6865 6475 6c65 2072 6574 7572 6e65  schedule returne
-0000c290: 6420 616c 736f 2074 6865 2072 6573 756c  d also the resul
-0000c2a0: 7473 206f 6620 7468 6520 6c61 7374 2072  ts of the last r
-0000c2b0: 756e 206f 660a 2020 2020 2020 2020 2020  un of.          
-0000c2c0: 2020 7468 6174 2073 6368 6564 756c 652e    that schedule.
-0000c2d0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0000c2e0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
-0000c2f0: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
-0000c300: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
-0000c310: 740a 2020 2020 2020 2020 7061 7261 6d73  t.        params
-0000c320: 203d 207b 226b 696e 6422 3a20 6b69 6e64   = {"kind": kind
-0000c330: 2c20 226e 616d 6522 3a20 6e61 6d65 2c20  , "name": name, 
-0000c340: 2269 6e63 6c75 6465 5f6c 6173 745f 7275  "include_last_ru
-0000c350: 6e22 3a20 696e 636c 7564 655f 6c61 7374  n": include_last
-0000c360: 5f72 756e 7d0a 2020 2020 2020 2020 7061  _run}.        pa
-0000c370: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-0000c380: 7b70 726f 6a65 6374 7d2f 7363 6865 6475  {project}/schedu
-0000c390: 6c65 7322 0a20 2020 2020 2020 2065 7272  les".        err
-0000c3a0: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-0000c3b0: 6169 6c65 6420 6c69 7374 696e 6720 7363  ailed listing sc
-0000c3c0: 6865 6475 6c65 7320 666f 7220 7b70 726f  hedules for {pro
-0000c3d0: 6a65 6374 7d20 3f20 7b6b 696e 647d 207b  ject} ? {kind} {
-0000c3e0: 6e61 6d65 7d22 0a20 2020 2020 2020 2072  name}".        r
-0000c3f0: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
-0000c400: 616c 6c28 2247 4554 222c 2070 6174 682c  all("GET", path,
-0000c410: 2065 7272 6f72 5f6d 6573 7361 6765 2c20   error_message, 
-0000c420: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
-0000c430: 2020 2020 2020 2072 6574 7572 6e20 6d6c         return ml
-0000c440: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0000c450: 6173 2e53 6368 6564 756c 6573 4f75 7470  as.SchedulesOutp
-0000c460: 7574 282a 2a72 6573 702e 6a73 6f6e 2829  ut(**resp.json()
-0000c470: 290a 0a20 2020 2064 6566 2064 656c 6574  )..    def delet
-0000c480: 655f 7363 6865 6475 6c65 2873 656c 662c  e_schedule(self,
-0000c490: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
-0000c4a0: 616d 653a 2073 7472 293a 0a20 2020 2020  ame: str):.     
-0000c4b0: 2020 2022 2222 4465 6c65 7465 2061 2073     """Delete a s
-0000c4c0: 7065 6369 6669 6320 7363 6865 6475 6c65  pecific schedule
-0000c4d0: 2062 7920 6e61 6d65 2e22 2222 0a0a 2020   by name."""..  
-0000c4e0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
-0000c4f0: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
-0000c500: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
-0000c510: 740a 2020 2020 2020 2020 7061 7468 203d  t.        path =
-0000c520: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-0000c530: 6a65 6374 7d2f 7363 6865 6475 6c65 732f  ject}/schedules/
-0000c540: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-0000c550: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-0000c560: 6622 4661 696c 6564 2064 656c 6574 696e  f"Failed deletin
-0000c570: 6720 7363 6865 6475 6c65 207b 7072 6f6a  g schedule {proj
-0000c580: 6563 747d 2f7b 6e61 6d65 7d22 0a20 2020  ect}/{name}".   
-0000c590: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
-0000c5a0: 6c6c 2822 4445 4c45 5445 222c 2070 6174  ll("DELETE", pat
-0000c5b0: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
-0000c5c0: 290a 0a20 2020 2064 6566 2069 6e76 6f6b  )..    def invok
-0000c5d0: 655f 7363 6865 6475 6c65 2873 656c 662c  e_schedule(self,
-0000c5e0: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
-0000c5f0: 616d 653a 2073 7472 293a 0a20 2020 2020  ame: str):.     
-0000c600: 2020 2022 2222 4578 6563 7574 6520 7468     """Execute th
-0000c610: 6520 6f62 6a65 6374 2072 6566 6572 656e  e object referen
-0000c620: 6365 6420 6279 2074 6865 2073 6368 6564  ced by the sched
-0000c630: 756c 6520 696d 6d65 6469 6174 656c 792e  ule immediately.
-0000c640: 2222 220a 0a20 2020 2020 2020 2070 726f  """..        pro
-0000c650: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
-0000c660: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
-0000c670: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
-0000c680: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
-0000c690: 7473 2f7b 7072 6f6a 6563 747d 2f73 6368  ts/{project}/sch
-0000c6a0: 6564 756c 6573 2f7b 6e61 6d65 7d2f 696e  edules/{name}/in
-0000c6b0: 766f 6b65 220a 2020 2020 2020 2020 6572  voke".        er
-0000c6c0: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
-0000c6d0: 4661 696c 6564 2069 6e76 6f6b 696e 6720  Failed invoking 
-0000c6e0: 7363 6865 6475 6c65 207b 7072 6f6a 6563  schedule {projec
-0000c6f0: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
-0000c700: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
-0000c710: 2822 504f 5354 222c 2070 6174 682c 2065  ("POST", path, e
-0000c720: 7272 6f72 5f6d 6573 7361 6765 290a 0a20  rror_message).. 
-0000c730: 2020 2064 6566 2072 656d 6f74 655f 6275     def remote_bu
-0000c740: 696c 6465 7228 0a20 2020 2020 2020 2073  ilder(.        s
-0000c750: 656c 662c 0a20 2020 2020 2020 2066 756e  elf,.        fun
-0000c760: 632c 0a20 2020 2020 2020 2077 6974 685f  c,.        with_
-0000c770: 6d6c 7275 6e2c 0a20 2020 2020 2020 206d  mlrun,.        m
-0000c780: 6c72 756e 5f76 6572 7369 6f6e 5f73 7065  lrun_version_spe
-0000c790: 6369 6669 6572 3d4e 6f6e 652c 0a20 2020  cifier=None,.   
-0000c7a0: 2020 2020 2073 6b69 705f 6465 706c 6f79       skip_deploy
-0000c7b0: 6564 3d46 616c 7365 2c0a 2020 2020 2020  ed=False,.      
-0000c7c0: 2020 6275 696c 6465 725f 656e 763d 4e6f    builder_env=No
-0000c7d0: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
-0000c7e0: 2020 2022 2222 4275 696c 6420 7468 6520     """Build the 
-0000c7f0: 706f 6420 696d 6167 6520 666f 7220 6120  pod image for a 
-0000c800: 6675 6e63 7469 6f6e 2c20 666f 7220 6578  function, for ex
-0000c810: 6563 7574 696f 6e20 6f6e 2061 2072 656d  ecution on a rem
-0000c820: 6f74 6520 636c 7573 7465 722e 2054 6869  ote cluster. Thi
-0000c830: 7320 6973 2065 7865 6375 7465 6420 6279  s is executed by
-0000c840: 2074 6865 204d 4c52 756e 0a20 2020 2020   the MLRun.     
-0000c850: 2020 2041 5049 2073 6572 7665 722c 2061     API server, a
-0000c860: 6e64 2063 7265 6174 6573 2061 2044 6f63  nd creates a Doc
-0000c870: 6b65 7220 696d 6167 6520 6f75 7420 6f66  ker image out of
-0000c880: 2074 6865 2066 756e 6374 696f 6e20 7072   the function pr
-0000c890: 6f76 6964 6564 2061 6e64 2061 6e79 2073  ovided and any s
-0000c8a0: 7065 6369 6669 6320 6275 696c 640a 2020  pecific build.  
-0000c8b0: 2020 2020 2020 696e 7374 7275 6374 696f        instructio
-0000c8c0: 6e73 2070 726f 7669 6465 6420 7769 7468  ns provided with
-0000c8d0: 696e 2e20 5468 6973 2069 7320 6120 7072  in. This is a pr
-0000c8e0: 652d 7265 7175 6973 6974 6520 666f 7220  e-requisite for 
-0000c8f0: 7265 6d6f 7465 6c79 2065 7865 6375 7469  remotely executi
-0000c900: 6e67 2061 2066 756e 6374 696f 6e2c 2075  ng a function, u
-0000c910: 6e6c 6573 7320 7573 696e 670a 2020 2020  nless using.    
-0000c920: 2020 2020 6120 7072 652d 6465 706c 6f79      a pre-deploy
-0000c930: 6564 2069 6d61 6765 2e0a 0a20 2020 2020  ed image...     
-0000c940: 2020 203a 7061 7261 6d20 6675 6e63 3a20     :param func: 
-0000c950: 4675 6e63 7469 6f6e 2074 6f20 6275 696c  Function to buil
-0000c960: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
-0000c970: 6d20 7769 7468 5f6d 6c72 756e 3a20 5768  m with_mlrun: Wh
-0000c980: 6574 6865 7220 746f 2061 6464 204d 4c52  ether to add MLR
-0000c990: 756e 2070 6163 6b61 6765 2074 6f20 7468  un package to th
-0000c9a0: 6520 6275 696c 7420 7061 636b 6167 652e  e built package.
-0000c9b0: 2054 6869 7320 6973 206e 6f74 2072 6571   This is not req
-0000c9c0: 7569 7265 6420 6966 2075 7369 6e67 2061  uired if using a
-0000c9d0: 2062 6173 650a 2020 2020 2020 2020 2020   base.          
-0000c9e0: 2020 696d 6167 6520 7468 6174 2061 6c72    image that alr
-0000c9f0: 6561 6479 2068 6173 204d 4c52 756e 2069  eady has MLRun i
-0000ca00: 6e20 6974 2e0a 2020 2020 2020 2020 3a70  n it..        :p
-0000ca10: 6172 616d 206d 6c72 756e 5f76 6572 7369  aram mlrun_versi
-0000ca20: 6f6e 5f73 7065 6369 6669 6572 3a20 5665  on_specifier: Ve
-0000ca30: 7273 696f 6e20 6f66 204d 4c52 756e 2074  rsion of MLRun t
-0000ca40: 6f20 696e 636c 7564 6520 696e 2074 6865  o include in the
-0000ca50: 2062 7569 6c74 2069 6d61 6765 2e0a 2020   built image..  
-0000ca60: 2020 2020 2020 3a70 6172 616d 2073 6b69        :param ski
-0000ca70: 705f 6465 706c 6f79 6564 3a20 536b 6970  p_deployed: Skip
-0000ca80: 2074 6865 2062 7569 6c64 2069 6620 7765   the build if we
-0000ca90: 2061 6c72 6561 6479 2068 6176 6520 616e   already have an
-0000caa0: 2069 6d61 6765 2066 6f72 2074 6865 2066   image for the f
-0000cab0: 756e 6374 696f 6e2e 0a20 2020 2020 2020  unction..       
-0000cac0: 203a 7061 7261 6d20 6275 696c 6465 725f   :param builder_
-0000cad0: 656e 763a 2020 204b 616e 696b 6f20 6275  env:   Kaniko bu
-0000cae0: 696c 6465 7220 706f 6420 656e 7620 7661  ilder pod env va
-0000caf0: 7273 2064 6963 7420 2866 6f72 2063 6f6e  rs dict (for con
-0000cb00: 6669 672f 6372 6564 656e 7469 616c 7329  fig/credentials)
-0000cb10: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0000cb20: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000cb30: 2020 2020 2020 2072 6571 203d 207b 0a20         req = {. 
-0000cb40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000cb50: 6675 6e63 7469 6f6e 223a 2066 756e 632e  function": func.
-0000cb60: 746f 5f64 6963 7428 292c 0a20 2020 2020  to_dict(),.     
-0000cb70: 2020 2020 2020 2020 2020 2022 7769 7468             "with
-0000cb80: 5f6d 6c72 756e 223a 2062 6f6f 6c32 7374  _mlrun": bool2st
-0000cb90: 7228 7769 7468 5f6d 6c72 756e 292c 0a20  r(with_mlrun),. 
-0000cba0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000cbb0: 736b 6970 5f64 6570 6c6f 7965 6422 3a20  skip_deployed": 
-0000cbc0: 736b 6970 5f64 6570 6c6f 7965 642c 0a20  skip_deployed,. 
-0000cbd0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-0000cbe0: 2020 2020 2020 2020 2069 6620 6d6c 7275           if mlru
-0000cbf0: 6e5f 7665 7273 696f 6e5f 7370 6563 6966  n_version_specif
-0000cc00: 6965 723a 0a20 2020 2020 2020 2020 2020  ier:.           
-0000cc10: 2020 2020 2072 6571 5b22 6d6c 7275 6e5f       req["mlrun_
-0000cc20: 7665 7273 696f 6e5f 7370 6563 6966 6965  version_specifie
-0000cc30: 7222 5d20 3d20 6d6c 7275 6e5f 7665 7273  r"] = mlrun_vers
-0000cc40: 696f 6e5f 7370 6563 6966 6965 720a 2020  ion_specifier.  
-0000cc50: 2020 2020 2020 2020 2020 6966 2062 7569            if bui
-0000cc60: 6c64 6572 5f65 6e76 3a0a 2020 2020 2020  lder_env:.      
-0000cc70: 2020 2020 2020 2020 2020 7265 715b 2262            req["b
-0000cc80: 7569 6c64 6572 5f65 6e76 225d 203d 2062  uilder_env"] = b
-0000cc90: 7569 6c64 6572 5f65 6e76 0a20 2020 2020  uilder_env.     
-0000cca0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-0000ccb0: 6c66 2e61 7069 5f63 616c 6c28 2250 4f53  lf.api_call("POS
-0000ccc0: 5422 2c20 2262 7569 6c64 2f66 756e 6374  T", "build/funct
-0000ccd0: 696f 6e22 2c20 6a73 6f6e 3d72 6571 290a  ion", json=req).
-0000cce0: 2020 2020 2020 2020 6578 6365 7074 204f          except O
-0000ccf0: 5345 7272 6f72 2061 7320 6572 723a 0a20  SError as err:. 
-0000cd00: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0000cd10: 722e 6572 726f 7228 6622 6572 726f 7220  r.error(f"error 
-0000cd20: 7375 626d 6974 7469 6e67 2062 7569 6c64  submitting build
-0000cd30: 2074 6173 6b3a 207b 6572 725f 746f 5f73   task: {err_to_s
-0000cd40: 7472 2865 7272 297d 2229 0a20 2020 2020  tr(err)}").     
-0000cd50: 2020 2020 2020 2072 6169 7365 204f 5345         raise OSE
-0000cd60: 7272 6f72 2866 2265 7272 6f72 3a20 6361  rror(f"error: ca
-0000cd70: 6e6e 6f74 2073 7562 6d69 7420 6275 696c  nnot submit buil
-0000cd80: 642c 207b 6572 725f 746f 5f73 7472 2865  d, {err_to_str(e
-0000cd90: 7272 297d 2229 0a0a 2020 2020 2020 2020  rr)}")..        
-0000cda0: 6966 206e 6f74 2072 6573 702e 6f6b 3a0a  if not resp.ok:.
-0000cdb0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0000cdc0: 6572 2e65 7272 6f72 2866 2262 6164 2072  er.error(f"bad r
-0000cdd0: 6573 7021 215c 6e7b 7265 7370 2e74 6578  esp!!\n{resp.tex
-0000cde0: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
-0000cdf0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000ce00: 7228 2262 6164 2066 756e 6374 696f 6e20  r("bad function 
-0000ce10: 7275 6e20 7265 7370 6f6e 7365 2229 0a0a  run response")..
-0000ce20: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0000ce30: 6573 702e 6a73 6f6e 2829 0a0a 2020 2020  esp.json()..    
-0000ce40: 6465 6620 6765 745f 6275 696c 6465 725f  def get_builder_
-0000ce50: 7374 6174 7573 280a 2020 2020 2020 2020  status(.        
-0000ce60: 7365 6c66 2c0a 2020 2020 2020 2020 6675  self,.        fu
-0000ce70: 6e63 3a20 4261 7365 5275 6e74 696d 652c  nc: BaseRuntime,
-0000ce80: 0a20 2020 2020 2020 206f 6666 7365 743a  .        offset:
-0000ce90: 2069 6e74 203d 2030 2c0a 2020 2020 2020   int = 0,.      
-0000cea0: 2020 6c6f 6773 3a20 626f 6f6c 203d 2054    logs: bool = T
-0000ceb0: 7275 652c 0a20 2020 2020 2020 206c 6173  rue,.        las
-0000cec0: 745f 6c6f 675f 7469 6d65 7374 616d 703a  t_log_timestamp:
-0000ced0: 2066 6c6f 6174 203d 2030 2e30 2c0a 2020   float = 0.0,.  
-0000cee0: 2020 2020 2020 7665 7262 6f73 653a 2062        verbose: b
-0000cef0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0000cf00: 2029 3a0a 2020 2020 2020 2020 2222 2252   ):.        """R
-0000cf10: 6574 7269 6576 6520 7468 6520 7374 6174  etrieve the stat
-0000cf20: 7573 206f 6620 6120 6275 696c 6420 6f70  us of a build op
-0000cf30: 6572 6174 696f 6e20 6375 7272 656e 746c  eration currentl
-0000cf40: 7920 696e 2070 726f 6772 6573 732e 0a0a  y in progress...
-0000cf50: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-0000cf60: 756e 633a 2020 2020 2020 2020 2020 2020  unc:            
-0000cf70: 2020 2020 4675 6e63 7469 6f6e 206f 626a      Function obj
-0000cf80: 6563 7420 7468 6174 2069 7320 6265 696e  ect that is bein
-0000cf90: 6720 6275 696c 742e 0a20 2020 2020 2020  g built..       
-0000cfa0: 203a 7061 7261 6d20 6f66 6673 6574 3a20   :param offset: 
-0000cfb0: 2020 2020 2020 2020 2020 2020 204f 6666               Off
-0000cfc0: 7365 7420 696e 746f 2074 6865 2062 7569  set into the bui
-0000cfd0: 6c64 206c 6f67 7320 746f 2072 6574 7269  ld logs to retri
-0000cfe0: 6576 6520 6c6f 6773 2066 726f 6d2e 0a20  eve logs from.. 
-0000cff0: 2020 2020 2020 203a 7061 7261 6d20 6c6f         :param lo
-0000d000: 6773 3a20 2020 2020 2020 2020 2020 2020  gs:             
-0000d010: 2020 2053 686f 756c 6420 6275 696c 6420     Should build 
-0000d020: 6c6f 6773 2062 6520 7265 7472 6965 7665  logs be retrieve
-0000d030: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
-0000d040: 6d20 6c61 7374 5f6c 6f67 5f74 696d 6573  m last_log_times
-0000d050: 7461 6d70 3a20 204c 6173 7420 7469 6d65  tamp:  Last time
-0000d060: 7374 616d 7020 6f66 206c 6f67 7320 7468  stamp of logs th
-0000d070: 6174 2077 6572 6520 616c 7265 6164 7920  at were already 
-0000d080: 7265 7472 6965 7665 642e 2046 756e 6374  retrieved. Funct
-0000d090: 696f 6e20 7769 6c6c 2072 6574 7572 6e20  ion will return 
-0000d0a0: 6f6e 6c79 206c 6f67 730a 2020 2020 2020  only logs.      
-0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0c0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0000d0d0: 7465 7220 7468 616e 2074 6869 7320 7061  ter than this pa
-0000d0e0: 7261 6d65 7465 722e 0a20 2020 2020 2020  rameter..       
-0000d0f0: 203a 7061 7261 6d20 7665 7262 6f73 653a   :param verbose:
-0000d100: 2020 2020 2020 2020 2020 2020 2041 6464               Add
-0000d110: 2076 6572 626f 7365 206c 6f67 7320 696e   verbose logs in
-0000d120: 746f 2074 6865 206f 7574 7075 742e 0a0a  to the output...
-0000d130: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
-0000d140: 3a20 5468 6520 666f 6c6c 6f77 696e 6720  : The following 
-0000d150: 7061 7261 6d65 7465 7273 3a0a 0a20 2020  parameters:..   
-0000d160: 2020 2020 2020 2020 202d 2054 6578 7420           - Text 
-0000d170: 6f66 2062 7569 6c64 6572 206c 6f67 732e  of builder logs.
-0000d180: 0a20 2020 2020 2020 2020 2020 202d 2054  .            - T
-0000d190: 696d 6573 7461 6d70 206f 6620 6c61 7374  imestamp of last
-0000d1a0: 206c 6f67 2072 6574 7269 6576 6564 2c20   log retrieved, 
-0000d1b0: 746f 2062 6520 7573 6564 2069 6e20 7375  to be used in su
-0000d1c0: 6273 6571 7565 6e74 2063 616c 6c73 2074  bsequent calls t
-0000d1d0: 6f20 7468 6973 2066 756e 6374 696f 6e2e  o this function.
-0000d1e0: 0a0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
-0000d1f0: 6520 6675 6e63 7469 6f6e 2061 6c73 6f20  e function also 
-0000d200: 7570 6461 7465 7320 696e 7465 726e 616c  updates internal
-0000d210: 206d 656d 6265 7273 206f 6620 7468 6520   members of the 
-0000d220: 6060 6675 6e63 6060 206f 626a 6563 7420  ``func`` object 
-0000d230: 746f 2072 6566 6c65 6374 2062 7569 6c64  to reflect build
-0000d240: 2070 726f 6365 7373 2069 6e66 6f2e 0a20   process info.. 
-0000d250: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000d260: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000d270: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
-0000d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d290: 226e 616d 6522 3a20 6e6f 726d 616c 697a  "name": normaliz
-0000d2a0: 655f 6e61 6d65 2866 756e 632e 6d65 7461  e_name(func.meta
-0000d2b0: 6461 7461 2e6e 616d 6529 2c0a 2020 2020  data.name),.    
-0000d2c0: 2020 2020 2020 2020 2020 2020 2270 726f              "pro
-0000d2d0: 6a65 6374 223a 2066 756e 632e 6d65 7461  ject": func.meta
-0000d2e0: 6461 7461 2e70 726f 6a65 6374 2c0a 2020  data.project,.  
-0000d2f0: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-0000d300: 6167 223a 2066 756e 632e 6d65 7461 6461  ag": func.metada
-0000d310: 7461 2e74 6167 2c0a 2020 2020 2020 2020  ta.tag,.        
-0000d320: 2020 2020 2020 2020 226c 6f67 7322 3a20          "logs": 
-0000d330: 626f 6f6c 3273 7472 286c 6f67 7329 2c0a  bool2str(logs),.
-0000d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d350: 226f 6666 7365 7422 3a20 7374 7228 6f66  "offset": str(of
-0000d360: 6673 6574 292c 0a20 2020 2020 2020 2020  fset),.         
-0000d370: 2020 2020 2020 2022 6c61 7374 5f6c 6f67         "last_log
-0000d380: 5f74 696d 6573 7461 6d70 223a 2073 7472  _timestamp": str
-0000d390: 286c 6173 745f 6c6f 675f 7469 6d65 7374  (last_log_timest
-0000d3a0: 616d 7029 2c0a 2020 2020 2020 2020 2020  amp),.          
-0000d3b0: 2020 2020 2020 2276 6572 626f 7365 223a        "verbose":
-0000d3c0: 2062 6f6f 6c32 7374 7228 7665 7262 6f73   bool2str(verbos
-0000d3d0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-0000d3e0: 7d0a 2020 2020 2020 2020 2020 2020 7265  }.            re
-0000d3f0: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
-0000d400: 6c6c 2822 4745 5422 2c20 2262 7569 6c64  ll("GET", "build
-0000d410: 2f73 7461 7475 7322 2c20 7061 7261 6d73  /status", params
-0000d420: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
-0000d430: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
-0000d440: 6173 2065 7272 3a0a 2020 2020 2020 2020  as err:.        
-0000d450: 2020 2020 6c6f 6767 6572 2e65 7272 6f72      logger.error
-0000d460: 2866 2265 7272 6f72 2067 6574 7469 6e67  (f"error getting
-0000d470: 2062 7569 6c64 2073 7461 7475 733a 207b   build status: {
-0000d480: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
-0000d490: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-0000d4a0: 6169 7365 204f 5345 7272 6f72 2866 2265  aise OSError(f"e
-0000d4b0: 7272 6f72 3a20 6361 6e6e 6f74 2067 6574  rror: cannot get
-0000d4c0: 2062 7569 6c64 2073 7461 7475 732c 207b   build status, {
-0000d4d0: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
-0000d4e0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
-0000d4f0: 6f74 2072 6573 702e 6f6b 3a0a 2020 2020  ot resp.ok:.    
-0000d500: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-0000d510: 6172 6e69 6e67 2866 2266 6169 6c65 6420  arning(f"failed 
-0000d520: 7265 7370 2c20 7b72 6573 702e 7465 7874  resp, {resp.text
-0000d530: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000d540: 7261 6973 6520 5275 6e44 4245 7272 6f72  raise RunDBError
-0000d550: 2822 6261 6420 6675 6e63 7469 6f6e 2062  ("bad function b
-0000d560: 7569 6c64 2072 6573 706f 6e73 6522 290a  uild response").
-0000d570: 0a20 2020 2020 2020 2069 6620 7265 7370  .        if resp
-0000d580: 2e68 6561 6465 7273 3a0a 2020 2020 2020  .headers:.      
-0000d590: 2020 2020 2020 6675 6e63 2e73 7461 7475        func.statu
-0000d5a0: 732e 7374 6174 6520 3d20 7265 7370 2e68  s.state = resp.h
-0000d5b0: 6561 6465 7273 2e67 6574 2822 782d 6d6c  eaders.get("x-ml
-0000d5c0: 7275 6e2d 6675 6e63 7469 6f6e 2d73 7461  run-function-sta
-0000d5d0: 7475 7322 2c20 2222 290a 2020 2020 2020  tus", "").      
-0000d5e0: 2020 2020 2020 6c61 7374 5f6c 6f67 5f74        last_log_t
-0000d5f0: 696d 6573 7461 6d70 203d 2066 6c6f 6174  imestamp = float
-0000d600: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d610: 2020 7265 7370 2e68 6561 6465 7273 2e67    resp.headers.g
-0000d620: 6574 2822 782d 6d6c 7275 6e2d 6c61 7374  et("x-mlrun-last
-0000d630: 2d74 696d 6573 7461 6d70 222c 2022 302e  -timestamp", "0.
-0000d640: 3022 290a 2020 2020 2020 2020 2020 2020  0").            
-0000d650: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000d660: 2066 756e 632e 6b69 6e64 2069 6e20 6d6c   func.kind in ml
-0000d670: 7275 6e2e 7275 6e74 696d 6573 2e52 756e  run.runtimes.Run
-0000d680: 7469 6d65 4b69 6e64 732e 6e75 636c 696f  timeKinds.nuclio
-0000d690: 5f72 756e 7469 6d65 7328 293a 0a20 2020  _runtimes():.   
-0000d6a0: 2020 2020 2020 2020 2020 2020 2066 756e               fun
-0000d6b0: 632e 7374 6174 7573 2e61 6464 7265 7373  c.status.address
-0000d6c0: 203d 2072 6573 702e 6865 6164 6572 732e   = resp.headers.
-0000d6d0: 6765 7428 2278 2d6d 6c72 756e 2d61 6464  get("x-mlrun-add
-0000d6e0: 7265 7373 222c 2022 2229 0a20 2020 2020  ress", "").     
-0000d6f0: 2020 2020 2020 2020 2020 2066 756e 632e             func.
-0000d700: 7374 6174 7573 2e6e 7563 6c69 6f5f 6e61  status.nuclio_na
-0000d710: 6d65 203d 2072 6573 702e 6865 6164 6572  me = resp.header
-0000d720: 732e 6765 7428 2278 2d6d 6c72 756e 2d6e  s.get("x-mlrun-n
-0000d730: 616d 6522 2c20 2222 290a 2020 2020 2020  ame", "").      
-0000d740: 2020 2020 2020 2020 2020 6675 6e63 2e73            func.s
-0000d750: 7461 7475 732e 696e 7465 726e 616c 5f69  tatus.internal_i
-0000d760: 6e76 6f63 6174 696f 6e5f 7572 6c73 203d  nvocation_urls =
-0000d770: 2072 6573 702e 6865 6164 6572 732e 6765   resp.headers.ge
-0000d780: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000d790: 2020 2020 2020 2022 782d 6d6c 7275 6e2d         "x-mlrun-
-0000d7a0: 696e 7465 726e 616c 2d69 6e76 6f63 6174  internal-invocat
-0000d7b0: 696f 6e2d 7572 6c73 222c 2022 220a 2020  ion-urls", "".  
-0000d7c0: 2020 2020 2020 2020 2020 2020 2020 292e                ).
-0000d7d0: 7370 6c69 7428 222c 2229 0a20 2020 2020  split(",").     
-0000d7e0: 2020 2020 2020 2020 2020 2066 756e 632e             func.
-0000d7f0: 7374 6174 7573 2e65 7874 6572 6e61 6c5f  status.external_
-0000d800: 696e 766f 6361 7469 6f6e 5f75 726c 7320  invocation_urls 
-0000d810: 3d20 7265 7370 2e68 6561 6465 7273 2e67  = resp.headers.g
-0000d820: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
-0000d830: 2020 2020 2020 2020 2278 2d6d 6c72 756e          "x-mlrun
-0000d840: 2d65 7874 6572 6e61 6c2d 696e 766f 6361  -external-invoca
-0000d850: 7469 6f6e 2d75 726c 7322 2c20 2222 0a20  tion-urls", "". 
-0000d860: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000d870: 2e73 706c 6974 2822 2c22 290a 2020 2020  .split(",").    
-0000d880: 2020 2020 2020 2020 2020 2020 6675 6e63              func
-0000d890: 2e73 7461 7475 732e 636f 6e74 6169 6e65  .status.containe
-0000d8a0: 725f 696d 6167 6520 3d20 7265 7370 2e68  r_image = resp.h
-0000d8b0: 6561 6465 7273 2e67 6574 280a 2020 2020  eaders.get(.    
-0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8d0: 2278 2d6d 6c72 756e 2d63 6f6e 7461 696e  "x-mlrun-contain
-0000d8e0: 6572 2d69 6d61 6765 222c 2022 220a 2020  er-image", "".  
-0000d8f0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000d900: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000d910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d920: 2020 6675 6e63 2e73 7461 7475 732e 6275    func.status.bu
-0000d930: 696c 645f 706f 6420 3d20 7265 7370 2e68  ild_pod = resp.h
-0000d940: 6561 6465 7273 2e67 6574 2822 6275 696c  eaders.get("buil
-0000d950: 6465 725f 706f 6422 2c20 2222 290a 2020  der_pod", "").  
-0000d960: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0000d970: 6e63 2e73 7065 632e 696d 6167 6520 3d20  nc.spec.image = 
-0000d980: 7265 7370 2e68 6561 6465 7273 2e67 6574  resp.headers.get
-0000d990: 2822 6675 6e63 7469 6f6e 5f69 6d61 6765  ("function_image
-0000d9a0: 222c 2022 2229 0a0a 2020 2020 2020 2020  ", "")..        
-0000d9b0: 7465 7874 203d 2022 220a 2020 2020 2020  text = "".      
-0000d9c0: 2020 6966 2072 6573 702e 636f 6e74 656e    if resp.conten
-0000d9d0: 743a 0a20 2020 2020 2020 2020 2020 2074  t:.            t
-0000d9e0: 6578 7420 3d20 7265 7370 2e63 6f6e 7465  ext = resp.conte
-0000d9f0: 6e74 2e64 6563 6f64 6528 290a 2020 2020  nt.decode().    
-0000da00: 2020 2020 7265 7475 726e 2074 6578 742c      return text,
-0000da10: 206c 6173 745f 6c6f 675f 7469 6d65 7374   last_log_timest
-0000da20: 616d 700a 0a20 2020 2064 6566 2072 656d  amp..    def rem
-0000da30: 6f74 655f 7374 6172 7428 7365 6c66 2c20  ote_start(self, 
-0000da40: 6675 6e63 5f75 726c 2920 2d3e 206d 6c72  func_url) -> mlr
-0000da50: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-0000da60: 732e 4261 636b 6772 6f75 6e64 5461 736b  s.BackgroundTask
-0000da70: 3a0a 2020 2020 2020 2020 2222 2245 7865  :.        """Exe
-0000da80: 6375 7465 2061 2066 756e 6374 696f 6e20  cute a function 
-0000da90: 7265 6d6f 7465 6c79 2c20 5573 6564 2066  remotely, Used f
-0000daa0: 6f72 2060 6064 6173 6b60 6020 6675 6e63  or ``dask`` func
-0000dab0: 7469 6f6e 732e 0a0a 2020 2020 2020 2020  tions...        
-0000dac0: 3a70 6172 616d 2066 756e 635f 7572 6c3a  :param func_url:
-0000dad0: 2055 524c 2074 6f20 7468 6520 6675 6e63   URL to the func
-0000dae0: 7469 6f6e 2074 6f20 6265 2065 7865 6375  tion to be execu
-0000daf0: 7465 642e 0a20 2020 2020 2020 203a 7265  ted..        :re
-0000db00: 7475 726e 733a 2041 2042 6163 6b67 726f  turns: A Backgro
-0000db10: 756e 6454 6173 6b20 6f62 6a65 6374 2c20  undTask object, 
-0000db20: 7769 7468 2064 6574 6169 6c73 206f 6e20  with details on 
-0000db30: 6578 6563 7574 696f 6e20 7072 6f63 6573  execution proces
-0000db40: 7320 616e 6420 6974 7320 7374 6174 7573  s and its status
-0000db50: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-0000db60: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000db70: 2020 2020 2020 2020 7265 7120 3d20 7b22          req = {"
-0000db80: 6675 6e63 7469 6f6e 5572 6c22 3a20 6675  functionUrl": fu
-0000db90: 6e63 5f75 726c 7d0a 2020 2020 2020 2020  nc_url}.        
-0000dba0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-0000dbb0: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
-0000dbc0: 2020 2020 2020 2020 2020 2250 4f53 5422            "POST"
-0000dbd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000dbe0: 2020 2273 7461 7274 2f66 756e 6374 696f    "start/functio
-0000dbf0: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
-0000dc00: 2020 2020 6a73 6f6e 3d72 6571 2c0a 2020      json=req,.  
-0000dc10: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0000dc20: 6d65 6f75 743d 696e 7428 636f 6e66 6967  meout=int(config
-0000dc30: 2e73 7562 6d69 745f 7469 6d65 6f75 7429  .submit_timeout)
-0000dc40: 206f 7220 3630 2c0a 2020 2020 2020 2020   or 60,.        
-0000dc50: 2020 2020 290a 2020 2020 2020 2020 6578      ).        ex
-0000dc60: 6365 7074 204f 5345 7272 6f72 2061 7320  cept OSError as 
-0000dc70: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
-0000dc80: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
-0000dc90: 6572 726f 7220 7374 6172 7469 6e67 2066  error starting f
-0000dca0: 756e 6374 696f 6e3a 207b 6572 725f 746f  unction: {err_to
-0000dcb0: 5f73 7472 2865 7272 297d 2229 0a20 2020  _str(err)}").   
-0000dcc0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-0000dcd0: 5345 7272 6f72 2866 2265 7272 6f72 3a20  SError(f"error: 
-0000dce0: 6361 6e6e 6f74 2073 7461 7274 2066 756e  cannot start fun
-0000dcf0: 6374 696f 6e2c 207b 6572 725f 746f 5f73  ction, {err_to_s
-0000dd00: 7472 2865 7272 297d 2229 0a0a 2020 2020  tr(err)}")..    
-0000dd10: 2020 2020 6966 206e 6f74 2072 6573 702e      if not resp.
-0000dd20: 6f6b 3a0a 2020 2020 2020 2020 2020 2020  ok:.            
-0000dd30: 6c6f 6767 6572 2e65 7272 6f72 2866 2262  logger.error(f"b
-0000dd40: 6164 2072 6573 7021 215c 6e7b 7265 7370  ad resp!!\n{resp
-0000dd50: 2e74 6578 747d 2229 0a20 2020 2020 2020  .text}").       
-0000dd60: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000dd70: 4572 726f 7228 2262 6164 2066 756e 6374  Error("bad funct
-0000dd80: 696f 6e20 7374 6172 7420 7265 7370 6f6e  ion start respon
-0000dd90: 7365 2229 0a0a 2020 2020 2020 2020 7265  se")..        re
-0000dda0: 7475 726e 206d 6c72 756e 2e63 6f6d 6d6f  turn mlrun.commo
-0000ddb0: 6e2e 7363 6865 6d61 732e 4261 636b 6772  n.schemas.Backgr
-0000ddc0: 6f75 6e64 5461 736b 282a 2a72 6573 702e  oundTask(**resp.
-0000ddd0: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
-0000dde0: 2067 6574 5f70 726f 6a65 6374 5f62 6163   get_project_bac
-0000ddf0: 6b67 726f 756e 645f 7461 736b 280a 2020  kground_task(.  
-0000de00: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0000de10: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
-0000de20: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
-0000de30: 7374 722c 0a20 2020 2029 202d 3e20 6d6c  str,.    ) -> ml
-0000de40: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0000de50: 6173 2e42 6163 6b67 726f 756e 6454 6173  as.BackgroundTas
-0000de60: 6b3a 0a20 2020 2020 2020 2022 2222 5265  k:.        """Re
-0000de70: 7472 6965 7665 2075 7064 6174 6564 2069  trieve updated i
-0000de80: 6e66 6f72 6d61 7469 6f6e 206f 6e20 6120  nformation on a 
-0000de90: 7072 6f6a 6563 7420 6261 636b 6772 6f75  project backgrou
-0000dea0: 6e64 2074 6173 6b20 6265 696e 6720 6578  nd task being ex
-0000deb0: 6563 7574 6564 2e22 2222 0a0a 2020 2020  ecuted."""..    
-0000dec0: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-0000ded0: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
-0000dee0: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
-0000def0: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-0000df00: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-0000df10: 6374 7d2f 6261 636b 6772 6f75 6e64 2d74  ct}/background-t
-0000df20: 6173 6b73 2f7b 6e61 6d65 7d22 0a20 2020  asks/{name}".   
-0000df30: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
-0000df40: 6765 203d 2028 0a20 2020 2020 2020 2020  ge = (.         
-0000df50: 2020 2066 2246 6169 6c65 6420 6765 7474     f"Failed gett
-0000df60: 696e 6720 7072 6f6a 6563 7420 6261 636b  ing project back
-0000df70: 6772 6f75 6e64 2074 6173 6b2e 2070 726f  ground task. pro
-0000df80: 6a65 6374 3d7b 7072 6f6a 6563 747d 2c20  ject={project}, 
-0000df90: 6e61 6d65 3d7b 6e61 6d65 7d22 0a20 2020  name={name}".   
-0000dfa0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0000dfb0: 6573 706f 6e73 6520 3d20 7365 6c66 2e61  esponse = self.a
-0000dfc0: 7069 5f63 616c 6c28 2247 4554 222c 2070  pi_call("GET", p
-0000dfd0: 6174 682c 2065 7272 6f72 5f6d 6573 7361  ath, error_messa
-0000dfe0: 6765 290a 2020 2020 2020 2020 7265 7475  ge).        retu
-0000dff0: 726e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  rn mlrun.common.
-0000e000: 7363 6865 6d61 732e 4261 636b 6772 6f75  schemas.Backgrou
-0000e010: 6e64 5461 736b 282a 2a72 6573 706f 6e73  ndTask(**respons
-0000e020: 652e 6a73 6f6e 2829 290a 0a20 2020 2064  e.json())..    d
-0000e030: 6566 2067 6574 5f62 6163 6b67 726f 756e  ef get_backgroun
-0000e040: 645f 7461 736b 2873 656c 662c 206e 616d  d_task(self, nam
-0000e050: 653a 2073 7472 2920 2d3e 206d 6c72 756e  e: str) -> mlrun
-0000e060: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0000e070: 4261 636b 6772 6f75 6e64 5461 736b 3a0a  BackgroundTask:.
-0000e080: 2020 2020 2020 2020 2222 2252 6574 7269          """Retri
-0000e090: 6576 6520 7570 6461 7465 6420 696e 666f  eve updated info
-0000e0a0: 726d 6174 696f 6e20 6f6e 2061 2062 6163  rmation on a bac
-0000e0b0: 6b67 726f 756e 6420 7461 736b 2062 6569  kground task bei
-0000e0c0: 6e67 2065 7865 6375 7465 642e 2222 220a  ng executed.""".
-0000e0d0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-0000e0e0: 6622 6261 636b 6772 6f75 6e64 2d74 6173  f"background-tas
-0000e0f0: 6b73 2f7b 6e61 6d65 7d22 0a20 2020 2020  ks/{name}".     
-0000e100: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
-0000e110: 203d 2066 2246 6169 6c65 6420 6765 7474   = f"Failed gett
-0000e120: 696e 6720 6261 636b 6772 6f75 6e64 2074  ing background t
-0000e130: 6173 6b2e 206e 616d 653d 7b6e 616d 657d  ask. name={name}
-0000e140: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
-0000e150: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
-0000e160: 6c6c 2822 4745 5422 2c20 7061 7468 2c20  ll("GET", path, 
-0000e170: 6572 726f 725f 6d65 7373 6167 6529 0a20  error_message). 
-0000e180: 2020 2020 2020 2072 6574 7572 6e20 6d6c         return ml
-0000e190: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0000e1a0: 6173 2e42 6163 6b67 726f 756e 6454 6173  as.BackgroundTas
-0000e1b0: 6b28 2a2a 7265 7370 6f6e 7365 2e6a 736f  k(**response.jso
-0000e1c0: 6e28 2929 0a0a 2020 2020 6465 6620 7265  n())..    def re
-0000e1d0: 6d6f 7465 5f73 7461 7475 7328 7365 6c66  mote_status(self
-0000e1e0: 2c20 7072 6f6a 6563 742c 206e 616d 652c  , project, name,
-0000e1f0: 206b 696e 642c 2073 656c 6563 746f 7229   kind, selector)
-0000e200: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-0000e210: 7269 6576 6520 7374 6174 7573 206f 6620  rieve status of 
-0000e220: 6120 6675 6e63 7469 6f6e 2062 6569 6e67  a function being
-0000e230: 2065 7865 6375 7465 6420 7265 6d6f 7465   executed remote
-0000e240: 6c79 2028 7265 6c65 7661 6e74 2074 6f20  ly (relevant to 
-0000e250: 6060 6461 736b 6060 2066 756e 6374 696f  ``dask`` functio
-0000e260: 6e73 292e 0a0a 2020 2020 2020 2020 3a70  ns)...        :p
-0000e270: 6172 616d 2070 726f 6a65 6374 3a20 5468  aram project: Th
-0000e280: 6520 7072 6f6a 6563 7420 6f66 2074 6865  e project of the
-0000e290: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-0000e2a0: 2020 3a70 6172 616d 206e 616d 653a 2054    :param name: T
-0000e2b0: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
-0000e2c0: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
-0000e2d0: 3a70 6172 616d 206b 696e 643a 2054 6865  :param kind: The
-0000e2e0: 206b 696e 6420 6f66 2074 6865 2066 756e   kind of the fun
-0000e2f0: 6374 696f 6e2c 2063 7572 7265 6e74 6c79  ction, currently
-0000e300: 2060 6064 6173 6b60 6020 6973 2073 7570   ``dask`` is sup
-0000e310: 706f 7274 6564 2e0a 2020 2020 2020 2020  ported..        
-0000e320: 3a70 6172 616d 2073 656c 6563 746f 723a  :param selector:
-0000e330: 2053 656c 6563 746f 7220 636c 6175 7365   Selector clause
-0000e340: 2074 6f20 6265 2061 7070 6c69 6564 2074   to be applied t
-0000e350: 6f20 7468 6520 4b75 6265 726e 6574 6573  o the Kubernetes
-0000e360: 2073 7461 7475 7320 7175 6572 7920 746f   status query to
-0000e370: 2066 696c 7465 7220 7468 6520 7265 7375   filter the resu
-0000e380: 6c74 732e 0a20 2020 2020 2020 2022 2222  lts..        """
-0000e390: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-0000e3a0: 2020 2020 2020 2020 2020 2072 6571 203d             req =
-0000e3b0: 207b 226b 696e 6422 3a20 6b69 6e64 2c20   {"kind": kind, 
-0000e3c0: 2273 656c 6563 746f 7222 3a20 7365 6c65  "selector": sele
-0000e3d0: 6374 6f72 2c20 2270 726f 6a65 6374 223a  ctor, "project":
-0000e3e0: 2070 726f 6a65 6374 2c20 226e 616d 6522   project, "name"
-0000e3f0: 3a20 6e61 6d65 7d0a 2020 2020 2020 2020  : name}.        
-0000e400: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-0000e410: 6170 695f 6361 6c6c 2822 504f 5354 222c  api_call("POST",
-0000e420: 2022 7374 6174 7573 2f66 756e 6374 696f   "status/functio
-0000e430: 6e22 2c20 6a73 6f6e 3d72 6571 290a 2020  n", json=req).  
-0000e440: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
-0000e450: 7272 6f72 2061 7320 6572 723a 0a20 2020  rror as err:.   
-0000e460: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000e470: 6572 726f 7228 6622 6572 726f 7220 7374  error(f"error st
-0000e480: 6172 7469 6e67 2066 756e 6374 696f 6e3a  arting function:
-0000e490: 207b 6572 725f 746f 5f73 7472 2865 7272   {err_to_str(err
-0000e4a0: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
-0000e4b0: 2072 6169 7365 204f 5345 7272 6f72 2866   raise OSError(f
-0000e4c0: 2265 7272 6f72 3a20 6361 6e6e 6f74 2073  "error: cannot s
-0000e4d0: 7461 7274 2066 756e 6374 696f 6e2c 207b  tart function, {
-0000e4e0: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
-0000e4f0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
-0000e500: 6f74 2072 6573 702e 6f6b 3a0a 2020 2020  ot resp.ok:.    
-0000e510: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
-0000e520: 7272 6f72 2866 2262 6164 2072 6573 7021  rror(f"bad resp!
-0000e530: 215c 6e7b 7265 7370 2e74 6578 747d 2229  !\n{resp.text}")
-0000e540: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000e550: 7365 2056 616c 7565 4572 726f 7228 2262  se ValueError("b
-0000e560: 6164 2066 756e 6374 696f 6e20 7374 6174  ad function stat
-0000e570: 7573 2072 6573 706f 6e73 6522 290a 0a20  us response").. 
-0000e580: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000e590: 7370 2e6a 736f 6e28 295b 2264 6174 6122  sp.json()["data"
-0000e5a0: 5d0a 0a20 2020 2064 6566 2073 7562 6d69  ]..    def submi
-0000e5b0: 745f 6a6f 6228 0a20 2020 2020 2020 2073  t_job(.        s
-0000e5c0: 656c 662c 0a20 2020 2020 2020 2072 756e  elf,.        run
-0000e5d0: 7370 6563 2c0a 2020 2020 2020 2020 7363  spec,.        sc
-0000e5e0: 6865 6475 6c65 3a20 556e 696f 6e5b 7374  hedule: Union[st
-0000e5f0: 722c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  r, mlrun.common.
-0000e600: 7363 6865 6d61 732e 5363 6865 6475 6c65  schemas.Schedule
-0000e610: 4372 6f6e 5472 6967 6765 725d 203d 204e  CronTrigger] = N
-0000e620: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
-0000e630: 2020 2020 2222 2253 7562 6d69 7420 6120      """Submit a 
-0000e640: 6a6f 6220 666f 7220 7265 6d6f 7465 2065  job for remote e
-0000e650: 7865 6375 7469 6f6e 2e0a 0a20 2020 2020  xecution...     
-0000e660: 2020 203a 7061 7261 6d20 7275 6e73 7065     :param runspe
-0000e670: 633a 2054 6865 2072 756e 7469 6d65 206f  c: The runtime o
-0000e680: 626a 6563 7420 7370 6563 2028 5461 736b  bject spec (Task
-0000e690: 2920 746f 2065 7865 6375 7465 2e0a 2020  ) to execute..  
-0000e6a0: 2020 2020 2020 3a70 6172 616d 2073 6368        :param sch
-0000e6b0: 6564 756c 653a 2057 6865 7468 6572 2074  edule: Whether t
-0000e6c0: 6f20 7363 6865 6475 6c65 2074 6869 7320  o schedule this 
-0000e6d0: 6a6f 6220 7573 696e 6720 6120 4372 6f6e  job using a Cron
-0000e6e0: 2074 7269 6767 6572 2e20 4966 206e 6f74   trigger. If not
-0000e6f0: 2073 7065 6369 6669 6564 2c20 7468 6520   specified, the 
-0000e700: 6a6f 6220 7769 6c6c 2062 6520 7375 626d  job will be subm
-0000e710: 6974 7465 640a 2020 2020 2020 2020 2020  itted.          
-0000e720: 2020 696d 6d65 6469 6174 656c 792e 0a20    immediately.. 
-0000e730: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000e740: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000e750: 2020 2020 2072 6571 203d 207b 2274 6173       req = {"tas
-0000e760: 6b22 3a20 7275 6e73 7065 632e 746f 5f64  k": runspec.to_d
-0000e770: 6963 7428 297d 0a20 2020 2020 2020 2020  ict()}.         
-0000e780: 2020 2069 6620 7363 6865 6475 6c65 3a0a     if schedule:.
-0000e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7a0: 6966 2069 7369 6e73 7461 6e63 6528 7363  if isinstance(sc
-0000e7b0: 6865 6475 6c65 2c20 6d6c 7275 6e2e 636f  hedule, mlrun.co
-0000e7c0: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6368  mmon.schemas.Sch
-0000e7d0: 6564 756c 6543 726f 6e54 7269 6767 6572  eduleCronTrigger
-0000e7e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000e7f0: 2020 2020 2020 2073 6368 6564 756c 6520         schedule 
-0000e800: 3d20 7363 6865 6475 6c65 2e64 6963 7428  = schedule.dict(
-0000e810: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e820: 2020 7265 715b 2273 6368 6564 756c 6522    req["schedule"
-0000e830: 5d20 3d20 7363 6865 6475 6c65 0a20 2020  ] = schedule.   
-0000e840: 2020 2020 2020 2020 2074 696d 656f 7574           timeout
-0000e850: 203d 2028 696e 7428 636f 6e66 6967 2e73   = (int(config.s
-0000e860: 7562 6d69 745f 7469 6d65 6f75 7429 206f  ubmit_timeout) o
-0000e870: 7220 3132 3029 202b 2032 300a 2020 2020  r 120) + 20.    
-0000e880: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
-0000e890: 656c 662e 6170 695f 6361 6c6c 2822 504f  elf.api_call("PO
-0000e8a0: 5354 222c 2022 7375 626d 6974 5f6a 6f62  ST", "submit_job
-0000e8b0: 222c 206a 736f 6e3d 7265 712c 2074 696d  ", json=req, tim
-0000e8c0: 656f 7574 3d74 696d 656f 7574 290a 0a20  eout=timeout).. 
-0000e8d0: 2020 2020 2020 2065 7863 6570 7420 7265         except re
-0000e8e0: 7175 6573 7473 2e48 5454 5045 7272 6f72  quests.HTTPError
-0000e8f0: 2061 7320 6572 723a 0a20 2020 2020 2020   as err:.       
-0000e900: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
-0000e910: 7228 6622 6572 726f 7220 7375 626d 6974  r(f"error submit
-0000e920: 7469 6e67 2074 6173 6b3a 207b 6572 725f  ting task: {err_
-0000e930: 746f 5f73 7472 2865 7272 297d 2229 0a20  to_str(err)}"). 
-0000e940: 2020 2020 2020 2020 2020 2023 206e 6f74             # not
-0000e950: 2063 7265 6174 696e 6720 6120 6e65 7720   creating a new 
-0000e960: 6578 6365 7074 696f 6e20 6865 7265 2c20  exception here, 
-0000e970: 696e 206f 7264 6572 2074 6f20 6b65 6570  in order to keep
-0000e980: 2074 6865 2072 6573 706f 6e73 6520 616e   the response an
-0000e990: 6420 7374 6174 7573 2063 6f64 6520 696e  d status code in
-0000e9a0: 2074 6865 2065 7863 6570 7469 6f6e 0a20   the exception. 
-0000e9b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000e9c0: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0000e9d0: 204f 5345 7272 6f72 2061 7320 6572 723a   OSError as err:
-0000e9e0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0000e9f0: 6765 722e 6572 726f 7228 6622 6572 726f  ger.error(f"erro
-0000ea00: 7220 7375 626d 6974 7469 6e67 2074 6173  r submitting tas
-0000ea10: 6b3a 207b 6572 725f 746f 5f73 7472 2865  k: {err_to_str(e
-0000ea20: 7272 297d 2229 0a20 2020 2020 2020 2020  rr)}").         
-0000ea30: 2020 2072 6169 7365 204f 5345 7272 6f72     raise OSError
-0000ea40: 2822 6572 726f 723a 2063 616e 6e6f 7420  ("error: cannot 
-0000ea50: 7375 626d 6974 2074 6173 6b22 2920 6672  submit task") fr
-0000ea60: 6f6d 2065 7272 0a0a 2020 2020 2020 2020  om err..        
-0000ea70: 6966 206e 6f74 2072 6573 702e 6f6b 3a0a  if not resp.ok:.
-0000ea80: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0000ea90: 6572 2e65 7272 6f72 2866 2262 6164 2072  er.error(f"bad r
-0000eaa0: 6573 7021 215c 6e7b 7265 7370 2e74 6578  esp!!\n{resp.tex
-0000eab0: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
-0000eac0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000ead0: 7228 6622 6261 6420 6675 6e63 7469 6f6e  r(f"bad function
-0000eae0: 2072 756e 2072 6573 706f 6e73 652c 207b   run response, {
-0000eaf0: 7265 7370 2e74 6578 747d 2229 0a0a 2020  resp.text}")..  
-0000eb00: 2020 2020 2020 7265 7370 203d 2072 6573        resp = res
-0000eb10: 702e 6a73 6f6e 2829 0a20 2020 2020 2020  p.json().       
-0000eb20: 2072 6574 7572 6e20 7265 7370 5b22 6461   return resp["da
-0000eb30: 7461 225d 0a0a 2020 2020 6465 6620 7375  ta"]..    def su
-0000eb40: 626d 6974 5f70 6970 656c 696e 6528 0a20  bmit_pipeline(. 
-0000eb50: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000eb60: 2020 2020 2070 726f 6a65 6374 2c0a 2020       project,.  
-0000eb70: 2020 2020 2020 7069 7065 6c69 6e65 2c0a        pipeline,.
-0000eb80: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
-0000eb90: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
-0000eba0: 6578 7065 7269 6d65 6e74 3d4e 6f6e 652c  experiment=None,
-0000ebb0: 0a20 2020 2020 2020 2072 756e 3d4e 6f6e  .        run=Non
-0000ebc0: 652c 0a20 2020 2020 2020 206e 616d 6573  e,.        names
-0000ebd0: 7061 6365 3d4e 6f6e 652c 0a20 2020 2020  pace=None,.     
-0000ebe0: 2020 2061 7274 6966 6163 745f 7061 7468     artifact_path
-0000ebf0: 3d4e 6f6e 652c 0a20 2020 2020 2020 206f  =None,.        o
-0000ec00: 7073 3d4e 6f6e 652c 0a20 2020 2020 2020  ps=None,.       
-0000ec10: 2023 2054 4f44 4f3a 2064 6570 7265 6361   # TODO: depreca
-0000ec20: 7465 642c 2072 656d 6f76 6520 696e 2031  ted, remove in 1
-0000ec30: 2e35 2e30 0a20 2020 2020 2020 2074 746c  .5.0.        ttl
-0000ec40: 3d4e 6f6e 652c 0a20 2020 2020 2020 2063  =None,.        c
-0000ec50: 6c65 616e 7570 5f74 746c 3d4e 6f6e 652c  leanup_ttl=None,
-0000ec60: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0000ec70: 2222 2253 7562 6d69 7420 6120 4b46 5020  """Submit a KFP 
-0000ec80: 7069 7065 6c69 6e65 2066 6f72 2065 7865  pipeline for exe
-0000ec90: 6375 7469 6f6e 2e0a 0a20 2020 2020 2020  cution...       
-0000eca0: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
-0000ecb0: 2054 6865 2070 726f 6a65 6374 206f 6620   The project of 
-0000ecc0: 7468 6520 7069 7065 6c69 6e65 0a20 2020  the pipeline.   
-0000ecd0: 2020 2020 203a 7061 7261 6d20 7069 7065       :param pipe
-0000ece0: 6c69 6e65 3a20 5069 7065 6c69 6e65 2066  line: Pipeline f
-0000ecf0: 756e 6374 696f 6e20 6f72 2070 6174 6820  unction or path 
-0000ed00: 746f 202e 7961 6d6c 2f2e 7a69 7020 7069  to .yaml/.zip pi
-0000ed10: 7065 6c69 6e65 2066 696c 652e 0a20 2020  peline file..   
-0000ed20: 2020 2020 203a 7061 7261 6d20 6172 6775       :param argu
-0000ed30: 6d65 6e74 733a 2041 2064 6963 7469 6f6e  ments: A diction
-0000ed40: 6172 7920 6f66 2061 7267 756d 656e 7473  ary of arguments
-0000ed50: 2074 6f20 7061 7373 2074 6f20 7468 6520   to pass to the 
-0000ed60: 7069 7065 6c69 6e65 2e0a 2020 2020 2020  pipeline..      
-0000ed70: 2020 3a70 6172 616d 2065 7870 6572 696d    :param experim
-0000ed80: 656e 743a 2041 206e 616d 6520 746f 2061  ent: A name to a
-0000ed90: 7373 6967 6e20 666f 7220 7468 6520 7370  ssign for the sp
-0000eda0: 6563 6966 6963 2065 7870 6572 696d 656e  ecific experimen
-0000edb0: 742e 0a20 2020 2020 2020 203a 7061 7261  t..        :para
-0000edc0: 6d20 7275 6e3a 2041 206e 616d 6520 666f  m run: A name fo
-0000edd0: 7220 7468 6973 2073 7065 6369 6669 6320  r this specific 
-0000ede0: 7275 6e2e 0a20 2020 2020 2020 203a 7061  run..        :pa
-0000edf0: 7261 6d20 6e61 6d65 7370 6163 653a 204b  ram namespace: K
-0000ee00: 7562 6572 6e65 7465 7320 6e61 6d65 7370  ubernetes namesp
-0000ee10: 6163 6520 746f 2065 7865 6375 7465 2074  ace to execute t
-0000ee20: 6865 2070 6970 656c 696e 6520 696e 2e0a  he pipeline in..
-0000ee30: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
-0000ee40: 7274 6966 6163 745f 7061 7468 3a20 4120  rtifact_path: A 
-0000ee50: 7061 7468 2074 6f20 6172 7469 6661 6374  path to artifact
-0000ee60: 7320 7573 6564 2062 7920 7468 6973 2070  s used by this p
-0000ee70: 6970 656c 696e 652e 0a20 2020 2020 2020  ipeline..       
-0000ee80: 203a 7061 7261 6d20 6f70 733a 2054 7261   :param ops: Tra
-0000ee90: 6e73 666f 726d 6572 7320 746f 2061 7070  nsformers to app
-0000eea0: 6c79 206f 6e20 616c 6c20 6f70 7320 696e  ly on all ops in
-0000eeb0: 2074 6865 2070 6970 656c 696e 652e 0a20   the pipeline.. 
-0000eec0: 2020 2020 2020 203a 7061 7261 6d20 7474         :param tt
-0000eed0: 6c3a 2070 6970 656c 696e 6520 636c 6561  l: pipeline clea
-0000eee0: 6e75 7020 7474 6c20 696e 2073 6563 7320  nup ttl in secs 
-0000eef0: 2874 696d 6520 746f 2077 6169 7420 6166  (time to wait af
-0000ef00: 7465 7220 776f 726b 666c 6f77 2063 6f6d  ter workflow com
-0000ef10: 706c 6574 696f 6e2c 2061 7420 7768 6963  pletion, at whic
-0000ef20: 6820 706f 696e 7420 7468 6520 776f 726b  h point the work
-0000ef30: 666c 6f77 0a20 2020 2020 2020 2020 2020  flow.           
-0000ef40: 2020 2020 2020 2020 2061 6e64 2061 6c6c           and all
-0000ef50: 2069 7473 2072 6573 6f75 7263 6573 2061   its resources a
-0000ef60: 7265 2064 656c 6574 6564 2920 2864 6570  re deleted) (dep
-0000ef70: 7265 6361 7465 642c 2075 7365 2063 6c65  recated, use cle
-0000ef80: 616e 7570 5f74 746c 2069 6e73 7465 6164  anup_ttl instead
-0000ef90: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
-0000efa0: 2063 6c65 616e 7570 5f74 746c 3a20 7069   cleanup_ttl: pi
-0000efb0: 7065 6c69 6e65 2063 6c65 616e 7570 2074  peline cleanup t
-0000efc0: 746c 2069 6e20 7365 6373 2028 7469 6d65  tl in secs (time
-0000efd0: 2074 6f20 7761 6974 2061 6674 6572 2077   to wait after w
-0000efe0: 6f72 6b66 6c6f 7720 636f 6d70 6c65 7469  orkflow completi
-0000eff0: 6f6e 2c20 6174 2077 6869 6368 2070 6f69  on, at which poi
-0000f000: 6e74 2074 6865 0a20 2020 2020 2020 2020  nt the.         
-0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f020: 2020 2077 6f72 6b66 6c6f 7720 616e 6420     workflow and 
-0000f030: 616c 6c20 6974 7320 7265 736f 7572 6365  all its resource
-0000f040: 7320 6172 6520 6465 6c65 7465 6429 0a20  s are deleted). 
-0000f050: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000f060: 2020 2020 6966 2074 746c 3a0a 2020 2020      if ttl:.    
-0000f070: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-0000f080: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
-0000f090: 2020 2020 2020 2022 2774 746c 2720 6973         "'ttl' is
-0000f0a0: 2064 6570 7265 6361 7465 642c 2075 7365   deprecated, use
-0000f0b0: 2027 636c 6561 6e75 705f 7474 6c27 2069   'cleanup_ttl' i
-0000f0c0: 6e73 7465 6164 2e20 220a 2020 2020 2020  nstead. ".      
-0000f0d0: 2020 2020 2020 2020 2020 2254 6869 7320            "This 
-0000f0e0: 7769 6c6c 2062 6520 7265 6d6f 7665 6420  will be removed 
-0000f0f0: 696e 2031 2e35 2e30 222c 0a20 2020 2020  in 1.5.0",.     
-0000f100: 2020 2020 2020 2020 2020 2023 2054 4f44             # TOD
-0000f110: 4f3a 2052 656d 6f76 6520 7468 6973 2069  O: Remove this i
-0000f120: 6e20 312e 352e 300a 2020 2020 2020 2020  n 1.5.0.        
-0000f130: 2020 2020 2020 2020 4675 7475 7265 5761          FutureWa
-0000f140: 726e 696e 672c 0a20 2020 2020 2020 2020  rning,.         
-0000f150: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
-0000f160: 2069 7369 6e73 7461 6e63 6528 7069 7065   isinstance(pipe
-0000f170: 6c69 6e65 2c20 7374 7229 3a0a 2020 2020  line, str):.    
-0000f180: 2020 2020 2020 2020 7069 7065 5f66 696c          pipe_fil
-0000f190: 6520 3d20 7069 7065 6c69 6e65 0a20 2020  e = pipeline.   
-0000f1a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000f1b0: 2020 2020 2020 2070 6970 655f 6669 6c65         pipe_file
-0000f1c0: 203d 2074 656d 7066 696c 652e 4e61 6d65   = tempfile.Name
-0000f1d0: 6454 656d 706f 7261 7279 4669 6c65 2873  dTemporaryFile(s
-0000f1e0: 7566 6669 783d 222e 7961 6d6c 222c 2064  uffix=".yaml", d
-0000f1f0: 656c 6574 653d 4661 6c73 6529 2e6e 616d  elete=False).nam
-0000f200: 650a 2020 2020 2020 2020 2020 2020 636f  e.            co
-0000f210: 6e66 203d 206e 6577 5f70 6970 655f 6d65  nf = new_pipe_me
-0000f220: 7461 6461 7461 280a 2020 2020 2020 2020  tadata(.        
-0000f230: 2020 2020 2020 2020 6172 7469 6661 6374          artifact
-0000f240: 5f70 6174 683d 6172 7469 6661 6374 5f70  _path=artifact_p
-0000f250: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-0000f260: 2020 2020 2063 6c65 616e 7570 5f74 746c       cleanup_ttl
-0000f270: 3d63 6c65 616e 7570 5f74 746c 206f 7220  =cleanup_ttl or 
-0000f280: 7474 6c2c 0a20 2020 2020 2020 2020 2020  ttl,.           
-0000f290: 2020 2020 206f 705f 7472 616e 7366 6f72       op_transfor
-0000f2a0: 6d65 7273 3d6f 7073 2c0a 2020 2020 2020  mers=ops,.      
-0000f2b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000f2c0: 2020 2020 6b66 702e 636f 6d70 696c 6572      kfp.compiler
-0000f2d0: 2e43 6f6d 7069 6c65 7228 292e 636f 6d70  .Compiler().comp
-0000f2e0: 696c 6528 0a20 2020 2020 2020 2020 2020  ile(.           
-0000f2f0: 2020 2020 2070 6970 656c 696e 652c 2070       pipeline, p
-0000f300: 6970 655f 6669 6c65 2c20 7479 7065 5f63  ipe_file, type_c
-0000f310: 6865 636b 3d46 616c 7365 2c20 7069 7065  heck=False, pipe
-0000f320: 6c69 6e65 5f63 6f6e 663d 636f 6e66 0a20  line_conf=conf. 
-0000f330: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000f340: 2020 2020 2020 6966 2070 6970 655f 6669        if pipe_fi
-0000f350: 6c65 2e65 6e64 7377 6974 6828 222e 7961  le.endswith(".ya
-0000f360: 6d6c 2229 3a0a 2020 2020 2020 2020 2020  ml"):.          
-0000f370: 2020 6865 6164 6572 7320 3d20 7b22 636f    headers = {"co
-0000f380: 6e74 656e 742d 7479 7065 223a 2022 6170  ntent-type": "ap
-0000f390: 706c 6963 6174 696f 6e2f 7961 6d6c 227d  plication/yaml"}
-0000f3a0: 0a20 2020 2020 2020 2065 6c69 6620 7069  .        elif pi
-0000f3b0: 7065 5f66 696c 652e 656e 6473 7769 7468  pe_file.endswith
-0000f3c0: 2822 2e7a 6970 2229 3a0a 2020 2020 2020  (".zip"):.      
-0000f3d0: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
-0000f3e0: 7b22 636f 6e74 656e 742d 7479 7065 223a  {"content-type":
-0000f3f0: 2022 6170 706c 6963 6174 696f 6e2f 7a69   "application/zi
-0000f400: 7022 7d0a 2020 2020 2020 2020 656c 7365  p"}.        else
-0000f410: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000f420: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-0000f430: 7069 7065 6c69 6e65 2066 696c 6520 6d75  pipeline file mu
-0000f440: 7374 2062 6520 2e79 616d 6c20 6f72 202e  st be .yaml or .
-0000f450: 7a69 7022 290a 2020 2020 2020 2020 6966  zip").        if
-0000f460: 2061 7267 756d 656e 7473 3a0a 2020 2020   arguments:.    
-0000f470: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0000f480: 7369 6e73 7461 6e63 6528 6172 6775 6d65  sinstance(argume
-0000f490: 6e74 732c 2064 6963 7429 3a0a 2020 2020  nts, dict):.    
-0000f4a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f4b0: 6520 5661 6c75 6545 7272 6f72 2822 6172  e ValueError("ar
-0000f4c0: 6775 6d65 6e74 7320 6d75 7374 2062 6520  guments must be 
-0000f4d0: 6469 6374 2074 7970 6522 290a 2020 2020  dict type").    
-0000f4e0: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
-0000f4f0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-0000f500: 656d 6173 2e48 6561 6465 724e 616d 6573  emas.HeaderNames
-0000f510: 2e70 6970 656c 696e 655f 6172 6775 6d65  .pipeline_argume
-0000f520: 6e74 735d 203d 2073 7472 280a 2020 2020  nts] = str(.    
-0000f530: 2020 2020 2020 2020 2020 2020 6172 6775              argu
-0000f540: 6d65 6e74 730a 2020 2020 2020 2020 2020  ments.          
-0000f550: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-0000f560: 6e6f 7420 7061 7468 2e69 7366 696c 6528  not path.isfile(
-0000f570: 7069 7065 5f66 696c 6529 3a0a 2020 2020  pipe_file):.    
-0000f580: 2020 2020 2020 2020 7261 6973 6520 4f53          raise OS
-0000f590: 4572 726f 7228 6622 6669 6c65 207b 7069  Error(f"file {pi
-0000f5a0: 7065 5f66 696c 657d 2064 6f65 736e 7420  pe_file} doesnt 
-0000f5b0: 6578 6973 7422 290a 2020 2020 2020 2020  exist").        
-0000f5c0: 7769 7468 206f 7065 6e28 7069 7065 5f66  with open(pipe_f
-0000f5d0: 696c 652c 2022 7262 2229 2061 7320 6670  ile, "rb") as fp
-0000f5e0: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-0000f5f0: 7461 203d 2066 702e 7265 6164 2829 0a20  ta = fp.read(). 
-0000f600: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-0000f610: 696e 7374 616e 6365 2870 6970 656c 696e  instance(pipelin
-0000f620: 652c 2073 7472 293a 0a20 2020 2020 2020  e, str):.       
-0000f630: 2020 2020 2072 656d 6f76 6528 7069 7065       remove(pipe
-0000f640: 5f66 696c 6529 0a0a 2020 2020 2020 2020  _file)..        
-0000f650: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000f660: 2070 6172 616d 7320 3d20 7b22 6e61 6d65   params = {"name
-0000f670: 7370 6163 6522 3a20 6e61 6d65 7370 6163  space": namespac
-0000f680: 652c 2022 6578 7065 7269 6d65 6e74 223a  e, "experiment":
-0000f690: 2065 7870 6572 696d 656e 742c 2022 7275   experiment, "ru
-0000f6a0: 6e22 3a20 7275 6e7d 0a20 2020 2020 2020  n": run}.       
-0000f6b0: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
-0000f6c0: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
-0000f6d0: 2020 2020 2020 2020 2020 2022 504f 5354             "POST
-0000f6e0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000f6f0: 2020 2066 2270 726f 6a65 6374 732f 7b70     f"projects/{p
-0000f700: 726f 6a65 6374 7d2f 7069 7065 6c69 6e65  roject}/pipeline
-0000f710: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
-0000f720: 2020 2020 7061 7261 6d73 3d70 6172 616d      params=param
-0000f730: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0000f740: 2020 2074 696d 656f 7574 3d32 302c 0a20     timeout=20,. 
-0000f750: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000f760: 6f64 793d 6461 7461 2c0a 2020 2020 2020  ody=data,.      
-0000f770: 2020 2020 2020 2020 2020 6865 6164 6572            header
-0000f780: 733d 6865 6164 6572 732c 0a20 2020 2020  s=headers,.     
-0000f790: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000f7a0: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
-0000f7b0: 6173 2065 7272 3a0a 2020 2020 2020 2020  as err:.        
-0000f7c0: 2020 2020 6c6f 6767 6572 2e65 7272 6f72      logger.error
-0000f7d0: 2866 2265 7272 6f72 2063 616e 6e6f 7420  (f"error cannot 
-0000f7e0: 7375 626d 6974 2070 6970 656c 696e 653a  submit pipeline:
-0000f7f0: 207b 6572 725f 746f 5f73 7472 2865 7272   {err_to_str(err
-0000f800: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
-0000f810: 2072 6169 7365 204f 5345 7272 6f72 2866   raise OSError(f
-0000f820: 2265 7272 6f72 3a20 6361 6e6e 6f74 2063  "error: cannot c
-0000f830: 616e 6e6f 7420 7375 626d 6974 2070 6970  annot submit pip
-0000f840: 656c 696e 652c 207b 6572 725f 746f 5f73  eline, {err_to_s
-0000f850: 7472 2865 7272 297d 2229 0a0a 2020 2020  tr(err)}")..    
-0000f860: 2020 2020 6966 206e 6f74 2072 6573 702e      if not resp.
-0000f870: 6f6b 3a0a 2020 2020 2020 2020 2020 2020  ok:.            
-0000f880: 6c6f 6767 6572 2e65 7272 6f72 2866 2262  logger.error(f"b
-0000f890: 6164 2072 6573 7021 215c 6e7b 7265 7370  ad resp!!\n{resp
-0000f8a0: 2e74 6578 747d 2229 0a20 2020 2020 2020  .text}").       
-0000f8b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000f8c0: 4572 726f 7228 6622 6261 6420 7375 626d  Error(f"bad subm
-0000f8d0: 6974 2070 6970 656c 696e 6520 7265 7370  it pipeline resp
-0000f8e0: 6f6e 7365 2c20 7b72 6573 702e 7465 7874  onse, {resp.text
-0000f8f0: 7d22 290a 0a20 2020 2020 2020 2072 6573  }")..        res
-0000f900: 7020 3d20 7265 7370 2e6a 736f 6e28 290a  p = resp.json().
-0000f910: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-0000f920: 6e66 6f28 6622 7375 626d 6974 7465 6420  nfo(f"submitted 
-0000f930: 7069 7065 6c69 6e65 207b 7265 7370 5b27  pipeline {resp['
-0000f940: 6e61 6d65 275d 7d20 6964 3d7b 7265 7370  name']} id={resp
-0000f950: 5b27 6964 275d 7d22 290a 2020 2020 2020  ['id']}").      
-0000f960: 2020 7265 7475 726e 2072 6573 705b 2269    return resp["i
-0000f970: 6422 5d0a 0a20 2020 2064 6566 206c 6973  d"]..    def lis
-0000f980: 745f 7069 7065 6c69 6e65 7328 0a20 2020  t_pipelines(.   
-0000f990: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000f9a0: 2020 2070 726f 6a65 6374 3a20 7374 722c     project: str,
-0000f9b0: 0a20 2020 2020 2020 206e 616d 6573 7061  .        namespa
-0000f9c0: 6365 3a20 7374 7220 3d20 4e6f 6e65 2c0a  ce: str = None,.
-0000f9d0: 2020 2020 2020 2020 736f 7274 5f62 793a          sort_by:
-0000f9e0: 2073 7472 203d 2022 222c 0a20 2020 2020   str = "",.     
-0000f9f0: 2020 2070 6167 655f 746f 6b65 6e3a 2073     page_token: s
-0000fa00: 7472 203d 2022 222c 0a20 2020 2020 2020  tr = "",.       
-0000fa10: 2066 696c 7465 725f 3a20 7374 7220 3d20   filter_: str = 
-0000fa20: 2222 2c0a 2020 2020 2020 2020 666f 726d  "",.        form
-0000fa30: 6174 5f3a 2055 6e69 6f6e 5b0a 2020 2020  at_: Union[.    
-0000fa40: 2020 2020 2020 2020 7374 722c 206d 6c72          str, mlr
-0000fa50: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-0000fa60: 732e 5069 7065 6c69 6e65 7346 6f72 6d61  s.PipelinesForma
-0000fa70: 740a 2020 2020 2020 2020 5d20 3d20 6d6c  t.        ] = ml
-0000fa80: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0000fa90: 6173 2e50 6970 656c 696e 6573 466f 726d  as.PipelinesForm
-0000faa0: 6174 2e6d 6574 6164 6174 615f 6f6e 6c79  at.metadata_only
-0000fab0: 2c0a 2020 2020 2020 2020 7061 6765 5f73  ,.        page_s
-0000fac0: 697a 653a 2069 6e74 203d 204e 6f6e 652c  ize: int = None,
-0000fad0: 0a20 2020 2029 202d 3e20 6d6c 7275 6e2e  .    ) -> mlrun.
-0000fae0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e50  common.schemas.P
-0000faf0: 6970 656c 696e 6573 4f75 7470 7574 3a0a  ipelinesOutput:.
-0000fb00: 2020 2020 2020 2020 2222 2252 6574 7269          """Retri
-0000fb10: 6576 6520 6120 6c69 7374 206f 6620 4b46  eve a list of KF
-0000fb20: 5020 7069 7065 6c69 6e65 732e 2054 6869  P pipelines. Thi
-0000fb30: 7320 6675 6e63 7469 6f6e 2063 616e 2062  s function can b
-0000fb40: 6520 696e 766f 6b65 6420 746f 2067 6574  e invoked to get
-0000fb50: 2061 6c6c 2070 6970 656c 696e 6573 2066   all pipelines f
-0000fb60: 726f 6d20 616c 6c20 7072 6f6a 6563 7473  rom all projects
-0000fb70: 2c0a 2020 2020 2020 2020 6279 2073 7065  ,.        by spe
-0000fb80: 6369 6679 696e 6720 6060 7072 6f6a 6563  cifying ``projec
-0000fb90: 743d 2a60 602c 2069 6e20 7768 6963 6820  t=*``, in which 
-0000fba0: 6361 7365 2070 6167 696e 6174 696f 6e20  case pagination 
-0000fbb0: 6361 6e20 6265 2075 7365 6420 616e 6420  can be used and 
-0000fbc0: 7468 6520 7661 7269 6f75 7320 736f 7274  the various sort
-0000fbd0: 696e 6720 616e 6420 7061 6769 6e61 7469  ing and paginati
-0000fbe0: 6f6e 0a20 2020 2020 2020 2070 726f 7065  on.        prope
-0000fbf0: 7274 6965 7320 6361 6e20 6265 2061 7070  rties can be app
-0000fc00: 6c69 6564 2e20 4966 2061 2073 7065 6369  lied. If a speci
-0000fc10: 6669 6320 7072 6f6a 6563 7420 6973 2072  fic project is r
-0000fc20: 6571 7565 7374 6564 2c20 7468 656e 2074  equested, then t
-0000fc30: 6865 2070 6167 696e 6174 696f 6e20 6f70  he pagination op
-0000fc40: 7469 6f6e 7320 6361 6e6e 6f74 2062 650a  tions cannot be.
-0000fc50: 2020 2020 2020 2020 7573 6564 2061 6e64          used and
-0000fc60: 2070 6167 696e 6174 696f 6e20 6973 206e   pagination is n
-0000fc70: 6f74 2061 7070 6c69 6564 2e0a 0a20 2020  ot applied...   
-0000fc80: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
-0000fc90: 6563 743a 2050 726f 6a65 6374 206e 616d  ect: Project nam
-0000fca0: 652e 2043 616e 2062 6520 6060 2a60 6020  e. Can be ``*`` 
-0000fcb0: 666f 7220 7175 6572 7920 6163 726f 7373  for query across
-0000fcc0: 2061 6c6c 2070 726f 6a65 6374 732e 0a20   all projects.. 
-0000fcd0: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
-0000fce0: 6d65 7370 6163 653a 204b 7562 6572 6e65  mespace: Kuberne
-0000fcf0: 7465 7320 6e61 6d65 7370 6163 6520 696e  tes namespace in
-0000fd00: 2077 6869 6368 2074 6865 2070 6970 656c   which the pipel
-0000fd10: 696e 6573 2061 7265 2065 7865 6375 7469  ines are executi
-0000fd20: 6e67 2e0a 2020 2020 2020 2020 3a70 6172  ng..        :par
-0000fd30: 616d 2073 6f72 745f 6279 3a20 4669 656c  am sort_by: Fiel
-0000fd40: 6420 746f 2073 6f72 7420 7468 6520 7265  d to sort the re
-0000fd50: 7375 6c74 7320 6279 2e0a 2020 2020 2020  sults by..      
-0000fd60: 2020 3a70 6172 616d 2070 6167 655f 746f    :param page_to
-0000fd70: 6b65 6e3a 2055 7365 2066 6f72 2070 6167  ken: Use for pag
-0000fd80: 696e 6174 696f 6e2c 2074 6f20 7265 7472  ination, to retr
-0000fd90: 6965 7665 206e 6578 7420 7061 6765 2e0a  ieve next page..
-0000fda0: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-0000fdb0: 696c 7465 725f 3a20 4b75 6265 726e 6574  ilter_: Kubernet
-0000fdc0: 6573 2066 696c 7465 7220 746f 2061 7070  es filter to app
-0000fdd0: 6c79 2074 6f20 7468 6520 7175 6572 792c  ly to the query,
-0000fde0: 2063 616e 2062 6520 7573 6564 2074 6f20   can be used to 
-0000fdf0: 6669 6c74 6572 206f 6e20 7370 6563 6966  filter on specif
-0000fe00: 6963 206f 626a 6563 7420 6669 656c 6473  ic object fields
-0000fe10: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0000fe20: 2066 6f72 6d61 745f 3a20 5265 7375 6c74   format_: Result
-0000fe30: 2066 6f72 6d61 742e 2043 616e 2062 6520   format. Can be 
-0000fe40: 6f6e 6520 6f66 3a0a 0a20 2020 2020 2020  one of:..       
-0000fe50: 2020 2020 202d 2060 6066 756c 6c60 6020       - ``full`` 
-0000fe60: 2d20 7265 7475 726e 2074 6865 2066 756c  - return the ful
-0000fe70: 6c20 6f62 6a65 6374 732e 0a20 2020 2020  l objects..     
-0000fe80: 2020 2020 2020 202d 2060 606d 6574 6164         - ``metad
-0000fe90: 6174 615f 6f6e 6c79 6060 2028 6465 6661  ata_only`` (defa
-0000fea0: 756c 7429 202d 2072 6574 7572 6e20 6a75  ult) - return ju
-0000feb0: 7374 206d 6574 6164 6174 6120 6f66 2074  st metadata of t
-0000fec0: 6865 2070 6970 656c 696e 6573 206f 626a  he pipelines obj
-0000fed0: 6563 7473 2e0a 2020 2020 2020 2020 2020  ects..          
-0000fee0: 2020 2d20 6060 6e61 6d65 5f6f 6e6c 7960    - ``name_only`
-0000fef0: 6020 2d20 7265 7475 726e 206a 7573 7420  ` - return just 
-0000ff00: 7468 6520 6e61 6d65 7320 6f66 2074 6865  the names of the
-0000ff10: 2070 6970 656c 696e 6520 6f62 6a65 6374   pipeline object
-0000ff20: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-0000ff30: 6d20 7061 6765 5f73 697a 653a 2053 697a  m page_size: Siz
-0000ff40: 6520 6f66 2061 2073 696e 676c 6520 7061  e of a single pa
-0000ff50: 6765 2077 6865 6e20 6170 706c 7969 6e67  ge when applying
-0000ff60: 2070 6167 696e 6174 696f 6e2e 0a20 2020   pagination..   
-0000ff70: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0000ff80: 2020 6966 2070 726f 6a65 6374 2021 3d20    if project != 
-0000ff90: 222a 2220 616e 6420 2870 6167 655f 746f  "*" and (page_to
-0000ffa0: 6b65 6e20 6f72 2070 6167 655f 7369 7a65  ken or page_size
-0000ffb0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000ffc0: 6169 7365 206d 6c72 756e 2e65 7272 6f72  aise mlrun.error
-0000ffd0: 732e 4d4c 5275 6e49 6e76 616c 6964 4172  s.MLRunInvalidAr
-0000ffe0: 6775 6d65 6e74 4572 726f 7228 0a20 2020  gumentError(.   
-0000fff0: 2020 2020 2020 2020 2020 2020 2022 4669               "Fi
-00010000: 6c74 6572 696e 6720 6279 2070 726f 6a65  ltering by proje
-00010010: 6374 2063 616e 206e 6f74 2062 6520 7573  ct can not be us
-00010020: 6564 2074 6f67 6574 6865 7220 7769 7468  ed together with
-00010030: 2070 6167 696e 6174 696f 6e22 0a20 2020   pagination".   
-00010040: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00010050: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
-00010060: 2020 2020 2020 2020 2020 226e 616d 6573            "names
-00010070: 7061 6365 223a 206e 616d 6573 7061 6365  pace": namespace
-00010080: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00010090: 6f72 745f 6279 223a 2073 6f72 745f 6279  ort_by": sort_by
-000100a0: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
-000100b0: 6167 655f 746f 6b65 6e22 3a20 7061 6765  age_token": page
-000100c0: 5f74 6f6b 656e 2c0a 2020 2020 2020 2020  _token,.        
-000100d0: 2020 2020 2266 696c 7465 7222 3a20 6669      "filter": fi
-000100e0: 6c74 6572 5f2c 0a20 2020 2020 2020 2020  lter_,.         
-000100f0: 2020 2022 666f 726d 6174 223a 2066 6f72     "format": for
-00010100: 6d61 745f 2c0a 2020 2020 2020 2020 2020  mat_,.          
-00010110: 2020 2270 6167 655f 7369 7a65 223a 2070    "page_size": p
-00010120: 6167 655f 7369 7a65 2c0a 2020 2020 2020  age_size,.      
-00010130: 2020 7d0a 0a20 2020 2020 2020 2065 7272    }..        err
-00010140: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-00010150: 6169 6c65 6420 6c69 7374 696e 6720 7069  ailed listing pi
-00010160: 7065 6c69 6e65 732c 2071 7565 7279 3a20  pelines, query: 
-00010170: 7b70 6172 616d 737d 220a 2020 2020 2020  {params}".      
-00010180: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
-00010190: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-000101a0: 2020 2020 2020 2020 2247 4554 222c 2066          "GET", f
-000101b0: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-000101c0: 6374 7d2f 7069 7065 6c69 6e65 7322 2c20  ct}/pipelines", 
-000101d0: 6572 726f 725f 6d65 7373 6167 652c 2070  error_message, p
-000101e0: 6172 616d 733d 7061 7261 6d73 0a20 2020  arams=params.   
-000101f0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-00010200: 6574 7572 6e20 6d6c 7275 6e2e 636f 6d6d  eturn mlrun.comm
-00010210: 6f6e 2e73 6368 656d 6173 2e50 6970 656c  on.schemas.Pipel
-00010220: 696e 6573 4f75 7470 7574 282a 2a72 6573  inesOutput(**res
-00010230: 706f 6e73 652e 6a73 6f6e 2829 290a 0a20  ponse.json()).. 
-00010240: 2020 2064 6566 2067 6574 5f70 6970 656c     def get_pipel
-00010250: 696e 6528 0a20 2020 2020 2020 2073 656c  ine(.        sel
-00010260: 662c 0a20 2020 2020 2020 2072 756e 5f69  f,.        run_i
-00010270: 643a 2073 7472 2c0a 2020 2020 2020 2020  d: str,.        
-00010280: 6e61 6d65 7370 6163 653a 2073 7472 203d  namespace: str =
-00010290: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
-000102a0: 696d 656f 7574 3a20 696e 7420 3d20 3130  imeout: int = 10
-000102b0: 2c0a 2020 2020 2020 2020 666f 726d 6174  ,.        format
-000102c0: 5f3a 2055 6e69 6f6e 5b0a 2020 2020 2020  _: Union[.      
-000102d0: 2020 2020 2020 7374 722c 206d 6c72 756e        str, mlrun
-000102e0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-000102f0: 5069 7065 6c69 6e65 7346 6f72 6d61 740a  PipelinesFormat.
-00010300: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
-00010310: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00010320: 2e50 6970 656c 696e 6573 466f 726d 6174  .PipelinesFormat
-00010330: 2e73 756d 6d61 7279 2c0a 2020 2020 2020  .summary,.      
-00010340: 2020 7072 6f6a 6563 743a 2073 7472 203d    project: str =
-00010350: 204e 6f6e 652c 0a20 2020 2029 3a0a 2020   None,.    ):.  
-00010360: 2020 2020 2020 2222 2252 6574 7269 6576        """Retriev
-00010370: 6520 6465 7461 696c 7320 6f66 2061 2073  e details of a s
-00010380: 7065 6369 6669 6320 7069 7065 6c69 6e65  pecific pipeline
-00010390: 2075 7369 6e67 2069 7473 2072 756e 2049   using its run I
-000103a0: 4420 2861 7320 7072 6f76 6964 6564 2077  D (as provided w
-000103b0: 6865 6e20 7468 6520 7069 7065 6c69 6e65  hen the pipeline
-000103c0: 2077 6173 2065 7865 6375 7465 6429 2e22   was executed)."
-000103d0: 2222 0a0a 2020 2020 2020 2020 7061 7261  ""..        para
-000103e0: 6d73 203d 207b 7d0a 2020 2020 2020 2020  ms = {}.        
-000103f0: 6966 206e 616d 6573 7061 6365 3a0a 2020  if namespace:.  
-00010400: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-00010410: 5b22 6e61 6d65 7370 6163 6522 5d20 3d20  ["namespace"] = 
-00010420: 6e61 6d65 7370 6163 650a 2020 2020 2020  namespace.      
-00010430: 2020 7061 7261 6d73 5b22 666f 726d 6174    params["format
-00010440: 225d 203d 2066 6f72 6d61 745f 0a20 2020  "] = format_.   
-00010450: 2020 2020 2070 726f 6a65 6374 5f70 6174       project_pat
-00010460: 6820 3d20 7072 6f6a 6563 7420 6966 2070  h = project if p
-00010470: 726f 6a65 6374 2065 6c73 6520 222a 220a  roject else "*".
-00010480: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
-00010490: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
-000104a0: 2020 2020 2020 2020 2020 2247 4554 222c            "GET",
-000104b0: 0a20 2020 2020 2020 2020 2020 2066 2270  .            f"p
-000104c0: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
-000104d0: 5f70 6174 687d 2f70 6970 656c 696e 6573  _path}/pipelines
-000104e0: 2f7b 7275 6e5f 6964 7d22 2c0a 2020 2020  /{run_id}",.    
-000104f0: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
-00010500: 6172 616d 732c 0a20 2020 2020 2020 2020  arams,.         
-00010510: 2020 2074 696d 656f 7574 3d74 696d 656f     timeout=timeo
-00010520: 7574 2c0a 2020 2020 2020 2020 290a 0a20  ut,.        ).. 
-00010530: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
-00010540: 7370 2e6f 6b3a 0a20 2020 2020 2020 2020  sp.ok:.         
-00010550: 2020 206c 6f67 6765 722e 6572 726f 7228     logger.error(
-00010560: 6622 6261 6420 7265 7370 2121 5c6e 7b72  f"bad resp!!\n{r
-00010570: 6573 702e 7465 7874 7d22 290a 2020 2020  esp.text}").    
-00010580: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00010590: 6c75 6545 7272 6f72 2866 2262 6164 2067  lueError(f"bad g
-000105a0: 6574 2070 6970 656c 696e 6520 7265 7370  et pipeline resp
-000105b0: 6f6e 7365 2c20 7b72 6573 702e 7465 7874  onse, {resp.text
-000105c0: 7d22 290a 0a20 2020 2020 2020 2072 6574  }")..        ret
-000105d0: 7572 6e20 7265 7370 2e6a 736f 6e28 290a  urn resp.json().
-000105e0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-000105f0: 6f64 0a20 2020 2064 6566 205f 7265 736f  od.    def _reso
-00010600: 6c76 655f 7265 6665 7265 6e63 6528 7461  lve_reference(ta
-00010610: 672c 2075 6964 293a 0a20 2020 2020 2020  g, uid):.       
-00010620: 2069 6620 7569 6420 616e 6420 7461 673a   if uid and tag:
-00010630: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00010640: 7365 204d 4c52 756e 496e 7661 6c69 6441  se MLRunInvalidA
-00010650: 7267 756d 656e 7445 7272 6f72 2822 626f  rgumentError("bo
-00010660: 7468 2075 6964 2061 6e64 2074 6167 2077  th uid and tag w
-00010670: 6572 6520 7072 6f76 6964 6564 2229 0a20  ere provided"). 
-00010680: 2020 2020 2020 2072 6574 7572 6e20 7569         return ui
-00010690: 6420 6f72 2074 6167 206f 7220 226c 6174  d or tag or "lat
-000106a0: 6573 7422 0a0a 2020 2020 6465 6620 6372  est"..    def cr
-000106b0: 6561 7465 5f66 6561 7475 7265 5f73 6574  eate_feature_set
-000106c0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-000106d0: 2020 2020 2020 2020 6665 6174 7572 655f          feature_
-000106e0: 7365 743a 2055 6e69 6f6e 5b64 6963 742c  set: Union[dict,
-000106f0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-00010700: 6865 6d61 732e 4665 6174 7572 6553 6574  hemas.FeatureSet
-00010710: 2c20 4665 6174 7572 6553 6574 5d2c 0a20  , FeatureSet],. 
-00010720: 2020 2020 2020 2070 726f 6a65 6374 3d22         project="
-00010730: 222c 0a20 2020 2020 2020 2076 6572 7369  ",.        versi
-00010740: 6f6e 6564 3d54 7275 652c 0a20 2020 2029  oned=True,.    )
-00010750: 202d 3e20 6469 6374 3a0a 2020 2020 2020   -> dict:.      
-00010760: 2020 2222 2243 7265 6174 6520 6120 6e65    """Create a ne
-00010770: 7720 3a70 793a 636c 6173 733a 607e 6d6c  w :py:class:`~ml
-00010780: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
-00010790: 652e 4665 6174 7572 6553 6574 6020 616e  e.FeatureSet` an
-000107a0: 6420 7361 7665 2069 6e20 7468 6520 3a70  d save in the :p
-000107b0: 793a 6d6f 643a 606d 6c72 756e 6020 4442  y:mod:`mlrun` DB
-000107c0: 2e20 5468 650a 2020 2020 2020 2020 6665  . The.        fe
-000107d0: 6174 7572 652d 7365 7420 6d75 7374 206e  ature-set must n
-000107e0: 6f74 2070 7265 7669 6f75 736c 7920 6578  ot previously ex
-000107f0: 6973 7420 696e 2074 6865 2044 422e 0a0a  ist in the DB...
-00010800: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-00010810: 6561 7475 7265 5f73 6574 3a20 5468 6520  eature_set: The 
-00010820: 6e65 7720 3a70 793a 636c 6173 733a 607e  new :py:class:`~
-00010830: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
-00010840: 6f72 652e 4665 6174 7572 6553 6574 6020  ore.FeatureSet` 
-00010850: 746f 2063 7265 6174 652e 0a20 2020 2020  to create..     
-00010860: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00010870: 743a 204e 616d 6520 6f66 2070 726f 6a65  t: Name of proje
-00010880: 6374 2074 6869 7320 6665 6174 7572 652d  ct this feature-
-00010890: 7365 7420 6265 6c6f 6e67 7320 746f 2e0a  set belongs to..
-000108a0: 2020 2020 2020 2020 3a70 6172 616d 2076          :param v
-000108b0: 6572 7369 6f6e 6564 3a20 5768 6574 6865  ersioned: Whethe
-000108c0: 7220 746f 206d 6169 6e74 6169 6e20 7665  r to maintain ve
-000108d0: 7273 696f 6e73 2066 6f72 2074 6869 7320  rsions for this 
-000108e0: 6665 6174 7572 652d 7365 742e 2041 6c6c  feature-set. All
-000108f0: 2076 6572 7369 6f6e 7320 6f66 2061 2076   versions of a v
-00010900: 6572 7369 6f6e 6564 206f 626a 6563 740a  ersioned object.
-00010910: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
-00010920: 2062 6520 6b65 7074 2069 6e20 7468 6520   be kept in the 
-00010930: 4442 2061 6e64 2063 616e 2062 6520 7265  DB and can be re
-00010940: 7472 6965 7665 6420 756e 7469 6c20 6578  trieved until ex
-00010950: 706c 6963 6974 6c79 2064 656c 6574 6564  plicitly deleted
-00010960: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-00010970: 6e73 3a20 5468 6520 3a70 793a 636c 6173  ns: The :py:clas
-00010980: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
-00010990: 655f 7374 6f72 652e 4665 6174 7572 6553  e_store.FeatureS
-000109a0: 6574 6020 6f62 6a65 6374 2028 6173 2064  et` object (as d
-000109b0: 6963 7429 2e0a 2020 2020 2020 2020 2222  ict)..        ""
-000109c0: 220a 2020 2020 2020 2020 6966 2069 7369  ".        if isi
-000109d0: 6e73 7461 6e63 6528 6665 6174 7572 655f  nstance(feature_
-000109e0: 7365 742c 206d 6c72 756e 2e63 6f6d 6d6f  set, mlrun.commo
-000109f0: 6e2e 7363 6865 6d61 732e 4665 6174 7572  n.schemas.Featur
-00010a00: 6553 6574 293a 0a20 2020 2020 2020 2020  eSet):.         
-00010a10: 2020 2066 6561 7475 7265 5f73 6574 203d     feature_set =
-00010a20: 2066 6561 7475 7265 5f73 6574 2e64 6963   feature_set.dic
-00010a30: 7428 290a 2020 2020 2020 2020 656c 6966  t().        elif
-00010a40: 2069 7369 6e73 7461 6e63 6528 6665 6174   isinstance(feat
-00010a50: 7572 655f 7365 742c 2046 6561 7475 7265  ure_set, Feature
-00010a60: 5365 7429 3a0a 2020 2020 2020 2020 2020  Set):.          
-00010a70: 2020 6665 6174 7572 655f 7365 7420 3d20    feature_set = 
-00010a80: 6665 6174 7572 655f 7365 742e 746f 5f64  feature_set.to_d
-00010a90: 6963 7428 290a 0a20 2020 2020 2020 2070  ict()..        p
-00010aa0: 726f 6a65 6374 203d 2028 0a20 2020 2020  roject = (.     
-00010ab0: 2020 2020 2020 2070 726f 6a65 6374 0a20         project. 
-00010ac0: 2020 2020 2020 2020 2020 206f 7220 6665             or fe
-00010ad0: 6174 7572 655f 7365 745b 226d 6574 6164  ature_set["metad
-00010ae0: 6174 6122 5d2e 6765 7428 2270 726f 6a65  ata"].get("proje
-00010af0: 6374 222c 204e 6f6e 6529 0a20 2020 2020  ct", None).     
-00010b00: 2020 2020 2020 206f 7220 636f 6e66 6967         or config
-00010b10: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
-00010b20: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00010b30: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
-00010b40: 6563 7473 2f7b 7072 6f6a 6563 747d 2f66  ects/{project}/f
-00010b50: 6561 7475 7265 2d73 6574 7322 0a20 2020  eature-sets".   
-00010b60: 2020 2020 2070 6172 616d 7320 3d20 7b22       params = {"
-00010b70: 7665 7273 696f 6e65 6422 3a20 7665 7273  versioned": vers
-00010b80: 696f 6e65 647d 0a0a 2020 2020 2020 2020  ioned}..        
-00010b90: 6e61 6d65 203d 2066 6561 7475 7265 5f73  name = feature_s
-00010ba0: 6574 5b22 6d65 7461 6461 7461 225d 5b22  et["metadata"]["
-00010bb0: 6e61 6d65 225d 0a20 2020 2020 2020 2065  name"].        e
-00010bc0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
-00010bd0: 2246 6169 6c65 6420 6372 6561 7469 6e67  "Failed creating
-00010be0: 2066 6561 7475 7265 2d73 6574 207b 7072   feature-set {pr
-00010bf0: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
-00010c00: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-00010c10: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-00010c20: 2020 2020 2020 2020 2022 504f 5354 222c           "POST",
-00010c30: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00010c40: 682c 0a20 2020 2020 2020 2020 2020 2065  h,.            e
-00010c50: 7272 6f72 5f6d 6573 7361 6765 2c0a 2020  rror_message,.  
-00010c60: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-00010c70: 3d70 6172 616d 732c 0a20 2020 2020 2020  =params,.       
-00010c80: 2020 2020 2062 6f64 793d 6469 6374 5f74       body=dict_t
-00010c90: 6f5f 6a73 6f6e 2866 6561 7475 7265 5f73  o_json(feature_s
-00010ca0: 6574 292c 0a20 2020 2020 2020 2029 0a20  et),.        ). 
-00010cb0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00010cc0: 7370 2e6a 736f 6e28 290a 0a20 2020 2064  sp.json()..    d
-00010cd0: 6566 2067 6574 5f66 6561 7475 7265 5f73  ef get_feature_s
-00010ce0: 6574 280a 2020 2020 2020 2020 7365 6c66  et(.        self
-00010cf0: 2c20 6e61 6d65 3a20 7374 722c 2070 726f  , name: str, pro
-00010d00: 6a65 6374 3a20 7374 7220 3d20 2222 2c20  ject: str = "", 
-00010d10: 7461 673a 2073 7472 203d 204e 6f6e 652c  tag: str = None,
-00010d20: 2075 6964 3a20 7374 7220 3d20 4e6f 6e65   uid: str = None
-00010d30: 0a20 2020 2029 202d 3e20 4665 6174 7572  .    ) -> Featur
-00010d40: 6553 6574 3a0a 2020 2020 2020 2020 2222  eSet:.        ""
-00010d50: 2252 6574 7269 6576 6520 6120 7e6d 6c72  "Retrieve a ~mlr
-00010d60: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
-00010d70: 2e46 6561 7475 7265 5365 7460 206f 626a  .FeatureSet` obj
-00010d80: 6563 742e 2049 6620 626f 7468 2060 6074  ect. If both ``t
-00010d90: 6167 6060 2061 6e64 2060 6075 6964 6060  ag`` and ``uid``
-00010da0: 2061 7265 206e 6f74 2073 7065 6369 6669   are not specifi
-00010db0: 6564 2c20 7468 656e 0a20 2020 2020 2020  ed, then.       
-00010dc0: 2074 6865 206f 626a 6563 7420 7461 6767   the object tagg
-00010dd0: 6564 2060 606c 6174 6573 7460 6020 7769  ed ``latest`` wi
-00010de0: 6c6c 2062 6520 7265 7472 6965 7665 642e  ll be retrieved.
-00010df0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00010e00: 206e 616d 653a 204e 616d 6520 6f66 206f   name: Name of o
-00010e10: 626a 6563 7420 746f 2072 6574 7269 6576  bject to retriev
-00010e20: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-00010e30: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
-00010e40: 6374 2074 6865 2046 6561 7475 7265 5365  ct the FeatureSe
-00010e50: 7420 6265 6c6f 6e67 7320 746f 2e0a 2020  t belongs to..  
-00010e60: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
-00010e70: 3a20 5461 6720 6f66 2074 6865 2073 7065  : Tag of the spe
-00010e80: 6369 6669 6320 6f62 6a65 6374 2076 6572  cific object ver
-00010e90: 7369 6f6e 2074 6f20 7265 7472 6965 7665  sion to retrieve
-00010ea0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00010eb0: 2075 6964 3a20 7569 6420 6f66 2074 6865   uid: uid of the
-00010ec0: 206f 626a 6563 7420 746f 2072 6574 7269   object to retri
-00010ed0: 6576 6520 2863 616e 206f 6e6c 7920 6265  eve (can only be
-00010ee0: 2075 7365 6420 666f 7220 7665 7273 696f   used for versio
-00010ef0: 6e65 6420 6f62 6a65 6374 7329 2e0a 2020  ned objects)..  
-00010f00: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00010f10: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
-00010f20: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
-00010f30: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
-00010f40: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00010f50: 203d 2073 656c 662e 5f72 6573 6f6c 7665   = self._resolve
-00010f60: 5f72 6566 6572 656e 6365 2874 6167 2c20  _reference(tag, 
-00010f70: 7569 6429 0a20 2020 2020 2020 2070 6174  uid).        pat
-00010f80: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-00010f90: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
-00010fa0: 2d73 6574 732f 7b6e 616d 657d 2f72 6566  -sets/{name}/ref
-00010fb0: 6572 656e 6365 732f 7b72 6566 6572 656e  erences/{referen
-00010fc0: 6365 7d22 0a20 2020 2020 2020 2065 7272  ce}".        err
-00010fd0: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-00010fe0: 6169 6c65 6420 7265 7472 6965 7669 6e67  ailed retrieving
-00010ff0: 2066 6561 7475 7265 2d73 6574 207b 7072   feature-set {pr
-00011000: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
-00011010: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-00011020: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
-00011030: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
-00011040: 6573 7361 6765 290a 2020 2020 2020 2020  essage).        
-00011050: 7265 7475 726e 2046 6561 7475 7265 5365  return FeatureSe
-00011060: 742e 6672 6f6d 5f64 6963 7428 7265 7370  t.from_dict(resp
-00011070: 2e6a 736f 6e28 2929 0a0a 2020 2020 6465  .json())..    de
-00011080: 6620 6c69 7374 5f66 6561 7475 7265 7328  f list_features(
-00011090: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-000110a0: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
-000110b0: 7374 722c 0a20 2020 2020 2020 206e 616d  str,.        nam
-000110c0: 653a 2073 7472 203d 204e 6f6e 652c 0a20  e: str = None,. 
-000110d0: 2020 2020 2020 2074 6167 3a20 7374 7220         tag: str 
-000110e0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000110f0: 656e 7469 7469 6573 3a20 4c69 7374 5b73  entities: List[s
-00011100: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-00011110: 2020 2020 6c61 6265 6c73 3a20 4c69 7374      labels: List
-00011120: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
-00011130: 2020 2920 2d3e 204c 6973 745b 6469 6374    ) -> List[dict
-00011140: 5d3a 0a20 2020 2020 2020 2022 2222 4c69  ]:.        """Li
-00011150: 7374 2066 6561 7475 7265 2d73 6574 7320  st feature-sets 
-00011160: 7768 6963 6820 636f 6e74 6169 6e20 7370  which contain sp
-00011170: 6563 6966 6963 2066 6561 7475 7265 732e  ecific features.
-00011180: 2054 6869 7320 6675 6e63 7469 6f6e 206d   This function m
-00011190: 6179 2072 6574 7572 6e20 6d75 6c74 6970  ay return multip
-000111a0: 6c65 2076 6572 7369 6f6e 7320 6f66 2074  le versions of t
-000111b0: 6865 2073 616d 650a 2020 2020 2020 2020  he same.        
-000111c0: 6665 6174 7572 652d 7365 7420 6966 2061  feature-set if a
-000111d0: 2073 7065 6369 6669 6320 7461 6720 6973   specific tag is
-000111e0: 206e 6f74 2072 6571 7565 7374 6564 2e20   not requested. 
-000111f0: 4e6f 7465 2074 6861 7420 7468 6520 7661  Note that the va
-00011200: 7269 6f75 7320 6669 6c74 6572 7320 6f66  rious filters of
-00011210: 2074 6869 7320 6675 6e63 7469 6f6e 2061   this function a
-00011220: 6374 7561 6c6c 790a 2020 2020 2020 2020  ctually.        
-00011230: 7265 6665 7220 746f 2074 6865 2066 6561  refer to the fea
-00011240: 7475 7265 2d73 6574 206f 626a 6563 7420  ture-set object 
-00011250: 636f 6e74 6169 6e69 6e67 2074 6865 2066  containing the f
-00011260: 6561 7475 7265 732c 206e 6f74 2074 6f20  eatures, not to 
-00011270: 7468 6520 6665 6174 7572 6573 2074 6865  the features the
-00011280: 6d73 656c 7665 732e 0a0a 2020 2020 2020  mselves...      
-00011290: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
-000112a0: 3a20 5072 6f6a 6563 7420 7768 6963 6820  : Project which 
-000112b0: 636f 6e74 6169 6e73 2074 6865 7365 2066  contains these f
-000112c0: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
-000112d0: 203a 7061 7261 6d20 6e61 6d65 3a20 4e61   :param name: Na
-000112e0: 6d65 206f 6620 7468 6520 6665 6174 7572  me of the featur
-000112f0: 6520 746f 206c 6f6f 6b20 666f 722e 2054  e to look for. T
-00011300: 6865 206e 616d 6520 6973 2075 7365 6420  he name is used 
-00011310: 696e 2061 206c 696b 6520 7175 6572 792c  in a like query,
-00011320: 2061 6e64 2069 7320 6e6f 7420 6361 7365   and is not case
-00011330: 2d73 656e 7369 7469 7665 2e20 466f 720a  -sensitive. For.
-00011340: 2020 2020 2020 2020 2020 2020 6578 616d              exam
-00011350: 706c 652c 206c 6f6f 6b69 6e67 2066 6f72  ple, looking for
-00011360: 2060 6066 6561 7460 6020 7769 6c6c 2072   ``feat`` will r
-00011370: 6574 7572 6e20 6665 6174 7572 6573 2077  eturn features w
-00011380: 6869 6368 2061 7265 206e 616d 6564 2060  hich are named `
-00011390: 604d 7946 6561 7475 7265 6060 2061 7320  `MyFeature`` as 
-000113a0: 7765 6c6c 2061 7320 6060 6465 6665 6174  well as ``defeat
-000113b0: 6060 2e0a 2020 2020 2020 2020 3a70 6172  ``..        :par
-000113c0: 616d 2074 6167 3a20 5265 7475 726e 2066  am tag: Return f
-000113d0: 6561 7475 7265 2d73 6574 7320 7768 6963  eature-sets whic
-000113e0: 6820 636f 6e74 6169 6e20 7468 6520 6665  h contain the fe
-000113f0: 6174 7572 6573 206c 6f6f 6b65 6420 666f  atures looked fo
-00011400: 722c 2061 6e64 2061 7265 2074 6167 6765  r, and are tagge
-00011410: 6420 7769 7468 2074 6865 2073 7065 6369  d with the speci
-00011420: 6669 6320 7461 672e 0a20 2020 2020 2020  fic tag..       
-00011430: 203a 7061 7261 6d20 656e 7469 7469 6573   :param entities
-00011440: 3a20 5265 7475 726e 206f 6e6c 7920 6665  : Return only fe
-00011450: 6174 7572 652d 7365 7473 2077 6869 6368  ature-sets which
-00011460: 2063 6f6e 7461 696e 2061 6e20 656e 7469   contain an enti
-00011470: 7479 2077 686f 7365 206e 616d 6520 6973  ty whose name is
-00011480: 2063 6f6e 7461 696e 6564 2069 6e20 7468   contained in th
-00011490: 6973 206c 6973 742e 0a20 2020 2020 2020  is list..       
-000114a0: 203a 7061 7261 6d20 6c61 6265 6c73 3a20   :param labels: 
-000114b0: 5265 7475 726e 206f 6e6c 7920 6665 6174  Return only feat
-000114c0: 7572 652d 7365 7473 2077 6869 6368 2061  ure-sets which a
-000114d0: 7265 206c 6162 656c 6564 2061 7320 7265  re labeled as re
-000114e0: 7175 6573 7465 642e 0a20 2020 2020 2020  quested..       
-000114f0: 203a 7265 7475 726e 733a 2041 206c 6973   :returns: A lis
-00011500: 7420 6f66 206d 6170 7069 6e67 2066 726f  t of mapping fro
-00011510: 6d20 6665 6174 7572 6520 746f 2061 2064  m feature to a d
-00011520: 6967 6573 7420 6f66 2074 6865 2066 6561  igest of the fea
-00011530: 7475 7265 2d73 6574 2c20 7768 6963 6820  ture-set, which 
-00011540: 636f 6e74 6169 6e73 2074 6865 2066 6561  contains the fea
-00011550: 7475 7265 2d73 6574 0a20 2020 2020 2020  ture-set.       
-00011560: 2020 2020 206d 6574 612d 6461 7461 2e20       meta-data. 
-00011570: 4d75 6c74 6970 6c65 2065 6e74 7269 6573  Multiple entries
-00011580: 206d 6179 2062 6520 7265 7475 726e 6564   may be returned
-00011590: 2066 6f72 2061 6e79 2073 7065 6369 6669   for any specifi
-000115a0: 6320 6665 6174 7572 6520 6475 6520 746f  c feature due to
-000115b0: 206d 756c 7469 706c 6520 7461 6773 206f   multiple tags o
-000115c0: 7220 7665 7273 696f 6e73 0a20 2020 2020  r versions.     
-000115d0: 2020 2020 2020 206f 6620 7468 6520 6665         of the fe
-000115e0: 6174 7572 652d 7365 742e 0a20 2020 2020  ature-set..     
-000115f0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00011600: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
-00011610: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
-00011620: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
-00011630: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
-00011640: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
-00011650: 223a 206e 616d 652c 0a20 2020 2020 2020  ": name,.       
-00011660: 2020 2020 2022 7461 6722 3a20 7461 672c       "tag": tag,
-00011670: 0a20 2020 2020 2020 2020 2020 2022 656e  .            "en
-00011680: 7469 7479 223a 2065 6e74 6974 6965 7320  tity": entities 
-00011690: 6f72 205b 5d2c 0a20 2020 2020 2020 2020  or [],.         
-000116a0: 2020 2022 6c61 6265 6c22 3a20 6c61 6265     "label": labe
-000116b0: 6c73 206f 7220 5b5d 2c0a 2020 2020 2020  ls or [],.      
-000116c0: 2020 7d0a 0a20 2020 2020 2020 2070 6174    }..        pat
-000116d0: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-000116e0: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
-000116f0: 7322 0a0a 2020 2020 2020 2020 6572 726f  s"..        erro
-00011700: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
-00011710: 696c 6564 206c 6973 7469 6e67 2066 6561  iled listing fea
-00011720: 7475 7265 732c 2070 726f 6a65 6374 3a20  tures, project: 
-00011730: 7b70 726f 6a65 6374 7d2c 2071 7565 7279  {project}, query
-00011740: 3a20 7b70 6172 616d 737d 220a 2020 2020  : {params}".    
-00011750: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-00011760: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
-00011770: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
-00011780: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
-00011790: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
-000117a0: 726e 2072 6573 702e 6a73 6f6e 2829 5b22  rn resp.json()["
-000117b0: 6665 6174 7572 6573 225d 0a0a 2020 2020  features"]..    
-000117c0: 6465 6620 6c69 7374 5f65 6e74 6974 6965  def list_entitie
-000117d0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-000117e0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-000117f0: 3a20 7374 722c 0a20 2020 2020 2020 206e  : str,.        n
-00011800: 616d 653a 2073 7472 203d 204e 6f6e 652c  ame: str = None,
-00011810: 0a20 2020 2020 2020 2074 6167 3a20 7374  .        tag: st
-00011820: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
-00011830: 2020 6c61 6265 6c73 3a20 4c69 7374 5b73    labels: List[s
-00011840: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-00011850: 2920 2d3e 204c 6973 745b 6469 6374 5d3a  ) -> List[dict]:
-00011860: 0a20 2020 2020 2020 2022 2222 5265 7472  .        """Retr
-00011870: 6965 7665 2061 206c 6973 7420 6f66 2065  ieve a list of e
-00011880: 6e74 6974 6965 7320 616e 6420 7468 6569  ntities and thei
-00011890: 7220 6d61 7070 696e 6720 746f 2074 6865  r mapping to the
-000118a0: 2063 6f6e 7461 696e 696e 6720 6665 6174   containing feat
-000118b0: 7572 652d 7365 7473 2e20 5468 6973 2066  ure-sets. This f
-000118c0: 756e 6374 696f 6e20 6973 2073 696d 696c  unction is simil
-000118d0: 6172 0a20 2020 2020 2020 2074 6f20 7468  ar.        to th
-000118e0: 6520 3a70 793a 6675 6e63 3a60 7e6c 6973  e :py:func:`~lis
-000118f0: 745f 6665 6174 7572 6573 6020 6675 6e63  t_features` func
-00011900: 7469 6f6e 2c20 616e 6420 7573 6573 2074  tion, and uses t
-00011910: 6865 2073 616d 6520 6c6f 6769 632e 2048  he same logic. H
-00011920: 6f77 6576 6572 2c20 7468 6520 656e 7469  owever, the enti
-00011930: 7469 6573 2061 7265 206d 6174 6368 6564  ties are matched
-00011940: 0a20 2020 2020 2020 2061 6761 696e 7374  .        against
-00011950: 2074 6865 206e 616d 6520 7261 7468 6572   the name rather
-00011960: 2074 6861 6e20 7468 6520 6665 6174 7572   than the featur
-00011970: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
-00011980: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00011990: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-000119a0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-000119b0: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
-000119c0: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
-000119d0: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
-000119e0: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
-000119f0: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
-00011a00: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
-00011a10: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
-00011a20: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00011a30: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
-00011a40: 732f 7b70 726f 6a65 6374 7d2f 656e 7469  s/{project}/enti
-00011a50: 7469 6573 220a 0a20 2020 2020 2020 2065  ties"..        e
-00011a60: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
-00011a70: 2246 6169 6c65 6420 6c69 7374 696e 6720  "Failed listing 
-00011a80: 656e 7469 7469 6573 2c20 7072 6f6a 6563  entities, projec
-00011a90: 743a 207b 7072 6f6a 6563 747d 2c20 7175  t: {project}, qu
-00011aa0: 6572 793a 207b 7061 7261 6d73 7d22 0a20  ery: {params}". 
-00011ab0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-00011ac0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
-00011ad0: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
-00011ae0: 6573 7361 6765 2c20 7061 7261 6d73 3d70  essage, params=p
-00011af0: 6172 616d 7329 0a20 2020 2020 2020 2072  arams).        r
-00011b00: 6574 7572 6e20 7265 7370 2e6a 736f 6e28  eturn resp.json(
-00011b10: 295b 2265 6e74 6974 6965 7322 5d0a 0a20  )["entities"].. 
-00011b20: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-00011b30: 0a20 2020 2064 6566 205f 6765 6e65 7261  .    def _genera
-00011b40: 7465 5f70 6172 7469 7469 6f6e 5f62 795f  te_partition_by_
-00011b50: 7061 7261 6d73 280a 2020 2020 2020 2020  params(.        
-00011b60: 7061 7274 6974 696f 6e5f 6279 5f63 6c73  partition_by_cls
-00011b70: 2c0a 2020 2020 2020 2020 7061 7274 6974  ,.        partit
-00011b80: 696f 6e5f 6279 2c0a 2020 2020 2020 2020  ion_by,.        
-00011b90: 726f 7773 5f70 6572 5f70 6172 7469 7469  rows_per_partiti
-00011ba0: 6f6e 2c0a 2020 2020 2020 2020 736f 7274  on,.        sort
-00011bb0: 5f62 792c 0a20 2020 2020 2020 206f 7264  _by,.        ord
-00011bc0: 6572 2c0a 2020 2020 2020 2020 6d61 785f  er,.        max_
-00011bd0: 7061 7274 6974 696f 6e73 3d4e 6f6e 652c  partitions=None,
-00011be0: 0a20 2020 2029 3a0a 0a20 2020 2020 2020  .    ):..       
-00011bf0: 2070 6172 7469 7469 6f6e 5f70 6172 616d   partition_param
-00011c00: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-00011c10: 2020 2270 6172 7469 7469 6f6e 2d62 7922    "partition-by"
-00011c20: 3a20 7061 7274 6974 696f 6e5f 6279 2c0a  : partition_by,.
-00011c30: 2020 2020 2020 2020 2020 2020 2272 6f77              "row
-00011c40: 732d 7065 722d 7061 7274 6974 696f 6e22  s-per-partition"
-00011c50: 3a20 726f 7773 5f70 6572 5f70 6172 7469  : rows_per_parti
-00011c60: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00011c70: 2020 2270 6172 7469 7469 6f6e 2d73 6f72    "partition-sor
-00011c80: 742d 6279 223a 2073 6f72 745f 6279 2c0a  t-by": sort_by,.
-00011c90: 2020 2020 2020 2020 2020 2020 2270 6172              "par
-00011ca0: 7469 7469 6f6e 2d6f 7264 6572 223a 206f  tition-order": o
-00011cb0: 7264 6572 2c0a 2020 2020 2020 2020 7d0a  rder,.        }.
-00011cc0: 2020 2020 2020 2020 6966 206d 6178 5f70          if max_p
-00011cd0: 6172 7469 7469 6f6e 7320 6973 206e 6f74  artitions is not
-00011ce0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00011cf0: 2020 2070 6172 7469 7469 6f6e 5f70 6172     partition_par
-00011d00: 616d 735b 226d 6178 2d70 6172 7469 7469  ams["max-partiti
-00011d10: 6f6e 7322 5d20 3d20 6d61 785f 7061 7274  ons"] = max_part
-00011d20: 6974 696f 6e73 0a20 2020 2020 2020 2072  itions.        r
-00011d30: 6574 7572 6e20 7061 7274 6974 696f 6e5f  eturn partition_
-00011d40: 7061 7261 6d73 0a0a 2020 2020 6465 6620  params..    def 
-00011d50: 6c69 7374 5f66 6561 7475 7265 5f73 6574  list_feature_set
-00011d60: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-00011d70: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00011d80: 3a20 7374 7220 3d20 2222 2c0a 2020 2020  : str = "",.    
-00011d90: 2020 2020 6e61 6d65 3a20 7374 7220 3d20      name: str = 
-00011da0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7461  None,.        ta
-00011db0: 673a 2073 7472 203d 204e 6f6e 652c 0a20  g: str = None,. 
-00011dc0: 2020 2020 2020 2073 7461 7465 3a20 7374         state: st
-00011dd0: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
-00011de0: 2020 656e 7469 7469 6573 3a20 4c69 7374    entities: List
-00011df0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
-00011e00: 2020 2020 2020 6665 6174 7572 6573 3a20        features: 
-00011e10: 4c69 7374 5b73 7472 5d20 3d20 4e6f 6e65  List[str] = None
-00011e20: 2c0a 2020 2020 2020 2020 6c61 6265 6c73  ,.        labels
-00011e30: 3a20 4c69 7374 5b73 7472 5d20 3d20 4e6f  : List[str] = No
-00011e40: 6e65 2c0a 2020 2020 2020 2020 7061 7274  ne,.        part
-00011e50: 6974 696f 6e5f 6279 3a20 556e 696f 6e5b  ition_by: Union[
-00011e60: 0a20 2020 2020 2020 2020 2020 206d 6c72  .            mlr
-00011e70: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-00011e80: 732e 4665 6174 7572 6553 746f 7265 5061  s.FeatureStorePa
-00011e90: 7274 6974 696f 6e42 7946 6965 6c64 2c20  rtitionByField, 
-00011ea0: 7374 720a 2020 2020 2020 2020 5d20 3d20  str.        ] = 
-00011eb0: 4e6f 6e65 2c0a 2020 2020 2020 2020 726f  None,.        ro
-00011ec0: 7773 5f70 6572 5f70 6172 7469 7469 6f6e  ws_per_partition
-00011ed0: 3a20 696e 7420 3d20 312c 0a20 2020 2020  : int = 1,.     
-00011ee0: 2020 2070 6172 7469 7469 6f6e 5f73 6f72     partition_sor
-00011ef0: 745f 6279 3a20 556e 696f 6e5b 6d6c 7275  t_by: Union[mlru
-00011f00: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00011f10: 2e53 6f72 7446 6965 6c64 2c20 7374 725d  .SortField, str]
-00011f20: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00011f30: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-00011f40: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
-00011f50: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
-00011f60: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
-00011f70: 7970 652c 2073 7472 0a20 2020 2020 2020  ype, str.       
-00011f80: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
-00011f90: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
-00011fa0: 7970 652e 6465 7363 2c0a 2020 2020 2920  ype.desc,.    ) 
-00011fb0: 2d3e 204c 6973 745b 4665 6174 7572 6553  -> List[FeatureS
-00011fc0: 6574 5d3a 0a20 2020 2020 2020 2022 2222  et]:.        """
-00011fd0: 5265 7472 6965 7665 2061 206c 6973 7420  Retrieve a list 
-00011fe0: 6f66 2066 6561 7475 7265 2d73 6574 7320  of feature-sets 
-00011ff0: 6d61 7463 6869 6e67 2074 6865 2063 7269  matching the cri
-00012000: 7465 7269 6120 7072 6f76 6964 6564 2e0a  teria provided..
-00012010: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00012020: 7072 6f6a 6563 743a 2050 726f 6a65 6374  project: Project
-00012030: 206e 616d 652e 0a20 2020 2020 2020 203a   name..        :
-00012040: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
-00012050: 206f 6620 6665 6174 7572 652d 7365 7420   of feature-set 
-00012060: 746f 206d 6174 6368 2e20 5468 6973 2069  to match. This i
-00012070: 7320 6120 6c69 6b65 2071 7565 7279 2c20  s a like query, 
-00012080: 616e 6420 6973 2063 6173 652d 696e 7365  and is case-inse
-00012090: 6e73 6974 6976 652e 0a20 2020 2020 2020  nsitive..       
-000120a0: 203a 7061 7261 6d20 7461 673a 204d 6174   :param tag: Mat
-000120b0: 6368 2066 6561 7475 7265 2d73 6574 7320  ch feature-sets 
-000120c0: 7769 7468 2073 7065 6369 6669 6320 7461  with specific ta
-000120d0: 672e 0a20 2020 2020 2020 203a 7061 7261  g..        :para
-000120e0: 6d20 7374 6174 653a 204d 6174 6368 2066  m state: Match f
-000120f0: 6561 7475 7265 2d73 6574 7320 7769 7468  eature-sets with
-00012100: 2061 2073 7065 6369 6669 6320 7374 6174   a specific stat
-00012110: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-00012120: 6d20 656e 7469 7469 6573 3a20 4d61 7463  m entities: Matc
-00012130: 6820 6665 6174 7572 652d 7365 7473 2077  h feature-sets w
-00012140: 6869 6368 2063 6f6e 7461 696e 2065 6e74  hich contain ent
-00012150: 6974 6965 7320 7768 6f73 6520 6e61 6d65  ities whose name
-00012160: 2069 7320 696e 2074 6869 7320 6c69 7374   is in this list
-00012170: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00012180: 2066 6561 7475 7265 733a 204d 6174 6368   features: Match
-00012190: 2066 6561 7475 7265 2d73 6574 7320 7768   feature-sets wh
-000121a0: 6963 6820 636f 6e74 6169 6e20 6665 6174  ich contain feat
-000121b0: 7572 6573 2077 686f 7365 206e 616d 6520  ures whose name 
-000121c0: 6973 2069 6e20 7468 6973 206c 6973 742e  is in this list.
-000121d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000121e0: 6c61 6265 6c73 3a20 4d61 7463 6820 6665  labels: Match fe
-000121f0: 6174 7572 652d 7365 7473 2077 6869 6368  ature-sets which
-00012200: 2068 6176 6520 7468 6573 6520 6c61 6265   have these labe
-00012210: 6c73 2e0a 2020 2020 2020 2020 3a70 6172  ls..        :par
-00012220: 616d 2070 6172 7469 7469 6f6e 5f62 793a  am partition_by:
-00012230: 2046 6965 6c64 2074 6f20 6772 6f75 7020   Field to group 
-00012240: 7265 7375 6c74 7320 6279 2e20 4f6e 6c79  results by. Only
-00012250: 2061 6c6c 6f77 6564 2076 616c 7565 2069   allowed value i
-00012260: 7320 606e 616d 6560 2e20 5768 656e 2060  s `name`. When `
-00012270: 7061 7274 6974 696f 6e5f 6279 6020 6973  partition_by` is
-00012280: 2073 7065 6369 6669 6564 2c0a 2020 2020   specified,.    
-00012290: 2020 2020 2020 2020 7468 6520 6070 6172          the `par
-000122a0: 7469 7469 6f6e 5f73 6f72 745f 6279 6020  tition_sort_by` 
-000122b0: 7061 7261 6d65 7465 7220 6d75 7374 2062  parameter must b
-000122c0: 6520 7072 6f76 6964 6564 2061 7320 7765  e provided as we
-000122d0: 6c6c 2e0a 2020 2020 2020 2020 3a70 6172  ll..        :par
-000122e0: 616d 2072 6f77 735f 7065 725f 7061 7274  am rows_per_part
-000122f0: 6974 696f 6e3a 2048 6f77 206d 616e 7920  ition: How many 
-00012300: 746f 7020 726f 7773 2028 7065 7220 736f  top rows (per so
-00012310: 7274 696e 6720 6465 6669 6e65 6420 6279  rting defined by
-00012320: 2060 7061 7274 6974 696f 6e5f 736f 7274   `partition_sort
-00012330: 5f62 7960 2061 6e64 2060 7061 7274 6974  _by` and `partit
-00012340: 696f 6e5f 6f72 6465 7260 290a 2020 2020  ion_order`).    
-00012350: 2020 2020 2020 2020 746f 2072 6574 7572          to retur
-00012360: 6e20 7065 7220 6772 6f75 702e 2044 6566  n per group. Def
-00012370: 6175 6c74 2076 616c 7565 2069 7320 312e  ault value is 1.
-00012380: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00012390: 7061 7274 6974 696f 6e5f 736f 7274 5f62  partition_sort_b
-000123a0: 793a 2057 6861 7420 6669 656c 6420 746f  y: What field to
-000123b0: 2073 6f72 7420 7468 6520 7265 7375 6c74   sort the result
-000123c0: 7320 6279 2c20 7769 7468 696e 2065 6163  s by, within eac
-000123d0: 6820 7061 7274 6974 696f 6e20 6465 6669  h partition defi
-000123e0: 6e65 6420 6279 2060 7061 7274 6974 696f  ned by `partitio
-000123f0: 6e5f 6279 602e 0a20 2020 2020 2020 2020  n_by`..         
-00012400: 2020 2043 7572 7265 6e74 6c79 2074 6865     Currently the
-00012410: 206f 6e6c 7920 616c 6c6f 7765 6420 7661   only allowed va
-00012420: 6c75 6520 6172 6520 6063 7265 6174 6564  lue are `created
-00012430: 6020 616e 6420 6075 7064 6174 6564 602e  ` and `updated`.
-00012440: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00012450: 7061 7274 6974 696f 6e5f 6f72 6465 723a  partition_order:
-00012460: 204f 7264 6572 206f 6620 736f 7274 696e   Order of sortin
-00012470: 6720 7769 7468 696e 2070 6172 7469 7469  g within partiti
-00012480: 6f6e 7320 2d20 6061 7363 6020 6f72 2060  ons - `asc` or `
-00012490: 6465 7363 602e 2044 6566 6175 6c74 2069  desc`. Default i
-000124a0: 7320 6064 6573 6360 2e0a 2020 2020 2020  s `desc`..      
-000124b0: 2020 3a72 6574 7572 6e73 3a20 4c69 7374    :returns: List
-000124c0: 206f 6620 6d61 7463 6869 6e67 203a 7079   of matching :py
-000124d0: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
-000124e0: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
-000124f0: 7475 7265 5365 7460 206f 626a 6563 7473  tureSet` objects
-00012500: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00012510: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
-00012520: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
-00012530: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
-00012540: 6374 0a0a 2020 2020 2020 2020 7061 7261  ct..        para
-00012550: 6d73 203d 207b 0a20 2020 2020 2020 2020  ms = {.         
-00012560: 2020 2022 6e61 6d65 223a 206e 616d 652c     "name": name,
-00012570: 0a20 2020 2020 2020 2020 2020 2022 7374  .            "st
-00012580: 6174 6522 3a20 7374 6174 652c 0a20 2020  ate": state,.   
-00012590: 2020 2020 2020 2020 2022 7461 6722 3a20           "tag": 
-000125a0: 7461 672c 0a20 2020 2020 2020 2020 2020  tag,.           
-000125b0: 2022 656e 7469 7479 223a 2065 6e74 6974   "entity": entit
-000125c0: 6965 7320 6f72 205b 5d2c 0a20 2020 2020  ies or [],.     
-000125d0: 2020 2020 2020 2022 6665 6174 7572 6522         "feature"
-000125e0: 3a20 6665 6174 7572 6573 206f 7220 5b5d  : features or []
-000125f0: 2c0a 2020 2020 2020 2020 2020 2020 226c  ,.            "l
-00012600: 6162 656c 223a 206c 6162 656c 7320 6f72  abel": labels or
-00012610: 205b 5d2c 0a20 2020 2020 2020 207d 0a20   [],.        }. 
-00012620: 2020 2020 2020 2069 6620 7061 7274 6974         if partit
-00012630: 696f 6e5f 6279 3a0a 2020 2020 2020 2020  ion_by:.        
-00012640: 2020 2020 7061 7261 6d73 2e75 7064 6174      params.updat
-00012650: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00012660: 2020 2073 656c 662e 5f67 656e 6572 6174     self._generat
-00012670: 655f 7061 7274 6974 696f 6e5f 6279 5f70  e_partition_by_p
-00012680: 6172 616d 7328 0a20 2020 2020 2020 2020  arams(.         
-00012690: 2020 2020 2020 2020 2020 206d 6c72 756e             mlrun
-000126a0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-000126b0: 4665 6174 7572 6553 746f 7265 5061 7274  FeatureStorePart
-000126c0: 6974 696f 6e42 7946 6965 6c64 2c0a 2020  itionByField,.  
-000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126e0: 2020 7061 7274 6974 696f 6e5f 6279 2c0a    partition_by,.
-000126f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012700: 2020 2020 726f 7773 5f70 6572 5f70 6172      rows_per_par
-00012710: 7469 7469 6f6e 2c0a 2020 2020 2020 2020  tition,.        
-00012720: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00012730: 6974 696f 6e5f 736f 7274 5f62 792c 0a20  ition_sort_by,. 
-00012740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012750: 2020 2070 6172 7469 7469 6f6e 5f6f 7264     partition_ord
-00012760: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00012770: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00012780: 2020 290a 0a20 2020 2020 2020 2070 6174    )..        pat
-00012790: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-000127a0: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
-000127b0: 2d73 6574 7322 0a0a 2020 2020 2020 2020  -sets"..        
-000127c0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-000127d0: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
-000127e0: 4661 696c 6564 206c 6973 7469 6e67 2066  Failed listing f
-000127f0: 6561 7475 7265 2d73 6574 732c 2070 726f  eature-sets, pro
-00012800: 6a65 6374 3a20 7b70 726f 6a65 6374 7d2c  ject: {project},
-00012810: 2071 7565 7279 3a20 7b70 6172 616d 737d   query: {params}
-00012820: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00012830: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-00012840: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
-00012850: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
-00012860: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
-00012870: 6d73 290a 2020 2020 2020 2020 6665 6174  ms).        feat
-00012880: 7572 655f 7365 7473 203d 2072 6573 702e  ure_sets = resp.
-00012890: 6a73 6f6e 2829 5b22 6665 6174 7572 655f  json()["feature_
-000128a0: 7365 7473 225d 0a20 2020 2020 2020 2069  sets"].        i
-000128b0: 6620 6665 6174 7572 655f 7365 7473 3a0a  f feature_sets:.
-000128c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000128d0: 726e 205b 4665 6174 7572 6553 6574 2e66  rn [FeatureSet.f
-000128e0: 726f 6d5f 6469 6374 286f 626a 2920 666f  rom_dict(obj) fo
-000128f0: 7220 6f62 6a20 696e 2066 6561 7475 7265  r obj in feature
-00012900: 5f73 6574 735d 0a0a 2020 2020 6465 6620  _sets]..    def 
-00012910: 7374 6f72 655f 6665 6174 7572 655f 7365  store_feature_se
-00012920: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
-00012930: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-00012940: 5f73 6574 3a20 556e 696f 6e5b 6469 6374  _set: Union[dict
-00012950: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
-00012960: 6368 656d 6173 2e46 6561 7475 7265 5365  chemas.FeatureSe
-00012970: 742c 2046 6561 7475 7265 5365 745d 2c0a  t, FeatureSet],.
-00012980: 2020 2020 2020 2020 6e61 6d65 3d4e 6f6e          name=Non
-00012990: 652c 0a20 2020 2020 2020 2070 726f 6a65  e,.        proje
-000129a0: 6374 3d22 222c 0a20 2020 2020 2020 2074  ct="",.        t
-000129b0: 6167 3d4e 6f6e 652c 0a20 2020 2020 2020  ag=None,.       
-000129c0: 2075 6964 3d4e 6f6e 652c 0a20 2020 2020   uid=None,.     
-000129d0: 2020 2076 6572 7369 6f6e 6564 3d54 7275     versioned=Tru
-000129e0: 652c 0a20 2020 2029 202d 3e20 6469 6374  e,.    ) -> dict
-000129f0: 3a0a 2020 2020 2020 2020 2222 2253 6176  :.        """Sav
-00012a00: 6520 6120 3a70 793a 636c 6173 733a 607e  e a :py:class:`~
-00012a10: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
-00012a20: 6f72 652e 4665 6174 7572 6553 6574 6020  ore.FeatureSet` 
-00012a30: 6f62 6a65 6374 2069 6e20 7468 6520 3a70  object in the :p
-00012a40: 793a 6d6f 643a 606d 6c72 756e 6020 4442  y:mod:`mlrun` DB
-00012a50: 2e20 5468 650a 2020 2020 2020 2020 6665  . The.        fe
-00012a60: 6174 7572 652d 7365 7420 6361 6e20 6265  ature-set can be
-00012a70: 2065 6974 6865 7220 6120 6e65 7720 6f62   either a new ob
-00012a80: 6a65 6374 206f 7220 6120 6d6f 6469 6669  ject or a modifi
-00012a90: 6361 7469 6f6e 2074 6f20 6578 6973 7469  cation to existi
-00012aa0: 6e67 206f 626a 6563 7420 7265 6665 7265  ng object refere
-00012ab0: 6e63 6564 2062 7920 7468 6520 7061 7261  nced by the para
-00012ac0: 6d73 206f 660a 2020 2020 2020 2020 7468  ms of.        th
-00012ad0: 6520 6675 6e63 7469 6f6e 2e0a 0a20 2020  e function...   
-00012ae0: 2020 2020 203a 7061 7261 6d20 6665 6174       :param feat
-00012af0: 7572 655f 7365 743a 2054 6865 203a 7079  ure_set: The :py
-00012b00: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
-00012b10: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
-00012b20: 7475 7265 5365 7460 2074 6f20 7374 6f72  tureSet` to stor
-00012b30: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-00012b40: 6d20 6e61 6d65 3a20 2020 204e 616d 6520  m name:    Name 
-00012b50: 6f66 2066 6561 7475 7265 2073 6574 2e0a  of feature set..
-00012b60: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00012b70: 726f 6a65 6374 3a20 4e61 6d65 206f 6620  roject: Name of 
-00012b80: 7072 6f6a 6563 7420 7468 6973 2066 6561  project this fea
-00012b90: 7475 7265 2d73 6574 2062 656c 6f6e 6773  ture-set belongs
-00012ba0: 2074 6f2e 0a20 2020 2020 2020 203a 7061   to..        :pa
-00012bb0: 7261 6d20 7461 673a 2054 6865 2060 6074  ram tag: The ``t
-00012bc0: 6167 6060 206f 6620 7468 6520 6f62 6a65  ag`` of the obje
-00012bd0: 6374 2074 6f20 7265 706c 6163 6520 696e  ct to replace in
-00012be0: 2074 6865 2044 422c 2066 6f72 2065 7861   the DB, for exa
-00012bf0: 6d70 6c65 2060 606c 6174 6573 7460 602e  mple ``latest``.
-00012c00: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00012c10: 7569 643a 2054 6865 2060 6075 6964 6060  uid: The ``uid``
-00012c20: 206f 6620 7468 6520 6f62 6a65 6374 2074   of the object t
-00012c30: 6f20 7265 706c 6163 6520 696e 2074 6865  o replace in the
-00012c40: 2044 422e 2049 6620 7573 696e 6720 7468   DB. If using th
-00012c50: 6973 2070 6172 616d 6574 6572 2c20 7468  is parameter, th
-00012c60: 6520 6d6f 6469 6669 6564 206f 626a 6563  e modified objec
-00012c70: 740a 2020 2020 2020 2020 2020 2020 6d75  t.            mu
-00012c80: 7374 2068 6176 6520 7468 6520 7361 6d65  st have the same
-00012c90: 2060 6075 6964 6060 206f 6620 7468 6520   ``uid`` of the 
-00012ca0: 7072 6576 696f 7573 6c79 2d65 7869 7374  previously-exist
-00012cb0: 696e 6720 6f62 6a65 6374 2e20 5468 6973  ing object. This
-00012cc0: 2063 616e 6e6f 7420 6265 2075 7365 6420   cannot be used 
-00012cd0: 666f 7220 6e6f 6e2d 7665 7273 696f 6e65  for non-versione
-00012ce0: 6420 6f62 6a65 6374 732e 0a20 2020 2020  d objects..     
-00012cf0: 2020 203a 7061 7261 6d20 7665 7273 696f     :param versio
-00012d00: 6e65 643a 2057 6865 7468 6572 2074 6f20  ned: Whether to 
-00012d10: 6d61 696e 7461 696e 2076 6572 7369 6f6e  maintain version
-00012d20: 7320 666f 7220 7468 6973 2066 6561 7475  s for this featu
-00012d30: 7265 2d73 6574 2e20 416c 6c20 7665 7273  re-set. All vers
-00012d40: 696f 6e73 206f 6620 6120 7665 7273 696f  ions of a versio
-00012d50: 6e65 6420 6f62 6a65 6374 0a20 2020 2020  ned object.     
-00012d60: 2020 2020 2020 2077 696c 6c20 6265 206b         will be k
-00012d70: 6570 7420 696e 2074 6865 2044 4220 616e  ept in the DB an
-00012d80: 6420 6361 6e20 6265 2072 6574 7269 6576  d can be retriev
-00012d90: 6564 2075 6e74 696c 2065 7870 6c69 6369  ed until explici
-00012da0: 746c 7920 6465 6c65 7465 642e 0a20 2020  tly deleted..   
-00012db0: 2020 2020 203a 7265 7475 726e 733a 2054       :returns: T
-00012dc0: 6865 203a 7079 3a63 6c61 7373 3a60 7e6d  he :py:class:`~m
-00012dd0: 6c72 756e 2e66 6561 7475 7265 5f73 746f  lrun.feature_sto
-00012de0: 7265 2e46 6561 7475 7265 5365 7460 206f  re.FeatureSet` o
-00012df0: 626a 6563 7420 2861 7320 6469 6374 292e  bject (as dict).
-00012e00: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00012e10: 2020 2020 2020 7265 6665 7265 6e63 6520        reference 
-00012e20: 3d20 7365 6c66 2e5f 7265 736f 6c76 655f  = self._resolve_
-00012e30: 7265 6665 7265 6e63 6528 7461 672c 2075  reference(tag, u
-00012e40: 6964 290a 2020 2020 2020 2020 7061 7261  id).        para
-00012e50: 6d73 203d 207b 2276 6572 7369 6f6e 6564  ms = {"versioned
-00012e60: 223a 2076 6572 7369 6f6e 6564 7d0a 0a20  ": versioned}.. 
-00012e70: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00012e80: 616e 6365 2866 6561 7475 7265 5f73 6574  ance(feature_set
-00012e90: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
-00012ea0: 6368 656d 6173 2e46 6561 7475 7265 5365  chemas.FeatureSe
-00012eb0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00012ec0: 6665 6174 7572 655f 7365 7420 3d20 6665  feature_set = fe
-00012ed0: 6174 7572 655f 7365 742e 6469 6374 2829  ature_set.dict()
-00012ee0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-00012ef0: 696e 7374 616e 6365 2866 6561 7475 7265  instance(feature
-00012f00: 5f73 6574 2c20 4665 6174 7572 6553 6574  _set, FeatureSet
-00012f10: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-00012f20: 6561 7475 7265 5f73 6574 203d 2066 6561  eature_set = fea
-00012f30: 7475 7265 5f73 6574 2e74 6f5f 6469 6374  ture_set.to_dict
-00012f40: 2829 0a0a 2020 2020 2020 2020 6e61 6d65  ()..        name
-00012f50: 203d 206e 616d 6520 6f72 2066 6561 7475   = name or featu
-00012f60: 7265 5f73 6574 5b22 6d65 7461 6461 7461  re_set["metadata
-00012f70: 225d 5b22 6e61 6d65 225d 0a20 2020 2020  "]["name"].     
-00012f80: 2020 2070 726f 6a65 6374 203d 2028 0a20     project = (. 
-00012f90: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
-00012fa0: 6374 206f 7220 6665 6174 7572 655f 7365  ct or feature_se
-00012fb0: 745b 226d 6574 6164 6174 6122 5d2e 6765  t["metadata"].ge
-00012fc0: 7428 2270 726f 6a65 6374 2229 206f 7220  t("project") or 
-00012fd0: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
-00012fe0: 726f 6a65 6374 0a20 2020 2020 2020 2029  roject.        )
-00012ff0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00013000: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
-00013010: 6563 747d 2f66 6561 7475 7265 2d73 6574  ect}/feature-set
-00013020: 732f 7b6e 616d 657d 2f72 6566 6572 656e  s/{name}/referen
-00013030: 6365 732f 7b72 6566 6572 656e 6365 7d22  ces/{reference}"
-00013040: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
-00013050: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
-00013060: 6420 7374 6f72 696e 6720 6665 6174 7572  d storing featur
-00013070: 652d 7365 7420 7b70 726f 6a65 6374 7d2f  e-set {project}/
-00013080: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-00013090: 7265 7370 203d 2073 656c 662e 6170 695f  resp = self.api_
-000130a0: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-000130b0: 2020 2250 5554 222c 2070 6174 682c 2065    "PUT", path, e
-000130c0: 7272 6f72 5f6d 6573 7361 6765 2c20 7061  rror_message, pa
-000130d0: 7261 6d73 3d70 6172 616d 732c 2062 6f64  rams=params, bod
-000130e0: 793d 6469 6374 5f74 6f5f 6a73 6f6e 2866  y=dict_to_json(f
-000130f0: 6561 7475 7265 5f73 6574 290a 2020 2020  eature_set).    
-00013100: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-00013110: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
-00013120: 0a0a 2020 2020 6465 6620 7061 7463 685f  ..    def patch_
-00013130: 6665 6174 7572 655f 7365 7428 0a20 2020  feature_set(.   
-00013140: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00013150: 2020 206e 616d 652c 0a20 2020 2020 2020     name,.       
-00013160: 2066 6561 7475 7265 5f73 6574 5f75 7064   feature_set_upd
-00013170: 6174 653a 2064 6963 742c 0a20 2020 2020  ate: dict,.     
-00013180: 2020 2070 726f 6a65 6374 3d22 222c 0a20     project="",. 
-00013190: 2020 2020 2020 2074 6167 3d4e 6f6e 652c         tag=None,
-000131a0: 0a20 2020 2020 2020 2075 6964 3d4e 6f6e  .        uid=Non
-000131b0: 652c 0a20 2020 2020 2020 2070 6174 6368  e,.        patch
-000131c0: 5f6d 6f64 653a 2055 6e69 6f6e 5b0a 2020  _mode: Union[.  
-000131d0: 2020 2020 2020 2020 2020 7374 722c 206d            str, m
-000131e0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-000131f0: 6d61 732e 5061 7463 684d 6f64 650a 2020  mas.PatchMode.  
-00013200: 2020 2020 2020 5d20 3d20 6d6c 7275 6e2e        ] = mlrun.
-00013210: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e50  common.schemas.P
-00013220: 6174 6368 4d6f 6465 2e72 6570 6c61 6365  atchMode.replace
-00013230: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-00013240: 2022 2222 4d6f 6469 6679 2028 7061 7463   """Modify (patc
-00013250: 6829 2061 6e20 6578 6973 7469 6e67 203a  h) an existing :
-00013260: 7079 3a63 6c61 7373 3a60 7e6d 6c72 756e  py:class:`~mlrun
-00013270: 2e66 6561 7475 7265 5f73 746f 7265 2e46  .feature_store.F
-00013280: 6561 7475 7265 5365 7460 206f 626a 6563  eatureSet` objec
-00013290: 742e 0a20 2020 2020 2020 2054 6865 206f  t..        The o
-000132a0: 626a 6563 7420 6973 2069 6465 6e74 6966  bject is identif
-000132b0: 6965 6420 6279 2069 7473 206e 616d 6520  ied by its name 
-000132c0: 2861 6e64 2070 726f 6a65 6374 2069 7420  (and project it 
-000132d0: 6265 6c6f 6e67 7320 746f 292c 2061 7320  belongs to), as 
-000132e0: 7765 6c6c 2061 7320 6f70 7469 6f6e 616c  well as optional
-000132f0: 6c79 2061 2060 6074 6167 6060 206f 7220  ly a ``tag`` or 
-00013300: 6974 730a 2020 2020 2020 2020 6060 7569  its.        ``ui
-00013310: 6460 6020 2866 6f72 2076 6572 7369 6f6e  d`` (for version
-00013320: 6564 206f 626a 6563 7429 2e20 4966 2062  ed object). If b
-00013330: 6f74 6820 6060 7461 6760 6020 616e 6420  oth ``tag`` and 
-00013340: 6060 7569 6460 6020 6172 6520 6f6d 6974  ``uid`` are omit
-00013350: 7465 6420 7468 656e 2074 6865 206f 626a  ted then the obj
-00013360: 6563 7420 7769 7468 2074 6167 2060 606c  ect with tag ``l
-00013370: 6174 6573 7460 600a 2020 2020 2020 2020  atest``.        
-00013380: 6973 206d 6f64 6966 6965 642e 0a0a 2020  is modified...  
-00013390: 2020 2020 2020 3a70 6172 616d 206e 616d        :param nam
-000133a0: 653a 204e 616d 6520 6f66 2074 6865 206f  e: Name of the o
-000133b0: 626a 6563 7420 746f 2070 6174 6368 2e0a  bject to patch..
-000133c0: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-000133d0: 6561 7475 7265 5f73 6574 5f75 7064 6174  eature_set_updat
-000133e0: 653a 2054 6865 206d 6f64 6966 6963 6174  e: The modificat
-000133f0: 696f 6e73 206e 6565 6465 6420 696e 2074  ions needed in t
-00013400: 6865 206f 626a 6563 742e 2054 6869 7320  he object. This 
-00013410: 7061 7261 6d65 7465 7220 6f6e 6c79 2068  parameter only h
-00013420: 6173 2074 6865 2063 6861 6e67 6573 2069  as the changes i
-00013430: 6e20 6974 2c0a 2020 2020 2020 2020 2020  n it,.          
-00013440: 2020 6e6f 7420 6120 6675 6c6c 206f 626a    not a full obj
-00013450: 6563 742e 0a20 2020 2020 2020 2020 2020  ect..           
-00013460: 2045 7861 6d70 6c65 3a3a 0a0a 2020 2020   Example::..    
-00013470: 2020 2020 2020 2020 2020 2020 6665 6174              feat
-00013480: 7572 655f 7365 745f 7570 6461 7465 203d  ure_set_update =
-00013490: 207b 2273 7461 7475 7322 3a20 7b22 7072   {"status": {"pr
-000134a0: 6f63 6573 7365 6422 203a 2054 7275 657d  ocessed" : True}
-000134b0: 7d0a 0a20 2020 2020 2020 2020 2020 2057  }..            W
-000134c0: 696c 6c20 6170 706c 7920 7468 6520 6669  ill apply the fi
-000134d0: 656c 6420 6060 7374 6174 7573 2e70 726f  eld ``status.pro
-000134e0: 6365 7373 6564 6060 2074 6f20 7468 6520  cessed`` to the 
-000134f0: 6578 6973 7469 6e67 206f 626a 6563 742e  existing object.
-00013500: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00013510: 7072 6f6a 6563 743a 2050 726f 6a65 6374  project: Project
-00013520: 2077 6869 6368 2063 6f6e 7461 696e 7320   which contains 
-00013530: 7468 6520 6d6f 6469 6669 6564 206f 626a  the modified obj
-00013540: 6563 742e 0a20 2020 2020 2020 203a 7061  ect..        :pa
-00013550: 7261 6d20 7461 673a 2054 6865 2074 6167  ram tag: The tag
-00013560: 206f 6620 7468 6520 6f62 6a65 6374 2074   of the object t
-00013570: 6f20 6d6f 6469 6679 2e0a 2020 2020 2020  o modify..      
-00013580: 2020 3a70 6172 616d 2075 6964 3a20 7569    :param uid: ui
-00013590: 6420 6f66 2074 6865 206f 626a 6563 7420  d of the object 
-000135a0: 746f 206d 6f64 6966 792e 0a20 2020 2020  to modify..     
-000135b0: 2020 203a 7061 7261 6d20 7061 7463 685f     :param patch_
-000135c0: 6d6f 6465 3a20 5468 6520 7374 7261 7465  mode: The strate
-000135d0: 6779 2066 6f72 206d 6572 6769 6e67 2074  gy for merging t
-000135e0: 6865 2063 6861 6e67 6573 2077 6974 6820  he changes with 
-000135f0: 7468 6520 6578 6973 7469 6e67 206f 626a  the existing obj
-00013600: 6563 742e 2043 616e 2062 6520 6569 7468  ect. Can be eith
-00013610: 6572 2060 6072 6570 6c61 6365 6060 0a20  er ``replace``. 
-00013620: 2020 2020 2020 2020 2020 206f 7220 6060             or ``
-00013630: 6164 6469 7469 7665 6060 2e0a 2020 2020  additive``..    
-00013640: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00013650: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
-00013660: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
-00013670: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
-00013680: 2020 2020 7265 6665 7265 6e63 6520 3d20      reference = 
-00013690: 7365 6c66 2e5f 7265 736f 6c76 655f 7265  self._resolve_re
-000136a0: 6665 7265 6e63 6528 7461 672c 2075 6964  ference(tag, uid
-000136b0: 290a 2020 2020 2020 2020 6865 6164 6572  ).        header
-000136c0: 7320 3d20 7b6d 6c72 756e 2e63 6f6d 6d6f  s = {mlrun.commo
-000136d0: 6e2e 7363 6865 6d61 732e 4865 6164 6572  n.schemas.Header
-000136e0: 4e61 6d65 732e 7061 7463 685f 6d6f 6465  Names.patch_mode
-000136f0: 3a20 7061 7463 685f 6d6f 6465 7d0a 2020  : patch_mode}.  
-00013700: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
-00013710: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
-00013720: 7d2f 6665 6174 7572 652d 7365 7473 2f7b  }/feature-sets/{
-00013730: 6e61 6d65 7d2f 7265 6665 7265 6e63 6573  name}/references
-00013740: 2f7b 7265 6665 7265 6e63 657d 220a 2020  /{reference}".  
-00013750: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-00013760: 6167 6520 3d20 6622 4661 696c 6564 2075  age = f"Failed u
-00013770: 7064 6174 696e 6720 6665 6174 7572 652d  pdating feature-
-00013780: 7365 7420 7b70 726f 6a65 6374 7d2f 7b6e  set {project}/{n
-00013790: 616d 657d 220a 2020 2020 2020 2020 7365  ame}".        se
-000137a0: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-000137b0: 2020 2020 2020 2020 2022 5041 5443 4822           "PATCH"
-000137c0: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-000137d0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-000137e0: 6572 726f 725f 6d65 7373 6167 652c 0a20  error_message,. 
-000137f0: 2020 2020 2020 2020 2020 2062 6f64 793d             body=
-00013800: 6469 6374 5f74 6f5f 6a73 6f6e 2866 6561  dict_to_json(fea
-00013810: 7475 7265 5f73 6574 5f75 7064 6174 6529  ture_set_update)
-00013820: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
-00013830: 6164 6572 733d 6865 6164 6572 732c 0a20  aders=headers,. 
-00013840: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00013850: 6620 6465 6c65 7465 5f66 6561 7475 7265  f delete_feature
-00013860: 5f73 6574 2873 656c 662c 206e 616d 652c  _set(self, name,
-00013870: 2070 726f 6a65 6374 3d22 222c 2074 6167   project="", tag
-00013880: 3d4e 6f6e 652c 2075 6964 3d4e 6f6e 6529  =None, uid=None)
-00013890: 3a0a 2020 2020 2020 2020 2222 2244 656c  :.        """Del
-000138a0: 6574 6520 6120 3a70 793a 636c 6173 733a  ete a :py:class:
-000138b0: 607e 6d6c 7275 6e2e 6665 6174 7572 655f  `~mlrun.feature_
-000138c0: 7374 6f72 652e 4665 6174 7572 6553 6574  store.FeatureSet
-000138d0: 6020 6f62 6a65 6374 2066 726f 6d20 7468  ` object from th
-000138e0: 6520 4442 2e0a 2020 2020 2020 2020 4966  e DB..        If
-000138f0: 2060 6074 6167 6060 206f 7220 6060 7569   ``tag`` or ``ui
-00013900: 6460 6020 6172 6520 7370 6563 6966 6965  d`` are specifie
-00013910: 642c 2074 6865 6e20 6a75 7374 2074 6865  d, then just the
-00013920: 2076 6572 7369 6f6e 2072 6566 6572 656e   version referen
-00013930: 6365 6420 6279 2074 6865 6d20 7769 6c6c  ced by them will
-00013940: 2062 6520 6465 6c65 7465 642e 2055 7369   be deleted. Usi
-00013950: 6e67 2062 6f74 680a 2020 2020 2020 2020  ng both.        
-00013960: 6973 206e 6f74 2061 6c6c 6f77 6564 2e0a  is not allowed..
-00013970: 2020 2020 2020 2020 4966 206e 6f6e 6520          If none 
-00013980: 6172 6520 7370 6563 6966 6965 642c 2074  are specified, t
-00013990: 6865 6e20 616c 6c20 696e 7374 616e 6365  hen all instance
-000139a0: 7320 6f66 2074 6865 206f 626a 6563 7420  s of the object 
-000139b0: 7768 6f73 6520 6e61 6d65 2069 7320 6060  whose name is ``
-000139c0: 6e61 6d65 6060 2077 696c 6c20 6265 2064  name`` will be d
-000139d0: 656c 6574 6564 2e0a 2020 2020 2020 2020  eleted..        
-000139e0: 2222 220a 2020 2020 2020 2020 7072 6f6a  """.        proj
-000139f0: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
-00013a00: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
-00013a10: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
-00013a20: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
-00013a30: 732f 7b70 726f 6a65 6374 7d2f 6665 6174  s/{project}/feat
-00013a40: 7572 652d 7365 7473 2f7b 6e61 6d65 7d22  ure-sets/{name}"
-00013a50: 0a0a 2020 2020 2020 2020 6966 2074 6167  ..        if tag
-00013a60: 206f 7220 7569 643a 0a20 2020 2020 2020   or uid:.       
-00013a70: 2020 2020 2072 6566 6572 656e 6365 203d       reference =
-00013a80: 2073 656c 662e 5f72 6573 6f6c 7665 5f72   self._resolve_r
-00013a90: 6566 6572 656e 6365 2874 6167 2c20 7569  eference(tag, ui
-00013aa0: 6429 0a20 2020 2020 2020 2020 2020 2070  d).            p
-00013ab0: 6174 6820 3d20 7061 7468 202b 2066 222f  ath = path + f"/
-00013ac0: 7265 6665 7265 6e63 6573 2f7b 7265 6665  references/{refe
-00013ad0: 7265 6e63 657d 220a 0a20 2020 2020 2020  rence}"..       
-00013ae0: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-00013af0: 2066 2246 6169 6c65 6420 6465 6c65 7469   f"Failed deleti
-00013b00: 6e67 2066 6561 7475 7265 2d73 6574 207b  ng feature-set {
-00013b10: 6e61 6d65 7d22 0a20 2020 2020 2020 2073  name}".        s
-00013b20: 656c 662e 6170 695f 6361 6c6c 2822 4445  elf.api_call("DE
-00013b30: 4c45 5445 222c 2070 6174 682c 2065 7272  LETE", path, err
-00013b40: 6f72 5f6d 6573 7361 6765 290a 0a20 2020  or_message)..   
-00013b50: 2064 6566 2063 7265 6174 655f 6665 6174   def create_feat
-00013b60: 7572 655f 7665 6374 6f72 280a 2020 2020  ure_vector(.    
-00013b70: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00013b80: 2020 6665 6174 7572 655f 7665 6374 6f72    feature_vector
-00013b90: 3a20 556e 696f 6e5b 6469 6374 2c20 6d6c  : Union[dict, ml
-00013ba0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-00013bb0: 6173 2e46 6561 7475 7265 5665 6374 6f72  as.FeatureVector
-00013bc0: 2c20 4665 6174 7572 6556 6563 746f 725d  , FeatureVector]
-00013bd0: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-00013be0: 743d 2222 2c0a 2020 2020 2020 2020 7665  t="",.        ve
-00013bf0: 7273 696f 6e65 643d 5472 7565 2c0a 2020  rsioned=True,.  
-00013c00: 2020 2920 2d3e 2064 6963 743a 0a20 2020    ) -> dict:.   
-00013c10: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
-00013c20: 206e 6577 203a 7079 3a63 6c61 7373 3a60   new :py:class:`
-00013c30: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
-00013c40: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
-00013c50: 6f72 6020 616e 6420 7361 7665 2069 6e20  or` and save in 
-00013c60: 7468 6520 3a70 793a 6d6f 643a 606d 6c72  the :py:mod:`mlr
-00013c70: 756e 6020 4442 2e0a 0a20 2020 2020 2020  un` DB...       
-00013c80: 203a 7061 7261 6d20 6665 6174 7572 655f   :param feature_
-00013c90: 7665 6374 6f72 3a20 5468 6520 6e65 7720  vector: The new 
-00013ca0: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
-00013cb0: 6e2e 6665 6174 7572 655f 7374 6f72 652e  n.feature_store.
-00013cc0: 4665 6174 7572 6556 6563 746f 7260 2074  FeatureVector` t
-00013cd0: 6f20 6372 6561 7465 2e0a 2020 2020 2020  o create..      
-00013ce0: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
-00013cf0: 3a20 4e61 6d65 206f 6620 7072 6f6a 6563  : Name of projec
-00013d00: 7420 7468 6973 2066 6561 7475 7265 2d76  t this feature-v
-00013d10: 6563 746f 7220 6265 6c6f 6e67 7320 746f  ector belongs to
-00013d20: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00013d30: 2076 6572 7369 6f6e 6564 3a20 5768 6574   versioned: Whet
-00013d40: 6865 7220 746f 206d 6169 6e74 6169 6e20  her to maintain 
-00013d50: 7665 7273 696f 6e73 2066 6f72 2074 6869  versions for thi
-00013d60: 7320 6665 6174 7572 652d 7665 6374 6f72  s feature-vector
-00013d70: 2e20 416c 6c20 7665 7273 696f 6e73 206f  . All versions o
-00013d80: 6620 6120 7665 7273 696f 6e65 6420 6f62  f a versioned ob
-00013d90: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
-00013da0: 2077 696c 6c20 6265 206b 6570 7420 696e   will be kept in
-00013db0: 2074 6865 2044 4220 616e 6420 6361 6e20   the DB and can 
-00013dc0: 6265 2072 6574 7269 6576 6564 2075 6e74  be retrieved unt
-00013dd0: 696c 2065 7870 6c69 6369 746c 7920 6465  il explicitly de
-00013de0: 6c65 7465 642e 0a20 2020 2020 2020 203a  leted..        :
-00013df0: 7265 7475 726e 733a 2054 6865 203a 7079  returns: The :py
-00013e00: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
-00013e10: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
-00013e20: 7475 7265 5665 6374 6f72 6020 6f62 6a65  tureVector` obje
-00013e30: 6374 2028 6173 2064 6963 7429 2e0a 2020  ct (as dict)..  
-00013e40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013e50: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00013e60: 6665 6174 7572 655f 7665 6374 6f72 2c20  feature_vector, 
-00013e70: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00013e80: 656d 6173 2e46 6561 7475 7265 5665 6374  emas.FeatureVect
-00013e90: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-00013ea0: 2066 6561 7475 7265 5f76 6563 746f 7220   feature_vector 
-00013eb0: 3d20 6665 6174 7572 655f 7665 6374 6f72  = feature_vector
-00013ec0: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
-00013ed0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00013ee0: 6665 6174 7572 655f 7665 6374 6f72 2c20  feature_vector, 
-00013ef0: 4665 6174 7572 6556 6563 746f 7229 3a0a  FeatureVector):.
-00013f00: 2020 2020 2020 2020 2020 2020 6665 6174              feat
-00013f10: 7572 655f 7665 6374 6f72 203d 2066 6561  ure_vector = fea
-00013f20: 7475 7265 5f76 6563 746f 722e 746f 5f64  ture_vector.to_d
-00013f30: 6963 7428 290a 0a20 2020 2020 2020 2070  ict()..        p
-00013f40: 726f 6a65 6374 203d 2028 0a20 2020 2020  roject = (.     
-00013f50: 2020 2020 2020 2070 726f 6a65 6374 0a20         project. 
-00013f60: 2020 2020 2020 2020 2020 206f 7220 6665             or fe
-00013f70: 6174 7572 655f 7665 6374 6f72 5b22 6d65  ature_vector["me
-00013f80: 7461 6461 7461 225d 2e67 6574 2822 7072  tadata"].get("pr
-00013f90: 6f6a 6563 7422 2c20 4e6f 6e65 290a 2020  oject", None).  
-00013fa0: 2020 2020 2020 2020 2020 6f72 2063 6f6e            or con
-00013fb0: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
-00013fc0: 6563 740a 2020 2020 2020 2020 290a 2020  ect.        ).  
-00013fd0: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
-00013fe0: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
-00013ff0: 7d2f 6665 6174 7572 652d 7665 6374 6f72  }/feature-vector
-00014000: 7322 0a20 2020 2020 2020 2070 6172 616d  s".        param
-00014010: 7320 3d20 7b22 7665 7273 696f 6e65 6422  s = {"versioned"
-00014020: 3a20 7665 7273 696f 6e65 647d 0a0a 2020  : versioned}..  
-00014030: 2020 2020 2020 6e61 6d65 203d 2066 6561        name = fea
-00014040: 7475 7265 5f76 6563 746f 725b 226d 6574  ture_vector["met
-00014050: 6164 6174 6122 5d5b 226e 616d 6522 5d0a  adata"]["name"].
-00014060: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-00014070: 7373 6167 6520 3d20 6622 4661 696c 6564  ssage = f"Failed
-00014080: 2063 7265 6174 696e 6720 6665 6174 7572   creating featur
-00014090: 652d 7665 6374 6f72 207b 7072 6f6a 6563  e-vector {projec
-000140a0: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
-000140b0: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
-000140c0: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
-000140d0: 2020 2020 2022 504f 5354 222c 0a20 2020       "POST",.   
-000140e0: 2020 2020 2020 2020 2070 6174 682c 0a20           path,. 
-000140f0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00014100: 5f6d 6573 7361 6765 2c0a 2020 2020 2020  _message,.      
-00014110: 2020 2020 2020 7061 7261 6d73 3d70 6172        params=par
-00014120: 616d 732c 0a20 2020 2020 2020 2020 2020  ams,.           
-00014130: 2062 6f64 793d 6469 6374 5f74 6f5f 6a73   body=dict_to_js
-00014140: 6f6e 2866 6561 7475 7265 5f76 6563 746f  on(feature_vecto
-00014150: 7229 2c0a 2020 2020 2020 2020 290a 2020  r),.        ).  
-00014160: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-00014170: 702e 6a73 6f6e 2829 0a0a 2020 2020 6465  p.json()..    de
-00014180: 6620 6765 745f 6665 6174 7572 655f 7665  f get_feature_ve
-00014190: 6374 6f72 280a 2020 2020 2020 2020 7365  ctor(.        se
-000141a0: 6c66 2c20 6e61 6d65 3a20 7374 722c 2070  lf, name: str, p
-000141b0: 726f 6a65 6374 3a20 7374 7220 3d20 2222  roject: str = ""
-000141c0: 2c20 7461 673a 2073 7472 203d 204e 6f6e  , tag: str = Non
-000141d0: 652c 2075 6964 3a20 7374 7220 3d20 4e6f  e, uid: str = No
-000141e0: 6e65 0a20 2020 2029 202d 3e20 4665 6174  ne.    ) -> Feat
-000141f0: 7572 6556 6563 746f 723a 0a20 2020 2020  ureVector:.     
-00014200: 2020 2022 2222 5265 7475 726e 2061 2073     """Return a s
-00014210: 7065 6369 6669 6320 6665 6174 7572 652d  pecific feature-
-00014220: 7665 6374 6f72 2072 6566 6572 656e 6365  vector reference
-00014230: 6420 6279 2069 7473 2074 6167 206f 7220  d by its tag or 
-00014240: 7569 642e 2049 6620 6e6f 6e65 2061 7265  uid. If none are
-00014250: 2070 726f 7669 6465 642c 2060 606c 6174   provided, ``lat
-00014260: 6573 7460 6020 7461 6720 7769 6c6c 0a20  est`` tag will. 
-00014270: 2020 2020 2020 2062 6520 7573 6564 2e22         be used."
-00014280: 2222 0a0a 2020 2020 2020 2020 7072 6f6a  ""..        proj
-00014290: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
-000142a0: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
-000142b0: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
-000142c0: 7265 6665 7265 6e63 6520 3d20 7365 6c66  reference = self
-000142d0: 2e5f 7265 736f 6c76 655f 7265 6665 7265  ._resolve_refere
-000142e0: 6e63 6528 7461 672c 2075 6964 290a 2020  nce(tag, uid).  
-000142f0: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
-00014300: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
-00014310: 7d2f 6665 6174 7572 652d 7665 6374 6f72  }/feature-vector
-00014320: 732f 7b6e 616d 657d 2f72 6566 6572 656e  s/{name}/referen
-00014330: 6365 732f 7b72 6566 6572 656e 6365 7d22  ces/{reference}"
-00014340: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
-00014350: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
-00014360: 6420 7265 7472 6965 7669 6e67 2066 6561  d retrieving fea
-00014370: 7475 7265 2d76 6563 746f 7220 7b70 726f  ture-vector {pro
-00014380: 6a65 6374 7d2f 7b6e 616d 657d 220a 2020  ject}/{name}".  
-00014390: 2020 2020 2020 7265 7370 203d 2073 656c        resp = sel
-000143a0: 662e 6170 695f 6361 6c6c 2822 4745 5422  f.api_call("GET"
-000143b0: 2c20 7061 7468 2c20 6572 726f 725f 6d65  , path, error_me
-000143c0: 7373 6167 6529 0a20 2020 2020 2020 2072  ssage).        r
-000143d0: 6574 7572 6e20 4665 6174 7572 6556 6563  eturn FeatureVec
-000143e0: 746f 722e 6672 6f6d 5f64 6963 7428 7265  tor.from_dict(re
-000143f0: 7370 2e6a 736f 6e28 2929 0a0a 2020 2020  sp.json())..    
-00014400: 6465 6620 6c69 7374 5f66 6561 7475 7265  def list_feature
-00014410: 5f76 6563 746f 7273 280a 2020 2020 2020  _vectors(.      
-00014420: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00014430: 7072 6f6a 6563 743a 2073 7472 203d 2022  project: str = "
-00014440: 222c 0a20 2020 2020 2020 206e 616d 653a  ",.        name:
-00014450: 2073 7472 203d 204e 6f6e 652c 0a20 2020   str = None,.   
-00014460: 2020 2020 2074 6167 3a20 7374 7220 3d20       tag: str = 
-00014470: 4e6f 6e65 2c0a 2020 2020 2020 2020 7374  None,.        st
-00014480: 6174 653a 2073 7472 203d 204e 6f6e 652c  ate: str = None,
-00014490: 0a20 2020 2020 2020 206c 6162 656c 733a  .        labels:
-000144a0: 204c 6973 745b 7374 725d 203d 204e 6f6e   List[str] = Non
-000144b0: 652c 0a20 2020 2020 2020 2070 6172 7469  e,.        parti
-000144c0: 7469 6f6e 5f62 793a 2055 6e69 6f6e 5b0a  tion_by: Union[.
-000144d0: 2020 2020 2020 2020 2020 2020 6d6c 7275              mlru
-000144e0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-000144f0: 2e46 6561 7475 7265 5374 6f72 6550 6172  .FeatureStorePar
-00014500: 7469 7469 6f6e 4279 4669 656c 642c 2073  titionByField, s
-00014510: 7472 0a20 2020 2020 2020 205d 203d 204e  tr.        ] = N
-00014520: 6f6e 652c 0a20 2020 2020 2020 2072 6f77  one,.        row
-00014530: 735f 7065 725f 7061 7274 6974 696f 6e3a  s_per_partition:
-00014540: 2069 6e74 203d 2031 2c0a 2020 2020 2020   int = 1,.      
-00014550: 2020 7061 7274 6974 696f 6e5f 736f 7274    partition_sort
-00014560: 5f62 793a 2055 6e69 6f6e 5b6d 6c72 756e  _by: Union[mlrun
-00014570: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00014580: 536f 7274 4669 656c 642c 2073 7472 5d20  SortField, str] 
-00014590: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000145a0: 7061 7274 6974 696f 6e5f 6f72 6465 723a  partition_order:
-000145b0: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
-000145c0: 2020 2020 6d6c 7275 6e2e 636f 6d6d 6f6e      mlrun.common
-000145d0: 2e73 6368 656d 6173 2e4f 7264 6572 5479  .schemas.OrderTy
-000145e0: 7065 2c20 7374 720a 2020 2020 2020 2020  pe, str.        
-000145f0: 5d20 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e  ] = mlrun.common
-00014600: 2e73 6368 656d 6173 2e4f 7264 6572 5479  .schemas.OrderTy
-00014610: 7065 2e64 6573 632c 0a20 2020 2029 202d  pe.desc,.    ) -
-00014620: 3e20 4c69 7374 5b46 6561 7475 7265 5665  > List[FeatureVe
-00014630: 6374 6f72 5d3a 0a20 2020 2020 2020 2022  ctor]:.        "
-00014640: 2222 5265 7472 6965 7665 2061 206c 6973  ""Retrieve a lis
-00014650: 7420 6f66 2066 6561 7475 7265 2d76 6563  t of feature-vec
-00014660: 746f 7273 206d 6174 6368 696e 6720 7468  tors matching th
-00014670: 6520 6372 6974 6572 6961 2070 726f 7669  e criteria provi
-00014680: 6465 642e 0a0a 2020 2020 2020 2020 3a70  ded...        :p
-00014690: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
-000146a0: 6f6a 6563 7420 6e61 6d65 2e0a 2020 2020  oject name..    
-000146b0: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
-000146c0: 204e 616d 6520 6f66 2066 6561 7475 7265   Name of feature
-000146d0: 2d76 6563 746f 7220 746f 206d 6174 6368  -vector to match
-000146e0: 2e20 5468 6973 2069 7320 6120 6c69 6b65  . This is a like
-000146f0: 2071 7565 7279 2c20 616e 6420 6973 2063   query, and is c
-00014700: 6173 652d 696e 7365 6e73 6974 6976 652e  ase-insensitive.
-00014710: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00014720: 7461 673a 204d 6174 6368 2066 6561 7475  tag: Match featu
-00014730: 7265 2d76 6563 746f 7273 2077 6974 6820  re-vectors with 
-00014740: 7370 6563 6966 6963 2074 6167 2e0a 2020  specific tag..  
-00014750: 2020 2020 2020 3a70 6172 616d 2073 7461        :param sta
-00014760: 7465 3a20 4d61 7463 6820 6665 6174 7572  te: Match featur
-00014770: 652d 7665 6374 6f72 7320 7769 7468 2061  e-vectors with a
-00014780: 2073 7065 6369 6669 6320 7374 6174 652e   specific state.
-00014790: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000147a0: 6c61 6265 6c73 3a20 4d61 7463 6820 6665  labels: Match fe
-000147b0: 6174 7572 652d 7665 6374 6f72 7320 7768  ature-vectors wh
-000147c0: 6963 6820 6861 7665 2074 6865 7365 206c  ich have these l
-000147d0: 6162 656c 732e 0a20 2020 2020 2020 203a  abels..        :
-000147e0: 7061 7261 6d20 7061 7274 6974 696f 6e5f  param partition_
-000147f0: 6279 3a20 4669 656c 6420 746f 2067 726f  by: Field to gro
-00014800: 7570 2072 6573 756c 7473 2062 792e 204f  up results by. O
-00014810: 6e6c 7920 616c 6c6f 7765 6420 7661 6c75  nly allowed valu
-00014820: 6520 6973 2060 6e61 6d65 602e 2057 6865  e is `name`. Whe
-00014830: 6e20 6070 6172 7469 7469 6f6e 5f62 7960  n `partition_by`
-00014840: 2069 7320 7370 6563 6966 6965 642c 0a20   is specified,. 
-00014850: 2020 2020 2020 2020 2020 2074 6865 2060             the `
-00014860: 7061 7274 6974 696f 6e5f 736f 7274 5f62  partition_sort_b
-00014870: 7960 2070 6172 616d 6574 6572 206d 7573  y` parameter mus
-00014880: 7420 6265 2070 726f 7669 6465 6420 6173  t be provided as
-00014890: 2077 656c 6c2e 0a20 2020 2020 2020 203a   well..        :
-000148a0: 7061 7261 6d20 726f 7773 5f70 6572 5f70  param rows_per_p
-000148b0: 6172 7469 7469 6f6e 3a20 486f 7720 6d61  artition: How ma
-000148c0: 6e79 2074 6f70 2072 6f77 7320 2870 6572  ny top rows (per
-000148d0: 2073 6f72 7469 6e67 2064 6566 696e 6564   sorting defined
-000148e0: 2062 7920 6070 6172 7469 7469 6f6e 5f73   by `partition_s
-000148f0: 6f72 745f 6279 6020 616e 6420 6070 6172  ort_by` and `par
-00014900: 7469 7469 6f6e 5f6f 7264 6572 6029 0a20  tition_order`). 
-00014910: 2020 2020 2020 2020 2020 2074 6f20 7265             to re
-00014920: 7475 726e 2070 6572 2067 726f 7570 2e20  turn per group. 
-00014930: 4465 6661 756c 7420 7661 6c75 6520 6973  Default value is
-00014940: 2031 2e0a 2020 2020 2020 2020 3a70 6172   1..        :par
-00014950: 616d 2070 6172 7469 7469 6f6e 5f73 6f72  am partition_sor
-00014960: 745f 6279 3a20 5768 6174 2066 6965 6c64  t_by: What field
-00014970: 2074 6f20 736f 7274 2074 6865 2072 6573   to sort the res
-00014980: 756c 7473 2062 792c 2077 6974 6869 6e20  ults by, within 
-00014990: 6561 6368 2070 6172 7469 7469 6f6e 2064  each partition d
-000149a0: 6566 696e 6564 2062 7920 6070 6172 7469  efined by `parti
-000149b0: 7469 6f6e 5f62 7960 2e0a 2020 2020 2020  tion_by`..      
-000149c0: 2020 2020 2020 4375 7272 656e 746c 7920        Currently 
-000149d0: 7468 6520 6f6e 6c79 2061 6c6c 6f77 6564  the only allowed
-000149e0: 2076 616c 7565 7320 6172 6520 6063 7265   values are `cre
-000149f0: 6174 6564 6020 616e 6420 6075 7064 6174  ated` and `updat
-00014a00: 6564 602e 0a20 2020 2020 2020 203a 7061  ed`..        :pa
-00014a10: 7261 6d20 7061 7274 6974 696f 6e5f 6f72  ram partition_or
-00014a20: 6465 723a 204f 7264 6572 206f 6620 736f  der: Order of so
-00014a30: 7274 696e 6720 7769 7468 696e 2070 6172  rting within par
-00014a40: 7469 7469 6f6e 7320 2d20 6061 7363 6020  titions - `asc` 
-00014a50: 6f72 2060 6465 7363 602e 2044 6566 6175  or `desc`. Defau
-00014a60: 6c74 2069 7320 6064 6573 6360 2e0a 2020  lt is `desc`..  
-00014a70: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
-00014a80: 4c69 7374 206f 6620 6d61 7463 6869 6e67  List of matching
-00014a90: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
-00014aa0: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
-00014ab0: 2e46 6561 7475 7265 5665 6374 6f72 6020  .FeatureVector` 
-00014ac0: 6f62 6a65 6374 732e 0a20 2020 2020 2020  objects..       
-00014ad0: 2022 2222 0a0a 2020 2020 2020 2020 7072   """..        pr
-00014ae0: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
-00014af0: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
-00014b00: 745f 7072 6f6a 6563 740a 0a20 2020 2020  t_project..     
-00014b10: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
-00014b20: 2020 2020 2020 2020 2020 226e 616d 6522            "name"
-00014b30: 3a20 6e61 6d65 2c0a 2020 2020 2020 2020  : name,.        
-00014b40: 2020 2020 2273 7461 7465 223a 2073 7461      "state": sta
-00014b50: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-00014b60: 2274 6167 223a 2074 6167 2c0a 2020 2020  "tag": tag,.    
-00014b70: 2020 2020 2020 2020 226c 6162 656c 223a          "label":
-00014b80: 206c 6162 656c 7320 6f72 205b 5d2c 0a20   labels or [],. 
-00014b90: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00014ba0: 2069 6620 7061 7274 6974 696f 6e5f 6279   if partition_by
-00014bb0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00014bc0: 7261 6d73 2e75 7064 6174 6528 0a20 2020  rams.update(.   
-00014bd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00014be0: 662e 5f67 656e 6572 6174 655f 7061 7274  f._generate_part
-00014bf0: 6974 696f 6e5f 6279 5f70 6172 616d 7328  ition_by_params(
-00014c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c10: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
-00014c20: 6e2e 7363 6865 6d61 732e 4665 6174 7572  n.schemas.Featur
-00014c30: 6553 746f 7265 5061 7274 6974 696f 6e42  eStorePartitionB
-00014c40: 7946 6965 6c64 2c0a 2020 2020 2020 2020  yField,.        
-00014c50: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00014c60: 6974 696f 6e5f 6279 2c0a 2020 2020 2020  ition_by,.      
-00014c70: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00014c80: 7773 5f70 6572 5f70 6172 7469 7469 6f6e  ws_per_partition
-00014c90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014ca0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
-00014cb0: 736f 7274 5f62 792c 0a20 2020 2020 2020  sort_by,.       
-00014cc0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00014cd0: 7469 7469 6f6e 5f6f 7264 6572 2c0a 2020  tition_order,.  
-00014ce0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00014cf0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00014d00: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-00014d10: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-00014d20: 747d 2f66 6561 7475 7265 2d76 6563 746f  t}/feature-vecto
-00014d30: 7273 220a 0a20 2020 2020 2020 2065 7272  rs"..        err
-00014d40: 6f72 5f6d 6573 7361 6765 203d 2028 0a20  or_message = (. 
-00014d50: 2020 2020 2020 2020 2020 2066 2246 6169             f"Fai
-00014d60: 6c65 6420 6c69 7374 696e 6720 6665 6174  led listing feat
-00014d70: 7572 652d 7665 6374 6f72 732c 2070 726f  ure-vectors, pro
-00014d80: 6a65 6374 3a20 7b70 726f 6a65 6374 7d2c  ject: {project},
-00014d90: 2071 7565 7279 3a20 7b70 6172 616d 737d   query: {params}
-00014da0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00014db0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-00014dc0: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
-00014dd0: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
-00014de0: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
-00014df0: 6d73 290a 2020 2020 2020 2020 6665 6174  ms).        feat
-00014e00: 7572 655f 7665 6374 6f72 7320 3d20 7265  ure_vectors = re
-00014e10: 7370 2e6a 736f 6e28 295b 2266 6561 7475  sp.json()["featu
-00014e20: 7265 5f76 6563 746f 7273 225d 0a20 2020  re_vectors"].   
-00014e30: 2020 2020 2069 6620 6665 6174 7572 655f       if feature_
-00014e40: 7665 6374 6f72 733a 0a20 2020 2020 2020  vectors:.       
-00014e50: 2020 2020 2072 6574 7572 6e20 5b46 6561       return [Fea
-00014e60: 7475 7265 5665 6374 6f72 2e66 726f 6d5f  tureVector.from_
-00014e70: 6469 6374 286f 626a 2920 666f 7220 6f62  dict(obj) for ob
-00014e80: 6a20 696e 2066 6561 7475 7265 5f76 6563  j in feature_vec
-00014e90: 746f 7273 5d0a 0a20 2020 2064 6566 2073  tors]..    def s
-00014ea0: 746f 7265 5f66 6561 7475 7265 5f76 6563  tore_feature_vec
-00014eb0: 746f 7228 0a20 2020 2020 2020 2073 656c  tor(.        sel
-00014ec0: 662c 0a20 2020 2020 2020 2066 6561 7475  f,.        featu
-00014ed0: 7265 5f76 6563 746f 723a 2055 6e69 6f6e  re_vector: Union
-00014ee0: 5b64 6963 742c 206d 6c72 756e 2e63 6f6d  [dict, mlrun.com
-00014ef0: 6d6f 6e2e 7363 6865 6d61 732e 4665 6174  mon.schemas.Feat
-00014f00: 7572 6556 6563 746f 722c 2046 6561 7475  ureVector, Featu
-00014f10: 7265 5665 6374 6f72 5d2c 0a20 2020 2020  reVector],.     
-00014f20: 2020 206e 616d 653d 4e6f 6e65 2c0a 2020     name=None,.  
-00014f30: 2020 2020 2020 7072 6f6a 6563 743d 2222        project=""
-00014f40: 2c0a 2020 2020 2020 2020 7461 673d 4e6f  ,.        tag=No
-00014f50: 6e65 2c0a 2020 2020 2020 2020 7569 643d  ne,.        uid=
-00014f60: 4e6f 6e65 2c0a 2020 2020 2020 2020 7665  None,.        ve
-00014f70: 7273 696f 6e65 643d 5472 7565 2c0a 2020  rsioned=True,.  
-00014f80: 2020 2920 2d3e 2064 6963 743a 0a20 2020    ) -> dict:.   
-00014f90: 2020 2020 2022 2222 5374 6f72 6520 6120       """Store a 
-00014fa0: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
-00014fb0: 6e2e 6665 6174 7572 655f 7374 6f72 652e  n.feature_store.
-00014fc0: 4665 6174 7572 6556 6563 746f 7260 206f  FeatureVector` o
-00014fd0: 626a 6563 7420 696e 2074 6865 203a 7079  bject in the :py
-00014fe0: 3a6d 6f64 3a60 6d6c 7275 6e60 2044 422e  :mod:`mlrun` DB.
-00014ff0: 2054 6865 0a20 2020 2020 2020 2066 6561   The.        fea
-00015000: 7475 7265 2d76 6563 746f 7220 6361 6e20  ture-vector can 
-00015010: 6265 2065 6974 6865 7220 6120 6e65 7720  be either a new 
-00015020: 6f62 6a65 6374 206f 7220 6120 6d6f 6469  object or a modi
-00015030: 6669 6361 7469 6f6e 2074 6f20 6578 6973  fication to exis
-00015040: 7469 6e67 206f 626a 6563 7420 7265 6665  ting object refe
-00015050: 7265 6e63 6564 2062 7920 7468 6520 7061  renced by the pa
-00015060: 7261 6d73 0a20 2020 2020 2020 206f 6620  rams.        of 
-00015070: 7468 6520 6675 6e63 7469 6f6e 2e0a 0a20  the function... 
-00015080: 2020 2020 2020 203a 7061 7261 6d20 6665         :param fe
-00015090: 6174 7572 655f 7665 6374 6f72 3a20 5468  ature_vector: Th
-000150a0: 6520 3a70 793a 636c 6173 733a 607e 6d6c  e :py:class:`~ml
-000150b0: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
-000150c0: 652e 4665 6174 7572 6556 6563 746f 7260  e.FeatureVector`
-000150d0: 2074 6f20 7374 6f72 652e 0a20 2020 2020   to store..     
-000150e0: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
-000150f0: 2020 204e 616d 6520 6f66 2066 6561 7475     Name of featu
-00015100: 7265 2076 6563 746f 722e 0a20 2020 2020  re vector..     
-00015110: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00015120: 743a 204e 616d 6520 6f66 2070 726f 6a65  t: Name of proje
-00015130: 6374 2074 6869 7320 6665 6174 7572 652d  ct this feature-
-00015140: 7665 6374 6f72 2062 656c 6f6e 6773 2074  vector belongs t
-00015150: 6f2e 0a20 2020 2020 2020 203a 7061 7261  o..        :para
-00015160: 6d20 7461 673a 2054 6865 2060 6074 6167  m tag: The ``tag
-00015170: 6060 206f 6620 7468 6520 6f62 6a65 6374  `` of the object
-00015180: 2074 6f20 7265 706c 6163 6520 696e 2074   to replace in t
-00015190: 6865 2044 422c 2066 6f72 2065 7861 6d70  he DB, for examp
-000151a0: 6c65 2060 606c 6174 6573 7460 602e 0a20  le ``latest``.. 
-000151b0: 2020 2020 2020 203a 7061 7261 6d20 7569         :param ui
-000151c0: 643a 2054 6865 2060 6075 6964 6060 206f  d: The ``uid`` o
-000151d0: 6620 7468 6520 6f62 6a65 6374 2074 6f20  f the object to 
-000151e0: 7265 706c 6163 6520 696e 2074 6865 2044  replace in the D
-000151f0: 422e 2049 6620 7573 696e 6720 7468 6973  B. If using this
-00015200: 2070 6172 616d 6574 6572 2c20 7468 6520   parameter, the 
-00015210: 6d6f 6469 6669 6564 206f 626a 6563 740a  modified object.
-00015220: 2020 2020 2020 2020 2020 2020 6d75 7374              must
-00015230: 2068 6176 6520 7468 6520 7361 6d65 2060   have the same `
-00015240: 6075 6964 6060 206f 6620 7468 6520 7072  `uid`` of the pr
-00015250: 6576 696f 7573 6c79 2d65 7869 7374 696e  eviously-existin
-00015260: 6720 6f62 6a65 6374 2e20 5468 6973 2063  g object. This c
-00015270: 616e 6e6f 7420 6265 2075 7365 6420 666f  annot be used fo
-00015280: 7220 6e6f 6e2d 7665 7273 696f 6e65 6420  r non-versioned 
-00015290: 6f62 6a65 6374 732e 0a20 2020 2020 2020  objects..       
-000152a0: 203a 7061 7261 6d20 7665 7273 696f 6e65   :param versione
-000152b0: 643a 2057 6865 7468 6572 2074 6f20 6d61  d: Whether to ma
-000152c0: 696e 7461 696e 2076 6572 7369 6f6e 7320  intain versions 
-000152d0: 666f 7220 7468 6973 2066 6561 7475 7265  for this feature
-000152e0: 2d76 6563 746f 722e 2041 6c6c 2076 6572  -vector. All ver
-000152f0: 7369 6f6e 7320 6f66 2061 2076 6572 7369  sions of a versi
-00015300: 6f6e 6564 206f 626a 6563 740a 2020 2020  oned object.    
-00015310: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-00015320: 6b65 7074 2069 6e20 7468 6520 4442 2061  kept in the DB a
-00015330: 6e64 2063 616e 2062 6520 7265 7472 6965  nd can be retrie
-00015340: 7665 6420 756e 7469 6c20 6578 706c 6963  ved until explic
-00015350: 6974 6c79 2064 656c 6574 6564 2e0a 2020  itly deleted..  
-00015360: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
-00015370: 5468 6520 3a70 793a 636c 6173 733a 607e  The :py:class:`~
-00015380: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
-00015390: 6f72 652e 4665 6174 7572 6556 6563 746f  ore.FeatureVecto
-000153a0: 7260 206f 626a 6563 7420 2861 7320 6469  r` object (as di
-000153b0: 6374 292e 0a20 2020 2020 2020 2022 2222  ct)..        """
-000153c0: 0a0a 2020 2020 2020 2020 7265 6665 7265  ..        refere
-000153d0: 6e63 6520 3d20 7365 6c66 2e5f 7265 736f  nce = self._reso
-000153e0: 6c76 655f 7265 6665 7265 6e63 6528 7461  lve_reference(ta
-000153f0: 672c 2075 6964 290a 2020 2020 2020 2020  g, uid).        
-00015400: 7061 7261 6d73 203d 207b 2276 6572 7369  params = {"versi
-00015410: 6f6e 6564 223a 2076 6572 7369 6f6e 6564  oned": versioned
-00015420: 7d0a 0a20 2020 2020 2020 2069 6620 6973  }..        if is
-00015430: 696e 7374 616e 6365 2866 6561 7475 7265  instance(feature
-00015440: 5f76 6563 746f 722c 206d 6c72 756e 2e63  _vector, mlrun.c
-00015450: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4665  ommon.schemas.Fe
-00015460: 6174 7572 6556 6563 746f 7229 3a0a 2020  atureVector):.  
-00015470: 2020 2020 2020 2020 2020 6665 6174 7572            featur
-00015480: 655f 7665 6374 6f72 203d 2066 6561 7475  e_vector = featu
-00015490: 7265 5f76 6563 746f 722e 6469 6374 2829  re_vector.dict()
-000154a0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-000154b0: 696e 7374 616e 6365 2866 6561 7475 7265  instance(feature
-000154c0: 5f76 6563 746f 722c 2046 6561 7475 7265  _vector, Feature
-000154d0: 5665 6374 6f72 293a 0a20 2020 2020 2020  Vector):.       
-000154e0: 2020 2020 2066 6561 7475 7265 5f76 6563       feature_vec
-000154f0: 746f 7220 3d20 6665 6174 7572 655f 7665  tor = feature_ve
-00015500: 6374 6f72 2e74 6f5f 6469 6374 2829 0a0a  ctor.to_dict()..
-00015510: 2020 2020 2020 2020 6e61 6d65 203d 206e          name = n
-00015520: 616d 6520 6f72 2066 6561 7475 7265 5f76  ame or feature_v
-00015530: 6563 746f 725b 226d 6574 6164 6174 6122  ector["metadata"
-00015540: 5d5b 226e 616d 6522 5d0a 2020 2020 2020  ]["name"].      
-00015550: 2020 7072 6f6a 6563 7420 3d20 280a 2020    project = (.  
-00015560: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
-00015570: 740a 2020 2020 2020 2020 2020 2020 6f72  t.            or
-00015580: 2066 6561 7475 7265 5f76 6563 746f 725b   feature_vector[
-00015590: 226d 6574 6164 6174 6122 5d2e 6765 7428  "metadata"].get(
-000155a0: 2270 726f 6a65 6374 2229 0a20 2020 2020  "project").     
-000155b0: 2020 2020 2020 206f 7220 636f 6e66 6967         or config
-000155c0: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
-000155d0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000155e0: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
-000155f0: 6563 7473 2f7b 7072 6f6a 6563 747d 2f66  ects/{project}/f
-00015600: 6561 7475 7265 2d76 6563 746f 7273 2f7b  eature-vectors/{
-00015610: 6e61 6d65 7d2f 7265 6665 7265 6e63 6573  name}/references
-00015620: 2f7b 7265 6665 7265 6e63 657d 220a 2020  /{reference}".  
-00015630: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-00015640: 6167 6520 3d20 6622 4661 696c 6564 2073  age = f"Failed s
-00015650: 746f 7269 6e67 2066 6561 7475 7265 2d76  toring feature-v
-00015660: 6563 746f 7220 7b70 726f 6a65 6374 7d2f  ector {project}/
-00015670: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-00015680: 7265 7370 203d 2073 656c 662e 6170 695f  resp = self.api_
-00015690: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-000156a0: 2020 2250 5554 222c 2070 6174 682c 2065    "PUT", path, e
-000156b0: 7272 6f72 5f6d 6573 7361 6765 2c20 7061  rror_message, pa
-000156c0: 7261 6d73 3d70 6172 616d 732c 2062 6f64  rams=params, bod
-000156d0: 793d 6469 6374 5f74 6f5f 6a73 6f6e 2866  y=dict_to_json(f
-000156e0: 6561 7475 7265 5f76 6563 746f 7229 0a20  eature_vector). 
-000156f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00015700: 2072 6574 7572 6e20 7265 7370 2e6a 736f   return resp.jso
-00015710: 6e28 290a 0a20 2020 2064 6566 2070 6174  n()..    def pat
-00015720: 6368 5f66 6561 7475 7265 5f76 6563 746f  ch_feature_vecto
-00015730: 7228 0a20 2020 2020 2020 2073 656c 662c  r(.        self,
-00015740: 0a20 2020 2020 2020 206e 616d 652c 0a20  .        name,. 
-00015750: 2020 2020 2020 2066 6561 7475 7265 5f76         feature_v
-00015760: 6563 746f 725f 7570 6461 7465 3a20 6469  ector_update: di
-00015770: 6374 2c0a 2020 2020 2020 2020 7072 6f6a  ct,.        proj
-00015780: 6563 743d 2222 2c0a 2020 2020 2020 2020  ect="",.        
-00015790: 7461 673d 4e6f 6e65 2c0a 2020 2020 2020  tag=None,.      
-000157a0: 2020 7569 643d 4e6f 6e65 2c0a 2020 2020    uid=None,.    
-000157b0: 2020 2020 7061 7463 685f 6d6f 6465 3a20      patch_mode: 
-000157c0: 556e 696f 6e5b 0a20 2020 2020 2020 2020  Union[.         
-000157d0: 2020 2073 7472 2c20 6d6c 7275 6e2e 636f     str, mlrun.co
-000157e0: 6d6d 6f6e 2e73 6368 656d 6173 2e50 6174  mmon.schemas.Pat
-000157f0: 6368 4d6f 6465 0a20 2020 2020 2020 205d  chMode.        ]
-00015800: 203d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e   = mlrun.common.
-00015810: 7363 6865 6d61 732e 5061 7463 684d 6f64  schemas.PatchMod
-00015820: 652e 7265 706c 6163 652c 0a20 2020 2029  e.replace,.    )
-00015830: 3a0a 2020 2020 2020 2020 2222 224d 6f64  :.        """Mod
-00015840: 6966 7920 2870 6174 6368 2920 616e 2065  ify (patch) an e
-00015850: 7869 7374 696e 6720 3a70 793a 636c 6173  xisting :py:clas
-00015860: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
-00015870: 655f 7374 6f72 652e 4665 6174 7572 6556  e_store.FeatureV
-00015880: 6563 746f 7260 206f 626a 6563 742e 0a20  ector` object.. 
-00015890: 2020 2020 2020 2054 6865 206f 626a 6563         The objec
-000158a0: 7420 6973 2069 6465 6e74 6966 6965 6420  t is identified 
-000158b0: 6279 2069 7473 206e 616d 6520 2861 6e64  by its name (and
-000158c0: 2070 726f 6a65 6374 2069 7420 6265 6c6f   project it belo
-000158d0: 6e67 7320 746f 292c 2061 7320 7765 6c6c  ngs to), as well
-000158e0: 2061 7320 6f70 7469 6f6e 616c 6c79 2061   as optionally a
-000158f0: 2060 6074 6167 6060 206f 7220 6974 730a   ``tag`` or its.
-00015900: 2020 2020 2020 2020 6060 7569 6460 6020          ``uid`` 
-00015910: 2866 6f72 2076 6572 7369 6f6e 6564 206f  (for versioned o
-00015920: 626a 6563 7429 2e20 4966 2062 6f74 6820  bject). If both 
-00015930: 6060 7461 6760 6020 616e 6420 6060 7569  ``tag`` and ``ui
-00015940: 6460 6020 6172 6520 6f6d 6974 7465 6420  d`` are omitted 
-00015950: 7468 656e 2074 6865 206f 626a 6563 7420  then the object 
-00015960: 7769 7468 2074 6167 2060 606c 6174 6573  with tag ``lates
-00015970: 7460 600a 2020 2020 2020 2020 6973 206d  t``.        is m
-00015980: 6f64 6966 6965 642e 0a0a 2020 2020 2020  odified...      
-00015990: 2020 3a70 6172 616d 206e 616d 653a 204e    :param name: N
-000159a0: 616d 6520 6f66 2074 6865 206f 626a 6563  ame of the objec
-000159b0: 7420 746f 2070 6174 6368 2e0a 2020 2020  t to patch..    
-000159c0: 2020 2020 3a70 6172 616d 2066 6561 7475      :param featu
-000159d0: 7265 5f76 6563 746f 725f 7570 6461 7465  re_vector_update
-000159e0: 3a20 5468 6520 6d6f 6469 6669 6361 7469  : The modificati
-000159f0: 6f6e 7320 6e65 6564 6564 2069 6e20 7468  ons needed in th
-00015a00: 6520 6f62 6a65 6374 2e20 5468 6973 2070  e object. This p
-00015a10: 6172 616d 6574 6572 206f 6e6c 7920 6861  arameter only ha
-00015a20: 7320 7468 6520 6368 616e 6765 7320 696e  s the changes in
-00015a30: 2069 742c 0a20 2020 2020 2020 2020 2020   it,.           
-00015a40: 206e 6f74 2061 2066 756c 6c20 6f62 6a65   not a full obje
-00015a50: 6374 2e0a 2020 2020 2020 2020 3a70 6172  ct..        :par
-00015a60: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-00015a70: 6563 7420 7768 6963 6820 636f 6e74 6169  ect which contai
-00015a80: 6e73 2074 6865 206d 6f64 6966 6965 6420  ns the modified 
-00015a90: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
-00015aa0: 3a70 6172 616d 2074 6167 3a20 5468 6520  :param tag: The 
-00015ab0: 7461 6720 6f66 2074 6865 206f 626a 6563  tag of the objec
-00015ac0: 7420 746f 206d 6f64 6966 792e 0a20 2020  t to modify..   
-00015ad0: 2020 2020 203a 7061 7261 6d20 7569 643a       :param uid:
-00015ae0: 2075 6964 206f 6620 7468 6520 6f62 6a65   uid of the obje
-00015af0: 6374 2074 6f20 6d6f 6469 6679 2e0a 2020  ct to modify..  
-00015b00: 2020 2020 2020 3a70 6172 616d 2070 6174        :param pat
-00015b10: 6368 5f6d 6f64 653a 2054 6865 2073 7472  ch_mode: The str
-00015b20: 6174 6567 7920 666f 7220 6d65 7267 696e  ategy for mergin
-00015b30: 6720 7468 6520 6368 616e 6765 7320 7769  g the changes wi
-00015b40: 7468 2074 6865 2065 7869 7374 696e 6720  th the existing 
-00015b50: 6f62 6a65 6374 2e20 4361 6e20 6265 2065  object. Can be e
-00015b60: 6974 6865 7220 6060 7265 706c 6163 6560  ither ``replace`
-00015b70: 600a 2020 2020 2020 2020 2020 2020 6f72  `.            or
-00015b80: 2060 6061 6464 6974 6976 6560 602e 0a20   ``additive``.. 
-00015b90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015ba0: 2020 2072 6566 6572 656e 6365 203d 2073     reference = s
-00015bb0: 656c 662e 5f72 6573 6f6c 7665 5f72 6566  elf._resolve_ref
-00015bc0: 6572 656e 6365 2874 6167 2c20 7569 6429  erence(tag, uid)
-00015bd0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00015be0: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-00015bf0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-00015c00: 6a65 6374 0a20 2020 2020 2020 2068 6561  ject.        hea
-00015c10: 6465 7273 203d 207b 6d6c 7275 6e2e 636f  ders = {mlrun.co
-00015c20: 6d6d 6f6e 2e73 6368 656d 6173 2e48 6561  mmon.schemas.Hea
-00015c30: 6465 724e 616d 6573 2e70 6174 6368 5f6d  derNames.patch_m
-00015c40: 6f64 653a 2070 6174 6368 5f6d 6f64 657d  ode: patch_mode}
-00015c50: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00015c60: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
-00015c70: 6563 747d 2f66 6561 7475 7265 2d76 6563  ect}/feature-vec
-00015c80: 746f 7273 2f7b 6e61 6d65 7d2f 7265 6665  tors/{name}/refe
-00015c90: 7265 6e63 6573 2f7b 7265 6665 7265 6e63  rences/{referenc
-00015ca0: 657d 220a 2020 2020 2020 2020 6572 726f  e}".        erro
-00015cb0: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
-00015cc0: 696c 6564 2075 7064 6174 696e 6720 6665  iled updating fe
-00015cd0: 6174 7572 652d 7665 6374 6f72 207b 7072  ature-vector {pr
-00015ce0: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
-00015cf0: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
-00015d00: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-00015d10: 2020 2250 4154 4348 222c 0a20 2020 2020    "PATCH",.     
-00015d20: 2020 2020 2020 2070 6174 682c 0a20 2020         path,.   
-00015d30: 2020 2020 2020 2020 2065 7272 6f72 5f6d           error_m
-00015d40: 6573 7361 6765 2c0a 2020 2020 2020 2020  essage,.        
-00015d50: 2020 2020 626f 6479 3d64 6963 745f 746f      body=dict_to
-00015d60: 5f6a 736f 6e28 6665 6174 7572 655f 7665  _json(feature_ve
-00015d70: 6374 6f72 5f75 7064 6174 6529 2c0a 2020  ctor_update),.  
-00015d80: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00015d90: 733d 6865 6164 6572 732c 0a20 2020 2020  s=headers,.     
-00015da0: 2020 2029 0a0a 2020 2020 6465 6620 6465     )..    def de
-00015db0: 6c65 7465 5f66 6561 7475 7265 5f76 6563  lete_feature_vec
-00015dc0: 746f 7228 7365 6c66 2c20 6e61 6d65 2c20  tor(self, name, 
-00015dd0: 7072 6f6a 6563 743d 2222 2c20 7461 673d  project="", tag=
-00015de0: 4e6f 6e65 2c20 7569 643d 4e6f 6e65 293a  None, uid=None):
-00015df0: 0a20 2020 2020 2020 2022 2222 4465 6c65  .        """Dele
-00015e00: 7465 2061 203a 7079 3a63 6c61 7373 3a60  te a :py:class:`
-00015e10: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
-00015e20: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
-00015e30: 6f72 6020 6f62 6a65 6374 2066 726f 6d20  or` object from 
-00015e40: 7468 6520 4442 2e0a 2020 2020 2020 2020  the DB..        
-00015e50: 4966 2060 6074 6167 6060 206f 7220 6060  If ``tag`` or ``
-00015e60: 7569 6460 6020 6172 6520 7370 6563 6966  uid`` are specif
-00015e70: 6965 642c 2074 6865 6e20 6a75 7374 2074  ied, then just t
-00015e80: 6865 2076 6572 7369 6f6e 2072 6566 6572  he version refer
-00015e90: 656e 6365 6420 6279 2074 6865 6d20 7769  enced by them wi
-00015ea0: 6c6c 2062 6520 6465 6c65 7465 642e 2055  ll be deleted. U
-00015eb0: 7369 6e67 2062 6f74 680a 2020 2020 2020  sing both.      
-00015ec0: 2020 6973 206e 6f74 2061 6c6c 6f77 6564    is not allowed
-00015ed0: 2e0a 2020 2020 2020 2020 4966 206e 6f6e  ..        If non
-00015ee0: 6520 6172 6520 7370 6563 6966 6965 642c  e are specified,
-00015ef0: 2074 6865 6e20 616c 6c20 696e 7374 616e   then all instan
-00015f00: 6365 7320 6f66 2074 6865 206f 626a 6563  ces of the objec
-00015f10: 7420 7768 6f73 6520 6e61 6d65 2069 7320  t whose name is 
-00015f20: 6060 6e61 6d65 6060 2077 696c 6c20 6265  ``name`` will be
-00015f30: 2064 656c 6574 6564 2e0a 2020 2020 2020   deleted..      
-00015f40: 2020 2222 220a 2020 2020 2020 2020 7072    """.        pr
-00015f50: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
-00015f60: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
-00015f70: 745f 7072 6f6a 6563 740a 2020 2020 2020  t_project.      
-00015f80: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
-00015f90: 6374 732f 7b70 726f 6a65 6374 7d2f 6665  cts/{project}/fe
-00015fa0: 6174 7572 652d 7665 6374 6f72 732f 7b6e  ature-vectors/{n
-00015fb0: 616d 657d 220a 2020 2020 2020 2020 6966  ame}".        if
-00015fc0: 2074 6167 206f 7220 7569 643a 0a20 2020   tag or uid:.   
-00015fd0: 2020 2020 2020 2020 2072 6566 6572 656e           referen
-00015fe0: 6365 203d 2073 656c 662e 5f72 6573 6f6c  ce = self._resol
-00015ff0: 7665 5f72 6566 6572 656e 6365 2874 6167  ve_reference(tag
-00016000: 2c20 7569 6429 0a20 2020 2020 2020 2020  , uid).         
-00016010: 2020 2070 6174 6820 3d20 7061 7468 202b     path = path +
-00016020: 2066 222f 7265 6665 7265 6e63 6573 2f7b   f"/references/{
-00016030: 7265 6665 7265 6e63 657d 220a 0a20 2020  reference}"..   
-00016040: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
-00016050: 6765 203d 2066 2246 6169 6c65 6420 6465  ge = f"Failed de
-00016060: 6c65 7469 6e67 2066 6561 7475 7265 2d76  leting feature-v
-00016070: 6563 746f 7220 7b6e 616d 657d 220a 2020  ector {name}".  
-00016080: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
-00016090: 616c 6c28 2244 454c 4554 4522 2c20 7061  all("DELETE", pa
-000160a0: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
-000160b0: 6529 0a0a 2020 2020 6465 6620 7461 675f  e)..    def tag_
-000160c0: 6f62 6a65 6374 7328 0a20 2020 2020 2020  objects(.       
-000160d0: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-000160e0: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
-000160f0: 2020 2020 2074 6167 5f6e 616d 653a 2073       tag_name: s
-00016100: 7472 2c0a 2020 2020 2020 2020 6f62 6a65  tr,.        obje
-00016110: 6374 733a 2055 6e69 6f6e 5b6d 6c72 756e  cts: Union[mlrun
-00016120: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00016130: 5461 674f 626a 6563 7473 2c20 6469 6374  TagObjects, dict
-00016140: 5d2c 0a20 2020 2020 2020 2072 6570 6c61  ],.        repla
-00016150: 6365 3a20 626f 6f6c 203d 2046 616c 7365  ce: bool = False
-00016160: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-00016170: 2022 2222 5461 6720 6120 6c69 7374 206f   """Tag a list o
-00016180: 6620 6f62 6a65 6374 732e 0a0a 2020 2020  f objects...    
-00016190: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-000161a0: 6374 3a20 5072 6f6a 6563 7420 7768 6963  ct: Project whic
-000161b0: 6820 636f 6e74 6169 6e73 2074 6865 206f  h contains the o
-000161c0: 626a 6563 7473 2e0a 2020 2020 2020 2020  bjects..        
-000161d0: 3a70 6172 616d 2074 6167 5f6e 616d 653a  :param tag_name:
-000161e0: 2054 6865 2074 6167 2074 6f20 7365 7420   The tag to set 
-000161f0: 6f6e 2074 6865 206f 626a 6563 7473 2e0a  on the objects..
-00016200: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-00016210: 626a 6563 7473 3a20 5468 6520 6f62 6a65  bjects: The obje
-00016220: 6374 7320 746f 2074 6167 2e0a 2020 2020  cts to tag..    
-00016230: 2020 2020 3a70 6172 616d 2072 6570 6c61      :param repla
-00016240: 6365 3a20 5768 6574 6865 7220 746f 2072  ce: Whether to r
-00016250: 6570 6c61 6365 2074 6865 2065 7869 7374  eplace the exist
-00016260: 696e 6720 7461 6773 206f 6620 7468 6520  ing tags of the 
-00016270: 6f62 6a65 6374 7320 6f72 2074 6f20 6164  objects or to ad
-00016280: 6420 7468 6520 6e65 7720 7461 6720 746f  d the new tag to
-00016290: 2074 6865 6d2e 0a20 2020 2020 2020 2022   them..        "
-000162a0: 2222 0a0a 2020 2020 2020 2020 7061 7468  ""..        path
-000162b0: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
-000162c0: 726f 6a65 6374 7d2f 7461 6773 2f7b 7461  roject}/tags/{ta
-000162d0: 675f 6e61 6d65 7d22 0a20 2020 2020 2020  g_name}".       
-000162e0: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-000162f0: 2066 2246 6169 6c65 6420 746f 2074 6167   f"Failed to tag
-00016300: 207b 7461 675f 6e61 6d65 7d20 6f6e 206f   {tag_name} on o
-00016310: 626a 6563 7473 207b 6f62 6a65 6374 737d  bjects {objects}
-00016320: 220a 2020 2020 2020 2020 6d65 7468 6f64  ".        method
-00016330: 203d 2022 504f 5354 2220 6966 2072 6570   = "POST" if rep
-00016340: 6c61 6365 2065 6c73 6520 2250 5554 220a  lace else "PUT".
-00016350: 2020 2020 2020 2020 7365 6c66 2e61 7069          self.api
-00016360: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-00016370: 2020 206d 6574 686f 642c 0a20 2020 2020     method,.     
-00016380: 2020 2020 2020 2070 6174 682c 0a20 2020         path,.   
-00016390: 2020 2020 2020 2020 2065 7272 6f72 5f6d           error_m
-000163a0: 6573 7361 6765 2c0a 2020 2020 2020 2020  essage,.        
-000163b0: 2020 2020 626f 6479 3d64 6963 745f 746f      body=dict_to
-000163c0: 5f6a 736f 6e28 0a20 2020 2020 2020 2020  _json(.         
-000163d0: 2020 2020 2020 206f 626a 6563 7473 2e64         objects.d
-000163e0: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
-000163f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00016400: 6e63 6528 6f62 6a65 6374 732c 206d 6c72  nce(objects, mlr
-00016410: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-00016420: 732e 5461 674f 626a 6563 7473 290a 2020  s.TagObjects).  
-00016430: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00016440: 7365 206f 626a 6563 7473 0a20 2020 2020  se objects.     
-00016450: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00016460: 2020 290a 0a20 2020 2064 6566 2064 656c    )..    def del
-00016470: 6574 655f 6f62 6a65 6374 735f 7461 6728  ete_objects_tag(
-00016480: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00016490: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
-000164a0: 7374 722c 0a20 2020 2020 2020 2074 6167  str,.        tag
-000164b0: 5f6e 616d 653a 2073 7472 2c0a 2020 2020  _name: str,.    
-000164c0: 2020 2020 7461 675f 6f62 6a65 6374 733a      tag_objects:
-000164d0: 2055 6e69 6f6e 5b6d 6c72 756e 2e63 6f6d   Union[mlrun.com
-000164e0: 6d6f 6e2e 7363 6865 6d61 732e 5461 674f  mon.schemas.TagO
-000164f0: 626a 6563 7473 2c20 6469 6374 5d2c 0a20  bjects, dict],. 
-00016500: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00016510: 2244 656c 6574 6520 6120 7461 6720 6672  "Delete a tag fr
-00016520: 6f6d 2061 206c 6973 7420 6f66 206f 626a  om a list of obj
-00016530: 6563 7473 2e0a 0a20 2020 2020 2020 203a  ects...        :
-00016540: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-00016550: 726f 6a65 6374 2077 6869 6368 2063 6f6e  roject which con
-00016560: 7461 696e 7320 7468 6520 6f62 6a65 6374  tains the object
-00016570: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-00016580: 6d20 7461 675f 6e61 6d65 3a20 5468 6520  m tag_name: The 
-00016590: 7461 6720 746f 2064 656c 6574 6520 6672  tag to delete fr
-000165a0: 6f6d 2074 6865 206f 626a 6563 7473 2e0a  om the objects..
-000165b0: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
-000165c0: 6167 5f6f 626a 6563 7473 3a20 5468 6520  ag_objects: The 
-000165d0: 6f62 6a65 6374 7320 746f 2064 656c 6574  objects to delet
-000165e0: 6520 7468 6520 7461 6720 6672 6f6d 2e0a  e the tag from..
-000165f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016600: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
-00016610: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
-00016620: 2f74 6167 732f 7b74 6167 5f6e 616d 657d  /tags/{tag_name}
-00016630: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
-00016640: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00016650: 6564 2064 656c 6574 696e 6720 7461 6720  ed deleting tag 
-00016660: 6672 6f6d 207b 7461 675f 6e61 6d65 7d22  from {tag_name}"
-00016670: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
-00016680: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
-00016690: 2020 2020 2244 454c 4554 4522 2c0a 2020      "DELETE",.  
-000166a0: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
-000166b0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-000166c0: 725f 6d65 7373 6167 652c 0a20 2020 2020  r_message,.     
-000166d0: 2020 2020 2020 2062 6f64 793d 6469 6374         body=dict
-000166e0: 5f74 6f5f 6a73 6f6e 280a 2020 2020 2020  _to_json(.      
-000166f0: 2020 2020 2020 2020 2020 7461 675f 6f62            tag_ob
-00016700: 6a65 6374 732e 6469 6374 2829 0a20 2020  jects.dict().   
-00016710: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00016720: 6973 696e 7374 616e 6365 2874 6167 5f6f  isinstance(tag_o
-00016730: 626a 6563 7473 2c20 6d6c 7275 6e2e 636f  bjects, mlrun.co
-00016740: 6d6d 6f6e 2e73 6368 656d 6173 2e54 6167  mmon.schemas.Tag
-00016750: 4f62 6a65 6374 7329 0a20 2020 2020 2020  Objects).       
-00016760: 2020 2020 2020 2020 2065 6c73 6520 7461           else ta
-00016770: 675f 6f62 6a65 6374 730a 2020 2020 2020  g_objects.      
-00016780: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-00016790: 2029 0a0a 2020 2020 6465 6620 7461 675f   )..    def tag_
-000167a0: 6172 7469 6661 6374 7328 0a20 2020 2020  artifacts(.     
-000167b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000167c0: 2061 7274 6966 6163 7473 3a20 556e 696f   artifacts: Unio
-000167d0: 6e5b 4c69 7374 5b41 7274 6966 6163 745d  n[List[Artifact]
-000167e0: 2c20 4c69 7374 5b64 6963 745d 2c20 4172  , List[dict], Ar
-000167f0: 7469 6661 6374 2c20 6469 6374 5d2c 0a20  tifact, dict],. 
-00016800: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
-00016810: 7374 722c 0a20 2020 2020 2020 2074 6167  str,.        tag
-00016820: 5f6e 616d 653a 2073 7472 2c0a 2020 2020  _name: str,.    
-00016830: 2020 2020 7265 706c 6163 653a 2062 6f6f      replace: boo
-00016840: 6c20 3d20 4661 6c73 652c 0a20 2020 2029  l = False,.    )
-00016850: 3a0a 2020 2020 2020 2020 2222 2254 6167  :.        """Tag
-00016860: 2061 206c 6973 7420 6f66 2061 7274 6966   a list of artif
-00016870: 6163 7473 2e0a 0a20 2020 2020 2020 203a  acts...        :
-00016880: 7061 7261 6d20 6172 7469 6661 6374 733a  param artifacts:
-00016890: 2054 6865 2061 7274 6966 6163 7473 2074   The artifacts t
-000168a0: 6f20 7461 672e 2043 616e 2062 6520 6120  o tag. Can be a 
-000168b0: 6c69 7374 206f 6620 3a70 793a 636c 6173  list of :py:clas
-000168c0: 733a 607e 6d6c 7275 6e2e 6172 7469 6661  s:`~mlrun.artifa
-000168d0: 6374 732e 4172 7469 6661 6374 6020 6f62  cts.Artifact` ob
-000168e0: 6a65 6374 7320 6f72 0a20 2020 2020 2020  jects or.       
-000168f0: 2020 2020 2064 6963 7469 6f6e 6172 6965       dictionarie
-00016900: 732c 206f 7220 6120 7369 6e67 6c65 206f  s, or a single o
-00016910: 626a 6563 742e 0a20 2020 2020 2020 203a  bject..        :
-00016920: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-00016930: 726f 6a65 6374 2077 6869 6368 2063 6f6e  roject which con
-00016940: 7461 696e 7320 7468 6520 6172 7469 6661  tains the artifa
-00016950: 6374 732e 0a20 2020 2020 2020 203a 7061  cts..        :pa
-00016960: 7261 6d20 7461 675f 6e61 6d65 3a20 5468  ram tag_name: Th
-00016970: 6520 7461 6720 746f 2073 6574 206f 6e20  e tag to set on 
-00016980: 7468 6520 6172 7469 6661 6374 732e 0a20  the artifacts.. 
-00016990: 2020 2020 2020 203a 7061 7261 6d20 7265         :param re
-000169a0: 706c 6163 653a 2049 6620 5472 7565 2c20  place: If True, 
-000169b0: 7265 706c 6163 6520 6578 6973 7469 6e67  replace existing
-000169c0: 2074 6167 732c 206f 7468 6572 7769 7365   tags, otherwise
-000169d0: 2061 7070 656e 6420 746f 2065 7869 7374   append to exist
-000169e0: 696e 6720 7461 6773 2e0a 2020 2020 2020  ing tags..      
-000169f0: 2020 2222 220a 2020 2020 2020 2020 7461    """.        ta
-00016a00: 675f 6f62 6a65 6374 7320 3d20 7365 6c66  g_objects = self
-00016a10: 2e5f 7265 736f 6c76 655f 6172 7469 6661  ._resolve_artifa
-00016a20: 6374 735f 746f 5f74 6167 5f6f 626a 6563  cts_to_tag_objec
-00016a30: 7473 2861 7274 6966 6163 7473 290a 2020  ts(artifacts).  
-00016a40: 2020 2020 2020 7365 6c66 2e74 6167 5f6f        self.tag_o
-00016a50: 626a 6563 7473 2870 726f 6a65 6374 2c20  bjects(project, 
-00016a60: 7461 675f 6e61 6d65 2c20 6f62 6a65 6374  tag_name, object
-00016a70: 733d 7461 675f 6f62 6a65 6374 732c 2072  s=tag_objects, r
-00016a80: 6570 6c61 6365 3d72 6570 6c61 6365 290a  eplace=replace).
-00016a90: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
-00016aa0: 6172 7469 6661 6374 735f 7461 6773 280a  artifacts_tags(.
-00016ab0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00016ac0: 2020 2020 2020 6172 7469 6661 6374 732c        artifacts,
-00016ad0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00016ae0: 3a20 7374 722c 0a20 2020 2020 2020 2074  : str,.        t
-00016af0: 6167 5f6e 616d 653a 2073 7472 2c0a 2020  ag_name: str,.  
-00016b00: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00016b10: 4465 6c65 7465 2074 6167 2066 726f 6d20  Delete tag from 
-00016b20: 6120 6c69 7374 206f 6620 6172 7469 6661  a list of artifa
-00016b30: 6374 732e 0a0a 2020 2020 2020 2020 3a70  cts...        :p
-00016b40: 6172 616d 2061 7274 6966 6163 7473 3a20  aram artifacts: 
-00016b50: 5468 6520 6172 7469 6661 6374 7320 746f  The artifacts to
-00016b60: 2064 656c 6574 6520 7468 6520 7461 6720   delete the tag 
-00016b70: 6672 6f6d 2e20 4361 6e20 6265 2061 206c  from. Can be a l
-00016b80: 6973 7420 6f66 203a 7079 3a63 6c61 7373  ist of :py:class
-00016b90: 3a60 7e6d 6c72 756e 2e61 7274 6966 6163  :`~mlrun.artifac
-00016ba0: 7473 2e41 7274 6966 6163 7460 0a20 2020  ts.Artifact`.   
-00016bb0: 2020 2020 2020 2020 206f 626a 6563 7473           objects
-00016bc0: 206f 7220 6469 6374 696f 6e61 7269 6573   or dictionaries
-00016bd0: 2c20 6f72 2061 2073 696e 676c 6520 6f62  , or a single ob
-00016be0: 6a65 6374 2e0a 2020 2020 2020 2020 3a70  ject..        :p
-00016bf0: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
-00016c00: 6f6a 6563 7420 7768 6963 6820 636f 6e74  oject which cont
-00016c10: 6169 6e73 2074 6865 2061 7274 6966 6163  ains the artifac
-00016c20: 7473 2e0a 2020 2020 2020 2020 3a70 6172  ts..        :par
-00016c30: 616d 2074 6167 5f6e 616d 653a 2054 6865  am tag_name: The
-00016c40: 2074 6167 2074 6f20 7365 7420 6f6e 2074   tag to set on t
-00016c50: 6865 2061 7274 6966 6163 7473 2e0a 2020  he artifacts..  
-00016c60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016c70: 2020 7461 675f 6f62 6a65 6374 7320 3d20    tag_objects = 
-00016c80: 7365 6c66 2e5f 7265 736f 6c76 655f 6172  self._resolve_ar
-00016c90: 7469 6661 6374 735f 746f 5f74 6167 5f6f  tifacts_to_tag_o
-00016ca0: 626a 6563 7473 2861 7274 6966 6163 7473  bjects(artifacts
-00016cb0: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
-00016cc0: 656c 6574 655f 6f62 6a65 6374 735f 7461  elete_objects_ta
-00016cd0: 6728 7072 6f6a 6563 742c 2074 6167 5f6e  g(project, tag_n
-00016ce0: 616d 652c 2074 6167 5f6f 626a 6563 7473  ame, tag_objects
-00016cf0: 290a 0a20 2020 2064 6566 206c 6973 745f  )..    def list_
-00016d00: 7072 6f6a 6563 7473 280a 2020 2020 2020  projects(.      
-00016d10: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00016d20: 6f77 6e65 723a 2073 7472 203d 204e 6f6e  owner: str = Non
-00016d30: 652c 0a20 2020 2020 2020 2066 6f72 6d61  e,.        forma
-00016d40: 745f 3a20 556e 696f 6e5b 0a20 2020 2020  t_: Union[.     
-00016d50: 2020 2020 2020 2073 7472 2c20 6d6c 7275         str, mlru
-00016d60: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00016d70: 2e50 726f 6a65 6374 7346 6f72 6d61 740a  .ProjectsFormat.
-00016d80: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
-00016d90: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00016da0: 2e50 726f 6a65 6374 7346 6f72 6d61 742e  .ProjectsFormat.
-00016db0: 6675 6c6c 2c0a 2020 2020 2020 2020 6c61  full,.        la
-00016dc0: 6265 6c73 3a20 4c69 7374 5b73 7472 5d20  bels: List[str] 
-00016dd0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00016de0: 7374 6174 653a 2055 6e69 6f6e 5b73 7472  state: Union[str
-00016df0: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
-00016e00: 6368 656d 6173 2e50 726f 6a65 6374 5374  chemas.ProjectSt
-00016e10: 6174 655d 203d 204e 6f6e 652c 0a20 2020  ate] = None,.   
-00016e20: 2029 202d 3e20 4c69 7374 5b55 6e69 6f6e   ) -> List[Union
-00016e30: 5b6d 6c72 756e 2e70 726f 6a65 6374 732e  [mlrun.projects.
-00016e40: 4d6c 7275 6e50 726f 6a65 6374 2c20 7374  MlrunProject, st
-00016e50: 725d 5d3a 0a20 2020 2020 2020 2022 2222  r]]:.        """
-00016e60: 5265 7475 726e 2061 206c 6973 7420 6f66  Return a list of
-00016e70: 2074 6865 2065 7869 7374 696e 6720 7072   the existing pr
-00016e80: 6f6a 6563 7473 2c20 706f 7465 6e74 6961  ojects, potentia
-00016e90: 6c6c 7920 6669 6c74 6572 6564 2062 7920  lly filtered by 
-00016ea0: 7370 6563 6966 6963 2063 7269 7465 7269  specific criteri
-00016eb0: 612e 0a0a 2020 2020 2020 2020 3a70 6172  a...        :par
-00016ec0: 616d 206f 776e 6572 3a20 4c69 7374 206f  am owner: List o
-00016ed0: 6e6c 7920 7072 6f6a 6563 7473 2062 656c  nly projects bel
-00016ee0: 6f6e 6769 6e67 2074 6f20 7468 6973 2073  onging to this s
-00016ef0: 7065 6369 6669 6320 6f77 6e65 722e 0a20  pecific owner.. 
-00016f00: 2020 2020 2020 203a 7061 7261 6d20 666f         :param fo
-00016f10: 726d 6174 5f3a 2046 6f72 6d61 7420 6f66  rmat_: Format of
-00016f20: 2074 6865 2072 6573 756c 7473 2e20 506f   the results. Po
-00016f30: 7373 6962 6c65 2076 616c 7565 7320 6172  ssible values ar
-00016f40: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-00016f50: 2d20 6060 6675 6c6c 6060 2028 6465 6661  - ``full`` (defa
-00016f60: 756c 7420 7661 6c75 6529 202d 2052 6574  ult value) - Ret
-00016f70: 7572 6e20 6675 6c6c 2070 726f 6a65 6374  urn full project
-00016f80: 206f 626a 6563 7473 2e0a 2020 2020 2020   objects..      
-00016f90: 2020 2020 2020 2d20 6060 6d69 6e69 6d61        - ``minima
-00016fa0: 6c60 6020 2d20 5265 7475 726e 206d 696e  l`` - Return min
-00016fb0: 696d 616c 2070 726f 6a65 6374 206f 626a  imal project obj
-00016fc0: 6563 7473 2028 6d69 6e69 6d69 7a61 7469  ects (minimizati
-00016fd0: 6f6e 2068 6170 7065 6e73 2069 6e20 7468  on happens in th
-00016fe0: 6520 4245 292e 0a20 2020 2020 2020 2020  e BE)..         
-00016ff0: 2020 202d 2060 606e 616d 655f 6f6e 6c79     - ``name_only
-00017000: 6060 202d 2052 6574 7572 6e20 6a75 7374  `` - Return just
-00017010: 2074 6865 206e 616d 6573 206f 6620 7468   the names of th
-00017020: 6520 7072 6f6a 6563 7473 2e0a 0a20 2020  e projects...   
-00017030: 2020 2020 203a 7061 7261 6d20 6c61 6265       :param labe
-00017040: 6c73 3a20 4669 6c74 6572 2062 7920 6c61  ls: Filter by la
-00017050: 6265 6c73 2061 7474 6163 6865 6420 746f  bels attached to
-00017060: 2074 6865 2070 726f 6a65 6374 2e0a 2020   the project..  
-00017070: 2020 2020 2020 3a70 6172 616d 2073 7461        :param sta
-00017080: 7465 3a20 4669 6c74 6572 2062 7920 7072  te: Filter by pr
-00017090: 6f6a 6563 7427 7320 7374 6174 652e 2043  oject's state. C
-000170a0: 616e 2062 6520 6569 7468 6572 2060 606f  an be either ``o
-000170b0: 6e6c 696e 6560 6020 6f72 2060 6061 7263  nline`` or ``arc
-000170c0: 6869 7665 6460 602e 0a20 2020 2020 2020  hived``..       
-000170d0: 2022 2222 0a0a 2020 2020 2020 2020 7061   """..        pa
-000170e0: 7261 6d73 203d 207b 0a20 2020 2020 2020  rams = {.       
-000170f0: 2020 2020 2022 6f77 6e65 7222 3a20 6f77       "owner": ow
-00017100: 6e65 722c 0a20 2020 2020 2020 2020 2020  ner,.           
-00017110: 2022 7374 6174 6522 3a20 7374 6174 652c   "state": state,
-00017120: 0a20 2020 2020 2020 2020 2020 2022 666f  .            "fo
-00017130: 726d 6174 223a 2066 6f72 6d61 745f 2c0a  rmat": format_,.
-00017140: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
-00017150: 656c 223a 206c 6162 656c 7320 6f72 205b  el": labels or [
-00017160: 5d2c 0a20 2020 2020 2020 207d 0a0a 2020  ],.        }..  
-00017170: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-00017180: 6167 6520 3d20 6622 4661 696c 6564 206c  age = f"Failed l
-00017190: 6973 7469 6e67 2070 726f 6a65 6374 732c  isting projects,
-000171a0: 2071 7565 7279 3a20 7b70 6172 616d 737d   query: {params}
-000171b0: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
-000171c0: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
-000171d0: 6c6c 2822 4745 5422 2c20 2270 726f 6a65  ll("GET", "proje
-000171e0: 6374 7322 2c20 6572 726f 725f 6d65 7373  cts", error_mess
-000171f0: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
-00017200: 6d73 290a 2020 2020 2020 2020 6966 2066  ms).        if f
-00017210: 6f72 6d61 745f 203d 3d20 6d6c 7275 6e2e  ormat_ == mlrun.
-00017220: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e50  common.schemas.P
-00017230: 726f 6a65 6374 7346 6f72 6d61 742e 6e61  rojectsFormat.na
-00017240: 6d65 5f6f 6e6c 793a 0a0a 2020 2020 2020  me_only:..      
-00017250: 2020 2020 2020 2320 7072 6f6a 6563 7473        # projects
-00017260: 2069 7320 6a75 7374 2061 206c 6973 7420   is just a list 
-00017270: 6f66 2073 7472 696e 6773 0a20 2020 2020  of strings.     
-00017280: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00017290: 7370 6f6e 7365 2e6a 736f 6e28 295b 2270  sponse.json()["p
-000172a0: 726f 6a65 6374 7322 5d0a 0a20 2020 2020  rojects"]..     
-000172b0: 2020 2023 2066 6f72 7761 7264 7320 636f     # forwards co
-000172c0: 6d70 6174 6962 696c 6974 7920 2d20 7765  mpatibility - we
-000172d0: 2077 616e 7420 746f 2062 6520 6162 6c65   want to be able
-000172e0: 2074 6f20 6861 6e64 6c65 206e 6577 2066   to handle new f
-000172f0: 6f72 6d61 7473 2074 6861 7420 6d69 6768  ormats that migh
-00017300: 7420 6265 2061 6464 6564 2069 6e20 7468  t be added in th
-00017310: 6520 6675 7475 7265 0a20 2020 2020 2020  e future.       
-00017320: 2023 2069 6620 666f 726d 6174 2069 7320   # if format is 
-00017330: 6e6f 7420 6b6e 6f77 6e20 746f 2074 6865  not known to the
-00017340: 2061 7069 2c20 6974 2069 7320 7570 2074   api, it is up t
-00017350: 6f20 7468 6520 7365 7276 6572 2074 6f20  o the server to 
-00017360: 7265 7475 726e 2065 6974 6865 7220 616e  return either an
-00017370: 2065 7272 6f72 206f 7220 6120 6465 6661   error or a defa
-00017380: 756c 7420 666f 726d 6174 0a20 2020 2020  ult format.     
-00017390: 2020 2072 6574 7572 6e20 5b0a 2020 2020     return [.    
-000173a0: 2020 2020 2020 2020 6d6c 7275 6e2e 7072          mlrun.pr
-000173b0: 6f6a 6563 7473 2e4d 6c72 756e 5072 6f6a  ojects.MlrunProj
-000173c0: 6563 742e 6672 6f6d 5f64 6963 7428 7072  ect.from_dict(pr
-000173d0: 6f6a 6563 745f 6469 6374 290a 2020 2020  oject_dict).    
-000173e0: 2020 2020 2020 2020 666f 7220 7072 6f6a          for proj
-000173f0: 6563 745f 6469 6374 2069 6e20 7265 7370  ect_dict in resp
-00017400: 6f6e 7365 2e6a 736f 6e28 295b 2270 726f  onse.json()["pro
-00017410: 6a65 6374 7322 5d0a 2020 2020 2020 2020  jects"].        
-00017420: 5d0a 0a20 2020 2064 6566 2067 6574 5f70  ]..    def get_p
-00017430: 726f 6a65 6374 2873 656c 662c 206e 616d  roject(self, nam
-00017440: 653a 2073 7472 2920 2d3e 206d 6c72 756e  e: str) -> mlrun
-00017450: 2e70 726f 6a65 6374 732e 4d6c 7275 6e50  .projects.MlrunP
-00017460: 726f 6a65 6374 3a0a 2020 2020 2020 2020  roject:.        
-00017470: 2222 2247 6574 2064 6574 6169 6c73 2066  """Get details f
-00017480: 6f72 2061 2073 7065 6369 6669 6320 7072  or a specific pr
-00017490: 6f6a 6563 742e 2222 220a 0a20 2020 2020  oject."""..     
-000174a0: 2020 2069 6620 6e6f 7420 6e61 6d65 3a0a     if not name:.
-000174b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000174c0: 6520 4d4c 5275 6e49 6e76 616c 6964 4172  e MLRunInvalidAr
-000174d0: 6775 6d65 6e74 4572 726f 7228 224e 616d  gumentError("Nam
-000174e0: 6520 6d75 7374 2062 6520 7072 6f76 6964  e must be provid
-000174f0: 6564 2229 0a0a 2020 2020 2020 2020 7061  ed")..        pa
-00017500: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-00017510: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-00017520: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-00017530: 6622 4661 696c 6564 2072 6574 7269 6576  f"Failed retriev
-00017540: 696e 6720 7072 6f6a 6563 7420 7b6e 616d  ing project {nam
-00017550: 657d 220a 2020 2020 2020 2020 7265 7370  e}".        resp
-00017560: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
-00017570: 6361 6c6c 2822 4745 5422 2c20 7061 7468  call("GET", path
-00017580: 2c20 6572 726f 725f 6d65 7373 6167 6529  , error_message)
-00017590: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000175a0: 6d6c 7275 6e2e 7072 6f6a 6563 7473 2e4d  mlrun.projects.M
-000175b0: 6c72 756e 5072 6f6a 6563 742e 6672 6f6d  lrunProject.from
-000175c0: 5f64 6963 7428 7265 7370 6f6e 7365 2e6a  _dict(response.j
-000175d0: 736f 6e28 2929 0a0a 2020 2020 6465 6620  son())..    def 
-000175e0: 6465 6c65 7465 5f70 726f 6a65 6374 280a  delete_project(.
-000175f0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00017600: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
-00017610: 0a20 2020 2020 2020 2064 656c 6574 696f  .        deletio
-00017620: 6e5f 7374 7261 7465 6779 3a20 556e 696f  n_strategy: Unio
-00017630: 6e5b 0a20 2020 2020 2020 2020 2020 2073  n[.            s
-00017640: 7472 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  tr, mlrun.common
-00017650: 2e73 6368 656d 6173 2e44 656c 6574 696f  .schemas.Deletio
-00017660: 6e53 7472 6174 6567 790a 2020 2020 2020  nStrategy.      
-00017670: 2020 5d20 3d20 6d6c 7275 6e2e 636f 6d6d    ] = mlrun.comm
-00017680: 6f6e 2e73 6368 656d 6173 2e44 656c 6574  on.schemas.Delet
-00017690: 696f 6e53 7472 6174 6567 792e 6465 6661  ionStrategy.defa
-000176a0: 756c 7428 292c 0a20 2020 2029 3a0a 2020  ult(),.    ):.  
-000176b0: 2020 2020 2020 2222 2244 656c 6574 6520        """Delete 
-000176c0: 6120 7072 6f6a 6563 742e 0a0a 2020 2020  a project...    
-000176d0: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
-000176e0: 204e 616d 6520 6f66 2074 6865 2070 726f   Name of the pro
-000176f0: 6a65 6374 2074 6f20 6465 6c65 7465 2e0a  ject to delete..
-00017700: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
-00017710: 656c 6574 696f 6e5f 7374 7261 7465 6779  eletion_strategy
-00017720: 3a20 486f 7720 746f 2074 7265 6174 2063  : How to treat c
-00017730: 6869 6c64 206f 626a 6563 7473 206f 6620  hild objects of 
-00017740: 7468 6520 7072 6f6a 6563 742e 2050 6f73  the project. Pos
-00017750: 7369 626c 6520 7661 6c75 6573 2061 7265  sible values are
-00017760: 3a0a 0a20 2020 2020 2020 2020 2020 202d  :..            -
-00017770: 2060 6072 6573 7472 6963 7460 6020 2864   ``restrict`` (d
-00017780: 6566 6175 6c74 2920 2d20 5072 6f6a 6563  efault) - Projec
-00017790: 7420 6d75 7374 206e 6f74 2068 6176 6520  t must not have 
-000177a0: 616e 7920 6368 696c 6420 6f62 6a65 6374  any child object
-000177b0: 7320 7768 656e 2064 656c 6574 6564 2e20  s when deleted. 
-000177c0: 4966 2075 7369 6e67 2074 6869 7320 6d6f  If using this mo
-000177d0: 6465 2077 6869 6c65 0a20 2020 2020 2020  de while.       
-000177e0: 2020 2020 2020 2063 6869 6c64 206f 626a         child obj
-000177f0: 6563 7473 2065 7869 7374 2c20 7468 6520  ects exist, the 
-00017800: 6f70 6572 6174 696f 6e20 7769 6c6c 2066  operation will f
-00017810: 6169 6c2e 0a20 2020 2020 2020 2020 2020  ail..           
-00017820: 202d 2060 6063 6173 6361 6465 6060 202d   - ``cascade`` -
-00017830: 2041 7574 6f6d 6174 6963 616c 6c79 2064   Automatically d
-00017840: 656c 6574 6520 616c 6c20 6368 696c 6420  elete all child 
-00017850: 6f62 6a65 6374 7320 7768 656e 2064 656c  objects when del
-00017860: 6574 696e 6720 7468 6520 7072 6f6a 6563  eting the projec
-00017870: 742e 0a20 2020 2020 2020 2022 2222 0a0a  t..        """..
-00017880: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-00017890: 2270 726f 6a65 6374 732f 7b6e 616d 657d  "projects/{name}
-000178a0: 220a 2020 2020 2020 2020 6865 6164 6572  ".        header
-000178b0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-000178c0: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
-000178d0: 6368 656d 6173 2e48 6561 6465 724e 616d  chemas.HeaderNam
-000178e0: 6573 2e64 656c 6574 696f 6e5f 7374 7261  es.deletion_stra
-000178f0: 7465 6779 3a20 6465 6c65 7469 6f6e 5f73  tegy: deletion_s
-00017900: 7472 6174 6567 790a 2020 2020 2020 2020  trategy.        
-00017910: 7d0a 2020 2020 2020 2020 6572 726f 725f  }.        error_
-00017920: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00017930: 6564 2064 656c 6574 696e 6720 7072 6f6a  ed deleting proj
-00017940: 6563 7420 7b6e 616d 657d 220a 2020 2020  ect {name}".    
-00017950: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
-00017960: 656c 662e 6170 695f 6361 6c6c 2822 4445  elf.api_call("DE
-00017970: 4c45 5445 222c 2070 6174 682c 2065 7272  LETE", path, err
-00017980: 6f72 5f6d 6573 7361 6765 2c20 6865 6164  or_message, head
-00017990: 6572 733d 6865 6164 6572 7329 0a20 2020  ers=headers).   
-000179a0: 2020 2020 2069 6620 7265 7370 6f6e 7365       if response
-000179b0: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-000179c0: 6874 7470 2e48 5454 5053 7461 7475 732e  http.HTTPStatus.
-000179d0: 4143 4345 5054 4544 3a0a 2020 2020 2020  ACCEPTED:.      
-000179e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000179f0: 662e 5f77 6169 745f 666f 725f 7072 6f6a  f._wait_for_proj
-00017a00: 6563 745f 746f 5f62 655f 6465 6c65 7465  ect_to_be_delete
-00017a10: 6428 6e61 6d65 290a 0a20 2020 2064 6566  d(name)..    def
-00017a20: 2073 746f 7265 5f70 726f 6a65 6374 280a   store_project(.
-00017a30: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00017a40: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
-00017a50: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00017a60: 3a20 556e 696f 6e5b 6469 6374 2c20 6d6c  : Union[dict, ml
-00017a70: 7275 6e2e 7072 6f6a 6563 7473 2e4d 6c72  run.projects.Mlr
-00017a80: 756e 5072 6f6a 6563 742c 206d 6c72 756e  unProject, mlrun
-00017a90: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00017aa0: 5072 6f6a 6563 745d 2c0a 2020 2020 2920  Project],.    ) 
-00017ab0: 2d3e 206d 6c72 756e 2e70 726f 6a65 6374  -> mlrun.project
-00017ac0: 732e 4d6c 7275 6e50 726f 6a65 6374 3a0a  s.MlrunProject:.
-00017ad0: 2020 2020 2020 2020 2222 2253 746f 7265          """Store
-00017ae0: 2061 2070 726f 6a65 6374 2069 6e20 7468   a project in th
-00017af0: 6520 4442 2e20 5468 6973 206f 7065 7261  e DB. This opera
-00017b00: 7469 6f6e 2077 696c 6c20 6f76 6572 7772  tion will overwr
-00017b10: 6974 6520 6578 6973 7469 6e67 2070 726f  ite existing pro
-00017b20: 6a65 6374 206f 6620 7468 6520 7361 6d65  ject of the same
-00017b30: 206e 616d 6520 6966 2065 7869 7374 732e   name if exists.
-00017b40: 2222 220a 0a20 2020 2020 2020 2070 6174  """..        pat
-00017b50: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-00017b60: 6e61 6d65 7d22 0a20 2020 2020 2020 2065  name}".        e
-00017b70: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
-00017b80: 2246 6169 6c65 6420 7374 6f72 696e 6720  "Failed storing 
-00017b90: 7072 6f6a 6563 7420 7b6e 616d 657d 220a  project {name}".
-00017ba0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00017bb0: 7461 6e63 6528 7072 6f6a 6563 742c 206d  tance(project, m
-00017bc0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-00017bd0: 6d61 732e 5072 6f6a 6563 7429 3a0a 2020  mas.Project):.  
-00017be0: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
-00017bf0: 7420 3d20 7072 6f6a 6563 742e 6469 6374  t = project.dict
-00017c00: 2829 0a20 2020 2020 2020 2065 6c69 6620  ().        elif 
-00017c10: 6973 696e 7374 616e 6365 2870 726f 6a65  isinstance(proje
-00017c20: 6374 2c20 6d6c 7275 6e2e 7072 6f6a 6563  ct, mlrun.projec
-00017c30: 7473 2e4d 6c72 756e 5072 6f6a 6563 7429  ts.MlrunProject)
-00017c40: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00017c50: 6f6a 6563 7420 3d20 7072 6f6a 6563 742e  oject = project.
-00017c60: 746f 5f64 6963 7428 290a 2020 2020 2020  to_dict().      
-00017c70: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
-00017c80: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-00017c90: 2020 2020 2020 2020 2250 5554 222c 0a20          "PUT",. 
-00017ca0: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-00017cb0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-00017cc0: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
-00017cd0: 2020 2020 2020 2020 626f 6479 3d64 6963          body=dic
-00017ce0: 745f 746f 5f6a 736f 6e28 7072 6f6a 6563  t_to_json(projec
-00017cf0: 7429 2c0a 2020 2020 2020 2020 290a 2020  t),.        ).  
-00017d00: 2020 2020 2020 6966 2072 6573 706f 6e73        if respons
-00017d10: 652e 7374 6174 7573 5f63 6f64 6520 3d3d  e.status_code ==
-00017d20: 2068 7474 702e 4854 5450 5374 6174 7573   http.HTTPStatus
-00017d30: 2e41 4343 4550 5445 443a 0a20 2020 2020  .ACCEPTED:.     
-00017d40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00017d50: 6c66 2e5f 7761 6974 5f66 6f72 5f70 726f  lf._wait_for_pro
-00017d60: 6a65 6374 5f74 6f5f 7265 6163 685f 7465  ject_to_reach_te
-00017d70: 726d 696e 616c 5f73 7461 7465 286e 616d  rminal_state(nam
-00017d80: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00017d90: 6e20 6d6c 7275 6e2e 7072 6f6a 6563 7473  n mlrun.projects
-00017da0: 2e4d 6c72 756e 5072 6f6a 6563 742e 6672  .MlrunProject.fr
-00017db0: 6f6d 5f64 6963 7428 7265 7370 6f6e 7365  om_dict(response
-00017dc0: 2e6a 736f 6e28 2929 0a0a 2020 2020 6465  .json())..    de
-00017dd0: 6620 7061 7463 685f 7072 6f6a 6563 7428  f patch_project(
-00017de0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00017df0: 2020 2020 2020 206e 616d 653a 2073 7472         name: str
-00017e00: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-00017e10: 743a 2064 6963 742c 0a20 2020 2020 2020  t: dict,.       
-00017e20: 2070 6174 6368 5f6d 6f64 653a 2055 6e69   patch_mode: Uni
-00017e30: 6f6e 5b0a 2020 2020 2020 2020 2020 2020  on[.            
-00017e40: 7374 722c 206d 6c72 756e 2e63 6f6d 6d6f  str, mlrun.commo
-00017e50: 6e2e 7363 6865 6d61 732e 5061 7463 684d  n.schemas.PatchM
-00017e60: 6f64 650a 2020 2020 2020 2020 5d20 3d20  ode.        ] = 
-00017e70: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00017e80: 656d 6173 2e50 6174 6368 4d6f 6465 2e72  emas.PatchMode.r
-00017e90: 6570 6c61 6365 2c0a 2020 2020 2920 2d3e  eplace,.    ) ->
-00017ea0: 206d 6c72 756e 2e70 726f 6a65 6374 732e   mlrun.projects.
-00017eb0: 4d6c 7275 6e50 726f 6a65 6374 3a0a 2020  MlrunProject:.  
-00017ec0: 2020 2020 2020 2222 2250 6174 6368 2061        """Patch a
-00017ed0: 6e20 6578 6973 7469 6e67 2070 726f 6a65  n existing proje
-00017ee0: 6374 206f 626a 6563 742e 0a0a 2020 2020  ct object...    
-00017ef0: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
-00017f00: 204e 616d 6520 6f66 2070 726f 6a65 6374   Name of project
-00017f10: 2074 6f20 7061 7463 682e 0a20 2020 2020   to patch..     
-00017f20: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00017f30: 743a 2054 6865 2061 6374 7561 6c20 6368  t: The actual ch
-00017f40: 616e 6765 7320 746f 2074 6865 2070 726f  anges to the pro
-00017f50: 6a65 6374 206f 626a 6563 742e 0a20 2020  ject object..   
-00017f60: 2020 2020 203a 7061 7261 6d20 7061 7463       :param patc
-00017f70: 685f 6d6f 6465 3a20 5468 6520 7374 7261  h_mode: The stra
-00017f80: 7465 6779 2066 6f72 206d 6572 6769 6e67  tegy for merging
-00017f90: 2074 6865 2063 6861 6e67 6573 2077 6974   the changes wit
-00017fa0: 6820 7468 6520 6578 6973 7469 6e67 206f  h the existing o
-00017fb0: 626a 6563 742e 2043 616e 2062 6520 6569  bject. Can be ei
-00017fc0: 7468 6572 2060 6072 6570 6c61 6365 6060  ther ``replace``
-00017fd0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-00017fe0: 6060 6164 6469 7469 7665 6060 2e0a 2020  ``additive``..  
-00017ff0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00018000: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
-00018010: 6563 7473 2f7b 6e61 6d65 7d22 0a20 2020  ects/{name}".   
-00018020: 2020 2020 2068 6561 6465 7273 203d 207b       headers = {
-00018030: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00018040: 656d 6173 2e48 6561 6465 724e 616d 6573  emas.HeaderNames
-00018050: 2e70 6174 6368 5f6d 6f64 653a 2070 6174  .patch_mode: pat
-00018060: 6368 5f6d 6f64 657d 0a20 2020 2020 2020  ch_mode}.       
-00018070: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-00018080: 2066 2246 6169 6c65 6420 7061 7463 6869   f"Failed patchi
-00018090: 6e67 2070 726f 6a65 6374 207b 6e61 6d65  ng project {name
-000180a0: 7d22 0a20 2020 2020 2020 2072 6573 706f  }".        respo
-000180b0: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
-000180c0: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
-000180d0: 2022 5041 5443 4822 2c20 7061 7468 2c20   "PATCH", path, 
-000180e0: 6572 726f 725f 6d65 7373 6167 652c 2062  error_message, b
-000180f0: 6f64 793d 6469 6374 5f74 6f5f 6a73 6f6e  ody=dict_to_json
-00018100: 2870 726f 6a65 6374 292c 2068 6561 6465  (project), heade
-00018110: 7273 3d68 6561 6465 7273 0a20 2020 2020  rs=headers.     
-00018120: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
-00018130: 7572 6e20 6d6c 7275 6e2e 7072 6f6a 6563  urn mlrun.projec
-00018140: 7473 2e4d 6c72 756e 5072 6f6a 6563 742e  ts.MlrunProject.
-00018150: 6672 6f6d 5f64 6963 7428 7265 7370 6f6e  from_dict(respon
-00018160: 7365 2e6a 736f 6e28 2929 0a0a 2020 2020  se.json())..    
-00018170: 6465 6620 6372 6561 7465 5f70 726f 6a65  def create_proje
-00018180: 6374 280a 2020 2020 2020 2020 7365 6c66  ct(.        self
-00018190: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-000181a0: 743a 2055 6e69 6f6e 5b64 6963 742c 206d  t: Union[dict, m
-000181b0: 6c72 756e 2e70 726f 6a65 6374 732e 4d6c  lrun.projects.Ml
-000181c0: 7275 6e50 726f 6a65 6374 2c20 6d6c 7275  runProject, mlru
-000181d0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-000181e0: 2e50 726f 6a65 6374 5d2c 0a20 2020 2029  .Project],.    )
-000181f0: 202d 3e20 6d6c 7275 6e2e 7072 6f6a 6563   -> mlrun.projec
-00018200: 7473 2e4d 6c72 756e 5072 6f6a 6563 743a  ts.MlrunProject:
-00018210: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
-00018220: 7465 2061 206e 6577 2070 726f 6a65 6374  te a new project
-00018230: 2e20 4120 7072 6f6a 6563 7420 7769 7468  . A project with
-00018240: 2074 6865 2073 616d 6520 6e61 6d65 206d   the same name m
-00018250: 7573 7420 6e6f 7420 6578 6973 7420 7072  ust not exist pr
-00018260: 696f 7220 746f 2063 7265 6174 696f 6e2e  ior to creation.
-00018270: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-00018280: 6973 696e 7374 616e 6365 2870 726f 6a65  isinstance(proje
-00018290: 6374 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  ct, mlrun.common
-000182a0: 2e73 6368 656d 6173 2e50 726f 6a65 6374  .schemas.Project
-000182b0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-000182c0: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
-000182d0: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
-000182e0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-000182f0: 7072 6f6a 6563 742c 206d 6c72 756e 2e70  project, mlrun.p
-00018300: 726f 6a65 6374 732e 4d6c 7275 6e50 726f  rojects.MlrunPro
-00018310: 6a65 6374 293a 0a20 2020 2020 2020 2020  ject):.         
-00018320: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
-00018330: 6a65 6374 2e74 6f5f 6469 6374 2829 0a20  ject.to_dict(). 
-00018340: 2020 2020 2020 2070 726f 6a65 6374 5f6e         project_n
-00018350: 616d 6520 3d20 7072 6f6a 6563 745b 226d  ame = project["m
-00018360: 6574 6164 6174 6122 5d5b 226e 616d 6522  etadata"]["name"
-00018370: 5d0a 2020 2020 2020 2020 6572 726f 725f  ].        error_
-00018380: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00018390: 6564 2063 7265 6174 696e 6720 7072 6f6a  ed creating proj
-000183a0: 6563 7420 7b70 726f 6a65 6374 5f6e 616d  ect {project_nam
-000183b0: 657d 220a 2020 2020 2020 2020 7265 7370  e}".        resp
-000183c0: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
-000183d0: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-000183e0: 2020 2250 4f53 5422 2c0a 2020 2020 2020    "POST",.      
-000183f0: 2020 2020 2020 2270 726f 6a65 6374 7322        "projects"
-00018400: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
-00018410: 726f 725f 6d65 7373 6167 652c 0a20 2020  ror_message,.   
-00018420: 2020 2020 2020 2020 2062 6f64 793d 6469           body=di
-00018430: 6374 5f74 6f5f 6a73 6f6e 2870 726f 6a65  ct_to_json(proje
-00018440: 6374 292c 0a20 2020 2020 2020 2029 0a20  ct),.        ). 
-00018450: 2020 2020 2020 2069 6620 7265 7370 6f6e         if respon
-00018460: 7365 2e73 7461 7475 735f 636f 6465 203d  se.status_code =
-00018470: 3d20 6874 7470 2e48 5454 5053 7461 7475  = http.HTTPStatu
-00018480: 732e 4143 4345 5054 4544 3a0a 2020 2020  s.ACCEPTED:.    
-00018490: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000184a0: 656c 662e 5f77 6169 745f 666f 725f 7072  elf._wait_for_pr
-000184b0: 6f6a 6563 745f 746f 5f72 6561 6368 5f74  oject_to_reach_t
-000184c0: 6572 6d69 6e61 6c5f 7374 6174 6528 7072  erminal_state(pr
-000184d0: 6f6a 6563 745f 6e61 6d65 290a 2020 2020  oject_name).    
-000184e0: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
-000184f0: 2e70 726f 6a65 6374 732e 4d6c 7275 6e50  .projects.MlrunP
-00018500: 726f 6a65 6374 2e66 726f 6d5f 6469 6374  roject.from_dict
-00018510: 2872 6573 706f 6e73 652e 6a73 6f6e 2829  (response.json()
-00018520: 290a 0a20 2020 2064 6566 205f 7761 6974  )..    def _wait
-00018530: 5f66 6f72 5f70 726f 6a65 6374 5f74 6f5f  _for_project_to_
-00018540: 7265 6163 685f 7465 726d 696e 616c 5f73  reach_terminal_s
-00018550: 7461 7465 280a 2020 2020 2020 2020 7365  tate(.        se
-00018560: 6c66 2c20 7072 6f6a 6563 745f 6e61 6d65  lf, project_name
-00018570: 3a20 7374 720a 2020 2020 2920 2d3e 206d  : str.    ) -> m
-00018580: 6c72 756e 2e70 726f 6a65 6374 732e 4d6c  lrun.projects.Ml
-00018590: 7275 6e50 726f 6a65 6374 3a0a 2020 2020  runProject:.    
-000185a0: 2020 2020 6465 6620 5f76 6572 6966 795f      def _verify_
-000185b0: 7072 6f6a 6563 745f 696e 5f74 6572 6d69  project_in_termi
-000185c0: 6e61 6c5f 7374 6174 6528 293a 0a20 2020  nal_state():.   
-000185d0: 2020 2020 2020 2020 2070 726f 6a65 6374           project
-000185e0: 203d 2073 656c 662e 6765 745f 7072 6f6a   = self.get_proj
-000185f0: 6563 7428 7072 6f6a 6563 745f 6e61 6d65  ect(project_name
-00018600: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00018610: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00018620: 2020 2070 726f 6a65 6374 2e73 7461 7475     project.statu
-00018630: 732e 7374 6174 650a 2020 2020 2020 2020  s.state.        
-00018640: 2020 2020 2020 2020 6e6f 7420 696e 206d          not in m
-00018650: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-00018660: 6d61 732e 5072 6f6a 6563 7453 7461 7465  mas.ProjectState
-00018670: 2e74 6572 6d69 6e61 6c5f 7374 6174 6573  .terminal_states
-00018680: 2829 0a20 2020 2020 2020 2020 2020 2029  ().            )
-00018690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000186a0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-000186b0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-000186c0: 2020 2020 2020 2066 2250 726f 6a65 6374         f"Project
-000186d0: 206e 6f74 2069 6e20 7465 726d 696e 616c   not in terminal
-000186e0: 2073 7461 7465 2e20 5374 6174 653a 207b   state. State: {
-000186f0: 7072 6f6a 6563 742e 7374 6174 7573 2e73  project.status.s
-00018700: 7461 7465 7d22 0a20 2020 2020 2020 2020  tate}".         
-00018710: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00018720: 2020 2020 2072 6574 7572 6e20 7072 6f6a       return proj
-00018730: 6563 740a 0a20 2020 2020 2020 2072 6574  ect..        ret
-00018740: 7572 6e20 6d6c 7275 6e2e 7574 696c 732e  urn mlrun.utils.
-00018750: 6865 6c70 6572 732e 7265 7472 795f 756e  helpers.retry_un
-00018760: 7469 6c5f 7375 6363 6573 7366 756c 280a  til_successful(.
-00018770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018780: 2e5f 7761 6974 5f66 6f72 5f70 726f 6a65  ._wait_for_proje
-00018790: 6374 5f74 6572 6d69 6e61 6c5f 7374 6174  ct_terminal_stat
-000187a0: 655f 7265 7472 795f 696e 7465 7276 616c  e_retry_interval
-000187b0: 2c0a 2020 2020 2020 2020 2020 2020 3132  ,.            12
-000187c0: 302c 0a20 2020 2020 2020 2020 2020 206c  0,.            l
-000187d0: 6f67 6765 722c 0a20 2020 2020 2020 2020  ogger,.         
-000187e0: 2020 2046 616c 7365 2c0a 2020 2020 2020     False,.      
-000187f0: 2020 2020 2020 5f76 6572 6966 795f 7072        _verify_pr
-00018800: 6f6a 6563 745f 696e 5f74 6572 6d69 6e61  oject_in_termina
-00018810: 6c5f 7374 6174 652c 0a20 2020 2020 2020  l_state,.       
-00018820: 2029 0a0a 2020 2020 6465 6620 5f77 6169   )..    def _wai
-00018830: 745f 666f 725f 6261 636b 6772 6f75 6e64  t_for_background
-00018840: 5f74 6173 6b5f 746f 5f72 6561 6368 5f74  _task_to_reach_t
-00018850: 6572 6d69 6e61 6c5f 7374 6174 6528 0a20  erminal_state(. 
-00018860: 2020 2020 2020 2073 656c 662c 206e 616d         self, nam
-00018870: 653a 2073 7472 0a20 2020 2029 202d 3e20  e: str.    ) -> 
-00018880: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00018890: 656d 6173 2e42 6163 6b67 726f 756e 6454  emas.BackgroundT
-000188a0: 6173 6b3a 0a20 2020 2020 2020 2064 6566  ask:.        def
-000188b0: 205f 7665 7269 6679 5f62 6163 6b67 726f   _verify_backgro
-000188c0: 756e 645f 7461 736b 5f69 6e5f 7465 726d  und_task_in_term
-000188d0: 696e 616c 5f73 7461 7465 2829 3a0a 2020  inal_state():.  
-000188e0: 2020 2020 2020 2020 2020 6261 636b 6772            backgr
-000188f0: 6f75 6e64 5f74 6173 6b20 3d20 7365 6c66  ound_task = self
-00018900: 2e67 6574 5f62 6163 6b67 726f 756e 645f  .get_background_
-00018910: 7461 736b 286e 616d 6529 0a20 2020 2020  task(name).     
-00018920: 2020 2020 2020 2073 7461 7465 203d 2062         state = b
-00018930: 6163 6b67 726f 756e 645f 7461 736b 2e73  ackground_task.s
-00018940: 7461 7475 732e 7374 6174 650a 2020 2020  tatus.state.    
-00018950: 2020 2020 2020 2020 6966 2073 7461 7465          if state
-00018960: 206e 6f74 2069 6e20 6d6c 7275 6e2e 636f   not in mlrun.co
-00018970: 6d6d 6f6e 2e73 6368 656d 6173 2e42 6163  mmon.schemas.Bac
-00018980: 6b67 726f 756e 6454 6173 6b53 7461 7465  kgroundTaskState
-00018990: 2e74 6572 6d69 6e61 6c5f 7374 6174 6573  .terminal_states
-000189a0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000189b0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-000189c0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-000189d0: 2020 2020 2020 2020 2066 2242 6163 6b67           f"Backg
-000189e0: 726f 756e 6420 7461 736b 206e 6f74 2069  round task not i
-000189f0: 6e20 7465 726d 696e 616c 2073 7461 7465  n terminal state
-00018a00: 2e20 6e61 6d65 3d7b 6e61 6d65 7d2c 2073  . name={name}, s
-00018a10: 7461 7465 3d7b 7374 6174 657d 220a 2020  tate={state}".  
-00018a20: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00018a30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00018a40: 726e 2062 6163 6b67 726f 756e 645f 7461  rn background_ta
-00018a50: 736b 0a0a 2020 2020 2020 2020 7265 7475  sk..        retu
-00018a60: 726e 206d 6c72 756e 2e75 7469 6c73 2e68  rn mlrun.utils.h
-00018a70: 656c 7065 7273 2e72 6574 7279 5f75 6e74  elpers.retry_unt
-00018a80: 696c 5f73 7563 6365 7373 6675 6c28 0a20  il_successful(. 
-00018a90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00018aa0: 5f77 6169 745f 666f 725f 6261 636b 6772  _wait_for_backgr
-00018ab0: 6f75 6e64 5f74 6173 6b5f 7465 726d 696e  ound_task_termin
-00018ac0: 616c 5f73 7461 7465 5f72 6574 7279 5f69  al_state_retry_i
-00018ad0: 6e74 6572 7661 6c2c 0a20 2020 2020 2020  nterval,.       
-00018ae0: 2020 2020 2036 3020 2a20 3630 2c0a 2020       60 * 60,.  
-00018af0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00018b00: 2c0a 2020 2020 2020 2020 2020 2020 4661  ,.            Fa
-00018b10: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00018b20: 205f 7665 7269 6679 5f62 6163 6b67 726f   _verify_backgro
-00018b30: 756e 645f 7461 736b 5f69 6e5f 7465 726d  und_task_in_term
-00018b40: 696e 616c 5f73 7461 7465 2c0a 2020 2020  inal_state,.    
-00018b50: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-00018b60: 7761 6974 5f66 6f72 5f70 726f 6a65 6374  wait_for_project
-00018b70: 5f74 6f5f 6265 5f64 656c 6574 6564 2873  _to_be_deleted(s
-00018b80: 656c 662c 2070 726f 6a65 6374 5f6e 616d  elf, project_nam
-00018b90: 653a 2073 7472 293a 0a20 2020 2020 2020  e: str):.       
-00018ba0: 2064 6566 205f 7665 7269 6679 5f70 726f   def _verify_pro
-00018bb0: 6a65 6374 5f64 656c 6574 6564 2829 3a0a  ject_deleted():.
-00018bc0: 2020 2020 2020 2020 2020 2020 7072 6f6a              proj
-00018bd0: 6563 7473 203d 2073 656c 662e 6c69 7374  ects = self.list
-00018be0: 5f70 726f 6a65 6374 7328 0a20 2020 2020  _projects(.     
-00018bf0: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
-00018c00: 745f 3d6d 6c72 756e 2e63 6f6d 6d6f 6e2e  t_=mlrun.common.
-00018c10: 7363 6865 6d61 732e 5072 6f6a 6563 7473  schemas.Projects
-00018c20: 466f 726d 6174 2e6e 616d 655f 6f6e 6c79  Format.name_only
-00018c30: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00018c40: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-00018c50: 6f6a 6563 745f 6e61 6d65 2069 6e20 7072  oject_name in pr
-00018c60: 6f6a 6563 7473 3a0a 2020 2020 2020 2020  ojects:.        
-00018c70: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00018c80: 6365 7074 696f 6e28 6622 5072 6f6a 6563  ception(f"Projec
-00018c90: 7420 7b70 726f 6a65 6374 5f6e 616d 657d  t {project_name}
-00018ca0: 2073 7469 6c6c 2065 7869 7374 7322 290a   still exists").
-00018cb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00018cc0: 6d6c 7275 6e2e 7574 696c 732e 6865 6c70  mlrun.utils.help
-00018cd0: 6572 732e 7265 7472 795f 756e 7469 6c5f  ers.retry_until_
-00018ce0: 7375 6363 6573 7366 756c 280a 2020 2020  successful(.    
-00018cf0: 2020 2020 2020 2020 7365 6c66 2e5f 7761          self._wa
-00018d00: 6974 5f66 6f72 5f70 726f 6a65 6374 5f64  it_for_project_d
-00018d10: 656c 6574 696f 6e5f 696e 7465 7276 616c  eletion_interval
-00018d20: 2c0a 2020 2020 2020 2020 2020 2020 3132  ,.            12
-00018d30: 302c 0a20 2020 2020 2020 2020 2020 206c  0,.            l
-00018d40: 6f67 6765 722c 0a20 2020 2020 2020 2020  ogger,.         
-00018d50: 2020 2046 616c 7365 2c0a 2020 2020 2020     False,.      
-00018d60: 2020 2020 2020 5f76 6572 6966 795f 7072        _verify_pr
-00018d70: 6f6a 6563 745f 6465 6c65 7465 642c 0a20  oject_deleted,. 
-00018d80: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00018d90: 6620 6372 6561 7465 5f70 726f 6a65 6374  f create_project
-00018da0: 5f73 6563 7265 7473 280a 2020 2020 2020  _secrets(.      
-00018db0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00018dc0: 7072 6f6a 6563 743a 2073 7472 2c0a 2020  project: str,.  
-00018dd0: 2020 2020 2020 7072 6f76 6964 6572 3a20        provider: 
-00018de0: 556e 696f 6e5b 0a20 2020 2020 2020 2020  Union[.         
-00018df0: 2020 2073 7472 2c20 6d6c 7275 6e2e 636f     str, mlrun.co
-00018e00: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6563  mmon.schemas.Sec
-00018e10: 7265 7450 726f 7669 6465 724e 616d 650a  retProviderName.
-00018e20: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
-00018e30: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00018e40: 2e53 6563 7265 7450 726f 7669 6465 724e  .SecretProviderN
-00018e50: 616d 652e 6b75 6265 726e 6574 6573 2c0a  ame.kubernetes,.
-00018e60: 2020 2020 2020 2020 7365 6372 6574 733a          secrets:
-00018e70: 2064 6963 7420 3d20 4e6f 6e65 2c0a 2020   dict = None,.  
-00018e80: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00018e90: 4372 6561 7465 2070 726f 6a65 6374 2d63  Create project-c
-00018ea0: 6f6e 7465 7874 2073 6563 7265 7473 2075  ontext secrets u
-00018eb0: 7369 6e67 2065 6974 6865 7220 6060 7661  sing either ``va
-00018ec0: 756c 7460 6020 6f72 2060 606b 7562 6572  ult`` or ``kuber
-00018ed0: 6e65 7465 7360 6020 7072 6f76 6964 6572  netes`` provider
-00018ee0: 2e0a 2020 2020 2020 2020 5768 656e 2075  ..        When u
-00018ef0: 7369 6e67 2077 6974 6820 5661 756c 742c  sing with Vault,
-00018f00: 2074 6869 7320 7769 6c6c 2063 7265 6174   this will creat
-00018f10: 6520 6e65 6564 6564 2056 6175 6c74 2073  e needed Vault s
-00018f20: 7472 7563 7475 7265 7320 666f 7220 7374  tructures for st
-00018f30: 6f72 696e 6720 7365 6372 6574 7320 696e  oring secrets in
-00018f40: 2070 726f 6a65 6374 2d63 6f6e 7465 7874   project-context
-00018f50: 2c20 616e 640a 2020 2020 2020 2020 7374  , and.        st
-00018f60: 6f72 6520 6120 7365 7420 6f66 2073 6563  ore a set of sec
-00018f70: 7265 7420 7661 6c75 6573 2e20 5468 6520  ret values. The 
-00018f80: 6d65 7468 6f64 2067 656e 6572 6174 6573  method generates
-00018f90: 204b 7562 6572 6e65 7465 7320 7365 7276   Kubernetes serv
-00018fa0: 6963 652d 6163 636f 756e 7420 616e 6420  ice-account and 
-00018fb0: 7468 6520 5661 756c 7420 6175 7468 656e  the Vault authen
-00018fc0: 7469 6361 7469 6f6e 0a20 2020 2020 2020  tication.       
-00018fd0: 2073 7472 7563 7475 7265 7320 7468 6174   structures that
-00018fe0: 2061 7265 2072 6571 7569 7265 6420 666f   are required fo
-00018ff0: 7220 6675 6e63 7469 6f6e 2050 6f64 7320  r function Pods 
-00019000: 746f 2061 7574 6865 6e74 6963 6174 6520  to authenticate 
-00019010: 7769 7468 2056 6175 6c74 2061 6e64 2062  with Vault and b
-00019020: 6520 6162 6c65 2074 6f20 6578 7472 6163  e able to extrac
-00019030: 7420 7365 6372 6574 2076 616c 7565 730a  t secret values.
-00019040: 2020 2020 2020 2020 7061 7373 6564 2061          passed a
-00019050: 7320 7061 7274 206f 6620 7468 6569 7220  s part of their 
-00019060: 636f 6e74 6578 742e 0a0a 2020 2020 2020  context...      
-00019070: 2020 4e6f 7465 3a0a 2020 2020 2020 2020    Note:.        
-00019080: 2020 2020 2020 2020 5468 6973 206d 6574          This met
-00019090: 686f 6420 7573 6564 2077 6974 6820 5661  hod used with Va
-000190a0: 756c 7420 6973 2063 7572 7265 6e74 6c79  ult is currently
-000190b0: 2069 6e20 7465 6368 6e69 6361 6c20 7072   in technical pr
-000190c0: 6576 6965 772c 2061 6e64 2072 6571 7569  eview, and requi
-000190d0: 7265 7320 6120 4861 7368 6943 6f72 7020  res a HashiCorp 
-000190e0: 5661 756c 740a 2020 2020 2020 2020 2020  Vault.          
-000190f0: 2020 2020 2020 696e 6672 6173 7472 7563        infrastruc
-00019100: 7475 7265 2070 726f 7065 726c 7920 7365  ture properly se
-00019110: 7420 7570 2061 6e64 2063 6f6e 6e65 6374  t up and connect
-00019120: 6564 2074 6f20 7468 6520 4d4c 5275 6e20  ed to the MLRun 
-00019130: 4150 4920 7365 7276 6572 2e0a 0a20 2020  API server...   
-00019140: 2020 2020 2057 6865 6e20 7573 6564 2077       When used w
-00019150: 6974 6820 4b75 6265 726e 6574 6573 2c20  ith Kubernetes, 
-00019160: 7468 6973 2077 696c 6c20 6d61 6b65 2073  this will make s
-00019170: 7572 6520 7468 6174 2074 6865 2070 726f  ure that the pro
-00019180: 6a65 6374 2d73 7065 6369 6669 6320 6b38  ject-specific k8
-00019190: 7320 7365 6372 6574 2069 7320 6372 6561  s secret is crea
-000191a0: 7465 642c 2061 6e64 2077 696c 6c0a 2020  ted, and will.  
-000191b0: 2020 2020 2020 706f 7075 6c61 7465 2069        populate i
-000191c0: 7420 7769 7468 2074 6865 2073 6563 7265  t with the secre
-000191d0: 7473 2070 726f 7669 6465 642c 2072 6570  ts provided, rep
-000191e0: 6c61 6369 6e67 2074 6865 6972 2076 616c  lacing their val
-000191f0: 7565 7320 6966 2074 6865 7920 6578 6973  ues if they exis
-00019200: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
-00019210: 616d 2070 726f 6a65 6374 3a20 5468 6520  am project: The 
-00019220: 7072 6f6a 6563 7420 636f 6e74 6578 7420  project context 
-00019230: 666f 7220 7768 6963 6820 746f 2067 656e  for which to gen
-00019240: 6572 6174 6520 7468 6520 696e 6672 6120  erate the infra 
-00019250: 616e 6420 7374 6f72 6520 7365 6372 6574  and store secret
-00019260: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-00019270: 6d20 7072 6f76 6964 6572 3a20 5468 6520  m provider: The 
-00019280: 6e61 6d65 206f 6620 7468 6520 7365 6372  name of the secr
-00019290: 6574 732d 7072 6f76 6964 6572 2074 6f20  ets-provider to 
-000192a0: 776f 726b 2077 6974 682e 2041 6363 6570  work with. Accep
-000192b0: 7473 2061 0a20 2020 2020 2020 2020 2020  ts a.           
-000192c0: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
-000192d0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-000192e0: 732e 7365 6372 6574 2e53 6563 7265 7450  s.secret.SecretP
-000192f0: 726f 7669 6465 724e 616d 6560 2065 6e75  roviderName` enu
-00019300: 6d2e 0a20 2020 2020 2020 203a 7061 7261  m..        :para
-00019310: 6d20 7365 6372 6574 733a 2041 2073 6574  m secrets: A set
-00019320: 206f 6620 7365 6372 6574 2076 616c 7565   of secret value
-00019330: 7320 746f 2073 746f 7265 2e0a 2020 2020  s to store..    
-00019340: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
-00019350: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-00019360: 2020 2073 6563 7265 7473 203d 207b 2770     secrets = {'p
-00019370: 6173 7377 6f72 6427 3a20 276d 7950 6173  assword': 'myPas
-00019380: 7377 3072 6427 2c20 2761 7773 5f6b 6579  sw0rd', 'aws_key
-00019390: 273a 2027 3131 3132 3232 3333 3327 7d0a  ': '111222333'}.
-000193a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193b0: 6462 2e63 7265 6174 655f 7072 6f6a 6563  db.create_projec
-000193c0: 745f 7365 6372 6574 7328 0a20 2020 2020  t_secrets(.     
-000193d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000193e0: 7072 6f6a 6563 7431 222c 0a20 2020 2020  project1",.     
-000193f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00019400: 726f 7669 6465 723d 6d6c 7275 6e2e 636f  rovider=mlrun.co
-00019410: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6563  mmon.schemas.Sec
-00019420: 7265 7450 726f 7669 6465 724e 616d 652e  retProviderName.
-00019430: 6b75 6265 726e 6574 6573 2c0a 2020 2020  kubernetes,.    
-00019440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019450: 7365 6372 6574 733d 7365 6372 6574 730a  secrets=secrets.
-00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019470: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
-00019480: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
-00019490: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
-000194a0: 7d2f 7365 6372 6574 7322 0a20 2020 2020  }/secrets".     
-000194b0: 2020 2073 6563 7265 7473 5f69 6e70 7574     secrets_input
-000194c0: 203d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e   = mlrun.common.
-000194d0: 7363 6865 6d61 732e 5365 6372 6574 7344  schemas.SecretsD
-000194e0: 6174 6128 0a20 2020 2020 2020 2020 2020  ata(.           
-000194f0: 2073 6563 7265 7473 3d73 6563 7265 7473   secrets=secrets
-00019500: 2c20 7072 6f76 6964 6572 3d70 726f 7669  , provider=provi
-00019510: 6465 720a 2020 2020 2020 2020 290a 2020  der.        ).  
-00019520: 2020 2020 2020 626f 6479 203d 2073 6563        body = sec
-00019530: 7265 7473 5f69 6e70 7574 2e64 6963 7428  rets_input.dict(
-00019540: 290a 2020 2020 2020 2020 6572 726f 725f  ).        error_
-00019550: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00019560: 6564 2063 7265 6174 696e 6720 7365 6372  ed creating secr
-00019570: 6574 2070 726f 7669 6465 7220 7b70 726f  et provider {pro
-00019580: 6a65 6374 7d2f 7b70 726f 7669 6465 727d  ject}/{provider}
-00019590: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
-000195a0: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
-000195b0: 2020 2020 2022 504f 5354 222c 0a20 2020       "POST",.   
-000195c0: 2020 2020 2020 2020 2070 6174 682c 0a20           path,. 
-000195d0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-000195e0: 5f6d 6573 7361 6765 2c0a 2020 2020 2020  _message,.      
-000195f0: 2020 2020 2020 626f 6479 3d64 6963 745f        body=dict_
-00019600: 746f 5f6a 736f 6e28 626f 6479 292c 0a20  to_json(body),. 
-00019610: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00019620: 6620 6c69 7374 5f70 726f 6a65 6374 5f73  f list_project_s
-00019630: 6563 7265 7473 280a 2020 2020 2020 2020  ecrets(.        
-00019640: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
-00019650: 6f6a 6563 743a 2073 7472 2c0a 2020 2020  oject: str,.    
-00019660: 2020 2020 746f 6b65 6e3a 2073 7472 203d      token: str =
-00019670: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
-00019680: 726f 7669 6465 723a 2055 6e69 6f6e 5b0a  rovider: Union[.
-00019690: 2020 2020 2020 2020 2020 2020 7374 722c              str,
-000196a0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-000196b0: 6865 6d61 732e 5365 6372 6574 5072 6f76  hemas.SecretProv
-000196c0: 6964 6572 4e61 6d65 0a20 2020 2020 2020  iderName.       
-000196d0: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
-000196e0: 6e2e 7363 6865 6d61 732e 5365 6372 6574  n.schemas.Secret
-000196f0: 5072 6f76 6964 6572 4e61 6d65 2e6b 7562  ProviderName.kub
-00019700: 6572 6e65 7465 732c 0a20 2020 2020 2020  ernetes,.       
-00019710: 2073 6563 7265 7473 3a20 4c69 7374 5b73   secrets: List[s
-00019720: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-00019730: 2920 2d3e 206d 6c72 756e 2e63 6f6d 6d6f  ) -> mlrun.commo
-00019740: 6e2e 7363 6865 6d61 732e 5365 6372 6574  n.schemas.Secret
-00019750: 7344 6174 613a 0a20 2020 2020 2020 2022  sData:.        "
-00019760: 2222 5265 7472 6965 7665 2070 726f 6a65  ""Retrieve proje
-00019770: 6374 2d63 6f6e 7465 7874 2073 6563 7265  ct-context secre
-00019780: 7473 2066 726f 6d20 5661 756c 742e 0a0a  ts from Vault...
-00019790: 2020 2020 2020 2020 4e6f 7465 3a0a 2020          Note:.  
-000197a0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-000197b0: 6973 206d 6574 686f 6420 666f 7220 5661  is method for Va
-000197c0: 756c 7420 6675 6e63 7469 6f6e 616c 6974  ult functionalit
-000197d0: 7920 6973 2063 7572 7265 6e74 6c79 2069  y is currently i
-000197e0: 6e20 7465 6368 6e69 6361 6c20 7072 6576  n technical prev
-000197f0: 6965 772c 2061 6e64 2072 6571 7569 7265  iew, and require
-00019800: 7320 6120 4861 7368 6943 6f72 7020 5661  s a HashiCorp Va
-00019810: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
-00019820: 2020 2020 696e 6672 6173 7472 7563 7475      infrastructu
-00019830: 7265 2070 726f 7065 726c 7920 7365 7420  re properly set 
-00019840: 7570 2061 6e64 2063 6f6e 6e65 6374 6564  up and connected
-00019850: 2074 6f20 7468 6520 4d4c 5275 6e20 4150   to the MLRun AP
-00019860: 4920 7365 7276 6572 2e0a 0a20 2020 2020  I server...     
-00019870: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00019880: 743a 2054 6865 2070 726f 6a65 6374 206e  t: The project n
-00019890: 616d 652e 0a20 2020 2020 2020 203a 7061  ame..        :pa
-000198a0: 7261 6d20 746f 6b65 6e3a 2056 6175 6c74  ram token: Vault
-000198b0: 2074 6f6b 656e 2074 6f20 7573 6520 666f   token to use fo
-000198c0: 7220 7265 7472 6965 7669 6e67 2073 6563  r retrieving sec
-000198d0: 7265 7473 2e0a 2020 2020 2020 2020 2020  rets..          
-000198e0: 2020 4d75 7374 2062 6520 6120 7661 6c69    Must be a vali
-000198f0: 6420 5661 756c 7420 746f 6b65 6e2c 2077  d Vault token, w
-00019900: 6974 6820 7065 726d 6973 7369 6f6e 7320  ith permissions 
-00019910: 746f 2072 6574 7269 6576 6520 7365 6372  to retrieve secr
-00019920: 6574 7320 6f66 2074 6865 2070 726f 6a65  ets of the proje
-00019930: 6374 2069 6e20 7175 6573 7469 6f6e 2e0a  ct in question..
-00019940: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00019950: 726f 7669 6465 723a 2054 6865 206e 616d  rovider: The nam
-00019960: 6520 6f66 2074 6865 2073 6563 7265 7473  e of the secrets
-00019970: 2d70 726f 7669 6465 7220 746f 2077 6f72  -provider to wor
-00019980: 6b20 7769 7468 2e20 4375 7272 656e 746c  k with. Currentl
-00019990: 7920 6f6e 6c79 2060 6076 6175 6c74 6060  y only ``vault``
-000199a0: 2069 7320 6163 6365 7074 6564 2e0a 2020   is accepted..  
-000199b0: 2020 2020 2020 3a70 6172 616d 2073 6563        :param sec
-000199c0: 7265 7473 3a20 4120 6c69 7374 206f 6620  rets: A list of 
-000199d0: 7365 6372 6574 206e 616d 6573 2074 6f20  secret names to 
-000199e0: 7265 7472 6965 7665 2e20 416e 2065 6d70  retrieve. An emp
-000199f0: 7479 206c 6973 7420 6060 5b5d 6060 2077  ty list ``[]`` w
-00019a00: 696c 6c20 7265 7472 6965 7665 2061 6c6c  ill retrieve all
-00019a10: 2073 6563 7265 7473 2061 7373 6967 6e65   secrets assigne
-00019a20: 640a 2020 2020 2020 2020 2020 2020 746f  d.            to
-00019a30: 2074 6869 7320 7370 6563 6966 6963 2070   this specific p
-00019a40: 726f 6a65 6374 2e20 6060 6b75 6265 726e  roject. ``kubern
-00019a50: 6574 6573 6060 2070 726f 7669 6465 7220  etes`` provider 
-00019a60: 6f6e 6c79 2073 7570 706f 7274 7320 616e  only supports an
-00019a70: 2065 6d70 7479 206c 6973 742e 0a20 2020   empty list..   
-00019a80: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00019a90: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00019aa0: 2020 2070 726f 7669 6465 7220 3d3d 206d     provider == m
-00019ab0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-00019ac0: 6d61 732e 5365 6372 6574 5072 6f76 6964  mas.SecretProvid
-00019ad0: 6572 4e61 6d65 2e76 6175 6c74 2e76 616c  erName.vault.val
-00019ae0: 7565 0a20 2020 2020 2020 2020 2020 2061  ue.            a
-00019af0: 6e64 206e 6f74 2074 6f6b 656e 0a20 2020  nd not token.   
-00019b00: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00019b10: 2020 2020 7261 6973 6520 4d4c 5275 6e49      raise MLRunI
-00019b20: 6e76 616c 6964 4172 6775 6d65 6e74 4572  nvalidArgumentEr
-00019b30: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00019b40: 2020 2020 2022 4120 7661 756c 7420 746f       "A vault to
-00019b50: 6b65 6e20 6d75 7374 2062 6520 7072 6f76  ken must be prov
-00019b60: 6964 6564 2077 6865 6e20 6163 6365 7373  ided when access
-00019b70: 696e 6720 7661 756c 7420 7365 6372 6574  ing vault secret
-00019b80: 7322 0a20 2020 2020 2020 2020 2020 2029  s".            )
-00019b90: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
-00019ba0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-00019bb0: 6a65 6374 7d2f 7365 6372 6574 7322 0a20  ject}/secrets". 
-00019bc0: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-00019bd0: 7b22 7072 6f76 6964 6572 223a 2070 726f  {"provider": pro
-00019be0: 7669 6465 722c 2022 7365 6372 6574 223a  vider, "secret":
-00019bf0: 2073 6563 7265 7473 7d0a 2020 2020 2020   secrets}.      
-00019c00: 2020 6865 6164 6572 7320 3d20 7b6d 6c72    headers = {mlr
-00019c10: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-00019c20: 732e 4865 6164 6572 4e61 6d65 732e 7365  s.HeaderNames.se
-00019c30: 6372 6574 5f73 746f 7265 5f74 6f6b 656e  cret_store_token
-00019c40: 3a20 746f 6b65 6e7d 0a20 2020 2020 2020  : token}.       
-00019c50: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-00019c60: 2066 2246 6169 6c65 6420 7265 7472 6965   f"Failed retrie
-00019c70: 7669 6e67 2073 6563 7265 7473 207b 7072  ving secrets {pr
-00019c80: 6f6a 6563 747d 2f7b 7072 6f76 6964 6572  oject}/{provider
-00019c90: 7d22 0a20 2020 2020 2020 2072 6573 756c  }".        resul
-00019ca0: 7420 3d20 7365 6c66 2e61 7069 5f63 616c  t = self.api_cal
-00019cb0: 6c28 0a20 2020 2020 2020 2020 2020 2022  l(.            "
-00019cc0: 4745 5422 2c0a 2020 2020 2020 2020 2020  GET",.          
-00019cd0: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
-00019ce0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
-00019cf0: 652c 0a20 2020 2020 2020 2020 2020 2070  e,.            p
-00019d00: 6172 616d 733d 7061 7261 6d73 2c0a 2020  arams=params,.  
-00019d10: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00019d20: 733d 6865 6164 6572 732c 0a20 2020 2020  s=headers,.     
-00019d30: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
-00019d40: 7572 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e  urn mlrun.common
-00019d50: 2e73 6368 656d 6173 2e53 6563 7265 7473  .schemas.Secrets
-00019d60: 4461 7461 282a 2a72 6573 756c 742e 6a73  Data(**result.js
-00019d70: 6f6e 2829 290a 0a20 2020 2064 6566 206c  on())..    def l
-00019d80: 6973 745f 7072 6f6a 6563 745f 7365 6372  ist_project_secr
-00019d90: 6574 5f6b 6579 7328 0a20 2020 2020 2020  et_keys(.       
-00019da0: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-00019db0: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
-00019dc0: 2020 2020 2070 726f 7669 6465 723a 2055       provider: U
-00019dd0: 6e69 6f6e 5b0a 2020 2020 2020 2020 2020  nion[.          
-00019de0: 2020 7374 722c 206d 6c72 756e 2e63 6f6d    str, mlrun.com
-00019df0: 6d6f 6e2e 7363 6865 6d61 732e 5365 6372  mon.schemas.Secr
-00019e00: 6574 5072 6f76 6964 6572 4e61 6d65 0a20  etProviderName. 
-00019e10: 2020 2020 2020 205d 203d 206d 6c72 756e         ] = mlrun
-00019e20: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00019e30: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
-00019e40: 6d65 2e6b 7562 6572 6e65 7465 732c 0a20  me.kubernetes,. 
-00019e50: 2020 2020 2020 2074 6f6b 656e 3a20 7374         token: st
-00019e60: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2920  r = None,.    ) 
-00019e70: 2d3e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  -> mlrun.common.
-00019e80: 7363 6865 6d61 732e 5365 6372 6574 4b65  schemas.SecretKe
-00019e90: 7973 4461 7461 3a0a 2020 2020 2020 2020  ysData:.        
-00019ea0: 2222 2252 6574 7269 6576 6520 7072 6f6a  """Retrieve proj
-00019eb0: 6563 742d 636f 6e74 6578 7420 7365 6372  ect-context secr
-00019ec0: 6574 206b 6579 7320 6672 6f6d 2056 6175  et keys from Vau
-00019ed0: 6c74 206f 7220 4b75 6265 726e 6574 6573  lt or Kubernetes
-00019ee0: 2e0a 0a20 2020 2020 2020 204e 6f74 653a  ...        Note:
-00019ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019f00: 2054 6869 7320 6d65 7468 6f64 2066 6f72   This method for
-00019f10: 2056 6175 6c74 2066 756e 6374 696f 6e61   Vault functiona
-00019f20: 6c69 7479 2069 7320 6375 7272 656e 746c  lity is currentl
-00019f30: 7920 696e 2074 6563 686e 6963 616c 2070  y in technical p
-00019f40: 7265 7669 6577 2c20 616e 6420 7265 7175  review, and requ
-00019f50: 6972 6573 2061 2048 6173 6869 436f 7270  ires a HashiCorp
-00019f60: 2056 6175 6c74 0a20 2020 2020 2020 2020   Vault.         
-00019f70: 2020 2020 2020 2069 6e66 7261 7374 7275         infrastru
-00019f80: 6374 7572 6520 7072 6f70 6572 6c79 2073  cture properly s
-00019f90: 6574 2075 7020 616e 6420 636f 6e6e 6563  et up and connec
-00019fa0: 7465 6420 746f 2074 6865 204d 4c52 756e  ted to the MLRun
-00019fb0: 2041 5049 2073 6572 7665 722e 0a0a 2020   API server...  
-00019fc0: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
-00019fd0: 6a65 6374 3a20 5468 6520 7072 6f6a 6563  ject: The projec
-00019fe0: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
-00019ff0: 3a70 6172 616d 2070 726f 7669 6465 723a  :param provider:
-0001a000: 2054 6865 206e 616d 6520 6f66 2074 6865   The name of the
-0001a010: 2073 6563 7265 7473 2d70 726f 7669 6465   secrets-provide
-0001a020: 7220 746f 2077 6f72 6b20 7769 7468 2e20  r to work with. 
-0001a030: 4163 6365 7074 7320 610a 2020 2020 2020  Accepts a.      
-0001a040: 2020 2020 2020 3a70 793a 636c 6173 733a        :py:class:
-0001a050: 607e 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  `~mlrun.common.s
-0001a060: 6368 656d 6173 2e73 6563 7265 742e 5365  chemas.secret.Se
-0001a070: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
-0001a080: 6020 656e 756d 2e0a 2020 2020 2020 2020  ` enum..        
-0001a090: 3a70 6172 616d 2074 6f6b 656e 3a20 5661  :param token: Va
-0001a0a0: 756c 7420 746f 6b65 6e20 746f 2075 7365  ult token to use
-0001a0b0: 2066 6f72 2072 6574 7269 6576 696e 6720   for retrieving 
-0001a0c0: 7365 6372 6574 732e 204f 6e6c 7920 696e  secrets. Only in
-0001a0d0: 2075 7365 2069 6620 6060 7072 6f76 6964   use if ``provid
-0001a0e0: 6572 6060 2069 7320 6060 7661 756c 7460  er`` is ``vault`
-0001a0f0: 602e 0a20 2020 2020 2020 2020 2020 204d  `..            M
-0001a100: 7573 7420 6265 2061 2076 616c 6964 2056  ust be a valid V
-0001a110: 6175 6c74 2074 6f6b 656e 2c20 7769 7468  ault token, with
-0001a120: 2070 6572 6d69 7373 696f 6e73 2074 6f20   permissions to 
-0001a130: 7265 7472 6965 7665 2073 6563 7265 7473  retrieve secrets
-0001a140: 206f 6620 7468 6520 7072 6f6a 6563 7420   of the project 
-0001a150: 696e 2071 7565 7374 696f 6e2e 0a20 2020  in question..   
-0001a160: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0001a170: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-0001a180: 2020 2070 726f 7669 6465 7220 3d3d 206d     provider == m
-0001a190: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001a1a0: 6d61 732e 5365 6372 6574 5072 6f76 6964  mas.SecretProvid
-0001a1b0: 6572 4e61 6d65 2e76 6175 6c74 2e76 616c  erName.vault.val
-0001a1c0: 7565 0a20 2020 2020 2020 2020 2020 2061  ue.            a
-0001a1d0: 6e64 206e 6f74 2074 6f6b 656e 0a20 2020  nd not token.   
-0001a1e0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-0001a1f0: 2020 2020 7261 6973 6520 4d4c 5275 6e49      raise MLRunI
-0001a200: 6e76 616c 6964 4172 6775 6d65 6e74 4572  nvalidArgumentEr
-0001a210: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0001a220: 2020 2020 2022 4120 7661 756c 7420 746f       "A vault to
-0001a230: 6b65 6e20 6d75 7374 2062 6520 7072 6f76  ken must be prov
-0001a240: 6964 6564 2077 6865 6e20 6163 6365 7373  ided when access
-0001a250: 696e 6720 7661 756c 7420 7365 6372 6574  ing vault secret
-0001a260: 7322 0a20 2020 2020 2020 2020 2020 2029  s".            )
-0001a270: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
-0001a280: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-0001a290: 6a65 6374 7d2f 7365 6372 6574 2d6b 6579  ject}/secret-key
-0001a2a0: 7322 0a20 2020 2020 2020 2070 6172 616d  s".        param
-0001a2b0: 7320 3d20 7b22 7072 6f76 6964 6572 223a  s = {"provider":
-0001a2c0: 2070 726f 7669 6465 727d 0a20 2020 2020   provider}.     
-0001a2d0: 2020 2068 6561 6465 7273 203d 2028 0a20     headers = (. 
-0001a2e0: 2020 2020 2020 2020 2020 207b 6d6c 7275             {mlru
-0001a2f0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-0001a300: 2e48 6561 6465 724e 616d 6573 2e73 6563  .HeaderNames.sec
-0001a310: 7265 745f 7374 6f72 655f 746f 6b65 6e3a  ret_store_token:
-0001a320: 2074 6f6b 656e 7d0a 2020 2020 2020 2020   token}.        
-0001a330: 2020 2020 6966 2070 726f 7669 6465 7220      if provider 
-0001a340: 3d3d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  == mlrun.common.
-0001a350: 7363 6865 6d61 732e 5365 6372 6574 5072  schemas.SecretPr
-0001a360: 6f76 6964 6572 4e61 6d65 2e76 6175 6c74  oviderName.vault
-0001a370: 2e76 616c 7565 0a20 2020 2020 2020 2020  .value.         
-0001a380: 2020 2065 6c73 6520 4e6f 6e65 0a20 2020     else None.   
-0001a390: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-0001a3a0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
-0001a3b0: 2246 6169 6c65 6420 7265 7472 6965 7669  "Failed retrievi
-0001a3c0: 6e67 2073 6563 7265 7420 6b65 7973 207b  ng secret keys {
-0001a3d0: 7072 6f6a 6563 747d 2f7b 7072 6f76 6964  project}/{provid
-0001a3e0: 6572 7d22 0a20 2020 2020 2020 2072 6573  er}".        res
-0001a3f0: 756c 7420 3d20 7365 6c66 2e61 7069 5f63  ult = self.api_c
-0001a400: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
-0001a410: 2022 4745 5422 2c0a 2020 2020 2020 2020   "GET",.        
-0001a420: 2020 2020 7061 7468 2c0a 2020 2020 2020      path,.      
-0001a430: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-0001a440: 6167 652c 0a20 2020 2020 2020 2020 2020  age,.           
-0001a450: 2070 6172 616d 733d 7061 7261 6d73 2c0a   params=params,.
-0001a460: 2020 2020 2020 2020 2020 2020 6865 6164              head
-0001a470: 6572 733d 6865 6164 6572 732c 0a20 2020  ers=headers,.   
-0001a480: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0001a490: 6574 7572 6e20 6d6c 7275 6e2e 636f 6d6d  eturn mlrun.comm
-0001a4a0: 6f6e 2e73 6368 656d 6173 2e53 6563 7265  on.schemas.Secre
-0001a4b0: 744b 6579 7344 6174 6128 2a2a 7265 7375  tKeysData(**resu
-0001a4c0: 6c74 2e6a 736f 6e28 2929 0a0a 2020 2020  lt.json())..    
-0001a4d0: 6465 6620 6465 6c65 7465 5f70 726f 6a65  def delete_proje
-0001a4e0: 6374 5f73 6563 7265 7473 280a 2020 2020  ct_secrets(.    
-0001a4f0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0001a500: 2020 7072 6f6a 6563 743a 2073 7472 2c0a    project: str,.
-0001a510: 2020 2020 2020 2020 7072 6f76 6964 6572          provider
-0001a520: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
-0001a530: 2020 2020 2073 7472 2c20 6d6c 7275 6e2e       str, mlrun.
-0001a540: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
-0001a550: 6563 7265 7450 726f 7669 6465 724e 616d  ecretProviderNam
-0001a560: 650a 2020 2020 2020 2020 5d20 3d20 6d6c  e.        ] = ml
-0001a570: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0001a580: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
-0001a590: 724e 616d 652e 6b75 6265 726e 6574 6573  rName.kubernetes
-0001a5a0: 2c0a 2020 2020 2020 2020 7365 6372 6574  ,.        secret
-0001a5b0: 733a 204c 6973 745b 7374 725d 203d 204e  s: List[str] = N
-0001a5c0: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
-0001a5d0: 2020 2020 2222 2244 656c 6574 6520 7072      """Delete pr
-0001a5e0: 6f6a 6563 742d 636f 6e74 6578 7420 7365  oject-context se
-0001a5f0: 6372 6574 7320 6672 6f6d 204b 7562 6572  crets from Kuber
-0001a600: 6e65 7465 732e 0a0a 2020 2020 2020 2020  netes...        
-0001a610: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
-0001a620: 5468 6520 7072 6f6a 6563 7420 6e61 6d65  The project name
-0001a630: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001a640: 2070 726f 7669 6465 723a 2054 6865 206e   provider: The n
-0001a650: 616d 6520 6f66 2074 6865 2073 6563 7265  ame of the secre
-0001a660: 7473 2d70 726f 7669 6465 7220 746f 2077  ts-provider to w
-0001a670: 6f72 6b20 7769 7468 2e20 4375 7272 656e  ork with. Curren
-0001a680: 746c 7920 6f6e 6c79 2060 606b 7562 6572  tly only ``kuber
-0001a690: 6e65 7465 7360 6020 6973 2073 7570 706f  netes`` is suppo
-0001a6a0: 7274 6564 2e0a 2020 2020 2020 2020 3a70  rted..        :p
-0001a6b0: 6172 616d 2073 6563 7265 7473 3a20 4120  aram secrets: A 
-0001a6c0: 6c69 7374 206f 6620 7365 6372 6574 206e  list of secret n
-0001a6d0: 616d 6573 2074 6f20 6465 6c65 7465 2e20  ames to delete. 
-0001a6e0: 416e 2065 6d70 7479 206c 6973 7420 7769  An empty list wi
-0001a6f0: 6c6c 2064 656c 6574 6520 616c 6c20 7365  ll delete all se
-0001a700: 6372 6574 7320 6173 7369 676e 6564 0a20  crets assigned. 
-0001a710: 2020 2020 2020 2020 2020 2074 6f20 7468             to th
-0001a720: 6973 2073 7065 6369 6669 6320 7072 6f6a  is specific proj
-0001a730: 6563 742e 0a20 2020 2020 2020 2022 2222  ect..        """
-0001a740: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
-0001a750: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-0001a760: 6a65 6374 7d2f 7365 6372 6574 7322 0a20  ject}/secrets". 
-0001a770: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-0001a780: 7b22 7072 6f76 6964 6572 223a 2070 726f  {"provider": pro
-0001a790: 7669 6465 722c 2022 7365 6372 6574 223a  vider, "secret":
-0001a7a0: 2073 6563 7265 7473 7d0a 2020 2020 2020   secrets}.      
-0001a7b0: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
-0001a7c0: 3d20 6622 4661 696c 6564 2064 656c 6574  = f"Failed delet
-0001a7d0: 696e 6720 7365 6372 6574 7320 7b70 726f  ing secrets {pro
-0001a7e0: 6a65 6374 7d2f 7b70 726f 7669 6465 727d  ject}/{provider}
-0001a7f0: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
-0001a800: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
-0001a810: 2020 2020 2022 4445 4c45 5445 222c 0a20       "DELETE",. 
-0001a820: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-0001a830: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-0001a840: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
-0001a850: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
-0001a860: 6172 616d 732c 0a20 2020 2020 2020 2029  arams,.        )
-0001a870: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-0001a880: 5f75 7365 725f 7365 6372 6574 7328 0a20  _user_secrets(. 
-0001a890: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0001a8a0: 2020 2020 2075 7365 723a 2073 7472 2c0a       user: str,.
-0001a8b0: 2020 2020 2020 2020 7072 6f76 6964 6572          provider
-0001a8c0: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
-0001a8d0: 2020 2020 2073 7472 2c20 6d6c 7275 6e2e       str, mlrun.
-0001a8e0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
-0001a8f0: 6563 7265 7450 726f 7669 6465 724e 616d  ecretProviderNam
-0001a900: 650a 2020 2020 2020 2020 5d20 3d20 6d6c  e.        ] = ml
-0001a910: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0001a920: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
-0001a930: 724e 616d 652e 7661 756c 742c 0a20 2020  rName.vault,.   
-0001a940: 2020 2020 2073 6563 7265 7473 3a20 6469       secrets: di
-0001a950: 6374 203d 204e 6f6e 652c 0a20 2020 2029  ct = None,.    )
-0001a960: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
-0001a970: 6174 6520 7573 6572 2d63 6f6e 7465 7874  ate user-context
-0001a980: 2073 6563 7265 7420 696e 2056 6175 6c74   secret in Vault
-0001a990: 2e20 506c 6561 7365 2072 6566 6572 2074  . Please refer t
-0001a9a0: 6f20 3a70 793a 6675 6e63 3a60 6372 6561  o :py:func:`crea
-0001a9b0: 7465 5f70 726f 6a65 6374 5f73 6563 7265  te_project_secre
-0001a9c0: 7473 6020 666f 7220 6d6f 7265 2064 6574  ts` for more det
-0001a9d0: 6169 6c73 0a20 2020 2020 2020 2061 6e64  ails.        and
-0001a9e0: 2073 7461 7475 7320 6f66 2074 6869 7320   status of this 
-0001a9f0: 6675 6e63 7469 6f6e 616c 6974 792e 0a0a  functionality...
-0001aa00: 2020 2020 2020 2020 4e6f 7465 3a0a 2020          Note:.  
-0001aa10: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-0001aa20: 6973 206d 6574 686f 6420 6973 2063 7572  is method is cur
-0001aa30: 7265 6e74 6c79 2069 6e20 7465 6368 6e69  rently in techni
-0001aa40: 6361 6c20 7072 6576 6965 772c 2061 6e64  cal preview, and
-0001aa50: 2072 6571 7569 7265 7320 6120 4861 7368   requires a Hash
-0001aa60: 6943 6f72 7020 5661 756c 7420 696e 6672  iCorp Vault infr
-0001aa70: 6173 7472 7563 7475 7265 0a20 2020 2020  astructure.     
-0001aa80: 2020 2020 2020 2020 2020 2070 726f 7065             prope
-0001aa90: 726c 7920 7365 7420 7570 2061 6e64 2063  rly set up and c
-0001aaa0: 6f6e 6e65 6374 6564 2074 6f20 7468 6520  onnected to the 
-0001aab0: 4d4c 5275 6e20 4150 4920 7365 7276 6572  MLRun API server
-0001aac0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0001aad0: 6d20 7573 6572 3a20 5468 6520 7573 6572  m user: The user
-0001aae0: 2063 6f6e 7465 7874 2066 6f72 2077 6869   context for whi
-0001aaf0: 6368 2074 6f20 6765 6e65 7261 7465 2074  ch to generate t
-0001ab00: 6865 2069 6e66 7261 2061 6e64 2073 746f  he infra and sto
-0001ab10: 7265 2073 6563 7265 7473 2e0a 2020 2020  re secrets..    
-0001ab20: 2020 2020 3a70 6172 616d 2070 726f 7669      :param provi
-0001ab30: 6465 723a 2054 6865 206e 616d 6520 6f66  der: The name of
-0001ab40: 2074 6865 2073 6563 7265 7473 2d70 726f   the secrets-pro
-0001ab50: 7669 6465 7220 746f 2077 6f72 6b20 7769  vider to work wi
-0001ab60: 7468 2e20 4375 7272 656e 746c 7920 6f6e  th. Currently on
-0001ab70: 6c79 2060 6076 6175 6c74 6060 2069 7320  ly ``vault`` is 
-0001ab80: 7375 7070 6f72 7465 642e 0a20 2020 2020  supported..     
-0001ab90: 2020 203a 7061 7261 6d20 7365 6372 6574     :param secret
-0001aba0: 733a 2041 2073 6574 206f 6620 7365 6372  s: A set of secr
-0001abb0: 6574 2076 616c 7565 7320 746f 2073 746f  et values to sto
-0001abc0: 7265 2077 6974 6869 6e20 7468 6520 5661  re within the Va
-0001abd0: 756c 742e 0a20 2020 2020 2020 2022 2222  ult..        """
-0001abe0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-0001abf0: 2275 7365 722d 7365 6372 6574 7322 0a20  "user-secrets". 
-0001ac00: 2020 2020 2020 2073 6563 7265 7473 5f63         secrets_c
-0001ac10: 7265 6174 696f 6e5f 7265 7175 6573 7420  reation_request 
-0001ac20: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
-0001ac30: 6368 656d 6173 2e55 7365 7253 6563 7265  chemas.UserSecre
-0001ac40: 7443 7265 6174 696f 6e52 6571 7565 7374  tCreationRequest
-0001ac50: 280a 2020 2020 2020 2020 2020 2020 7573  (.            us
-0001ac60: 6572 3d75 7365 722c 0a20 2020 2020 2020  er=user,.       
-0001ac70: 2020 2020 2070 726f 7669 6465 723d 7072       provider=pr
-0001ac80: 6f76 6964 6572 2c0a 2020 2020 2020 2020  ovider,.        
-0001ac90: 2020 2020 7365 6372 6574 733d 7365 6372      secrets=secr
-0001aca0: 6574 732c 0a20 2020 2020 2020 2029 0a20  ets,.        ). 
-0001acb0: 2020 2020 2020 2062 6f64 7920 3d20 7365         body = se
-0001acc0: 6372 6574 735f 6372 6561 7469 6f6e 5f72  crets_creation_r
-0001acd0: 6571 7565 7374 2e64 6963 7428 290a 2020  equest.dict().  
-0001ace0: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-0001acf0: 6167 6520 3d20 6622 4661 696c 6564 2063  age = f"Failed c
-0001ad00: 7265 6174 696e 6720 7573 6572 2073 6563  reating user sec
-0001ad10: 7265 7473 202d 207b 7573 6572 7d22 0a20  rets - {user}". 
-0001ad20: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
-0001ad30: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-0001ad40: 2020 2250 4f53 5422 2c0a 2020 2020 2020    "POST",.      
-0001ad50: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
-0001ad60: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-0001ad70: 7373 6167 652c 0a20 2020 2020 2020 2020  ssage,.         
-0001ad80: 2020 2062 6f64 793d 6469 6374 5f74 6f5f     body=dict_to_
-0001ad90: 6a73 6f6e 2862 6f64 7929 2c0a 2020 2020  json(body),.    
-0001ada0: 2020 2020 290a 0a20 2020 2040 7374 6174      )..    @stat
-0001adb0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-0001adc0: 205f 7661 6c69 6461 7465 5f76 6572 7369   _validate_versi
-0001add0: 6f6e 5f63 6f6d 7061 7469 6269 6c69 7479  on_compatibility
-0001ade0: 2873 6572 7665 725f 7665 7273 696f 6e2c  (server_version,
-0001adf0: 2063 6c69 656e 745f 7665 7273 696f 6e29   client_version)
-0001ae00: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-0001ae10: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001ae20: 2020 2070 6172 7365 645f 7365 7276 6572     parsed_server
-0001ae30: 5f76 6572 7369 6f6e 203d 2073 656d 7665  _version = semve
-0001ae40: 722e 5665 7273 696f 6e49 6e66 6f2e 7061  r.VersionInfo.pa
-0001ae50: 7273 6528 7365 7276 6572 5f76 6572 7369  rse(server_versi
-0001ae60: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
-0001ae70: 7061 7273 6564 5f63 6c69 656e 745f 7665  parsed_client_ve
-0001ae80: 7273 696f 6e20 3d20 7365 6d76 6572 2e56  rsion = semver.V
-0001ae90: 6572 7369 6f6e 496e 666f 2e70 6172 7365  ersionInfo.parse
-0001aea0: 2863 6c69 656e 745f 7665 7273 696f 6e29  (client_version)
-0001aeb0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0001aec0: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
-0001aed0: 2020 2020 2020 2020 2320 5468 6973 2077          # This w
-0001aee0: 696c 6c20 6d6f 7374 6c79 2068 6170 7065  ill mostly happe
-0001aef0: 6e20 696e 2064 6576 2073 6365 6e61 7269  n in dev scenari
-0001af00: 6f73 2077 6865 6e20 7468 6520 7665 7273  os when the vers
-0001af10: 696f 6e20 6973 2075 6e73 7461 626c 6520  ion is unstable 
-0001af20: 616e 6420 7375 6368 202d 2074 6865 7265  and such - there
-0001af30: 666f 7265 2077 6527 7265 2069 676e 6f72  fore we're ignor
-0001af40: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0001af50: 6c6f 6767 6572 2e77 6172 6e69 6e67 280a  logger.warning(.
-0001af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af70: 2255 6e61 626c 6520 746f 2070 6172 7365  "Unable to parse
-0001af80: 2073 6572 7665 7220 6f72 2063 6c69 656e   server or clien
-0001af90: 7420 7665 7273 696f 6e2e 2041 7373 756d  t version. Assum
-0001afa0: 696e 6720 636f 6d70 6174 6962 6c65 222c  ing compatible",
-0001afb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001afc0: 2073 6572 7665 725f 7665 7273 696f 6e3d   server_version=
-0001afd0: 7365 7276 6572 5f76 6572 7369 6f6e 2c0a  server_version,.
-0001afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aff0: 636c 6965 6e74 5f76 6572 7369 6f6e 3d63  client_version=c
-0001b000: 6c69 656e 745f 7665 7273 696f 6e2c 0a20  lient_version,. 
-0001b010: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001b020: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001b030: 5472 7565 0a20 2020 2020 2020 2069 6620  True.        if 
-0001b040: 2870 6172 7365 645f 7365 7276 6572 5f76  (parsed_server_v
-0001b050: 6572 7369 6f6e 2e6d 616a 6f72 203d 3d20  ersion.major == 
-0001b060: 3020 616e 6420 7061 7273 6564 5f73 6572  0 and parsed_ser
-0001b070: 7665 725f 7665 7273 696f 6e2e 6d69 6e6f  ver_version.mino
-0001b080: 7220 3d3d 2030 2920 6f72 2028 0a20 2020  r == 0) or (.   
-0001b090: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
-0001b0a0: 636c 6965 6e74 5f76 6572 7369 6f6e 2e6d  client_version.m
-0001b0b0: 616a 6f72 203d 3d20 3020 616e 6420 7061  ajor == 0 and pa
-0001b0c0: 7273 6564 5f63 6c69 656e 745f 7665 7273  rsed_client_vers
-0001b0d0: 696f 6e2e 6d69 6e6f 7220 3d3d 2030 0a20  ion.minor == 0. 
-0001b0e0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0001b0f0: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-0001b100: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
-0001b110: 2020 2020 2020 2253 6572 7665 7220 6f72        "Server or
-0001b120: 2063 6c69 656e 7420 7665 7273 696f 6e20   client version 
-0001b130: 6973 2075 6e73 7461 626c 652e 2041 7373  is unstable. Ass
-0001b140: 756d 696e 6720 636f 6d70 6174 6962 6c65  uming compatible
-0001b150: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0001b160: 2020 2073 6572 7665 725f 7665 7273 696f     server_versio
-0001b170: 6e3d 7365 7276 6572 5f76 6572 7369 6f6e  n=server_version
-0001b180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b190: 2020 636c 6965 6e74 5f76 6572 7369 6f6e    client_version
-0001b1a0: 3d63 6c69 656e 745f 7665 7273 696f 6e2c  =client_version,
-0001b1b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001b1c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001b1d0: 6e20 5472 7565 0a20 2020 2020 2020 2069  n True.        i
-0001b1e0: 6620 7061 7273 6564 5f73 6572 7665 725f  f parsed_server_
-0001b1f0: 7665 7273 696f 6e2e 6d61 6a6f 7220 213d  version.major !=
-0001b200: 2070 6172 7365 645f 636c 6965 6e74 5f76   parsed_client_v
-0001b210: 6572 7369 6f6e 2e6d 616a 6f72 3a0a 2020  ersion.major:.  
-0001b220: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-0001b230: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
-0001b240: 2020 2020 2020 2020 2020 2253 6572 7665            "Serve
-0001b250: 7220 616e 6420 636c 6965 6e74 2076 6572  r and client ver
-0001b260: 7369 6f6e 7320 6172 6520 696e 636f 6d70  sions are incomp
-0001b270: 6174 6962 6c65 222c 0a20 2020 2020 2020  atible",.       
-0001b280: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
-0001b290: 7365 7276 6572 5f76 6572 7369 6f6e 3d70  server_version=p
-0001b2a0: 6172 7365 645f 7365 7276 6572 5f76 6572  arsed_server_ver
-0001b2b0: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
-0001b2c0: 2020 2020 2020 7061 7273 6564 5f63 6c69        parsed_cli
-0001b2d0: 656e 745f 7665 7273 696f 6e3d 7061 7273  ent_version=pars
-0001b2e0: 6564 5f63 6c69 656e 745f 7665 7273 696f  ed_client_versio
-0001b2f0: 6e2c 0a20 2020 2020 2020 2020 2020 2029  n,.            )
-0001b300: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001b310: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0001b320: 2020 6966 2070 6172 7365 645f 7365 7276    if parsed_serv
-0001b330: 6572 5f76 6572 7369 6f6e 2e6d 696e 6f72  er_version.minor
-0001b340: 203e 2070 6172 7365 645f 636c 6965 6e74   > parsed_client
-0001b350: 5f76 6572 7369 6f6e 2e6d 696e 6f72 202b  _version.minor +
-0001b360: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-0001b370: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
-0001b380: 2020 2020 2020 2020 2020 2020 2022 4261               "Ba
-0001b390: 636b 7761 7264 7320 636f 6d70 6174 6962  ckwards compatib
-0001b3a0: 696c 6974 7920 6d69 6768 7420 6e6f 7420  ility might not 
-0001b3b0: 6170 706c 7920 6265 7477 6565 6e20 7468  apply between th
-0001b3c0: 6520 7365 7276 6572 2061 6e64 2063 6c69  e server and cli
-0001b3d0: 656e 7420 7665 7273 696f 6e22 2c0a 2020  ent version",.  
-0001b3e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001b3f0: 7273 6564 5f73 6572 7665 725f 7665 7273  rsed_server_vers
-0001b400: 696f 6e3d 7061 7273 6564 5f73 6572 7665  ion=parsed_serve
-0001b410: 725f 7665 7273 696f 6e2c 0a20 2020 2020  r_version,.     
-0001b420: 2020 2020 2020 2020 2020 2070 6172 7365             parse
-0001b430: 645f 636c 6965 6e74 5f76 6572 7369 6f6e  d_client_version
-0001b440: 3d70 6172 7365 645f 636c 6965 6e74 5f76  =parsed_client_v
-0001b450: 6572 7369 6f6e 2c0a 2020 2020 2020 2020  ersion,.        
-0001b460: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001b470: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-0001b480: 2020 2020 2020 2069 6620 7061 7273 6564         if parsed
-0001b490: 5f63 6c69 656e 745f 7665 7273 696f 6e2e  _client_version.
-0001b4a0: 6d69 6e6f 7220 3e20 7061 7273 6564 5f73  minor > parsed_s
-0001b4b0: 6572 7665 725f 7665 7273 696f 6e2e 6d69  erver_version.mi
-0001b4c0: 6e6f 723a 0a20 2020 2020 2020 2020 2020  nor:.           
-0001b4d0: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-0001b4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b4f0: 2022 436c 6965 6e74 2076 6572 7369 6f6e   "Client version
-0001b500: 2077 6974 6820 6869 6768 6572 2076 6572   with higher ver
-0001b510: 7369 6f6e 2074 6861 6e20 7365 7276 6572  sion than server
-0001b520: 2076 6572 7369 6f6e 2069 736e 2774 2073   version isn't s
-0001b530: 7570 706f 7274 6564 2c22 0a20 2020 2020  upported,".     
-0001b540: 2020 2020 2020 2020 2020 2022 2061 6c69             " ali
-0001b550: 676e 2079 6f75 7220 636c 6965 6e74 2074  gn your client t
-0001b560: 6f20 7468 6520 7365 7276 6572 2076 6572  o the server ver
-0001b570: 7369 6f6e 222c 0a20 2020 2020 2020 2020  sion",.         
-0001b580: 2020 2020 2020 2070 6172 7365 645f 7365         parsed_se
-0001b590: 7276 6572 5f76 6572 7369 6f6e 3d70 6172  rver_version=par
-0001b5a0: 7365 645f 7365 7276 6572 5f76 6572 7369  sed_server_versi
-0001b5b0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-0001b5c0: 2020 2020 7061 7273 6564 5f63 6c69 656e      parsed_clien
-0001b5d0: 745f 7665 7273 696f 6e3d 7061 7273 6564  t_version=parsed
-0001b5e0: 5f63 6c69 656e 745f 7665 7273 696f 6e2c  _client_version,
-0001b5f0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001b600: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001b610: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-0001b620: 6966 2070 6172 7365 645f 7365 7276 6572  if parsed_server
-0001b630: 5f76 6572 7369 6f6e 2e6d 696e 6f72 2021  _version.minor !
-0001b640: 3d20 7061 7273 6564 5f63 6c69 656e 745f  = parsed_client_
-0001b650: 7665 7273 696f 6e2e 6d69 6e6f 723a 0a20  version.minor:. 
-0001b660: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0001b670: 722e 696e 666f 280a 2020 2020 2020 2020  r.info(.        
-0001b680: 2020 2020 2020 2020 2253 6572 7665 7220          "Server 
-0001b690: 616e 6420 636c 6965 6e74 2076 6572 7369  and client versi
-0001b6a0: 6f6e 7320 6172 6520 6e6f 7420 7468 6520  ons are not the 
-0001b6b0: 7361 6d65 2062 7574 2063 6f6d 7061 7469  same but compati
-0001b6c0: 626c 6522 2c0a 2020 2020 2020 2020 2020  ble",.          
-0001b6d0: 2020 2020 2020 7061 7273 6564 5f73 6572        parsed_ser
-0001b6e0: 7665 725f 7665 7273 696f 6e3d 7061 7273  ver_version=pars
-0001b6f0: 6564 5f73 6572 7665 725f 7665 7273 696f  ed_server_versio
-0001b700: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0001b710: 2020 2070 6172 7365 645f 636c 6965 6e74     parsed_client
-0001b720: 5f76 6572 7369 6f6e 3d70 6172 7365 645f  _version=parsed_
-0001b730: 636c 6965 6e74 5f76 6572 7369 6f6e 2c0a  client_version,.
-0001b740: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001b750: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0001b760: 650a 0a20 2020 2064 6566 2063 7265 6174  e..    def creat
-0001b770: 655f 6d6f 6465 6c5f 656e 6470 6f69 6e74  e_model_endpoint
-0001b780: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0001b790: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
-0001b7a0: 2073 7472 2c0a 2020 2020 2020 2020 656e   str,.        en
-0001b7b0: 6470 6f69 6e74 5f69 643a 2073 7472 2c0a  dpoint_id: str,.
-0001b7c0: 2020 2020 2020 2020 6d6f 6465 6c5f 656e          model_en
-0001b7d0: 6470 6f69 6e74 3a20 556e 696f 6e5b 0a20  dpoint: Union[. 
-0001b7e0: 2020 2020 2020 2020 2020 206d 6c72 756e             mlrun
-0001b7f0: 2e6d 6f64 656c 5f6d 6f6e 6974 6f72 696e  .model_monitorin
-0001b800: 672e 6d6f 6465 6c5f 656e 6470 6f69 6e74  g.model_endpoint
-0001b810: 2e4d 6f64 656c 456e 6470 6f69 6e74 2c20  .ModelEndpoint, 
-0001b820: 6469 6374 0a20 2020 2020 2020 205d 2c0a  dict.        ],.
-0001b830: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0001b840: 2222 0a20 2020 2020 2020 2043 7265 6174  "".        Creat
-0001b850: 6573 2061 2044 4220 7265 636f 7264 2077  es a DB record w
-0001b860: 6974 6820 7468 6520 6769 7665 6e20 6d6f  ith the given mo
-0001b870: 6465 6c5f 656e 6470 6f69 6e74 2072 6563  del_endpoint rec
-0001b880: 6f72 642e 0a0a 2020 2020 2020 2020 3a70  ord...        :p
-0001b890: 6172 616d 2070 726f 6a65 6374 3a20 5468  aram project: Th
-0001b8a0: 6520 6e61 6d65 206f 6620 7468 6520 7072  e name of the pr
-0001b8b0: 6f6a 6563 742e 0a20 2020 2020 2020 203a  oject..        :
-0001b8c0: 7061 7261 6d20 656e 6470 6f69 6e74 5f69  param endpoint_i
-0001b8d0: 643a 2054 6865 2069 6420 6f66 2074 6865  d: The id of the
-0001b8e0: 2065 6e64 706f 696e 742e 0a20 2020 2020   endpoint..     
-0001b8f0: 2020 203a 7061 7261 6d20 6d6f 6465 6c5f     :param model_
-0001b900: 656e 6470 6f69 6e74 3a20 416e 206f 626a  endpoint: An obj
-0001b910: 6563 7420 7265 7072 6573 656e 7469 6e67  ect representing
-0001b920: 2074 6865 206d 6f64 656c 2065 6e64 706f   the model endpo
-0001b930: 696e 742e 0a20 2020 2020 2020 2022 2222  int..        """
-0001b940: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0001b950: 6e73 7461 6e63 6528 0a20 2020 2020 2020  nstance(.       
-0001b960: 2020 2020 206d 6f64 656c 5f65 6e64 706f       model_endpo
-0001b970: 696e 742c 206d 6c72 756e 2e6d 6f64 656c  int, mlrun.model
-0001b980: 5f6d 6f6e 6974 6f72 696e 672e 6d6f 6465  _monitoring.mode
-0001b990: 6c5f 656e 6470 6f69 6e74 2e4d 6f64 656c  l_endpoint.Model
-0001b9a0: 456e 6470 6f69 6e74 0a20 2020 2020 2020  Endpoint.       
-0001b9b0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0001b9c0: 6d6f 6465 6c5f 656e 6470 6f69 6e74 203d  model_endpoint =
-0001b9d0: 206d 6f64 656c 5f65 6e64 706f 696e 742e   model_endpoint.
-0001b9e0: 746f 5f64 6963 7428 290a 0a20 2020 2020  to_dict()..     
-0001b9f0: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
-0001ba00: 6563 7473 2f7b 7072 6f6a 6563 747d 2f6d  ects/{project}/m
-0001ba10: 6f64 656c 2d65 6e64 706f 696e 7473 2f7b  odel-endpoints/{
-0001ba20: 656e 6470 6f69 6e74 5f69 647d 220a 2020  endpoint_id}".  
-0001ba30: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
-0001ba40: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
-0001ba50: 206d 6574 686f 643d 2250 4f53 5422 2c0a   method="POST",.
-0001ba60: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0001ba70: 3d70 6174 682c 0a20 2020 2020 2020 2020  =path,.         
-0001ba80: 2020 2062 6f64 793d 6469 6374 5f74 6f5f     body=dict_to_
-0001ba90: 6a73 6f6e 286d 6f64 656c 5f65 6e64 706f  json(model_endpo
-0001baa0: 696e 7429 2c0a 2020 2020 2020 2020 290a  int),.        ).
-0001bab0: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
-0001bac0: 6d6f 6465 6c5f 656e 6470 6f69 6e74 280a  model_endpoint(.
-0001bad0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0001bae0: 2020 2020 2020 7072 6f6a 6563 743a 2073        project: s
-0001baf0: 7472 2c0a 2020 2020 2020 2020 656e 6470  tr,.        endp
-0001bb00: 6f69 6e74 5f69 643a 2073 7472 2c0a 2020  oint_id: str,.  
-0001bb10: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0001bb20: 0a20 2020 2020 2020 2044 656c 6574 6573  .        Deletes
-0001bb30: 2074 6865 2044 4220 7265 636f 7264 206f   the DB record o
-0001bb40: 6620 6120 6769 7665 6e20 6d6f 6465 6c20  f a given model 
-0001bb50: 656e 6470 6f69 6e74 2c20 7072 6f6a 6563  endpoint, projec
-0001bb60: 7420 616e 6420 656e 6470 6f69 6e74 5f69  t and endpoint_i
-0001bb70: 6420 6172 6520 7573 6564 2066 6f72 206c  d are used for l
-0001bb80: 6f6f 6b75 700a 0a20 2020 2020 2020 203a  ookup..        :
-0001bb90: 7061 7261 6d20 7072 6f6a 6563 743a 2054  param project: T
-0001bba0: 6865 206e 616d 6520 6f66 2074 6865 2070  he name of the p
-0001bbb0: 726f 6a65 6374 0a20 2020 2020 2020 203a  roject.        :
-0001bbc0: 7061 7261 6d20 656e 6470 6f69 6e74 5f69  param endpoint_i
-0001bbd0: 643a 2054 6865 2069 6420 6f66 2074 6865  d: The id of the
-0001bbe0: 2065 6e64 706f 696e 740a 2020 2020 2020   endpoint.      
-0001bbf0: 2020 2222 220a 0a20 2020 2020 2020 2070    """..        p
-0001bc00: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
-0001bc10: 2f7b 7072 6f6a 6563 747d 2f6d 6f64 656c  /{project}/model
-0001bc20: 2d65 6e64 706f 696e 7473 2f7b 656e 6470  -endpoints/{endp
-0001bc30: 6f69 6e74 5f69 647d 220a 2020 2020 2020  oint_id}".      
-0001bc40: 2020 7365 6c66 2e61 7069 5f63 616c 6c28    self.api_call(
-0001bc50: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-0001bc60: 686f 643d 2244 454c 4554 4522 2c0a 2020  hod="DELETE",.  
-0001bc70: 2020 2020 2020 2020 2020 7061 7468 3d70            path=p
-0001bc80: 6174 682c 0a20 2020 2020 2020 2029 0a0a  ath,.        )..
-0001bc90: 2020 2020 6465 6620 6c69 7374 5f6d 6f64      def list_mod
-0001bca0: 656c 5f65 6e64 706f 696e 7473 280a 2020  el_endpoints(.  
-0001bcb0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0001bcc0: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
-0001bcd0: 2c0a 2020 2020 2020 2020 6d6f 6465 6c3a  ,.        model:
-0001bce0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-0001bcf0: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
-0001bd00: 756e 6374 696f 6e3a 204f 7074 696f 6e61  unction: Optiona
-0001bd10: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-0001bd20: 2020 2020 2020 206c 6162 656c 733a 204c         labels: L
-0001bd30: 6973 745b 7374 725d 203d 204e 6f6e 652c  ist[str] = None,
-0001bd40: 0a20 2020 2020 2020 2073 7461 7274 3a20  .        start: 
-0001bd50: 7374 7220 3d20 226e 6f77 2d31 6822 2c0a  str = "now-1h",.
-0001bd60: 2020 2020 2020 2020 656e 643a 2073 7472          end: str
-0001bd70: 203d 2022 6e6f 7722 2c0a 2020 2020 2020   = "now",.      
-0001bd80: 2020 6d65 7472 6963 733a 204f 7074 696f    metrics: Optio
-0001bd90: 6e61 6c5b 4c69 7374 5b73 7472 5d5d 203d  nal[List[str]] =
-0001bda0: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
-0001bdb0: 6f70 5f6c 6576 656c 3a20 626f 6f6c 203d  op_level: bool =
-0001bdc0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0001bdd0: 7569 6473 3a20 4f70 7469 6f6e 616c 5b4c  uids: Optional[L
-0001bde0: 6973 745b 7374 725d 5d20 3d20 4e6f 6e65  ist[str]] = None
-0001bdf0: 2c0a 2020 2020 2920 2d3e 204c 6973 745b  ,.    ) -> List[
-0001be00: 6d6c 7275 6e2e 6d6f 6465 6c5f 6d6f 6e69  mlrun.model_moni
-0001be10: 746f 7269 6e67 2e6d 6f64 656c 5f65 6e64  toring.model_end
-0001be20: 706f 696e 742e 4d6f 6465 6c45 6e64 706f  point.ModelEndpo
-0001be30: 696e 745d 3a0a 2020 2020 2020 2020 2222  int]:.        ""
-0001be40: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
-0001be50: 7320 6120 6c69 7374 206f 6620 604d 6f64  s a list of `Mod
-0001be60: 656c 456e 6470 6f69 6e74 6020 6f62 6a65  elEndpoint` obje
-0001be70: 6374 732e 2045 6163 6820 604d 6f64 656c  cts. Each `Model
-0001be80: 456e 6470 6f69 6e74 6020 6f62 6a65 6374  Endpoint` object
-0001be90: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
-0001bea0: 6375 7272 656e 7420 7374 6174 6520 6f66  current state of
-0001beb0: 2061 0a20 2020 2020 2020 206d 6f64 656c   a.        model
-0001bec0: 2065 6e64 706f 696e 742e 2054 6869 7320   endpoint. This 
-0001bed0: 6675 6e63 7469 6f6e 7320 7375 7070 6f72  functions suppor
-0001bee0: 7473 2066 696c 7465 7269 6e67 2062 7920  ts filtering by 
-0001bef0: 7468 6520 666f 6c6c 6f77 696e 6720 7061  the following pa
-0001bf00: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
-0001bf10: 2020 3129 206d 6f64 656c 0a20 2020 2020    1) model.     
-0001bf20: 2020 2032 2920 6675 6e63 7469 6f6e 0a20     2) function. 
-0001bf30: 2020 2020 2020 2033 2920 6c61 6265 6c73         3) labels
-0001bf40: 0a20 2020 2020 2020 2034 2920 746f 7020  .        4) top 
-0001bf50: 6c65 7665 6c0a 2020 2020 2020 2020 3529  level.        5)
-0001bf60: 2075 6964 730a 2020 2020 2020 2020 4279   uids.        By
-0001bf70: 2064 6566 6175 6c74 2c20 7768 656e 206e   default, when n
-0001bf80: 6f20 6669 6c74 6572 7320 6172 6520 6170  o filters are ap
-0001bf90: 706c 6965 642c 2061 6c6c 2061 7661 696c  plied, all avail
-0001bfa0: 6162 6c65 2065 6e64 706f 696e 7473 2066  able endpoints f
-0001bfb0: 6f72 2074 6865 2067 6976 656e 2070 726f  or the given pro
-0001bfc0: 6a65 6374 2077 696c 6c20 6265 206c 6973  ject will be lis
-0001bfd0: 7465 642e 0a0a 2020 2020 2020 2020 496e  ted...        In
-0001bfe0: 2061 6464 6974 696f 6e2c 2074 6869 7320   addition, this 
-0001bff0: 6675 6e63 7469 6f6e 7320 7072 6f76 6964  functions provid
-0001c000: 6573 2061 2066 6163 6164 6520 666f 7220  es a facade for 
-0001c010: 6c69 7374 696e 6720 656e 6470 6f69 6e74  listing endpoint
-0001c020: 2072 656c 6174 6564 206d 6574 7269 6373   related metrics
-0001c030: 2e20 5468 6973 2066 6163 6164 6520 6973  . This facade is
-0001c040: 2074 696d 652d 6261 7365 640a 2020 2020   time-based.    
-0001c050: 2020 2020 616e 6420 6465 7065 6e64 7320      and depends 
-0001c060: 6f6e 2074 6865 2027 7374 6172 7427 2061  on the 'start' a
-0001c070: 6e64 2027 656e 6427 2070 6172 616d 6574  nd 'end' paramet
-0001c080: 6572 732e 2042 7920 6465 6661 756c 742c  ers. By default,
-0001c090: 2077 6865 6e20 7468 6520 6d65 7472 6963   when the metric
-0001c0a0: 7320 7061 7261 6d65 7465 7220 6973 204e  s parameter is N
-0001c0b0: 6f6e 652c 206e 6f20 6d65 7472 6963 7320  one, no metrics 
-0001c0c0: 6172 650a 2020 2020 2020 2020 6164 6465  are.        adde
-0001c0d0: 6420 746f 2074 6865 206f 7574 7075 7420  d to the output 
-0001c0e0: 6f66 2074 6869 7320 6675 6e63 7469 6f6e  of this function
-0001c0f0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0001c100: 6d20 7072 6f6a 6563 743a 2054 6865 206e  m project: The n
-0001c110: 616d 6520 6f66 2074 6865 2070 726f 6a65  ame of the proje
-0001c120: 6374 0a20 2020 2020 2020 203a 7061 7261  ct.        :para
-0001c130: 6d20 6d6f 6465 6c3a 2054 6865 206e 616d  m model: The nam
-0001c140: 6520 6f66 2074 6865 206d 6f64 656c 2074  e of the model t
-0001c150: 6f20 6669 6c74 6572 2062 790a 2020 2020  o filter by.    
-0001c160: 2020 2020 3a70 6172 616d 2066 756e 6374      :param funct
-0001c170: 696f 6e3a 2054 6865 206e 616d 6520 6f66  ion: The name of
-0001c180: 2074 6865 2066 756e 6374 696f 6e20 746f   the function to
-0001c190: 2066 696c 7465 7220 6279 0a20 2020 2020   filter by.     
-0001c1a0: 2020 203a 7061 7261 6d20 6c61 6265 6c73     :param labels
-0001c1b0: 3a20 4120 6c69 7374 206f 6620 6c61 6265  : A list of labe
-0001c1c0: 6c73 2074 6f20 6669 6c74 6572 2062 792e  ls to filter by.
-0001c1d0: 204c 6162 656c 2066 696c 7465 7273 2077   Label filters w
-0001c1e0: 6f72 6b20 6279 2065 6974 6865 7220 6669  ork by either fi
-0001c1f0: 6c74 6572 696e 6720 6120 7370 6563 6966  ltering a specif
-0001c200: 6963 2076 616c 7565 206f 6620 610a 2020  ic value of a.  
-0001c210: 2020 2020 2020 206c 6162 656c 2028 692e         label (i.
-0001c220: 652e 206c 6973 7428 226b 6579 3d76 616c  e. list("key=val
-0001c230: 7565 2229 2920 6f72 2062 7920 6c6f 6f6b  ue")) or by look
-0001c240: 696e 6720 666f 7220 7468 6520 6578 6973  ing for the exis
-0001c250: 7465 6e63 6520 6f66 2061 2067 6976 656e  tence of a given
-0001c260: 206b 6579 2028 692e 652e 2022 6b65 7922   key (i.e. "key"
-0001c270: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
-0001c280: 206d 6574 7269 6373 3a20 4120 6c69 7374   metrics: A list
-0001c290: 206f 6620 6d65 7472 6963 7320 746f 2072   of metrics to r
-0001c2a0: 6574 7572 6e20 666f 7220 6561 6368 2065  eturn for each e
-0001c2b0: 6e64 706f 696e 742c 2072 6561 6420 6d6f  ndpoint, read mo
-0001c2c0: 7265 2069 6e20 2754 696d 654d 6574 7269  re in 'TimeMetri
-0001c2d0: 6327 0a20 2020 2020 2020 203a 7061 7261  c'.        :para
-0001c2e0: 6d20 7374 6172 743a 2054 6865 2073 7461  m start: The sta
-0001c2f0: 7274 2074 696d 6520 6f66 2074 6865 206d  rt time of the m
-0001c300: 6574 7269 6373 2e20 4361 6e20 6265 2072  etrics. Can be r
-0001c310: 6570 7265 7365 6e74 6564 2062 7920 6120  epresented by a 
-0001c320: 7374 7269 6e67 2063 6f6e 7461 696e 696e  string containin
-0001c330: 6720 616e 2052 4643 2033 3333 390a 2020  g an RFC 3339.  
-0001c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c350: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001c360: 696d 652c 2061 2055 6e69 7820 7469 6d65  ime, a Unix time
-0001c370: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
-0001c380: 636f 6e64 732c 2061 2072 656c 6174 6976  conds, a relativ
-0001c390: 6520 7469 6d65 2028 6027 6e6f 7727 6020  e time (`'now'` 
-0001c3a0: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
-0001c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3c0: 2020 2020 6027 6e6f 772d 5b30 2d39 5d2b      `'now-[0-9]+
-0001c3d0: 5b6d 6864 5d27 602c 2077 6865 7265 2060  [mhd]'`, where `
-0001c3e0: 6d60 203d 206d 696e 7574 6573 2c20 6068  m` = minutes, `h
-0001c3f0: 6020 3d20 686f 7572 732c 2061 6e64 2060  ` = hours, and `
-0001c400: 2764 2760 203d 0a20 2020 2020 2020 2020  'd'` =.         
-0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c420: 2020 2020 2020 2020 6461 7973 292c 206f          days), o
-0001c430: 7220 3020 666f 7220 7468 6520 6561 726c  r 0 for the earl
-0001c440: 6965 7374 2074 696d 652e 0a20 2020 2020  iest time..     
-0001c450: 2020 203a 7061 7261 6d20 656e 643a 2054     :param end: T
-0001c460: 6865 2065 6e64 2074 696d 6520 6f66 2074  he end time of t
-0001c470: 6865 206d 6574 7269 6373 2e20 4361 6e20  he metrics. Can 
-0001c480: 6265 2072 6570 7265 7365 6e74 6564 2062  be represented b
-0001c490: 7920 6120 7374 7269 6e67 2063 6f6e 7461  y a string conta
-0001c4a0: 696e 696e 6720 616e 2052 4643 2033 3333  ining an RFC 333
-0001c4b0: 390a 2020 2020 2020 2020 2020 2020 2020  9.              
-0001c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4d0: 2020 2074 696d 652c 2061 2055 6e69 7820     time, a Unix 
-0001c4e0: 7469 6d65 7374 616d 7020 696e 206d 696c  timestamp in mil
-0001c4f0: 6c69 7365 636f 6e64 732c 2061 2072 656c  liseconds, a rel
-0001c500: 6174 6976 6520 7469 6d65 2028 6027 6e6f  ative time (`'no
-0001c510: 7727 6020 6f72 0a20 2020 2020 2020 2020  w'` or.         
-0001c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c530: 2020 2020 2020 2020 6027 6e6f 772d 5b30          `'now-[0
-0001c540: 2d39 5d2b 5b6d 6864 5d27 602c 2077 6865  -9]+[mhd]'`, whe
-0001c550: 7265 2060 6d60 203d 206d 696e 7574 6573  re `m` = minutes
-0001c560: 2c20 6068 6020 3d20 686f 7572 732c 2061  , `h` = hours, a
-0001c570: 6e64 2060 2764 2760 203d 0a20 2020 2020  nd `'d'` =.     
-0001c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c590: 2020 2020 2020 2020 2020 2020 6461 7973              days
-0001c5a0: 292c 206f 7220 3020 666f 7220 7468 6520  ), or 0 for the 
-0001c5b0: 6561 726c 6965 7374 2074 696d 652e 0a20  earliest time.. 
-0001c5c0: 2020 2020 2020 203a 7061 7261 6d20 746f         :param to
-0001c5d0: 705f 6c65 7665 6c3a 2069 6620 7472 7565  p_level: if true
-0001c5e0: 2077 696c 6c20 7265 7475 726e 206f 6e6c   will return onl
-0001c5f0: 7920 726f 7574 6572 7320 616e 6420 656e  y routers and en
-0001c600: 6470 6f69 6e74 2074 6861 7420 6172 6520  dpoint that are 
-0001c610: 4e4f 5420 6368 696c 6472 656e 206f 6620  NOT children of 
-0001c620: 616e 7920 726f 7574 6572 0a20 2020 2020  any router.     
-0001c630: 2020 203a 7061 7261 6d20 7569 6473 3a20     :param uids: 
-0001c640: 6966 2070 6173 7365 6420 7769 6c6c 2072  if passed will r
-0001c650: 6574 7572 6e20 6120 6c69 7374 2060 4d6f  eturn a list `Mo
-0001c660: 6465 6c45 6e64 706f 696e 7460 206f 626a  delEndpoint` obj
-0001c670: 6563 7420 7769 7468 2075 6964 2069 6e20  ect with uid in 
-0001c680: 7569 6473 0a20 2020 2020 2020 2022 2222  uids.        """
-0001c690: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
-0001c6a0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-0001c6b0: 6a65 6374 7d2f 6d6f 6465 6c2d 656e 6470  ject}/model-endp
-0001c6c0: 6f69 6e74 7322 0a0a 2020 2020 2020 2020  oints"..        
-0001c6d0: 6966 206c 6162 656c 7320 616e 6420 6973  if labels and is
-0001c6e0: 696e 7374 616e 6365 286c 6162 656c 732c  instance(labels,
-0001c6f0: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
-0001c700: 2020 2020 6c61 6265 6c73 203d 205b 6622      labels = [f"
-0001c710: 7b6b 6579 7d3d 7b76 616c 7565 7d22 2066  {key}={value}" f
-0001c720: 6f72 206b 6579 2c20 7661 6c75 6520 696e  or key, value in
-0001c730: 206c 6162 656c 732e 6974 656d 7328 295d   labels.items()]
-0001c740: 0a0a 2020 2020 2020 2020 7265 7370 6f6e  ..        respon
-0001c750: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
-0001c760: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-0001c770: 6d65 7468 6f64 3d22 4745 5422 2c0a 2020  method="GET",.  
-0001c780: 2020 2020 2020 2020 2020 7061 7468 3d70            path=p
-0001c790: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-0001c7a0: 2070 6172 616d 733d 7b0a 2020 2020 2020   params={.      
-0001c7b0: 2020 2020 2020 2020 2020 226d 6f64 656c            "model
-0001c7c0: 223a 206d 6f64 656c 2c0a 2020 2020 2020  ": model,.      
-0001c7d0: 2020 2020 2020 2020 2020 2266 756e 6374            "funct
-0001c7e0: 696f 6e22 3a20 6675 6e63 7469 6f6e 2c0a  ion": function,.
-0001c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c800: 226c 6162 656c 223a 206c 6162 656c 7320  "label": labels 
-0001c810: 6f72 205b 5d2c 0a20 2020 2020 2020 2020  or [],.         
-0001c820: 2020 2020 2020 2022 7374 6172 7422 3a20         "start": 
-0001c830: 7374 6172 742c 0a20 2020 2020 2020 2020  start,.         
-0001c840: 2020 2020 2020 2022 656e 6422 3a20 656e         "end": en
-0001c850: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0001c860: 2020 2022 6d65 7472 6963 223a 206d 6574     "metric": met
-0001c870: 7269 6373 206f 7220 5b5d 2c0a 2020 2020  rics or [],.    
-0001c880: 2020 2020 2020 2020 2020 2020 2274 6f70              "top
-0001c890: 2d6c 6576 656c 223a 2074 6f70 5f6c 6576  -level": top_lev
-0001c8a0: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
-0001c8b0: 2020 2020 2275 6964 223a 2075 6964 732c      "uid": uids,
-0001c8c0: 0a20 2020 2020 2020 2020 2020 207d 2c0a  .            },.
-0001c8d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0001c8e0: 2020 2023 2047 656e 6572 6174 6520 6120     # Generate a 
-0001c8f0: 6c69 7374 206f 6620 6120 6d6f 6465 6c20  list of a model 
-0001c900: 656e 6470 6f69 6e74 2064 6963 7469 6f6e  endpoint diction
-0001c910: 6172 6965 730a 2020 2020 2020 2020 6d6f  aries.        mo
-0001c920: 6465 6c5f 656e 6470 6f69 6e74 7320 3d20  del_endpoints = 
-0001c930: 7265 7370 6f6e 7365 2e6a 736f 6e28 295b  response.json()[
-0001c940: 2265 6e64 706f 696e 7473 225d 0a20 2020  "endpoints"].   
-0001c950: 2020 2020 2069 6620 6d6f 6465 6c5f 656e       if model_en
-0001c960: 6470 6f69 6e74 733a 0a20 2020 2020 2020  dpoints:.       
-0001c970: 2020 2020 2072 6574 7572 6e20 5b0a 2020       return [.  
-0001c980: 2020 2020 2020 2020 2020 2020 2020 6d6c                ml
-0001c990: 7275 6e2e 6d6f 6465 6c5f 6d6f 6e69 746f  run.model_monito
-0001c9a0: 7269 6e67 2e6d 6f64 656c 5f65 6e64 706f  ring.model_endpo
-0001c9b0: 696e 742e 4d6f 6465 6c45 6e64 706f 696e  int.ModelEndpoin
-0001c9c0: 742e 6672 6f6d 5f64 6963 7428 6f62 6a29  t.from_dict(obj)
-0001c9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c9e0: 2066 6f72 206f 626a 2069 6e20 6d6f 6465   for obj in mode
-0001c9f0: 6c5f 656e 6470 6f69 6e74 730a 2020 2020  l_endpoints.    
-0001ca00: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-0001ca10: 2020 7265 7475 726e 205b 5d0a 0a20 2020    return []..   
-0001ca20: 2064 6566 2067 6574 5f6d 6f64 656c 5f65   def get_model_e
-0001ca30: 6e64 706f 696e 7428 0a20 2020 2020 2020  ndpoint(.       
-0001ca40: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-0001ca50: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
-0001ca60: 2020 2020 2065 6e64 706f 696e 745f 6964       endpoint_id
-0001ca70: 3a20 7374 722c 0a20 2020 2020 2020 2073  : str,.        s
-0001ca80: 7461 7274 3a20 4f70 7469 6f6e 616c 5b73  tart: Optional[s
-0001ca90: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-0001caa0: 2020 2020 656e 643a 204f 7074 696f 6e61      end: Optiona
-0001cab0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-0001cac0: 2020 2020 2020 206d 6574 7269 6373 3a20         metrics: 
-0001cad0: 4f70 7469 6f6e 616c 5b4c 6973 745b 7374  Optional[List[st
-0001cae0: 725d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  r]] = None,.    
-0001caf0: 2020 2020 6665 6174 7572 655f 616e 616c      feature_anal
-0001cb00: 7973 6973 3a20 626f 6f6c 203d 2046 616c  ysis: bool = Fal
-0001cb10: 7365 2c0a 2020 2020 2920 2d3e 206d 6c72  se,.    ) -> mlr
-0001cb20: 756e 2e6d 6f64 656c 5f6d 6f6e 6974 6f72  un.model_monitor
-0001cb30: 696e 672e 6d6f 6465 6c5f 656e 6470 6f69  ing.model_endpoi
-0001cb40: 6e74 2e4d 6f64 656c 456e 6470 6f69 6e74  nt.ModelEndpoint
-0001cb50: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001cb60: 2020 2020 2020 5265 7475 726e 7320 6120        Returns a 
-0001cb70: 7369 6e67 6c65 2060 4d6f 6465 6c45 6e64  single `ModelEnd
-0001cb80: 706f 696e 7460 206f 626a 6563 7420 7769  point` object wi
-0001cb90: 7468 2061 6464 6974 696f 6e61 6c20 6d65  th additional me
-0001cba0: 7472 6963 7320 616e 6420 6665 6174 7572  trics and featur
-0001cbb0: 6520 7265 6c61 7465 6420 6461 7461 2e0a  e related data..
-0001cbc0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001cbd0: 7072 6f6a 6563 743a 2020 2020 2020 2020  project:        
-0001cbe0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-0001cbf0: 6e61 6d65 206f 6620 7468 6520 7072 6f6a  name of the proj
-0001cc00: 6563 740a 2020 2020 2020 2020 3a70 6172  ect.        :par
-0001cc10: 616d 2065 6e64 706f 696e 745f 6964 3a20  am endpoint_id: 
-0001cc20: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0001cc30: 6865 2075 6e69 7175 6520 6964 206f 6620  he unique id of 
-0001cc40: 7468 6520 6d6f 6465 6c20 656e 6470 6f69  the model endpoi
-0001cc50: 6e74 2e0a 2020 2020 2020 2020 3a70 6172  nt..        :par
-0001cc60: 616d 2073 7461 7274 3a20 2020 2020 2020  am start:       
-0001cc70: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0001cc80: 6865 2073 7461 7274 2074 696d 6520 6f66  he start time of
-0001cc90: 2074 6865 206d 6574 7269 6373 2e20 4361   the metrics. Ca
-0001cca0: 6e20 6265 2072 6570 7265 7365 6e74 6564  n be represented
-0001ccb0: 2062 7920 6120 7374 7269 6e67 2063 6f6e   by a string con
-0001ccc0: 7461 696e 696e 6720 616e 0a20 2020 2020  taining an.     
-0001ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccf0: 2020 2020 2020 5246 4320 3333 3339 2074        RFC 3339 t
-0001cd00: 696d 652c 2061 2055 6e69 7820 7469 6d65  ime, a Unix time
-0001cd10: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
-0001cd20: 636f 6e64 732c 2061 2072 656c 6174 6976  conds, a relativ
-0001cd30: 6520 7469 6d65 2028 6027 6e6f 7727 6020  e time (`'now'` 
-0001cd40: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
-0001cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd60: 2020 2020 2020 2020 2020 2020 2020 6027                `'
-0001cd70: 6e6f 772d 5b30 2d39 5d2b 5b6d 6864 5d27  now-[0-9]+[mhd]'
-0001cd80: 602c 2077 6865 7265 2060 6d60 203d 206d  `, where `m` = m
-0001cd90: 696e 7574 6573 2c20 6068 6020 3d20 686f  inutes, `h` = ho
-0001cda0: 7572 732c 2061 6e64 2060 2764 2760 203d  urs, and `'d'` =
-0001cdb0: 2064 6179 7329 2c20 6f72 0a20 2020 2020   days), or.     
-0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000290: 7970 696e 670a 6672 6f6d 2064 6174 6574  yping.from datet
+000002a0: 696d 6520 696d 706f 7274 2064 6174 6574  ime import datet
+000002b0: 696d 650a 6672 6f6d 206f 7320 696d 706f  ime.from os impo
+000002c0: 7274 2070 6174 682c 2072 656d 6f76 650a  rt path, remove.
+000002d0: 6672 6f6d 2074 7970 696e 6720 696d 706f  from typing impo
+000002e0: 7274 2044 6963 742c 204c 6973 742c 204f  rt Dict, List, O
+000002f0: 7074 696f 6e61 6c2c 2055 6e69 6f6e 0a66  ptional, Union.f
+00000300: 726f 6d20 7572 6c6c 6962 2e70 6172 7365  rom urllib.parse
+00000310: 2069 6d70 6f72 7420 7572 6c70 6172 7365   import urlparse
+00000320: 0a0a 696d 706f 7274 206b 6670 0a69 6d70  ..import kfp.imp
+00000330: 6f72 7420 7265 7175 6573 7473 0a69 6d70  ort requests.imp
+00000340: 6f72 7420 7365 6d76 6572 0a0a 696d 706f  ort semver..impo
+00000350: 7274 206d 6c72 756e 0a69 6d70 6f72 7420  rt mlrun.import 
+00000360: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00000370: 656d 6173 0a69 6d70 6f72 7420 6d6c 7275  emas.import mlru
+00000380: 6e2e 6d6f 6465 6c5f 6d6f 6e69 746f 7269  n.model_monitori
+00000390: 6e67 2e6d 6f64 656c 5f65 6e64 706f 696e  ng.model_endpoin
+000003a0: 740a 696d 706f 7274 206d 6c72 756e 2e70  t.import mlrun.p
+000003b0: 6c61 7466 6f72 6d73 0a69 6d70 6f72 7420  latforms.import 
+000003c0: 6d6c 7275 6e2e 7072 6f6a 6563 7473 0a66  mlrun.projects.f
+000003d0: 726f 6d20 6d6c 7275 6e2e 6572 726f 7273  rom mlrun.errors
+000003e0: 2069 6d70 6f72 7420 4d4c 5275 6e49 6e76   import MLRunInv
+000003f0: 616c 6964 4172 6775 6d65 6e74 4572 726f  alidArgumentErro
+00000400: 722c 2065 7272 5f74 6f5f 7374 720a 0a66  r, err_to_str..f
+00000410: 726f 6d20 2e2e 6172 7469 6661 6374 7320  rom ..artifacts 
+00000420: 696d 706f 7274 2041 7274 6966 6163 740a  import Artifact.
+00000430: 6672 6f6d 202e 2e63 6f6e 6669 6720 696d  from ..config im
+00000440: 706f 7274 2063 6f6e 6669 670a 6672 6f6d  port config.from
+00000450: 202e 2e66 6561 7475 7265 5f73 746f 7265   ..feature_store
+00000460: 2069 6d70 6f72 7420 4665 6174 7572 6553   import FeatureS
+00000470: 6574 2c20 4665 6174 7572 6556 6563 746f  et, FeatureVecto
+00000480: 720a 6672 6f6d 202e 2e6c 6973 7473 2069  r.from ..lists i
+00000490: 6d70 6f72 7420 4172 7469 6661 6374 4c69  mport ArtifactLi
+000004a0: 7374 2c20 5275 6e4c 6973 740a 6672 6f6d  st, RunList.from
+000004b0: 202e 2e72 756e 7469 6d65 7320 696d 706f   ..runtimes impo
+000004c0: 7274 2042 6173 6552 756e 7469 6d65 0a66  rt BaseRuntime.f
+000004d0: 726f 6d20 2e2e 7574 696c 7320 696d 706f  rom ..utils impo
+000004e0: 7274 2028 0a20 2020 2064 6174 6574 696d  rt (.    datetim
+000004f0: 655f 746f 5f69 736f 2c0a 2020 2020 6469  e_to_iso,.    di
+00000500: 6374 5f74 6f5f 6a73 6f6e 2c0a 2020 2020  ct_to_json,.    
+00000510: 6c6f 6767 6572 2c0a 2020 2020 6e65 775f  logger,.    new_
+00000520: 7069 7065 5f6d 6574 6164 6174 612c 0a20  pipe_metadata,. 
+00000530: 2020 206e 6f72 6d61 6c69 7a65 5f6e 616d     normalize_nam
+00000540: 652c 0a20 2020 2076 6572 7369 6f6e 2c0a  e,.    version,.
+00000550: 290a 6672 6f6d 202e 6261 7365 2069 6d70  ).from .base imp
+00000560: 6f72 7420 5275 6e44 4245 7272 6f72 2c20  ort RunDBError, 
+00000570: 5275 6e44 4249 6e74 6572 6661 6365 0a0a  RunDBInterface..
+00000580: 5f61 7274 6966 6163 745f 6b65 7973 203d  _artifact_keys =
+00000590: 205b 0a20 2020 2022 666f 726d 6174 222c   [.    "format",
+000005a0: 0a20 2020 2022 696e 6c69 6e65 222c 0a20  .    "inline",. 
+000005b0: 2020 2022 6b65 7922 2c0a 2020 2020 2273     "key",.    "s
+000005c0: 7263 5f70 6174 6822 2c0a 2020 2020 2274  rc_path",.    "t
+000005d0: 6172 6765 745f 7061 7468 222c 0a20 2020  arget_path",.   
+000005e0: 2022 7669 6577 6572 222c 0a5d 0a0a 0a64   "viewer",.]...d
+000005f0: 6566 2062 6f6f 6c32 7374 7228 7661 6c29  ef bool2str(val)
+00000600: 3a0a 2020 2020 7265 7475 726e 2022 7965  :.    return "ye
+00000610: 7322 2069 6620 7661 6c20 656c 7365 2022  s" if val else "
+00000620: 6e6f 220a 0a0a 636c 6173 7320 4854 5450  no"...class HTTP
+00000630: 5275 6e44 4228 5275 6e44 4249 6e74 6572  RunDB(RunDBInter
+00000640: 6661 6365 293a 0a20 2020 2022 2222 496e  face):.    """In
+00000650: 7465 7266 6163 6520 666f 7220 6163 6365  terface for acce
+00000660: 7373 696e 6720 616e 6420 6d61 6e69 7075  ssing and manipu
+00000670: 6c61 7469 6e67 2074 6865 203a 7079 3a6d  lating the :py:m
+00000680: 6f64 3a60 6d6c 7275 6e60 2070 6572 7369  od:`mlrun` persi
+00000690: 7374 656e 7420 7374 6f72 652c 206d 6169  stent store, mai
+000006a0: 6e74 6169 6e69 6e67 2074 6865 2066 756c  ntaining the ful
+000006b0: 6c20 7374 6174 650a 2020 2020 616e 6420  l state.    and 
+000006c0: 6361 7461 6c6f 6720 6f66 206f 626a 6563  catalog of objec
+000006d0: 7473 2074 6861 7420 4d4c 5275 6e20 7573  ts that MLRun us
+000006e0: 6573 2e20 5468 6520 3a70 793a 636c 6173  es. The :py:clas
+000006f0: 733a 6048 5454 5052 756e 4442 6020 636c  s:`HTTPRunDB` cl
+00000700: 6173 7320 7365 7276 6573 2061 7320 6120  ass serves as a 
+00000710: 636c 6965 6e74 2d73 6964 6520 7072 6f78  client-side prox
+00000720: 7920 746f 2074 6865 204d 4c52 756e 0a20  y to the MLRun. 
+00000730: 2020 2041 5049 2073 6572 7669 6365 2077     API service w
+00000740: 6869 6368 206d 6169 6e74 6169 6e73 2074  hich maintains t
+00000750: 6865 2061 6374 7561 6c20 6461 7461 2d73  he actual data-s
+00000760: 746f 7265 2c20 6163 6365 7373 6573 2074  tore, accesses t
+00000770: 6865 2073 6572 7665 7220 7468 726f 7567  he server throug
+00000780: 6820 5245 5354 2041 5049 732e 0a0a 2020  h REST APIs...  
+00000790: 2020 5468 6520 636c 6173 7320 7072 6f76    The class prov
+000007a0: 6964 6573 2066 756e 6374 696f 6e73 2066  ides functions f
+000007b0: 6f72 2061 6363 6573 7369 6e67 2061 6e64  or accessing and
+000007c0: 206d 6f64 6966 7969 6e67 2074 6865 2076   modifying the v
+000007d0: 6172 696f 7573 206f 626a 6563 7473 2074  arious objects t
+000007e0: 6861 7420 6172 6520 7573 6564 2062 7920  hat are used by 
+000007f0: 4d4c 5275 6e20 696e 2069 7473 0a20 2020  MLRun in its.   
+00000800: 206f 7065 7261 7469 6f6e 2e20 5468 6520   operation. The 
+00000810: 6675 6e63 7469 6f6e 7320 7072 6f76 6964  functions provid
+00000820: 6564 2066 6f6c 6c6f 7720 736f 6d65 2073  ed follow some s
+00000830: 7461 6e64 6172 6420 6775 6964 656c 696e  tandard guidelin
+00000840: 6573 2c20 7768 6963 6820 6172 653a 0a0a  es, which are:..
+00000850: 2020 2020 2d20 4576 6572 7920 6f62 6a65      - Every obje
+00000860: 6374 2069 6e20 4d4c 5275 6e20 6578 6973  ct in MLRun exis
+00000870: 7473 2069 6e20 7468 6520 636f 6e74 6578  ts in the contex
+00000880: 7420 6f66 2061 2070 726f 6a65 6374 2028  t of a project (
+00000890: 6578 6365 7074 2070 726f 6a65 6374 7320  except projects 
+000008a0: 7468 656d 7365 6c76 6573 292e 2057 6865  themselves). Whe
+000008b0: 6e20 7265 6665 7265 6e63 696e 6720 616e  n referencing an
+000008c0: 206f 626a 6563 740a 2020 2020 2020 7468   object.      th
+000008d0: 726f 7567 6820 616e 7920 4150 492c 2061  rough any API, a
+000008e0: 2070 726f 6a65 6374 206e 616d 6520 6d75   project name mu
+000008f0: 7374 2062 6520 7072 6f76 6964 6564 2e20  st be provided. 
+00000900: 5468 6520 6465 6661 756c 7420 666f 7220  The default for 
+00000910: 6d6f 7374 2041 5049 7320 6973 2066 6f72  most APIs is for
+00000920: 2061 6e20 656d 7074 7920 7072 6f6a 6563   an empty projec
+00000930: 7420 6e61 6d65 2c20 7768 6963 680a 2020  t name, which.  
+00000940: 2020 2020 7769 6c6c 2062 6520 7265 706c      will be repl
+00000950: 6163 6564 2062 7920 7468 6520 6e61 6d65  aced by the name
+00000960: 206f 6620 7468 6520 6465 6661 756c 7420   of the default 
+00000970: 7072 6f6a 6563 7420 2875 7375 616c 6c79  project (usually
+00000980: 2060 6064 6566 6175 6c74 6060 292e 2054   ``default``). T
+00000990: 6865 7265 666f 7265 2c20 6966 2070 6572  herefore, if per
+000009a0: 666f 726d 696e 6720 616e 2041 5049 2074  forming an API t
+000009b0: 6f0a 2020 2020 2020 6c69 7374 2066 756e  o.      list fun
+000009c0: 6374 696f 6e73 2c20 666f 7220 6578 616d  ctions, for exam
+000009d0: 706c 652c 2061 6e64 206e 6f74 2070 726f  ple, and not pro
+000009e0: 7669 6469 6e67 2061 2070 726f 6a65 6374  viding a project
+000009f0: 206e 616d 6520 2d20 7468 6520 7265 7375   name - the resu
+00000a00: 6c74 2077 696c 6c20 6e6f 7420 6265 2066  lt will not be f
+00000a10: 756e 6374 696f 6e73 2066 726f 6d20 616c  unctions from al
+00000a20: 6c0a 2020 2020 2020 7072 6f6a 6563 7473  l.      projects
+00000a30: 2062 7574 2072 6174 6865 7220 6672 6f6d   but rather from
+00000a40: 2074 6865 2060 6064 6566 6175 6c74 6060   the ``default``
+00000a50: 2070 726f 6a65 6374 2e0a 2020 2020 2d20   project..    - 
+00000a60: 4d61 6e79 206f 626a 6563 7473 2063 616e  Many objects can
+00000a70: 2062 6520 6173 7369 676e 6564 206c 6162   be assigned lab
+00000a80: 656c 732c 2061 6e64 206c 6973 7465 642f  els, and listed/
+00000a90: 7175 6572 6965 6420 6279 206c 6162 656c  queried by label
+00000aa0: 2e20 5468 6520 6c61 6265 6c20 7061 7261  . The label para
+00000ab0: 6d65 7465 7220 666f 7220 7175 6572 7920  meter for query 
+00000ac0: 4150 4973 2061 6c6c 6f77 7320 666f 720a  APIs allows for.
+00000ad0: 2020 2020 2020 6c69 7374 696e 6720 6f62        listing ob
+00000ae0: 6a65 6374 7320 7468 6174 3a0a 0a20 2020  jects that:..   
+00000af0: 2020 202d 2048 6176 6520 6120 7370 6563     - Have a spec
+00000b00: 6966 6963 206c 6162 656c 2c20 6279 2061  ific label, by a
+00000b10: 736b 696e 6720 666f 7220 6060 6c61 6265  sking for ``labe
+00000b20: 6c3d 223c 6c61 6265 6c5f 6e61 6d65 3e22  l="<label_name>"
+00000b30: 6060 2e20 496e 2074 6869 7320 6361 7365  ``. In this case
+00000b40: 2074 6865 2061 6374 7561 6c20 7661 6c75   the actual valu
+00000b50: 6520 6f66 2074 6865 206c 6162 656c 0a20  e of the label. 
+00000b60: 2020 2020 2020 2064 6f65 736e 2774 206d         doesn't m
+00000b70: 6174 7465 7220 616e 6420 6576 6572 7920  atter and every 
+00000b80: 6f62 6a65 6374 2077 6974 6820 7468 6174  object with that
+00000b90: 206c 6162 656c 2077 696c 6c20 6265 2072   label will be r
+00000ba0: 6574 7572 6e65 640a 2020 2020 2020 2d20  eturned.      - 
+00000bb0: 4861 7665 2061 206c 6162 656c 2077 6974  Have a label wit
+00000bc0: 6820 6120 7370 6563 6966 6963 2076 616c  h a specific val
+00000bd0: 7565 2e20 5468 6973 2069 7320 646f 6e65  ue. This is done
+00000be0: 2062 7920 7370 6563 6966 7969 6e67 2060   by specifying `
+00000bf0: 606c 6162 656c 3d22 3c6c 6162 656c 5f6e  `label="<label_n
+00000c00: 616d 653e 3d3c 6c61 6265 6c5f 7661 6c75  ame>=<label_valu
+00000c10: 653e 2260 602e 2049 6e20 7468 6973 0a20  e>"``. In this. 
+00000c20: 2020 2020 2020 2063 6173 6520 6f6e 6c79         case only
+00000c30: 206f 626a 6563 7473 2077 686f 7365 206c   objects whose l
+00000c40: 6162 656c 206d 6174 6368 6573 2074 6865  abel matches the
+00000c50: 2076 616c 7565 2077 696c 6c20 6265 2072   value will be r
+00000c60: 6574 7572 6e65 640a 0a20 2020 202d 204d  eturned..    - M
+00000c70: 6f73 7420 6f62 6a65 6374 7320 6861 7665  ost objects have
+00000c80: 2061 2060 6063 7265 6174 6560 6020 6d65   a ``create`` me
+00000c90: 7468 6f64 2061 7320 7765 6c6c 2061 7320  thod as well as 
+00000ca0: 6120 6060 7374 6f72 6560 6020 6d65 7468  a ``store`` meth
+00000cb0: 6f64 2e20 4372 6561 7465 2063 616e 206f  od. Create can o
+00000cc0: 6e6c 7920 6265 2063 616c 6c65 6420 7768  nly be called wh
+00000cd0: 656e 2073 7563 6820 616e 0a20 2020 2020  en such an.     
+00000ce0: 2064 6f65 7320 6e6f 7420 6578 6973 7420   does not exist 
+00000cf0: 7965 742c 2077 6869 6c65 2073 746f 7265  yet, while store
+00000d00: 2061 6c6c 6f77 7320 666f 7220 6569 7468   allows for eith
+00000d10: 6572 2063 7265 6174 696e 6720 6120 6e65  er creating a ne
+00000d20: 7720 6f62 6a65 6374 206f 7220 6f76 6572  w object or over
+00000d30: 7772 6974 696e 6720 616e 2065 7869 7374  writing an exist
+00000d40: 696e 6720 6f62 6a65 6374 2e0a 2020 2020  ing object..    
+00000d50: 2d20 536f 6d65 206f 626a 6563 7473 2068  - Some objects h
+00000d60: 6176 6520 6120 6060 7665 7273 696f 6e65  ave a ``versione
+00000d70: 6460 6020 6f70 7469 6f6e 2c20 696e 2077  d`` option, in w
+00000d80: 6869 6368 2063 6173 6520 6f76 6572 7772  hich case overwr
+00000d90: 6974 696e 6720 7468 6520 7361 6d65 206f  iting the same o
+00000da0: 626a 6563 7420 7769 7468 2061 2064 6966  bject with a dif
+00000db0: 6665 7265 6e74 2076 6572 7369 6f6e 206f  ferent version o
+00000dc0: 660a 2020 2020 2020 6974 2064 6f65 7320  f.      it does 
+00000dd0: 6e6f 7420 6465 6c65 7465 2074 6865 2070  not delete the p
+00000de0: 7265 7669 6f75 7320 7665 7273 696f 6e2c  revious version,
+00000df0: 2062 7574 2072 6174 6865 7220 6372 6561   but rather crea
+00000e00: 7465 7320 6120 6e65 7720 7665 7273 696f  tes a new versio
+00000e10: 6e20 6f66 2074 6865 206f 626a 6563 7420  n of the object 
+00000e20: 616e 6420 6b65 6570 7320 626f 7468 2076  and keeps both v
+00000e30: 6572 7369 6f6e 732e 0a20 2020 2020 2056  ersions..      V
+00000e40: 6572 7369 6f6e 6564 206f 626a 6563 7473  ersioned objects
+00000e50: 2075 7375 616c 6c79 2068 6176 6520 6120   usually have a 
+00000e60: 6060 7569 6460 6020 7072 6f70 6572 7479  ``uid`` property
+00000e70: 2077 6869 6368 2069 7320 6261 7365 6420   which is based 
+00000e80: 6f6e 2074 6865 6972 2063 6f6e 7465 6e74  on their content
+00000e90: 2061 6e64 2061 6c6c 6f77 7320 746f 2072   and allows to r
+00000ea0: 6566 6572 656e 6365 2061 0a20 2020 2020  eference a.     
+00000eb0: 2073 7065 6369 6669 6320 7665 7273 696f   specific versio
+00000ec0: 6e20 6f66 2061 6e20 6f62 6a65 6374 2028  n of an object (
+00000ed0: 6f74 6865 7220 7468 616e 2074 6167 6769  other than taggi
+00000ee0: 6e67 206f 626a 6563 7473 2c20 7768 6963  ng objects, whic
+00000ef0: 6820 616c 736f 2061 6c6c 6f77 7320 666f  h also allows fo
+00000f00: 7220 6561 7379 2072 6566 6572 656e 6369  r easy referenci
+00000f10: 6e67 292e 0a20 2020 202d 204d 616e 7920  ng)..    - Many 
+00000f20: 6f62 6a65 6374 7320 6861 7665 2062 6f74  objects have bot
+00000f30: 6820 6120 6060 7374 6f72 6560 6020 6675  h a ``store`` fu
+00000f40: 6e63 7469 6f6e 2061 6e64 2061 2060 6070  nction and a ``p
+00000f50: 6174 6368 6060 2066 756e 6374 696f 6e2e  atch`` function.
+00000f60: 2054 6865 7365 2061 7265 2075 7365 6420   These are used 
+00000f70: 696e 2074 6865 2073 616d 6520 7761 7920  in the same way 
+00000f80: 6173 2074 6865 0a20 2020 2020 2063 6f72  as the.      cor
+00000f90: 7265 7370 6f6e 6469 6e67 2052 4553 5420  responding REST 
+00000fa0: 7665 7262 7320 2d20 6120 6060 7374 6f72  verbs - a ``stor
+00000fb0: 6560 6020 6973 2070 6173 7365 6420 6120  e`` is passed a 
+00000fc0: 6675 6c6c 206f 626a 6563 7420 616e 6420  full object and 
+00000fd0: 7769 6c6c 2062 6173 6963 616c 6c79 2070  will basically p
+00000fe0: 6572 666f 726d 2061 2050 5554 206f 7065  erform a PUT ope
+00000ff0: 7261 7469 6f6e 2c0a 2020 2020 2020 7265  ration,.      re
+00001000: 706c 6163 696e 6720 7468 6520 6675 6c6c  placing the full
+00001010: 206f 626a 6563 7420 2869 6620 6974 2065   object (if it e
+00001020: 7869 7374 7329 2077 6869 6c65 2060 6070  xists) while ``p
+00001030: 6174 6368 6060 2072 6563 6569 7665 7320  atch`` receives 
+00001040: 6a75 7374 2061 2064 6963 7469 6f6e 6172  just a dictionar
+00001050: 7920 636f 6e74 6169 6e69 6e67 2074 6865  y containing the
+00001060: 2064 6966 6665 7265 6e63 6573 2074 6f0a   differences to.
+00001070: 2020 2020 2020 6265 2061 7070 6c69 6564        be applied
+00001080: 2074 6f20 7468 6520 6f62 6a65 6374 2c20   to the object, 
+00001090: 616e 6420 7769 6c6c 206d 6572 6765 2074  and will merge t
+000010a0: 686f 7365 2063 6861 6e67 6573 2074 6f20  hose changes to 
+000010b0: 7468 6520 6578 6973 7469 6e67 206f 626a  the existing obj
+000010c0: 6563 742e 2054 6865 2060 6070 6174 6368  ect. The ``patch
+000010d0: 6060 0a20 2020 2020 206f 7065 7261 7469  ``.      operati
+000010e0: 6f6e 2061 6c73 6f20 6861 7320 6120 7374  on also has a st
+000010f0: 7261 7465 6779 2061 7373 6967 6e65 6420  rategy assigned 
+00001100: 746f 2069 7420 7768 6963 6820 6465 7465  to it which dete
+00001110: 726d 696e 6573 2068 6f77 2074 6865 206d  rmines how the m
+00001120: 6572 6765 206c 6f67 6963 2073 686f 756c  erge logic shoul
+00001130: 6420 6265 6861 7665 2e0a 2020 2020 2020  d behave..      
+00001140: 5468 6520 7374 7261 7465 6779 2063 616e  The strategy can
+00001150: 2062 6520 6569 7468 6572 2060 6072 6570   be either ``rep
+00001160: 6c61 6365 6060 206f 7220 6060 6164 6469  lace`` or ``addi
+00001170: 7469 7665 6060 2e20 466f 7220 6675 7274  tive``. For furt
+00001180: 6865 7220 6465 7461 696c 7320 6f6e 2074  her details on t
+00001190: 686f 7365 2073 7472 6174 6567 6965 732c  hose strategies,
+000011a0: 2072 6566 6572 0a20 2020 2020 2074 6f20   refer.      to 
+000011b0: 6874 7470 733a 2f2f 7079 7069 2e6f 7267  https://pypi.org
+000011c0: 2f70 726f 6a65 6374 2f6d 6572 6765 6465  /project/mergede
+000011d0: 6570 2f0a 2020 2020 2222 220a 0a20 2020  ep/.    """..   
+000011e0: 206b 696e 6420 3d20 2268 7474 7022 0a20   kind = "http". 
+000011f0: 2020 2023 2062 7920 6465 6661 756c 7420     # by default 
+00001200: 7765 2064 6f6e 2774 2072 6574 7279 206f  we don't retry o
+00001210: 6e20 504f 5354 2072 6571 7565 7374 2061  n POST request a
+00001220: 7320 7468 6579 2061 7265 2075 7375 616c  s they are usual
+00001230: 6c79 206e 6f74 2069 6465 6d70 6f74 656e  ly not idempoten
+00001240: 740a 2020 2020 2320 6865 7265 2069 7320  t.    # here is 
+00001250: 6120 6c69 7374 206f 6620 6964 656e 7469  a list of identi
+00001260: 6669 6564 2050 4f53 5420 7265 7175 6573  fied POST reques
+00001270: 7473 2074 6861 7420 6172 6520 6964 656d  ts that are idem
+00001280: 706f 7465 6e74 2028 2773 746f 7265 2720  potent ('store' 
+00001290: 7673 2027 6372 6561 7465 2729 2061 6e64  vs 'create') and
+000012a0: 2063 616e 2062 6520 7265 7472 6965 640a   can be retried.
+000012b0: 2020 2020 5245 5452 4941 424c 455f 504f      RETRIABLE_PO
+000012c0: 5354 5f50 4154 4853 203d 205b 0a20 2020  ST_PATHS = [.   
+000012d0: 2020 2020 2072 225c 2f3f 7072 6f6a 6563       r"\/?projec
+000012e0: 7473 5c2f 2e2b 5c2f 6172 7469 6661 6374  ts\/.+\/artifact
+000012f0: 735c 2f2e 2b5c 2f2e 2b22 2c0a 2020 2020  s\/.+\/.+",.    
+00001300: 2020 2020 7222 5c2f 3f72 756e 5c2f 2e2b      r"\/?run\/.+
+00001310: 5c2f 2e2b 222c 0a20 2020 205d 0a0a 2020  \/.+",.    ]..  
+00001320: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+00001330: 656c 662c 2075 726c 293a 0a20 2020 2020  elf, url):.     
+00001340: 2020 2073 656c 662e 7365 7276 6572 5f76     self.server_v
+00001350: 6572 7369 6f6e 203d 2022 220a 2020 2020  ersion = "".    
+00001360: 2020 2020 7365 6c66 2e73 6573 7369 6f6e      self.session
+00001370: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00001380: 7365 6c66 2e5f 7761 6974 5f66 6f72 5f70  self._wait_for_p
+00001390: 726f 6a65 6374 5f74 6572 6d69 6e61 6c5f  roject_terminal_
+000013a0: 7374 6174 655f 7265 7472 795f 696e 7465  state_retry_inte
+000013b0: 7276 616c 203d 2033 0a20 2020 2020 2020  rval = 3.       
+000013c0: 2073 656c 662e 5f77 6169 745f 666f 725f   self._wait_for_
+000013d0: 6261 636b 6772 6f75 6e64 5f74 6173 6b5f  background_task_
+000013e0: 7465 726d 696e 616c 5f73 7461 7465 5f72  terminal_state_r
+000013f0: 6574 7279 5f69 6e74 6572 7661 6c20 3d20  etry_interval = 
+00001400: 330a 2020 2020 2020 2020 7365 6c66 2e5f  3.        self._
+00001410: 7761 6974 5f66 6f72 5f70 726f 6a65 6374  wait_for_project
+00001420: 5f64 656c 6574 696f 6e5f 696e 7465 7276  _deletion_interv
+00001430: 616c 203d 2033 0a20 2020 2020 2020 2073  al = 3.        s
+00001440: 656c 662e 636c 6965 6e74 5f76 6572 7369  elf.client_versi
+00001450: 6f6e 203d 2076 6572 7369 6f6e 2e56 6572  on = version.Ver
+00001460: 7369 6f6e 2829 2e67 6574 2829 5b22 7665  sion().get()["ve
+00001470: 7273 696f 6e22 5d0a 2020 2020 2020 2020  rsion"].        
+00001480: 7365 6c66 2e70 7974 686f 6e5f 7665 7273  self.python_vers
+00001490: 696f 6e20 3d20 7374 7228 7665 7273 696f  ion = str(versio
+000014a0: 6e2e 5665 7273 696f 6e28 292e 6765 745f  n.Version().get_
+000014b0: 7079 7468 6f6e 5f76 6572 7369 6f6e 2829  python_version()
+000014c0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000014d0: 5f65 6e72 6963 685f 616e 645f 7661 6c69  _enrich_and_vali
+000014e0: 6461 7465 2875 726c 290a 0a20 2020 2064  date(url)..    d
+000014f0: 6566 205f 656e 7269 6368 5f61 6e64 5f76  ef _enrich_and_v
+00001500: 616c 6964 6174 6528 7365 6c66 2c20 7572  alidate(self, ur
+00001510: 6c29 3a0a 2020 2020 2020 2020 7061 7273  l):.        pars
+00001520: 6564 5f75 726c 203d 2075 726c 7061 7273  ed_url = urlpars
+00001530: 6528 7572 6c29 0a20 2020 2020 2020 2073  e(url).        s
+00001540: 6368 656d 6520 3d20 7061 7273 6564 5f75  cheme = parsed_u
+00001550: 726c 2e73 6368 656d 652e 6c6f 7765 7228  rl.scheme.lower(
+00001560: 290a 2020 2020 2020 2020 6966 2073 6368  ).        if sch
+00001570: 656d 6520 6e6f 7420 696e 2028 2268 7474  eme not in ("htt
+00001580: 7022 2c20 2268 7474 7073 2229 3a0a 2020  p", "https"):.  
+00001590: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000015a0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000015b0: 2020 2020 2020 2020 2020 2020 6622 496e              f"In
+000015c0: 7661 6c69 6420 5552 4c20 7363 6865 6d65  valid URL scheme
+000015d0: 207b 7363 6865 6d65 7d20 666f 7220 4854   {scheme} for HT
+000015e0: 5450 5275 6e44 422c 206f 6e6c 7920 6874  TPRunDB, only ht
+000015f0: 7470 2873 2920 6973 2073 7570 706f 7274  tp(s) is support
+00001600: 6564 220a 2020 2020 2020 2020 2020 2020  ed".            
+00001610: 290a 0a20 2020 2020 2020 2065 6e64 706f  )..        endpo
+00001620: 696e 7420 3d20 7061 7273 6564 5f75 726c  int = parsed_url
+00001630: 2e68 6f73 746e 616d 650a 2020 2020 2020  .hostname.      
+00001640: 2020 6966 2070 6172 7365 645f 7572 6c2e    if parsed_url.
+00001650: 706f 7274 3a0a 2020 2020 2020 2020 2020  port:.          
+00001660: 2020 656e 6470 6f69 6e74 202b 3d20 6622    endpoint += f"
+00001670: 3a7b 7061 7273 6564 5f75 726c 2e70 6f72  :{parsed_url.por
+00001680: 747d 220a 2020 2020 2020 2020 6261 7365  t}".        base
+00001690: 5f75 726c 203d 2066 227b 7061 7273 6564  _url = f"{parsed
+000016a0: 5f75 726c 2e73 6368 656d 657d 3a2f 2f7b  _url.scheme}://{
+000016b0: 656e 6470 6f69 6e74 7d7b 7061 7273 6564  endpoint}{parsed
+000016c0: 5f75 726c 2e70 6174 687d 220a 0a20 2020  _url.path}"..   
+000016d0: 2020 2020 2075 7365 726e 616d 6520 3d20       username = 
+000016e0: 7061 7273 6564 5f75 726c 2e75 7365 726e  parsed_url.usern
+000016f0: 616d 6520 6f72 2063 6f6e 6669 672e 6874  ame or config.ht
+00001700: 7470 6462 2e75 7365 720a 2020 2020 2020  tpdb.user.      
+00001710: 2020 7061 7373 776f 7264 203d 2070 6172    password = par
+00001720: 7365 645f 7572 6c2e 7061 7373 776f 7264  sed_url.password
+00001730: 206f 7220 636f 6e66 6967 2e68 7474 7064   or config.httpd
+00001740: 622e 7061 7373 776f 7264 0a0a 2020 2020  b.password..    
+00001750: 2020 2020 7573 6572 6e61 6d65 2c20 7061      username, pa
+00001760: 7373 776f 7264 2c20 746f 6b65 6e20 3d20  ssword, token = 
+00001770: 6d6c 7275 6e2e 706c 6174 666f 726d 732e  mlrun.platforms.
+00001780: 6164 645f 6f72 5f72 6566 7265 7368 5f63  add_or_refresh_c
+00001790: 7265 6465 6e74 6961 6c73 280a 2020 2020  redentials(.    
+000017a0: 2020 2020 2020 2020 7061 7273 6564 5f75          parsed_u
+000017b0: 726c 2e68 6f73 746e 616d 652c 2075 7365  rl.hostname, use
+000017c0: 726e 616d 652c 2070 6173 7377 6f72 642c  rname, password,
+000017d0: 2063 6f6e 6669 672e 6874 7470 6462 2e74   config.httpdb.t
+000017e0: 6f6b 656e 0a20 2020 2020 2020 2029 0a0a  oken.        )..
+000017f0: 2020 2020 2020 2020 7365 6c66 2e62 6173          self.bas
+00001800: 655f 7572 6c20 3d20 6261 7365 5f75 726c  e_url = base_url
+00001810: 0a20 2020 2020 2020 2073 656c 662e 7573  .        self.us
+00001820: 6572 203d 2075 7365 726e 616d 650a 2020  er = username.  
+00001830: 2020 2020 2020 7365 6c66 2e70 6173 7377        self.passw
+00001840: 6f72 6420 3d20 7061 7373 776f 7264 0a20  ord = password. 
+00001850: 2020 2020 2020 2073 656c 662e 746f 6b65         self.toke
+00001860: 6e20 3d20 746f 6b65 6e0a 0a20 2020 2064  n = token..    d
+00001870: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
+00001880: 293a 0a20 2020 2020 2020 2063 6c73 203d  ):.        cls =
+00001890: 2073 656c 662e 5f5f 636c 6173 735f 5f2e   self.__class__.
+000018a0: 5f5f 6e61 6d65 5f5f 0a20 2020 2020 2020  __name__.       
+000018b0: 2072 6574 7572 6e20 6622 7b63 6c73 7d28   return f"{cls}(
+000018c0: 7b73 656c 662e 6261 7365 5f75 726c 2172  {self.base_url!r
+000018d0: 7d29 220a 0a20 2020 2040 7374 6174 6963  })"..    @static
+000018e0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+000018f0: 6574 5f61 7069 5f70 6174 685f 7072 6566  et_api_path_pref
+00001900: 6978 2876 6572 7369 6f6e 3a20 7374 7220  ix(version: str 
+00001910: 3d20 4e6f 6e65 2920 2d3e 2073 7472 3a0a  = None) -> str:.
+00001920: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00001930: 2020 2020 3a70 6172 616d 2076 6572 7369      :param versi
+00001940: 6f6e 3a20 4150 4920 7665 7273 696f 6e20  on: API version 
+00001950: 746f 2075 7365 2c20 4e6f 6e65 2028 7468  to use, None (th
+00001960: 6520 6465 6661 756c 7429 2077 696c 6c20  e default) will 
+00001970: 6d65 616e 2074 6f20 7573 6520 7468 6520  mean to use the 
+00001980: 6465 6661 756c 7420 7661 6c75 6520 6672  default value fr
+00001990: 6f6d 206d 6c63 6f6e 662c 0a20 2020 2020  om mlconf,.     
+000019a0: 2020 2020 666f 7220 756e 2d76 6572 7369      for un-versi
+000019b0: 6f6e 6564 2061 7069 2073 6574 2061 6e20  oned api set an 
+000019c0: 656d 7074 7920 7374 7269 6e67 2e0a 2020  empty string..  
+000019d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000019e0: 2020 6966 2076 6572 7369 6f6e 2069 7320    if version is 
+000019f0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00001a00: 2020 2020 2020 7265 7475 726e 2066 2261        return f"a
+00001a10: 7069 2f7b 7665 7273 696f 6e7d 2220 6966  pi/{version}" if
+00001a20: 2076 6572 7369 6f6e 2065 6c73 6520 2261   version else "a
+00001a30: 7069 220a 0a20 2020 2020 2020 2061 7069  pi"..        api
+00001a40: 5f76 6572 7369 6f6e 5f70 6174 6820 3d20  _version_path = 
+00001a50: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
+00001a60: 6170 692f 7b63 6f6e 6669 672e 6170 695f  api/{config.api_
+00001a70: 6261 7365 5f76 6572 7369 6f6e 7d22 2069  base_version}" i
+00001a80: 6620 636f 6e66 6967 2e61 7069 5f62 6173  f config.api_bas
+00001a90: 655f 7665 7273 696f 6e20 656c 7365 2022  e_version else "
+00001aa0: 6170 6922 0a20 2020 2020 2020 2029 0a20  api".        ). 
+00001ab0: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
+00001ac0: 695f 7665 7273 696f 6e5f 7061 7468 0a0a  i_version_path..
+00001ad0: 2020 2020 6465 6620 6765 745f 6261 7365      def get_base
+00001ae0: 5f61 7069 5f75 726c 2873 656c 662c 2070  _api_url(self, p
+00001af0: 6174 683a 2073 7472 2c20 7665 7273 696f  ath: str, versio
+00001b00: 6e3a 2073 7472 203d 204e 6f6e 6529 202d  n: str = None) -
+00001b10: 3e20 7374 723a 0a20 2020 2020 2020 2070  > str:.        p
+00001b20: 6174 685f 7072 6566 6978 203d 2073 656c  ath_prefix = sel
+00001b30: 662e 6765 745f 6170 695f 7061 7468 5f70  f.get_api_path_p
+00001b40: 7265 6669 7828 7665 7273 696f 6e29 0a20  refix(version). 
+00001b50: 2020 2020 2020 2075 726c 203d 2066 227b         url = f"{
+00001b60: 7365 6c66 2e62 6173 655f 7572 6c7d 2f7b  self.base_url}/{
+00001b70: 7061 7468 5f70 7265 6669 787d 2f7b 7061  path_prefix}/{pa
+00001b80: 7468 7d22 0a20 2020 2020 2020 2072 6574  th}".        ret
+00001b90: 7572 6e20 7572 6c0a 0a20 2020 2064 6566  urn url..    def
+00001ba0: 2061 7069 5f63 616c 6c28 0a20 2020 2020   api_call(.     
+00001bb0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00001bc0: 206d 6574 686f 642c 0a20 2020 2020 2020   method,.       
+00001bd0: 2070 6174 682c 0a20 2020 2020 2020 2065   path,.        e
+00001be0: 7272 6f72 3d4e 6f6e 652c 0a20 2020 2020  rror=None,.     
+00001bf0: 2020 2070 6172 616d 733d 4e6f 6e65 2c0a     params=None,.
+00001c00: 2020 2020 2020 2020 626f 6479 3d4e 6f6e          body=Non
+00001c10: 652c 0a20 2020 2020 2020 206a 736f 6e3d  e,.        json=
+00001c20: 4e6f 6e65 2c0a 2020 2020 2020 2020 6865  None,.        he
+00001c30: 6164 6572 733d 4e6f 6e65 2c0a 2020 2020  aders=None,.    
+00001c40: 2020 2020 7469 6d65 6f75 743d 3435 2c0a      timeout=45,.
+00001c50: 2020 2020 2020 2020 7665 7273 696f 6e3d          version=
+00001c60: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
+00001c70: 2020 2020 2022 2222 5065 7266 6f72 6d20       """Perform 
+00001c80: 6120 6469 7265 6374 2052 4553 5420 4150  a direct REST AP
+00001c90: 4920 6361 6c6c 206f 6e20 7468 6520 3a70  I call on the :p
+00001ca0: 793a 6d6f 643a 606d 6c72 756e 6020 4150  y:mod:`mlrun` AP
+00001cb0: 4920 7365 7276 6572 2e0a 0a20 2020 2020  I server...     
+00001cc0: 2020 2043 6175 7469 6f6e 3a0a 2020 2020     Caution:.    
+00001cd0: 2020 2020 2020 2020 466f 7220 6164 7661          For adva
+00001ce0: 6e63 6564 2075 7361 6765 202d 2070 7265  nced usage - pre
+00001cf0: 6665 7220 7573 696e 6720 7468 6520 7661  fer using the va
+00001d00: 7269 6f75 7320 4150 4973 2065 7870 6f73  rious APIs expos
+00001d10: 6564 2074 6872 6f75 6768 2074 6869 7320  ed through this 
+00001d20: 636c 6173 732c 2072 6174 6865 7220 7468  class, rather th
+00001d30: 616e 0a20 2020 2020 2020 2020 2020 2064  an.            d
+00001d40: 6972 6563 746c 7920 696e 766f 6b69 6e67  irectly invoking
+00001d50: 2052 4553 5420 6361 6c6c 732e 0a0a 2020   REST calls...  
+00001d60: 2020 2020 2020 3a70 6172 616d 206d 6574        :param met
+00001d70: 686f 643a 2052 4553 5420 6d65 7468 6f64  hod: REST method
+00001d80: 2028 504f 5354 2c20 4745 542c 2050 5554   (POST, GET, PUT
+00001d90: 2e2e 2e29 0a20 2020 2020 2020 203a 7061  ...).        :pa
+00001da0: 7261 6d20 7061 7468 3a20 5061 7468 2074  ram path: Path t
+00001db0: 6f20 656e 6470 6f69 6e74 2065 7865 6375  o endpoint execu
+00001dc0: 7465 642c 2066 6f72 2065 7861 6d70 6c65  ted, for example
+00001dd0: 2060 6022 7072 6f6a 6563 7473 2260 600a   ``"projects"``.
+00001de0: 2020 2020 2020 2020 3a70 6172 616d 2065          :param e
+00001df0: 7272 6f72 3a20 4572 726f 7220 746f 2072  rror: Error to r
+00001e00: 6574 7572 6e20 6966 2041 5049 2069 6e76  eturn if API inv
+00001e10: 6f63 6174 696f 6e20 6661 696c 730a 2020  ocation fails.  
+00001e20: 2020 2020 2020 3a70 6172 616d 2070 6172        :param par
+00001e30: 616d 733a 2052 6573 7420 7061 7261 6d65  ams: Rest parame
+00001e40: 7465 7273 2c20 7061 7373 6564 2061 7320  ters, passed as 
+00001e50: 6120 6469 6374 696f 6e61 7279 3a20 6060  a dictionary: ``
+00001e60: 7b22 3c70 6172 616d 2d6e 616d 653e 223a  {"<param-name>":
+00001e70: 203c 2270 6172 616d 2d76 616c 7565 223e   <"param-value">
+00001e80: 7d60 600a 2020 2020 2020 2020 3a70 6172  }``.        :par
+00001e90: 616d 2062 6f64 793a 2050 6179 6c6f 6164  am body: Payload
+00001ea0: 2074 6f20 6265 2070 6173 7365 6420 696e   to be passed in
+00001eb0: 2074 6865 2063 616c 6c2e 2049 6620 7573   the call. If us
+00001ec0: 696e 6720 4a53 4f4e 206f 626a 6563 7473  ing JSON objects
+00001ed0: 2c20 7072 6566 6572 2075 7369 6e67 2074  , prefer using t
+00001ee0: 6865 2060 606a 736f 6e60 6020 7061 7261  he ``json`` para
+00001ef0: 6d0a 2020 2020 2020 2020 3a70 6172 616d  m.        :param
+00001f00: 206a 736f 6e3a 204a 534f 4e20 7061 796c   json: JSON payl
+00001f10: 6f61 6420 746f 2062 6520 7061 7373 6564  oad to be passed
+00001f20: 2069 6e20 7468 6520 6361 6c6c 0a20 2020   in the call.   
+00001f30: 2020 2020 203a 7061 7261 6d20 6865 6164       :param head
+00001f40: 6572 733a 2052 4553 5420 6865 6164 6572  ers: REST header
+00001f50: 732c 2070 6173 7365 6420 6173 2061 2064  s, passed as a d
+00001f60: 6963 7469 6f6e 6172 793a 2060 607b 223c  ictionary: ``{"<
+00001f70: 6865 6164 6572 2d6e 616d 653e 223a 2022  header-name>": "
+00001f80: 3c68 6561 6465 722d 7661 6c75 653e 227d  <header-value>"}
+00001f90: 6060 0a20 2020 2020 2020 203a 7061 7261  ``.        :para
+00001fa0: 6d20 7469 6d65 6f75 743a 2041 5049 2063  m timeout: API c
+00001fb0: 616c 6c20 7469 6d65 6f75 740a 2020 2020  all timeout.    
+00001fc0: 2020 2020 3a70 6172 616d 2076 6572 7369      :param versi
+00001fd0: 6f6e 3a20 4150 4920 7665 7273 696f 6e20  on: API version 
+00001fe0: 746f 2075 7365 2c20 4e6f 6e65 2028 7468  to use, None (th
+00001ff0: 6520 6465 6661 756c 7429 2077 696c 6c20  e default) will 
+00002000: 6d65 616e 2074 6f20 7573 6520 7468 6520  mean to use the 
+00002010: 6465 6661 756c 7420 7661 6c75 6520 6672  default value fr
+00002020: 6f6d 2063 6f6e 6669 672c 0a20 2020 2020  om config,.     
+00002030: 2020 2020 666f 7220 756e 2d76 6572 7369      for un-versi
+00002040: 6f6e 6564 2061 7069 2073 6574 2061 6e20  oned api set an 
+00002050: 656d 7074 7920 7374 7269 6e67 2e0a 0a20  empty string... 
+00002060: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+00002070: 5079 7468 6f6e 2048 5454 5020 7265 7370  Python HTTP resp
+00002080: 6f6e 7365 206f 626a 6563 740a 2020 2020  onse object.    
+00002090: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000020a0: 7572 6c20 3d20 7365 6c66 2e67 6574 5f62  url = self.get_b
+000020b0: 6173 655f 6170 695f 7572 6c28 7061 7468  ase_api_url(path
+000020c0: 2c20 7665 7273 696f 6e29 0a20 2020 2020  , version).     
+000020d0: 2020 206b 7720 3d20 7b0a 2020 2020 2020     kw = {.      
+000020e0: 2020 2020 2020 6b65 793a 2076 616c 7565        key: value
+000020f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00002100: 206b 6579 2c20 7661 6c75 6520 696e 2028   key, value in (
+00002110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002120: 2028 2270 6172 616d 7322 2c20 7061 7261   ("params", para
+00002130: 6d73 292c 0a20 2020 2020 2020 2020 2020  ms),.           
+00002140: 2020 2020 2028 2264 6174 6122 2c20 626f       ("data", bo
+00002150: 6479 292c 0a20 2020 2020 2020 2020 2020  dy),.           
+00002160: 2020 2020 2028 226a 736f 6e22 2c20 6a73       ("json", js
+00002170: 6f6e 292c 0a20 2020 2020 2020 2020 2020  on),.           
+00002180: 2020 2020 2028 2268 6561 6465 7273 222c       ("headers",
+00002190: 2068 6561 6465 7273 292c 0a20 2020 2020   headers),.     
+000021a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000021b0: 2020 2020 2069 6620 7661 6c75 6520 6973       if value is
+000021c0: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
+000021d0: 2020 7d0a 0a20 2020 2020 2020 2069 6620    }..        if 
+000021e0: 7365 6c66 2e75 7365 723a 0a20 2020 2020  self.user:.     
+000021f0: 2020 2020 2020 206b 775b 2261 7574 6822         kw["auth"
+00002200: 5d20 3d20 2873 656c 662e 7573 6572 2c20  ] = (self.user, 
+00002210: 7365 6c66 2e70 6173 7377 6f72 6429 0a20  self.password). 
+00002220: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00002230: 2e74 6f6b 656e 3a0a 2020 2020 2020 2020  .token:.        
+00002240: 2020 2020 2320 4967 7561 7a69 6f20 6175      # Iguazio au
+00002250: 7468 2064 6f65 736e 2774 2073 7570 706f  th doesn't suppo
+00002260: 7274 2070 6173 7369 6e67 2074 6f6b 656e  rt passing token
+00002270: 2074 6872 6f75 6768 2062 6561 7265 722c   through bearer,
+00002280: 2073 6f20 7573 6520 636f 6f6b 6965 2069   so use cookie i
+00002290: 6e73 7465 6164 0a20 2020 2020 2020 2020  nstead.         
+000022a0: 2020 2069 6620 6d6c 7275 6e2e 706c 6174     if mlrun.plat
+000022b0: 666f 726d 732e 6967 7561 7a69 6f2e 6973  forms.iguazio.is
+000022c0: 5f69 6775 617a 696f 5f73 6573 7369 6f6e  _iguazio_session
+000022d0: 2873 656c 662e 746f 6b65 6e29 3a0a 2020  (self.token):.  
+000022e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000022f0: 7373 696f 6e5f 636f 6f6b 6965 203d 2066  ssion_cookie = f
+00002300: 276a 3a7b 7b22 7369 6422 3a20 227b 7365  'j:{{"sid": "{se
+00002310: 6c66 2e74 6f6b 656e 7d22 7d7d 270a 2020  lf.token}"}}'.  
+00002320: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00002330: 6f6b 6965 7320 3d20 7b0a 2020 2020 2020  okies = {.      
+00002340: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+00002350: 6573 7369 6f6e 223a 2073 6573 7369 6f6e  ession": session
+00002360: 5f63 6f6f 6b69 652c 0a20 2020 2020 2020  _cookie,.       
+00002370: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00002380: 2020 2020 2020 2020 2020 206b 775b 2263             kw["c
+00002390: 6f6f 6b69 6573 225d 203d 2063 6f6f 6b69  ookies"] = cooki
+000023a0: 6573 0a20 2020 2020 2020 2020 2020 2065  es.            e
+000023b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000023c0: 2020 2020 2069 6620 2241 7574 686f 7269       if "Authori
+000023d0: 7a61 7469 6f6e 2220 6e6f 7420 696e 206b  zation" not in k
+000023e0: 772e 7365 7464 6566 6175 6c74 2822 6865  w.setdefault("he
+000023f0: 6164 6572 7322 2c20 7b7d 293a 0a20 2020  aders", {}):.   
+00002400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002410: 206b 775b 2268 6561 6465 7273 225d 2e75   kw["headers"].u
+00002420: 7064 6174 6528 7b22 4175 7468 6f72 697a  pdate({"Authoriz
+00002430: 6174 696f 6e22 3a20 2242 6561 7265 7220  ation": "Bearer 
+00002440: 2220 2b20 7365 6c66 2e74 6f6b 656e 7d29  " + self.token})
+00002450: 0a0a 2020 2020 2020 2020 6966 206d 6c72  ..        if mlr
+00002460: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+00002470: 732e 4865 6164 6572 4e61 6d65 732e 636c  s.HeaderNames.cl
+00002480: 6965 6e74 5f76 6572 7369 6f6e 206e 6f74  ient_version not
+00002490: 2069 6e20 6b77 2e73 6574 6465 6661 756c   in kw.setdefaul
+000024a0: 7428 0a20 2020 2020 2020 2020 2020 2022  t(.            "
+000024b0: 6865 6164 6572 7322 2c20 7b7d 0a20 2020  headers", {}.   
+000024c0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+000024d0: 2020 2020 6b77 5b22 6865 6164 6572 7322      kw["headers"
+000024e0: 5d2e 7570 6461 7465 280a 2020 2020 2020  ].update(.      
+000024f0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+00002500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002510: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00002520: 656d 6173 2e48 6561 6465 724e 616d 6573  emas.HeaderNames
+00002530: 2e63 6c69 656e 745f 7665 7273 696f 6e3a  .client_version:
+00002540: 2073 656c 662e 636c 6965 6e74 5f76 6572   self.client_ver
+00002550: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
+00002560: 2020 2020 2020 2020 2020 6d6c 7275 6e2e            mlrun.
+00002570: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e48  common.schemas.H
+00002580: 6561 6465 724e 616d 6573 2e70 7974 686f  eaderNames.pytho
+00002590: 6e5f 7665 7273 696f 6e3a 2073 656c 662e  n_version: self.
+000025a0: 7079 7468 6f6e 5f76 6572 7369 6f6e 2c0a  python_version,.
+000025b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025c0: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
+000025d0: 0a20 2020 2020 2020 2023 2072 6571 7565  .        # reque
+000025e0: 7374 7320 6e6f 206c 6f6e 6765 7220 7375  sts no longer su
+000025f0: 7070 6f72 7473 2068 6561 6465 7220 7661  pports header va
+00002600: 6c75 6573 2074 6f20 6265 2065 6e75 6d20  lues to be enum 
+00002610: 2868 7474 7073 3a2f 2f67 6974 6875 622e  (https://github.
+00002620: 636f 6d2f 7073 662f 7265 7175 6573 7473  com/psf/requests
+00002630: 2f70 756c 6c2f 3631 3534 290a 2020 2020  /pull/6154).    
+00002640: 2020 2020 2320 636f 6e76 6572 7420 746f      # convert to
+00002650: 2073 7472 696e 6773 2e20 446f 2074 6865   strings. Do the
+00002660: 2073 616d 6520 666f 7220 7061 7261 6d73   same for params
+00002670: 2066 6f72 206e 6963 656e 6573 730a 2020   for niceness.  
+00002680: 2020 2020 2020 666f 7220 6469 6374 5f20        for dict_ 
+00002690: 696e 205b 6865 6164 6572 732c 2070 6172  in [headers, par
+000026a0: 616d 735d 3a0a 2020 2020 2020 2020 2020  ams]:.          
+000026b0: 2020 6966 2064 6963 745f 2069 7320 6e6f    if dict_ is no
+000026c0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000026d0: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
+000026e0: 696e 2064 6963 745f 2e6b 6579 7328 293a  in dict_.keys():
+000026f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002700: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00002710: 6365 2864 6963 745f 5b6b 6579 5d2c 2065  ce(dict_[key], e
+00002720: 6e75 6d2e 456e 756d 293a 0a20 2020 2020  num.Enum):.     
+00002730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002740: 2020 2064 6963 745f 5b6b 6579 5d20 3d20     dict_[key] = 
+00002750: 6469 6374 5f5b 6b65 795d 2e76 616c 7565  dict_[key].value
+00002760: 0a0a 2020 2020 2020 2020 2320 6966 2074  ..        # if t
+00002770: 6865 206d 6574 686f 6420 6973 2050 4f53  he method is POS
+00002780: 542c 2077 6520 6e65 6564 2074 6f20 7570  T, we need to up
+00002790: 6461 7465 2074 6865 2073 6573 7369 6f6e  date the session
+000027a0: 2077 6974 6820 7468 6520 6170 7072 6f70   with the approp
+000027b0: 7269 6174 6520 7265 7472 7920 706f 6c69  riate retry poli
+000027c0: 6379 0a20 2020 2020 2020 2069 6620 6e6f  cy.        if no
+000027d0: 7420 7365 6c66 2e73 6573 7369 6f6e 206f  t self.session o
+000027e0: 7220 6d65 7468 6f64 203d 3d20 2250 4f53  r method == "POS
+000027f0: 5422 3a0a 2020 2020 2020 2020 2020 2020  T":.            
+00002800: 7265 7472 795f 6f6e 5f70 6f73 7420 3d20  retry_on_post = 
+00002810: 7365 6c66 2e5f 6973 5f72 6574 7279 5f6f  self._is_retry_o
+00002820: 6e5f 706f 7374 5f61 6c6c 6f77 6564 286d  n_post_allowed(m
+00002830: 6574 686f 642c 2070 6174 6829 0a20 2020  ethod, path).   
+00002840: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
+00002850: 7373 696f 6e20 3d20 7365 6c66 2e5f 696e  ssion = self._in
+00002860: 6974 5f73 6573 7369 6f6e 2872 6574 7279  it_session(retry
+00002870: 5f6f 6e5f 706f 7374 290a 0a20 2020 2020  _on_post)..     
+00002880: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00002890: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
+000028a0: 656c 662e 7365 7373 696f 6e2e 7265 7175  elf.session.requ
+000028b0: 6573 7428 0a20 2020 2020 2020 2020 2020  est(.           
+000028c0: 2020 2020 206d 6574 686f 642c 2075 726c       method, url
+000028d0: 2c20 7469 6d65 6f75 743d 7469 6d65 6f75  , timeout=timeou
+000028e0: 742c 2076 6572 6966 793d 4661 6c73 652c  t, verify=False,
+000028f0: 202a 2a6b 770a 2020 2020 2020 2020 2020   **kw.          
+00002900: 2020 290a 2020 2020 2020 2020 6578 6365    ).        exce
+00002910: 7074 2072 6571 7565 7374 732e 5265 7175  pt requests.Requ
+00002920: 6573 7445 7863 6570 7469 6f6e 2061 7320  estException as 
+00002930: 6578 633a 0a20 2020 2020 2020 2020 2020  exc:.           
+00002940: 2065 7272 6f72 203d 2066 227b 6572 725f   error = f"{err_
+00002950: 746f 5f73 7472 2865 7863 297d 3a20 7b65  to_str(exc)}: {e
+00002960: 7272 6f72 7d22 2069 6620 6572 726f 7220  rror}" if error 
+00002970: 656c 7365 2065 7272 5f74 6f5f 7374 7228  else err_to_str(
+00002980: 6578 6329 0a20 2020 2020 2020 2020 2020  exc).           
+00002990: 2072 6169 7365 206d 6c72 756e 2e65 7272   raise mlrun.err
+000029a0: 6f72 732e 4d4c 5275 6e52 756e 7469 6d65  ors.MLRunRuntime
+000029b0: 4572 726f 7228 6572 726f 7229 2066 726f  Error(error) fro
+000029c0: 6d20 6578 630a 0a20 2020 2020 2020 2069  m exc..        i
+000029d0: 6620 6e6f 7420 7265 7370 6f6e 7365 2e6f  f not response.o
+000029e0: 6b3a 0a20 2020 2020 2020 2020 2020 2069  k:.            i
+000029f0: 6620 7265 7370 6f6e 7365 2e63 6f6e 7465  f response.conte
+00002a00: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
+00002a10: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00002a20: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00002a30: 6120 3d20 7265 7370 6f6e 7365 2e6a 736f  a = response.jso
+00002a40: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
+00002a50: 2020 2020 2020 2020 6572 726f 725f 6465          error_de
+00002a60: 7461 696c 7320 3d20 6461 7461 2e67 6574  tails = data.get
+00002a70: 2822 6465 7461 696c 222c 207b 7d29 0a20  ("detail", {}). 
+00002a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a90: 2020 2069 6620 6e6f 7420 6572 726f 725f     if not error_
+00002aa0: 6465 7461 696c 733a 0a20 2020 2020 2020  details:.       
+00002ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ac0: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
+00002ad0: 2246 6169 6c65 6420 7061 7273 696e 6720  "Failed parsing 
+00002ae0: 6572 726f 7220 7265 7370 6f6e 7365 2062  error response b
+00002af0: 6f64 7922 2c20 6461 7461 3d64 6174 6129  ody", data=data)
+00002b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002b10: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00002b20: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+00002b30: 2020 2020 2020 2065 7272 6f72 5f64 6574         error_det
+00002b40: 6169 6c73 203d 2022 220a 2020 2020 2020  ails = "".      
+00002b50: 2020 2020 2020 2020 2020 6966 2065 7272            if err
+00002b60: 6f72 5f64 6574 6169 6c73 3a0a 2020 2020  or_details:.    
+00002b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b80: 6572 726f 725f 6465 7461 696c 7320 3d20  error_details = 
+00002b90: 6622 6465 7461 696c 733a 207b 6572 726f  f"details: {erro
+00002ba0: 725f 6465 7461 696c 737d 220a 2020 2020  r_details}".    
+00002bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002bc0: 6572 726f 7220 3d20 6622 7b65 7272 6f72  error = f"{error
+00002bd0: 7d20 7b65 7272 6f72 5f64 6574 6169 6c73  } {error_details
+00002be0: 7d22 2069 6620 6572 726f 7220 656c 7365  }" if error else
+00002bf0: 2065 7272 6f72 5f64 6574 6169 6c73 0a20   error_details. 
+00002c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c10: 2020 206d 6c72 756e 2e65 7272 6f72 732e     mlrun.errors.
+00002c20: 7261 6973 655f 666f 725f 7374 6174 7573  raise_for_status
+00002c30: 2872 6573 706f 6e73 652c 2065 7272 6f72  (response, error
+00002c40: 290a 0a20 2020 2020 2020 2020 2020 206d  )..            m
+00002c50: 6c72 756e 2e65 7272 6f72 732e 7261 6973  lrun.errors.rais
+00002c60: 655f 666f 725f 7374 6174 7573 2872 6573  e_for_status(res
+00002c70: 706f 6e73 652c 2065 7272 6f72 290a 0a20  ponse, error).. 
+00002c80: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00002c90: 7370 6f6e 7365 0a0a 2020 2020 6465 6620  sponse..    def 
+00002ca0: 5f69 6e69 745f 7365 7373 696f 6e28 7365  _init_session(se
+00002cb0: 6c66 2c20 7265 7472 795f 6f6e 5f70 6f73  lf, retry_on_pos
+00002cc0: 743a 2062 6f6f 6c20 3d20 4661 6c73 6529  t: bool = False)
+00002cd0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00002ce0: 206d 6c72 756e 2e75 7469 6c73 2e48 5454   mlrun.utils.HTT
+00002cf0: 5053 6573 7369 6f6e 5769 7468 5265 7472  PSessionWithRetr
+00002d00: 7928 0a20 2020 2020 2020 2020 2020 2072  y(.            r
+00002d10: 6574 7279 5f6f 6e5f 6578 6365 7074 696f  etry_on_exceptio
+00002d20: 6e3d 636f 6e66 6967 2e68 7474 7064 622e  n=config.httpdb.
+00002d30: 7265 7472 795f 6170 695f 6361 6c6c 5f6f  retry_api_call_o
+00002d40: 6e5f 6578 6365 7074 696f 6e0a 2020 2020  n_exception.    
+00002d50: 2020 2020 2020 2020 3d3d 206d 6c72 756e          == mlrun
+00002d60: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00002d70: 4854 5450 5365 7373 696f 6e52 6574 7279  HTTPSessionRetry
+00002d80: 4d6f 6465 2e65 6e61 626c 6564 2e76 616c  Mode.enabled.val
+00002d90: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00002da0: 7265 7472 795f 6f6e 5f70 6f73 743d 7265  retry_on_post=re
+00002db0: 7472 795f 6f6e 5f70 6f73 742c 0a20 2020  try_on_post,.   
+00002dc0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00002dd0: 5f70 6174 685f 6f66 2873 656c 662c 2070  _path_of(self, p
+00002de0: 7265 6669 782c 2070 726f 6a65 6374 2c20  refix, project, 
+00002df0: 7569 6429 3a0a 2020 2020 2020 2020 7072  uid):.        pr
+00002e00: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
+00002e10: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
+00002e20: 745f 7072 6f6a 6563 740a 2020 2020 2020  t_project.      
+00002e30: 2020 7265 7475 726e 2066 227b 7072 6566    return f"{pref
+00002e40: 6978 7d2f 7b70 726f 6a65 6374 7d2f 7b75  ix}/{project}/{u
+00002e50: 6964 7d22 0a0a 2020 2020 6465 6620 5f69  id}"..    def _i
+00002e60: 735f 7265 7472 795f 6f6e 5f70 6f73 745f  s_retry_on_post_
+00002e70: 616c 6c6f 7765 6428 7365 6c66 2c20 6d65  allowed(self, me
+00002e80: 7468 6f64 2c20 7061 7468 3a20 7374 7229  thod, path: str)
+00002e90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00002ea0: 2020 2020 2020 4368 6563 6b20 6966 2074        Check if t
+00002eb0: 6865 2067 6976 656e 2070 6174 6820 6973  he given path is
+00002ec0: 2061 6c6c 6f77 6564 2074 6f20 6265 2072   allowed to be r
+00002ed0: 6574 7269 6564 206f 6e20 504f 5354 206d  etried on POST m
+00002ee0: 6574 686f 640a 2020 2020 2020 2020 3a70  ethod.        :p
+00002ef0: 6172 616d 206d 6574 686f 643a 2020 7573  aram method:  us
+00002f00: 6564 2074 6f20 7665 7269 6679 2074 6861  ed to verify tha
+00002f10: 7420 7468 6520 6d65 7468 6f64 2069 7320  t the method is 
+00002f20: 504f 5354 2073 696e 6365 2069 6620 7468  POST since if th
+00002f30: 6572 6520 6973 206e 6f20 7365 7373 696f  ere is no sessio
+00002f40: 6e20 696e 6974 6961 6c69 7a65 6420 7468  n initialized th
+00002f50: 6572 6520 6973 206e 6f0a 2020 2020 2020  ere is no.      
+00002f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f70: 2020 6e65 6564 2074 6f20 696e 6974 6961    need to initia
+00002f80: 6c69 7a65 2069 7420 7769 7468 2072 6574  lize it with ret
+00002f90: 7279 2070 6f6c 6963 7920 666f 7220 504f  ry policy for PO
+00002fa0: 5354 2077 6865 6e20 7468 6520 6d65 7468  ST when the meth
+00002fb0: 6f64 2069 7320 6e6f 7420 504f 5354 0a20  od is not POST. 
+00002fc0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+00002fd0: 7468 3a20 2020 2074 6865 2070 6174 6820  th:    the path 
+00002fe0: 746f 2063 6865 636b 0a20 2020 2020 2020  to check.       
+00002ff0: 203a 7265 7475 726e 3a20 2020 2020 2020   :return:       
+00003000: 2054 7275 6520 6966 2074 6865 2070 6174   True if the pat
+00003010: 6820 6973 2061 6c6c 6f77 6564 2074 6f20  h is allowed to 
+00003020: 6265 2072 6574 7269 6564 206f 6e20 504f  be retried on PO
+00003030: 5354 206d 6574 686f 6420 616e 6420 6d65  ST method and me
+00003040: 7468 6f64 2069 7320 504f 5354 2c20 4661  thod is POST, Fa
+00003050: 6c73 6520 6f74 6865 7277 6973 650a 2020  lse otherwise.  
+00003060: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00003070: 2020 7265 7475 726e 206d 6574 686f 6420    return method 
+00003080: 3d3d 2022 504f 5354 2220 616e 6420 616e  == "POST" and an
+00003090: 7928 0a20 2020 2020 2020 2020 2020 2072  y(.            r
+000030a0: 652e 6d61 7463 6828 7265 6765 782c 2070  e.match(regex, p
+000030b0: 6174 6829 2066 6f72 2072 6567 6578 2069  ath) for regex i
+000030c0: 6e20 7365 6c66 2e52 4554 5249 4142 4c45  n self.RETRIABLE
+000030d0: 5f50 4f53 545f 5041 5448 530a 2020 2020  _POST_PATHS.    
+000030e0: 2020 2020 290a 0a20 2020 2064 6566 2063      )..    def c
+000030f0: 6f6e 6e65 6374 2873 656c 662c 2073 6563  onnect(self, sec
+00003100: 7265 7473 3d4e 6f6e 6529 3a0a 2020 2020  rets=None):.    
+00003110: 2020 2020 2222 2243 6f6e 6e65 6374 2074      """Connect t
+00003120: 6f20 7468 6520 4d4c 5275 6e20 4150 4920  o the MLRun API 
+00003130: 7365 7276 6572 2e20 4d75 7374 2062 6520  server. Must be 
+00003140: 6361 6c6c 6564 2070 7269 6f72 2074 6f20  called prior to 
+00003150: 6578 6563 7574 696e 6720 616e 7920 6f74  executing any ot
+00003160: 6865 7220 6d65 7468 6f64 2e0a 2020 2020  her method..    
+00003170: 2020 2020 5468 6520 636f 6465 2075 7469      The code uti
+00003180: 6c69 7a65 7320 7468 6520 5552 4c20 666f  lizes the URL fo
+00003190: 7220 7468 6520 4150 4920 7365 7276 6572  r the API server
+000031a0: 2066 726f 6d20 7468 6520 636f 6e66 6967   from the config
+000031b0: 7572 6174 696f 6e20 2d20 6060 6d6c 636f  uration - ``mlco
+000031c0: 6e66 2e64 6270 6174 6860 602e 0a0a 2020  nf.dbpath``...  
+000031d0: 2020 2020 2020 466f 7220 6578 616d 706c        For exampl
+000031e0: 653a 3a0a 0a20 2020 2020 2020 2020 2020  e::..           
+000031f0: 206d 6c63 6f6e 662e 6462 7061 7468 203d   mlconf.dbpath =
+00003200: 206d 6c63 6f6e 662e 6462 7061 7468 206f   mlconf.dbpath o
+00003210: 7220 2768 7474 703a 2f2f 6d6c 7275 6e2d  r 'http://mlrun-
+00003220: 6170 693a 3830 3830 270a 2020 2020 2020  api:8080'.      
+00003230: 2020 2020 2020 6462 203d 2067 6574 5f72        db = get_r
+00003240: 756e 5f64 6228 292e 636f 6e6e 6563 7428  un_db().connect(
+00003250: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
+00003260: 2020 2020 2020 2320 6861 636b 2074 6f20        # hack to 
+00003270: 616c 6c6f 7720 756e 6974 2074 6573 7473  allow unit tests
+00003280: 2074 6f20 696e 7374 616e 7469 6174 6520   to instantiate 
+00003290: 4854 5450 5275 6e44 4220 7769 7468 6f75  HTTPRunDB withou
+000032a0: 7420 6120 7265 616c 2073 6572 7665 7220  t a real server 
+000032b0: 6265 6869 6e64 0a20 2020 2020 2020 2069  behind.        i
+000032c0: 6620 226d 6f63 6b2d 7365 7276 6572 2220  f "mock-server" 
+000032d0: 696e 2073 656c 662e 6261 7365 5f75 726c  in self.base_url
+000032e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000032f0: 7475 726e 0a20 2020 2020 2020 2072 6573  turn.        res
+00003300: 7020 3d20 7365 6c66 2e61 7069 5f63 616c  p = self.api_cal
+00003310: 6c28 2247 4554 222c 2022 636c 6965 6e74  l("GET", "client
+00003320: 2d73 7065 6322 2c20 7469 6d65 6f75 743d  -spec", timeout=
+00003330: 3529 0a20 2020 2020 2020 2074 7279 3a0a  5).        try:.
+00003340: 2020 2020 2020 2020 2020 2020 7365 7276              serv
+00003350: 6572 5f63 6667 203d 2072 6573 702e 6a73  er_cfg = resp.js
+00003360: 6f6e 2829 0a20 2020 2020 2020 2020 2020  on().           
+00003370: 2073 656c 662e 7365 7276 6572 5f76 6572   self.server_ver
+00003380: 7369 6f6e 203d 2073 6572 7665 725f 6366  sion = server_cf
+00003390: 675b 2276 6572 7369 6f6e 225d 0a20 2020  g["version"].   
+000033a0: 2020 2020 2020 2020 2073 656c 662e 5f76           self._v
+000033b0: 616c 6964 6174 655f 7665 7273 696f 6e5f  alidate_version_
+000033c0: 636f 6d70 6174 6962 696c 6974 7928 7365  compatibility(se
+000033d0: 6c66 2e73 6572 7665 725f 7665 7273 696f  lf.server_versio
+000033e0: 6e2c 2063 6f6e 6669 672e 7665 7273 696f  n, config.versio
+000033f0: 6e29 0a20 2020 2020 2020 2020 2020 2063  n).            c
+00003400: 6f6e 6669 672e 6e61 6d65 7370 6163 6520  onfig.namespace 
+00003410: 3d20 636f 6e66 6967 2e6e 616d 6573 7061  = config.namespa
+00003420: 6365 206f 7220 7365 7276 6572 5f63 6667  ce or server_cfg
+00003430: 2e67 6574 2822 6e61 6d65 7370 6163 6522  .get("namespace"
+00003440: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00003450: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00003460: 2020 2022 6e61 6d65 7370 6163 6522 2069     "namespace" i
+00003470: 6e20 7365 7276 6572 5f63 6667 0a20 2020  n server_cfg.   
+00003480: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00003490: 2073 6572 7665 725f 6366 675b 226e 616d   server_cfg["nam
+000034a0: 6573 7061 6365 225d 2021 3d20 636f 6e66  espace"] != conf
+000034b0: 6967 2e6e 616d 6573 7061 6365 0a20 2020  ig.namespace.   
+000034c0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+000034d0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+000034e0: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
+000034f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003500: 6622 7761 726e 696e 6721 2c20 7365 7276  f"warning!, serv
+00003510: 6572 2028 7b73 6572 7665 725f 6366 675b  er ({server_cfg[
+00003520: 276e 616d 6573 7061 6365 275d 7d29 2061  'namespace']}) a
+00003530: 6e64 2063 6c69 656e 7420 287b 636f 6e66  nd client ({conf
+00003540: 6967 2e6e 616d 6573 7061 6365 7d29 220a  ig.namespace})".
+00003550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003560: 2020 2020 2220 6e61 6d65 7370 6163 6520      " namespace 
+00003570: 646f 6e27 7420 6d61 7463 6822 0a20 2020  don't match".   
+00003580: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00003590: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+000035a0: 6e66 6967 2e63 652e 6d6f 6465 2061 6e64  nfig.ce.mode and
+000035b0: 2063 6f6e 6669 672e 6365 2e6d 6f64 6520   config.ce.mode 
+000035c0: 213d 2073 6572 7665 725f 6366 672e 6765  != server_cfg.ge
+000035d0: 7428 2263 655f 6d6f 6465 222c 2022 2229  t("ce_mode", "")
+000035e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000035f0: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+00003600: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00003610: 2020 2020 2020 6622 7761 726e 696e 6721        f"warning!
+00003620: 2c20 7365 7276 6572 2028 7b73 6572 7665  , server ({serve
+00003630: 725f 6366 675b 2763 655f 6d6f 6465 275d  r_cfg['ce_mode']
+00003640: 7d29 2061 6e64 2063 6c69 656e 7420 287b  }) and client ({
+00003650: 636f 6e66 6967 2e63 652e 6d6f 6465 7d29  config.ce.mode})
+00003660: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00003670: 2020 2020 2020 2220 4345 206d 6f64 6520        " CE mode 
+00003680: 646f 6e27 7420 6d61 7463 6822 0a20 2020  don't match".   
+00003690: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000036a0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+000036b0: 672e 6365 203d 2073 6572 7665 725f 6366  g.ce = server_cf
+000036c0: 672e 6765 7428 2263 6522 2920 6f72 2063  g.get("ce") or c
+000036d0: 6f6e 6669 672e 6365 0a0a 2020 2020 2020  onfig.ce..      
+000036e0: 2020 2020 2020 2320 6765 7420 6465 6661        # get defa
+000036f0: 756c 7473 2066 726f 6d20 7265 6d6f 7465  ults from remote
+00003700: 2073 6572 7665 720a 2020 2020 2020 2020   server.        
+00003710: 2020 2020 636f 6e66 6967 2e72 656d 6f74      config.remot
+00003720: 655f 686f 7374 203d 2063 6f6e 6669 672e  e_host = config.
+00003730: 7265 6d6f 7465 5f68 6f73 7420 6f72 2073  remote_host or s
+00003740: 6572 7665 725f 6366 672e 6765 7428 2272  erver_cfg.get("r
+00003750: 656d 6f74 655f 686f 7374 2229 0a20 2020  emote_host").   
+00003760: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+00003770: 6d70 696a 6f62 5f63 7264 5f76 6572 7369  mpijob_crd_versi
+00003780: 6f6e 203d 2063 6f6e 6669 672e 6d70 696a  on = config.mpij
+00003790: 6f62 5f63 7264 5f76 6572 7369 6f6e 206f  ob_crd_version o
+000037a0: 7220 7365 7276 6572 5f63 6667 2e67 6574  r server_cfg.get
+000037b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000037c0: 2020 226d 7069 6a6f 625f 6372 645f 7665    "mpijob_crd_ve
+000037d0: 7273 696f 6e22 0a20 2020 2020 2020 2020  rsion".         
+000037e0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000037f0: 2063 6f6e 6669 672e 7569 2e75 726c 203d   config.ui.url =
+00003800: 2063 6f6e 6669 672e 7265 736f 6c76 655f   config.resolve_
+00003810: 7569 5f75 726c 2829 206f 7220 7365 7276  ui_url() or serv
+00003820: 6572 5f63 6667 2e67 6574 2822 7569 5f75  er_cfg.get("ui_u
+00003830: 726c 2229 0a20 2020 2020 2020 2020 2020  rl").           
+00003840: 2063 6f6e 6669 672e 6172 7469 6661 6374   config.artifact
+00003850: 5f70 6174 6820 3d20 636f 6e66 6967 2e61  _path = config.a
+00003860: 7274 6966 6163 745f 7061 7468 206f 7220  rtifact_path or 
+00003870: 7365 7276 6572 5f63 6667 2e67 6574 280a  server_cfg.get(.
+00003880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003890: 2261 7274 6966 6163 745f 7061 7468 220a  "artifact_path".
+000038a0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000038b0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+000038c0: 2e66 6561 7475 7265 5f73 746f 7265 2e64  .feature_store.d
+000038d0: 6174 615f 7072 6566 6978 6573 203d 2028  ata_prefixes = (
+000038e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000038f0: 2063 6f6e 6669 672e 6665 6174 7572 655f   config.feature_
+00003900: 7374 6f72 652e 6461 7461 5f70 7265 6669  store.data_prefi
+00003910: 7865 730a 2020 2020 2020 2020 2020 2020  xes.            
+00003920: 2020 2020 6f72 2073 6572 7665 725f 6366      or server_cf
+00003930: 672e 6765 7428 2266 6561 7475 7265 5f73  g.get("feature_s
+00003940: 746f 7265 5f64 6174 615f 7072 6566 6978  tore_data_prefix
+00003950: 6573 2229 0a20 2020 2020 2020 2020 2020  es").           
+00003960: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
+00003970: 6f6e 6669 672e 7370 6172 6b5f 6170 705f  onfig.spark_app_
+00003980: 696d 6167 6520 3d20 636f 6e66 6967 2e73  image = config.s
+00003990: 7061 726b 5f61 7070 5f69 6d61 6765 206f  park_app_image o
+000039a0: 7220 7365 7276 6572 5f63 6667 2e67 6574  r server_cfg.get
+000039b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000039c0: 2020 2273 7061 726b 5f61 7070 5f69 6d61    "spark_app_ima
+000039d0: 6765 220a 2020 2020 2020 2020 2020 2020  ge".            
+000039e0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+000039f0: 6e66 6967 2e73 7061 726b 5f61 7070 5f69  nfig.spark_app_i
+00003a00: 6d61 6765 5f74 6167 203d 2063 6f6e 6669  mage_tag = confi
+00003a10: 672e 7370 6172 6b5f 6170 705f 696d 6167  g.spark_app_imag
+00003a20: 655f 7461 6720 6f72 2073 6572 7665 725f  e_tag or server_
+00003a30: 6366 672e 6765 7428 0a20 2020 2020 2020  cfg.get(.       
+00003a40: 2020 2020 2020 2020 2022 7370 6172 6b5f           "spark_
+00003a50: 6170 705f 696d 6167 655f 7461 6722 0a20  app_image_tag". 
+00003a60: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00003a70: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+00003a80: 7370 6172 6b5f 6869 7374 6f72 795f 7365  spark_history_se
+00003a90: 7276 6572 5f70 6174 6820 3d20 280a 2020  rver_path = (.  
+00003aa0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00003ab0: 6e66 6967 2e73 7061 726b 5f68 6973 746f  nfig.spark_histo
+00003ac0: 7279 5f73 6572 7665 725f 7061 7468 0a20  ry_server_path. 
+00003ad0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00003ae0: 7220 7365 7276 6572 5f63 6667 2e67 6574  r server_cfg.get
+00003af0: 2822 7370 6172 6b5f 6869 7374 6f72 795f  ("spark_history_
+00003b00: 7365 7276 6572 5f70 6174 6822 290a 2020  server_path").  
+00003b10: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00003b20: 2020 2020 2020 2020 636f 6e66 6967 2e68          config.h
+00003b30: 7474 7064 622e 6275 696c 6465 722e 646f  ttpdb.builder.do
+00003b40: 636b 6572 5f72 6567 6973 7472 7920 3d20  cker_registry = 
+00003b50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00003b60: 2020 636f 6e66 6967 2e68 7474 7064 622e    config.httpdb.
+00003b70: 6275 696c 6465 722e 646f 636b 6572 5f72  builder.docker_r
+00003b80: 6567 6973 7472 790a 2020 2020 2020 2020  egistry.        
+00003b90: 2020 2020 2020 2020 6f72 2073 6572 7665          or serve
+00003ba0: 725f 6366 672e 6765 7428 2264 6f63 6b65  r_cfg.get("docke
+00003bb0: 725f 7265 6769 7374 7279 2229 0a20 2020  r_registry").   
+00003bc0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00003bd0: 2020 2020 2020 2063 6f6e 6669 672e 6874         config.ht
+00003be0: 7470 6462 2e61 7069 5f75 726c 203d 2063  tpdb.api_url = c
+00003bf0: 6f6e 6669 672e 6874 7470 6462 2e61 7069  onfig.httpdb.api
+00003c00: 5f75 726c 206f 7220 7365 7276 6572 5f63  _url or server_c
+00003c10: 6667 2e67 6574 2822 6170 695f 7572 6c22  fg.get("api_url"
+00003c20: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+00003c30: 6e66 6967 2e6e 7563 6c69 6f5f 7665 7273  nfig.nuclio_vers
+00003c40: 696f 6e20 3d20 636f 6e66 6967 2e6e 7563  ion = config.nuc
+00003c50: 6c69 6f5f 7665 7273 696f 6e20 6f72 2073  lio_version or s
+00003c60: 6572 7665 725f 6366 672e 6765 7428 0a20  erver_cfg.get(. 
+00003c70: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00003c80: 6e75 636c 696f 5f76 6572 7369 6f6e 220a  nuclio_version".
+00003c90: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00003ca0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00003cb0: 2e64 6566 6175 6c74 5f66 756e 6374 696f  .default_functio
+00003cc0: 6e5f 7072 696f 7269 7479 5f63 6c61 7373  n_priority_class
+00003cd0: 5f6e 616d 6520 3d20 280a 2020 2020 2020  _name = (.      
+00003ce0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00003cf0: 2e64 6566 6175 6c74 5f66 756e 6374 696f  .default_functio
+00003d00: 6e5f 7072 696f 7269 7479 5f63 6c61 7373  n_priority_class
+00003d10: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
+00003d20: 2020 2020 2020 6f72 2073 6572 7665 725f        or server_
+00003d30: 6366 672e 6765 7428 2264 6566 6175 6c74  cfg.get("default
+00003d40: 5f66 756e 6374 696f 6e5f 7072 696f 7269  _function_priori
+00003d50: 7479 5f63 6c61 7373 5f6e 616d 6522 290a  ty_class_name").
+00003d60: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00003d70: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00003d80: 2e76 616c 6964 5f66 756e 6374 696f 6e5f  .valid_function_
+00003d90: 7072 696f 7269 7479 5f63 6c61 7373 5f6e  priority_class_n
+00003da0: 616d 6573 203d 2028 0a20 2020 2020 2020  ames = (.       
+00003db0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+00003dc0: 7661 6c69 645f 6675 6e63 7469 6f6e 5f70  valid_function_p
+00003dd0: 7269 6f72 6974 795f 636c 6173 735f 6e61  riority_class_na
+00003de0: 6d65 730a 2020 2020 2020 2020 2020 2020  mes.            
+00003df0: 2020 2020 6f72 2073 6572 7665 725f 6366      or server_cf
+00003e00: 672e 6765 7428 2276 616c 6964 5f66 756e  g.get("valid_fun
+00003e10: 6374 696f 6e5f 7072 696f 7269 7479 5f63  ction_priority_c
+00003e20: 6c61 7373 5f6e 616d 6573 2229 0a20 2020  lass_names").   
+00003e30: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00003e40: 2020 2020 2020 2063 6f6e 6669 672e 6172         config.ar
+00003e50: 7469 6661 6374 732e 6361 6c63 756c 6174  tifacts.calculat
+00003e60: 655f 6861 7368 203d 2028 0a20 2020 2020  e_hash = (.     
+00003e70: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00003e80: 672e 6172 7469 6661 6374 732e 6361 6c63  g.artifacts.calc
+00003e90: 756c 6174 655f 6861 7368 0a20 2020 2020  ulate_hash.     
+00003ea0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00003eb0: 6e66 6967 2e61 7274 6966 6163 7473 2e63  nfig.artifacts.c
+00003ec0: 616c 6375 6c61 7465 5f68 6173 6820 6973  alculate_hash is
+00003ed0: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
+00003ee0: 2020 2020 2020 2020 2020 656c 7365 2073            else s
+00003ef0: 6572 7665 725f 6366 672e 6765 7428 2263  erver_cfg.get("c
+00003f00: 616c 6375 6c61 7465 5f61 7274 6966 6163  alculate_artifac
+00003f10: 745f 6861 7368 2229 0a20 2020 2020 2020  t_hash").       
+00003f20: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00003f30: 2020 2063 6f6e 6669 672e 6172 7469 6661     config.artifa
+00003f40: 6374 732e 6765 6e65 7261 7465 5f74 6172  cts.generate_tar
+00003f50: 6765 745f 7061 7468 5f66 726f 6d5f 6172  get_path_from_ar
+00003f60: 7469 6661 6374 5f68 6173 6820 3d20 280a  tifact_hash = (.
+00003f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f80: 636f 6e66 6967 2e61 7274 6966 6163 7473  config.artifacts
+00003f90: 2e67 656e 6572 6174 655f 7461 7267 6574  .generate_target
+00003fa0: 5f70 6174 685f 6672 6f6d 5f61 7274 6966  _path_from_artif
+00003fb0: 6163 745f 6861 7368 0a20 2020 2020 2020  act_hash.       
+00003fc0: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+00003fd0: 6967 2e61 7274 6966 6163 7473 2e67 656e  ig.artifacts.gen
+00003fe0: 6572 6174 655f 7461 7267 6574 5f70 6174  erate_target_pat
+00003ff0: 685f 6672 6f6d 5f61 7274 6966 6163 745f  h_from_artifact_
+00004000: 6861 7368 2069 7320 6e6f 7420 4e6f 6e65  hash is not None
+00004010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004020: 2065 6c73 6520 7365 7276 6572 5f63 6667   else server_cfg
+00004030: 2e67 6574 2822 6765 6e65 7261 7465 5f61  .get("generate_a
+00004040: 7274 6966 6163 745f 7461 7267 6574 5f70  rtifact_target_p
+00004050: 6174 685f 6672 6f6d 5f61 7274 6966 6163  ath_from_artifac
+00004060: 745f 6861 7368 2229 0a20 2020 2020 2020  t_hash").       
+00004070: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00004080: 2020 2020 636f 6e66 6967 2e72 6564 6973      config.redis
+00004090: 2e75 726c 203d 2063 6f6e 6669 672e 7265  .url = config.re
+000040a0: 6469 732e 7572 6c20 6f72 2073 6572 7665  dis.url or serve
+000040b0: 725f 6366 672e 6765 7428 2272 6564 6973  r_cfg.get("redis
+000040c0: 5f75 726c 2229 0a20 2020 2020 2020 2020  _url").         
+000040d0: 2020 2023 2061 6c6c 6f77 2063 6c69 656e     # allow clien
+000040e0: 7420 746f 2073 6574 2074 6865 2064 6566  t to set the def
+000040f0: 6175 6c74 2070 6172 7469 616c 2057 4120  ault partial WA 
+00004100: 666f 7220 6c61 636b 206f 6620 7375 7070  for lack of supp
+00004110: 6f72 7420 6f66 2070 6572 2d74 6172 6765  ort of per-targe
+00004120: 7420 6175 7869 6c69 6172 7920 6f70 7469  t auxiliary opti
+00004130: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+00004140: 636f 6e66 6967 2e72 6564 6973 2e74 7970  config.redis.typ
+00004150: 6520 3d20 636f 6e66 6967 2e72 6564 6973  e = config.redis
+00004160: 2e74 7970 6520 6f72 2073 6572 7665 725f  .type or server_
+00004170: 6366 672e 6765 7428 2272 6564 6973 5f74  cfg.get("redis_t
+00004180: 7970 6522 290a 0a20 2020 2020 2020 2020  ype")..         
+00004190: 2020 2063 6f6e 6669 672e 7371 6c2e 7572     config.sql.ur
+000041a0: 6c20 3d20 636f 6e66 6967 2e73 716c 2e75  l = config.sql.u
+000041b0: 726c 206f 7220 7365 7276 6572 5f63 6667  rl or server_cfg
+000041c0: 2e67 6574 2822 7371 6c5f 7572 6c22 290a  .get("sql_url").
+000041d0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+000041e0: 6573 6520 6861 7665 2061 2064 6566 6175  ese have a defau
+000041f0: 6c74 2076 616c 7565 2c20 7468 6572 6566  lt value, theref
+00004200: 6f72 6520 6c6f 6361 6c20 636f 6e66 6967  ore local config
+00004210: 2077 696c 6c20 616c 7761 7973 2068 6176   will always hav
+00004220: 6520 6120 7661 6c75 652c 2070 7269 6f72  e a value, prior
+00004230: 6974 697a 6520 7468 650a 2020 2020 2020  itize the.      
+00004240: 2020 2020 2020 2320 4150 4920 7661 6c75        # API valu
+00004250: 6520 6669 7273 740a 2020 2020 2020 2020  e first.        
+00004260: 2020 2020 636f 6e66 6967 2e75 692e 7072      config.ui.pr
+00004270: 6f6a 6563 7473 5f70 7265 6669 7820 3d20  ojects_prefix = 
+00004280: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00004290: 2020 7365 7276 6572 5f63 6667 2e67 6574    server_cfg.get
+000042a0: 2822 7569 5f70 726f 6a65 6374 735f 7072  ("ui_projects_pr
+000042b0: 6566 6978 2229 206f 7220 636f 6e66 6967  efix") or config
+000042c0: 2e75 692e 7072 6f6a 6563 7473 5f70 7265  .ui.projects_pre
+000042d0: 6669 780a 2020 2020 2020 2020 2020 2020  fix.            
+000042e0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+000042f0: 6e66 6967 2e6b 6670 5f69 6d61 6765 203d  nfig.kfp_image =
+00004300: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00004310: 226b 6670 5f69 6d61 6765 2229 206f 7220  "kfp_image") or 
+00004320: 636f 6e66 6967 2e6b 6670 5f69 6d61 6765  config.kfp_image
+00004330: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00004340: 6669 672e 6b66 705f 7572 6c20 3d20 7365  fig.kfp_url = se
+00004350: 7276 6572 5f63 6667 2e67 6574 2822 6b66  rver_cfg.get("kf
+00004360: 705f 7572 6c22 2920 6f72 2063 6f6e 6669  p_url") or confi
+00004370: 672e 6b66 705f 7572 6c0a 2020 2020 2020  g.kfp_url.      
+00004380: 2020 2020 2020 636f 6e66 6967 2e64 6173        config.das
+00004390: 6b5f 6b66 705f 696d 6167 6520 3d20 280a  k_kfp_image = (.
+000043a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043b0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+000043c0: 6461 736b 5f6b 6670 5f69 6d61 6765 2229  dask_kfp_image")
+000043d0: 206f 7220 636f 6e66 6967 2e64 6173 6b5f   or config.dask_
+000043e0: 6b66 705f 696d 6167 650a 2020 2020 2020  kfp_image.      
+000043f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00004400: 2020 2020 636f 6e66 6967 2e73 6372 6170      config.scrap
+00004410: 655f 6d65 7472 6963 7320 3d20 280a 2020  e_metrics = (.  
+00004420: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004430: 7276 6572 5f63 6667 2e67 6574 2822 7363  rver_cfg.get("sc
+00004440: 7261 7065 5f6d 6574 7269 6373 2229 0a20  rape_metrics"). 
+00004450: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004460: 6620 7365 7276 6572 5f63 6667 2e67 6574  f server_cfg.get
+00004470: 2822 7363 7261 7065 5f6d 6574 7269 6373  ("scrape_metrics
+00004480: 2229 2069 7320 6e6f 7420 4e6f 6e65 0a20  ") is not None. 
+00004490: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000044a0: 6c73 6520 636f 6e66 6967 2e73 6372 6170  lse config.scrap
+000044b0: 655f 6d65 7472 6963 730a 2020 2020 2020  e_metrics.      
+000044c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000044d0: 2020 2020 636f 6e66 6967 2e68 7562 5f75      config.hub_u
+000044e0: 726c 203d 2073 6572 7665 725f 6366 672e  rl = server_cfg.
+000044f0: 6765 7428 2268 7562 5f75 726c 2229 206f  get("hub_url") o
+00004500: 7220 636f 6e66 6967 2e68 7562 5f75 726c  r config.hub_url
+00004510: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00004520: 6669 672e 6465 6661 756c 745f 6675 6e63  fig.default_func
+00004530: 7469 6f6e 5f6e 6f64 655f 7365 6c65 6374  tion_node_select
+00004540: 6f72 203d 2028 0a20 2020 2020 2020 2020  or = (.         
+00004550: 2020 2020 2020 2073 6572 7665 725f 6366         server_cf
+00004560: 672e 6765 7428 2264 6566 6175 6c74 5f66  g.get("default_f
+00004570: 756e 6374 696f 6e5f 6e6f 6465 5f73 656c  unction_node_sel
+00004580: 6563 746f 7222 290a 2020 2020 2020 2020  ector").        
+00004590: 2020 2020 2020 2020 6f72 2063 6f6e 6669          or confi
+000045a0: 672e 6465 6661 756c 745f 6675 6e63 7469  g.default_functi
+000045b0: 6f6e 5f6e 6f64 655f 7365 6c65 6374 6f72  on_node_selector
+000045c0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000045d0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+000045e0: 672e 6967 7a5f 7665 7273 696f 6e20 3d20  g.igz_version = 
+000045f0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+00004600: 6967 7a5f 7665 7273 696f 6e22 2920 6f72  igz_version") or
+00004610: 2063 6f6e 6669 672e 6967 7a5f 7665 7273   config.igz_vers
+00004620: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00004630: 636f 6e66 6967 2e73 746f 7261 6765 2e61  config.storage.a
+00004640: 7574 6f5f 6d6f 756e 745f 7479 7065 203d  uto_mount_type =
+00004650: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00004660: 2020 2073 6572 7665 725f 6366 672e 6765     server_cfg.ge
+00004670: 7428 2261 7574 6f5f 6d6f 756e 745f 7479  t("auto_mount_ty
+00004680: 7065 2229 206f 7220 636f 6e66 6967 2e73  pe") or config.s
+00004690: 746f 7261 6765 2e61 7574 6f5f 6d6f 756e  torage.auto_moun
+000046a0: 745f 7479 7065 0a20 2020 2020 2020 2020  t_type.         
+000046b0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000046c0: 2063 6f6e 6669 672e 7374 6f72 6167 652e   config.storage.
+000046d0: 6175 746f 5f6d 6f75 6e74 5f70 6172 616d  auto_mount_param
+000046e0: 7320 3d20 280a 2020 2020 2020 2020 2020  s = (.          
+000046f0: 2020 2020 2020 7365 7276 6572 5f63 6667        server_cfg
+00004700: 2e67 6574 2822 6175 746f 5f6d 6f75 6e74  .get("auto_mount
+00004710: 5f70 6172 616d 7322 2920 6f72 2063 6f6e  _params") or con
+00004720: 6669 672e 7374 6f72 6167 652e 6175 746f  fig.storage.auto
+00004730: 5f6d 6f75 6e74 5f70 6172 616d 730a 2020  _mount_params.  
+00004740: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00004750: 2020 2020 2020 2020 636f 6e66 6967 2e73          config.s
+00004760: 7061 726b 5f6f 7065 7261 746f 725f 7665  park_operator_ve
+00004770: 7273 696f 6e20 3d20 280a 2020 2020 2020  rsion = (.      
+00004780: 2020 2020 2020 2020 2020 7365 7276 6572            server
+00004790: 5f63 6667 2e67 6574 2822 7370 6172 6b5f  _cfg.get("spark_
+000047a0: 6f70 6572 6174 6f72 5f76 6572 7369 6f6e  operator_version
+000047b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000047c0: 2020 206f 7220 636f 6e66 6967 2e73 7061     or config.spa
+000047d0: 726b 5f6f 7065 7261 746f 725f 7665 7273  rk_operator_vers
+000047e0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+000047f0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+00004800: 6e66 6967 2e64 6566 6175 6c74 5f74 656e  nfig.default_ten
+00004810: 736f 7262 6f61 7264 5f6c 6f67 735f 7061  sorboard_logs_pa
+00004820: 7468 203d 2028 0a20 2020 2020 2020 2020  th = (.         
+00004830: 2020 2020 2020 2073 6572 7665 725f 6366         server_cf
+00004840: 672e 6765 7428 2264 6566 6175 6c74 5f74  g.get("default_t
+00004850: 656e 736f 7262 6f61 7264 5f6c 6f67 735f  ensorboard_logs_
+00004860: 7061 7468 2229 0a20 2020 2020 2020 2020  path").         
+00004870: 2020 2020 2020 206f 7220 636f 6e66 6967         or config
+00004880: 2e64 6566 6175 6c74 5f74 656e 736f 7262  .default_tensorb
+00004890: 6f61 7264 5f6c 6f67 735f 7061 7468 0a20  oard_logs_path. 
+000048a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000048b0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+000048c0: 6465 6661 756c 745f 6675 6e63 7469 6f6e  default_function
+000048d0: 5f70 6f64 5f72 6573 6f75 7263 6573 203d  _pod_resources =
+000048e0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+000048f0: 2020 2073 6572 7665 725f 6366 672e 6765     server_cfg.ge
+00004900: 7428 2264 6566 6175 6c74 5f66 756e 6374  t("default_funct
+00004910: 696f 6e5f 706f 645f 7265 736f 7572 6365  ion_pod_resource
+00004920: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
+00004930: 2020 2020 6f72 2063 6f6e 6669 672e 6465      or config.de
+00004940: 6661 756c 745f 6675 6e63 7469 6f6e 5f70  fault_function_p
+00004950: 6f64 5f72 6573 6f75 7263 6573 0a20 2020  od_resources.   
+00004960: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00004970: 2020 2020 2020 2063 6f6e 6669 672e 6675         config.fu
+00004980: 6e63 7469 6f6e 5f64 6566 6175 6c74 732e  nction_defaults.
+00004990: 7072 6565 6d70 7469 6f6e 5f6d 6f64 6520  preemption_mode 
+000049a0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+000049b0: 2020 2020 7365 7276 6572 5f63 6667 2e67      server_cfg.g
+000049c0: 6574 2822 6465 6661 756c 745f 7072 6565  et("default_pree
+000049d0: 6d70 7469 6f6e 5f6d 6f64 6522 290a 2020  mption_mode").  
+000049e0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+000049f0: 2063 6f6e 6669 672e 6675 6e63 7469 6f6e   config.function
+00004a00: 5f64 6566 6175 6c74 732e 7072 6565 6d70  _defaults.preemp
+00004a10: 7469 6f6e 5f6d 6f64 650a 2020 2020 2020  tion_mode.      
+00004a20: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00004a30: 2020 2020 636f 6e66 6967 2e70 7265 656d      config.preem
+00004a40: 7074 6962 6c65 5f6e 6f64 6573 2e6e 6f64  ptible_nodes.nod
+00004a50: 655f 7365 6c65 6374 6f72 203d 2028 0a20  e_selector = (. 
+00004a60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004a70: 6572 7665 725f 6366 672e 6765 7428 2270  erver_cfg.get("p
+00004a80: 7265 656d 7074 6962 6c65 5f6e 6f64 6573  reemptible_nodes
+00004a90: 5f6e 6f64 655f 7365 6c65 6374 6f72 2229  _node_selector")
+00004aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004ab0: 206f 7220 636f 6e66 6967 2e70 7265 656d   or config.preem
+00004ac0: 7074 6962 6c65 5f6e 6f64 6573 2e6e 6f64  ptible_nodes.nod
+00004ad0: 655f 7365 6c65 6374 6f72 0a20 2020 2020  e_selector.     
+00004ae0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00004af0: 2020 2020 2063 6f6e 6669 672e 7072 6565       config.pree
+00004b00: 6d70 7469 626c 655f 6e6f 6465 732e 746f  mptible_nodes.to
+00004b10: 6c65 7261 7469 6f6e 7320 3d20 280a 2020  lerations = (.  
+00004b20: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004b30: 7276 6572 5f63 6667 2e67 6574 2822 7072  rver_cfg.get("pr
+00004b40: 6565 6d70 7469 626c 655f 6e6f 6465 735f  eemptible_nodes_
+00004b50: 746f 6c65 7261 7469 6f6e 7322 290a 2020  tolerations").  
+00004b60: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00004b70: 2063 6f6e 6669 672e 7072 6565 6d70 7469   config.preempti
+00004b80: 626c 655f 6e6f 6465 732e 746f 6c65 7261  ble_nodes.tolera
+00004b90: 7469 6f6e 730a 2020 2020 2020 2020 2020  tions.          
+00004ba0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00004bb0: 636f 6e66 6967 2e66 6f72 6365 5f72 756e  config.force_run
+00004bc0: 5f6c 6f63 616c 203d 2028 0a20 2020 2020  _local = (.     
+00004bd0: 2020 2020 2020 2020 2020 2073 6572 7665             serve
+00004be0: 725f 6366 672e 6765 7428 2266 6f72 6365  r_cfg.get("force
+00004bf0: 5f72 756e 5f6c 6f63 616c 2229 206f 7220  _run_local") or 
+00004c00: 636f 6e66 6967 2e66 6f72 6365 5f72 756e  config.force_run
+00004c10: 5f6c 6f63 616c 0a20 2020 2020 2020 2020  _local.         
+00004c20: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00004c30: 2063 6f6e 6669 672e 6675 6e63 7469 6f6e   config.function
+00004c40: 203d 2073 6572 7665 725f 6366 672e 6765   = server_cfg.ge
+00004c50: 7428 2266 756e 6374 696f 6e22 2920 6f72  t("function") or
+00004c60: 2063 6f6e 6669 672e 6675 6e63 7469 6f6e   config.function
+00004c70: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00004c80: 6669 672e 6874 7470 6462 2e6c 6f67 7320  fig.httpdb.logs 
+00004c90: 3d20 7365 7276 6572 5f63 6667 2e67 6574  = server_cfg.get
+00004ca0: 2822 6c6f 6773 2229 206f 7220 636f 6e66  ("logs") or conf
+00004cb0: 6967 2e68 7474 7064 622e 6c6f 6773 0a20  ig.httpdb.logs. 
+00004cc0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00004cd0: 672e 6d6f 6465 6c5f 656e 6470 6f69 6e74  g.model_endpoint
+00004ce0: 5f6d 6f6e 6974 6f72 696e 672e 7374 6f72  _monitoring.stor
+00004cf0: 655f 7479 7065 203d 2028 0a20 2020 2020  e_type = (.     
+00004d00: 2020 2020 2020 2020 2020 2073 6572 7665             serve
+00004d10: 725f 6366 672e 6765 7428 226d 6f64 656c  r_cfg.get("model
+00004d20: 5f65 6e64 706f 696e 745f 6d6f 6e69 746f  _endpoint_monito
+00004d30: 7269 6e67 5f73 746f 7265 5f74 7970 6522  ring_store_type"
+00004d40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004d50: 2020 6f72 2063 6f6e 6669 672e 6d6f 6465    or config.mode
+00004d60: 6c5f 656e 6470 6f69 6e74 5f6d 6f6e 6974  l_endpoint_monit
+00004d70: 6f72 696e 672e 7374 6f72 655f 7479 7065  oring.store_type
+00004d80: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00004d90: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00004da0: 7863 6570 7469 6f6e 2061 7320 6578 633a  xception as exc:
+00004db0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00004dc0: 6765 722e 7761 726e 696e 6728 0a20 2020  ger.warning(.   
+00004dd0: 2020 2020 2020 2020 2020 2020 2022 4661               "Fa
+00004de0: 696c 6564 2073 796e 6369 6e67 2063 6f6e  iled syncing con
+00004df0: 6669 6720 6672 6f6d 2073 6572 7665 7222  fig from server"
+00004e00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004e10: 2020 6578 633d 6572 725f 746f 5f73 7472    exc=err_to_str
+00004e20: 2865 7863 292c 0a20 2020 2020 2020 2020  (exc),.         
+00004e30: 2020 2020 2020 2074 7261 6365 6261 636b         traceback
+00004e40: 3d74 7261 6365 6261 636b 2e66 6f72 6d61  =traceback.forma
+00004e50: 745f 6578 6328 292c 0a20 2020 2020 2020  t_exc(),.       
+00004e60: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+00004e70: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
+00004e80: 6465 6620 7374 6f72 655f 6c6f 6728 7365  def store_log(se
+00004e90: 6c66 2c20 7569 642c 2070 726f 6a65 6374  lf, uid, project
+00004ea0: 3d22 222c 2062 6f64 793d 4e6f 6e65 2c20  ="", body=None, 
+00004eb0: 6170 7065 6e64 3d46 616c 7365 293a 0a20  append=False):. 
+00004ec0: 2020 2020 2020 2022 2222 5361 7665 2061         """Save a
+00004ed0: 206c 6f67 2070 6572 7369 7374 656e 746c   log persistentl
+00004ee0: 792e 0a0a 2020 2020 2020 2020 3a70 6172  y...        :par
+00004ef0: 616d 2075 6964 3a20 4c6f 6720 756e 6971  am uid: Log uniq
+00004f00: 7565 2049 440a 2020 2020 2020 2020 3a70  ue ID.        :p
+00004f10: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
+00004f20: 6f6a 6563 7420 6e61 6d65 2066 6f72 2077  oject name for w
+00004f30: 6869 6368 2074 6869 7320 6c6f 6720 6265  hich this log be
+00004f40: 6c6f 6e67 730a 2020 2020 2020 2020 3a70  longs.        :p
+00004f50: 6172 616d 2062 6f64 793a 2054 6865 2061  aram body: The a
+00004f60: 6374 7561 6c20 6c6f 6720 746f 2073 746f  ctual log to sto
+00004f70: 7265 0a20 2020 2020 2020 203a 7061 7261  re.        :para
+00004f80: 6d20 6170 7065 6e64 3a20 5768 6574 6865  m append: Whethe
+00004f90: 7220 746f 2061 7070 656e 6420 7468 6520  r to append the 
+00004fa0: 6c6f 6720 7072 6f76 6964 6564 2069 6e20  log provided in 
+00004fb0: 6060 626f 6479 6060 2074 6f20 616e 2065  ``body`` to an e
+00004fc0: 7869 7374 696e 6720 6c6f 6720 7769 7468  xisting log with
+00004fd0: 2074 6865 2073 616d 6520 6060 7569 6460   the same ``uid`
+00004fe0: 6020 6f72 2074 6f0a 2020 2020 2020 2020  ` or to.        
+00004ff0: 2020 2020 6372 6561 7465 2061 206e 6577      create a new
+00005000: 206c 6f67 2e20 4966 2073 6574 2074 6f20   log. If set to 
+00005010: 6060 4661 6c73 6560 602c 2061 6e20 6578  ``False``, an ex
+00005020: 6973 7469 6e67 206c 6f67 2077 6974 6820  isting log with 
+00005030: 7361 6d65 2060 6075 6964 6060 2077 696c  same ``uid`` wil
+00005040: 6c20 6265 206f 7665 7277 7269 7474 656e  l be overwritten
+00005050: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00005060: 2020 2020 2020 6966 206e 6f74 2062 6f64        if not bod
+00005070: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+00005080: 6574 7572 6e0a 0a20 2020 2020 2020 2070  eturn..        p
+00005090: 6174 6820 3d20 7365 6c66 2e5f 7061 7468  ath = self._path
+000050a0: 5f6f 6628 226c 6f67 222c 2070 726f 6a65  _of("log", proje
+000050b0: 6374 2c20 7569 6429 0a20 2020 2020 2020  ct, uid).       
+000050c0: 2070 6172 616d 7320 3d20 7b22 6170 7065   params = {"appe
+000050d0: 6e64 223a 2062 6f6f 6c32 7374 7228 6170  nd": bool2str(ap
+000050e0: 7065 6e64 297d 0a20 2020 2020 2020 2065  pend)}.        e
+000050f0: 7272 6f72 203d 2066 2273 746f 7265 206c  rror = f"store l
+00005100: 6f67 207b 7072 6f6a 6563 747d 2f7b 7569  og {project}/{ui
+00005110: 647d 220a 2020 2020 2020 2020 7365 6c66  d}".        self
+00005120: 2e61 7069 5f63 616c 6c28 2250 4f53 5422  .api_call("POST"
+00005130: 2c20 7061 7468 2c20 6572 726f 722c 2070  , path, error, p
+00005140: 6172 616d 732c 2062 6f64 7929 0a0a 2020  arams, body)..  
+00005150: 2020 6465 6620 6765 745f 6c6f 6728 7365    def get_log(se
+00005160: 6c66 2c20 7569 642c 2070 726f 6a65 6374  lf, uid, project
+00005170: 3d22 222c 206f 6666 7365 743d 302c 2073  ="", offset=0, s
+00005180: 697a 653d 2d31 293a 0a20 2020 2020 2020  ize=-1):.       
+00005190: 2022 2222 5265 7472 6965 7665 2061 206c   """Retrieve a l
+000051a0: 6f67 2e0a 0a20 2020 2020 2020 203a 7061  og...        :pa
+000051b0: 7261 6d20 7569 643a 204c 6f67 2075 6e69  ram uid: Log uni
+000051c0: 7175 6520 4944 0a20 2020 2020 2020 203a  que ID.        :
+000051d0: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
+000051e0: 726f 6a65 6374 206e 616d 6520 666f 7220  roject name for 
+000051f0: 7768 6963 6820 7468 6520 6c6f 6720 6265  which the log be
+00005200: 6c6f 6e67 730a 2020 2020 2020 2020 3a70  longs.        :p
+00005210: 6172 616d 206f 6666 7365 743a 2052 6574  aram offset: Ret
+00005220: 7269 6576 6520 7061 7274 6961 6c20 6c6f  rieve partial lo
+00005230: 672c 2067 6574 2075 7020 746f 2060 6073  g, get up to ``s
+00005240: 697a 6560 6020 6279 7465 7320 7374 6172  ize`` bytes star
+00005250: 7469 6e67 2061 7420 6f66 6673 6574 2060  ting at offset `
+00005260: 606f 6666 7365 7460 600a 2020 2020 2020  `offset``.      
+00005270: 2020 2020 2020 6672 6f6d 2062 6567 696e        from begin
+00005280: 6e69 6e67 206f 6620 6c6f 670a 2020 2020  ning of log.    
+00005290: 2020 2020 3a70 6172 616d 2073 697a 653a      :param size:
+000052a0: 2053 6565 2060 606f 6666 7365 7460 602e   See ``offset``.
+000052b0: 2049 6620 7365 7420 746f 2060 602d 3160   If set to ``-1`
+000052c0: 6020 2874 6865 2064 6566 6175 6c74 2920  ` (the default) 
+000052d0: 7769 6c6c 2072 6574 7269 6576 6520 616c  will retrieve al
+000052e0: 6c20 6461 7461 2074 6f20 656e 6420 6f66  l data to end of
+000052f0: 206c 6f67 2e0a 2020 2020 2020 2020 3a72   log..        :r
+00005300: 6574 7572 6e73 3a20 5468 6520 666f 6c6c  eturns: The foll
+00005310: 6f77 696e 6720 6f62 6a65 6374 733a 0a0a  owing objects:..
+00005320: 2020 2020 2020 2020 2020 2020 2d20 7374              - st
+00005330: 6174 6520 2d20 5468 6520 7374 6174 6520  ate - The state 
+00005340: 6f66 2074 6865 2072 756e 7469 6d65 206f  of the runtime o
+00005350: 626a 6563 7420 7768 6963 6820 6765 6e65  bject which gene
+00005360: 7261 7465 7320 7468 6973 206c 6f67 2c20  rates this log, 
+00005370: 6966 2069 7420 6578 6973 7473 2e20 496e  if it exists. In
+00005380: 2063 6173 6520 6e6f 206b 6e6f 776e 2073   case no known s
+00005390: 7461 7465 0a20 2020 2020 2020 2020 2020  tate.           
+000053a0: 2020 2065 7869 7374 732c 2074 6869 7320     exists, this 
+000053b0: 7769 6c6c 2062 6520 6060 756e 6b6e 6f77  will be ``unknow
+000053c0: 6e60 602e 0a20 2020 2020 2020 2020 2020  n``..           
+000053d0: 202d 2063 6f6e 7465 6e74 202d 2054 6865   - content - The
+000053e0: 2061 6374 7561 6c20 6c6f 6720 636f 6e74   actual log cont
+000053f0: 656e 742e 0a20 2020 2020 2020 2022 2222  ent..        """
+00005400: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
+00005410: 203d 207b 226f 6666 7365 7422 3a20 6f66   = {"offset": of
+00005420: 6673 6574 2c20 2273 697a 6522 3a20 7369  fset, "size": si
+00005430: 7a65 7d0a 2020 2020 2020 2020 7061 7468  ze}.        path
+00005440: 203d 2073 656c 662e 5f70 6174 685f 6f66   = self._path_of
+00005450: 2822 6c6f 6722 2c20 7072 6f6a 6563 742c  ("log", project,
+00005460: 2075 6964 290a 2020 2020 2020 2020 6572   uid).        er
+00005470: 726f 7220 3d20 6622 6765 7420 6c6f 6720  ror = f"get log 
+00005480: 7b70 726f 6a65 6374 7d2f 7b75 6964 7d22  {project}/{uid}"
+00005490: 0a20 2020 2020 2020 2072 6573 7020 3d20  .        resp = 
+000054a0: 7365 6c66 2e61 7069 5f63 616c 6c28 2247  self.api_call("G
+000054b0: 4554 222c 2070 6174 682c 2065 7272 6f72  ET", path, error
+000054c0: 2c20 7061 7261 6d73 3d70 6172 616d 7329  , params=params)
+000054d0: 0a20 2020 2020 2020 2069 6620 7265 7370  .        if resp
+000054e0: 2e68 6561 6465 7273 3a0a 2020 2020 2020  .headers:.      
+000054f0: 2020 2020 2020 7374 6174 6520 3d20 7265        state = re
+00005500: 7370 2e68 6561 6465 7273 2e67 6574 2822  sp.headers.get("
+00005510: 782d 6d6c 7275 6e2d 7275 6e2d 7374 6174  x-mlrun-run-stat
+00005520: 6522 2c20 2222 290a 2020 2020 2020 2020  e", "").        
+00005530: 2020 2020 7265 7475 726e 2073 7461 7465      return state
+00005540: 2e6c 6f77 6572 2829 2c20 7265 7370 2e63  .lower(), resp.c
+00005550: 6f6e 7465 6e74 0a0a 2020 2020 2020 2020  ontent..        
+00005560: 7265 7475 726e 2022 756e 6b6e 6f77 6e22  return "unknown"
+00005570: 2c20 7265 7370 2e63 6f6e 7465 6e74 0a0a  , resp.content..
+00005580: 2020 2020 6465 6620 7761 7463 685f 6c6f      def watch_lo
+00005590: 6728 7365 6c66 2c20 7569 642c 2070 726f  g(self, uid, pro
+000055a0: 6a65 6374 3d22 222c 2077 6174 6368 3d54  ject="", watch=T
+000055b0: 7275 652c 206f 6666 7365 743d 3029 3a0a  rue, offset=0):.
+000055c0: 2020 2020 2020 2020 2222 2252 6574 7269          """Retri
+000055d0: 6576 6520 6c6f 6773 206f 6620 6120 7275  eve logs of a ru
+000055e0: 6e6e 696e 6720 7072 6f63 6573 732c 2061  nning process, a
+000055f0: 6e64 2077 6174 6368 2074 6865 2070 726f  nd watch the pro
+00005600: 6772 6573 7320 6f66 2074 6865 2065 7865  gress of the exe
+00005610: 6375 7469 6f6e 2075 6e74 696c 2069 7420  cution until it 
+00005620: 636f 6d70 6c65 7465 732e 2054 6869 730a  completes. This.
+00005630: 2020 2020 2020 2020 6d65 7468 6f64 2077          method w
+00005640: 696c 6c20 7072 696e 7420 6f75 7420 7468  ill print out th
+00005650: 6520 6c6f 6773 2061 6e64 2063 6f6e 7469  e logs and conti
+00005660: 6e75 6520 746f 2070 6572 696f 6469 6361  nue to periodica
+00005670: 6c6c 7920 706f 6c6c 2066 6f72 2c20 616e  lly poll for, an
+00005680: 6420 7072 696e 742c 206e 6577 206c 6f67  d print, new log
+00005690: 7320 6173 206c 6f6e 6720 6173 2074 6865  s as long as the
+000056a0: 0a20 2020 2020 2020 2073 7461 7465 206f  .        state o
+000056b0: 6620 7468 6520 7275 6e74 696d 6520 7768  f the runtime wh
+000056c0: 6963 6820 6765 6e65 7261 7465 7320 7468  ich generates th
+000056d0: 6973 206c 6f67 2069 7320 6569 7468 6572  is log is either
+000056e0: 2060 6070 656e 6469 6e67 6060 206f 7220   ``pending`` or 
+000056f0: 6060 7275 6e6e 696e 6760 602e 0a0a 2020  ``running``...  
+00005700: 2020 2020 2020 3a70 6172 616d 2075 6964        :param uid
+00005710: 3a20 5468 6520 7569 6420 6f66 2074 6865  : The uid of the
+00005720: 206c 6f67 206f 626a 6563 7420 746f 2077   log object to w
+00005730: 6174 6368 2e0a 2020 2020 2020 2020 3a70  atch..        :p
+00005740: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
+00005750: 6f6a 6563 7420 7468 6174 2074 6865 206c  oject that the l
+00005760: 6f67 2062 656c 6f6e 6773 2074 6f2e 0a20  og belongs to.. 
+00005770: 2020 2020 2020 203a 7061 7261 6d20 7761         :param wa
+00005780: 7463 683a 2049 6620 7365 7420 746f 2060  tch: If set to `
+00005790: 6054 7275 6560 6020 7769 6c6c 2063 6f6e  `True`` will con
+000057a0: 7469 6e75 6520 7472 6163 6b69 6e67 2074  tinue tracking t
+000057b0: 6865 206c 6f67 2061 7320 6465 7363 7269  he log as descri
+000057c0: 6265 6420 6162 6f76 652e 204f 7468 6572  bed above. Other
+000057d0: 7769 7365 2074 6869 7320 6675 6e63 7469  wise this functi
+000057e0: 6f6e 0a20 2020 2020 2020 2020 2020 2069  on.            i
+000057f0: 7320 7072 6163 7469 6361 6c6c 7920 6571  s practically eq
+00005800: 7569 7661 6c65 6e74 2074 6f20 7468 6520  uivalent to the 
+00005810: 3a70 793a 6675 6e63 3a60 7e67 6574 5f6c  :py:func:`~get_l
+00005820: 6f67 6020 6675 6e63 7469 6f6e 2e0a 2020  og` function..  
+00005830: 2020 2020 2020 3a70 6172 616d 206f 6666        :param off
+00005840: 7365 743a 204d 696e 696d 616c 206f 6666  set: Minimal off
+00005850: 7365 7420 696e 2074 6865 206c 6f67 2074  set in the log t
+00005860: 6f20 7761 7463 682e 0a20 2020 2020 2020  o watch..       
+00005870: 203a 7265 7475 726e 733a 2054 6865 2066   :returns: The f
+00005880: 696e 616c 2073 7461 7465 206f 6620 7468  inal state of th
+00005890: 6520 6c6f 6720 6265 696e 6720 7761 7463  e log being watc
+000058a0: 6865 642e 0a20 2020 2020 2020 2022 2222  hed..        """
+000058b0: 0a0a 2020 2020 2020 2020 7374 6174 652c  ..        state,
+000058c0: 2074 6578 7420 3d20 7365 6c66 2e67 6574   text = self.get
+000058d0: 5f6c 6f67 2875 6964 2c20 7072 6f6a 6563  _log(uid, projec
+000058e0: 742c 206f 6666 7365 743d 6f66 6673 6574  t, offset=offset
+000058f0: 290a 2020 2020 2020 2020 6966 2074 6578  ).        if tex
+00005900: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+00005910: 7269 6e74 2874 6578 742e 6465 636f 6465  rint(text.decode
+00005920: 2865 7272 6f72 733d 6d6c 7275 6e2e 6d6c  (errors=mlrun.ml
+00005930: 636f 6e66 2e68 7474 7064 622e 6c6f 6773  conf.httpdb.logs
+00005940: 2e64 6563 6f64 652e 6572 726f 7273 2929  .decode.errors))
+00005950: 0a20 2020 2020 2020 2069 6620 7761 7463  .        if watc
+00005960: 683a 0a20 2020 2020 2020 2020 2020 206e  h:.            n
+00005970: 696c 5f72 6573 7020 3d20 300a 2020 2020  il_resp = 0.    
+00005980: 2020 2020 2020 2020 7768 696c 6520 7374          while st
+00005990: 6174 6520 696e 205b 2270 656e 6469 6e67  ate in ["pending
+000059a0: 222c 2022 7275 6e6e 696e 6722 5d3a 0a20  ", "running"]:. 
+000059b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000059c0: 6666 7365 7420 2b3d 206c 656e 2874 6578  ffset += len(tex
+000059d0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+000059e0: 2020 2023 2069 6620 7765 2067 6574 2033     # if we get 3
+000059f0: 206e 696c 2072 6573 706f 6e73 6573 2069   nil responses i
+00005a00: 6e20 6120 726f 772c 2069 6e63 7265 6173  n a row, increas
+00005a10: 6520 7468 6520 736c 6565 7020 7469 6d65  e the sleep time
+00005a20: 2074 6f20 3130 2073 6563 6f6e 6473 0a20   to 10 seconds. 
+00005a30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00005a40: 2054 4f44 4f3a 2072 6566 6163 746f 7220   TODO: refactor 
+00005a50: 7468 6973 2074 6f20 7573 6520 6120 636f  this to use a co
+00005a60: 6e64 6974 696f 6e61 6c20 6261 636b 6f66  nditional backof
+00005a70: 6620 6d65 6368 616e 6973 6d0a 2020 2020  f mechanism.    
+00005a80: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00005a90: 696c 5f72 6573 7020 3c20 333a 0a20 2020  il_resp < 3:.   
+00005aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ab0: 2074 696d 652e 736c 6565 7028 696e 7428   time.sleep(int(
+00005ac0: 6d6c 7275 6e2e 6d6c 636f 6e66 2e68 7474  mlrun.mlconf.htt
+00005ad0: 7064 622e 6c6f 6773 2e70 756c 6c5f 6c6f  pdb.logs.pull_lo
+00005ae0: 6773 5f64 6566 6175 6c74 5f69 6e74 6572  gs_default_inter
+00005af0: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
+00005b00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00005b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b20: 7469 6d65 2e73 6c65 6570 280a 2020 2020  time.sleep(.    
+00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b40: 2020 2020 696e 7428 0a20 2020 2020 2020      int(.       
+00005b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b60: 2020 2020 206d 6c72 756e 2e6d 6c63 6f6e       mlrun.mlcon
+00005b70: 662e 6874 7470 6462 2e6c 6f67 732e 7075  f.httpdb.logs.pu
+00005b80: 6c6c 5f6c 6f67 735f 6261 636b 6f66 665f  ll_logs_backoff_
+00005b90: 6e6f 5f6c 6f67 735f 6465 6661 756c 745f  no_logs_default_
+00005ba0: 696e 7465 7276 616c 0a20 2020 2020 2020  interval.       
+00005bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005bc0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00005bd0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00005be0: 2020 2020 2020 2020 2073 7461 7465 2c20           state, 
+00005bf0: 7465 7874 203d 2073 656c 662e 6765 745f  text = self.get_
+00005c00: 6c6f 6728 7569 642c 2070 726f 6a65 6374  log(uid, project
+00005c10: 2c20 6f66 6673 6574 3d6f 6666 7365 7429  , offset=offset)
+00005c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005c30: 2069 6620 7465 7874 3a0a 2020 2020 2020   if text:.      
+00005c40: 2020 2020 2020 2020 2020 2020 2020 6e69                ni
+00005c50: 6c5f 7265 7370 203d 2030 0a20 2020 2020  l_resp = 0.     
+00005c60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00005c70: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+00005c80: 2020 2020 2020 2020 2020 2020 2020 7465                te
+00005c90: 7874 2e64 6563 6f64 6528 6572 726f 7273  xt.decode(errors
+00005ca0: 3d6d 6c72 756e 2e6d 6c63 6f6e 662e 6874  =mlrun.mlconf.ht
+00005cb0: 7470 6462 2e6c 6f67 732e 6465 636f 6465  tpdb.logs.decode
+00005cc0: 2e65 7272 6f72 7329 2c0a 2020 2020 2020  .errors),.      
+00005cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ce0: 2020 656e 643d 2222 2c0a 2020 2020 2020    end="",.      
+00005cf0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00005d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005d20: 2020 2020 2020 2020 2020 6e69 6c5f 7265            nil_re
+00005d30: 7370 202b 3d20 310a 2020 2020 2020 2020  sp += 1.        
+00005d40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005d50: 2020 6f66 6673 6574 202b 3d20 6c65 6e28    offset += len(
+00005d60: 7465 7874 290a 0a20 2020 2020 2020 2072  text)..        r
+00005d70: 6574 7572 6e20 7374 6174 652c 206f 6666  eturn state, off
+00005d80: 7365 740a 0a20 2020 2064 6566 2073 746f  set..    def sto
+00005d90: 7265 5f72 756e 2873 656c 662c 2073 7472  re_run(self, str
+00005da0: 7563 742c 2075 6964 2c20 7072 6f6a 6563  uct, uid, projec
+00005db0: 743d 2222 2c20 6974 6572 3d30 293a 0a20  t="", iter=0):. 
+00005dc0: 2020 2020 2020 2022 2222 5374 6f72 6520         """Store 
+00005dd0: 7275 6e20 6465 7461 696c 7320 696e 2074  run details in t
+00005de0: 6865 2044 422e 2054 6869 7320 6d65 7468  he DB. This meth
+00005df0: 6f64 2069 7320 7573 7561 6c6c 7920 6361  od is usually ca
+00005e00: 6c6c 6564 2066 726f 6d20 7769 7468 696e  lled from within
+00005e10: 206f 7468 6572 203a 7079 3a6d 6f64 3a60   other :py:mod:`
+00005e20: 6d6c 7275 6e60 2066 6c6f 7773 0a20 2020  mlrun` flows.   
+00005e30: 2020 2020 2061 6e64 206e 6f74 2063 616c       and not cal
+00005e40: 6c65 6420 6469 7265 6374 6c79 2062 7920  led directly by 
+00005e50: 7468 6520 7573 6572 2e22 2222 0a0a 2020  the user."""..  
+00005e60: 2020 2020 2020 7061 7468 203d 2073 656c        path = sel
+00005e70: 662e 5f70 6174 685f 6f66 2822 7275 6e22  f._path_of("run"
+00005e80: 2c20 7072 6f6a 6563 742c 2075 6964 290a  , project, uid).
+00005e90: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+00005ea0: 207b 2269 7465 7222 3a20 6974 6572 7d0a   {"iter": iter}.
+00005eb0: 2020 2020 2020 2020 6572 726f 7220 3d20          error = 
+00005ec0: 6622 7374 6f72 6520 7275 6e20 7b70 726f  f"store run {pro
+00005ed0: 6a65 6374 7d2f 7b75 6964 7d22 0a20 2020  ject}/{uid}".   
+00005ee0: 2020 2020 2062 6f64 7920 3d20 5f61 735f       body = _as_
+00005ef0: 6a73 6f6e 2873 7472 7563 7429 0a20 2020  json(struct).   
+00005f00: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
+00005f10: 6c6c 2822 504f 5354 222c 2070 6174 682c  ll("POST", path,
+00005f20: 2065 7272 6f72 2c20 7061 7261 6d73 3d70   error, params=p
+00005f30: 6172 616d 732c 2062 6f64 793d 626f 6479  arams, body=body
+00005f40: 290a 0a20 2020 2064 6566 2075 7064 6174  )..    def updat
+00005f50: 655f 7275 6e28 7365 6c66 2c20 7570 6461  e_run(self, upda
+00005f60: 7465 733a 2064 6963 742c 2075 6964 2c20  tes: dict, uid, 
+00005f70: 7072 6f6a 6563 743d 2222 2c20 6974 6572  project="", iter
+00005f80: 3d30 2c20 7469 6d65 6f75 743d 3435 293a  =0, timeout=45):
+00005f90: 0a20 2020 2020 2020 2022 2222 5570 6461  .        """Upda
+00005fa0: 7465 2074 6865 2064 6574 6169 6c73 206f  te the details o
+00005fb0: 6620 6120 7374 6f72 6564 2072 756e 2069  f a stored run i
+00005fc0: 6e20 7468 6520 4442 2e22 2222 0a0a 2020  n the DB."""..  
+00005fd0: 2020 2020 2020 7061 7468 203d 2073 656c        path = sel
+00005fe0: 662e 5f70 6174 685f 6f66 2822 7275 6e22  f._path_of("run"
+00005ff0: 2c20 7072 6f6a 6563 742c 2075 6964 290a  , project, uid).
+00006000: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+00006010: 207b 2269 7465 7222 3a20 6974 6572 7d0a   {"iter": iter}.
+00006020: 2020 2020 2020 2020 6572 726f 7220 3d20          error = 
+00006030: 6622 7570 6461 7465 2072 756e 207b 7072  f"update run {pr
+00006040: 6f6a 6563 747d 2f7b 7569 647d 220a 2020  oject}/{uid}".  
+00006050: 2020 2020 2020 626f 6479 203d 205f 6173        body = _as
+00006060: 5f6a 736f 6e28 7570 6461 7465 7329 0a20  _json(updates). 
+00006070: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
+00006080: 6361 6c6c 2822 5041 5443 4822 2c20 7061  call("PATCH", pa
+00006090: 7468 2c20 6572 726f 722c 2070 6172 616d  th, error, param
+000060a0: 733d 7061 7261 6d73 2c20 626f 6479 3d62  s=params, body=b
+000060b0: 6f64 792c 2074 696d 656f 7574 3d74 696d  ody, timeout=tim
+000060c0: 656f 7574 290a 0a20 2020 2064 6566 2061  eout)..    def a
+000060d0: 626f 7274 5f72 756e 2873 656c 662c 2075  bort_run(self, u
+000060e0: 6964 2c20 7072 6f6a 6563 743d 2222 2c20  id, project="", 
+000060f0: 6974 6572 3d30 2c20 7469 6d65 6f75 743d  iter=0, timeout=
+00006100: 3435 293a 0a20 2020 2020 2020 2022 2222  45):.        """
+00006110: 0a20 2020 2020 2020 2041 626f 7274 2061  .        Abort a
+00006120: 2072 756e 6e69 6e67 2072 756e 202d 2077   running run - w
+00006130: 696c 6c20 7265 6d6f 7665 2074 6865 2072  ill remove the r
+00006140: 756e 2773 2072 756e 7469 6d65 2072 6573  un's runtime res
+00006150: 6f75 7263 6573 2061 6e64 206d 6172 6b20  ources and mark 
+00006160: 6974 7320 7374 6174 6520 6173 2061 626f  its state as abo
+00006170: 7274 6564 0a20 2020 2020 2020 2022 2222  rted.        """
+00006180: 0a20 2020 2020 2020 2073 656c 662e 7570  .        self.up
+00006190: 6461 7465 5f72 756e 280a 2020 2020 2020  date_run(.      
+000061a0: 2020 2020 2020 7b22 7374 6174 7573 2e73        {"status.s
+000061b0: 7461 7465 223a 206d 6c72 756e 2e72 756e  tate": mlrun.run
+000061c0: 7469 6d65 732e 636f 6e73 7461 6e74 732e  times.constants.
+000061d0: 5275 6e53 7461 7465 732e 6162 6f72 7465  RunStates.aborte
+000061e0: 647d 2c0a 2020 2020 2020 2020 2020 2020  d},.            
+000061f0: 7569 642c 0a20 2020 2020 2020 2020 2020  uid,.           
+00006200: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
+00006210: 2020 2020 2020 6974 6572 2c0a 2020 2020        iter,.    
+00006220: 2020 2020 2020 2020 7469 6d65 6f75 742c          timeout,
+00006230: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00006240: 6465 6620 7265 6164 5f72 756e 2873 656c  def read_run(sel
+00006250: 662c 2075 6964 2c20 7072 6f6a 6563 743d  f, uid, project=
+00006260: 2222 2c20 6974 6572 3d30 293a 0a20 2020  "", iter=0):.   
+00006270: 2020 2020 2022 2222 5265 6164 2074 6865       """Read the
+00006280: 2064 6574 6169 6c73 206f 6620 6120 7374   details of a st
+00006290: 6f72 6564 2072 756e 2066 726f 6d20 7468  ored run from th
+000062a0: 6520 4442 2e0a 0a20 2020 2020 2020 203a  e DB...        :
+000062b0: 7061 7261 6d20 7569 643a 2054 6865 2072  param uid: The r
+000062c0: 756e 2773 2075 6e69 7175 6520 4944 2e0a  un's unique ID..
+000062d0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+000062e0: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
+000062f0: 6e61 6d65 2e0a 2020 2020 2020 2020 3a70  name..        :p
+00006300: 6172 616d 2069 7465 723a 2049 7465 7261  aram iter: Itera
+00006310: 7469 6f6e 2077 6974 6869 6e20 6120 7370  tion within a sp
+00006320: 6563 6966 6963 2065 7865 6375 7469 6f6e  ecific execution
+00006330: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00006340: 2020 2020 2020 2070 6174 6820 3d20 7365         path = se
+00006350: 6c66 2e5f 7061 7468 5f6f 6628 2272 756e  lf._path_of("run
+00006360: 222c 2070 726f 6a65 6374 2c20 7569 6429  ", project, uid)
+00006370: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
+00006380: 3d20 7b22 6974 6572 223a 2069 7465 727d  = {"iter": iter}
+00006390: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
+000063a0: 2066 2267 6574 2072 756e 207b 7072 6f6a   f"get run {proj
+000063b0: 6563 747d 2f7b 7569 647d 220a 2020 2020  ect}/{uid}".    
+000063c0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+000063d0: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+000063e0: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
+000063f0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
+00006400: 2020 2020 7265 7475 726e 2072 6573 702e      return resp.
+00006410: 6a73 6f6e 2829 5b22 6461 7461 225d 0a0a  json()["data"]..
+00006420: 2020 2020 6465 6620 6465 6c5f 7275 6e28      def del_run(
+00006430: 7365 6c66 2c20 7569 642c 2070 726f 6a65  self, uid, proje
+00006440: 6374 3d22 222c 2069 7465 723d 3029 3a0a  ct="", iter=0):.
+00006450: 2020 2020 2020 2020 2222 2244 656c 6574          """Delet
+00006460: 6520 6465 7461 696c 7320 6f66 2061 2073  e details of a s
+00006470: 7065 6369 6669 6320 7275 6e20 6672 6f6d  pecific run from
+00006480: 2044 422e 0a0a 2020 2020 2020 2020 3a70   DB...        :p
+00006490: 6172 616d 2075 6964 3a20 556e 6971 7565  aram uid: Unique
+000064a0: 2049 4420 666f 7220 7468 6520 7370 6563   ID for the spec
+000064b0: 6966 6963 2072 756e 2074 6f20 6465 6c65  ific run to dele
+000064c0: 7465 2e0a 2020 2020 2020 2020 3a70 6172  te..        :par
+000064d0: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+000064e0: 6563 7420 7468 6174 2074 6865 2072 756e  ect that the run
+000064f0: 2062 656c 6f6e 6773 2074 6f2e 0a20 2020   belongs to..   
+00006500: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
+00006510: 3a20 4974 6572 6174 696f 6e20 7769 7468  : Iteration with
+00006520: 696e 2061 2073 7065 6369 6669 6320 7461  in a specific ta
+00006530: 736b 2e0a 2020 2020 2020 2020 2222 220a  sk..        """.
+00006540: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00006550: 7365 6c66 2e5f 7061 7468 5f6f 6628 2272  self._path_of("r
+00006560: 756e 222c 2070 726f 6a65 6374 2c20 7569  un", project, ui
+00006570: 6429 0a20 2020 2020 2020 2070 6172 616d  d).        param
+00006580: 7320 3d20 7b22 6974 6572 223a 2069 7465  s = {"iter": ite
+00006590: 727d 0a20 2020 2020 2020 2065 7272 6f72  r}.        error
+000065a0: 203d 2066 2264 656c 2072 756e 207b 7072   = f"del run {pr
+000065b0: 6f6a 6563 747d 2f7b 7569 647d 220a 2020  oject}/{uid}".  
+000065c0: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+000065d0: 616c 6c28 2244 454c 4554 4522 2c20 7061  all("DELETE", pa
+000065e0: 7468 2c20 6572 726f 722c 2070 6172 616d  th, error, param
+000065f0: 733d 7061 7261 6d73 290a 0a20 2020 2064  s=params)..    d
+00006600: 6566 206c 6973 745f 7275 6e73 280a 2020  ef list_runs(.  
+00006610: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00006620: 2020 2020 6e61 6d65 3a20 4f70 7469 6f6e      name: Option
+00006630: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+00006640: 2020 2020 2020 2020 7569 643a 204f 7074          uid: Opt
+00006650: 696f 6e61 6c5b 556e 696f 6e5b 7374 722c  ional[Union[str,
+00006660: 204c 6973 745b 7374 725d 5d5d 203d 204e   List[str]]] = N
+00006670: 6f6e 652c 0a20 2020 2020 2020 2070 726f  one,.        pro
+00006680: 6a65 6374 3a20 4f70 7469 6f6e 616c 5b73  ject: Optional[s
+00006690: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+000066a0: 2020 2020 6c61 6265 6c73 3a20 4f70 7469      labels: Opti
+000066b0: 6f6e 616c 5b55 6e69 6f6e 5b73 7472 2c20  onal[Union[str, 
+000066c0: 4c69 7374 5b73 7472 5d5d 5d20 3d20 4e6f  List[str]]] = No
+000066d0: 6e65 2c0a 2020 2020 2020 2020 7374 6174  ne,.        stat
+000066e0: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
+000066f0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00006700: 2073 6f72 743a 2062 6f6f 6c20 3d20 5472   sort: bool = Tr
+00006710: 7565 2c0a 2020 2020 2020 2020 6c61 7374  ue,.        last
+00006720: 3a20 696e 7420 3d20 302c 0a20 2020 2020  : int = 0,.     
+00006730: 2020 2069 7465 723a 2062 6f6f 6c20 3d20     iter: bool = 
+00006740: 4661 6c73 652c 0a20 2020 2020 2020 2073  False,.        s
+00006750: 7461 7274 5f74 696d 655f 6672 6f6d 3a20  tart_time_from: 
+00006760: 4f70 7469 6f6e 616c 5b64 6174 6574 696d  Optional[datetim
+00006770: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
+00006780: 2020 2073 7461 7274 5f74 696d 655f 746f     start_time_to
+00006790: 3a20 4f70 7469 6f6e 616c 5b64 6174 6574  : Optional[datet
+000067a0: 696d 655d 203d 204e 6f6e 652c 0a20 2020  ime] = None,.   
+000067b0: 2020 2020 206c 6173 745f 7570 6461 7465       last_update
+000067c0: 5f74 696d 655f 6672 6f6d 3a20 4f70 7469  _time_from: Opti
+000067d0: 6f6e 616c 5b64 6174 6574 696d 655d 203d  onal[datetime] =
+000067e0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
+000067f0: 6173 745f 7570 6461 7465 5f74 696d 655f  ast_update_time_
+00006800: 746f 3a20 4f70 7469 6f6e 616c 5b64 6174  to: Optional[dat
+00006810: 6574 696d 655d 203d 204e 6f6e 652c 0a20  etime] = None,. 
+00006820: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00006830: 5f62 793a 204f 7074 696f 6e61 6c5b 0a20  _by: Optional[. 
+00006840: 2020 2020 2020 2020 2020 2055 6e69 6f6e             Union
+00006850: 5b6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  [mlrun.common.sc
+00006860: 6865 6d61 732e 5275 6e50 6172 7469 7469  hemas.RunPartiti
+00006870: 6f6e 4279 4669 656c 642c 2073 7472 5d0a  onByField, str].
+00006880: 2020 2020 2020 2020 5d20 3d20 4e6f 6e65          ] = None
+00006890: 2c0a 2020 2020 2020 2020 726f 7773 5f70  ,.        rows_p
+000068a0: 6572 5f70 6172 7469 7469 6f6e 3a20 696e  er_partition: in
+000068b0: 7420 3d20 312c 0a20 2020 2020 2020 2070  t = 1,.        p
+000068c0: 6172 7469 7469 6f6e 5f73 6f72 745f 6279  artition_sort_by
+000068d0: 3a20 4f70 7469 6f6e 616c 5b55 6e69 6f6e  : Optional[Union
+000068e0: 5b6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  [mlrun.common.sc
+000068f0: 6865 6d61 732e 536f 7274 4669 656c 642c  hemas.SortField,
+00006900: 2073 7472 5d5d 203d 204e 6f6e 652c 0a20   str]] = None,. 
+00006910: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00006920: 5f6f 7264 6572 3a20 556e 696f 6e5b 0a20  _order: Union[. 
+00006930: 2020 2020 2020 2020 2020 206d 6c72 756e             mlrun
+00006940: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00006950: 4f72 6465 7254 7970 652c 2073 7472 0a20  OrderType, str. 
+00006960: 2020 2020 2020 205d 203d 206d 6c72 756e         ] = mlrun
+00006970: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00006980: 4f72 6465 7254 7970 652e 6465 7363 2c0a  OrderType.desc,.
+00006990: 2020 2020 2020 2020 6d61 785f 7061 7274          max_part
+000069a0: 6974 696f 6e73 3a20 696e 7420 3d20 302c  itions: int = 0,
+000069b0: 0a20 2020 2020 2020 2077 6974 685f 6e6f  .        with_no
+000069c0: 7469 6669 6361 7469 6f6e 733a 2062 6f6f  tifications: boo
+000069d0: 6c20 3d20 4661 6c73 652c 0a20 2020 2029  l = False,.    )
+000069e0: 202d 3e20 5275 6e4c 6973 743a 0a20 2020   -> RunList:.   
+000069f0: 2020 2020 2022 2222 5265 7472 6965 7665       """Retrieve
+00006a00: 2061 206c 6973 7420 6f66 2072 756e 732c   a list of runs,
+00006a10: 2066 696c 7465 7265 6420 6279 2076 6172   filtered by var
+00006a20: 696f 7573 206f 7074 696f 6e73 2e0a 2020  ious options..  
+00006a30: 2020 2020 2020 4578 616d 706c 653a 3a0a        Example::.
+00006a40: 0a20 2020 2020 2020 2020 2020 2072 756e  .            run
+00006a50: 7320 3d20 6462 2e6c 6973 745f 7275 6e73  s = db.list_runs
+00006a60: 286e 616d 653d 2764 6f77 6e6c 6f61 6427  (name='download'
+00006a70: 2c20 7072 6f6a 6563 743d 2769 7269 7327  , project='iris'
+00006a80: 2c20 6c61 6265 6c73 3d5b 276f 776e 6572  , labels=['owner
+00006a90: 3d61 646d 696e 272c 2027 6b69 6e64 3d6a  =admin', 'kind=j
+00006aa0: 6f62 275d 290a 2020 2020 2020 2020 2020  ob']).          
+00006ab0: 2020 2320 4966 2072 756e 6e69 6e67 2069    # If running i
+00006ac0: 6e20 4a75 7079 7465 722c 2063 616e 2075  n Jupyter, can u
+00006ad0: 7365 2074 6865 202e 7368 6f77 2829 2066  se the .show() f
+00006ae0: 756e 6374 696f 6e20 746f 2064 6973 706c  unction to displ
+00006af0: 6179 2074 6865 2072 6573 756c 7473 0a20  ay the results. 
+00006b00: 2020 2020 2020 2020 2020 2064 622e 6c69             db.li
+00006b10: 7374 5f72 756e 7328 6e61 6d65 3d27 272c  st_runs(name='',
+00006b20: 2070 726f 6a65 6374 3d70 726f 6a65 6374   project=project
+00006b30: 5f6e 616d 6529 2e73 686f 7728 290a 0a0a  _name).show()...
+00006b40: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+00006b50: 616d 653a 204e 616d 6520 6f66 2074 6865  ame: Name of the
+00006b60: 2072 756e 2074 6f20 7265 7472 6965 7665   run to retrieve
+00006b70: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00006b80: 2075 6964 3a20 556e 6971 7565 2049 4420   uid: Unique ID 
+00006b90: 6f66 2074 6865 2072 756e 2c20 6f72 2061  of the run, or a
+00006ba0: 206c 6973 7420 6f66 2072 756e 2055 4944   list of run UID
+00006bb0: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+00006bc0: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
+00006bd0: 6374 2074 6861 7420 7468 6520 7275 6e73  ct that the runs
+00006be0: 2062 656c 6f6e 6773 2074 6f2e 0a20 2020   belongs to..   
+00006bf0: 2020 2020 203a 7061 7261 6d20 6c61 6265       :param labe
+00006c00: 6c73 3a20 4c69 7374 2072 756e 7320 7468  ls: List runs th
+00006c10: 6174 2068 6176 6520 7370 6563 6966 6963  at have specific
+00006c20: 206c 6162 656c 7320 6173 7369 676e 6564   labels assigned
+00006c30: 2e20 6120 7369 6e67 6c65 206f 7220 6d75  . a single or mu
+00006c40: 6c74 6920 6c61 6265 6c20 6669 6c74 6572  lti label filter
+00006c50: 2063 616e 2062 650a 2020 2020 2020 2020   can be.        
+00006c60: 2020 2020 6170 706c 6965 642e 0a20 2020      applied..   
+00006c70: 2020 2020 203a 7061 7261 6d20 7374 6174       :param stat
+00006c80: 653a 204c 6973 7420 6f6e 6c79 2072 756e  e: List only run
+00006c90: 7320 7768 6f73 6520 7374 6174 6520 6973  s whose state is
+00006ca0: 2073 7065 6369 6669 6564 2e0a 2020 2020   specified..    
+00006cb0: 2020 2020 3a70 6172 616d 2073 6f72 743a      :param sort:
+00006cc0: 2057 6865 7468 6572 2074 6f20 736f 7274   Whether to sort
+00006cd0: 2074 6865 2072 6573 756c 7420 6163 636f   the result acco
+00006ce0: 7264 696e 6720 746f 2074 6865 6972 2073  rding to their s
+00006cf0: 7461 7274 2074 696d 652e 204f 7468 6572  tart time. Other
+00006d00: 7769 7365 2c20 7265 7375 6c74 7320 7769  wise, results wi
+00006d10: 6c6c 2062 650a 2020 2020 2020 2020 2020  ll be.          
+00006d20: 2020 7265 7475 726e 6564 2062 7920 7468    returned by th
+00006d30: 6569 7220 696e 7465 726e 616c 206f 7264  eir internal ord
+00006d40: 6572 2069 6e20 7468 6520 4442 2028 6f72  er in the DB (or
+00006d50: 6465 7220 7769 6c6c 206e 6f74 2062 6520  der will not be 
+00006d60: 6775 6172 616e 7465 6564 292e 0a20 2020  guaranteed)..   
+00006d70: 2020 2020 203a 7061 7261 6d20 6c61 7374       :param last
+00006d80: 3a20 4465 7072 6563 6174 6564 202d 2063  : Deprecated - c
+00006d90: 7572 7265 6e74 6c79 206e 6f74 2075 7365  urrently not use
+00006da0: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
+00006db0: 6d20 6974 6572 3a20 4966 2060 6054 7275  m iter: If ``Tru
+00006dc0: 6560 6020 7265 7475 726e 2072 756e 7320  e`` return runs 
+00006dd0: 6672 6f6d 2061 6c6c 2069 7465 7261 7469  from all iterati
+00006de0: 6f6e 732e 204f 7468 6572 7769 7365 2c20  ons. Otherwise, 
+00006df0: 7265 7475 726e 206f 6e6c 7920 7275 6e73  return only runs
+00006e00: 2077 686f 7365 2060 6069 7465 7260 6020   whose ``iter`` 
+00006e10: 6973 2030 2e0a 2020 2020 2020 2020 3a70  is 0..        :p
+00006e20: 6172 616d 2073 7461 7274 5f74 696d 655f  aram start_time_
+00006e30: 6672 6f6d 3a20 4669 6c74 6572 2062 7920  from: Filter by 
+00006e40: 7275 6e20 7374 6172 7420 7469 6d65 2069  run start time i
+00006e50: 6e20 6060 5b73 7461 7274 5f74 696d 655f  n ``[start_time_
+00006e60: 6672 6f6d 2c20 7374 6172 745f 7469 6d65  from, start_time
+00006e70: 5f74 6f5d 6060 2e0a 2020 2020 2020 2020  _to]``..        
+00006e80: 3a70 6172 616d 2073 7461 7274 5f74 696d  :param start_tim
+00006e90: 655f 746f 3a20 4669 6c74 6572 2062 7920  e_to: Filter by 
+00006ea0: 7275 6e20 7374 6172 7420 7469 6d65 2069  run start time i
+00006eb0: 6e20 6060 5b73 7461 7274 5f74 696d 655f  n ``[start_time_
+00006ec0: 6672 6f6d 2c20 7374 6172 745f 7469 6d65  from, start_time
+00006ed0: 5f74 6f5d 6060 2e0a 2020 2020 2020 2020  _to]``..        
+00006ee0: 3a70 6172 616d 206c 6173 745f 7570 6461  :param last_upda
+00006ef0: 7465 5f74 696d 655f 6672 6f6d 3a20 4669  te_time_from: Fi
+00006f00: 6c74 6572 2062 7920 7275 6e20 6c61 7374  lter by run last
+00006f10: 2075 7064 6174 6520 7469 6d65 2069 6e20   update time in 
+00006f20: 6060 286c 6173 745f 7570 6461 7465 5f74  ``(last_update_t
+00006f30: 696d 655f 6672 6f6d 2c0a 2020 2020 2020  ime_from,.      
+00006f40: 2020 2020 2020 6c61 7374 5f75 7064 6174        last_updat
+00006f50: 655f 7469 6d65 5f74 6f29 6060 2e0a 2020  e_time_to)``..  
+00006f60: 2020 2020 2020 3a70 6172 616d 206c 6173        :param las
+00006f70: 745f 7570 6461 7465 5f74 696d 655f 746f  t_update_time_to
+00006f80: 3a20 4669 6c74 6572 2062 7920 7275 6e20  : Filter by run 
+00006f90: 6c61 7374 2075 7064 6174 6520 7469 6d65  last update time
+00006fa0: 2069 6e20 6060 286c 6173 745f 7570 6461   in ``(last_upda
+00006fb0: 7465 5f74 696d 655f 6672 6f6d 2c20 6c61  te_time_from, la
+00006fc0: 7374 5f75 7064 6174 655f 7469 6d65 5f74  st_update_time_t
+00006fd0: 6f29 6060 2e0a 2020 2020 2020 2020 3a70  o)``..        :p
+00006fe0: 6172 616d 2070 6172 7469 7469 6f6e 5f62  aram partition_b
+00006ff0: 793a 2046 6965 6c64 2074 6f20 6772 6f75  y: Field to grou
+00007000: 7020 7265 7375 6c74 7320 6279 2e20 4f6e  p results by. On
+00007010: 6c79 2061 6c6c 6f77 6564 2076 616c 7565  ly allowed value
+00007020: 2069 7320 606e 616d 6560 2e20 5768 656e   is `name`. When
+00007030: 2060 7061 7274 6974 696f 6e5f 6279 6020   `partition_by` 
+00007040: 6973 2073 7065 6369 6669 6564 2c0a 2020  is specified,.  
+00007050: 2020 2020 2020 2020 2020 7468 6520 6070            the `p
+00007060: 6172 7469 7469 6f6e 5f73 6f72 745f 6279  artition_sort_by
+00007070: 6020 7061 7261 6d65 7465 7220 6d75 7374  ` parameter must
+00007080: 2062 6520 7072 6f76 6964 6564 2061 7320   be provided as 
+00007090: 7765 6c6c 2e0a 2020 2020 2020 2020 3a70  well..        :p
+000070a0: 6172 616d 2072 6f77 735f 7065 725f 7061  aram rows_per_pa
+000070b0: 7274 6974 696f 6e3a 2048 6f77 206d 616e  rtition: How man
+000070c0: 7920 746f 7020 726f 7773 2028 7065 7220  y top rows (per 
+000070d0: 736f 7274 696e 6720 6465 6669 6e65 6420  sorting defined 
+000070e0: 6279 2060 7061 7274 6974 696f 6e5f 736f  by `partition_so
+000070f0: 7274 5f62 7960 2061 6e64 2060 7061 7274  rt_by` and `part
+00007100: 6974 696f 6e5f 6f72 6465 7260 290a 2020  ition_order`).  
+00007110: 2020 2020 2020 2020 2020 746f 2072 6574            to ret
+00007120: 7572 6e20 7065 7220 6772 6f75 702e 2044  urn per group. D
+00007130: 6566 6175 6c74 2076 616c 7565 2069 7320  efault value is 
+00007140: 312e 0a20 2020 2020 2020 203a 7061 7261  1..        :para
+00007150: 6d20 7061 7274 6974 696f 6e5f 736f 7274  m partition_sort
+00007160: 5f62 793a 2057 6861 7420 6669 656c 6420  _by: What field 
+00007170: 746f 2073 6f72 7420 7468 6520 7265 7375  to sort the resu
+00007180: 6c74 7320 6279 2c20 7769 7468 696e 2065  lts by, within e
+00007190: 6163 6820 7061 7274 6974 696f 6e20 6465  ach partition de
+000071a0: 6669 6e65 6420 6279 2060 7061 7274 6974  fined by `partit
+000071b0: 696f 6e5f 6279 602e 0a20 2020 2020 2020  ion_by`..       
+000071c0: 2020 2020 2043 7572 7265 6e74 6c79 2074       Currently t
+000071d0: 6865 206f 6e6c 7920 616c 6c6f 7765 6420  he only allowed 
+000071e0: 7661 6c75 6573 2061 7265 2060 6372 6561  values are `crea
+000071f0: 7465 6460 2061 6e64 2060 7570 6461 7465  ted` and `update
+00007200: 6460 2e0a 2020 2020 2020 2020 3a70 6172  d`..        :par
+00007210: 616d 2070 6172 7469 7469 6f6e 5f6f 7264  am partition_ord
+00007220: 6572 3a20 4f72 6465 7220 6f66 2073 6f72  er: Order of sor
+00007230: 7469 6e67 2077 6974 6869 6e20 7061 7274  ting within part
+00007240: 6974 696f 6e73 202d 2060 6173 6360 206f  itions - `asc` o
+00007250: 7220 6064 6573 6360 2e20 4465 6661 756c  r `desc`. Defaul
+00007260: 7420 6973 2060 6465 7363 602e 0a20 2020  t is `desc`..   
+00007270: 2020 2020 203a 7061 7261 6d20 6d61 785f       :param max_
+00007280: 7061 7274 6974 696f 6e73 3a20 4d61 7869  partitions: Maxi
+00007290: 6d61 6c20 6e75 6d62 6572 206f 6620 7061  mal number of pa
+000072a0: 7274 6974 696f 6e73 2074 6f20 696e 636c  rtitions to incl
+000072b0: 7564 6520 696e 2074 6865 2072 6573 756c  ude in the resul
+000072c0: 742e 2044 6566 6175 6c74 2069 7320 6030  t. Default is `0
+000072d0: 6020 7768 6963 6820 6d65 616e 7320 6e6f  ` which means no
+000072e0: 0a20 2020 2020 2020 2020 2020 206c 696d  .            lim
+000072f0: 6974 2e0a 2020 2020 2020 2020 3a70 6172  it..        :par
+00007300: 616d 2077 6974 685f 6e6f 7469 6669 6361  am with_notifica
+00007310: 7469 6f6e 733a 2052 6574 7572 6e20 7275  tions: Return ru
+00007320: 6e73 2077 6974 6820 6e6f 7469 6669 6361  ns with notifica
+00007330: 7469 6f6e 732c 2061 6e64 206a 6f69 6e20  tions, and join 
+00007340: 7468 656d 2074 6f20 7468 6520 7265 7370  them to the resp
+00007350: 6f6e 7365 2e20 4465 6661 756c 7420 6973  onse. Default is
+00007360: 2060 4661 6c73 6560 2e0a 2020 2020 2020   `False`..      
+00007370: 2020 2222 220a 0a20 2020 2020 2020 2070    """..        p
+00007380: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
+00007390: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
+000073a0: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
+000073b0: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
+000073c0: 2020 2020 2020 2020 2020 226e 616d 6522            "name"
+000073d0: 3a20 6e61 6d65 2c0a 2020 2020 2020 2020  : name,.        
+000073e0: 2020 2020 2275 6964 223a 2075 6964 2c0a      "uid": uid,.
+000073f0: 2020 2020 2020 2020 2020 2020 2270 726f              "pro
+00007400: 6a65 6374 223a 2070 726f 6a65 6374 2c0a  ject": project,.
+00007410: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
+00007420: 656c 223a 206c 6162 656c 7320 6f72 205b  el": labels or [
+00007430: 5d2c 0a20 2020 2020 2020 2020 2020 2022  ],.            "
+00007440: 7374 6174 6522 3a20 7374 6174 652c 0a20  state": state,. 
+00007450: 2020 2020 2020 2020 2020 2022 736f 7274             "sort
+00007460: 223a 2062 6f6f 6c32 7374 7228 736f 7274  ": bool2str(sort
+00007470: 292c 0a20 2020 2020 2020 2020 2020 2022  ),.            "
+00007480: 6974 6572 223a 2062 6f6f 6c32 7374 7228  iter": bool2str(
+00007490: 6974 6572 292c 0a20 2020 2020 2020 2020  iter),.         
+000074a0: 2020 2022 7374 6172 745f 7469 6d65 5f66     "start_time_f
+000074b0: 726f 6d22 3a20 6461 7465 7469 6d65 5f74  rom": datetime_t
+000074c0: 6f5f 6973 6f28 7374 6172 745f 7469 6d65  o_iso(start_time
+000074d0: 5f66 726f 6d29 2c0a 2020 2020 2020 2020  _from),.        
+000074e0: 2020 2020 2273 7461 7274 5f74 696d 655f      "start_time_
+000074f0: 746f 223a 2064 6174 6574 696d 655f 746f  to": datetime_to
+00007500: 5f69 736f 2873 7461 7274 5f74 696d 655f  _iso(start_time_
+00007510: 746f 292c 0a20 2020 2020 2020 2020 2020  to),.           
+00007520: 2022 6c61 7374 5f75 7064 6174 655f 7469   "last_update_ti
+00007530: 6d65 5f66 726f 6d22 3a20 6461 7465 7469  me_from": dateti
+00007540: 6d65 5f74 6f5f 6973 6f28 6c61 7374 5f75  me_to_iso(last_u
+00007550: 7064 6174 655f 7469 6d65 5f66 726f 6d29  pdate_time_from)
+00007560: 2c0a 2020 2020 2020 2020 2020 2020 226c  ,.            "l
+00007570: 6173 745f 7570 6461 7465 5f74 696d 655f  ast_update_time_
+00007580: 746f 223a 2064 6174 6574 696d 655f 746f  to": datetime_to
+00007590: 5f69 736f 286c 6173 745f 7570 6461 7465  _iso(last_update
+000075a0: 5f74 696d 655f 746f 292c 0a20 2020 2020  _time_to),.     
+000075b0: 2020 2020 2020 2022 7769 7468 2d6e 6f74         "with-not
+000075c0: 6966 6963 6174 696f 6e73 223a 2077 6974  ifications": wit
+000075d0: 685f 6e6f 7469 6669 6361 7469 6f6e 732c  h_notifications,
+000075e0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+000075f0: 2020 2020 6966 2070 6172 7469 7469 6f6e      if partition
+00007600: 5f62 793a 0a20 2020 2020 2020 2020 2020  _by:.           
+00007610: 2070 6172 616d 732e 7570 6461 7465 280a   params.update(.
+00007620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007630: 7365 6c66 2e5f 6765 6e65 7261 7465 5f70  self._generate_p
+00007640: 6172 7469 7469 6f6e 5f62 795f 7061 7261  artition_by_para
+00007650: 6d73 280a 2020 2020 2020 2020 2020 2020  ms(.            
+00007660: 2020 2020 2020 2020 6d6c 7275 6e2e 636f          mlrun.co
+00007670: 6d6d 6f6e 2e73 6368 656d 6173 2e52 756e  mmon.schemas.Run
+00007680: 5061 7274 6974 696f 6e42 7946 6965 6c64  PartitionByField
+00007690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000076a0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+000076b0: 6279 2c0a 2020 2020 2020 2020 2020 2020  by,.            
+000076c0: 2020 2020 2020 2020 726f 7773 5f70 6572          rows_per
+000076d0: 5f70 6172 7469 7469 6f6e 2c0a 2020 2020  _partition,.    
+000076e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076f0: 7061 7274 6974 696f 6e5f 736f 7274 5f62  partition_sort_b
+00007700: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00007710: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00007720: 5f6f 7264 6572 2c0a 2020 2020 2020 2020  _order,.        
+00007730: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00007740: 7061 7274 6974 696f 6e73 2c0a 2020 2020  partitions,.    
+00007750: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007760: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00007770: 2020 2020 6572 726f 7220 3d20 226c 6973      error = "lis
+00007780: 7420 7275 6e73 220a 2020 2020 2020 2020  t runs".        
+00007790: 7265 7370 203d 2073 656c 662e 6170 695f  resp = self.api_
+000077a0: 6361 6c6c 2822 4745 5422 2c20 2272 756e  call("GET", "run
+000077b0: 7322 2c20 6572 726f 722c 2070 6172 616d  s", error, param
+000077c0: 733d 7061 7261 6d73 290a 2020 2020 2020  s=params).      
+000077d0: 2020 7265 7475 726e 2052 756e 4c69 7374    return RunList
+000077e0: 2872 6573 702e 6a73 6f6e 2829 5b22 7275  (resp.json()["ru
+000077f0: 6e73 225d 290a 0a20 2020 2064 6566 2064  ns"])..    def d
+00007800: 656c 5f72 756e 7328 7365 6c66 2c20 6e61  el_runs(self, na
+00007810: 6d65 3d4e 6f6e 652c 2070 726f 6a65 6374  me=None, project
+00007820: 3d4e 6f6e 652c 206c 6162 656c 733d 4e6f  =None, labels=No
+00007830: 6e65 2c20 7374 6174 653d 4e6f 6e65 2c20  ne, state=None, 
+00007840: 6461 7973 5f61 676f 3d30 293a 0a20 2020  days_ago=0):.   
+00007850: 2020 2020 2022 2222 4465 6c65 7465 2061       """Delete a
+00007860: 2067 726f 7570 206f 6620 7275 6e73 2069   group of runs i
+00007870: 6465 6e74 6966 6965 6420 6279 2074 6865  dentified by the
+00007880: 2070 6172 616d 6574 6572 7320 6f66 2074   parameters of t
+00007890: 6865 2066 756e 6374 696f 6e2e 0a0a 2020  he function...  
+000078a0: 2020 2020 2020 4578 616d 706c 653a 3a0a        Example::.
+000078b0: 0a20 2020 2020 2020 2020 2020 2064 622e  .            db.
+000078c0: 6465 6c5f 7275 6e73 2873 7461 7465 3d27  del_runs(state='
+000078d0: 636f 6d70 6c65 7465 6427 290a 0a20 2020  completed')..   
+000078e0: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
+000078f0: 3a20 4e61 6d65 206f 6620 7468 6520 7461  : Name of the ta
+00007900: 736b 2077 6869 6368 2074 6865 2072 756e  sk which the run
+00007910: 7320 6265 6c6f 6e67 2074 6f2e 0a20 2020  s belong to..   
+00007920: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
+00007930: 6563 743a 2050 726f 6a65 6374 2074 6f20  ect: Project to 
+00007940: 7768 6963 6820 7468 6520 7275 6e73 2062  which the runs b
+00007950: 656c 6f6e 672e 0a20 2020 2020 2020 203a  elong..        :
+00007960: 7061 7261 6d20 6c61 6265 6c73 3a20 4669  param labels: Fi
+00007970: 6c74 6572 2072 756e 7320 7468 6174 2061  lter runs that a
+00007980: 7265 206c 6162 656c 6564 2075 7369 6e67  re labeled using
+00007990: 2074 6865 7365 2073 7065 6369 6669 6320   these specific 
+000079a0: 6c61 6265 6c20 7661 6c75 6573 2e0a 2020  label values..  
+000079b0: 2020 2020 2020 3a70 6172 616d 2073 7461        :param sta
+000079c0: 7465 3a20 4669 6c74 6572 206f 6e6c 7920  te: Filter only 
+000079d0: 7275 6e73 2077 6869 6368 2061 7265 2069  runs which are i
+000079e0: 6e20 7468 6973 2073 7461 7465 2e0a 2020  n this state..  
+000079f0: 2020 2020 2020 3a70 6172 616d 2064 6179        :param day
+00007a00: 735f 6167 6f3a 2046 696c 7465 7220 7275  s_ago: Filter ru
+00007a10: 6e73 2077 686f 7365 2073 7461 7274 2074  ns whose start t
+00007a20: 696d 6520 6973 206e 6577 6572 2074 6861  ime is newer tha
+00007a30: 6e20 7468 6973 2070 6172 616d 6574 6572  n this parameter
+00007a40: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00007a50: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+00007a60: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
+00007a70: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
+00007a80: 6374 0a20 2020 2020 2020 2070 6172 616d  ct.        param
+00007a90: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+00007aa0: 2020 226e 616d 6522 3a20 6e61 6d65 2c0a    "name": name,.
+00007ab0: 2020 2020 2020 2020 2020 2020 2270 726f              "pro
+00007ac0: 6a65 6374 223a 2070 726f 6a65 6374 2c0a  ject": project,.
+00007ad0: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
+00007ae0: 656c 223a 206c 6162 656c 7320 6f72 205b  el": labels or [
+00007af0: 5d2c 0a20 2020 2020 2020 2020 2020 2022  ],.            "
+00007b00: 7374 6174 6522 3a20 7374 6174 652c 0a20  state": state,. 
+00007b10: 2020 2020 2020 2020 2020 2022 6461 7973             "days
+00007b20: 5f61 676f 223a 2073 7472 2864 6179 735f  _ago": str(days_
+00007b30: 6167 6f29 2c0a 2020 2020 2020 2020 7d0a  ago),.        }.
+00007b40: 2020 2020 2020 2020 6572 726f 7220 3d20          error = 
+00007b50: 2264 656c 2072 756e 7322 0a20 2020 2020  "del runs".     
+00007b60: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
+00007b70: 2822 4445 4c45 5445 222c 2022 7275 6e73  ("DELETE", "runs
+00007b80: 222c 2065 7272 6f72 2c20 7061 7261 6d73  ", error, params
+00007b90: 3d70 6172 616d 7329 0a0a 2020 2020 6465  =params)..    de
+00007ba0: 6620 7374 6f72 655f 6172 7469 6661 6374  f store_artifact
+00007bb0: 2873 656c 662c 206b 6579 2c20 6172 7469  (self, key, arti
+00007bc0: 6661 6374 2c20 7569 642c 2069 7465 723d  fact, uid, iter=
+00007bd0: 4e6f 6e65 2c20 7461 673d 4e6f 6e65 2c20  None, tag=None, 
+00007be0: 7072 6f6a 6563 743d 2222 293a 0a20 2020  project=""):.   
+00007bf0: 2020 2020 2022 2222 5374 6f72 6520 616e       """Store an
+00007c00: 2061 7274 6966 6163 7420 696e 2074 6865   artifact in the
+00007c10: 2044 422e 0a0a 2020 2020 2020 2020 3a70   DB...        :p
+00007c20: 6172 616d 206b 6579 3a20 4964 656e 7469  aram key: Identi
+00007c30: 6679 696e 6720 6b65 7920 6f66 2074 6865  fying key of the
+00007c40: 2061 7274 6966 6163 742e 0a20 2020 2020   artifact..     
+00007c50: 2020 203a 7061 7261 6d20 6172 7469 6661     :param artifa
+00007c60: 6374 3a20 5468 6520 6163 7475 616c 2061  ct: The actual a
+00007c70: 7274 6966 6163 7420 746f 2073 746f 7265  rtifact to store
+00007c80: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00007c90: 2075 6964 3a20 4120 756e 6971 7565 2049   uid: A unique I
+00007ca0: 4420 666f 7220 7468 6973 2073 7065 6369  D for this speci
+00007cb0: 6669 6320 7665 7273 696f 6e20 6f66 2074  fic version of t
+00007cc0: 6865 2061 7274 6966 6163 742e 0a20 2020  he artifact..   
+00007cd0: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
+00007ce0: 3a20 5468 6520 7461 736b 2069 7465 7261  : The task itera
+00007cf0: 7469 6f6e 2077 6869 6368 2067 656e 6572  tion which gener
+00007d00: 6174 6564 2074 6869 7320 6172 7469 6661  ated this artifa
+00007d10: 6374 2e20 4966 2060 6069 7465 7260 6020  ct. If ``iter`` 
+00007d20: 6973 206e 6f74 2060 604e 6f6e 6560 6020  is not ``None`` 
+00007d30: 7468 6520 6974 6572 6174 696f 6e20 7769  the iteration wi
+00007d40: 6c6c 0a20 2020 2020 2020 2020 2020 2062  ll.            b
+00007d50: 6520 6164 6465 6420 746f 2074 6865 206b  e added to the k
+00007d60: 6579 2070 726f 7669 6465 6420 746f 2067  ey provided to g
+00007d70: 656e 6572 6174 6520 6120 756e 6971 7565  enerate a unique
+00007d80: 206b 6579 2066 6f72 2074 6865 2061 7274   key for the art
+00007d90: 6966 6163 7420 6f66 2074 6865 2073 7065  ifact of the spe
+00007da0: 6369 6669 6320 6974 6572 6174 696f 6e2e  cific iteration.
+00007db0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00007dc0: 7461 673a 2054 6167 206f 6620 7468 6520  tag: Tag of the 
+00007dd0: 6172 7469 6661 6374 2e0a 2020 2020 2020  artifact..      
+00007de0: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+00007df0: 3a20 5072 6f6a 6563 7420 7468 6174 2074  : Project that t
+00007e00: 6865 2061 7274 6966 6163 7420 6265 6c6f  he artifact belo
+00007e10: 6e67 7320 746f 2e0a 2020 2020 2020 2020  ngs to..        
+00007e20: 2222 220a 0a20 2020 2020 2020 2065 6e64  """..        end
+00007e30: 706f 696e 745f 7061 7468 203d 2066 2270  point_path = f"p
+00007e40: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
+00007e50: 7d2f 6172 7469 6661 6374 732f 7b75 6964  }/artifacts/{uid
+00007e60: 7d2f 7b6b 6579 7d22 0a20 2020 2020 2020  }/{key}".       
+00007e70: 2070 6172 616d 7320 3d20 7b0a 2020 2020   params = {.    
+00007e80: 2020 2020 2020 2020 2274 6167 223a 2074          "tag": t
+00007e90: 6167 2c0a 2020 2020 2020 2020 7d0a 2020  ag,.        }.  
+00007ea0: 2020 2020 2020 6966 2069 7465 723a 0a20        if iter:. 
+00007eb0: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00007ec0: 735b 2269 7465 7222 5d20 3d20 7374 7228  s["iter"] = str(
+00007ed0: 6974 6572 290a 0a20 2020 2020 2020 2065  iter)..        e
+00007ee0: 7272 6f72 203d 2066 2273 746f 7265 2061  rror = f"store a
+00007ef0: 7274 6966 6163 7420 7b70 726f 6a65 6374  rtifact {project
+00007f00: 7d2f 7b75 6964 7d2f 7b6b 6579 7d22 0a0a  }/{uid}/{key}"..
+00007f10: 2020 2020 2020 2020 626f 6479 203d 205f          body = _
+00007f20: 6173 5f6a 736f 6e28 6172 7469 6661 6374  as_json(artifact
+00007f30: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00007f40: 7069 5f63 616c 6c28 2250 4f53 5422 2c20  pi_call("POST", 
+00007f50: 656e 6470 6f69 6e74 5f70 6174 682c 2065  endpoint_path, e
+00007f60: 7272 6f72 2c20 7061 7261 6d73 3d70 6172  rror, params=par
+00007f70: 616d 732c 2062 6f64 793d 626f 6479 290a  ams, body=body).
+00007f80: 0a20 2020 2064 6566 2072 6561 645f 6172  .    def read_ar
+00007f90: 7469 6661 6374 2873 656c 662c 206b 6579  tifact(self, key
+00007fa0: 2c20 7461 673d 4e6f 6e65 2c20 6974 6572  , tag=None, iter
+00007fb0: 3d4e 6f6e 652c 2070 726f 6a65 6374 3d22  =None, project="
+00007fc0: 2229 3a0a 2020 2020 2020 2020 2222 2252  "):.        """R
+00007fd0: 6561 6420 616e 2061 7274 6966 6163 742c  ead an artifact,
+00007fe0: 2069 6465 6e74 6966 6965 6420 6279 2069   identified by i
+00007ff0: 7473 206b 6579 2c20 7461 6720 616e 6420  ts key, tag and 
+00008000: 6974 6572 6174 696f 6e2e 2222 220a 0a20  iteration.""".. 
+00008010: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+00008020: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
+00008030: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
+00008040: 6374 0a20 2020 2020 2020 2074 6167 203d  ct.        tag =
+00008050: 2074 6167 206f 7220 226c 6174 6573 7422   tag or "latest"
+00008060: 0a20 2020 2020 2020 2065 6e64 706f 696e  .        endpoin
+00008070: 745f 7061 7468 203d 2066 2270 726f 6a65  t_path = f"proje
+00008080: 6374 732f 7b70 726f 6a65 6374 7d2f 6172  cts/{project}/ar
+00008090: 7469 6661 6374 732f 7b6b 6579 7d3f 7461  tifacts/{key}?ta
+000080a0: 673d 7b74 6167 7d22 0a20 2020 2020 2020  g={tag}".       
+000080b0: 2065 7272 6f72 203d 2066 2272 6561 6420   error = f"read 
+000080c0: 6172 7469 6661 6374 207b 7072 6f6a 6563  artifact {projec
+000080d0: 747d 2f7b 6b65 797d 220a 2020 2020 2020  t}/{key}".      
+000080e0: 2020 2320 6578 706c 6963 6974 6c79 2073    # explicitly s
+000080f0: 6574 2061 7274 6966 6163 7473 2066 6f72  et artifacts for
+00008100: 6d61 7420 746f 2027 6675 6c6c 2720 7369  mat to 'full' si
+00008110: 6e63 6520 6f6c 6420 7365 7276 6572 7320  nce old servers 
+00008120: 6d61 7920 6465 6661 756c 7420 746f 2027  may default to '
+00008130: 6c65 6761 6379 270a 2020 2020 2020 2020  legacy'.        
+00008140: 7061 7261 6d73 203d 207b 2266 6f72 6d61  params = {"forma
+00008150: 7422 3a20 6d6c 7275 6e2e 636f 6d6d 6f6e  t": mlrun.common
+00008160: 2e73 6368 656d 6173 2e41 7274 6966 6163  .schemas.Artifac
+00008170: 7473 466f 726d 6174 2e66 756c 6c2e 7661  tsFormat.full.va
+00008180: 6c75 657d 0a20 2020 2020 2020 2069 6620  lue}.        if 
+00008190: 6974 6572 3a0a 2020 2020 2020 2020 2020  iter:.          
+000081a0: 2020 7061 7261 6d73 5b22 6974 6572 225d    params["iter"]
+000081b0: 203d 2073 7472 2869 7465 7229 0a20 2020   = str(iter).   
+000081c0: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
+000081d0: 2e61 7069 5f63 616c 6c28 2247 4554 222c  .api_call("GET",
+000081e0: 2065 6e64 706f 696e 745f 7061 7468 2c20   endpoint_path, 
+000081f0: 6572 726f 722c 2070 6172 616d 733d 7061  error, params=pa
+00008200: 7261 6d73 290a 2020 2020 2020 2020 7265  rams).        re
+00008210: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
+00008220: 5b22 6461 7461 225d 0a0a 2020 2020 6465  ["data"]..    de
+00008230: 6620 6465 6c5f 6172 7469 6661 6374 2873  f del_artifact(s
+00008240: 656c 662c 206b 6579 2c20 7461 673d 4e6f  elf, key, tag=No
+00008250: 6e65 2c20 7072 6f6a 6563 743d 2222 293a  ne, project=""):
+00008260: 0a20 2020 2020 2020 2022 2222 4465 6c65  .        """Dele
+00008270: 7465 2061 6e20 6172 7469 6661 6374 2e22  te an artifact."
+00008280: 2222 0a0a 2020 2020 2020 2020 656e 6470  ""..        endp
+00008290: 6f69 6e74 5f70 6174 6820 3d20 6622 7072  oint_path = f"pr
+000082a0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
+000082b0: 2f61 7274 6966 6163 7473 2f7b 6b65 797d  /artifacts/{key}
+000082c0: 220a 2020 2020 2020 2020 7061 7261 6d73  ".        params
+000082d0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+000082e0: 2022 6b65 7922 3a20 6b65 792c 0a20 2020   "key": key,.   
+000082f0: 2020 2020 2020 2020 2022 7461 6722 3a20           "tag": 
+00008300: 7461 672c 0a20 2020 2020 2020 207d 0a20  tag,.        }. 
+00008310: 2020 2020 2020 2065 7272 6f72 203d 2066         error = f
+00008320: 2264 656c 2061 7274 6966 6163 7420 7b70  "del artifact {p
+00008330: 726f 6a65 6374 7d2f 7b6b 6579 7d22 0a20  roject}/{key}". 
+00008340: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
+00008350: 6361 6c6c 2822 4445 4c45 5445 222c 2065  call("DELETE", e
+00008360: 6e64 706f 696e 745f 7061 7468 2c20 6572  ndpoint_path, er
+00008370: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
+00008380: 6d73 290a 0a20 2020 2064 6566 206c 6973  ms)..    def lis
+00008390: 745f 6172 7469 6661 6374 7328 0a20 2020  t_artifacts(.   
+000083a0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000083b0: 2020 206e 616d 653d 4e6f 6e65 2c0a 2020     name=None,.  
+000083c0: 2020 2020 2020 7072 6f6a 6563 743d 4e6f        project=No
+000083d0: 6e65 2c0a 2020 2020 2020 2020 7461 673d  ne,.        tag=
+000083e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
+000083f0: 6265 6c73 3a20 4f70 7469 6f6e 616c 5b55  bels: Optional[U
+00008400: 6e69 6f6e 5b44 6963 745b 7374 722c 2073  nion[Dict[str, s
+00008410: 7472 5d2c 204c 6973 745b 7374 725d 5d5d  tr], List[str]]]
+00008420: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00008430: 2073 696e 6365 3d4e 6f6e 652c 0a20 2020   since=None,.   
+00008440: 2020 2020 2075 6e74 696c 3d4e 6f6e 652c       until=None,
+00008450: 0a20 2020 2020 2020 2069 7465 723a 2069  .        iter: i
+00008460: 6e74 203d 204e 6f6e 652c 0a20 2020 2020  nt = None,.     
+00008470: 2020 2062 6573 745f 6974 6572 6174 696f     best_iteratio
+00008480: 6e3a 2062 6f6f 6c20 3d20 4661 6c73 652c  n: bool = False,
+00008490: 0a20 2020 2020 2020 206b 696e 643a 2073  .        kind: s
+000084a0: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
+000084b0: 2020 2063 6174 6567 6f72 793a 2055 6e69     category: Uni
+000084c0: 6f6e 5b73 7472 2c20 6d6c 7275 6e2e 636f  on[str, mlrun.co
+000084d0: 6d6d 6f6e 2e73 6368 656d 6173 2e41 7274  mmon.schemas.Art
+000084e0: 6966 6163 7443 6174 6567 6f72 6965 735d  ifactCategories]
+000084f0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+00008500: 3e20 4172 7469 6661 6374 4c69 7374 3a0a  > ArtifactList:.
+00008510: 2020 2020 2020 2020 2222 224c 6973 7420          """List 
+00008520: 6172 7469 6661 6374 7320 6669 6c74 6572  artifacts filter
+00008530: 6564 2062 7920 7661 7269 6f75 7320 7061  ed by various pa
+00008540: 7261 6d65 7465 7273 2e0a 0a20 2020 2020  rameters...     
+00008550: 2020 2045 7861 6d70 6c65 733a 3a0a 0a20     Examples::.. 
+00008560: 2020 2020 2020 2020 2020 2023 2053 686f             # Sho
+00008570: 7720 6c61 7465 7374 2076 6572 7369 6f6e  w latest version
+00008580: 206f 6620 616c 6c20 6172 7469 6661 6374   of all artifact
+00008590: 7320 696e 2070 726f 6a65 6374 0a20 2020  s in project.   
+000085a0: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
+000085b0: 6172 7469 6661 6374 7320 3d20 6462 2e6c  artifacts = db.l
+000085c0: 6973 745f 6172 7469 6661 6374 7328 2727  ist_artifacts(''
+000085d0: 2c20 7461 673d 276c 6174 6573 7427 2c20  , tag='latest', 
+000085e0: 7072 6f6a 6563 743d 2769 7269 7327 290a  project='iris').
+000085f0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
+00008600: 6563 6b20 6469 6666 6572 656e 7420 6172  eck different ar
+00008610: 7469 6661 6374 2076 6572 7369 6f6e 7320  tifact versions 
+00008620: 666f 7220 6120 7370 6563 6966 6963 2061  for a specific a
+00008630: 7274 6966 6163 740a 2020 2020 2020 2020  rtifact.        
+00008640: 2020 2020 7265 7375 6c74 5f76 6572 7369      result_versi
+00008650: 6f6e 7320 3d20 6462 2e6c 6973 745f 6172  ons = db.list_ar
+00008660: 7469 6661 6374 7328 2772 6573 756c 7473  tifacts('results
+00008670: 272c 2074 6167 3d27 2a27 2c20 7072 6f6a  ', tag='*', proj
+00008680: 6563 743d 2769 7269 7327 290a 2020 2020  ect='iris').    
+00008690: 2020 2020 2020 2020 2320 5368 6f77 2061          # Show a
+000086a0: 7274 6966 6163 7473 2077 6974 6820 6c61  rtifacts with la
+000086b0: 6265 6c20 6669 6c74 6572 7320 2d20 626f  bel filters - bo
+000086c0: 7468 2075 706c 6f61 6465 6420 616e 6420  th uploaded and 
+000086d0: 6f66 2062 696e 6172 7920 7479 7065 0a20  of binary type. 
+000086e0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+000086f0: 745f 6c61 6265 6c73 203d 2064 622e 6c69  t_labels = db.li
+00008700: 7374 5f61 7274 6966 6163 7473 2827 7265  st_artifacts('re
+00008710: 7375 6c74 7327 2c20 7461 673d 272a 272c  sults', tag='*',
+00008720: 2070 726f 6a65 6374 3d27 6972 6973 272c   project='iris',
+00008730: 206c 6162 656c 733d 5b27 7570 6c6f 6164   labels=['upload
+00008740: 6564 272c 2027 7479 7065 3d62 696e 6172  ed', 'type=binar
+00008750: 7927 5d29 0a0a 2020 2020 2020 2020 3a70  y'])..        :p
+00008760: 6172 616d 206e 616d 653a 204e 616d 6520  aram name: Name 
+00008770: 6f66 2061 7274 6966 6163 7473 2074 6f20  of artifacts to 
+00008780: 7265 7472 6965 7665 2e20 4e61 6d65 2077  retrieve. Name w
+00008790: 6974 6820 277e 2720 7072 6566 6978 2069  ith '~' prefix i
+000087a0: 7320 7573 6564 2061 7320 6120 6c69 6b65  s used as a like
+000087b0: 2071 7565 7279 2c20 616e 6420 6973 206e   query, and is n
+000087c0: 6f74 0a20 2020 2020 2020 2020 2020 2063  ot.            c
+000087d0: 6173 652d 7365 6e73 6974 6976 652e 2054  ase-sensitive. T
+000087e0: 6869 7320 6d65 616e 7320 7468 6174 2071  his means that q
+000087f0: 7565 7279 696e 6720 666f 7220 6060 7e6e  uerying for ``~n
+00008800: 616d 6560 6020 6d61 7920 7265 7475 726e  ame`` may return
+00008810: 2061 7274 6966 6163 7473 206e 616d 6564   artifacts named
+00008820: 0a20 2020 2020 2020 2020 2020 2060 606d  .            ``m
+00008830: 795f 4e61 6d65 5f31 6060 206f 7220 6060  y_Name_1`` or ``
+00008840: 7375 726e 616d 6560 602e 0a20 2020 2020  surname``..     
+00008850: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00008860: 743a 2050 726f 6a65 6374 206e 616d 652e  t: Project name.
+00008870: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00008880: 7461 673a 2052 6574 7572 6e20 6172 7469  tag: Return arti
+00008890: 6661 6374 7320 6173 7369 676e 6564 2074  facts assigned t
+000088a0: 6869 7320 7461 672e 0a20 2020 2020 2020  his tag..       
+000088b0: 203a 7061 7261 6d20 6c61 6265 6c73 3a20   :param labels: 
+000088c0: 5265 7475 726e 2061 7274 6966 6163 7473  Return artifacts
+000088d0: 2074 6861 7420 6861 7665 2074 6865 7365   that have these
+000088e0: 206c 6162 656c 732e 204c 6162 656c 7320   labels. Labels 
+000088f0: 6361 6e20 6569 7468 6572 2062 6520 6120  can either be a 
+00008900: 6469 6374 696f 6e61 7279 207b 226c 6162  dictionary {"lab
+00008910: 656c 223a 2022 7661 6c75 6522 7d20 6f72  el": "value"} or
+00008920: 0a20 2020 2020 2020 2020 2020 2061 206c  .            a l
+00008930: 6973 7420 6f66 2022 6c61 6265 6c3d 7661  ist of "label=va
+00008940: 6c75 6522 2028 6d61 7463 6820 6c61 6265  lue" (match labe
+00008950: 6c20 6b65 7920 616e 6420 7661 6c75 6529  l key and value)
+00008960: 206f 7220 226c 6162 656c 2220 286d 6174   or "label" (mat
+00008970: 6368 206a 7573 7420 6c61 6265 6c20 6b65  ch just label ke
+00008980: 7929 2073 7472 696e 6773 2e0a 2020 2020  y) strings..    
+00008990: 2020 2020 3a70 6172 616d 2073 696e 6365      :param since
+000089a0: 3a20 4e6f 7420 696e 2075 7365 2069 6e20  : Not in use in 
+000089b0: 3a70 793a 636c 6173 733a 6048 5454 5052  :py:class:`HTTPR
+000089c0: 756e 4442 602e 0a20 2020 2020 2020 203a  unDB`..        :
+000089d0: 7061 7261 6d20 756e 7469 6c3a 204e 6f74  param until: Not
+000089e0: 2069 6e20 7573 6520 696e 203a 7079 3a63   in use in :py:c
+000089f0: 6c61 7373 3a60 4854 5450 5275 6e44 4260  lass:`HTTPRunDB`
+00008a00: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00008a10: 2069 7465 723a 2052 6574 7572 6e20 6172   iter: Return ar
+00008a20: 7469 6661 6374 7320 6672 6f6d 2061 2073  tifacts from a s
+00008a30: 7065 6369 6669 6320 6974 6572 6174 696f  pecific iteratio
+00008a40: 6e20 2877 6865 7265 2060 6069 7465 723d  n (where ``iter=
+00008a50: 3060 6020 6d65 616e 7320 7468 6520 726f  0`` means the ro
+00008a60: 6f74 2069 7465 7261 7469 6f6e 292e 2049  ot iteration). I
+00008a70: 660a 2020 2020 2020 2020 2020 2020 6060  f.            ``
+00008a80: 4e6f 6e65 6060 2028 6465 6661 756c 7429  None`` (default)
+00008a90: 2072 6574 7572 6e20 6172 7469 6661 6374   return artifact
+00008aa0: 7320 6672 6f6d 2061 6c6c 2069 7465 7261  s from all itera
+00008ab0: 7469 6f6e 732e 0a20 2020 2020 2020 203a  tions..        :
+00008ac0: 7061 7261 6d20 6265 7374 5f69 7465 7261  param best_itera
+00008ad0: 7469 6f6e 3a20 5265 7475 726e 7320 7468  tion: Returns th
+00008ae0: 6520 6172 7469 6661 6374 2077 6869 6368  e artifact which
+00008af0: 2062 656c 6f6e 6773 2074 6f20 7468 6520   belongs to the 
+00008b00: 6265 7374 2069 7465 7261 7469 6f6e 206f  best iteration o
+00008b10: 6620 6120 6769 7665 6e20 7275 6e2c 2069  f a given run, i
+00008b20: 6e20 7468 6520 6361 7365 206f 660a 2020  n the case of.  
+00008b30: 2020 2020 2020 2020 2020 6172 7469 6661            artifa
+00008b40: 6374 7320 6765 6e65 7261 7465 6420 6672  cts generated fr
+00008b50: 6f6d 2061 2068 7970 6572 2d70 6172 616d  om a hyper-param
+00008b60: 2072 756e 2e20 4966 206f 6e6c 7920 6120   run. If only a 
+00008b70: 7369 6e67 6c65 2069 7465 7261 7469 6f6e  single iteration
+00008b80: 2065 7869 7374 732c 2077 696c 6c20 7265   exists, will re
+00008b90: 7475 726e 2074 6865 2061 7274 6966 6163  turn the artifac
+00008ba0: 740a 2020 2020 2020 2020 2020 2020 6672  t.            fr
+00008bb0: 6f6d 2074 6861 7420 6974 6572 6174 696f  om that iteratio
+00008bc0: 6e2e 2049 6620 7573 696e 6720 6060 6265  n. If using ``be
+00008bd0: 7374 5f69 7465 7260 602c 2074 6865 2060  st_iter``, the `
+00008be0: 6069 7465 7260 6020 7061 7261 6d65 7465  `iter`` paramete
+00008bf0: 7220 6d75 7374 206e 6f74 2062 6520 7573  r must not be us
+00008c00: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
+00008c10: 616d 206b 696e 643a 2052 6574 7572 6e20  am kind: Return 
+00008c20: 6172 7469 6661 6374 7320 6f66 2074 6865  artifacts of the
+00008c30: 2072 6571 7565 7374 6564 206b 696e 642e   requested kind.
+00008c40: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00008c50: 6361 7465 676f 7279 3a20 5265 7475 726e  category: Return
+00008c60: 2061 7274 6966 6163 7473 206f 6620 7468   artifacts of th
+00008c70: 6520 7265 7175 6573 7465 6420 6361 7465  e requested cate
+00008c80: 676f 7279 2e0a 2020 2020 2020 2020 2222  gory..        ""
+00008c90: 220a 0a20 2020 2020 2020 2070 726f 6a65  "..        proje
+00008ca0: 6374 203d 2070 726f 6a65 6374 206f 7220  ct = project or 
+00008cb0: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
+00008cc0: 726f 6a65 6374 0a0a 2020 2020 2020 2020  roject..        
+00008cd0: 6c61 6265 6c73 203d 206c 6162 656c 7320  labels = labels 
+00008ce0: 6f72 205b 5d0a 2020 2020 2020 2020 6966  or [].        if
+00008cf0: 2069 7369 6e73 7461 6e63 6528 6c61 6265   isinstance(labe
+00008d00: 6c73 2c20 6469 6374 293a 0a20 2020 2020  ls, dict):.     
+00008d10: 2020 2020 2020 206c 6162 656c 7320 3d20         labels = 
+00008d20: 5b66 227b 6b65 797d 3d7b 7661 6c75 657d  [f"{key}={value}
+00008d30: 2220 666f 7220 6b65 792c 2076 616c 7565  " for key, value
+00008d40: 2069 6e20 6c61 6265 6c73 2e69 7465 6d73   in labels.items
+00008d50: 2829 5d0a 0a20 2020 2020 2020 2070 6172  ()]..        par
+00008d60: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
+00008d70: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
+00008d80: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
+00008d90: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
+00008da0: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
+00008db0: 6162 656c 732c 0a20 2020 2020 2020 2020  abels,.         
+00008dc0: 2020 2022 6974 6572 223a 2069 7465 722c     "iter": iter,
+00008dd0: 0a20 2020 2020 2020 2020 2020 2022 6265  .            "be
+00008de0: 7374 2d69 7465 7261 7469 6f6e 223a 2062  st-iteration": b
+00008df0: 6573 745f 6974 6572 6174 696f 6e2c 0a20  est_iteration,. 
+00008e00: 2020 2020 2020 2020 2020 2022 6b69 6e64             "kind
+00008e10: 223a 206b 696e 642c 0a20 2020 2020 2020  ": kind,.       
+00008e20: 2020 2020 2022 6361 7465 676f 7279 223a       "category":
+00008e30: 2063 6174 6567 6f72 792c 0a20 2020 2020   category,.     
+00008e40: 2020 2020 2020 2022 666f 726d 6174 223a         "format":
+00008e50: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+00008e60: 6865 6d61 732e 4172 7469 6661 6374 7346  hemas.ArtifactsF
+00008e70: 6f72 6d61 742e 6675 6c6c 2e76 616c 7565  ormat.full.value
+00008e80: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
+00008e90: 2020 2020 6572 726f 7220 3d20 226c 6973      error = "lis
+00008ea0: 7420 6172 7469 6661 6374 7322 0a20 2020  t artifacts".   
+00008eb0: 2020 2020 2065 6e64 706f 696e 745f 7061       endpoint_pa
+00008ec0: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+00008ed0: 7b70 726f 6a65 6374 7d2f 6172 7469 6661  {project}/artifa
+00008ee0: 6374 7322 0a20 2020 2020 2020 2072 6573  cts".        res
+00008ef0: 7020 3d20 7365 6c66 2e61 7069 5f63 616c  p = self.api_cal
+00008f00: 6c28 2247 4554 222c 2065 6e64 706f 696e  l("GET", endpoin
+00008f10: 745f 7061 7468 2c20 6572 726f 722c 2070  t_path, error, p
+00008f20: 6172 616d 733d 7061 7261 6d73 290a 2020  arams=params).  
+00008f30: 2020 2020 2020 7661 6c75 6573 203d 2041        values = A
+00008f40: 7274 6966 6163 744c 6973 7428 7265 7370  rtifactList(resp
+00008f50: 2e6a 736f 6e28 295b 2261 7274 6966 6163  .json()["artifac
+00008f60: 7473 225d 290a 2020 2020 2020 2020 7661  ts"]).        va
+00008f70: 6c75 6573 2e74 6167 203d 2074 6167 0a20  lues.tag = tag. 
+00008f80: 2020 2020 2020 2072 6574 7572 6e20 7661         return va
+00008f90: 6c75 6573 0a0a 2020 2020 6465 6620 6465  lues..    def de
+00008fa0: 6c5f 6172 7469 6661 6374 7328 7365 6c66  l_artifacts(self
+00008fb0: 2c20 6e61 6d65 3d4e 6f6e 652c 2070 726f  , name=None, pro
+00008fc0: 6a65 6374 3d4e 6f6e 652c 2074 6167 3d4e  ject=None, tag=N
+00008fd0: 6f6e 652c 206c 6162 656c 733d 4e6f 6e65  one, labels=None
+00008fe0: 2c20 6461 7973 5f61 676f 3d30 293a 0a20  , days_ago=0):. 
+00008ff0: 2020 2020 2020 2022 2222 4465 6c65 7465         """Delete
+00009000: 2061 7274 6966 6163 7473 2072 6566 6572   artifacts refer
+00009010: 656e 6365 6420 6279 2074 6865 2070 6172  enced by the par
+00009020: 616d 6574 6572 732e 0a0a 2020 2020 2020  ameters...      
+00009030: 2020 3a70 6172 616d 206e 616d 653a 204e    :param name: N
+00009040: 616d 6520 6f66 2061 7274 6966 6163 7473  ame of artifacts
+00009050: 2074 6f20 6465 6c65 7465 2e20 4e6f 7465   to delete. Note
+00009060: 2074 6861 7420 7468 6973 2069 7320 6120   that this is a 
+00009070: 6c69 6b65 2071 7565 7279 2c20 616e 6420  like query, and 
+00009080: 6973 2063 6173 652d 696e 7365 6e73 6974  is case-insensit
+00009090: 6976 652e 2053 6565 0a20 2020 2020 2020  ive. See.       
+000090a0: 2020 2020 203a 7079 3a66 756e 633a 607e       :py:func:`~
+000090b0: 6c69 7374 5f61 7274 6966 6163 7473 6020  list_artifacts` 
+000090c0: 666f 7220 6d6f 7265 2064 6574 6169 6c73  for more details
+000090d0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+000090e0: 2070 726f 6a65 6374 3a20 5072 6f6a 6563   project: Projec
+000090f0: 7420 7468 6174 2061 7274 6966 6163 7473  t that artifacts
+00009100: 2062 656c 6f6e 6720 746f 2e0a 2020 2020   belong to..    
+00009110: 2020 2020 3a70 6172 616d 2074 6167 3a20      :param tag: 
+00009120: 4368 6f6f 7365 2061 7274 6966 6163 7473  Choose artifacts
+00009130: 2077 686f 2061 7265 2061 7373 6967 6e65   who are assigne
+00009140: 6420 7468 6973 2074 6167 2e0a 2020 2020  d this tag..    
+00009150: 2020 2020 3a70 6172 616d 206c 6162 656c      :param label
+00009160: 733a 2043 686f 6f73 6520 6172 7469 6661  s: Choose artifa
+00009170: 6374 7320 7768 6963 6820 6172 6520 6c61  cts which are la
+00009180: 6265 6c65 642e 0a20 2020 2020 2020 203a  beled..        :
+00009190: 7061 7261 6d20 6461 7973 5f61 676f 3a20  param days_ago: 
+000091a0: 5468 6973 2070 6172 616d 6574 6572 2069  This parameter i
+000091b0: 7320 6465 7072 6563 6174 6564 2061 6e64  s deprecated and
+000091c0: 206e 6f74 2075 7365 642e 0a20 2020 2020   not used..     
+000091d0: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+000091e0: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
+000091f0: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
+00009200: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
+00009210: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
+00009220: 2020 2020 2020 2020 2020 226e 616d 6522            "name"
+00009230: 3a20 6e61 6d65 2c0a 2020 2020 2020 2020  : name,.        
+00009240: 2020 2020 2274 6167 223a 2074 6167 2c0a      "tag": tag,.
+00009250: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
+00009260: 656c 223a 206c 6162 656c 7320 6f72 205b  el": labels or [
+00009270: 5d2c 0a20 2020 2020 2020 2020 2020 2022  ],.            "
+00009280: 6461 7973 5f61 676f 223a 2073 7472 2864  days_ago": str(d
+00009290: 6179 735f 6167 6f29 2c0a 2020 2020 2020  ays_ago),.      
+000092a0: 2020 7d0a 2020 2020 2020 2020 6572 726f    }.        erro
+000092b0: 7220 3d20 2264 656c 2061 7274 6966 6163  r = "del artifac
+000092c0: 7473 220a 2020 2020 2020 2020 656e 6470  ts".        endp
+000092d0: 6f69 6e74 5f70 6174 6820 3d20 6622 7072  oint_path = f"pr
+000092e0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
+000092f0: 2f61 7274 6966 6163 7473 220a 2020 2020  /artifacts".    
+00009300: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
+00009310: 6c28 2244 454c 4554 4522 2c20 656e 6470  l("DELETE", endp
+00009320: 6f69 6e74 5f70 6174 682c 2065 7272 6f72  oint_path, error
+00009330: 2c20 7061 7261 6d73 3d70 6172 616d 7329  , params=params)
+00009340: 0a0a 2020 2020 6465 6620 6c69 7374 5f61  ..    def list_a
+00009350: 7274 6966 6163 745f 7461 6773 280a 2020  rtifact_tags(.  
+00009360: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00009370: 2020 2020 7072 6f6a 6563 743d 4e6f 6e65      project=None
+00009380: 2c0a 2020 2020 2020 2020 6361 7465 676f  ,.        catego
+00009390: 7279 3a20 556e 696f 6e5b 7374 722c 206d  ry: Union[str, m
+000093a0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+000093b0: 6d61 732e 4172 7469 6661 6374 4361 7465  mas.ArtifactCate
+000093c0: 676f 7269 6573 5d20 3d20 4e6f 6e65 2c0a  gories] = None,.
+000093d0: 2020 2020 2920 2d3e 204c 6973 745b 7374      ) -> List[st
+000093e0: 725d 3a0a 2020 2020 2020 2020 2222 2252  r]:.        """R
+000093f0: 6574 7572 6e20 6120 6c69 7374 206f 6620  eturn a list of 
+00009400: 616c 6c20 7468 6520 7461 6773 2061 7373  all the tags ass
+00009410: 6967 6e65 6420 746f 2061 7274 6966 6163  igned to artifac
+00009420: 7473 2069 6e20 7468 6520 7363 6f70 6520  ts in the scope 
+00009430: 6f66 2074 6865 2067 6976 656e 2070 726f  of the given pro
+00009440: 6a65 6374 2e22 2222 0a0a 2020 2020 2020  ject."""..      
+00009450: 2020 7072 6f6a 6563 7420 3d20 7072 6f6a    project = proj
+00009460: 6563 7420 6f72 2063 6f6e 6669 672e 6465  ect or config.de
+00009470: 6661 756c 745f 7072 6f6a 6563 740a 2020  fault_project.  
+00009480: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+00009490: 6167 6520 3d20 6622 4661 696c 6564 206c  age = f"Failed l
+000094a0: 6973 7469 6e67 2061 7274 6966 6163 7420  isting artifact 
+000094b0: 7461 6773 2e20 7072 6f6a 6563 743d 7b70  tags. project={p
+000094c0: 726f 6a65 6374 7d22 0a20 2020 2020 2020  roject}".       
+000094d0: 2070 6172 616d 7320 3d20 7b22 6361 7465   params = {"cate
+000094e0: 676f 7279 223a 2063 6174 6567 6f72 797d  gory": category}
+000094f0: 2069 6620 6361 7465 676f 7279 2065 6c73   if category els
+00009500: 6520 7b7d 0a0a 2020 2020 2020 2020 7265  e {}..        re
+00009510: 7370 6f6e 7365 203d 2073 656c 662e 6170  sponse = self.ap
+00009520: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
+00009530: 2020 2020 2247 4554 222c 2066 2270 726f      "GET", f"pro
+00009540: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
+00009550: 6172 7469 6661 6374 2d74 6167 7322 2c20  artifact-tags", 
+00009560: 6572 726f 725f 6d65 7373 6167 652c 2070  error_message, p
+00009570: 6172 616d 733d 7061 7261 6d73 0a20 2020  arams=params.   
+00009580: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+00009590: 6574 7572 6e20 7265 7370 6f6e 7365 2e6a  eturn response.j
+000095a0: 736f 6e28 295b 2274 6167 7322 5d0a 0a20  son()["tags"].. 
+000095b0: 2020 2064 6566 2073 746f 7265 5f66 756e     def store_fun
+000095c0: 6374 696f 6e28 0a20 2020 2020 2020 2073  ction(.        s
+000095d0: 656c 662c 0a20 2020 2020 2020 2066 756e  elf,.        fun
+000095e0: 6374 696f 6e3a 2074 7970 696e 672e 556e  ction: typing.Un
+000095f0: 696f 6e5b 6d6c 7275 6e2e 7275 6e74 696d  ion[mlrun.runtim
+00009600: 6573 2e42 6173 6552 756e 7469 6d65 2c20  es.BaseRuntime, 
+00009610: 6469 6374 5d2c 0a20 2020 2020 2020 206e  dict],.        n
+00009620: 616d 652c 0a20 2020 2020 2020 2070 726f  ame,.        pro
+00009630: 6a65 6374 3d22 222c 0a20 2020 2020 2020  ject="",.       
+00009640: 2074 6167 3d4e 6f6e 652c 0a20 2020 2020   tag=None,.     
+00009650: 2020 2076 6572 7369 6f6e 6564 3d46 616c     versioned=Fal
+00009660: 7365 2c0a 2020 2020 293a 0a20 2020 2020  se,.    ):.     
+00009670: 2020 2022 2222 5374 6f72 6520 6120 6675     """Store a fu
+00009680: 6e63 7469 6f6e 206f 626a 6563 742e 2046  nction object. F
+00009690: 756e 6374 696f 6e20 6973 2069 6465 6e74  unction is ident
+000096a0: 6966 6965 6420 6279 2069 7473 206e 616d  ified by its nam
+000096b0: 6520 616e 6420 7461 672c 2061 6e64 2063  e and tag, and c
+000096c0: 616e 2062 6520 7665 7273 696f 6e65 642e  an be versioned.
+000096d0: 2222 220a 2020 2020 2020 2020 6e61 6d65  """.        name
+000096e0: 203d 206d 6c72 756e 2e75 7469 6c73 2e6e   = mlrun.utils.n
+000096f0: 6f72 6d61 6c69 7a65 5f6e 616d 6528 6e61  ormalize_name(na
+00009700: 6d65 290a 2020 2020 2020 2020 6966 2068  me).        if h
+00009710: 6173 6174 7472 2866 756e 6374 696f 6e2c  asattr(function,
+00009720: 2022 746f 5f64 6963 7422 293a 0a20 2020   "to_dict"):.   
+00009730: 2020 2020 2020 2020 2066 756e 6374 696f           functio
+00009740: 6e20 3d20 6675 6e63 7469 6f6e 2e74 6f5f  n = function.to_
+00009750: 6469 6374 2829 0a0a 2020 2020 2020 2020  dict()..        
+00009760: 7061 7261 6d73 203d 207b 2274 6167 223a  params = {"tag":
+00009770: 2074 6167 2c20 2276 6572 7369 6f6e 6564   tag, "versioned
+00009780: 223a 2076 6572 7369 6f6e 6564 7d0a 2020  ": versioned}.  
+00009790: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
+000097a0: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
+000097b0: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
+000097c0: 740a 2020 2020 2020 2020 7061 7468 203d  t.        path =
+000097d0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+000097e0: 6a65 6374 7d2f 6675 6e63 7469 6f6e 732f  ject}/functions/
+000097f0: 7b6e 616d 657d 220a 0a20 2020 2020 2020  {name}"..       
+00009800: 2065 7272 6f72 203d 2066 2273 746f 7265   error = f"store
+00009810: 2066 756e 6374 696f 6e20 7b70 726f 6a65   function {proje
+00009820: 6374 7d2f 7b6e 616d 657d 220a 2020 2020  ct}/{name}".    
+00009830: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+00009840: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+00009850: 2020 2020 2020 2250 4f53 5422 2c20 7061        "POST", pa
+00009860: 7468 2c20 6572 726f 722c 2070 6172 616d  th, error, param
+00009870: 733d 7061 7261 6d73 2c20 626f 6479 3d64  s=params, body=d
+00009880: 6963 745f 746f 5f6a 736f 6e28 6675 6e63  ict_to_json(func
+00009890: 7469 6f6e 290a 2020 2020 2020 2020 290a  tion).        ).
+000098a0: 0a20 2020 2020 2020 2023 2068 6173 6820  .        # hash 
+000098b0: 6b65 7920 6f70 7469 6f6e 616c 2074 6f20  key optional to 
+000098c0: 6265 2062 6163 6b77 6172 6473 2063 6f6d  be backwards com
+000098d0: 7061 7469 626c 6520 746f 2041 5049 2076  patible to API v
+000098e0: 3c30 2e34 2e31 3020 696e 2077 6869 6368  <0.4.10 in which
+000098f0: 2069 7420 7761 736e 2774 2069 6e20 7468   it wasn't in th
+00009900: 6520 7265 7370 6f6e 7365 0a20 2020 2020  e response.     
+00009910: 2020 2072 6574 7572 6e20 7265 7370 2e6a     return resp.j
+00009920: 736f 6e28 292e 6765 7428 2268 6173 685f  son().get("hash_
+00009930: 6b65 7922 290a 0a20 2020 2064 6566 2067  key")..    def g
+00009940: 6574 5f66 756e 6374 696f 6e28 7365 6c66  et_function(self
+00009950: 2c20 6e61 6d65 2c20 7072 6f6a 6563 743d  , name, project=
+00009960: 2222 2c20 7461 673d 4e6f 6e65 2c20 6861  "", tag=None, ha
+00009970: 7368 5f6b 6579 3d22 2229 3a0a 2020 2020  sh_key=""):.    
+00009980: 2020 2020 2222 2252 6574 7269 6576 6520      """Retrieve 
+00009990: 6465 7461 696c 7320 6f66 2061 2073 7065  details of a spe
+000099a0: 6369 6669 6320 6675 6e63 7469 6f6e 2c20  cific function, 
+000099b0: 6964 656e 7469 6669 6564 2062 7920 6974  identified by it
+000099c0: 7320 6e61 6d65 2061 6e64 2070 6f74 656e  s name and poten
+000099d0: 7469 616c 6c79 2061 2074 6167 206f 7220  tially a tag or 
+000099e0: 6675 6e63 7469 6f6e 2068 6173 682e 2222  function hash.""
+000099f0: 220a 0a20 2020 2020 2020 2070 6172 616d  "..        param
+00009a00: 7320 3d20 7b22 7461 6722 3a20 7461 672c  s = {"tag": tag,
+00009a10: 2022 6861 7368 5f6b 6579 223a 2068 6173   "hash_key": has
+00009a20: 685f 6b65 797d 0a20 2020 2020 2020 2070  h_key}.        p
+00009a30: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
+00009a40: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
+00009a50: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
+00009a60: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
+00009a70: 6563 7473 2f7b 7072 6f6a 6563 747d 2f66  ects/{project}/f
+00009a80: 756e 6374 696f 6e73 2f7b 6e61 6d65 7d22  unctions/{name}"
+00009a90: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
+00009aa0: 2066 2267 6574 2066 756e 6374 696f 6e20   f"get function 
+00009ab0: 7b70 726f 6a65 6374 7d2f 7b6e 616d 657d  {project}/{name}
+00009ac0: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
+00009ad0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+00009ae0: 4745 5422 2c20 7061 7468 2c20 6572 726f  GET", path, erro
+00009af0: 722c 2070 6172 616d 733d 7061 7261 6d73  r, params=params
+00009b00: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00009b10: 2072 6573 702e 6a73 6f6e 2829 5b22 6675   resp.json()["fu
+00009b20: 6e63 225d 0a0a 2020 2020 6465 6620 6465  nc"]..    def de
+00009b30: 6c65 7465 5f66 756e 6374 696f 6e28 7365  lete_function(se
+00009b40: 6c66 2c20 6e61 6d65 3a20 7374 722c 2070  lf, name: str, p
+00009b50: 726f 6a65 6374 3a20 7374 7220 3d20 2222  roject: str = ""
+00009b60: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
+00009b70: 6c65 7465 2061 2066 756e 6374 696f 6e20  lete a function 
+00009b80: 6265 6c6f 6e67 696e 6720 746f 2061 2073  belonging to a s
+00009b90: 7065 6369 6669 6320 7072 6f6a 6563 742e  pecific project.
+00009ba0: 2222 220a 0a20 2020 2020 2020 2070 726f  """..        pro
+00009bb0: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
+00009bc0: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
+00009bd0: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
+00009be0: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
+00009bf0: 7473 2f7b 7072 6f6a 6563 747d 2f66 756e  ts/{project}/fun
+00009c00: 6374 696f 6e73 2f7b 6e61 6d65 7d22 0a20  ctions/{name}". 
+00009c10: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
+00009c20: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
+00009c30: 6465 6c65 7469 6e67 2066 756e 6374 696f  deleting functio
+00009c40: 6e20 7b70 726f 6a65 6374 7d2f 7b6e 616d  n {project}/{nam
+00009c50: 657d 220a 2020 2020 2020 2020 7365 6c66  e}".        self
+00009c60: 2e61 7069 5f63 616c 6c28 2244 454c 4554  .api_call("DELET
+00009c70: 4522 2c20 7061 7468 2c20 6572 726f 725f  E", path, error_
+00009c80: 6d65 7373 6167 6529 0a0a 2020 2020 6465  message)..    de
+00009c90: 6620 6c69 7374 5f66 756e 6374 696f 6e73  f list_functions
+00009ca0: 2873 656c 662c 206e 616d 653d 4e6f 6e65  (self, name=None
+00009cb0: 2c20 7072 6f6a 6563 743d 4e6f 6e65 2c20  , project=None, 
+00009cc0: 7461 673d 4e6f 6e65 2c20 6c61 6265 6c73  tag=None, labels
+00009cd0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00009ce0: 2222 2252 6574 7269 6576 6520 6120 6c69  """Retrieve a li
+00009cf0: 7374 206f 6620 6675 6e63 7469 6f6e 732c  st of functions,
+00009d00: 2066 696c 7465 7265 6420 6279 2073 7065   filtered by spe
+00009d10: 6369 6669 6320 6372 6974 6572 6961 2e0a  cific criteria..
+00009d20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00009d30: 6e61 6d65 3a20 5265 7475 726e 206f 6e6c  name: Return onl
+00009d40: 7920 6675 6e63 7469 6f6e 7320 7769 7468  y functions with
+00009d50: 2061 2073 7065 6369 6669 6320 6e61 6d65   a specific name
+00009d60: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00009d70: 2070 726f 6a65 6374 3a20 5265 7475 726e   project: Return
+00009d80: 2066 756e 6374 696f 6e73 2062 656c 6f6e   functions belon
+00009d90: 6769 6e67 2074 6f20 7468 6973 2070 726f  ging to this pro
+00009da0: 6a65 6374 2e20 4966 206e 6f74 2073 7065  ject. If not spe
+00009db0: 6369 6669 6564 2c20 7468 6520 6465 6661  cified, the defa
+00009dc0: 756c 7420 7072 6f6a 6563 7420 6973 2075  ult project is u
+00009dd0: 7365 642e 0a20 2020 2020 2020 203a 7061  sed..        :pa
+00009de0: 7261 6d20 7461 673a 2052 6574 7572 6e20  ram tag: Return 
+00009df0: 6675 6e63 7469 6f6e 2076 6572 7369 6f6e  function version
+00009e00: 7320 7769 7468 2073 7065 6369 6669 6320  s with specific 
+00009e10: 7461 6773 2e0a 2020 2020 2020 2020 3a70  tags..        :p
+00009e20: 6172 616d 206c 6162 656c 733a 2052 6574  aram labels: Ret
+00009e30: 7572 6e20 6675 6e63 7469 6f6e 7320 7468  urn functions th
+00009e40: 6174 2068 6176 6520 7370 6563 6966 6963  at have specific
+00009e50: 206c 6162 656c 7320 6173 7369 676e 6564   labels assigned
+00009e60: 2074 6f20 7468 656d 2e0a 2020 2020 2020   to them..      
+00009e70: 2020 3a72 6574 7572 6e73 3a20 4c69 7374    :returns: List
+00009e80: 206f 6620 6675 6e63 7469 6f6e 206f 626a   of function obj
+00009e90: 6563 7473 2028 6173 2064 6963 7469 6f6e  ects (as diction
+00009ea0: 6172 7929 2e0a 2020 2020 2020 2020 2222  ary)..        ""
+00009eb0: 220a 2020 2020 2020 2020 7072 6f6a 6563  ".        projec
+00009ec0: 7420 3d20 7072 6f6a 6563 7420 6f72 2063  t = project or c
+00009ed0: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
+00009ee0: 6f6a 6563 740a 2020 2020 2020 2020 7061  oject.        pa
+00009ef0: 7261 6d73 203d 207b 0a20 2020 2020 2020  rams = {.       
+00009f00: 2020 2020 2022 6e61 6d65 223a 206e 616d       "name": nam
+00009f10: 652c 0a20 2020 2020 2020 2020 2020 2022  e,.            "
+00009f20: 7461 6722 3a20 7461 672c 0a20 2020 2020  tag": tag,.     
+00009f30: 2020 2020 2020 2022 6c61 6265 6c22 3a20         "label": 
+00009f40: 6c61 6265 6c73 206f 7220 5b5d 2c0a 2020  labels or [],.  
+00009f50: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00009f60: 6572 726f 7220 3d20 226c 6973 7420 6675  error = "list fu
+00009f70: 6e63 7469 6f6e 7322 0a20 2020 2020 2020  nctions".       
+00009f80: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
+00009f90: 7473 2f7b 7072 6f6a 6563 747d 2f66 756e  ts/{project}/fun
+00009fa0: 6374 696f 6e73 220a 2020 2020 2020 2020  ctions".        
+00009fb0: 7265 7370 203d 2073 656c 662e 6170 695f  resp = self.api_
+00009fc0: 6361 6c6c 2822 4745 5422 2c20 7061 7468  call("GET", path
+00009fd0: 2c20 6572 726f 722c 2070 6172 616d 733d  , error, params=
+00009fe0: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00009ff0: 7265 7475 726e 2072 6573 702e 6a73 6f6e  return resp.json
+0000a000: 2829 5b22 6675 6e63 7322 5d0a 0a20 2020  ()["funcs"]..   
+0000a010: 2064 6566 206c 6973 745f 7275 6e74 696d   def list_runtim
+0000a020: 655f 7265 736f 7572 6365 7328 0a20 2020  e_resources(.   
+0000a030: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000a040: 2020 2070 726f 6a65 6374 3a20 4f70 7469     project: Opti
+0000a050: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+0000a060: 2c0a 2020 2020 2020 2020 6c61 6265 6c5f  ,.        label_
+0000a070: 7365 6c65 6374 6f72 3a20 4f70 7469 6f6e  selector: Option
+0000a080: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+0000a090: 2020 2020 2020 2020 6b69 6e64 3a20 4f70          kind: Op
+0000a0a0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+0000a0b0: 6e65 2c0a 2020 2020 2020 2020 6f62 6a65  ne,.        obje
+0000a0c0: 6374 5f69 643a 204f 7074 696f 6e61 6c5b  ct_id: Optional[
+0000a0d0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+0000a0e0: 2020 2020 2067 726f 7570 5f62 793a 204f       group_by: O
+0000a0f0: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
+0000a100: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
+0000a110: 6e2e 7363 6865 6d61 732e 4c69 7374 5275  n.schemas.ListRu
+0000a120: 6e74 696d 6552 6573 6f75 7263 6573 4772  ntimeResourcesGr
+0000a130: 6f75 7042 7946 6965 6c64 0a20 2020 2020  oupByField.     
+0000a140: 2020 205d 203d 204e 6f6e 652c 0a20 2020     ] = None,.   
+0000a150: 2029 202d 3e20 556e 696f 6e5b 0a20 2020   ) -> Union[.   
+0000a160: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
+0000a170: 6e2e 7363 6865 6d61 732e 5275 6e74 696d  n.schemas.Runtim
+0000a180: 6552 6573 6f75 7263 6573 4f75 7470 7574  eResourcesOutput
+0000a190: 2c0a 2020 2020 2020 2020 6d6c 7275 6e2e  ,.        mlrun.
+0000a1a0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e47  common.schemas.G
+0000a1b0: 726f 7570 6564 4279 4a6f 6252 756e 7469  roupedByJobRunti
+0000a1c0: 6d65 5265 736f 7572 6365 734f 7574 7075  meResourcesOutpu
+0000a1d0: 742c 0a20 2020 2020 2020 206d 6c72 756e  t,.        mlrun
+0000a1e0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0000a1f0: 4772 6f75 7065 6442 7950 726f 6a65 6374  GroupedByProject
+0000a200: 5275 6e74 696d 6552 6573 6f75 7263 6573  RuntimeResources
+0000a210: 4f75 7470 7574 2c0a 2020 2020 5d3a 0a20  Output,.    ]:. 
+0000a220: 2020 2020 2020 2022 2222 4c69 7374 2063         """List c
+0000a230: 7572 7265 6e74 2072 756e 7469 6d65 2072  urrent runtime r
+0000a240: 6573 6f75 7263 6573 2c20 7768 6963 6820  esources, which 
+0000a250: 6172 6520 7573 7561 6c6c 7920 2862 7574  are usually (but
+0000a260: 206e 6f74 206c 696d 6974 6564 2074 6f29   not limited to)
+0000a270: 204b 7562 6572 6e65 7465 7320 706f 6473   Kubernetes pods
+0000a280: 206f 7220 4352 4473 2e0a 2020 2020 2020   or CRDs..      
+0000a290: 2020 4675 6e63 7469 6f6e 2061 7070 6c69    Function appli
+0000a2a0: 6573 2066 6f72 2072 756e 7320 6f66 2074  es for runs of t
+0000a2b0: 7970 6520 605b 2764 6173 6b27 2c20 276a  ype `['dask', 'j
+0000a2c0: 6f62 272c 2027 7370 6172 6b27 2c20 2772  ob', 'spark', 'r
+0000a2d0: 656d 6f74 652d 7370 6172 6b27 2c20 276d  emote-spark', 'm
+0000a2e0: 7069 6a6f 6227 5d60 2c20 616e 6420 7769  pijob']`, and wi
+0000a2f0: 6c6c 2072 6574 7572 6e20 7065 720a 2020  ll return per.  
+0000a300: 2020 2020 2020 7275 6e74 696d 6520 6b69        runtime ki
+0000a310: 6e64 2061 206c 6973 7420 6f66 2074 6865  nd a list of the
+0000a320: 2072 756e 7469 6d65 2072 6573 6f75 7263   runtime resourc
+0000a330: 6573 2028 7768 6963 6820 6d61 7920 6861  es (which may ha
+0000a340: 7665 2061 6c72 6561 6479 2063 6f6d 706c  ve already compl
+0000a350: 6574 6564 2074 6865 6972 2065 7865 6375  eted their execu
+0000a360: 7469 6f6e 292e 0a0a 2020 2020 2020 2020  tion)...        
+0000a370: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
+0000a380: 4765 7420 6f6e 6c79 2072 756e 7469 6d65  Get only runtime
+0000a390: 2072 6573 6f75 7263 6573 206f 6620 6120   resources of a 
+0000a3a0: 7370 6563 6966 6963 2070 726f 6a65 6374  specific project
+0000a3b0: 2c20 6279 2064 6566 6175 6c74 204e 6f6e  , by default Non
+0000a3c0: 652c 2077 6869 6368 2077 696c 6c20 7265  e, which will re
+0000a3d0: 7475 726e 206f 6e6c 7920 7468 650a 2020  turn only the.  
+0000a3e0: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
+0000a3f0: 7473 2079 6f75 2772 6520 6175 7468 6f72  ts you're author
+0000a400: 697a 6564 2074 6f20 7365 652e 0a20 2020  ized to see..   
+0000a410: 2020 2020 203a 7061 7261 6d20 6c61 6265       :param labe
+0000a420: 6c5f 7365 6c65 6374 6f72 3a20 4120 6c61  l_selector: A la
+0000a430: 6265 6c20 6669 6c74 6572 2074 6861 7420  bel filter that 
+0000a440: 7769 6c6c 2062 6520 7061 7373 6564 2074  will be passed t
+0000a450: 6f20 4b75 6265 726e 6574 6573 2066 6f72  o Kubernetes for
+0000a460: 2066 696c 7465 7269 6e67 2074 6865 2072   filtering the r
+0000a470: 6573 756c 7473 2061 6363 6f72 6469 6e67  esults according
+0000a480: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+0000a490: 7468 6569 7220 6c61 6265 6c73 2e0a 2020  their labels..  
+0000a4a0: 2020 2020 2020 3a70 6172 616d 206b 696e        :param kin
+0000a4b0: 643a 2054 6865 206b 696e 6420 6f66 2072  d: The kind of r
+0000a4c0: 756e 7469 6d65 2074 6f20 7175 6572 792e  untime to query.
+0000a4d0: 204d 6179 2062 6520 6f6e 6520 6f66 2060   May be one of `
+0000a4e0: 5b27 6461 736b 272c 2027 6a6f 6227 2c20  ['dask', 'job', 
+0000a4f0: 2773 7061 726b 272c 2027 7265 6d6f 7465  'spark', 'remote
+0000a500: 2d73 7061 726b 272c 2027 6d70 696a 6f62  -spark', 'mpijob
+0000a510: 275d 600a 2020 2020 2020 2020 3a70 6172  ']`.        :par
+0000a520: 616d 206f 626a 6563 745f 6964 3a20 5468  am object_id: Th
+0000a530: 6520 6964 656e 7469 6669 6572 206f 6620  e identifier of 
+0000a540: 7468 6520 6d6c 7275 6e20 6f62 6a65 6374  the mlrun object
+0000a550: 2074 6f20 7175 6572 7920 6974 7320 7275   to query its ru
+0000a560: 6e74 696d 6520 7265 736f 7572 6365 732e  ntime resources.
+0000a570: 2066 6f72 206d 6f73 7420 6675 6e63 7469   for most functi
+0000a580: 6f6e 2072 756e 7469 6d65 732c 0a20 2020  on runtimes,.   
+0000a590: 2020 2020 2020 2020 2072 756e 7469 6d65           runtime
+0000a5a0: 2072 6573 6f75 7263 6573 2061 7265 2070   resources are p
+0000a5b0: 6572 2052 756e 2c20 666f 7220 7768 6963  er Run, for whic
+0000a5c0: 6820 7468 6520 6964 656e 7469 6669 6572  h the identifier
+0000a5d0: 2069 7320 7468 6520 5275 6e27 7320 5549   is the Run's UI
+0000a5e0: 442e 2046 6f72 2064 6173 6b20 7275 6e74  D. For dask runt
+0000a5f0: 696d 652c 2074 6865 2072 756e 7469 6d65  ime, the runtime
+0000a600: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000a610: 6f75 7263 6573 2061 7265 2070 6572 2046  ources are per F
+0000a620: 756e 6374 696f 6e2c 2066 6f72 2077 6869  unction, for whi
+0000a630: 6368 2074 6865 2069 6465 6e74 6966 6965  ch the identifie
+0000a640: 7220 6973 2074 6865 2046 756e 6374 696f  r is the Functio
+0000a650: 6e27 7320 6e61 6d65 2e0a 2020 2020 2020  n's name..      
+0000a660: 2020 3a70 6172 616d 2067 726f 7570 5f62    :param group_b
+0000a670: 793a 204f 626a 6563 7420 746f 2067 726f  y: Object to gro
+0000a680: 7570 2072 6573 756c 7473 2062 792e 2041  up results by. A
+0000a690: 6c6c 6f77 6564 2076 616c 7565 7320 6172  llowed values ar
+0000a6a0: 6520 606a 6f62 6020 616e 6420 6070 726f  e `job` and `pro
+0000a6b0: 6a65 6374 602e 0a20 2020 2020 2020 2022  ject`..        "
+0000a6c0: 2222 0a20 2020 2020 2020 2070 6172 616d  "".        param
+0000a6d0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+0000a6e0: 2020 226c 6162 656c 5f73 656c 6563 746f    "label_selecto
+0000a6f0: 7222 3a20 6c61 6265 6c5f 7365 6c65 6374  r": label_select
+0000a700: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0000a710: 2267 726f 7570 2d62 7922 3a20 6772 6f75  "group-by": grou
+0000a720: 705f 6279 2c0a 2020 2020 2020 2020 2020  p_by,.          
+0000a730: 2020 226b 696e 6422 3a20 6b69 6e64 2c0a    "kind": kind,.
+0000a740: 2020 2020 2020 2020 2020 2020 226f 626a              "obj
+0000a750: 6563 742d 6964 223a 206f 626a 6563 745f  ect-id": object_
+0000a760: 6964 2c0a 2020 2020 2020 2020 7d0a 2020  id,.        }.  
+0000a770: 2020 2020 2020 7072 6f6a 6563 745f 7061        project_pa
+0000a780: 7468 203d 2070 726f 6a65 6374 2069 6620  th = project if 
+0000a790: 7072 6f6a 6563 7420 656c 7365 2022 2a22  project else "*"
+0000a7a0: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
+0000a7b0: 2022 4661 696c 6564 206c 6973 7469 6e67   "Failed listing
+0000a7c0: 2072 756e 7469 6d65 2072 6573 6f75 7263   runtime resourc
+0000a7d0: 6573 220a 2020 2020 2020 2020 7265 7370  es".        resp
+0000a7e0: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
+0000a7f0: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
+0000a800: 2020 2247 4554 222c 2066 2270 726f 6a65    "GET", f"proje
+0000a810: 6374 732f 7b70 726f 6a65 6374 5f70 6174  cts/{project_pat
+0000a820: 687d 2f72 756e 7469 6d65 2d72 6573 6f75  h}/runtime-resou
+0000a830: 7263 6573 222c 2065 7272 6f72 2c20 7061  rces", error, pa
+0000a840: 7261 6d73 3d70 6172 616d 730a 2020 2020  rams=params.    
+0000a850: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+0000a860: 2067 726f 7570 5f62 7920 6973 204e 6f6e   group_by is Non
+0000a870: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+0000a880: 7472 7563 7475 7265 645f 6c69 7374 203d  tructured_list =
+0000a890: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0000a8a0: 2020 206d 6c72 756e 2e63 6f6d 6d6f 6e2e     mlrun.common.
+0000a8b0: 7363 6865 6d61 732e 4b69 6e64 5275 6e74  schemas.KindRunt
+0000a8c0: 696d 6552 6573 6f75 7263 6573 282a 2a6b  imeResources(**k
+0000a8d0: 696e 645f 7275 6e74 696d 655f 7265 736f  ind_runtime_reso
+0000a8e0: 7572 6365 7329 0a20 2020 2020 2020 2020  urces).         
+0000a8f0: 2020 2020 2020 2066 6f72 206b 696e 645f         for kind_
+0000a900: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
+0000a910: 7320 696e 2072 6573 706f 6e73 652e 6a73  s in response.js
+0000a920: 6f6e 2829 0a20 2020 2020 2020 2020 2020  on().           
+0000a930: 205d 0a20 2020 2020 2020 2020 2020 2072   ].            r
+0000a940: 6574 7572 6e20 7374 7275 6374 7572 6564  eturn structured
+0000a950: 5f6c 6973 740a 2020 2020 2020 2020 656c  _list.        el
+0000a960: 6966 2067 726f 7570 5f62 7920 3d3d 206d  if group_by == m
+0000a970: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0000a980: 6d61 732e 4c69 7374 5275 6e74 696d 6552  mas.ListRuntimeR
+0000a990: 6573 6f75 7263 6573 4772 6f75 7042 7946  esourcesGroupByF
+0000a9a0: 6965 6c64 2e6a 6f62 3a0a 2020 2020 2020  ield.job:.      
+0000a9b0: 2020 2020 2020 7374 7275 6374 7572 6564        structured
+0000a9c0: 5f64 6963 7420 3d20 7b7d 0a20 2020 2020  _dict = {}.     
+0000a9d0: 2020 2020 2020 2066 6f72 2070 726f 6a65         for proje
+0000a9e0: 6374 2c20 6a6f 625f 7275 6e74 696d 655f  ct, job_runtime_
+0000a9f0: 7265 736f 7572 6365 735f 6d61 7020 696e  resources_map in
+0000aa00: 2072 6573 706f 6e73 652e 6a73 6f6e 2829   response.json()
+0000aa10: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+0000aa20: 2020 2020 2020 2020 2020 666f 7220 6a6f            for jo
+0000aa30: 625f 6964 2c20 7275 6e74 696d 655f 7265  b_id, runtime_re
+0000aa40: 736f 7572 6365 7320 696e 206a 6f62 5f72  sources in job_r
+0000aa50: 756e 7469 6d65 5f72 6573 6f75 7263 6573  untime_resources
+0000aa60: 5f6d 6170 2e69 7465 6d73 2829 3a0a 2020  _map.items():.  
+0000aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa80: 2020 7374 7275 6374 7572 6564 5f64 6963    structured_dic
+0000aa90: 742e 7365 7464 6566 6175 6c74 2870 726f  t.setdefault(pro
+0000aaa0: 6a65 6374 2c20 7b7d 295b 0a20 2020 2020  ject, {})[.     
+0000aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aac0: 2020 206a 6f62 5f69 640a 2020 2020 2020     job_id.      
+0000aad0: 2020 2020 2020 2020 2020 2020 2020 5d20                ] 
+0000aae0: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+0000aaf0: 6368 656d 6173 2e52 756e 7469 6d65 5265  chemas.RuntimeRe
+0000ab00: 736f 7572 6365 7328 2a2a 7275 6e74 696d  sources(**runtim
+0000ab10: 655f 7265 736f 7572 6365 7329 0a20 2020  e_resources).   
+0000ab20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000ab30: 7374 7275 6374 7572 6564 5f64 6963 740a  structured_dict.
+0000ab40: 2020 2020 2020 2020 656c 6966 2067 726f          elif gro
+0000ab50: 7570 5f62 7920 3d3d 206d 6c72 756e 2e63  up_by == mlrun.c
+0000ab60: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4c69  ommon.schemas.Li
+0000ab70: 7374 5275 6e74 696d 6552 6573 6f75 7263  stRuntimeResourc
+0000ab80: 6573 4772 6f75 7042 7946 6965 6c64 2e70  esGroupByField.p
+0000ab90: 726f 6a65 6374 3a0a 2020 2020 2020 2020  roject:.        
+0000aba0: 2020 2020 7374 7275 6374 7572 6564 5f64      structured_d
+0000abb0: 6963 7420 3d20 7b7d 0a20 2020 2020 2020  ict = {}.       
+0000abc0: 2020 2020 2066 6f72 2070 726f 6a65 6374       for project
+0000abd0: 2c20 6b69 6e64 5f72 756e 7469 6d65 5f72  , kind_runtime_r
+0000abe0: 6573 6f75 7263 6573 5f6d 6170 2069 6e20  esources_map in 
+0000abf0: 7265 7370 6f6e 7365 2e6a 736f 6e28 292e  response.json().
+0000ac00: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0000ac10: 2020 2020 2020 2020 2066 6f72 206b 696e           for kin
+0000ac20: 642c 2072 756e 7469 6d65 5f72 6573 6f75  d, runtime_resou
+0000ac30: 7263 6573 2069 6e20 6b69 6e64 5f72 756e  rces in kind_run
+0000ac40: 7469 6d65 5f72 6573 6f75 7263 6573 5f6d  time_resources_m
+0000ac50: 6170 2e69 7465 6d73 2829 3a0a 2020 2020  ap.items():.    
+0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac70: 7374 7275 6374 7572 6564 5f64 6963 742e  structured_dict.
+0000ac80: 7365 7464 6566 6175 6c74 2870 726f 6a65  setdefault(proje
+0000ac90: 6374 2c20 7b7d 295b 0a20 2020 2020 2020  ct, {})[.       
+0000aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acb0: 206b 696e 640a 2020 2020 2020 2020 2020   kind.          
+0000acc0: 2020 2020 2020 2020 2020 5d20 3d20 6d6c            ] = ml
+0000acd0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000ace0: 6173 2e52 756e 7469 6d65 5265 736f 7572  as.RuntimeResour
+0000acf0: 6365 7328 2a2a 7275 6e74 696d 655f 7265  ces(**runtime_re
+0000ad00: 736f 7572 6365 7329 0a20 2020 2020 2020  sources).       
+0000ad10: 2020 2020 2072 6574 7572 6e20 7374 7275       return stru
+0000ad20: 6374 7572 6564 5f64 6963 740a 2020 2020  ctured_dict.    
+0000ad30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000ad40: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+0000ad50: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+0000ad60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ad70: 2066 2250 726f 7669 6465 6420 6772 6f75   f"Provided grou
+0000ad80: 7020 6279 2066 6965 6c64 2069 7320 6e6f  p by field is no
+0000ad90: 7420 7375 7070 6f72 7465 642e 2067 726f  t supported. gro
+0000ada0: 7570 5f62 793d 7b67 726f 7570 5f62 797d  up_by={group_by}
+0000adb0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+0000adc0: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
+0000add0: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
+0000ade0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+0000adf0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+0000ae00: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+0000ae10: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000ae20: 6c61 6265 6c5f 7365 6c65 6374 6f72 3a20  label_selector: 
+0000ae30: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+0000ae40: 4e6f 6e65 2c0a 2020 2020 2020 2020 6b69  None,.        ki
+0000ae50: 6e64 3a20 4f70 7469 6f6e 616c 5b73 7472  nd: Optional[str
+0000ae60: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0000ae70: 2020 6f62 6a65 6374 5f69 643a 204f 7074    object_id: Opt
+0000ae80: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000ae90: 652c 0a20 2020 2020 2020 2066 6f72 6365  e,.        force
+0000aea0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0000aeb0: 2020 2020 2020 2020 6772 6163 655f 7065          grace_pe
+0000aec0: 7269 6f64 3a20 696e 7420 3d20 4e6f 6e65  riod: int = None
+0000aed0: 2c0a 2020 2020 2920 2d3e 206d 6c72 756e  ,.    ) -> mlrun
+0000aee0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0000aef0: 4772 6f75 7065 6442 7950 726f 6a65 6374  GroupedByProject
+0000af00: 5275 6e74 696d 6552 6573 6f75 7263 6573  RuntimeResources
+0000af10: 4f75 7470 7574 3a0a 2020 2020 2020 2020  Output:.        
+0000af20: 2222 2244 656c 6574 6520 616c 6c20 7275  """Delete all ru
+0000af30: 6e74 696d 6520 7265 736f 7572 6365 7320  ntime resources 
+0000af40: 7768 6963 6820 6172 6520 696e 2074 6572  which are in ter
+0000af50: 6d69 6e61 6c20 7374 6174 652e 0a0a 2020  minal state...  
+0000af60: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
+0000af70: 6a65 6374 3a20 4465 6c65 7465 206f 6e6c  ject: Delete onl
+0000af80: 7920 7275 6e74 696d 6520 7265 736f 7572  y runtime resour
+0000af90: 6365 7320 6f66 2061 2073 7065 6369 6669  ces of a specifi
+0000afa0: 6320 7072 6f6a 6563 742c 2062 7920 6465  c project, by de
+0000afb0: 6661 756c 7420 4e6f 6e65 2c20 7768 6963  fault None, whic
+0000afc0: 6820 7769 6c6c 2064 656c 6574 6520 6f6e  h will delete on
+0000afd0: 6c79 0a20 2020 2020 2020 2020 2020 2066  ly.            f
+0000afe0: 726f 6d20 7468 6520 7072 6f6a 6563 7473  rom the projects
+0000aff0: 2079 6f75 2772 6520 6175 7468 6f72 697a   you're authoriz
+0000b000: 6564 2074 6f20 6465 6c65 7465 2066 726f  ed to delete fro
+0000b010: 6d2e 0a20 2020 2020 2020 203a 7061 7261  m..        :para
+0000b020: 6d20 6c61 6265 6c5f 7365 6c65 6374 6f72  m label_selector
+0000b030: 3a20 4465 6c65 7465 206f 6e6c 7920 7275  : Delete only ru
+0000b040: 6e74 696d 6520 7265 736f 7572 6365 7320  ntime resources 
+0000b050: 6d61 7463 6869 6e67 2074 6865 206c 6162  matching the lab
+0000b060: 656c 2073 656c 6563 746f 722e 0a20 2020  el selector..   
+0000b070: 2020 2020 203a 7061 7261 6d20 6b69 6e64       :param kind
+0000b080: 3a20 5468 6520 6b69 6e64 206f 6620 7275  : The kind of ru
+0000b090: 6e74 696d 6520 746f 2064 656c 6574 652e  ntime to delete.
+0000b0a0: 204d 6179 2062 6520 6f6e 6520 6f66 2060   May be one of `
+0000b0b0: 5b27 6461 736b 272c 2027 6a6f 6227 2c20  ['dask', 'job', 
+0000b0c0: 2773 7061 726b 272c 2027 7265 6d6f 7465  'spark', 'remote
+0000b0d0: 2d73 7061 726b 272c 2027 6d70 696a 6f62  -spark', 'mpijob
+0000b0e0: 275d 600a 2020 2020 2020 2020 3a70 6172  ']`.        :par
+0000b0f0: 616d 206f 626a 6563 745f 6964 3a20 5468  am object_id: Th
+0000b100: 6520 6964 656e 7469 6669 6572 206f 6620  e identifier of 
+0000b110: 7468 6520 6d6c 7275 6e20 6f62 6a65 6374  the mlrun object
+0000b120: 2074 6f20 6465 6c65 7465 2069 7473 2072   to delete its r
+0000b130: 756e 7469 6d65 2072 6573 6f75 7263 6573  untime resources
+0000b140: 2e20 666f 7220 6d6f 7374 2066 756e 6374  . for most funct
+0000b150: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+0000b160: 7275 6e74 696d 6573 2c20 7275 6e74 696d  runtimes, runtim
+0000b170: 6520 7265 736f 7572 6365 7320 6172 6520  e resources are 
+0000b180: 7065 7220 5275 6e2c 2066 6f72 2077 6869  per Run, for whi
+0000b190: 6368 2074 6865 2069 6465 6e74 6966 6965  ch the identifie
+0000b1a0: 7220 6973 2074 6865 2052 756e 2773 2055  r is the Run's U
+0000b1b0: 4944 2e20 466f 7220 6461 736b 2072 756e  ID. For dask run
+0000b1c0: 7469 6d65 2c20 7468 650a 2020 2020 2020  time, the.      
+0000b1d0: 2020 2020 2020 7275 6e74 696d 6520 7265        runtime re
+0000b1e0: 736f 7572 6365 7320 6172 6520 7065 7220  sources are per 
+0000b1f0: 4675 6e63 7469 6f6e 2c20 666f 7220 7768  Function, for wh
+0000b200: 6963 6820 7468 6520 6964 656e 7469 6669  ich the identifi
+0000b210: 6572 2069 7320 7468 6520 4675 6e63 7469  er is the Functi
+0000b220: 6f6e 2773 206e 616d 652e 0a20 2020 2020  on's name..     
+0000b230: 2020 203a 7061 7261 6d20 666f 7263 653a     :param force:
+0000b240: 2046 6f72 6365 2064 656c 6574 696f 6e20   Force deletion 
+0000b250: 2d20 6465 6c65 7465 2074 6865 2072 756e  - delete the run
+0000b260: 7469 6d65 2072 6573 6f75 7263 6520 6576  time resource ev
+0000b270: 656e 2069 6620 6974 2773 206e 6f74 2069  en if it's not i
+0000b280: 6e20 7465 726d 696e 616c 2073 7461 7465  n terminal state
+0000b290: 206f 7220 6966 2074 6865 2067 7261 6365   or if the grace
+0000b2a0: 0a20 2020 2020 2020 2020 2020 2070 6572  .            per
+0000b2b0: 696f 6420 6469 646e 2774 2070 6173 732e  iod didn't pass.
+0000b2c0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000b2d0: 6772 6163 655f 7065 7269 6f64 3a20 4772  grace_period: Gr
+0000b2e0: 6163 6520 7065 7269 6f64 2067 6976 656e  ace period given
+0000b2f0: 2074 6f20 7468 6520 7275 6e74 696d 6520   to the runtime 
+0000b300: 7265 736f 7572 6365 2062 6566 6f72 6520  resource before 
+0000b310: 7468 6579 2061 7265 2061 6374 7561 6c6c  they are actuall
+0000b320: 7920 7265 6d6f 7665 642c 2063 6f75 6e74  y removed, count
+0000b330: 6564 2066 726f 6d0a 2020 2020 2020 2020  ed from.        
+0000b340: 2020 2020 7468 6520 6d6f 6d65 6e74 2074      the moment t
+0000b350: 6865 7920 6d6f 7665 6420 746f 2074 6572  hey moved to ter
+0000b360: 6d69 6e61 6c20 7374 6174 6520 2864 6566  minal state (def
+0000b370: 6175 6c74 7320 746f 206d 6c72 756e 2e6d  aults to mlrun.m
+0000b380: 6c63 6f6e 662e 7275 6e74 696d 655f 7265  lconf.runtime_re
+0000b390: 736f 7572 6365 735f 6465 6c65 7469 6f6e  sources_deletion
+0000b3a0: 5f67 7261 6365 5f70 6572 696f 6429 2e0a  _grace_period)..
+0000b3b0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0000b3c0: 733a 203a 7079 3a63 6c61 7373 3a60 7e6d  s: :py:class:`~m
+0000b3d0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0000b3e0: 6d61 732e 4772 6f75 7065 6442 7950 726f  mas.GroupedByPro
+0000b3f0: 6a65 6374 5275 6e74 696d 6552 6573 6f75  jectRuntimeResou
+0000b400: 7263 6573 4f75 7470 7574 6020 6c69 7374  rcesOutput` list
+0000b410: 696e 6720 7468 6520 7275 6e74 696d 6520  ing the runtime 
+0000b420: 7265 736f 7572 6365 730a 2020 2020 2020  resources.      
+0000b430: 2020 2020 2020 7468 6174 2077 6572 6520        that were 
+0000b440: 7265 6d6f 7665 642e 0a20 2020 2020 2020  removed..       
+0000b450: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0000b460: 6772 6163 655f 7065 7269 6f64 2069 7320  grace_period is 
+0000b470: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000b480: 2020 6772 6163 655f 7065 7269 6f64 203d    grace_period =
+0000b490: 2063 6f6e 6669 672e 7275 6e74 696d 655f   config.runtime_
+0000b4a0: 7265 736f 7572 6365 735f 6465 6c65 7469  resources_deleti
+0000b4b0: 6f6e 5f67 7261 6365 5f70 6572 696f 640a  on_grace_period.
+0000b4c0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0000b4d0: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
+0000b4e0: 2020 2020 2020 2020 2022 5573 696e 6720           "Using 
+0000b4f0: 6465 6661 756c 7420 6772 6163 6520 7065  default grace pe
+0000b500: 7269 6f64 2066 6f72 2072 756e 7469 6d65  riod for runtime
+0000b510: 2072 6573 6f75 7263 6573 2064 656c 6574   resources delet
+0000b520: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+0000b530: 2020 2020 2020 6772 6163 655f 7065 7269        grace_peri
+0000b540: 6f64 3d67 7261 6365 5f70 6572 696f 642c  od=grace_period,
+0000b550: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+0000b560: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+0000b570: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+0000b580: 6c61 6265 6c2d 7365 6c65 6374 6f72 223a  label-selector":
+0000b590: 206c 6162 656c 5f73 656c 6563 746f 722c   label_selector,
+0000b5a0: 0a20 2020 2020 2020 2020 2020 2022 6b69  .            "ki
+0000b5b0: 6e64 223a 206b 696e 642c 0a20 2020 2020  nd": kind,.     
+0000b5c0: 2020 2020 2020 2022 6f62 6a65 6374 2d69         "object-i
+0000b5d0: 6422 3a20 6f62 6a65 6374 5f69 642c 0a20  d": object_id,. 
+0000b5e0: 2020 2020 2020 2020 2020 2022 666f 7263             "forc
+0000b5f0: 6522 3a20 666f 7263 652c 0a20 2020 2020  e": force,.     
+0000b600: 2020 2020 2020 2022 6772 6163 652d 7065         "grace-pe
+0000b610: 7269 6f64 223a 2067 7261 6365 5f70 6572  riod": grace_per
+0000b620: 696f 642c 0a20 2020 2020 2020 207d 0a20  iod,.        }. 
+0000b630: 2020 2020 2020 2065 7272 6f72 203d 2022         error = "
+0000b640: 4661 696c 6564 2064 656c 6574 696e 6720  Failed deleting 
+0000b650: 7275 6e74 696d 6520 7265 736f 7572 6365  runtime resource
+0000b660: 7322 0a20 2020 2020 2020 2070 726f 6a65  s".        proje
+0000b670: 6374 5f70 6174 6820 3d20 7072 6f6a 6563  ct_path = projec
+0000b680: 7420 6966 2070 726f 6a65 6374 2065 6c73  t if project els
+0000b690: 6520 222a 220a 2020 2020 2020 2020 7265  e "*".        re
+0000b6a0: 7370 6f6e 7365 203d 2073 656c 662e 6170  sponse = self.ap
+0000b6b0: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
+0000b6c0: 2020 2020 2244 454c 4554 4522 2c0a 2020      "DELETE",.  
+0000b6d0: 2020 2020 2020 2020 2020 6622 7072 6f6a            f"proj
+0000b6e0: 6563 7473 2f7b 7072 6f6a 6563 745f 7061  ects/{project_pa
+0000b6f0: 7468 7d2f 7275 6e74 696d 652d 7265 736f  th}/runtime-reso
+0000b700: 7572 6365 7322 2c0a 2020 2020 2020 2020  urces",.        
+0000b710: 2020 2020 6572 726f 722c 0a20 2020 2020      error,.     
+0000b720: 2020 2020 2020 2070 6172 616d 733d 7061         params=pa
+0000b730: 7261 6d73 2c0a 2020 2020 2020 2020 290a  rams,.        ).
+0000b740: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+0000b750: 6564 5f64 6963 7420 3d20 7b7d 0a20 2020  ed_dict = {}.   
+0000b760: 2020 2020 2066 6f72 2070 726f 6a65 6374       for project
+0000b770: 2c20 6b69 6e64 5f72 756e 7469 6d65 5f72  , kind_runtime_r
+0000b780: 6573 6f75 7263 6573 5f6d 6170 2069 6e20  esources_map in 
+0000b790: 7265 7370 6f6e 7365 2e6a 736f 6e28 292e  response.json().
+0000b7a0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0000b7b0: 2020 2020 2066 6f72 206b 696e 642c 2072       for kind, r
+0000b7c0: 756e 7469 6d65 5f72 6573 6f75 7263 6573  untime_resources
+0000b7d0: 2069 6e20 6b69 6e64 5f72 756e 7469 6d65   in kind_runtime
+0000b7e0: 5f72 6573 6f75 7263 6573 5f6d 6170 2e69  _resources_map.i
+0000b7f0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+0000b800: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+0000b810: 6564 5f64 6963 742e 7365 7464 6566 6175  ed_dict.setdefau
+0000b820: 6c74 2870 726f 6a65 6374 2c20 7b7d 295b  lt(project, {})[
+0000b830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b840: 2020 2020 206b 696e 640a 2020 2020 2020       kind.      
+0000b850: 2020 2020 2020 2020 2020 5d20 3d20 6d6c            ] = ml
+0000b860: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000b870: 6173 2e52 756e 7469 6d65 5265 736f 7572  as.RuntimeResour
+0000b880: 6365 7328 2a2a 7275 6e74 696d 655f 7265  ces(**runtime_re
+0000b890: 736f 7572 6365 7329 0a20 2020 2020 2020  sources).       
+0000b8a0: 2072 6574 7572 6e20 7374 7275 6374 7572   return structur
+0000b8b0: 6564 5f64 6963 740a 0a20 2020 2064 6566  ed_dict..    def
+0000b8c0: 2063 7265 6174 655f 7363 6865 6475 6c65   create_schedule
+0000b8d0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+0000b8e0: 7072 6f6a 6563 743a 2073 7472 2c20 7363  project: str, sc
+0000b8f0: 6865 6475 6c65 3a20 6d6c 7275 6e2e 636f  hedule: mlrun.co
+0000b900: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6368  mmon.schemas.Sch
+0000b910: 6564 756c 6549 6e70 7574 0a20 2020 2029  eduleInput.    )
+0000b920: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
+0000b930: 6174 6520 6120 6e65 7720 7363 6865 6475  ate a new schedu
+0000b940: 6c65 206f 6e20 7468 6520 6769 7665 6e20  le on the given 
+0000b950: 7072 6f6a 6563 742e 2054 6865 2064 6574  project. The det
+0000b960: 6169 6c73 206f 6e20 7468 6520 6163 7475  ails on the actu
+0000b970: 616c 206f 626a 6563 7420 746f 2073 6368  al object to sch
+0000b980: 6564 756c 6520 6173 2077 656c 6c20 6173  edule as well as
+0000b990: 2074 6865 0a20 2020 2020 2020 2073 6368   the.        sch
+0000b9a0: 6564 756c 6520 6974 7365 6c66 2061 7265  edule itself are
+0000b9b0: 2077 6974 6869 6e20 7468 6520 7363 6865   within the sche
+0000b9c0: 6475 6c65 206f 626a 6563 7420 7072 6f76  dule object prov
+0000b9d0: 6964 6564 2e0a 2020 2020 2020 2020 5468  ided..        Th
+0000b9e0: 6520 3a70 793a 636c 6173 733a 607e 5363  e :py:class:`~Sc
+0000b9f0: 6865 6475 6c65 4372 6f6e 5472 6967 6765  heduleCronTrigge
+0000ba00: 7260 2066 6f6c 6c6f 7773 2074 6865 2067  r` follows the g
+0000ba10: 7569 6465 6c69 6e65 7320 696e 0a20 2020  uidelines in.   
+0000ba20: 2020 2020 2068 7474 7073 3a2f 2f61 7073       https://aps
+0000ba30: 6368 6564 756c 6572 2e72 6561 6474 6865  cheduler.readthe
+0000ba40: 646f 6373 2e69 6f2f 656e 2f33 2e78 2f6d  docs.io/en/3.x/m
+0000ba50: 6f64 756c 6573 2f74 7269 6767 6572 732f  odules/triggers/
+0000ba60: 6372 6f6e 2e68 746d 6c2e 0a20 2020 2020  cron.html..     
+0000ba70: 2020 2049 7420 616c 736f 2073 7570 706f     It also suppo
+0000ba80: 7274 7320 6120 3a70 793a 6675 6e63 3a60  rts a :py:func:`
+0000ba90: 7e53 6368 6564 756c 6543 726f 6e54 7269  ~ScheduleCronTri
+0000baa0: 6767 6572 2e66 726f 6d5f 6372 6f6e 7461  gger.from_cronta
+0000bab0: 6260 2066 756e 6374 696f 6e20 7468 6174  b` function that
+0000bac0: 2061 6363 6570 7473 2061 0a20 2020 2020   accepts a.     
+0000bad0: 2020 2063 726f 6e74 6162 2d66 6f72 6d61     crontab-forma
+0000bae0: 7474 6564 2073 7472 696e 6720 2873 6565  tted string (see
+0000baf0: 2068 7474 7073 3a2f 2f65 6e2e 7769 6b69   https://en.wiki
+0000bb00: 7065 6469 612e 6f72 672f 7769 6b69 2f43  pedia.org/wiki/C
+0000bb10: 726f 6e20 666f 7220 6d6f 7265 2069 6e66  ron for more inf
+0000bb20: 6f72 6d61 7469 6f6e 206f 6e20 7468 6520  ormation on the 
+0000bb30: 666f 726d 6174 2061 6e64 0a20 2020 2020  format and.     
+0000bb40: 2020 206e 6f74 6520 7468 6174 2074 6865     note that the
+0000bb50: 2030 2077 6565 6b64 6179 2069 7320 616c   0 weekday is al
+0000bb60: 7761 7973 206d 6f6e 6461 7929 2e0a 0a0a  ways monday)....
+0000bb70: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
+0000bb80: 3a0a 0a20 2020 2020 2020 2020 2020 2066  :..            f
+0000bb90: 726f 6d20 6d6c 7275 6e2e 636f 6d6d 6f6e  rom mlrun.common
+0000bba0: 2069 6d70 6f72 7420 7363 6865 6d61 730a   import schemas.
+0000bbb0: 0a20 2020 2020 2020 2020 2020 2023 2045  .            # E
+0000bbc0: 7865 6375 7465 2074 6865 2067 6574 5f64  xecute the get_d
+0000bbd0: 6174 615f 6675 6e63 2066 756e 6374 696f  ata_func functio
+0000bbe0: 6e20 6576 6572 7920 5475 6573 6461 7920  n every Tuesday 
+0000bbf0: 6174 2031 353a 3330 0a20 2020 2020 2020  at 15:30.       
+0000bc00: 2020 2020 2073 6368 6564 756c 6520 3d20       schedule = 
+0000bc10: 7363 6865 6d61 732e 5363 6865 6475 6c65  schemas.Schedule
+0000bc20: 496e 7075 7428 0a20 2020 2020 2020 2020  Input(.         
+0000bc30: 2020 2020 2020 206e 616d 653d 2272 756e         name="run
+0000bc40: 5f66 756e 635f 6f6e 5f74 7565 7364 6179  _func_on_tuesday
+0000bc50: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+0000bc60: 2020 2020 6b69 6e64 3d22 6a6f 6222 2c0a      kind="job",.
+0000bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc80: 7363 6865 6475 6c65 645f 6f62 6a65 6374  scheduled_object
+0000bc90: 3d67 6574 5f64 6174 615f 6675 6e63 2c0a  =get_data_func,.
+0000bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bcb0: 6372 6f6e 5f74 7269 6767 6572 3d73 6368  cron_trigger=sch
+0000bcc0: 656d 6173 2e53 6368 6564 756c 6543 726f  emas.ScheduleCro
+0000bcd0: 6e54 7269 6767 6572 2864 6179 5f6f 665f  nTrigger(day_of_
+0000bce0: 7765 656b 3d27 7475 6527 2c20 686f 7572  week='tue', hour
+0000bcf0: 3d31 352c 206d 696e 7574 653d 3330 292c  =15, minute=30),
+0000bd00: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000bd10: 2020 2020 2020 2020 2020 2064 622e 6372             db.cr
+0000bd20: 6561 7465 5f73 6368 6564 756c 6528 7072  eate_schedule(pr
+0000bd30: 6f6a 6563 745f 6e61 6d65 2c20 7363 6865  oject_name, sche
+0000bd40: 6475 6c65 290a 2020 2020 2020 2020 2222  dule).        ""
+0000bd50: 220a 0a20 2020 2020 2020 2070 726f 6a65  "..        proje
+0000bd60: 6374 203d 2070 726f 6a65 6374 206f 7220  ct = project or 
+0000bd70: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
+0000bd80: 726f 6a65 6374 0a20 2020 2020 2020 2070  roject.        p
+0000bd90: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
+0000bda0: 2f7b 7072 6f6a 6563 747d 2f73 6368 6564  /{project}/sched
+0000bdb0: 756c 6573 220a 0a20 2020 2020 2020 2065  ules"..        e
+0000bdc0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
+0000bdd0: 2246 6169 6c65 6420 6372 6561 7469 6e67  "Failed creating
+0000bde0: 2073 6368 6564 756c 6520 7b70 726f 6a65   schedule {proje
+0000bdf0: 6374 7d2f 7b73 6368 6564 756c 652e 6e61  ct}/{schedule.na
+0000be00: 6d65 7d22 0a20 2020 2020 2020 2073 656c  me}".        sel
+0000be10: 662e 6170 695f 6361 6c6c 2822 504f 5354  f.api_call("POST
+0000be20: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
+0000be30: 6573 7361 6765 2c20 626f 6479 3d64 6963  essage, body=dic
+0000be40: 745f 746f 5f6a 736f 6e28 7363 6865 6475  t_to_json(schedu
+0000be50: 6c65 2e64 6963 7428 2929 290a 0a20 2020  le.dict()))..   
+0000be60: 2064 6566 2075 7064 6174 655f 7363 6865   def update_sche
+0000be70: 6475 6c65 280a 2020 2020 2020 2020 7365  dule(.        se
+0000be80: 6c66 2c20 7072 6f6a 6563 743a 2073 7472  lf, project: str
+0000be90: 2c20 6e61 6d65 3a20 7374 722c 2073 6368  , name: str, sch
+0000bea0: 6564 756c 653a 206d 6c72 756e 2e63 6f6d  edule: mlrun.com
+0000beb0: 6d6f 6e2e 7363 6865 6d61 732e 5363 6865  mon.schemas.Sche
+0000bec0: 6475 6c65 5570 6461 7465 0a20 2020 2029  duleUpdate.    )
+0000bed0: 3a0a 2020 2020 2020 2020 2222 2255 7064  :.        """Upd
+0000bee0: 6174 6520 616e 2065 7869 7374 696e 6720  ate an existing 
+0000bef0: 7363 6865 6475 6c65 2c20 7265 706c 6163  schedule, replac
+0000bf00: 6520 6974 2077 6974 6820 7468 6520 6465  e it with the de
+0000bf10: 7461 696c 7320 636f 6e74 6169 6e65 6420  tails contained 
+0000bf20: 696e 2074 6865 2073 6368 6564 756c 6520  in the schedule 
+0000bf30: 6f62 6a65 6374 2e22 2222 0a0a 2020 2020  object."""..    
+0000bf40: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
+0000bf50: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
+0000bf60: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
+0000bf70: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
+0000bf80: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
+0000bf90: 6374 7d2f 7363 6865 6475 6c65 732f 7b6e  ct}/schedules/{n
+0000bfa0: 616d 657d 220a 0a20 2020 2020 2020 2065  ame}"..        e
+0000bfb0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
+0000bfc0: 2246 6169 6c65 6420 7570 6461 7469 6e67  "Failed updating
+0000bfd0: 2073 6368 6564 756c 6520 7b70 726f 6a65   schedule {proje
+0000bfe0: 6374 7d2f 7b6e 616d 657d 220a 2020 2020  ct}/{name}".    
+0000bff0: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
+0000c000: 6c28 2250 5554 222c 2070 6174 682c 2065  l("PUT", path, e
+0000c010: 7272 6f72 5f6d 6573 7361 6765 2c20 626f  rror_message, bo
+0000c020: 6479 3d64 6963 745f 746f 5f6a 736f 6e28  dy=dict_to_json(
+0000c030: 7363 6865 6475 6c65 2e64 6963 7428 2929  schedule.dict())
+0000c040: 290a 0a20 2020 2064 6566 2067 6574 5f73  )..    def get_s
+0000c050: 6368 6564 756c 6528 0a20 2020 2020 2020  chedule(.       
+0000c060: 2073 656c 662c 2070 726f 6a65 6374 3a20   self, project: 
+0000c070: 7374 722c 206e 616d 653a 2073 7472 2c20  str, name: str, 
+0000c080: 696e 636c 7564 655f 6c61 7374 5f72 756e  include_last_run
+0000c090: 3a20 626f 6f6c 203d 2046 616c 7365 0a20  : bool = False. 
+0000c0a0: 2020 2029 202d 3e20 6d6c 7275 6e2e 636f     ) -> mlrun.co
+0000c0b0: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6368  mmon.schemas.Sch
+0000c0c0: 6564 756c 654f 7574 7075 743a 0a20 2020  eduleOutput:.   
+0000c0d0: 2020 2020 2022 2222 5265 7472 6965 7665       """Retrieve
+0000c0e0: 2064 6574 6169 6c73 206f 6620 7468 6520   details of the 
+0000c0f0: 7363 6865 6475 6c65 2069 6e20 7175 6573  schedule in ques
+0000c100: 7469 6f6e 2e20 4265 7369 6465 7320 7265  tion. Besides re
+0000c110: 7475 726e 696e 6720 7468 6520 6465 7461  turning the deta
+0000c120: 696c 7320 6f66 2074 6865 2073 6368 6564  ils of the sched
+0000c130: 756c 6520 6f62 6a65 6374 2069 7473 656c  ule object itsel
+0000c140: 662c 0a20 2020 2020 2020 2074 6869 7320  f,.        this 
+0000c150: 6675 6e63 7469 6f6e 2061 6c73 6f20 7265  function also re
+0000c160: 7475 726e 7320 7468 6520 6e65 7874 2073  turns the next s
+0000c170: 6368 6564 756c 6564 2072 756e 2066 6f72  cheduled run for
+0000c180: 2074 6869 7320 7370 6563 6966 6963 2073   this specific s
+0000c190: 6368 6564 756c 652c 2061 7320 7765 6c6c  chedule, as well
+0000c1a0: 2061 7320 706f 7465 6e74 6961 6c6c 7920   as potentially 
+0000c1b0: 7468 650a 2020 2020 2020 2020 7265 7375  the.        resu
+0000c1c0: 6c74 7320 6f66 2074 6865 206c 6173 7420  lts of the last 
+0000c1d0: 7275 6e20 6578 6563 7574 6564 2074 6872  run executed thr
+0000c1e0: 6f75 6768 2074 6869 7320 7363 6865 6475  ough this schedu
+0000c1f0: 6c65 2e0a 0a20 2020 2020 2020 203a 7061  le...        :pa
+0000c200: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
+0000c210: 6a65 6374 206e 616d 652e 0a20 2020 2020  ject name..     
+0000c220: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
+0000c230: 4e61 6d65 206f 6620 7468 6520 7363 6865  Name of the sche
+0000c240: 6475 6c65 206f 626a 6563 7420 746f 2071  dule object to q
+0000c250: 7565 7279 2e0a 2020 2020 2020 2020 3a70  uery..        :p
+0000c260: 6172 616d 2069 6e63 6c75 6465 5f6c 6173  aram include_las
+0000c270: 745f 7275 6e3a 2057 6865 7468 6572 2074  t_run: Whether t
+0000c280: 6f20 696e 636c 7564 6520 7468 6520 7265  o include the re
+0000c290: 7375 6c74 7320 6f66 2074 6865 2073 6368  sults of the sch
+0000c2a0: 6564 756c 6527 7320 6c61 7374 2072 756e  edule's last run
+0000c2b0: 2069 6e20 7468 6520 7265 7370 6f6e 7365   in the response
+0000c2c0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0000c2d0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+0000c2e0: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
+0000c2f0: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
+0000c300: 6374 0a20 2020 2020 2020 2070 6174 6820  ct.        path 
+0000c310: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+0000c320: 6f6a 6563 747d 2f73 6368 6564 756c 6573  oject}/schedules
+0000c330: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
+0000c340: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+0000c350: 2066 2246 6169 6c65 6420 6765 7474 696e   f"Failed gettin
+0000c360: 6720 7363 6865 6475 6c65 2066 6f72 207b  g schedule for {
+0000c370: 7072 6f6a 6563 747d 2f7b 6e61 6d65 7d22  project}/{name}"
+0000c380: 0a20 2020 2020 2020 2072 6573 7020 3d20  .        resp = 
+0000c390: 7365 6c66 2e61 7069 5f63 616c 6c28 0a20  self.api_call(. 
+0000c3a0: 2020 2020 2020 2020 2020 2022 4745 5422             "GET"
+0000c3b0: 2c20 7061 7468 2c20 6572 726f 725f 6d65  , path, error_me
+0000c3c0: 7373 6167 652c 2070 6172 616d 733d 7b22  ssage, params={"
+0000c3d0: 696e 636c 7564 655f 6c61 7374 5f72 756e  include_last_run
+0000c3e0: 223a 2069 6e63 6c75 6465 5f6c 6173 745f  ": include_last_
+0000c3f0: 7275 6e7d 0a20 2020 2020 2020 2029 0a20  run}.        ). 
+0000c400: 2020 2020 2020 2072 6574 7572 6e20 6d6c         return ml
+0000c410: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000c420: 6173 2e53 6368 6564 756c 654f 7574 7075  as.ScheduleOutpu
+0000c430: 7428 2a2a 7265 7370 2e6a 736f 6e28 2929  t(**resp.json())
+0000c440: 0a0a 2020 2020 6465 6620 6c69 7374 5f73  ..    def list_s
+0000c450: 6368 6564 756c 6573 280a 2020 2020 2020  chedules(.      
+0000c460: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000c470: 7072 6f6a 6563 743a 2073 7472 2c0a 2020  project: str,.  
+0000c480: 2020 2020 2020 6e61 6d65 3a20 7374 7220        name: str 
+0000c490: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000c4a0: 6b69 6e64 3a20 6d6c 7275 6e2e 636f 6d6d  kind: mlrun.comm
+0000c4b0: 6f6e 2e73 6368 656d 6173 2e53 6368 6564  on.schemas.Sched
+0000c4c0: 756c 654b 696e 6473 203d 204e 6f6e 652c  uleKinds = None,
+0000c4d0: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
+0000c4e0: 5f6c 6173 745f 7275 6e3a 2062 6f6f 6c20  _last_run: bool 
+0000c4f0: 3d20 4661 6c73 652c 0a20 2020 2029 202d  = False,.    ) -
+0000c500: 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  > mlrun.common.s
+0000c510: 6368 656d 6173 2e53 6368 6564 756c 6573  chemas.Schedules
+0000c520: 4f75 7470 7574 3a0a 2020 2020 2020 2020  Output:.        
+0000c530: 2222 2252 6574 7269 6576 6520 6c69 7374  """Retrieve list
+0000c540: 206f 6620 7363 6865 6475 6c65 7320 6f66   of schedules of
+0000c550: 2073 7065 6369 6669 6320 6e61 6d65 206f   specific name o
+0000c560: 7220 6b69 6e64 2e0a 0a20 2020 2020 2020  r kind...       
+0000c570: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
+0000c580: 2050 726f 6a65 6374 206e 616d 652e 0a20   Project name.. 
+0000c590: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
+0000c5a0: 6d65 3a20 4e61 6d65 206f 6620 7363 6865  me: Name of sche
+0000c5b0: 6475 6c65 2074 6f20 7265 7472 6965 7665  dule to retrieve
+0000c5c0: 2e20 4361 6e20 6265 206f 6d69 7474 6564  . Can be omitted
+0000c5d0: 2074 6f20 6c69 7374 2061 6c6c 2073 6368   to list all sch
+0000c5e0: 6564 756c 6573 2e0a 2020 2020 2020 2020  edules..        
+0000c5f0: 3a70 6172 616d 206b 696e 643a 204b 696e  :param kind: Kin
+0000c600: 6420 6f66 2073 6368 6564 756c 6520 6f62  d of schedule ob
+0000c610: 6a65 6374 7320 746f 2072 6574 7269 6576  jects to retriev
+0000c620: 652c 2063 616e 2062 6520 6569 7468 6572  e, can be either
+0000c630: 2060 606a 6f62 6060 206f 7220 6060 7069   ``job`` or ``pi
+0000c640: 7065 6c69 6e65 6060 2e0a 2020 2020 2020  peline``..      
+0000c650: 2020 3a70 6172 616d 2069 6e63 6c75 6465    :param include
+0000c660: 5f6c 6173 745f 7275 6e3a 2057 6865 7468  _last_run: Wheth
+0000c670: 6572 2074 6f20 7265 7475 726e 2066 6f72  er to return for
+0000c680: 2065 6163 6820 7363 6865 6475 6c65 2072   each schedule r
+0000c690: 6574 7572 6e65 6420 616c 736f 2074 6865  eturned also the
+0000c6a0: 2072 6573 756c 7473 206f 6620 7468 6520   results of the 
+0000c6b0: 6c61 7374 2072 756e 206f 660a 2020 2020  last run of.    
+0000c6c0: 2020 2020 2020 2020 7468 6174 2073 6368          that sch
+0000c6d0: 6564 756c 652e 0a20 2020 2020 2020 2022  edule..        "
+0000c6e0: 2222 0a0a 2020 2020 2020 2020 7072 6f6a  ""..        proj
+0000c6f0: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
+0000c700: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+0000c710: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+0000c720: 7061 7261 6d73 203d 207b 226b 696e 6422  params = {"kind"
+0000c730: 3a20 6b69 6e64 2c20 226e 616d 6522 3a20  : kind, "name": 
+0000c740: 6e61 6d65 2c20 2269 6e63 6c75 6465 5f6c  name, "include_l
+0000c750: 6173 745f 7275 6e22 3a20 696e 636c 7564  ast_run": includ
+0000c760: 655f 6c61 7374 5f72 756e 7d0a 2020 2020  e_last_run}.    
+0000c770: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
+0000c780: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
+0000c790: 7363 6865 6475 6c65 7322 0a20 2020 2020  schedules".     
+0000c7a0: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+0000c7b0: 203d 2066 2246 6169 6c65 6420 6c69 7374   = f"Failed list
+0000c7c0: 696e 6720 7363 6865 6475 6c65 7320 666f  ing schedules fo
+0000c7d0: 7220 7b70 726f 6a65 6374 7d20 3f20 7b6b  r {project} ? {k
+0000c7e0: 696e 647d 207b 6e61 6d65 7d22 0a20 2020  ind} {name}".   
+0000c7f0: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
+0000c800: 2e61 7069 5f63 616c 6c28 2247 4554 222c  .api_call("GET",
+0000c810: 2070 6174 682c 2065 7272 6f72 5f6d 6573   path, error_mes
+0000c820: 7361 6765 2c20 7061 7261 6d73 3d70 6172  sage, params=par
+0000c830: 616d 7329 0a20 2020 2020 2020 2072 6574  ams).        ret
+0000c840: 7572 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e  urn mlrun.common
+0000c850: 2e73 6368 656d 6173 2e53 6368 6564 756c  .schemas.Schedul
+0000c860: 6573 4f75 7470 7574 282a 2a72 6573 702e  esOutput(**resp.
+0000c870: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
+0000c880: 2064 656c 6574 655f 7363 6865 6475 6c65   delete_schedule
+0000c890: 2873 656c 662c 2070 726f 6a65 6374 3a20  (self, project: 
+0000c8a0: 7374 722c 206e 616d 653a 2073 7472 293a  str, name: str):
+0000c8b0: 0a20 2020 2020 2020 2022 2222 4465 6c65  .        """Dele
+0000c8c0: 7465 2061 2073 7065 6369 6669 6320 7363  te a specific sc
+0000c8d0: 6865 6475 6c65 2062 7920 6e61 6d65 2e22  hedule by name."
+0000c8e0: 2222 0a0a 2020 2020 2020 2020 7072 6f6a  ""..        proj
+0000c8f0: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
+0000c900: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+0000c910: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+0000c920: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
+0000c930: 732f 7b70 726f 6a65 6374 7d2f 7363 6865  s/{project}/sche
+0000c940: 6475 6c65 732f 7b6e 616d 657d 220a 2020  dules/{name}".  
+0000c950: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+0000c960: 6167 6520 3d20 6622 4661 696c 6564 2064  age = f"Failed d
+0000c970: 656c 6574 696e 6720 7363 6865 6475 6c65  eleting schedule
+0000c980: 207b 7072 6f6a 6563 747d 2f7b 6e61 6d65   {project}/{name
+0000c990: 7d22 0a20 2020 2020 2020 2073 656c 662e  }".        self.
+0000c9a0: 6170 695f 6361 6c6c 2822 4445 4c45 5445  api_call("DELETE
+0000c9b0: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
+0000c9c0: 6573 7361 6765 290a 0a20 2020 2064 6566  essage)..    def
+0000c9d0: 2069 6e76 6f6b 655f 7363 6865 6475 6c65   invoke_schedule
+0000c9e0: 2873 656c 662c 2070 726f 6a65 6374 3a20  (self, project: 
+0000c9f0: 7374 722c 206e 616d 653a 2073 7472 293a  str, name: str):
+0000ca00: 0a20 2020 2020 2020 2022 2222 4578 6563  .        """Exec
+0000ca10: 7574 6520 7468 6520 6f62 6a65 6374 2072  ute the object r
+0000ca20: 6566 6572 656e 6365 6420 6279 2074 6865  eferenced by the
+0000ca30: 2073 6368 6564 756c 6520 696d 6d65 6469   schedule immedi
+0000ca40: 6174 656c 792e 2222 220a 0a20 2020 2020  ately."""..     
+0000ca50: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
+0000ca60: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
+0000ca70: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
+0000ca80: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+0000ca90: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
+0000caa0: 747d 2f73 6368 6564 756c 6573 2f7b 6e61  t}/schedules/{na
+0000cab0: 6d65 7d2f 696e 766f 6b65 220a 2020 2020  me}/invoke".    
+0000cac0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+0000cad0: 6520 3d20 6622 4661 696c 6564 2069 6e76  e = f"Failed inv
+0000cae0: 6f6b 696e 6720 7363 6865 6475 6c65 207b  oking schedule {
+0000caf0: 7072 6f6a 6563 747d 2f7b 6e61 6d65 7d22  project}/{name}"
+0000cb00: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
+0000cb10: 695f 6361 6c6c 2822 504f 5354 222c 2070  i_call("POST", p
+0000cb20: 6174 682c 2065 7272 6f72 5f6d 6573 7361  ath, error_messa
+0000cb30: 6765 290a 0a20 2020 2064 6566 2072 656d  ge)..    def rem
+0000cb40: 6f74 655f 6275 696c 6465 7228 0a20 2020  ote_builder(.   
+0000cb50: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000cb60: 2020 2066 756e 632c 0a20 2020 2020 2020     func,.       
+0000cb70: 2077 6974 685f 6d6c 7275 6e2c 0a20 2020   with_mlrun,.   
+0000cb80: 2020 2020 206d 6c72 756e 5f76 6572 7369       mlrun_versi
+0000cb90: 6f6e 5f73 7065 6369 6669 6572 3d4e 6f6e  on_specifier=Non
+0000cba0: 652c 0a20 2020 2020 2020 2073 6b69 705f  e,.        skip_
+0000cbb0: 6465 706c 6f79 6564 3d46 616c 7365 2c0a  deployed=False,.
+0000cbc0: 2020 2020 2020 2020 6275 696c 6465 725f          builder_
+0000cbd0: 656e 763d 4e6f 6e65 2c0a 2020 2020 293a  env=None,.    ):
+0000cbe0: 0a20 2020 2020 2020 2022 2222 4275 696c  .        """Buil
+0000cbf0: 6420 7468 6520 706f 6420 696d 6167 6520  d the pod image 
+0000cc00: 666f 7220 6120 6675 6e63 7469 6f6e 2c20  for a function, 
+0000cc10: 666f 7220 6578 6563 7574 696f 6e20 6f6e  for execution on
+0000cc20: 2061 2072 656d 6f74 6520 636c 7573 7465   a remote cluste
+0000cc30: 722e 2054 6869 7320 6973 2065 7865 6375  r. This is execu
+0000cc40: 7465 6420 6279 2074 6865 204d 4c52 756e  ted by the MLRun
+0000cc50: 0a20 2020 2020 2020 2041 5049 2073 6572  .        API ser
+0000cc60: 7665 722c 2061 6e64 2063 7265 6174 6573  ver, and creates
+0000cc70: 2061 2044 6f63 6b65 7220 696d 6167 6520   a Docker image 
+0000cc80: 6f75 7420 6f66 2074 6865 2066 756e 6374  out of the funct
+0000cc90: 696f 6e20 7072 6f76 6964 6564 2061 6e64  ion provided and
+0000cca0: 2061 6e79 2073 7065 6369 6669 6320 6275   any specific bu
+0000ccb0: 696c 640a 2020 2020 2020 2020 696e 7374  ild.        inst
+0000ccc0: 7275 6374 696f 6e73 2070 726f 7669 6465  ructions provide
+0000ccd0: 6420 7769 7468 696e 2e20 5468 6973 2069  d within. This i
+0000cce0: 7320 6120 7072 652d 7265 7175 6973 6974  s a pre-requisit
+0000ccf0: 6520 666f 7220 7265 6d6f 7465 6c79 2065  e for remotely e
+0000cd00: 7865 6375 7469 6e67 2061 2066 756e 6374  xecuting a funct
+0000cd10: 696f 6e2c 2075 6e6c 6573 7320 7573 696e  ion, unless usin
+0000cd20: 670a 2020 2020 2020 2020 6120 7072 652d  g.        a pre-
+0000cd30: 6465 706c 6f79 6564 2069 6d61 6765 2e0a  deployed image..
+0000cd40: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000cd50: 6675 6e63 3a20 4675 6e63 7469 6f6e 2074  func: Function t
+0000cd60: 6f20 6275 696c 642e 0a20 2020 2020 2020  o build..       
+0000cd70: 203a 7061 7261 6d20 7769 7468 5f6d 6c72   :param with_mlr
+0000cd80: 756e 3a20 5768 6574 6865 7220 746f 2061  un: Whether to a
+0000cd90: 6464 204d 4c52 756e 2070 6163 6b61 6765  dd MLRun package
+0000cda0: 2074 6f20 7468 6520 6275 696c 7420 7061   to the built pa
+0000cdb0: 636b 6167 652e 2054 6869 7320 6973 206e  ckage. This is n
+0000cdc0: 6f74 2072 6571 7569 7265 6420 6966 2075  ot required if u
+0000cdd0: 7369 6e67 2061 2062 6173 650a 2020 2020  sing a base.    
+0000cde0: 2020 2020 2020 2020 696d 6167 6520 7468          image th
+0000cdf0: 6174 2061 6c72 6561 6479 2068 6173 204d  at already has M
+0000ce00: 4c52 756e 2069 6e20 6974 2e0a 2020 2020  LRun in it..    
+0000ce10: 2020 2020 3a70 6172 616d 206d 6c72 756e      :param mlrun
+0000ce20: 5f76 6572 7369 6f6e 5f73 7065 6369 6669  _version_specifi
+0000ce30: 6572 3a20 5665 7273 696f 6e20 6f66 204d  er: Version of M
+0000ce40: 4c52 756e 2074 6f20 696e 636c 7564 6520  LRun to include 
+0000ce50: 696e 2074 6865 2062 7569 6c74 2069 6d61  in the built ima
+0000ce60: 6765 2e0a 2020 2020 2020 2020 3a70 6172  ge..        :par
+0000ce70: 616d 2073 6b69 705f 6465 706c 6f79 6564  am skip_deployed
+0000ce80: 3a20 536b 6970 2074 6865 2062 7569 6c64  : Skip the build
+0000ce90: 2069 6620 7765 2061 6c72 6561 6479 2068   if we already h
+0000cea0: 6176 6520 616e 2069 6d61 6765 2066 6f72  ave an image for
+0000ceb0: 2074 6865 2066 756e 6374 696f 6e2e 0a20   the function.. 
+0000cec0: 2020 2020 2020 203a 7061 7261 6d20 6275         :param bu
+0000ced0: 696c 6465 725f 656e 763a 2020 204b 616e  ilder_env:   Kan
+0000cee0: 696b 6f20 6275 696c 6465 7220 706f 6420  iko builder pod 
+0000cef0: 656e 7620 7661 7273 2064 6963 7420 2866  env vars dict (f
+0000cf00: 6f72 2063 6f6e 6669 672f 6372 6564 656e  or config/creden
+0000cf10: 7469 616c 7329 0a20 2020 2020 2020 2022  tials).        "
+0000cf20: 2222 0a0a 2020 2020 2020 2020 7472 793a  ""..        try:
+0000cf30: 0a20 2020 2020 2020 2020 2020 2072 6571  .            req
+0000cf40: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0000cf50: 2020 2020 2022 6675 6e63 7469 6f6e 223a       "function":
+0000cf60: 2066 756e 632e 746f 5f64 6963 7428 292c   func.to_dict(),
+0000cf70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cf80: 2022 7769 7468 5f6d 6c72 756e 223a 2062   "with_mlrun": b
+0000cf90: 6f6f 6c32 7374 7228 7769 7468 5f6d 6c72  ool2str(with_mlr
+0000cfa0: 756e 292c 0a20 2020 2020 2020 2020 2020  un),.           
+0000cfb0: 2020 2020 2022 736b 6970 5f64 6570 6c6f       "skip_deplo
+0000cfc0: 7965 6422 3a20 736b 6970 5f64 6570 6c6f  yed": skip_deplo
+0000cfd0: 7965 642c 0a20 2020 2020 2020 2020 2020  yed,.           
+0000cfe0: 207d 0a20 2020 2020 2020 2020 2020 2069   }.            i
+0000cff0: 6620 6d6c 7275 6e5f 7665 7273 696f 6e5f  f mlrun_version_
+0000d000: 7370 6563 6966 6965 723a 0a20 2020 2020  specifier:.     
+0000d010: 2020 2020 2020 2020 2020 2072 6571 5b22             req["
+0000d020: 6d6c 7275 6e5f 7665 7273 696f 6e5f 7370  mlrun_version_sp
+0000d030: 6563 6966 6965 7222 5d20 3d20 6d6c 7275  ecifier"] = mlru
+0000d040: 6e5f 7665 7273 696f 6e5f 7370 6563 6966  n_version_specif
+0000d050: 6965 720a 2020 2020 2020 2020 2020 2020  ier.            
+0000d060: 6966 2062 7569 6c64 6572 5f65 6e76 3a0a  if builder_env:.
+0000d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d080: 7265 715b 2262 7569 6c64 6572 5f65 6e76  req["builder_env
+0000d090: 225d 203d 2062 7569 6c64 6572 5f65 6e76  "] = builder_env
+0000d0a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000d0b0: 7020 3d20 7365 6c66 2e61 7069 5f63 616c  p = self.api_cal
+0000d0c0: 6c28 2250 4f53 5422 2c20 2262 7569 6c64  l("POST", "build
+0000d0d0: 2f66 756e 6374 696f 6e22 2c20 6a73 6f6e  /function", json
+0000d0e0: 3d72 6571 290a 2020 2020 2020 2020 6578  =req).        ex
+0000d0f0: 6365 7074 204f 5345 7272 6f72 2061 7320  cept OSError as 
+0000d100: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
+0000d110: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
+0000d120: 6572 726f 7220 7375 626d 6974 7469 6e67  error submitting
+0000d130: 2062 7569 6c64 2074 6173 6b3a 207b 6572   build task: {er
+0000d140: 725f 746f 5f73 7472 2865 7272 297d 2229  r_to_str(err)}")
+0000d150: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000d160: 7365 204f 5345 7272 6f72 2866 2265 7272  se OSError(f"err
+0000d170: 6f72 3a20 6361 6e6e 6f74 2073 7562 6d69  or: cannot submi
+0000d180: 7420 6275 696c 642c 207b 6572 725f 746f  t build, {err_to
+0000d190: 5f73 7472 2865 7272 297d 2229 0a0a 2020  _str(err)}")..  
+0000d1a0: 2020 2020 2020 6966 206e 6f74 2072 6573        if not res
+0000d1b0: 702e 6f6b 3a0a 2020 2020 2020 2020 2020  p.ok:.          
+0000d1c0: 2020 6c6f 6767 6572 2e65 7272 6f72 2866    logger.error(f
+0000d1d0: 2262 6164 2072 6573 7021 215c 6e7b 7265  "bad resp!!\n{re
+0000d1e0: 7370 2e74 6578 747d 2229 0a20 2020 2020  sp.text}").     
+0000d1f0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0000d200: 7565 4572 726f 7228 2262 6164 2066 756e  ueError("bad fun
+0000d210: 6374 696f 6e20 7275 6e20 7265 7370 6f6e  ction run respon
+0000d220: 7365 2229 0a0a 2020 2020 2020 2020 7265  se")..        re
+0000d230: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
+0000d240: 0a0a 2020 2020 6465 6620 6765 745f 6275  ..    def get_bu
+0000d250: 696c 6465 725f 7374 6174 7573 280a 2020  ilder_status(.  
+0000d260: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000d270: 2020 2020 6675 6e63 3a20 4261 7365 5275      func: BaseRu
+0000d280: 6e74 696d 652c 0a20 2020 2020 2020 206f  ntime,.        o
+0000d290: 6666 7365 743a 2069 6e74 203d 2030 2c0a  ffset: int = 0,.
+0000d2a0: 2020 2020 2020 2020 6c6f 6773 3a20 626f          logs: bo
+0000d2b0: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
+0000d2c0: 2020 206c 6173 745f 6c6f 675f 7469 6d65     last_log_time
+0000d2d0: 7374 616d 703a 2066 6c6f 6174 203d 2030  stamp: float = 0
+0000d2e0: 2e30 2c0a 2020 2020 2020 2020 7665 7262  .0,.        verb
+0000d2f0: 6f73 653a 2062 6f6f 6c20 3d20 4661 6c73  ose: bool = Fals
+0000d300: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+0000d310: 2020 2222 2252 6574 7269 6576 6520 7468    """Retrieve th
+0000d320: 6520 7374 6174 7573 206f 6620 6120 6275  e status of a bu
+0000d330: 696c 6420 6f70 6572 6174 696f 6e20 6375  ild operation cu
+0000d340: 7272 656e 746c 7920 696e 2070 726f 6772  rrently in progr
+0000d350: 6573 732e 0a0a 2020 2020 2020 2020 3a70  ess...        :p
+0000d360: 6172 616d 2066 756e 633a 2020 2020 2020  aram func:      
+0000d370: 2020 2020 2020 2020 2020 4675 6e63 7469            Functi
+0000d380: 6f6e 206f 626a 6563 7420 7468 6174 2069  on object that i
+0000d390: 7320 6265 696e 6720 6275 696c 742e 0a20  s being built.. 
+0000d3a0: 2020 2020 2020 203a 7061 7261 6d20 6f66         :param of
+0000d3b0: 6673 6574 3a20 2020 2020 2020 2020 2020  fset:           
+0000d3c0: 2020 204f 6666 7365 7420 696e 746f 2074     Offset into t
+0000d3d0: 6865 2062 7569 6c64 206c 6f67 7320 746f  he build logs to
+0000d3e0: 2072 6574 7269 6576 6520 6c6f 6773 2066   retrieve logs f
+0000d3f0: 726f 6d2e 0a20 2020 2020 2020 203a 7061  rom..        :pa
+0000d400: 7261 6d20 6c6f 6773 3a20 2020 2020 2020  ram logs:       
+0000d410: 2020 2020 2020 2020 2053 686f 756c 6420           Should 
+0000d420: 6275 696c 6420 6c6f 6773 2062 6520 7265  build logs be re
+0000d430: 7472 6965 7665 642e 0a20 2020 2020 2020  trieved..       
+0000d440: 203a 7061 7261 6d20 6c61 7374 5f6c 6f67   :param last_log
+0000d450: 5f74 696d 6573 7461 6d70 3a20 204c 6173  _timestamp:  Las
+0000d460: 7420 7469 6d65 7374 616d 7020 6f66 206c  t timestamp of l
+0000d470: 6f67 7320 7468 6174 2077 6572 6520 616c  ogs that were al
+0000d480: 7265 6164 7920 7265 7472 6965 7665 642e  ready retrieved.
+0000d490: 2046 756e 6374 696f 6e20 7769 6c6c 2072   Function will r
+0000d4a0: 6574 7572 6e20 6f6e 6c79 206c 6f67 730a  eturn only logs.
+0000d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4d0: 2020 2020 6c61 7465 7220 7468 616e 2074      later than t
+0000d4e0: 6869 7320 7061 7261 6d65 7465 722e 0a20  his parameter.. 
+0000d4f0: 2020 2020 2020 203a 7061 7261 6d20 7665         :param ve
+0000d500: 7262 6f73 653a 2020 2020 2020 2020 2020  rbose:          
+0000d510: 2020 2041 6464 2076 6572 626f 7365 206c     Add verbose l
+0000d520: 6f67 7320 696e 746f 2074 6865 206f 7574  ogs into the out
+0000d530: 7075 742e 0a0a 2020 2020 2020 2020 3a72  put...        :r
+0000d540: 6574 7572 6e73 3a20 5468 6520 666f 6c6c  eturns: The foll
+0000d550: 6f77 696e 6720 7061 7261 6d65 7465 7273  owing parameters
+0000d560: 3a0a 0a20 2020 2020 2020 2020 2020 202d  :..            -
+0000d570: 2054 6578 7420 6f66 2062 7569 6c64 6572   Text of builder
+0000d580: 206c 6f67 732e 0a20 2020 2020 2020 2020   logs..         
+0000d590: 2020 202d 2054 696d 6573 7461 6d70 206f     - Timestamp o
+0000d5a0: 6620 6c61 7374 206c 6f67 2072 6574 7269  f last log retri
+0000d5b0: 6576 6564 2c20 746f 2062 6520 7573 6564  eved, to be used
+0000d5c0: 2069 6e20 7375 6273 6571 7565 6e74 2063   in subsequent c
+0000d5d0: 616c 6c73 2074 6f20 7468 6973 2066 756e  alls to this fun
+0000d5e0: 6374 696f 6e2e 0a0a 2020 2020 2020 2020  ction...        
+0000d5f0: 2020 2020 5468 6520 6675 6e63 7469 6f6e      The function
+0000d600: 2061 6c73 6f20 7570 6461 7465 7320 696e   also updates in
+0000d610: 7465 726e 616c 206d 656d 6265 7273 206f  ternal members o
+0000d620: 6620 7468 6520 6060 6675 6e63 6060 206f  f the ``func`` o
+0000d630: 626a 6563 7420 746f 2072 6566 6c65 6374  bject to reflect
+0000d640: 2062 7569 6c64 2070 726f 6365 7373 2069   build process i
+0000d650: 6e66 6f2e 0a20 2020 2020 2020 2022 2222  nfo..        """
+0000d660: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000d670: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000d680: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+0000d690: 2020 2020 2020 226e 616d 6522 3a20 6e6f        "name": no
+0000d6a0: 726d 616c 697a 655f 6e61 6d65 2866 756e  rmalize_name(fun
+0000d6b0: 632e 6d65 7461 6461 7461 2e6e 616d 6529  c.metadata.name)
+0000d6c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d6d0: 2020 2270 726f 6a65 6374 223a 2066 756e    "project": fun
+0000d6e0: 632e 6d65 7461 6461 7461 2e70 726f 6a65  c.metadata.proje
+0000d6f0: 6374 2c0a 2020 2020 2020 2020 2020 2020  ct,.            
+0000d700: 2020 2020 2274 6167 223a 2066 756e 632e      "tag": func.
+0000d710: 6d65 7461 6461 7461 2e74 6167 2c0a 2020  metadata.tag,.  
+0000d720: 2020 2020 2020 2020 2020 2020 2020 226c                "l
+0000d730: 6f67 7322 3a20 626f 6f6c 3273 7472 286c  ogs": bool2str(l
+0000d740: 6f67 7329 2c0a 2020 2020 2020 2020 2020  ogs),.          
+0000d750: 2020 2020 2020 226f 6666 7365 7422 3a20        "offset": 
+0000d760: 7374 7228 6f66 6673 6574 292c 0a20 2020  str(offset),.   
+0000d770: 2020 2020 2020 2020 2020 2020 2022 6c61               "la
+0000d780: 7374 5f6c 6f67 5f74 696d 6573 7461 6d70  st_log_timestamp
+0000d790: 223a 2073 7472 286c 6173 745f 6c6f 675f  ": str(last_log_
+0000d7a0: 7469 6d65 7374 616d 7029 2c0a 2020 2020  timestamp),.    
+0000d7b0: 2020 2020 2020 2020 2020 2020 2276 6572              "ver
+0000d7c0: 626f 7365 223a 2062 6f6f 6c32 7374 7228  bose": bool2str(
+0000d7d0: 7665 7262 6f73 6529 2c0a 2020 2020 2020  verbose),.      
+0000d7e0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0000d7f0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+0000d800: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+0000d810: 2262 7569 6c64 2f73 7461 7475 7322 2c20  "build/status", 
+0000d820: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
+0000d830: 2020 2020 2020 2065 7863 6570 7420 4f53         except OS
+0000d840: 4572 726f 7220 6173 2065 7272 3a0a 2020  Error as err:.  
+0000d850: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0000d860: 2e65 7272 6f72 2866 2265 7272 6f72 2067  .error(f"error g
+0000d870: 6574 7469 6e67 2062 7569 6c64 2073 7461  etting build sta
+0000d880: 7475 733a 207b 6572 725f 746f 5f73 7472  tus: {err_to_str
+0000d890: 2865 7272 297d 2229 0a20 2020 2020 2020  (err)}").       
+0000d8a0: 2020 2020 2072 6169 7365 204f 5345 7272       raise OSErr
+0000d8b0: 6f72 2866 2265 7272 6f72 3a20 6361 6e6e  or(f"error: cann
+0000d8c0: 6f74 2067 6574 2062 7569 6c64 2073 7461  ot get build sta
+0000d8d0: 7475 732c 207b 6572 725f 746f 5f73 7472  tus, {err_to_str
+0000d8e0: 2865 7272 297d 2229 0a0a 2020 2020 2020  (err)}")..      
+0000d8f0: 2020 6966 206e 6f74 2072 6573 702e 6f6b    if not resp.ok
+0000d900: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+0000d910: 6767 6572 2e77 6172 6e69 6e67 2866 2266  gger.warning(f"f
+0000d920: 6169 6c65 6420 7265 7370 2c20 7b72 6573  ailed resp, {res
+0000d930: 702e 7465 7874 7d22 290a 2020 2020 2020  p.text}").      
+0000d940: 2020 2020 2020 7261 6973 6520 5275 6e44        raise RunD
+0000d950: 4245 7272 6f72 2822 6261 6420 6675 6e63  BError("bad func
+0000d960: 7469 6f6e 2062 7569 6c64 2072 6573 706f  tion build respo
+0000d970: 6e73 6522 290a 0a20 2020 2020 2020 2069  nse")..        i
+0000d980: 6620 7265 7370 2e68 6561 6465 7273 3a0a  f resp.headers:.
+0000d990: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+0000d9a0: 2e73 7461 7475 732e 7374 6174 6520 3d20  .status.state = 
+0000d9b0: 7265 7370 2e68 6561 6465 7273 2e67 6574  resp.headers.get
+0000d9c0: 2822 782d 6d6c 7275 6e2d 6675 6e63 7469  ("x-mlrun-functi
+0000d9d0: 6f6e 2d73 7461 7475 7322 2c20 2222 290a  on-status", "").
+0000d9e0: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+0000d9f0: 5f6c 6f67 5f74 696d 6573 7461 6d70 203d  _log_timestamp =
+0000da00: 2066 6c6f 6174 280a 2020 2020 2020 2020   float(.        
+0000da10: 2020 2020 2020 2020 7265 7370 2e68 6561          resp.hea
+0000da20: 6465 7273 2e67 6574 2822 782d 6d6c 7275  ders.get("x-mlru
+0000da30: 6e2d 6c61 7374 2d74 696d 6573 7461 6d70  n-last-timestamp
+0000da40: 222c 2022 302e 3022 290a 2020 2020 2020  ", "0.0").      
+0000da50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000da60: 2020 2020 6966 2066 756e 632e 6b69 6e64      if func.kind
+0000da70: 2069 6e20 6d6c 7275 6e2e 7275 6e74 696d   in mlrun.runtim
+0000da80: 6573 2e52 756e 7469 6d65 4b69 6e64 732e  es.RuntimeKinds.
+0000da90: 6e75 636c 696f 5f72 756e 7469 6d65 7328  nuclio_runtimes(
+0000daa0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000dab0: 2020 2066 756e 632e 7374 6174 7573 2e61     func.status.a
+0000dac0: 6464 7265 7373 203d 2072 6573 702e 6865  ddress = resp.he
+0000dad0: 6164 6572 732e 6765 7428 2278 2d6d 6c72  aders.get("x-mlr
+0000dae0: 756e 2d61 6464 7265 7373 222c 2022 2229  un-address", "")
+0000daf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000db00: 2066 756e 632e 7374 6174 7573 2e6e 7563   func.status.nuc
+0000db10: 6c69 6f5f 6e61 6d65 203d 2072 6573 702e  lio_name = resp.
+0000db20: 6865 6164 6572 732e 6765 7428 2278 2d6d  headers.get("x-m
+0000db30: 6c72 756e 2d6e 616d 6522 2c20 2222 290a  lrun-name", "").
+0000db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db50: 6675 6e63 2e73 7461 7475 732e 696e 7465  func.status.inte
+0000db60: 726e 616c 5f69 6e76 6f63 6174 696f 6e5f  rnal_invocation_
+0000db70: 7572 6c73 203d 2072 6573 702e 6865 6164  urls = resp.head
+0000db80: 6572 732e 6765 7428 0a20 2020 2020 2020  ers.get(.       
+0000db90: 2020 2020 2020 2020 2020 2020 2022 782d               "x-
+0000dba0: 6d6c 7275 6e2d 696e 7465 726e 616c 2d69  mlrun-internal-i
+0000dbb0: 6e76 6f63 6174 696f 6e2d 7572 6c73 222c  nvocation-urls",
+0000dbc0: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
+0000dbd0: 2020 2020 292e 7370 6c69 7428 222c 2229      ).split(",")
+0000dbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dbf0: 2066 756e 632e 7374 6174 7573 2e65 7874   func.status.ext
+0000dc00: 6572 6e61 6c5f 696e 766f 6361 7469 6f6e  ernal_invocation
+0000dc10: 5f75 726c 7320 3d20 7265 7370 2e68 6561  _urls = resp.hea
+0000dc20: 6465 7273 2e67 6574 280a 2020 2020 2020  ders.get(.      
+0000dc30: 2020 2020 2020 2020 2020 2020 2020 2278                "x
+0000dc40: 2d6d 6c72 756e 2d65 7874 6572 6e61 6c2d  -mlrun-external-
+0000dc50: 696e 766f 6361 7469 6f6e 2d75 726c 7322  invocation-urls"
+0000dc60: 2c20 2222 0a20 2020 2020 2020 2020 2020  , "".           
+0000dc70: 2020 2020 2029 2e73 706c 6974 2822 2c22       ).split(","
+0000dc80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000dc90: 2020 6675 6e63 2e73 7461 7475 732e 636f    func.status.co
+0000dca0: 6e74 6169 6e65 725f 696d 6167 6520 3d20  ntainer_image = 
+0000dcb0: 7265 7370 2e68 6561 6465 7273 2e67 6574  resp.headers.get
+0000dcc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000dcd0: 2020 2020 2020 2278 2d6d 6c72 756e 2d63        "x-mlrun-c
+0000dce0: 6f6e 7461 696e 6572 2d69 6d61 6765 222c  ontainer-image",
+0000dcf0: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
+0000dd00: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000dd10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000dd20: 2020 2020 2020 2020 6675 6e63 2e73 7461          func.sta
+0000dd30: 7475 732e 6275 696c 645f 706f 6420 3d20  tus.build_pod = 
+0000dd40: 7265 7370 2e68 6561 6465 7273 2e67 6574  resp.headers.get
+0000dd50: 2822 6275 696c 6465 725f 706f 6422 2c20  ("builder_pod", 
+0000dd60: 2222 290a 2020 2020 2020 2020 2020 2020  "").            
+0000dd70: 2020 2020 6675 6e63 2e73 7065 632e 696d      func.spec.im
+0000dd80: 6167 6520 3d20 7265 7370 2e68 6561 6465  age = resp.heade
+0000dd90: 7273 2e67 6574 2822 6675 6e63 7469 6f6e  rs.get("function
+0000dda0: 5f69 6d61 6765 222c 2022 2229 0a0a 2020  _image", "")..  
+0000ddb0: 2020 2020 2020 7465 7874 203d 2022 220a        text = "".
+0000ddc0: 2020 2020 2020 2020 6966 2072 6573 702e          if resp.
+0000ddd0: 636f 6e74 656e 743a 0a20 2020 2020 2020  content:.       
+0000dde0: 2020 2020 2074 6578 7420 3d20 7265 7370       text = resp
+0000ddf0: 2e63 6f6e 7465 6e74 2e64 6563 6f64 6528  .content.decode(
+0000de00: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000de10: 2074 6578 742c 206c 6173 745f 6c6f 675f   text, last_log_
+0000de20: 7469 6d65 7374 616d 700a 0a20 2020 2064  timestamp..    d
+0000de30: 6566 2072 656d 6f74 655f 7374 6172 7428  ef remote_start(
+0000de40: 7365 6c66 2c20 6675 6e63 5f75 726c 2920  self, func_url) 
+0000de50: 2d3e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  -> mlrun.common.
+0000de60: 7363 6865 6d61 732e 4261 636b 6772 6f75  schemas.Backgrou
+0000de70: 6e64 5461 736b 3a0a 2020 2020 2020 2020  ndTask:.        
+0000de80: 2222 2245 7865 6375 7465 2061 2066 756e  """Execute a fun
+0000de90: 6374 696f 6e20 7265 6d6f 7465 6c79 2c20  ction remotely, 
+0000dea0: 5573 6564 2066 6f72 2060 6064 6173 6b60  Used for ``dask`
+0000deb0: 6020 6675 6e63 7469 6f6e 732e 0a0a 2020  ` functions...  
+0000dec0: 2020 2020 2020 3a70 6172 616d 2066 756e        :param fun
+0000ded0: 635f 7572 6c3a 2055 524c 2074 6f20 7468  c_url: URL to th
+0000dee0: 6520 6675 6e63 7469 6f6e 2074 6f20 6265  e function to be
+0000def0: 2065 7865 6375 7465 642e 0a20 2020 2020   executed..     
+0000df00: 2020 203a 7265 7475 726e 733a 2041 2042     :returns: A B
+0000df10: 6163 6b67 726f 756e 6454 6173 6b20 6f62  ackgroundTask ob
+0000df20: 6a65 6374 2c20 7769 7468 2064 6574 6169  ject, with detai
+0000df30: 6c73 206f 6e20 6578 6563 7574 696f 6e20  ls on execution 
+0000df40: 7072 6f63 6573 7320 616e 6420 6974 7320  process and its 
+0000df50: 7374 6174 7573 2e0a 2020 2020 2020 2020  status..        
+0000df60: 2222 220a 0a20 2020 2020 2020 2074 7279  """..        try
+0000df70: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000df80: 7120 3d20 7b22 6675 6e63 7469 6f6e 5572  q = {"functionUr
+0000df90: 6c22 3a20 6675 6e63 5f75 726c 7d0a 2020  l": func_url}.  
+0000dfa0: 2020 2020 2020 2020 2020 7265 7370 203d            resp =
+0000dfb0: 2073 656c 662e 6170 695f 6361 6c6c 280a   self.api_call(.
+0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfd0: 2250 4f53 5422 2c0a 2020 2020 2020 2020  "POST",.        
+0000dfe0: 2020 2020 2020 2020 2273 7461 7274 2f66          "start/f
+0000dff0: 756e 6374 696f 6e22 2c0a 2020 2020 2020  unction",.      
+0000e000: 2020 2020 2020 2020 2020 6a73 6f6e 3d72            json=r
+0000e010: 6571 2c0a 2020 2020 2020 2020 2020 2020  eq,.            
+0000e020: 2020 2020 7469 6d65 6f75 743d 696e 7428      timeout=int(
+0000e030: 636f 6e66 6967 2e73 7562 6d69 745f 7469  config.submit_ti
+0000e040: 6d65 6f75 7429 206f 7220 3630 2c0a 2020  meout) or 60,.  
+0000e050: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000e060: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
+0000e070: 6f72 2061 7320 6572 723a 0a20 2020 2020  or as err:.     
+0000e080: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
+0000e090: 726f 7228 6622 6572 726f 7220 7374 6172  ror(f"error star
+0000e0a0: 7469 6e67 2066 756e 6374 696f 6e3a 207b  ting function: {
+0000e0b0: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
+0000e0c0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0000e0d0: 6169 7365 204f 5345 7272 6f72 2866 2265  aise OSError(f"e
+0000e0e0: 7272 6f72 3a20 6361 6e6e 6f74 2073 7461  rror: cannot sta
+0000e0f0: 7274 2066 756e 6374 696f 6e2c 207b 6572  rt function, {er
+0000e100: 725f 746f 5f73 7472 2865 7272 297d 2229  r_to_str(err)}")
+0000e110: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0000e120: 2072 6573 702e 6f6b 3a0a 2020 2020 2020   resp.ok:.      
+0000e130: 2020 2020 2020 6c6f 6767 6572 2e65 7272        logger.err
+0000e140: 6f72 2866 2262 6164 2072 6573 7021 215c  or(f"bad resp!!\
+0000e150: 6e7b 7265 7370 2e74 6578 747d 2229 0a20  n{resp.text}"). 
+0000e160: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000e170: 2056 616c 7565 4572 726f 7228 2262 6164   ValueError("bad
+0000e180: 2066 756e 6374 696f 6e20 7374 6172 7420   function start 
+0000e190: 7265 7370 6f6e 7365 2229 0a0a 2020 2020  response")..    
+0000e1a0: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
+0000e1b0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0000e1c0: 4261 636b 6772 6f75 6e64 5461 736b 282a  BackgroundTask(*
+0000e1d0: 2a72 6573 702e 6a73 6f6e 2829 290a 0a20  *resp.json()).. 
+0000e1e0: 2020 2064 6566 2067 6574 5f70 726f 6a65     def get_proje
+0000e1f0: 6374 5f62 6163 6b67 726f 756e 645f 7461  ct_background_ta
+0000e200: 736b 280a 2020 2020 2020 2020 7365 6c66  sk(.        self
+0000e210: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+0000e220: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
+0000e230: 6e61 6d65 3a20 7374 722c 0a20 2020 2029  name: str,.    )
+0000e240: 202d 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e   -> mlrun.common
+0000e250: 2e73 6368 656d 6173 2e42 6163 6b67 726f  .schemas.Backgro
+0000e260: 756e 6454 6173 6b3a 0a20 2020 2020 2020  undTask:.       
+0000e270: 2022 2222 5265 7472 6965 7665 2075 7064   """Retrieve upd
+0000e280: 6174 6564 2069 6e66 6f72 6d61 7469 6f6e  ated information
+0000e290: 206f 6e20 6120 7072 6f6a 6563 7420 6261   on a project ba
+0000e2a0: 636b 6772 6f75 6e64 2074 6173 6b20 6265  ckground task be
+0000e2b0: 696e 6720 6578 6563 7574 6564 2e22 2222  ing executed."""
+0000e2c0: 0a0a 2020 2020 2020 2020 7072 6f6a 6563  ..        projec
+0000e2d0: 7420 3d20 7072 6f6a 6563 7420 6f72 2063  t = project or c
+0000e2e0: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
+0000e2f0: 6f6a 6563 740a 2020 2020 2020 2020 7061  oject.        pa
+0000e300: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+0000e310: 7b70 726f 6a65 6374 7d2f 6261 636b 6772  {project}/backgr
+0000e320: 6f75 6e64 2d74 6173 6b73 2f7b 6e61 6d65  ound-tasks/{name
+0000e330: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
+0000e340: 5f6d 6573 7361 6765 203d 2028 0a20 2020  _message = (.   
+0000e350: 2020 2020 2020 2020 2066 2246 6169 6c65           f"Faile
+0000e360: 6420 6765 7474 696e 6720 7072 6f6a 6563  d getting projec
+0000e370: 7420 6261 636b 6772 6f75 6e64 2074 6173  t background tas
+0000e380: 6b2e 2070 726f 6a65 6374 3d7b 7072 6f6a  k. project={proj
+0000e390: 6563 747d 2c20 6e61 6d65 3d7b 6e61 6d65  ect}, name={name
+0000e3a0: 7d22 0a20 2020 2020 2020 2029 0a20 2020  }".        ).   
+0000e3b0: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
+0000e3c0: 7365 6c66 2e61 7069 5f63 616c 6c28 2247  self.api_call("G
+0000e3d0: 4554 222c 2070 6174 682c 2065 7272 6f72  ET", path, error
+0000e3e0: 5f6d 6573 7361 6765 290a 2020 2020 2020  _message).      
+0000e3f0: 2020 7265 7475 726e 206d 6c72 756e 2e63    return mlrun.c
+0000e400: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4261  ommon.schemas.Ba
+0000e410: 636b 6772 6f75 6e64 5461 736b 282a 2a72  ckgroundTask(**r
+0000e420: 6573 706f 6e73 652e 6a73 6f6e 2829 290a  esponse.json()).
+0000e430: 0a20 2020 2064 6566 2067 6574 5f62 6163  .    def get_bac
+0000e440: 6b67 726f 756e 645f 7461 736b 2873 656c  kground_task(sel
+0000e450: 662c 206e 616d 653a 2073 7472 2920 2d3e  f, name: str) ->
+0000e460: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+0000e470: 6865 6d61 732e 4261 636b 6772 6f75 6e64  hemas.Background
+0000e480: 5461 736b 3a0a 2020 2020 2020 2020 2222  Task:.        ""
+0000e490: 2252 6574 7269 6576 6520 7570 6461 7465  "Retrieve update
+0000e4a0: 6420 696e 666f 726d 6174 696f 6e20 6f6e  d information on
+0000e4b0: 2061 2062 6163 6b67 726f 756e 6420 7461   a background ta
+0000e4c0: 736b 2062 6569 6e67 2065 7865 6375 7465  sk being execute
+0000e4d0: 642e 2222 220a 0a20 2020 2020 2020 2070  d."""..        p
+0000e4e0: 6174 6820 3d20 6622 6261 636b 6772 6f75  ath = f"backgrou
+0000e4f0: 6e64 2d74 6173 6b73 2f7b 6e61 6d65 7d22  nd-tasks/{name}"
+0000e500: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+0000e510: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+0000e520: 6420 6765 7474 696e 6720 6261 636b 6772  d getting backgr
+0000e530: 6f75 6e64 2074 6173 6b2e 206e 616d 653d  ound task. name=
+0000e540: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
+0000e550: 7265 7370 6f6e 7365 203d 2073 656c 662e  response = self.
+0000e560: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+0000e570: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
+0000e580: 6167 6529 0a20 2020 2020 2020 2072 6574  age).        ret
+0000e590: 7572 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e  urn mlrun.common
+0000e5a0: 2e73 6368 656d 6173 2e42 6163 6b67 726f  .schemas.Backgro
+0000e5b0: 756e 6454 6173 6b28 2a2a 7265 7370 6f6e  undTask(**respon
+0000e5c0: 7365 2e6a 736f 6e28 2929 0a0a 2020 2020  se.json())..    
+0000e5d0: 6465 6620 7265 6d6f 7465 5f73 7461 7475  def remote_statu
+0000e5e0: 7328 7365 6c66 2c20 7072 6f6a 6563 742c  s(self, project,
+0000e5f0: 206e 616d 652c 206b 696e 642c 2073 656c   name, kind, sel
+0000e600: 6563 746f 7229 3a0a 2020 2020 2020 2020  ector):.        
+0000e610: 2222 2252 6574 7269 6576 6520 7374 6174  """Retrieve stat
+0000e620: 7573 206f 6620 6120 6675 6e63 7469 6f6e  us of a function
+0000e630: 2062 6569 6e67 2065 7865 6375 7465 6420   being executed 
+0000e640: 7265 6d6f 7465 6c79 2028 7265 6c65 7661  remotely (releva
+0000e650: 6e74 2074 6f20 6060 6461 736b 6060 2066  nt to ``dask`` f
+0000e660: 756e 6374 696f 6e73 292e 0a0a 2020 2020  unctions)...    
+0000e670: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
+0000e680: 6374 3a20 5468 6520 7072 6f6a 6563 7420  ct: The project 
+0000e690: 6f66 2074 6865 2066 756e 6374 696f 6e0a  of the function.
+0000e6a0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+0000e6b0: 616d 653a 2054 6865 206e 616d 6520 6f66  ame: The name of
+0000e6c0: 2074 6865 2066 756e 6374 696f 6e0a 2020   the function.  
+0000e6d0: 2020 2020 2020 3a70 6172 616d 206b 696e        :param kin
+0000e6e0: 643a 2054 6865 206b 696e 6420 6f66 2074  d: The kind of t
+0000e6f0: 6865 2066 756e 6374 696f 6e2c 2063 7572  he function, cur
+0000e700: 7265 6e74 6c79 2060 6064 6173 6b60 6020  rently ``dask`` 
+0000e710: 6973 2073 7570 706f 7274 6564 2e0a 2020  is supported..  
+0000e720: 2020 2020 2020 3a70 6172 616d 2073 656c        :param sel
+0000e730: 6563 746f 723a 2053 656c 6563 746f 7220  ector: Selector 
+0000e740: 636c 6175 7365 2074 6f20 6265 2061 7070  clause to be app
+0000e750: 6c69 6564 2074 6f20 7468 6520 4b75 6265  lied to the Kube
+0000e760: 726e 6574 6573 2073 7461 7475 7320 7175  rnetes status qu
+0000e770: 6572 7920 746f 2066 696c 7465 7220 7468  ery to filter th
+0000e780: 6520 7265 7375 6c74 732e 0a20 2020 2020  e results..     
+0000e790: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0000e7a0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000e7b0: 2072 6571 203d 207b 226b 696e 6422 3a20   req = {"kind": 
+0000e7c0: 6b69 6e64 2c20 2273 656c 6563 746f 7222  kind, "selector"
+0000e7d0: 3a20 7365 6c65 6374 6f72 2c20 2270 726f  : selector, "pro
+0000e7e0: 6a65 6374 223a 2070 726f 6a65 6374 2c20  ject": project, 
+0000e7f0: 226e 616d 6522 3a20 6e61 6d65 7d0a 2020  "name": name}.  
+0000e800: 2020 2020 2020 2020 2020 7265 7370 203d            resp =
+0000e810: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+0000e820: 504f 5354 222c 2022 7374 6174 7573 2f66  POST", "status/f
+0000e830: 756e 6374 696f 6e22 2c20 6a73 6f6e 3d72  unction", json=r
+0000e840: 6571 290a 2020 2020 2020 2020 6578 6365  eq).        exce
+0000e850: 7074 204f 5345 7272 6f72 2061 7320 6572  pt OSError as er
+0000e860: 723a 0a20 2020 2020 2020 2020 2020 206c  r:.            l
+0000e870: 6f67 6765 722e 6572 726f 7228 6622 6572  ogger.error(f"er
+0000e880: 726f 7220 7374 6172 7469 6e67 2066 756e  ror starting fun
+0000e890: 6374 696f 6e3a 207b 6572 725f 746f 5f73  ction: {err_to_s
+0000e8a0: 7472 2865 7272 297d 2229 0a20 2020 2020  tr(err)}").     
+0000e8b0: 2020 2020 2020 2072 6169 7365 204f 5345         raise OSE
+0000e8c0: 7272 6f72 2866 2265 7272 6f72 3a20 6361  rror(f"error: ca
+0000e8d0: 6e6e 6f74 2073 7461 7274 2066 756e 6374  nnot start funct
+0000e8e0: 696f 6e2c 207b 6572 725f 746f 5f73 7472  ion, {err_to_str
+0000e8f0: 2865 7272 297d 2229 0a0a 2020 2020 2020  (err)}")..      
+0000e900: 2020 6966 206e 6f74 2072 6573 702e 6f6b    if not resp.ok
+0000e910: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+0000e920: 6767 6572 2e65 7272 6f72 2866 2262 6164  gger.error(f"bad
+0000e930: 2072 6573 7021 215c 6e7b 7265 7370 2e74   resp!!\n{resp.t
+0000e940: 6578 747d 2229 0a20 2020 2020 2020 2020  ext}").         
+0000e950: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000e960: 726f 7228 2262 6164 2066 756e 6374 696f  ror("bad functio
+0000e970: 6e20 7374 6174 7573 2072 6573 706f 6e73  n status respons
+0000e980: 6522 290a 0a20 2020 2020 2020 2072 6574  e")..        ret
+0000e990: 7572 6e20 7265 7370 2e6a 736f 6e28 295b  urn resp.json()[
+0000e9a0: 2264 6174 6122 5d0a 0a20 2020 2064 6566  "data"]..    def
+0000e9b0: 2073 7562 6d69 745f 6a6f 6228 0a20 2020   submit_job(.   
+0000e9c0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000e9d0: 2020 2072 756e 7370 6563 2c0a 2020 2020     runspec,.    
+0000e9e0: 2020 2020 7363 6865 6475 6c65 3a20 556e      schedule: Un
+0000e9f0: 696f 6e5b 7374 722c 206d 6c72 756e 2e63  ion[str, mlrun.c
+0000ea00: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5363  ommon.schemas.Sc
+0000ea10: 6865 6475 6c65 4372 6f6e 5472 6967 6765  heduleCronTrigge
+0000ea20: 725d 203d 204e 6f6e 652c 0a20 2020 2029  r] = None,.    )
+0000ea30: 3a0a 2020 2020 2020 2020 2222 2253 7562  :.        """Sub
+0000ea40: 6d69 7420 6120 6a6f 6220 666f 7220 7265  mit a job for re
+0000ea50: 6d6f 7465 2065 7865 6375 7469 6f6e 2e0a  mote execution..
+0000ea60: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000ea70: 7275 6e73 7065 633a 2054 6865 2072 756e  runspec: The run
+0000ea80: 7469 6d65 206f 626a 6563 7420 7370 6563  time object spec
+0000ea90: 2028 5461 736b 2920 746f 2065 7865 6375   (Task) to execu
+0000eaa0: 7465 2e0a 2020 2020 2020 2020 3a70 6172  te..        :par
+0000eab0: 616d 2073 6368 6564 756c 653a 2057 6865  am schedule: Whe
+0000eac0: 7468 6572 2074 6f20 7363 6865 6475 6c65  ther to schedule
+0000ead0: 2074 6869 7320 6a6f 6220 7573 696e 6720   this job using 
+0000eae0: 6120 4372 6f6e 2074 7269 6767 6572 2e20  a Cron trigger. 
+0000eaf0: 4966 206e 6f74 2073 7065 6369 6669 6564  If not specified
+0000eb00: 2c20 7468 6520 6a6f 6220 7769 6c6c 2062  , the job will b
+0000eb10: 6520 7375 626d 6974 7465 640a 2020 2020  e submitted.    
+0000eb20: 2020 2020 2020 2020 696d 6d65 6469 6174          immediat
+0000eb30: 656c 792e 0a20 2020 2020 2020 2022 2222  ely..        """
+0000eb40: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000eb50: 2020 2020 2020 2020 2020 2072 6571 203d             req =
+0000eb60: 207b 2274 6173 6b22 3a20 7275 6e73 7065   {"task": runspe
+0000eb70: 632e 746f 5f64 6963 7428 297d 0a20 2020  c.to_dict()}.   
+0000eb80: 2020 2020 2020 2020 2069 6620 7363 6865           if sche
+0000eb90: 6475 6c65 3a0a 2020 2020 2020 2020 2020  dule:.          
+0000eba0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000ebb0: 6e63 6528 7363 6865 6475 6c65 2c20 6d6c  nce(schedule, ml
+0000ebc0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000ebd0: 6173 2e53 6368 6564 756c 6543 726f 6e54  as.ScheduleCronT
+0000ebe0: 7269 6767 6572 293a 0a20 2020 2020 2020  rigger):.       
+0000ebf0: 2020 2020 2020 2020 2020 2020 2073 6368               sch
+0000ec00: 6564 756c 6520 3d20 7363 6865 6475 6c65  edule = schedule
+0000ec10: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
+0000ec20: 2020 2020 2020 2020 7265 715b 2273 6368          req["sch
+0000ec30: 6564 756c 6522 5d20 3d20 7363 6865 6475  edule"] = schedu
+0000ec40: 6c65 0a20 2020 2020 2020 2020 2020 2074  le.            t
+0000ec50: 696d 656f 7574 203d 2028 696e 7428 636f  imeout = (int(co
+0000ec60: 6e66 6967 2e73 7562 6d69 745f 7469 6d65  nfig.submit_time
+0000ec70: 6f75 7429 206f 7220 3132 3029 202b 2032  out) or 120) + 2
+0000ec80: 300a 2020 2020 2020 2020 2020 2020 7265  0.            re
+0000ec90: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
+0000eca0: 6c6c 2822 504f 5354 222c 2022 7375 626d  ll("POST", "subm
+0000ecb0: 6974 5f6a 6f62 222c 206a 736f 6e3d 7265  it_job", json=re
+0000ecc0: 712c 2074 696d 656f 7574 3d74 696d 656f  q, timeout=timeo
+0000ecd0: 7574 290a 0a20 2020 2020 2020 2065 7863  ut)..        exc
+0000ece0: 6570 7420 7265 7175 6573 7473 2e48 5454  ept requests.HTT
+0000ecf0: 5045 7272 6f72 2061 7320 6572 723a 0a20  PError as err:. 
+0000ed00: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0000ed10: 722e 6572 726f 7228 6622 6572 726f 7220  r.error(f"error 
+0000ed20: 7375 626d 6974 7469 6e67 2074 6173 6b3a  submitting task:
+0000ed30: 207b 6572 725f 746f 5f73 7472 2865 7272   {err_to_str(err
+0000ed40: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
+0000ed50: 2023 206e 6f74 2063 7265 6174 696e 6720   # not creating 
+0000ed60: 6120 6e65 7720 6578 6365 7074 696f 6e20  a new exception 
+0000ed70: 6865 7265 2c20 696e 206f 7264 6572 2074  here, in order t
+0000ed80: 6f20 6b65 6570 2074 6865 2072 6573 706f  o keep the respo
+0000ed90: 6e73 6520 616e 6420 7374 6174 7573 2063  nse and status c
+0000eda0: 6f64 6520 696e 2074 6865 2065 7863 6570  ode in the excep
+0000edb0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+0000edc0: 2072 6169 7365 0a0a 2020 2020 2020 2020   raise..        
+0000edd0: 6578 6365 7074 204f 5345 7272 6f72 2061  except OSError a
+0000ede0: 7320 6572 723a 0a20 2020 2020 2020 2020  s err:.         
+0000edf0: 2020 206c 6f67 6765 722e 6572 726f 7228     logger.error(
+0000ee00: 6622 6572 726f 7220 7375 626d 6974 7469  f"error submitti
+0000ee10: 6e67 2074 6173 6b3a 207b 6572 725f 746f  ng task: {err_to
+0000ee20: 5f73 7472 2865 7272 297d 2229 0a20 2020  _str(err)}").   
+0000ee30: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0000ee40: 5345 7272 6f72 2822 6572 726f 723a 2063  SError("error: c
+0000ee50: 616e 6e6f 7420 7375 626d 6974 2074 6173  annot submit tas
+0000ee60: 6b22 2920 6672 6f6d 2065 7272 0a0a 2020  k") from err..  
+0000ee70: 2020 2020 2020 6966 206e 6f74 2072 6573        if not res
+0000ee80: 702e 6f6b 3a0a 2020 2020 2020 2020 2020  p.ok:.          
+0000ee90: 2020 6c6f 6767 6572 2e65 7272 6f72 2866    logger.error(f
+0000eea0: 2262 6164 2072 6573 7021 215c 6e7b 7265  "bad resp!!\n{re
+0000eeb0: 7370 2e74 6578 747d 2229 0a20 2020 2020  sp.text}").     
+0000eec0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0000eed0: 7565 4572 726f 7228 6622 6261 6420 6675  ueError(f"bad fu
+0000eee0: 6e63 7469 6f6e 2072 756e 2072 6573 706f  nction run respo
+0000eef0: 6e73 652c 207b 7265 7370 2e74 6578 747d  nse, {resp.text}
+0000ef00: 2229 0a0a 2020 2020 2020 2020 7265 7370  ")..        resp
+0000ef10: 203d 2072 6573 702e 6a73 6f6e 2829 0a20   = resp.json(). 
+0000ef20: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000ef30: 7370 5b22 6461 7461 225d 0a0a 2020 2020  sp["data"]..    
+0000ef40: 6465 6620 7375 626d 6974 5f70 6970 656c  def submit_pipel
+0000ef50: 696e 6528 0a20 2020 2020 2020 2073 656c  ine(.        sel
+0000ef60: 662c 0a20 2020 2020 2020 2070 726f 6a65  f,.        proje
+0000ef70: 6374 2c0a 2020 2020 2020 2020 7069 7065  ct,.        pipe
+0000ef80: 6c69 6e65 2c0a 2020 2020 2020 2020 6172  line,.        ar
+0000ef90: 6775 6d65 6e74 733d 4e6f 6e65 2c0a 2020  guments=None,.  
+0000efa0: 2020 2020 2020 6578 7065 7269 6d65 6e74        experiment
+0000efb0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2072  =None,.        r
+0000efc0: 756e 3d4e 6f6e 652c 0a20 2020 2020 2020  un=None,.       
+0000efd0: 206e 616d 6573 7061 6365 3d4e 6f6e 652c   namespace=None,
+0000efe0: 0a20 2020 2020 2020 2061 7274 6966 6163  .        artifac
+0000eff0: 745f 7061 7468 3d4e 6f6e 652c 0a20 2020  t_path=None,.   
+0000f000: 2020 2020 206f 7073 3d4e 6f6e 652c 0a20       ops=None,. 
+0000f010: 2020 2020 2020 2063 6c65 616e 7570 5f74         cleanup_t
+0000f020: 746c 3d4e 6f6e 652c 0a20 2020 2029 3a0a  tl=None,.    ):.
+0000f030: 2020 2020 2020 2020 2222 2253 7562 6d69          """Submi
+0000f040: 7420 6120 4b46 5020 7069 7065 6c69 6e65  t a KFP pipeline
+0000f050: 2066 6f72 2065 7865 6375 7469 6f6e 2e0a   for execution..
+0000f060: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000f070: 7072 6f6a 6563 743a 2054 6865 2070 726f  project: The pro
+0000f080: 6a65 6374 206f 6620 7468 6520 7069 7065  ject of the pipe
+0000f090: 6c69 6e65 0a20 2020 2020 2020 203a 7061  line.        :pa
+0000f0a0: 7261 6d20 7069 7065 6c69 6e65 3a20 5069  ram pipeline: Pi
+0000f0b0: 7065 6c69 6e65 2066 756e 6374 696f 6e20  peline function 
+0000f0c0: 6f72 2070 6174 6820 746f 202e 7961 6d6c  or path to .yaml
+0000f0d0: 2f2e 7a69 7020 7069 7065 6c69 6e65 2066  /.zip pipeline f
+0000f0e0: 696c 652e 0a20 2020 2020 2020 203a 7061  ile..        :pa
+0000f0f0: 7261 6d20 6172 6775 6d65 6e74 733a 2041  ram arguments: A
+0000f100: 2064 6963 7469 6f6e 6172 7920 6f66 2061   dictionary of a
+0000f110: 7267 756d 656e 7473 2074 6f20 7061 7373  rguments to pass
+0000f120: 2074 6f20 7468 6520 7069 7065 6c69 6e65   to the pipeline
+0000f130: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000f140: 2065 7870 6572 696d 656e 743a 2041 206e   experiment: A n
+0000f150: 616d 6520 746f 2061 7373 6967 6e20 666f  ame to assign fo
+0000f160: 7220 7468 6520 7370 6563 6966 6963 2065  r the specific e
+0000f170: 7870 6572 696d 656e 742e 0a20 2020 2020  xperiment..     
+0000f180: 2020 203a 7061 7261 6d20 7275 6e3a 2041     :param run: A
+0000f190: 206e 616d 6520 666f 7220 7468 6973 2073   name for this s
+0000f1a0: 7065 6369 6669 6320 7275 6e2e 0a20 2020  pecific run..   
+0000f1b0: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
+0000f1c0: 7370 6163 653a 204b 7562 6572 6e65 7465  space: Kubernete
+0000f1d0: 7320 6e61 6d65 7370 6163 6520 746f 2065  s namespace to e
+0000f1e0: 7865 6375 7465 2074 6865 2070 6970 656c  xecute the pipel
+0000f1f0: 696e 6520 696e 2e0a 2020 2020 2020 2020  ine in..        
+0000f200: 3a70 6172 616d 2061 7274 6966 6163 745f  :param artifact_
+0000f210: 7061 7468 3a20 4120 7061 7468 2074 6f20  path: A path to 
+0000f220: 6172 7469 6661 6374 7320 7573 6564 2062  artifacts used b
+0000f230: 7920 7468 6973 2070 6970 656c 696e 652e  y this pipeline.
+0000f240: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000f250: 6f70 733a 2054 7261 6e73 666f 726d 6572  ops: Transformer
+0000f260: 7320 746f 2061 7070 6c79 206f 6e20 616c  s to apply on al
+0000f270: 6c20 6f70 7320 696e 2074 6865 2070 6970  l ops in the pip
+0000f280: 656c 696e 652e 0a20 2020 2020 2020 203a  eline..        :
+0000f290: 7061 7261 6d20 636c 6561 6e75 705f 7474  param cleanup_tt
+0000f2a0: 6c3a 2070 6970 656c 696e 6520 636c 6561  l: pipeline clea
+0000f2b0: 6e75 7020 7474 6c20 696e 2073 6563 7320  nup ttl in secs 
+0000f2c0: 2874 696d 6520 746f 2077 6169 7420 6166  (time to wait af
+0000f2d0: 7465 7220 776f 726b 666c 6f77 2063 6f6d  ter workflow com
+0000f2e0: 706c 6574 696f 6e2c 2061 7420 7768 6963  pletion, at whic
+0000f2f0: 6820 706f 696e 7420 7468 650a 2020 2020  h point the.    
+0000f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f310: 2020 2020 2020 2020 776f 726b 666c 6f77          workflow
+0000f320: 2061 6e64 2061 6c6c 2069 7473 2072 6573   and all its res
+0000f330: 6f75 7263 6573 2061 7265 2064 656c 6574  ources are delet
+0000f340: 6564 290a 2020 2020 2020 2020 2222 220a  ed).        """.
+0000f350: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0000f360: 7374 616e 6365 2870 6970 656c 696e 652c  stance(pipeline,
+0000f370: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+0000f380: 2020 2070 6970 655f 6669 6c65 203d 2070     pipe_file = p
+0000f390: 6970 656c 696e 650a 2020 2020 2020 2020  ipeline.        
+0000f3a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000f3b0: 2020 7069 7065 5f66 696c 6520 3d20 7465    pipe_file = te
+0000f3c0: 6d70 6669 6c65 2e4e 616d 6564 5465 6d70  mpfile.NamedTemp
+0000f3d0: 6f72 6172 7946 696c 6528 7375 6666 6978  oraryFile(suffix
+0000f3e0: 3d22 2e79 616d 6c22 2c20 6465 6c65 7465  =".yaml", delete
+0000f3f0: 3d46 616c 7365 292e 6e61 6d65 0a20 2020  =False).name.   
+0000f400: 2020 2020 2020 2020 2063 6f6e 6620 3d20           conf = 
+0000f410: 6e65 775f 7069 7065 5f6d 6574 6164 6174  new_pipe_metadat
+0000f420: 6128 0a20 2020 2020 2020 2020 2020 2020  a(.             
+0000f430: 2020 2061 7274 6966 6163 745f 7061 7468     artifact_path
+0000f440: 3d61 7274 6966 6163 745f 7061 7468 2c0a  =artifact_path,.
+0000f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f460: 636c 6561 6e75 705f 7474 6c3d 636c 6561  cleanup_ttl=clea
+0000f470: 6e75 705f 7474 6c2c 0a20 2020 2020 2020  nup_ttl,.       
+0000f480: 2020 2020 2020 2020 206f 705f 7472 616e           op_tran
+0000f490: 7366 6f72 6d65 7273 3d6f 7073 2c0a 2020  sformers=ops,.  
+0000f4a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000f4b0: 2020 2020 2020 2020 6b66 702e 636f 6d70          kfp.comp
+0000f4c0: 696c 6572 2e43 6f6d 7069 6c65 7228 292e  iler.Compiler().
+0000f4d0: 636f 6d70 696c 6528 0a20 2020 2020 2020  compile(.       
+0000f4e0: 2020 2020 2020 2020 2070 6970 656c 696e           pipelin
+0000f4f0: 652c 2070 6970 655f 6669 6c65 2c20 7479  e, pipe_file, ty
+0000f500: 7065 5f63 6865 636b 3d46 616c 7365 2c20  pe_check=False, 
+0000f510: 7069 7065 6c69 6e65 5f63 6f6e 663d 636f  pipeline_conf=co
+0000f520: 6e66 0a20 2020 2020 2020 2020 2020 2029  nf.            )
+0000f530: 0a0a 2020 2020 2020 2020 6966 2070 6970  ..        if pip
+0000f540: 655f 6669 6c65 2e65 6e64 7377 6974 6828  e_file.endswith(
+0000f550: 222e 7961 6d6c 2229 3a0a 2020 2020 2020  ".yaml"):.      
+0000f560: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+0000f570: 7b22 636f 6e74 656e 742d 7479 7065 223a  {"content-type":
+0000f580: 2022 6170 706c 6963 6174 696f 6e2f 7961   "application/ya
+0000f590: 6d6c 227d 0a20 2020 2020 2020 2065 6c69  ml"}.        eli
+0000f5a0: 6620 7069 7065 5f66 696c 652e 656e 6473  f pipe_file.ends
+0000f5b0: 7769 7468 2822 2e7a 6970 2229 3a0a 2020  with(".zip"):.  
+0000f5c0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+0000f5d0: 7320 3d20 7b22 636f 6e74 656e 742d 7479  s = {"content-ty
+0000f5e0: 7065 223a 2022 6170 706c 6963 6174 696f  pe": "applicatio
+0000f5f0: 6e2f 7a69 7022 7d0a 2020 2020 2020 2020  n/zip"}.        
+0000f600: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000f610: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000f620: 6f72 2822 7069 7065 6c69 6e65 2066 696c  or("pipeline fil
+0000f630: 6520 6d75 7374 2062 6520 2e79 616d 6c20  e must be .yaml 
+0000f640: 6f72 202e 7a69 7022 290a 2020 2020 2020  or .zip").      
+0000f650: 2020 6966 2061 7267 756d 656e 7473 3a0a    if arguments:.
+0000f660: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000f670: 6f74 2069 7369 6e73 7461 6e63 6528 6172  ot isinstance(ar
+0000f680: 6775 6d65 6e74 732c 2064 6963 7429 3a0a  guments, dict):.
+0000f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6a0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0000f6b0: 2822 6172 6775 6d65 6e74 7320 6d75 7374  ("arguments must
+0000f6c0: 2062 6520 6469 6374 2074 7970 6522 290a   be dict type").
+0000f6d0: 2020 2020 2020 2020 2020 2020 6865 6164              head
+0000f6e0: 6572 735b 6d6c 7275 6e2e 636f 6d6d 6f6e  ers[mlrun.common
+0000f6f0: 2e73 6368 656d 6173 2e48 6561 6465 724e  .schemas.HeaderN
+0000f700: 616d 6573 2e70 6970 656c 696e 655f 6172  ames.pipeline_ar
+0000f710: 6775 6d65 6e74 735d 203d 2073 7472 280a  guments] = str(.
+0000f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f730: 6172 6775 6d65 6e74 730a 2020 2020 2020  arguments.      
+0000f740: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000f750: 2069 6620 6e6f 7420 7061 7468 2e69 7366   if not path.isf
+0000f760: 696c 6528 7069 7065 5f66 696c 6529 3a0a  ile(pipe_file):.
+0000f770: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f780: 6520 4f53 4572 726f 7228 6622 6669 6c65  e OSError(f"file
+0000f790: 207b 7069 7065 5f66 696c 657d 2064 6f65   {pipe_file} doe
+0000f7a0: 736e 7420 6578 6973 7422 290a 2020 2020  snt exist").    
+0000f7b0: 2020 2020 7769 7468 206f 7065 6e28 7069      with open(pi
+0000f7c0: 7065 5f66 696c 652c 2022 7262 2229 2061  pe_file, "rb") a
+0000f7d0: 7320 6670 3a0a 2020 2020 2020 2020 2020  s fp:.          
+0000f7e0: 2020 6461 7461 203d 2066 702e 7265 6164    data = fp.read
+0000f7f0: 2829 0a20 2020 2020 2020 2069 6620 6e6f  ().        if no
+0000f800: 7420 6973 696e 7374 616e 6365 2870 6970  t isinstance(pip
+0000f810: 656c 696e 652c 2073 7472 293a 0a20 2020  eline, str):.   
+0000f820: 2020 2020 2020 2020 2072 656d 6f76 6528           remove(
+0000f830: 7069 7065 5f66 696c 6529 0a0a 2020 2020  pipe_file)..    
+0000f840: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000f850: 2020 2020 2070 6172 616d 7320 3d20 7b22       params = {"
+0000f860: 6e61 6d65 7370 6163 6522 3a20 6e61 6d65  namespace": name
+0000f870: 7370 6163 652c 2022 6578 7065 7269 6d65  space, "experime
+0000f880: 6e74 223a 2065 7870 6572 696d 656e 742c  nt": experiment,
+0000f890: 2022 7275 6e22 3a20 7275 6e7d 0a20 2020   "run": run}.   
+0000f8a0: 2020 2020 2020 2020 2072 6573 7020 3d20           resp = 
+0000f8b0: 7365 6c66 2e61 7069 5f63 616c 6c28 0a20  self.api_call(. 
+0000f8c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000f8d0: 504f 5354 222c 0a20 2020 2020 2020 2020  POST",.         
+0000f8e0: 2020 2020 2020 2066 2270 726f 6a65 6374         f"project
+0000f8f0: 732f 7b70 726f 6a65 6374 7d2f 7069 7065  s/{project}/pipe
+0000f900: 6c69 6e65 7322 2c0a 2020 2020 2020 2020  lines",.        
+0000f910: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
+0000f920: 6172 616d 732c 0a20 2020 2020 2020 2020  arams,.         
+0000f930: 2020 2020 2020 2074 696d 656f 7574 3d32         timeout=2
+0000f940: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000f950: 2020 2062 6f64 793d 6461 7461 2c0a 2020     body=data,.  
+0000f960: 2020 2020 2020 2020 2020 2020 2020 6865                he
+0000f970: 6164 6572 733d 6865 6164 6572 732c 0a20  aders=headers,. 
+0000f980: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000f990: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
+0000f9a0: 726f 7220 6173 2065 7272 3a0a 2020 2020  ror as err:.    
+0000f9b0: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
+0000f9c0: 7272 6f72 2866 2265 7272 6f72 2063 616e  rror(f"error can
+0000f9d0: 6e6f 7420 7375 626d 6974 2070 6970 656c  not submit pipel
+0000f9e0: 696e 653a 207b 6572 725f 746f 5f73 7472  ine: {err_to_str
+0000f9f0: 2865 7272 297d 2229 0a20 2020 2020 2020  (err)}").       
+0000fa00: 2020 2020 2072 6169 7365 204f 5345 7272       raise OSErr
+0000fa10: 6f72 2866 2265 7272 6f72 3a20 6361 6e6e  or(f"error: cann
+0000fa20: 6f74 2063 616e 6e6f 7420 7375 626d 6974  ot cannot submit
+0000fa30: 2070 6970 656c 696e 652c 207b 6572 725f   pipeline, {err_
+0000fa40: 746f 5f73 7472 2865 7272 297d 2229 0a0a  to_str(err)}")..
+0000fa50: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+0000fa60: 6573 702e 6f6b 3a0a 2020 2020 2020 2020  esp.ok:.        
+0000fa70: 2020 2020 6c6f 6767 6572 2e65 7272 6f72      logger.error
+0000fa80: 2866 2262 6164 2072 6573 7021 215c 6e7b  (f"bad resp!!\n{
+0000fa90: 7265 7370 2e74 6578 747d 2229 0a20 2020  resp.text}").   
+0000faa0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000fab0: 616c 7565 4572 726f 7228 6622 6261 6420  alueError(f"bad 
+0000fac0: 7375 626d 6974 2070 6970 656c 696e 6520  submit pipeline 
+0000fad0: 7265 7370 6f6e 7365 2c20 7b72 6573 702e  response, {resp.
+0000fae0: 7465 7874 7d22 290a 0a20 2020 2020 2020  text}")..       
+0000faf0: 2072 6573 7020 3d20 7265 7370 2e6a 736f   resp = resp.jso
+0000fb00: 6e28 290a 2020 2020 2020 2020 6c6f 6767  n().        logg
+0000fb10: 6572 2e69 6e66 6f28 6622 7375 626d 6974  er.info(f"submit
+0000fb20: 7465 6420 7069 7065 6c69 6e65 207b 7265  ted pipeline {re
+0000fb30: 7370 5b27 6e61 6d65 275d 7d20 6964 3d7b  sp['name']} id={
+0000fb40: 7265 7370 5b27 6964 275d 7d22 290a 2020  resp['id']}").  
+0000fb50: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+0000fb60: 705b 2269 6422 5d0a 0a20 2020 2064 6566  p["id"]..    def
+0000fb70: 206c 6973 745f 7069 7065 6c69 6e65 7328   list_pipelines(
+0000fb80: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0000fb90: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
+0000fba0: 7374 722c 0a20 2020 2020 2020 206e 616d  str,.        nam
+0000fbb0: 6573 7061 6365 3a20 7374 7220 3d20 4e6f  espace: str = No
+0000fbc0: 6e65 2c0a 2020 2020 2020 2020 736f 7274  ne,.        sort
+0000fbd0: 5f62 793a 2073 7472 203d 2022 222c 0a20  _by: str = "",. 
+0000fbe0: 2020 2020 2020 2070 6167 655f 746f 6b65         page_toke
+0000fbf0: 6e3a 2073 7472 203d 2022 222c 0a20 2020  n: str = "",.   
+0000fc00: 2020 2020 2066 696c 7465 725f 3a20 7374       filter_: st
+0000fc10: 7220 3d20 2222 2c0a 2020 2020 2020 2020  r = "",.        
+0000fc20: 666f 726d 6174 5f3a 2055 6e69 6f6e 5b0a  format_: Union[.
+0000fc30: 2020 2020 2020 2020 2020 2020 7374 722c              str,
+0000fc40: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+0000fc50: 6865 6d61 732e 5069 7065 6c69 6e65 7346  hemas.PipelinesF
+0000fc60: 6f72 6d61 740a 2020 2020 2020 2020 5d20  ormat.        ] 
+0000fc70: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+0000fc80: 6368 656d 6173 2e50 6970 656c 696e 6573  chemas.Pipelines
+0000fc90: 466f 726d 6174 2e6d 6574 6164 6174 615f  Format.metadata_
+0000fca0: 6f6e 6c79 2c0a 2020 2020 2020 2020 7061  only,.        pa
+0000fcb0: 6765 5f73 697a 653a 2069 6e74 203d 204e  ge_size: int = N
+0000fcc0: 6f6e 652c 0a20 2020 2029 202d 3e20 6d6c  one,.    ) -> ml
+0000fcd0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000fce0: 6173 2e50 6970 656c 696e 6573 4f75 7470  as.PipelinesOutp
+0000fcf0: 7574 3a0a 2020 2020 2020 2020 2222 2252  ut:.        """R
+0000fd00: 6574 7269 6576 6520 6120 6c69 7374 206f  etrieve a list o
+0000fd10: 6620 4b46 5020 7069 7065 6c69 6e65 732e  f KFP pipelines.
+0000fd20: 2054 6869 7320 6675 6e63 7469 6f6e 2063   This function c
+0000fd30: 616e 2062 6520 696e 766f 6b65 6420 746f  an be invoked to
+0000fd40: 2067 6574 2061 6c6c 2070 6970 656c 696e   get all pipelin
+0000fd50: 6573 2066 726f 6d20 616c 6c20 7072 6f6a  es from all proj
+0000fd60: 6563 7473 2c0a 2020 2020 2020 2020 6279  ects,.        by
+0000fd70: 2073 7065 6369 6679 696e 6720 6060 7072   specifying ``pr
+0000fd80: 6f6a 6563 743d 2a60 602c 2069 6e20 7768  oject=*``, in wh
+0000fd90: 6963 6820 6361 7365 2070 6167 696e 6174  ich case paginat
+0000fda0: 696f 6e20 6361 6e20 6265 2075 7365 6420  ion can be used 
+0000fdb0: 616e 6420 7468 6520 7661 7269 6f75 7320  and the various 
+0000fdc0: 736f 7274 696e 6720 616e 6420 7061 6769  sorting and pagi
+0000fdd0: 6e61 7469 6f6e 0a20 2020 2020 2020 2070  nation.        p
+0000fde0: 726f 7065 7274 6965 7320 6361 6e20 6265  roperties can be
+0000fdf0: 2061 7070 6c69 6564 2e20 4966 2061 2073   applied. If a s
+0000fe00: 7065 6369 6669 6320 7072 6f6a 6563 7420  pecific project 
+0000fe10: 6973 2072 6571 7565 7374 6564 2c20 7468  is requested, th
+0000fe20: 656e 2074 6865 2070 6167 696e 6174 696f  en the paginatio
+0000fe30: 6e20 6f70 7469 6f6e 7320 6361 6e6e 6f74  n options cannot
+0000fe40: 2062 650a 2020 2020 2020 2020 7573 6564   be.        used
+0000fe50: 2061 6e64 2070 6167 696e 6174 696f 6e20   and pagination 
+0000fe60: 6973 206e 6f74 2061 7070 6c69 6564 2e0a  is not applied..
+0000fe70: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000fe80: 7072 6f6a 6563 743a 2050 726f 6a65 6374  project: Project
+0000fe90: 206e 616d 652e 2043 616e 2062 6520 6060   name. Can be ``
+0000fea0: 2a60 6020 666f 7220 7175 6572 7920 6163  *`` for query ac
+0000feb0: 726f 7373 2061 6c6c 2070 726f 6a65 6374  ross all project
+0000fec0: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+0000fed0: 6d20 6e61 6d65 7370 6163 653a 204b 7562  m namespace: Kub
+0000fee0: 6572 6e65 7465 7320 6e61 6d65 7370 6163  ernetes namespac
+0000fef0: 6520 696e 2077 6869 6368 2074 6865 2070  e in which the p
+0000ff00: 6970 656c 696e 6573 2061 7265 2065 7865  ipelines are exe
+0000ff10: 6375 7469 6e67 2e0a 2020 2020 2020 2020  cuting..        
+0000ff20: 3a70 6172 616d 2073 6f72 745f 6279 3a20  :param sort_by: 
+0000ff30: 4669 656c 6420 746f 2073 6f72 7420 7468  Field to sort th
+0000ff40: 6520 7265 7375 6c74 7320 6279 2e0a 2020  e results by..  
+0000ff50: 2020 2020 2020 3a70 6172 616d 2070 6167        :param pag
+0000ff60: 655f 746f 6b65 6e3a 2055 7365 2066 6f72  e_token: Use for
+0000ff70: 2070 6167 696e 6174 696f 6e2c 2074 6f20   pagination, to 
+0000ff80: 7265 7472 6965 7665 206e 6578 7420 7061  retrieve next pa
+0000ff90: 6765 2e0a 2020 2020 2020 2020 3a70 6172  ge..        :par
+0000ffa0: 616d 2066 696c 7465 725f 3a20 4b75 6265  am filter_: Kube
+0000ffb0: 726e 6574 6573 2066 696c 7465 7220 746f  rnetes filter to
+0000ffc0: 2061 7070 6c79 2074 6f20 7468 6520 7175   apply to the qu
+0000ffd0: 6572 792c 2063 616e 2062 6520 7573 6564  ery, can be used
+0000ffe0: 2074 6f20 6669 6c74 6572 206f 6e20 7370   to filter on sp
+0000fff0: 6563 6966 6963 206f 626a 6563 7420 6669  ecific object fi
+00010000: 656c 6473 2e0a 2020 2020 2020 2020 3a70  elds..        :p
+00010010: 6172 616d 2066 6f72 6d61 745f 3a20 5265  aram format_: Re
+00010020: 7375 6c74 2066 6f72 6d61 742e 2043 616e  sult format. Can
+00010030: 2062 6520 6f6e 6520 6f66 3a0a 0a20 2020   be one of:..   
+00010040: 2020 2020 2020 2020 202d 2060 6066 756c           - ``ful
+00010050: 6c60 6020 2d20 7265 7475 726e 2074 6865  l`` - return the
+00010060: 2066 756c 6c20 6f62 6a65 6374 732e 0a20   full objects.. 
+00010070: 2020 2020 2020 2020 2020 202d 2060 606d             - ``m
+00010080: 6574 6164 6174 615f 6f6e 6c79 6060 2028  etadata_only`` (
+00010090: 6465 6661 756c 7429 202d 2072 6574 7572  default) - retur
+000100a0: 6e20 6a75 7374 206d 6574 6164 6174 6120  n just metadata 
+000100b0: 6f66 2074 6865 2070 6970 656c 696e 6573  of the pipelines
+000100c0: 206f 626a 6563 7473 2e0a 2020 2020 2020   objects..      
+000100d0: 2020 2020 2020 2d20 6060 6e61 6d65 5f6f        - ``name_o
+000100e0: 6e6c 7960 6020 2d20 7265 7475 726e 206a  nly`` - return j
+000100f0: 7573 7420 7468 6520 6e61 6d65 7320 6f66  ust the names of
+00010100: 2074 6865 2070 6970 656c 696e 6520 6f62   the pipeline ob
+00010110: 6a65 6374 732e 0a20 2020 2020 2020 203a  jects..        :
+00010120: 7061 7261 6d20 7061 6765 5f73 697a 653a  param page_size:
+00010130: 2053 697a 6520 6f66 2061 2073 696e 676c   Size of a singl
+00010140: 6520 7061 6765 2077 6865 6e20 6170 706c  e page when appl
+00010150: 7969 6e67 2070 6167 696e 6174 696f 6e2e  ying pagination.
+00010160: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00010170: 2020 2020 2020 6966 2070 726f 6a65 6374        if project
+00010180: 2021 3d20 222a 2220 616e 6420 2870 6167   != "*" and (pag
+00010190: 655f 746f 6b65 6e20 6f72 2070 6167 655f  e_token or page_
+000101a0: 7369 7a65 293a 0a20 2020 2020 2020 2020  size):.         
+000101b0: 2020 2072 6169 7365 206d 6c72 756e 2e65     raise mlrun.e
+000101c0: 7272 6f72 732e 4d4c 5275 6e49 6e76 616c  rrors.MLRunInval
+000101d0: 6964 4172 6775 6d65 6e74 4572 726f 7228  idArgumentError(
+000101e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000101f0: 2022 4669 6c74 6572 696e 6720 6279 2070   "Filtering by p
+00010200: 726f 6a65 6374 2063 616e 206e 6f74 2062  roject can not b
+00010210: 6520 7573 6564 2074 6f67 6574 6865 7220  e used together 
+00010220: 7769 7468 2070 6167 696e 6174 696f 6e22  with pagination"
+00010230: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00010240: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+00010250: 7b0a 2020 2020 2020 2020 2020 2020 226e  {.            "n
+00010260: 616d 6573 7061 6365 223a 206e 616d 6573  amespace": names
+00010270: 7061 6365 2c0a 2020 2020 2020 2020 2020  pace,.          
+00010280: 2020 2273 6f72 745f 6279 223a 2073 6f72    "sort_by": sor
+00010290: 745f 6279 2c0a 2020 2020 2020 2020 2020  t_by,.          
+000102a0: 2020 2270 6167 655f 746f 6b65 6e22 3a20    "page_token": 
+000102b0: 7061 6765 5f74 6f6b 656e 2c0a 2020 2020  page_token,.    
+000102c0: 2020 2020 2020 2020 2266 696c 7465 7222          "filter"
+000102d0: 3a20 6669 6c74 6572 5f2c 0a20 2020 2020  : filter_,.     
+000102e0: 2020 2020 2020 2022 666f 726d 6174 223a         "format":
+000102f0: 2066 6f72 6d61 745f 2c0a 2020 2020 2020   format_,.      
+00010300: 2020 2020 2020 2270 6167 655f 7369 7a65        "page_size
+00010310: 223a 2070 6167 655f 7369 7a65 2c0a 2020  ": page_size,.  
+00010320: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00010330: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+00010340: 2066 2246 6169 6c65 6420 6c69 7374 696e   f"Failed listin
+00010350: 6720 7069 7065 6c69 6e65 732c 2071 7565  g pipelines, que
+00010360: 7279 3a20 7b70 6172 616d 737d 220a 2020  ry: {params}".  
+00010370: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
+00010380: 2073 656c 662e 6170 695f 6361 6c6c 280a   self.api_call(.
+00010390: 2020 2020 2020 2020 2020 2020 2247 4554              "GET
+000103a0: 222c 2066 2270 726f 6a65 6374 732f 7b70  ", f"projects/{p
+000103b0: 726f 6a65 6374 7d2f 7069 7065 6c69 6e65  roject}/pipeline
+000103c0: 7322 2c20 6572 726f 725f 6d65 7373 6167  s", error_messag
+000103d0: 652c 2070 6172 616d 733d 7061 7261 6d73  e, params=params
+000103e0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+000103f0: 2020 2072 6574 7572 6e20 6d6c 7275 6e2e     return mlrun.
+00010400: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e50  common.schemas.P
+00010410: 6970 656c 696e 6573 4f75 7470 7574 282a  ipelinesOutput(*
+00010420: 2a72 6573 706f 6e73 652e 6a73 6f6e 2829  *response.json()
+00010430: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
+00010440: 6970 656c 696e 6528 0a20 2020 2020 2020  ipeline(.       
+00010450: 2073 656c 662c 0a20 2020 2020 2020 2072   self,.        r
+00010460: 756e 5f69 643a 2073 7472 2c0a 2020 2020  un_id: str,.    
+00010470: 2020 2020 6e61 6d65 7370 6163 653a 2073      namespace: s
+00010480: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
+00010490: 2020 2074 696d 656f 7574 3a20 696e 7420     timeout: int 
+000104a0: 3d20 3130 2c0a 2020 2020 2020 2020 666f  = 10,.        fo
+000104b0: 726d 6174 5f3a 2055 6e69 6f6e 5b0a 2020  rmat_: Union[.  
+000104c0: 2020 2020 2020 2020 2020 7374 722c 206d            str, m
+000104d0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+000104e0: 6d61 732e 5069 7065 6c69 6e65 7346 6f72  mas.PipelinesFor
+000104f0: 6d61 740a 2020 2020 2020 2020 5d20 3d20  mat.        ] = 
+00010500: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00010510: 656d 6173 2e50 6970 656c 696e 6573 466f  emas.PipelinesFo
+00010520: 726d 6174 2e73 756d 6d61 7279 2c0a 2020  rmat.summary,.  
+00010530: 2020 2020 2020 7072 6f6a 6563 743a 2073        project: s
+00010540: 7472 203d 204e 6f6e 652c 0a20 2020 2029  tr = None,.    )
+00010550: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00010560: 7269 6576 6520 6465 7461 696c 7320 6f66  rieve details of
+00010570: 2061 2073 7065 6369 6669 6320 7069 7065   a specific pipe
+00010580: 6c69 6e65 2075 7369 6e67 2069 7473 2072  line using its r
+00010590: 756e 2049 4420 2861 7320 7072 6f76 6964  un ID (as provid
+000105a0: 6564 2077 6865 6e20 7468 6520 7069 7065  ed when the pipe
+000105b0: 6c69 6e65 2077 6173 2065 7865 6375 7465  line was execute
+000105c0: 6429 2e22 2222 0a0a 2020 2020 2020 2020  d)."""..        
+000105d0: 7061 7261 6d73 203d 207b 7d0a 2020 2020  params = {}.    
+000105e0: 2020 2020 6966 206e 616d 6573 7061 6365      if namespace
+000105f0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00010600: 7261 6d73 5b22 6e61 6d65 7370 6163 6522  rams["namespace"
+00010610: 5d20 3d20 6e61 6d65 7370 6163 650a 2020  ] = namespace.  
+00010620: 2020 2020 2020 7061 7261 6d73 5b22 666f        params["fo
+00010630: 726d 6174 225d 203d 2066 6f72 6d61 745f  rmat"] = format_
+00010640: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00010650: 5f70 6174 6820 3d20 7072 6f6a 6563 7420  _path = project 
+00010660: 6966 2070 726f 6a65 6374 2065 6c73 6520  if project else 
+00010670: 222a 220a 2020 2020 2020 2020 7265 7370  "*".        resp
+00010680: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+00010690: 280a 2020 2020 2020 2020 2020 2020 2247  (.            "G
+000106a0: 4554 222c 0a20 2020 2020 2020 2020 2020  ET",.           
+000106b0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+000106c0: 6a65 6374 5f70 6174 687d 2f70 6970 656c  ject_path}/pipel
+000106d0: 696e 6573 2f7b 7275 6e5f 6964 7d22 2c0a  ines/{run_id}",.
+000106e0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+000106f0: 6d73 3d70 6172 616d 732c 0a20 2020 2020  ms=params,.     
+00010700: 2020 2020 2020 2074 696d 656f 7574 3d74         timeout=t
+00010710: 696d 656f 7574 2c0a 2020 2020 2020 2020  imeout,.        
+00010720: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00010730: 7420 7265 7370 2e6f 6b3a 0a20 2020 2020  t resp.ok:.     
+00010740: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
+00010750: 726f 7228 6622 6261 6420 7265 7370 2121  ror(f"bad resp!!
+00010760: 5c6e 7b72 6573 702e 7465 7874 7d22 290a  \n{resp.text}").
+00010770: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00010780: 6520 5661 6c75 6545 7272 6f72 2866 2262  e ValueError(f"b
+00010790: 6164 2067 6574 2070 6970 656c 696e 6520  ad get pipeline 
+000107a0: 7265 7370 6f6e 7365 2c20 7b72 6573 702e  response, {resp.
+000107b0: 7465 7874 7d22 290a 0a20 2020 2020 2020  text}")..       
+000107c0: 2072 6574 7572 6e20 7265 7370 2e6a 736f   return resp.jso
+000107d0: 6e28 290a 0a20 2020 2040 7374 6174 6963  n()..    @static
+000107e0: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+000107f0: 7265 736f 6c76 655f 7265 6665 7265 6e63  resolve_referenc
+00010800: 6528 7461 672c 2075 6964 293a 0a20 2020  e(tag, uid):.   
+00010810: 2020 2020 2069 6620 7569 6420 616e 6420       if uid and 
+00010820: 7461 673a 0a20 2020 2020 2020 2020 2020  tag:.           
+00010830: 2072 6169 7365 204d 4c52 756e 496e 7661   raise MLRunInva
+00010840: 6c69 6441 7267 756d 656e 7445 7272 6f72  lidArgumentError
+00010850: 2822 626f 7468 2075 6964 2061 6e64 2074  ("both uid and t
+00010860: 6167 2077 6572 6520 7072 6f76 6964 6564  ag were provided
+00010870: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+00010880: 6e20 7569 6420 6f72 2074 6167 206f 7220  n uid or tag or 
+00010890: 226c 6174 6573 7422 0a0a 2020 2020 6465  "latest"..    de
+000108a0: 6620 6372 6561 7465 5f66 6561 7475 7265  f create_feature
+000108b0: 5f73 6574 280a 2020 2020 2020 2020 7365  _set(.        se
+000108c0: 6c66 2c0a 2020 2020 2020 2020 6665 6174  lf,.        feat
+000108d0: 7572 655f 7365 743a 2055 6e69 6f6e 5b64  ure_set: Union[d
+000108e0: 6963 742c 206d 6c72 756e 2e63 6f6d 6d6f  ict, mlrun.commo
+000108f0: 6e2e 7363 6865 6d61 732e 4665 6174 7572  n.schemas.Featur
+00010900: 6553 6574 2c20 4665 6174 7572 6553 6574  eSet, FeatureSet
+00010910: 5d2c 0a20 2020 2020 2020 2070 726f 6a65  ],.        proje
+00010920: 6374 3d22 222c 0a20 2020 2020 2020 2076  ct="",.        v
+00010930: 6572 7369 6f6e 6564 3d54 7275 652c 0a20  ersioned=True,. 
+00010940: 2020 2029 202d 3e20 6469 6374 3a0a 2020     ) -> dict:.  
+00010950: 2020 2020 2020 2222 2243 7265 6174 6520        """Create 
+00010960: 6120 6e65 7720 3a70 793a 636c 6173 733a  a new :py:class:
+00010970: 607e 6d6c 7275 6e2e 6665 6174 7572 655f  `~mlrun.feature_
+00010980: 7374 6f72 652e 4665 6174 7572 6553 6574  store.FeatureSet
+00010990: 6020 616e 6420 7361 7665 2069 6e20 7468  ` and save in th
+000109a0: 6520 3a70 793a 6d6f 643a 606d 6c72 756e  e :py:mod:`mlrun
+000109b0: 6020 4442 2e20 5468 650a 2020 2020 2020  ` DB. The.      
+000109c0: 2020 6665 6174 7572 652d 7365 7420 6d75    feature-set mu
+000109d0: 7374 206e 6f74 2070 7265 7669 6f75 736c  st not previousl
+000109e0: 7920 6578 6973 7420 696e 2074 6865 2044  y exist in the D
+000109f0: 422e 0a0a 2020 2020 2020 2020 3a70 6172  B...        :par
+00010a00: 616d 2066 6561 7475 7265 5f73 6574 3a20  am feature_set: 
+00010a10: 5468 6520 6e65 7720 3a70 793a 636c 6173  The new :py:clas
+00010a20: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
+00010a30: 655f 7374 6f72 652e 4665 6174 7572 6553  e_store.FeatureS
+00010a40: 6574 6020 746f 2063 7265 6174 652e 0a20  et` to create.. 
+00010a50: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+00010a60: 6f6a 6563 743a 204e 616d 6520 6f66 2070  oject: Name of p
+00010a70: 726f 6a65 6374 2074 6869 7320 6665 6174  roject this feat
+00010a80: 7572 652d 7365 7420 6265 6c6f 6e67 7320  ure-set belongs 
+00010a90: 746f 2e0a 2020 2020 2020 2020 3a70 6172  to..        :par
+00010aa0: 616d 2076 6572 7369 6f6e 6564 3a20 5768  am versioned: Wh
+00010ab0: 6574 6865 7220 746f 206d 6169 6e74 6169  ether to maintai
+00010ac0: 6e20 7665 7273 696f 6e73 2066 6f72 2074  n versions for t
+00010ad0: 6869 7320 6665 6174 7572 652d 7365 742e  his feature-set.
+00010ae0: 2041 6c6c 2076 6572 7369 6f6e 7320 6f66   All versions of
+00010af0: 2061 2076 6572 7369 6f6e 6564 206f 626a   a versioned obj
+00010b00: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
+00010b10: 7769 6c6c 2062 6520 6b65 7074 2069 6e20  will be kept in 
+00010b20: 7468 6520 4442 2061 6e64 2063 616e 2062  the DB and can b
+00010b30: 6520 7265 7472 6965 7665 6420 756e 7469  e retrieved unti
+00010b40: 6c20 6578 706c 6963 6974 6c79 2064 656c  l explicitly del
+00010b50: 6574 6564 2e0a 2020 2020 2020 2020 3a72  eted..        :r
+00010b60: 6574 7572 6e73 3a20 5468 6520 3a70 793a  eturns: The :py:
+00010b70: 636c 6173 733a 607e 6d6c 7275 6e2e 6665  class:`~mlrun.fe
+00010b80: 6174 7572 655f 7374 6f72 652e 4665 6174  ature_store.Feat
+00010b90: 7572 6553 6574 6020 6f62 6a65 6374 2028  ureSet` object (
+00010ba0: 6173 2064 6963 7429 2e0a 2020 2020 2020  as dict)..      
+00010bb0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00010bc0: 2069 7369 6e73 7461 6e63 6528 6665 6174   isinstance(feat
+00010bd0: 7572 655f 7365 742c 206d 6c72 756e 2e63  ure_set, mlrun.c
+00010be0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4665  ommon.schemas.Fe
+00010bf0: 6174 7572 6553 6574 293a 0a20 2020 2020  atureSet):.     
+00010c00: 2020 2020 2020 2066 6561 7475 7265 5f73         feature_s
+00010c10: 6574 203d 2066 6561 7475 7265 5f73 6574  et = feature_set
+00010c20: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
+00010c30: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00010c40: 6665 6174 7572 655f 7365 742c 2046 6561  feature_set, Fea
+00010c50: 7475 7265 5365 7429 3a0a 2020 2020 2020  tureSet):.      
+00010c60: 2020 2020 2020 6665 6174 7572 655f 7365        feature_se
+00010c70: 7420 3d20 6665 6174 7572 655f 7365 742e  t = feature_set.
+00010c80: 746f 5f64 6963 7428 290a 0a20 2020 2020  to_dict()..     
+00010c90: 2020 2070 726f 6a65 6374 203d 2028 0a20     project = (. 
+00010ca0: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
+00010cb0: 6374 0a20 2020 2020 2020 2020 2020 206f  ct.            o
+00010cc0: 7220 6665 6174 7572 655f 7365 745b 226d  r feature_set["m
+00010cd0: 6574 6164 6174 6122 5d2e 6765 7428 2270  etadata"].get("p
+00010ce0: 726f 6a65 6374 222c 204e 6f6e 6529 0a20  roject", None). 
+00010cf0: 2020 2020 2020 2020 2020 206f 7220 636f             or co
+00010d00: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
+00010d10: 6a65 6374 0a20 2020 2020 2020 2029 0a20  ject.        ). 
+00010d20: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+00010d30: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
+00010d40: 747d 2f66 6561 7475 7265 2d73 6574 7322  t}/feature-sets"
+00010d50: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
+00010d60: 3d20 7b22 7665 7273 696f 6e65 6422 3a20  = {"versioned": 
+00010d70: 7665 7273 696f 6e65 647d 0a0a 2020 2020  versioned}..    
+00010d80: 2020 2020 6e61 6d65 203d 2066 6561 7475      name = featu
+00010d90: 7265 5f73 6574 5b22 6d65 7461 6461 7461  re_set["metadata
+00010da0: 225d 5b22 6e61 6d65 225d 0a20 2020 2020  "]["name"].     
+00010db0: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+00010dc0: 203d 2066 2246 6169 6c65 6420 6372 6561   = f"Failed crea
+00010dd0: 7469 6e67 2066 6561 7475 7265 2d73 6574  ting feature-set
+00010de0: 207b 7072 6f6a 6563 747d 2f7b 6e61 6d65   {project}/{name
+00010df0: 7d22 0a20 2020 2020 2020 2072 6573 7020  }".        resp 
+00010e00: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+00010e10: 0a20 2020 2020 2020 2020 2020 2022 504f  .            "PO
+00010e20: 5354 222c 0a20 2020 2020 2020 2020 2020  ST",.           
+00010e30: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
+00010e40: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+00010e50: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+00010e60: 7261 6d73 3d70 6172 616d 732c 0a20 2020  rams=params,.   
+00010e70: 2020 2020 2020 2020 2062 6f64 793d 6469           body=di
+00010e80: 6374 5f74 6f5f 6a73 6f6e 2866 6561 7475  ct_to_json(featu
+00010e90: 7265 5f73 6574 292c 0a20 2020 2020 2020  re_set),.       
+00010ea0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00010eb0: 6e20 7265 7370 2e6a 736f 6e28 290a 0a20  n resp.json().. 
+00010ec0: 2020 2064 6566 2067 6574 5f66 6561 7475     def get_featu
+00010ed0: 7265 5f73 6574 280a 2020 2020 2020 2020  re_set(.        
+00010ee0: 7365 6c66 2c20 6e61 6d65 3a20 7374 722c  self, name: str,
+00010ef0: 2070 726f 6a65 6374 3a20 7374 7220 3d20   project: str = 
+00010f00: 2222 2c20 7461 673a 2073 7472 203d 204e  "", tag: str = N
+00010f10: 6f6e 652c 2075 6964 3a20 7374 7220 3d20  one, uid: str = 
+00010f20: 4e6f 6e65 0a20 2020 2029 202d 3e20 4665  None.    ) -> Fe
+00010f30: 6174 7572 6553 6574 3a0a 2020 2020 2020  atureSet:.      
+00010f40: 2020 2222 2252 6574 7269 6576 6520 6120    """Retrieve a 
+00010f50: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
+00010f60: 746f 7265 2e46 6561 7475 7265 5365 7460  tore.FeatureSet`
+00010f70: 206f 626a 6563 742e 2049 6620 626f 7468   object. If both
+00010f80: 2060 6074 6167 6060 2061 6e64 2060 6075   ``tag`` and ``u
+00010f90: 6964 6060 2061 7265 206e 6f74 2073 7065  id`` are not spe
+00010fa0: 6369 6669 6564 2c20 7468 656e 0a20 2020  cified, then.   
+00010fb0: 2020 2020 2074 6865 206f 626a 6563 7420       the object 
+00010fc0: 7461 6767 6564 2060 606c 6174 6573 7460  tagged ``latest`
+00010fd0: 6020 7769 6c6c 2062 6520 7265 7472 6965  ` will be retrie
+00010fe0: 7665 642e 0a0a 2020 2020 2020 2020 3a70  ved...        :p
+00010ff0: 6172 616d 206e 616d 653a 204e 616d 6520  aram name: Name 
+00011000: 6f66 206f 626a 6563 7420 746f 2072 6574  of object to ret
+00011010: 7269 6576 652e 0a20 2020 2020 2020 203a  rieve..        :
+00011020: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
+00011030: 726f 6a65 6374 2074 6865 2046 6561 7475  roject the Featu
+00011040: 7265 5365 7420 6265 6c6f 6e67 7320 746f  reSet belongs to
+00011050: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00011060: 2074 6167 3a20 5461 6720 6f66 2074 6865   tag: Tag of the
+00011070: 2073 7065 6369 6669 6320 6f62 6a65 6374   specific object
+00011080: 2076 6572 7369 6f6e 2074 6f20 7265 7472   version to retr
+00011090: 6965 7665 2e0a 2020 2020 2020 2020 3a70  ieve..        :p
+000110a0: 6172 616d 2075 6964 3a20 7569 6420 6f66  aram uid: uid of
+000110b0: 2074 6865 206f 626a 6563 7420 746f 2072   the object to r
+000110c0: 6574 7269 6576 6520 2863 616e 206f 6e6c  etrieve (can onl
+000110d0: 7920 6265 2075 7365 6420 666f 7220 7665  y be used for ve
+000110e0: 7273 696f 6e65 6420 6f62 6a65 6374 7329  rsioned objects)
+000110f0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00011100: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+00011110: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
+00011120: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
+00011130: 6374 0a20 2020 2020 2020 2072 6566 6572  ct.        refer
+00011140: 656e 6365 203d 2073 656c 662e 5f72 6573  ence = self._res
+00011150: 6f6c 7665 5f72 6566 6572 656e 6365 2874  olve_reference(t
+00011160: 6167 2c20 7569 6429 0a20 2020 2020 2020  ag, uid).       
+00011170: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
+00011180: 7473 2f7b 7072 6f6a 6563 747d 2f66 6561  ts/{project}/fea
+00011190: 7475 7265 2d73 6574 732f 7b6e 616d 657d  ture-sets/{name}
+000111a0: 2f72 6566 6572 656e 6365 732f 7b72 6566  /references/{ref
+000111b0: 6572 656e 6365 7d22 0a20 2020 2020 2020  erence}".       
+000111c0: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+000111d0: 2066 2246 6169 6c65 6420 7265 7472 6965   f"Failed retrie
+000111e0: 7669 6e67 2066 6561 7475 7265 2d73 6574  ving feature-set
+000111f0: 207b 7072 6f6a 6563 747d 2f7b 6e61 6d65   {project}/{name
+00011200: 7d22 0a20 2020 2020 2020 2072 6573 7020  }".        resp 
+00011210: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+00011220: 2247 4554 222c 2070 6174 682c 2065 7272  "GET", path, err
+00011230: 6f72 5f6d 6573 7361 6765 290a 2020 2020  or_message).    
+00011240: 2020 2020 7265 7475 726e 2046 6561 7475      return Featu
+00011250: 7265 5365 742e 6672 6f6d 5f64 6963 7428  reSet.from_dict(
+00011260: 7265 7370 2e6a 736f 6e28 2929 0a0a 2020  resp.json())..  
+00011270: 2020 6465 6620 6c69 7374 5f66 6561 7475    def list_featu
+00011280: 7265 7328 0a20 2020 2020 2020 2073 656c  res(.        sel
+00011290: 662c 0a20 2020 2020 2020 2070 726f 6a65  f,.        proje
+000112a0: 6374 3a20 7374 722c 0a20 2020 2020 2020  ct: str,.       
+000112b0: 206e 616d 653a 2073 7472 203d 204e 6f6e   name: str = Non
+000112c0: 652c 0a20 2020 2020 2020 2074 6167 3a20  e,.        tag: 
+000112d0: 7374 7220 3d20 4e6f 6e65 2c0a 2020 2020  str = None,.    
+000112e0: 2020 2020 656e 7469 7469 6573 3a20 4c69      entities: Li
+000112f0: 7374 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  st[str] = None,.
+00011300: 2020 2020 2020 2020 6c61 6265 6c73 3a20          labels: 
+00011310: 4c69 7374 5b73 7472 5d20 3d20 4e6f 6e65  List[str] = None
+00011320: 2c0a 2020 2020 2920 2d3e 204c 6973 745b  ,.    ) -> List[
+00011330: 6469 6374 5d3a 0a20 2020 2020 2020 2022  dict]:.        "
+00011340: 2222 4c69 7374 2066 6561 7475 7265 2d73  ""List feature-s
+00011350: 6574 7320 7768 6963 6820 636f 6e74 6169  ets which contai
+00011360: 6e20 7370 6563 6966 6963 2066 6561 7475  n specific featu
+00011370: 7265 732e 2054 6869 7320 6675 6e63 7469  res. This functi
+00011380: 6f6e 206d 6179 2072 6574 7572 6e20 6d75  on may return mu
+00011390: 6c74 6970 6c65 2076 6572 7369 6f6e 7320  ltiple versions 
+000113a0: 6f66 2074 6865 2073 616d 650a 2020 2020  of the same.    
+000113b0: 2020 2020 6665 6174 7572 652d 7365 7420      feature-set 
+000113c0: 6966 2061 2073 7065 6369 6669 6320 7461  if a specific ta
+000113d0: 6720 6973 206e 6f74 2072 6571 7565 7374  g is not request
+000113e0: 6564 2e20 4e6f 7465 2074 6861 7420 7468  ed. Note that th
+000113f0: 6520 7661 7269 6f75 7320 6669 6c74 6572  e various filter
+00011400: 7320 6f66 2074 6869 7320 6675 6e63 7469  s of this functi
+00011410: 6f6e 2061 6374 7561 6c6c 790a 2020 2020  on actually.    
+00011420: 2020 2020 7265 6665 7220 746f 2074 6865      refer to the
+00011430: 2066 6561 7475 7265 2d73 6574 206f 626a   feature-set obj
+00011440: 6563 7420 636f 6e74 6169 6e69 6e67 2074  ect containing t
+00011450: 6865 2066 6561 7475 7265 732c 206e 6f74  he features, not
+00011460: 2074 6f20 7468 6520 6665 6174 7572 6573   to the features
+00011470: 2074 6865 6d73 656c 7665 732e 0a0a 2020   themselves...  
+00011480: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
+00011490: 6a65 6374 3a20 5072 6f6a 6563 7420 7768  ject: Project wh
+000114a0: 6963 6820 636f 6e74 6169 6e73 2074 6865  ich contains the
+000114b0: 7365 2066 6561 7475 7265 732e 0a20 2020  se features..   
+000114c0: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
+000114d0: 3a20 4e61 6d65 206f 6620 7468 6520 6665  : Name of the fe
+000114e0: 6174 7572 6520 746f 206c 6f6f 6b20 666f  ature to look fo
+000114f0: 722e 2054 6865 206e 616d 6520 6973 2075  r. The name is u
+00011500: 7365 6420 696e 2061 206c 696b 6520 7175  sed in a like qu
+00011510: 6572 792c 2061 6e64 2069 7320 6e6f 7420  ery, and is not 
+00011520: 6361 7365 2d73 656e 7369 7469 7665 2e20  case-sensitive. 
+00011530: 466f 720a 2020 2020 2020 2020 2020 2020  For.            
+00011540: 6578 616d 706c 652c 206c 6f6f 6b69 6e67  example, looking
+00011550: 2066 6f72 2060 6066 6561 7460 6020 7769   for ``feat`` wi
+00011560: 6c6c 2072 6574 7572 6e20 6665 6174 7572  ll return featur
+00011570: 6573 2077 6869 6368 2061 7265 206e 616d  es which are nam
+00011580: 6564 2060 604d 7946 6561 7475 7265 6060  ed ``MyFeature``
+00011590: 2061 7320 7765 6c6c 2061 7320 6060 6465   as well as ``de
+000115a0: 6665 6174 6060 2e0a 2020 2020 2020 2020  feat``..        
+000115b0: 3a70 6172 616d 2074 6167 3a20 5265 7475  :param tag: Retu
+000115c0: 726e 2066 6561 7475 7265 2d73 6574 7320  rn feature-sets 
+000115d0: 7768 6963 6820 636f 6e74 6169 6e20 7468  which contain th
+000115e0: 6520 6665 6174 7572 6573 206c 6f6f 6b65  e features looke
+000115f0: 6420 666f 722c 2061 6e64 2061 7265 2074  d for, and are t
+00011600: 6167 6765 6420 7769 7468 2074 6865 2073  agged with the s
+00011610: 7065 6369 6669 6320 7461 672e 0a20 2020  pecific tag..   
+00011620: 2020 2020 203a 7061 7261 6d20 656e 7469       :param enti
+00011630: 7469 6573 3a20 5265 7475 726e 206f 6e6c  ties: Return onl
+00011640: 7920 6665 6174 7572 652d 7365 7473 2077  y feature-sets w
+00011650: 6869 6368 2063 6f6e 7461 696e 2061 6e20  hich contain an 
+00011660: 656e 7469 7479 2077 686f 7365 206e 616d  entity whose nam
+00011670: 6520 6973 2063 6f6e 7461 696e 6564 2069  e is contained i
+00011680: 6e20 7468 6973 206c 6973 742e 0a20 2020  n this list..   
+00011690: 2020 2020 203a 7061 7261 6d20 6c61 6265       :param labe
+000116a0: 6c73 3a20 5265 7475 726e 206f 6e6c 7920  ls: Return only 
+000116b0: 6665 6174 7572 652d 7365 7473 2077 6869  feature-sets whi
+000116c0: 6368 2061 7265 206c 6162 656c 6564 2061  ch are labeled a
+000116d0: 7320 7265 7175 6573 7465 642e 0a20 2020  s requested..   
+000116e0: 2020 2020 203a 7265 7475 726e 733a 2041       :returns: A
+000116f0: 206c 6973 7420 6f66 206d 6170 7069 6e67   list of mapping
+00011700: 2066 726f 6d20 6665 6174 7572 6520 746f   from feature to
+00011710: 2061 2064 6967 6573 7420 6f66 2074 6865   a digest of the
+00011720: 2066 6561 7475 7265 2d73 6574 2c20 7768   feature-set, wh
+00011730: 6963 6820 636f 6e74 6169 6e73 2074 6865  ich contains the
+00011740: 2066 6561 7475 7265 2d73 6574 0a20 2020   feature-set.   
+00011750: 2020 2020 2020 2020 206d 6574 612d 6461           meta-da
+00011760: 7461 2e20 4d75 6c74 6970 6c65 2065 6e74  ta. Multiple ent
+00011770: 7269 6573 206d 6179 2062 6520 7265 7475  ries may be retu
+00011780: 726e 6564 2066 6f72 2061 6e79 2073 7065  rned for any spe
+00011790: 6369 6669 6320 6665 6174 7572 6520 6475  cific feature du
+000117a0: 6520 746f 206d 756c 7469 706c 6520 7461  e to multiple ta
+000117b0: 6773 206f 7220 7665 7273 696f 6e73 0a20  gs or versions. 
+000117c0: 2020 2020 2020 2020 2020 206f 6620 7468             of th
+000117d0: 6520 6665 6174 7572 652d 7365 742e 0a20  e feature-set.. 
+000117e0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000117f0: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
+00011800: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
+00011810: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
+00011820: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+00011830: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+00011840: 6e61 6d65 223a 206e 616d 652c 0a20 2020  name": name,.   
+00011850: 2020 2020 2020 2020 2022 7461 6722 3a20           "tag": 
+00011860: 7461 672c 0a20 2020 2020 2020 2020 2020  tag,.           
+00011870: 2022 656e 7469 7479 223a 2065 6e74 6974   "entity": entit
+00011880: 6965 7320 6f72 205b 5d2c 0a20 2020 2020  ies or [],.     
+00011890: 2020 2020 2020 2022 6c61 6265 6c22 3a20         "label": 
+000118a0: 6c61 6265 6c73 206f 7220 5b5d 2c0a 2020  labels or [],.  
+000118b0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+000118c0: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
+000118d0: 7473 2f7b 7072 6f6a 6563 747d 2f66 6561  ts/{project}/fea
+000118e0: 7475 7265 7322 0a0a 2020 2020 2020 2020  tures"..        
+000118f0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+00011900: 6622 4661 696c 6564 206c 6973 7469 6e67  f"Failed listing
+00011910: 2066 6561 7475 7265 732c 2070 726f 6a65   features, proje
+00011920: 6374 3a20 7b70 726f 6a65 6374 7d2c 2071  ct: {project}, q
+00011930: 7565 7279 3a20 7b70 6172 616d 737d 220a  uery: {params}".
+00011940: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
+00011950: 656c 662e 6170 695f 6361 6c6c 2822 4745  elf.api_call("GE
+00011960: 5422 2c20 7061 7468 2c20 6572 726f 725f  T", path, error_
+00011970: 6d65 7373 6167 652c 2070 6172 616d 733d  message, params=
+00011980: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00011990: 7265 7475 726e 2072 6573 702e 6a73 6f6e  return resp.json
+000119a0: 2829 5b22 6665 6174 7572 6573 225d 0a0a  ()["features"]..
+000119b0: 2020 2020 6465 6620 6c69 7374 5f65 6e74      def list_ent
+000119c0: 6974 6965 7328 0a20 2020 2020 2020 2073  ities(.        s
+000119d0: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
+000119e0: 6a65 6374 3a20 7374 722c 0a20 2020 2020  ject: str,.     
+000119f0: 2020 206e 616d 653a 2073 7472 203d 204e     name: str = N
+00011a00: 6f6e 652c 0a20 2020 2020 2020 2074 6167  one,.        tag
+00011a10: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
+00011a20: 2020 2020 2020 6c61 6265 6c73 3a20 4c69        labels: Li
+00011a30: 7374 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  st[str] = None,.
+00011a40: 2020 2020 2920 2d3e 204c 6973 745b 6469      ) -> List[di
+00011a50: 6374 5d3a 0a20 2020 2020 2020 2022 2222  ct]:.        """
+00011a60: 5265 7472 6965 7665 2061 206c 6973 7420  Retrieve a list 
+00011a70: 6f66 2065 6e74 6974 6965 7320 616e 6420  of entities and 
+00011a80: 7468 6569 7220 6d61 7070 696e 6720 746f  their mapping to
+00011a90: 2074 6865 2063 6f6e 7461 696e 696e 6720   the containing 
+00011aa0: 6665 6174 7572 652d 7365 7473 2e20 5468  feature-sets. Th
+00011ab0: 6973 2066 756e 6374 696f 6e20 6973 2073  is function is s
+00011ac0: 696d 696c 6172 0a20 2020 2020 2020 2074  imilar.        t
+00011ad0: 6f20 7468 6520 3a70 793a 6675 6e63 3a60  o the :py:func:`
+00011ae0: 7e6c 6973 745f 6665 6174 7572 6573 6020  ~list_features` 
+00011af0: 6675 6e63 7469 6f6e 2c20 616e 6420 7573  function, and us
+00011b00: 6573 2074 6865 2073 616d 6520 6c6f 6769  es the same logi
+00011b10: 632e 2048 6f77 6576 6572 2c20 7468 6520  c. However, the 
+00011b20: 656e 7469 7469 6573 2061 7265 206d 6174  entities are mat
+00011b30: 6368 6564 0a20 2020 2020 2020 2061 6761  ched.        aga
+00011b40: 696e 7374 2074 6865 206e 616d 6520 7261  inst the name ra
+00011b50: 7468 6572 2074 6861 6e20 7468 6520 6665  ther than the fe
+00011b60: 6174 7572 6573 2e0a 2020 2020 2020 2020  atures..        
+00011b70: 2222 220a 0a20 2020 2020 2020 2070 726f  """..        pro
+00011b80: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
+00011b90: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
+00011ba0: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
+00011bb0: 2070 6172 616d 7320 3d20 7b0a 2020 2020   params = {.    
+00011bc0: 2020 2020 2020 2020 226e 616d 6522 3a20          "name": 
+00011bd0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+00011be0: 2020 2274 6167 223a 2074 6167 2c0a 2020    "tag": tag,.  
+00011bf0: 2020 2020 2020 2020 2020 226c 6162 656c            "label
+00011c00: 223a 206c 6162 656c 7320 6f72 205b 5d2c  ": labels or [],
+00011c10: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00011c20: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
+00011c30: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
+00011c40: 656e 7469 7469 6573 220a 0a20 2020 2020  entities"..     
+00011c50: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+00011c60: 203d 2066 2246 6169 6c65 6420 6c69 7374   = f"Failed list
+00011c70: 696e 6720 656e 7469 7469 6573 2c20 7072  ing entities, pr
+00011c80: 6f6a 6563 743a 207b 7072 6f6a 6563 747d  oject: {project}
+00011c90: 2c20 7175 6572 793a 207b 7061 7261 6d73  , query: {params
+00011ca0: 7d22 0a20 2020 2020 2020 2072 6573 7020  }".        resp 
+00011cb0: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+00011cc0: 2247 4554 222c 2070 6174 682c 2065 7272  "GET", path, err
+00011cd0: 6f72 5f6d 6573 7361 6765 2c20 7061 7261  or_message, para
+00011ce0: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
+00011cf0: 2020 2072 6574 7572 6e20 7265 7370 2e6a     return resp.j
+00011d00: 736f 6e28 295b 2265 6e74 6974 6965 7322  son()["entities"
+00011d10: 5d0a 0a20 2020 2040 7374 6174 6963 6d65  ]..    @staticme
+00011d20: 7468 6f64 0a20 2020 2064 6566 205f 6765  thod.    def _ge
+00011d30: 6e65 7261 7465 5f70 6172 7469 7469 6f6e  nerate_partition
+00011d40: 5f62 795f 7061 7261 6d73 280a 2020 2020  _by_params(.    
+00011d50: 2020 2020 7061 7274 6974 696f 6e5f 6279      partition_by
+00011d60: 5f63 6c73 2c0a 2020 2020 2020 2020 7061  _cls,.        pa
+00011d70: 7274 6974 696f 6e5f 6279 2c0a 2020 2020  rtition_by,.    
+00011d80: 2020 2020 726f 7773 5f70 6572 5f70 6172      rows_per_par
+00011d90: 7469 7469 6f6e 2c0a 2020 2020 2020 2020  tition,.        
+00011da0: 736f 7274 5f62 792c 0a20 2020 2020 2020  sort_by,.       
+00011db0: 206f 7264 6572 2c0a 2020 2020 2020 2020   order,.        
+00011dc0: 6d61 785f 7061 7274 6974 696f 6e73 3d4e  max_partitions=N
+00011dd0: 6f6e 652c 0a20 2020 2029 3a0a 0a20 2020  one,.    ):..   
+00011de0: 2020 2020 2070 6172 7469 7469 6f6e 5f70       partition_p
+00011df0: 6172 616d 7320 3d20 7b0a 2020 2020 2020  arams = {.      
+00011e00: 2020 2020 2020 2270 6172 7469 7469 6f6e        "partition
+00011e10: 2d62 7922 3a20 7061 7274 6974 696f 6e5f  -by": partition_
+00011e20: 6279 2c0a 2020 2020 2020 2020 2020 2020  by,.            
+00011e30: 2272 6f77 732d 7065 722d 7061 7274 6974  "rows-per-partit
+00011e40: 696f 6e22 3a20 726f 7773 5f70 6572 5f70  ion": rows_per_p
+00011e50: 6172 7469 7469 6f6e 2c0a 2020 2020 2020  artition,.      
+00011e60: 2020 2020 2020 2270 6172 7469 7469 6f6e        "partition
+00011e70: 2d73 6f72 742d 6279 223a 2073 6f72 745f  -sort-by": sort_
+00011e80: 6279 2c0a 2020 2020 2020 2020 2020 2020  by,.            
+00011e90: 2270 6172 7469 7469 6f6e 2d6f 7264 6572  "partition-order
+00011ea0: 223a 206f 7264 6572 2c0a 2020 2020 2020  ": order,.      
+00011eb0: 2020 7d0a 2020 2020 2020 2020 6966 206d    }.        if m
+00011ec0: 6178 5f70 6172 7469 7469 6f6e 7320 6973  ax_partitions is
+00011ed0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00011ee0: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00011ef0: 5f70 6172 616d 735b 226d 6178 2d70 6172  _params["max-par
+00011f00: 7469 7469 6f6e 7322 5d20 3d20 6d61 785f  titions"] = max_
+00011f10: 7061 7274 6974 696f 6e73 0a20 2020 2020  partitions.     
+00011f20: 2020 2072 6574 7572 6e20 7061 7274 6974     return partit
+00011f30: 696f 6e5f 7061 7261 6d73 0a0a 2020 2020  ion_params..    
+00011f40: 6465 6620 6c69 7374 5f66 6561 7475 7265  def list_feature
+00011f50: 5f73 6574 7328 0a20 2020 2020 2020 2073  _sets(.        s
+00011f60: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
+00011f70: 6a65 6374 3a20 7374 7220 3d20 2222 2c0a  ject: str = "",.
+00011f80: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
+00011f90: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+00011fa0: 2020 7461 673a 2073 7472 203d 204e 6f6e    tag: str = Non
+00011fb0: 652c 0a20 2020 2020 2020 2073 7461 7465  e,.        state
+00011fc0: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
+00011fd0: 2020 2020 2020 656e 7469 7469 6573 3a20        entities: 
+00011fe0: 4c69 7374 5b73 7472 5d20 3d20 4e6f 6e65  List[str] = None
+00011ff0: 2c0a 2020 2020 2020 2020 6665 6174 7572  ,.        featur
+00012000: 6573 3a20 4c69 7374 5b73 7472 5d20 3d20  es: List[str] = 
+00012010: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
+00012020: 6265 6c73 3a20 4c69 7374 5b73 7472 5d20  bels: List[str] 
+00012030: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00012040: 7061 7274 6974 696f 6e5f 6279 3a20 556e  partition_by: Un
+00012050: 696f 6e5b 0a20 2020 2020 2020 2020 2020  ion[.           
+00012060: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+00012070: 6865 6d61 732e 4665 6174 7572 6553 746f  hemas.FeatureSto
+00012080: 7265 5061 7274 6974 696f 6e42 7946 6965  rePartitionByFie
+00012090: 6c64 2c20 7374 720a 2020 2020 2020 2020  ld, str.        
+000120a0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+000120b0: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
+000120c0: 7469 6f6e 3a20 696e 7420 3d20 312c 0a20  tion: int = 1,. 
+000120d0: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+000120e0: 5f73 6f72 745f 6279 3a20 556e 696f 6e5b  _sort_by: Union[
+000120f0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00012100: 656d 6173 2e53 6f72 7446 6965 6c64 2c20  emas.SortField, 
+00012110: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00012120: 2020 2020 2070 6172 7469 7469 6f6e 5f6f       partition_o
+00012130: 7264 6572 3a20 556e 696f 6e5b 0a20 2020  rder: Union[.   
+00012140: 2020 2020 2020 2020 206d 6c72 756e 2e63           mlrun.c
+00012150: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4f72  ommon.schemas.Or
+00012160: 6465 7254 7970 652c 2073 7472 0a20 2020  derType, str.   
+00012170: 2020 2020 205d 203d 206d 6c72 756e 2e63       ] = mlrun.c
+00012180: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4f72  ommon.schemas.Or
+00012190: 6465 7254 7970 652e 6465 7363 2c0a 2020  derType.desc,.  
+000121a0: 2020 2920 2d3e 204c 6973 745b 4665 6174    ) -> List[Feat
+000121b0: 7572 6553 6574 5d3a 0a20 2020 2020 2020  ureSet]:.       
+000121c0: 2022 2222 5265 7472 6965 7665 2061 206c   """Retrieve a l
+000121d0: 6973 7420 6f66 2066 6561 7475 7265 2d73  ist of feature-s
+000121e0: 6574 7320 6d61 7463 6869 6e67 2074 6865  ets matching the
+000121f0: 2063 7269 7465 7269 6120 7072 6f76 6964   criteria provid
+00012200: 6564 2e0a 0a20 2020 2020 2020 203a 7061  ed...        :pa
+00012210: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
+00012220: 6a65 6374 206e 616d 652e 0a20 2020 2020  ject name..     
+00012230: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
+00012240: 4e61 6d65 206f 6620 6665 6174 7572 652d  Name of feature-
+00012250: 7365 7420 746f 206d 6174 6368 2e20 5468  set to match. Th
+00012260: 6973 2069 7320 6120 6c69 6b65 2071 7565  is is a like que
+00012270: 7279 2c20 616e 6420 6973 2063 6173 652d  ry, and is case-
+00012280: 696e 7365 6e73 6974 6976 652e 0a20 2020  insensitive..   
+00012290: 2020 2020 203a 7061 7261 6d20 7461 673a       :param tag:
+000122a0: 204d 6174 6368 2066 6561 7475 7265 2d73   Match feature-s
+000122b0: 6574 7320 7769 7468 2073 7065 6369 6669  ets with specifi
+000122c0: 6320 7461 672e 0a20 2020 2020 2020 203a  c tag..        :
+000122d0: 7061 7261 6d20 7374 6174 653a 204d 6174  param state: Mat
+000122e0: 6368 2066 6561 7475 7265 2d73 6574 7320  ch feature-sets 
+000122f0: 7769 7468 2061 2073 7065 6369 6669 6320  with a specific 
+00012300: 7374 6174 652e 0a20 2020 2020 2020 203a  state..        :
+00012310: 7061 7261 6d20 656e 7469 7469 6573 3a20  param entities: 
+00012320: 4d61 7463 6820 6665 6174 7572 652d 7365  Match feature-se
+00012330: 7473 2077 6869 6368 2063 6f6e 7461 696e  ts which contain
+00012340: 2065 6e74 6974 6965 7320 7768 6f73 6520   entities whose 
+00012350: 6e61 6d65 2069 7320 696e 2074 6869 7320  name is in this 
+00012360: 6c69 7374 2e0a 2020 2020 2020 2020 3a70  list..        :p
+00012370: 6172 616d 2066 6561 7475 7265 733a 204d  aram features: M
+00012380: 6174 6368 2066 6561 7475 7265 2d73 6574  atch feature-set
+00012390: 7320 7768 6963 6820 636f 6e74 6169 6e20  s which contain 
+000123a0: 6665 6174 7572 6573 2077 686f 7365 206e  features whose n
+000123b0: 616d 6520 6973 2069 6e20 7468 6973 206c  ame is in this l
+000123c0: 6973 742e 0a20 2020 2020 2020 203a 7061  ist..        :pa
+000123d0: 7261 6d20 6c61 6265 6c73 3a20 4d61 7463  ram labels: Matc
+000123e0: 6820 6665 6174 7572 652d 7365 7473 2077  h feature-sets w
+000123f0: 6869 6368 2068 6176 6520 7468 6573 6520  hich have these 
+00012400: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
+00012410: 3a70 6172 616d 2070 6172 7469 7469 6f6e  :param partition
+00012420: 5f62 793a 2046 6965 6c64 2074 6f20 6772  _by: Field to gr
+00012430: 6f75 7020 7265 7375 6c74 7320 6279 2e20  oup results by. 
+00012440: 4f6e 6c79 2061 6c6c 6f77 6564 2076 616c  Only allowed val
+00012450: 7565 2069 7320 606e 616d 6560 2e20 5768  ue is `name`. Wh
+00012460: 656e 2060 7061 7274 6974 696f 6e5f 6279  en `partition_by
+00012470: 6020 6973 2073 7065 6369 6669 6564 2c0a  ` is specified,.
+00012480: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00012490: 6070 6172 7469 7469 6f6e 5f73 6f72 745f  `partition_sort_
+000124a0: 6279 6020 7061 7261 6d65 7465 7220 6d75  by` parameter mu
+000124b0: 7374 2062 6520 7072 6f76 6964 6564 2061  st be provided a
+000124c0: 7320 7765 6c6c 2e0a 2020 2020 2020 2020  s well..        
+000124d0: 3a70 6172 616d 2072 6f77 735f 7065 725f  :param rows_per_
+000124e0: 7061 7274 6974 696f 6e3a 2048 6f77 206d  partition: How m
+000124f0: 616e 7920 746f 7020 726f 7773 2028 7065  any top rows (pe
+00012500: 7220 736f 7274 696e 6720 6465 6669 6e65  r sorting define
+00012510: 6420 6279 2060 7061 7274 6974 696f 6e5f  d by `partition_
+00012520: 736f 7274 5f62 7960 2061 6e64 2060 7061  sort_by` and `pa
+00012530: 7274 6974 696f 6e5f 6f72 6465 7260 290a  rtition_order`).
+00012540: 2020 2020 2020 2020 2020 2020 746f 2072              to r
+00012550: 6574 7572 6e20 7065 7220 6772 6f75 702e  eturn per group.
+00012560: 2044 6566 6175 6c74 2076 616c 7565 2069   Default value i
+00012570: 7320 312e 0a20 2020 2020 2020 203a 7061  s 1..        :pa
+00012580: 7261 6d20 7061 7274 6974 696f 6e5f 736f  ram partition_so
+00012590: 7274 5f62 793a 2057 6861 7420 6669 656c  rt_by: What fiel
+000125a0: 6420 746f 2073 6f72 7420 7468 6520 7265  d to sort the re
+000125b0: 7375 6c74 7320 6279 2c20 7769 7468 696e  sults by, within
+000125c0: 2065 6163 6820 7061 7274 6974 696f 6e20   each partition 
+000125d0: 6465 6669 6e65 6420 6279 2060 7061 7274  defined by `part
+000125e0: 6974 696f 6e5f 6279 602e 0a20 2020 2020  ition_by`..     
+000125f0: 2020 2020 2020 2043 7572 7265 6e74 6c79         Currently
+00012600: 2074 6865 206f 6e6c 7920 616c 6c6f 7765   the only allowe
+00012610: 6420 7661 6c75 6520 6172 6520 6063 7265  d value are `cre
+00012620: 6174 6564 6020 616e 6420 6075 7064 6174  ated` and `updat
+00012630: 6564 602e 0a20 2020 2020 2020 203a 7061  ed`..        :pa
+00012640: 7261 6d20 7061 7274 6974 696f 6e5f 6f72  ram partition_or
+00012650: 6465 723a 204f 7264 6572 206f 6620 736f  der: Order of so
+00012660: 7274 696e 6720 7769 7468 696e 2070 6172  rting within par
+00012670: 7469 7469 6f6e 7320 2d20 6061 7363 6020  titions - `asc` 
+00012680: 6f72 2060 6465 7363 602e 2044 6566 6175  or `desc`. Defau
+00012690: 6c74 2069 7320 6064 6573 6360 2e0a 2020  lt is `desc`..  
+000126a0: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
+000126b0: 4c69 7374 206f 6620 6d61 7463 6869 6e67  List of matching
+000126c0: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
+000126d0: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
+000126e0: 2e46 6561 7475 7265 5365 7460 206f 626a  .FeatureSet` obj
+000126f0: 6563 7473 2e0a 2020 2020 2020 2020 2222  ects..        ""
+00012700: 220a 0a20 2020 2020 2020 2070 726f 6a65  "..        proje
+00012710: 6374 203d 2070 726f 6a65 6374 206f 7220  ct = project or 
+00012720: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
+00012730: 726f 6a65 6374 0a0a 2020 2020 2020 2020  roject..        
+00012740: 7061 7261 6d73 203d 207b 0a20 2020 2020  params = {.     
+00012750: 2020 2020 2020 2022 6e61 6d65 223a 206e         "name": n
+00012760: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00012770: 2022 7374 6174 6522 3a20 7374 6174 652c   "state": state,
+00012780: 0a20 2020 2020 2020 2020 2020 2022 7461  .            "ta
+00012790: 6722 3a20 7461 672c 0a20 2020 2020 2020  g": tag,.       
+000127a0: 2020 2020 2022 656e 7469 7479 223a 2065       "entity": e
+000127b0: 6e74 6974 6965 7320 6f72 205b 5d2c 0a20  ntities or [],. 
+000127c0: 2020 2020 2020 2020 2020 2022 6665 6174             "feat
+000127d0: 7572 6522 3a20 6665 6174 7572 6573 206f  ure": features o
+000127e0: 7220 5b5d 2c0a 2020 2020 2020 2020 2020  r [],.          
+000127f0: 2020 226c 6162 656c 223a 206c 6162 656c    "label": label
+00012800: 7320 6f72 205b 5d2c 0a20 2020 2020 2020  s or [],.       
+00012810: 207d 0a20 2020 2020 2020 2069 6620 7061   }.        if pa
+00012820: 7274 6974 696f 6e5f 6279 3a0a 2020 2020  rtition_by:.    
+00012830: 2020 2020 2020 2020 7061 7261 6d73 2e75          params.u
+00012840: 7064 6174 6528 0a20 2020 2020 2020 2020  pdate(.         
+00012850: 2020 2020 2020 2073 656c 662e 5f67 656e         self._gen
+00012860: 6572 6174 655f 7061 7274 6974 696f 6e5f  erate_partition_
+00012870: 6279 5f70 6172 616d 7328 0a20 2020 2020  by_params(.     
+00012880: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00012890: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+000128a0: 6d61 732e 4665 6174 7572 6553 746f 7265  mas.FeatureStore
+000128b0: 5061 7274 6974 696f 6e42 7946 6965 6c64  PartitionByField
+000128c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000128d0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+000128e0: 6279 2c0a 2020 2020 2020 2020 2020 2020  by,.            
+000128f0: 2020 2020 2020 2020 726f 7773 5f70 6572          rows_per
+00012900: 5f70 6172 7469 7469 6f6e 2c0a 2020 2020  _partition,.    
+00012910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012920: 7061 7274 6974 696f 6e5f 736f 7274 5f62  partition_sort_b
+00012930: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00012940: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00012950: 5f6f 7264 6572 2c0a 2020 2020 2020 2020  _order,.        
+00012960: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00012970: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00012980: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
+00012990: 7473 2f7b 7072 6f6a 6563 747d 2f66 6561  ts/{project}/fea
+000129a0: 7475 7265 2d73 6574 7322 0a0a 2020 2020  ture-sets"..    
+000129b0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+000129c0: 6520 3d20 280a 2020 2020 2020 2020 2020  e = (.          
+000129d0: 2020 6622 4661 696c 6564 206c 6973 7469    f"Failed listi
+000129e0: 6e67 2066 6561 7475 7265 2d73 6574 732c  ng feature-sets,
+000129f0: 2070 726f 6a65 6374 3a20 7b70 726f 6a65   project: {proje
+00012a00: 6374 7d2c 2071 7565 7279 3a20 7b70 6172  ct}, query: {par
+00012a10: 616d 737d 220a 2020 2020 2020 2020 290a  ams}".        ).
+00012a20: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
+00012a30: 656c 662e 6170 695f 6361 6c6c 2822 4745  elf.api_call("GE
+00012a40: 5422 2c20 7061 7468 2c20 6572 726f 725f  T", path, error_
+00012a50: 6d65 7373 6167 652c 2070 6172 616d 733d  message, params=
+00012a60: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00012a70: 6665 6174 7572 655f 7365 7473 203d 2072  feature_sets = r
+00012a80: 6573 702e 6a73 6f6e 2829 5b22 6665 6174  esp.json()["feat
+00012a90: 7572 655f 7365 7473 225d 0a20 2020 2020  ure_sets"].     
+00012aa0: 2020 2069 6620 6665 6174 7572 655f 7365     if feature_se
+00012ab0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00012ac0: 7265 7475 726e 205b 4665 6174 7572 6553  return [FeatureS
+00012ad0: 6574 2e66 726f 6d5f 6469 6374 286f 626a  et.from_dict(obj
+00012ae0: 2920 666f 7220 6f62 6a20 696e 2066 6561  ) for obj in fea
+00012af0: 7475 7265 5f73 6574 735d 0a0a 2020 2020  ture_sets]..    
+00012b00: 6465 6620 7374 6f72 655f 6665 6174 7572  def store_featur
+00012b10: 655f 7365 7428 0a20 2020 2020 2020 2073  e_set(.        s
+00012b20: 656c 662c 0a20 2020 2020 2020 2066 6561  elf,.        fea
+00012b30: 7475 7265 5f73 6574 3a20 556e 696f 6e5b  ture_set: Union[
+00012b40: 6469 6374 2c20 6d6c 7275 6e2e 636f 6d6d  dict, mlrun.comm
+00012b50: 6f6e 2e73 6368 656d 6173 2e46 6561 7475  on.schemas.Featu
+00012b60: 7265 5365 742c 2046 6561 7475 7265 5365  reSet, FeatureSe
+00012b70: 745d 2c0a 2020 2020 2020 2020 6e61 6d65  t],.        name
+00012b80: 3d4e 6f6e 652c 0a20 2020 2020 2020 2070  =None,.        p
+00012b90: 726f 6a65 6374 3d22 222c 0a20 2020 2020  roject="",.     
+00012ba0: 2020 2074 6167 3d4e 6f6e 652c 0a20 2020     tag=None,.   
+00012bb0: 2020 2020 2075 6964 3d4e 6f6e 652c 0a20       uid=None,. 
+00012bc0: 2020 2020 2020 2076 6572 7369 6f6e 6564         versioned
+00012bd0: 3d54 7275 652c 0a20 2020 2029 202d 3e20  =True,.    ) -> 
+00012be0: 6469 6374 3a0a 2020 2020 2020 2020 2222  dict:.        ""
+00012bf0: 2253 6176 6520 6120 3a70 793a 636c 6173  "Save a :py:clas
+00012c00: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
+00012c10: 655f 7374 6f72 652e 4665 6174 7572 6553  e_store.FeatureS
+00012c20: 6574 6020 6f62 6a65 6374 2069 6e20 7468  et` object in th
+00012c30: 6520 3a70 793a 6d6f 643a 606d 6c72 756e  e :py:mod:`mlrun
+00012c40: 6020 4442 2e20 5468 650a 2020 2020 2020  ` DB. The.      
+00012c50: 2020 6665 6174 7572 652d 7365 7420 6361    feature-set ca
+00012c60: 6e20 6265 2065 6974 6865 7220 6120 6e65  n be either a ne
+00012c70: 7720 6f62 6a65 6374 206f 7220 6120 6d6f  w object or a mo
+00012c80: 6469 6669 6361 7469 6f6e 2074 6f20 6578  dification to ex
+00012c90: 6973 7469 6e67 206f 626a 6563 7420 7265  isting object re
+00012ca0: 6665 7265 6e63 6564 2062 7920 7468 6520  ferenced by the 
+00012cb0: 7061 7261 6d73 206f 660a 2020 2020 2020  params of.      
+00012cc0: 2020 7468 6520 6675 6e63 7469 6f6e 2e0a    the function..
+00012cd0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00012ce0: 6665 6174 7572 655f 7365 743a 2054 6865  feature_set: The
+00012cf0: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
+00012d00: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
+00012d10: 2e46 6561 7475 7265 5365 7460 2074 6f20  .FeatureSet` to 
+00012d20: 7374 6f72 652e 0a20 2020 2020 2020 203a  store..        :
+00012d30: 7061 7261 6d20 6e61 6d65 3a20 2020 204e  param name:    N
+00012d40: 616d 6520 6f66 2066 6561 7475 7265 2073  ame of feature s
+00012d50: 6574 2e0a 2020 2020 2020 2020 3a70 6172  et..        :par
+00012d60: 616d 2070 726f 6a65 6374 3a20 4e61 6d65  am project: Name
+00012d70: 206f 6620 7072 6f6a 6563 7420 7468 6973   of project this
+00012d80: 2066 6561 7475 7265 2d73 6574 2062 656c   feature-set bel
+00012d90: 6f6e 6773 2074 6f2e 0a20 2020 2020 2020  ongs to..       
+00012da0: 203a 7061 7261 6d20 7461 673a 2054 6865   :param tag: The
+00012db0: 2060 6074 6167 6060 206f 6620 7468 6520   ``tag`` of the 
+00012dc0: 6f62 6a65 6374 2074 6f20 7265 706c 6163  object to replac
+00012dd0: 6520 696e 2074 6865 2044 422c 2066 6f72  e in the DB, for
+00012de0: 2065 7861 6d70 6c65 2060 606c 6174 6573   example ``lates
+00012df0: 7460 602e 0a20 2020 2020 2020 203a 7061  t``..        :pa
+00012e00: 7261 6d20 7569 643a 2054 6865 2060 6075  ram uid: The ``u
+00012e10: 6964 6060 206f 6620 7468 6520 6f62 6a65  id`` of the obje
+00012e20: 6374 2074 6f20 7265 706c 6163 6520 696e  ct to replace in
+00012e30: 2074 6865 2044 422e 2049 6620 7573 696e   the DB. If usin
+00012e40: 6720 7468 6973 2070 6172 616d 6574 6572  g this parameter
+00012e50: 2c20 7468 6520 6d6f 6469 6669 6564 206f  , the modified o
+00012e60: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
+00012e70: 2020 6d75 7374 2068 6176 6520 7468 6520    must have the 
+00012e80: 7361 6d65 2060 6075 6964 6060 206f 6620  same ``uid`` of 
+00012e90: 7468 6520 7072 6576 696f 7573 6c79 2d65  the previously-e
+00012ea0: 7869 7374 696e 6720 6f62 6a65 6374 2e20  xisting object. 
+00012eb0: 5468 6973 2063 616e 6e6f 7420 6265 2075  This cannot be u
+00012ec0: 7365 6420 666f 7220 6e6f 6e2d 7665 7273  sed for non-vers
+00012ed0: 696f 6e65 6420 6f62 6a65 6374 732e 0a20  ioned objects.. 
+00012ee0: 2020 2020 2020 203a 7061 7261 6d20 7665         :param ve
+00012ef0: 7273 696f 6e65 643a 2057 6865 7468 6572  rsioned: Whether
+00012f00: 2074 6f20 6d61 696e 7461 696e 2076 6572   to maintain ver
+00012f10: 7369 6f6e 7320 666f 7220 7468 6973 2066  sions for this f
+00012f20: 6561 7475 7265 2d73 6574 2e20 416c 6c20  eature-set. All 
+00012f30: 7665 7273 696f 6e73 206f 6620 6120 7665  versions of a ve
+00012f40: 7273 696f 6e65 6420 6f62 6a65 6374 0a20  rsioned object. 
+00012f50: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
+00012f60: 6265 206b 6570 7420 696e 2074 6865 2044  be kept in the D
+00012f70: 4220 616e 6420 6361 6e20 6265 2072 6574  B and can be ret
+00012f80: 7269 6576 6564 2075 6e74 696c 2065 7870  rieved until exp
+00012f90: 6c69 6369 746c 7920 6465 6c65 7465 642e  licitly deleted.
+00012fa0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00012fb0: 733a 2054 6865 203a 7079 3a63 6c61 7373  s: The :py:class
+00012fc0: 3a60 7e6d 6c72 756e 2e66 6561 7475 7265  :`~mlrun.feature
+00012fd0: 5f73 746f 7265 2e46 6561 7475 7265 5365  _store.FeatureSe
+00012fe0: 7460 206f 626a 6563 7420 2861 7320 6469  t` object (as di
+00012ff0: 6374 292e 0a20 2020 2020 2020 2022 2222  ct)..        """
+00013000: 0a0a 2020 2020 2020 2020 7265 6665 7265  ..        refere
+00013010: 6e63 6520 3d20 7365 6c66 2e5f 7265 736f  nce = self._reso
+00013020: 6c76 655f 7265 6665 7265 6e63 6528 7461  lve_reference(ta
+00013030: 672c 2075 6964 290a 2020 2020 2020 2020  g, uid).        
+00013040: 7061 7261 6d73 203d 207b 2276 6572 7369  params = {"versi
+00013050: 6f6e 6564 223a 2076 6572 7369 6f6e 6564  oned": versioned
+00013060: 7d0a 0a20 2020 2020 2020 2069 6620 6973  }..        if is
+00013070: 696e 7374 616e 6365 2866 6561 7475 7265  instance(feature
+00013080: 5f73 6574 2c20 6d6c 7275 6e2e 636f 6d6d  _set, mlrun.comm
+00013090: 6f6e 2e73 6368 656d 6173 2e46 6561 7475  on.schemas.Featu
+000130a0: 7265 5365 7429 3a0a 2020 2020 2020 2020  reSet):.        
+000130b0: 2020 2020 6665 6174 7572 655f 7365 7420      feature_set 
+000130c0: 3d20 6665 6174 7572 655f 7365 742e 6469  = feature_set.di
+000130d0: 6374 2829 0a20 2020 2020 2020 2065 6c69  ct().        eli
+000130e0: 6620 6973 696e 7374 616e 6365 2866 6561  f isinstance(fea
+000130f0: 7475 7265 5f73 6574 2c20 4665 6174 7572  ture_set, Featur
+00013100: 6553 6574 293a 0a20 2020 2020 2020 2020  eSet):.         
+00013110: 2020 2066 6561 7475 7265 5f73 6574 203d     feature_set =
+00013120: 2066 6561 7475 7265 5f73 6574 2e74 6f5f   feature_set.to_
+00013130: 6469 6374 2829 0a0a 2020 2020 2020 2020  dict()..        
+00013140: 6e61 6d65 203d 206e 616d 6520 6f72 2066  name = name or f
+00013150: 6561 7475 7265 5f73 6574 5b22 6d65 7461  eature_set["meta
+00013160: 6461 7461 225d 5b22 6e61 6d65 225d 0a20  data"]["name"]. 
+00013170: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+00013180: 2028 0a20 2020 2020 2020 2020 2020 2070   (.            p
+00013190: 726f 6a65 6374 206f 7220 6665 6174 7572  roject or featur
+000131a0: 655f 7365 745b 226d 6574 6164 6174 6122  e_set["metadata"
+000131b0: 5d2e 6765 7428 2270 726f 6a65 6374 2229  ].get("project")
+000131c0: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
+000131d0: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
+000131e0: 2020 2029 0a20 2020 2020 2020 2070 6174     ).        pat
+000131f0: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
+00013200: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
+00013210: 2d73 6574 732f 7b6e 616d 657d 2f72 6566  -sets/{name}/ref
+00013220: 6572 656e 6365 732f 7b72 6566 6572 656e  erences/{referen
+00013230: 6365 7d22 0a20 2020 2020 2020 2065 7272  ce}".        err
+00013240: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
+00013250: 6169 6c65 6420 7374 6f72 696e 6720 6665  ailed storing fe
+00013260: 6174 7572 652d 7365 7420 7b70 726f 6a65  ature-set {proje
+00013270: 6374 7d2f 7b6e 616d 657d 220a 2020 2020  ct}/{name}".    
+00013280: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+00013290: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+000132a0: 2020 2020 2020 2250 5554 222c 2070 6174        "PUT", pat
+000132b0: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
+000132c0: 2c20 7061 7261 6d73 3d70 6172 616d 732c  , params=params,
+000132d0: 2062 6f64 793d 6469 6374 5f74 6f5f 6a73   body=dict_to_js
+000132e0: 6f6e 2866 6561 7475 7265 5f73 6574 290a  on(feature_set).
+000132f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00013300: 2020 7265 7475 726e 2072 6573 702e 6a73    return resp.js
+00013310: 6f6e 2829 0a0a 2020 2020 6465 6620 7061  on()..    def pa
+00013320: 7463 685f 6665 6174 7572 655f 7365 7428  tch_feature_set(
+00013330: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00013340: 2020 2020 2020 206e 616d 652c 0a20 2020         name,.   
+00013350: 2020 2020 2066 6561 7475 7265 5f73 6574       feature_set
+00013360: 5f75 7064 6174 653a 2064 6963 742c 0a20  _update: dict,. 
+00013370: 2020 2020 2020 2070 726f 6a65 6374 3d22         project="
+00013380: 222c 0a20 2020 2020 2020 2074 6167 3d4e  ",.        tag=N
+00013390: 6f6e 652c 0a20 2020 2020 2020 2075 6964  one,.        uid
+000133a0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2070  =None,.        p
+000133b0: 6174 6368 5f6d 6f64 653a 2055 6e69 6f6e  atch_mode: Union
+000133c0: 5b0a 2020 2020 2020 2020 2020 2020 7374  [.            st
+000133d0: 722c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  r, mlrun.common.
+000133e0: 7363 6865 6d61 732e 5061 7463 684d 6f64  schemas.PatchMod
+000133f0: 650a 2020 2020 2020 2020 5d20 3d20 6d6c  e.        ] = ml
+00013400: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00013410: 6173 2e50 6174 6368 4d6f 6465 2e72 6570  as.PatchMode.rep
+00013420: 6c61 6365 2c0a 2020 2020 293a 0a20 2020  lace,.    ):.   
+00013430: 2020 2020 2022 2222 4d6f 6469 6679 2028       """Modify (
+00013440: 7061 7463 6829 2061 6e20 6578 6973 7469  patch) an existi
+00013450: 6e67 203a 7079 3a63 6c61 7373 3a60 7e6d  ng :py:class:`~m
+00013460: 6c72 756e 2e66 6561 7475 7265 5f73 746f  lrun.feature_sto
+00013470: 7265 2e46 6561 7475 7265 5365 7460 206f  re.FeatureSet` o
+00013480: 626a 6563 742e 0a20 2020 2020 2020 2054  bject..        T
+00013490: 6865 206f 626a 6563 7420 6973 2069 6465  he object is ide
+000134a0: 6e74 6966 6965 6420 6279 2069 7473 206e  ntified by its n
+000134b0: 616d 6520 2861 6e64 2070 726f 6a65 6374  ame (and project
+000134c0: 2069 7420 6265 6c6f 6e67 7320 746f 292c   it belongs to),
+000134d0: 2061 7320 7765 6c6c 2061 7320 6f70 7469   as well as opti
+000134e0: 6f6e 616c 6c79 2061 2060 6074 6167 6060  onally a ``tag``
+000134f0: 206f 7220 6974 730a 2020 2020 2020 2020   or its.        
+00013500: 6060 7569 6460 6020 2866 6f72 2076 6572  ``uid`` (for ver
+00013510: 7369 6f6e 6564 206f 626a 6563 7429 2e20  sioned object). 
+00013520: 4966 2062 6f74 6820 6060 7461 6760 6020  If both ``tag`` 
+00013530: 616e 6420 6060 7569 6460 6020 6172 6520  and ``uid`` are 
+00013540: 6f6d 6974 7465 6420 7468 656e 2074 6865  omitted then the
+00013550: 206f 626a 6563 7420 7769 7468 2074 6167   object with tag
+00013560: 2060 606c 6174 6573 7460 600a 2020 2020   ``latest``.    
+00013570: 2020 2020 6973 206d 6f64 6966 6965 642e      is modified.
+00013580: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00013590: 206e 616d 653a 204e 616d 6520 6f66 2074   name: Name of t
+000135a0: 6865 206f 626a 6563 7420 746f 2070 6174  he object to pat
+000135b0: 6368 2e0a 2020 2020 2020 2020 3a70 6172  ch..        :par
+000135c0: 616d 2066 6561 7475 7265 5f73 6574 5f75  am feature_set_u
+000135d0: 7064 6174 653a 2054 6865 206d 6f64 6966  pdate: The modif
+000135e0: 6963 6174 696f 6e73 206e 6565 6465 6420  ications needed 
+000135f0: 696e 2074 6865 206f 626a 6563 742e 2054  in the object. T
+00013600: 6869 7320 7061 7261 6d65 7465 7220 6f6e  his parameter on
+00013610: 6c79 2068 6173 2074 6865 2063 6861 6e67  ly has the chang
+00013620: 6573 2069 6e20 6974 2c0a 2020 2020 2020  es in it,.      
+00013630: 2020 2020 2020 6e6f 7420 6120 6675 6c6c        not a full
+00013640: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+00013650: 2020 2020 2045 7861 6d70 6c65 3a3a 0a0a       Example::..
+00013660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013670: 6665 6174 7572 655f 7365 745f 7570 6461  feature_set_upda
+00013680: 7465 203d 207b 2273 7461 7475 7322 3a20  te = {"status": 
+00013690: 7b22 7072 6f63 6573 7365 6422 203a 2054  {"processed" : T
+000136a0: 7275 657d 7d0a 0a20 2020 2020 2020 2020  rue}}..         
+000136b0: 2020 2057 696c 6c20 6170 706c 7920 7468     Will apply th
+000136c0: 6520 6669 656c 6420 6060 7374 6174 7573  e field ``status
+000136d0: 2e70 726f 6365 7373 6564 6060 2074 6f20  .processed`` to 
+000136e0: 7468 6520 6578 6973 7469 6e67 206f 626a  the existing obj
+000136f0: 6563 742e 0a20 2020 2020 2020 203a 7061  ect..        :pa
+00013700: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
+00013710: 6a65 6374 2077 6869 6368 2063 6f6e 7461  ject which conta
+00013720: 696e 7320 7468 6520 6d6f 6469 6669 6564  ins the modified
+00013730: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+00013740: 203a 7061 7261 6d20 7461 673a 2054 6865   :param tag: The
+00013750: 2074 6167 206f 6620 7468 6520 6f62 6a65   tag of the obje
+00013760: 6374 2074 6f20 6d6f 6469 6679 2e0a 2020  ct to modify..  
+00013770: 2020 2020 2020 3a70 6172 616d 2075 6964        :param uid
+00013780: 3a20 7569 6420 6f66 2074 6865 206f 626a  : uid of the obj
+00013790: 6563 7420 746f 206d 6f64 6966 792e 0a20  ect to modify.. 
+000137a0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+000137b0: 7463 685f 6d6f 6465 3a20 5468 6520 7374  tch_mode: The st
+000137c0: 7261 7465 6779 2066 6f72 206d 6572 6769  rategy for mergi
+000137d0: 6e67 2074 6865 2063 6861 6e67 6573 2077  ng the changes w
+000137e0: 6974 6820 7468 6520 6578 6973 7469 6e67  ith the existing
+000137f0: 206f 626a 6563 742e 2043 616e 2062 6520   object. Can be 
+00013800: 6569 7468 6572 2060 6072 6570 6c61 6365  either ``replace
+00013810: 6060 0a20 2020 2020 2020 2020 2020 206f  ``.            o
+00013820: 7220 6060 6164 6469 7469 7665 6060 2e0a  r ``additive``..
+00013830: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013840: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
+00013850: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
+00013860: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
+00013870: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
+00013880: 6520 3d20 7365 6c66 2e5f 7265 736f 6c76  e = self._resolv
+00013890: 655f 7265 6665 7265 6e63 6528 7461 672c  e_reference(tag,
+000138a0: 2075 6964 290a 2020 2020 2020 2020 6865   uid).        he
+000138b0: 6164 6572 7320 3d20 7b6d 6c72 756e 2e63  aders = {mlrun.c
+000138c0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4865  ommon.schemas.He
+000138d0: 6164 6572 4e61 6d65 732e 7061 7463 685f  aderNames.patch_
+000138e0: 6d6f 6465 3a20 7061 7463 685f 6d6f 6465  mode: patch_mode
+000138f0: 7d0a 2020 2020 2020 2020 7061 7468 203d  }.        path =
+00013900: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+00013910: 6a65 6374 7d2f 6665 6174 7572 652d 7365  ject}/feature-se
+00013920: 7473 2f7b 6e61 6d65 7d2f 7265 6665 7265  ts/{name}/refere
+00013930: 6e63 6573 2f7b 7265 6665 7265 6e63 657d  nces/{reference}
+00013940: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
+00013950: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+00013960: 6564 2075 7064 6174 696e 6720 6665 6174  ed updating feat
+00013970: 7572 652d 7365 7420 7b70 726f 6a65 6374  ure-set {project
+00013980: 7d2f 7b6e 616d 657d 220a 2020 2020 2020  }/{name}".      
+00013990: 2020 7365 6c66 2e61 7069 5f63 616c 6c28    self.api_call(
+000139a0: 0a20 2020 2020 2020 2020 2020 2022 5041  .            "PA
+000139b0: 5443 4822 2c0a 2020 2020 2020 2020 2020  TCH",.          
+000139c0: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
+000139d0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+000139e0: 652c 0a20 2020 2020 2020 2020 2020 2062  e,.            b
+000139f0: 6f64 793d 6469 6374 5f74 6f5f 6a73 6f6e  ody=dict_to_json
+00013a00: 2866 6561 7475 7265 5f73 6574 5f75 7064  (feature_set_upd
+00013a10: 6174 6529 2c0a 2020 2020 2020 2020 2020  ate),.          
+00013a20: 2020 6865 6164 6572 733d 6865 6164 6572    headers=header
+00013a30: 732c 0a20 2020 2020 2020 2029 0a0a 2020  s,.        )..  
+00013a40: 2020 6465 6620 6465 6c65 7465 5f66 6561    def delete_fea
+00013a50: 7475 7265 5f73 6574 2873 656c 662c 206e  ture_set(self, n
+00013a60: 616d 652c 2070 726f 6a65 6374 3d22 222c  ame, project="",
+00013a70: 2074 6167 3d4e 6f6e 652c 2075 6964 3d4e   tag=None, uid=N
+00013a80: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00013a90: 2244 656c 6574 6520 6120 3a70 793a 636c  "Delete a :py:cl
+00013aa0: 6173 733a 607e 6d6c 7275 6e2e 6665 6174  ass:`~mlrun.feat
+00013ab0: 7572 655f 7374 6f72 652e 4665 6174 7572  ure_store.Featur
+00013ac0: 6553 6574 6020 6f62 6a65 6374 2066 726f  eSet` object fro
+00013ad0: 6d20 7468 6520 4442 2e0a 2020 2020 2020  m the DB..      
+00013ae0: 2020 4966 2060 6074 6167 6060 206f 7220    If ``tag`` or 
+00013af0: 6060 7569 6460 6020 6172 6520 7370 6563  ``uid`` are spec
+00013b00: 6966 6965 642c 2074 6865 6e20 6a75 7374  ified, then just
+00013b10: 2074 6865 2076 6572 7369 6f6e 2072 6566   the version ref
+00013b20: 6572 656e 6365 6420 6279 2074 6865 6d20  erenced by them 
+00013b30: 7769 6c6c 2062 6520 6465 6c65 7465 642e  will be deleted.
+00013b40: 2055 7369 6e67 2062 6f74 680a 2020 2020   Using both.    
+00013b50: 2020 2020 6973 206e 6f74 2061 6c6c 6f77      is not allow
+00013b60: 6564 2e0a 2020 2020 2020 2020 4966 206e  ed..        If n
+00013b70: 6f6e 6520 6172 6520 7370 6563 6966 6965  one are specifie
+00013b80: 642c 2074 6865 6e20 616c 6c20 696e 7374  d, then all inst
+00013b90: 616e 6365 7320 6f66 2074 6865 206f 626a  ances of the obj
+00013ba0: 6563 7420 7768 6f73 6520 6e61 6d65 2069  ect whose name i
+00013bb0: 7320 6060 6e61 6d65 6060 2077 696c 6c20  s ``name`` will 
+00013bc0: 6265 2064 656c 6574 6564 2e0a 2020 2020  be deleted..    
+00013bd0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00013be0: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
+00013bf0: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
+00013c00: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
+00013c10: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
+00013c20: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
+00013c30: 6665 6174 7572 652d 7365 7473 2f7b 6e61  feature-sets/{na
+00013c40: 6d65 7d22 0a0a 2020 2020 2020 2020 6966  me}"..        if
+00013c50: 2074 6167 206f 7220 7569 643a 0a20 2020   tag or uid:.   
+00013c60: 2020 2020 2020 2020 2072 6566 6572 656e           referen
+00013c70: 6365 203d 2073 656c 662e 5f72 6573 6f6c  ce = self._resol
+00013c80: 7665 5f72 6566 6572 656e 6365 2874 6167  ve_reference(tag
+00013c90: 2c20 7569 6429 0a20 2020 2020 2020 2020  , uid).         
+00013ca0: 2020 2070 6174 6820 3d20 7061 7468 202b     path = path +
+00013cb0: 2066 222f 7265 6665 7265 6e63 6573 2f7b   f"/references/{
+00013cc0: 7265 6665 7265 6e63 657d 220a 0a20 2020  reference}"..   
+00013cd0: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+00013ce0: 6765 203d 2066 2246 6169 6c65 6420 6465  ge = f"Failed de
+00013cf0: 6c65 7469 6e67 2066 6561 7475 7265 2d73  leting feature-s
+00013d00: 6574 207b 6e61 6d65 7d22 0a20 2020 2020  et {name}".     
+00013d10: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
+00013d20: 2822 4445 4c45 5445 222c 2070 6174 682c  ("DELETE", path,
+00013d30: 2065 7272 6f72 5f6d 6573 7361 6765 290a   error_message).
+00013d40: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+00013d50: 6665 6174 7572 655f 7665 6374 6f72 280a  feature_vector(.
+00013d60: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00013d70: 2020 2020 2020 6665 6174 7572 655f 7665        feature_ve
+00013d80: 6374 6f72 3a20 556e 696f 6e5b 6469 6374  ctor: Union[dict
+00013d90: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+00013da0: 6368 656d 6173 2e46 6561 7475 7265 5665  chemas.FeatureVe
+00013db0: 6374 6f72 2c20 4665 6174 7572 6556 6563  ctor, FeatureVec
+00013dc0: 746f 725d 2c0a 2020 2020 2020 2020 7072  tor],.        pr
+00013dd0: 6f6a 6563 743d 2222 2c0a 2020 2020 2020  oject="",.      
+00013de0: 2020 7665 7273 696f 6e65 643d 5472 7565    versioned=True
+00013df0: 2c0a 2020 2020 2920 2d3e 2064 6963 743a  ,.    ) -> dict:
+00013e00: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+00013e10: 7465 2061 206e 6577 203a 7079 3a63 6c61  te a new :py:cla
+00013e20: 7373 3a60 7e6d 6c72 756e 2e66 6561 7475  ss:`~mlrun.featu
+00013e30: 7265 5f73 746f 7265 2e46 6561 7475 7265  re_store.Feature
+00013e40: 5665 6374 6f72 6020 616e 6420 7361 7665  Vector` and save
+00013e50: 2069 6e20 7468 6520 3a70 793a 6d6f 643a   in the :py:mod:
+00013e60: 606d 6c72 756e 6020 4442 2e0a 0a20 2020  `mlrun` DB...   
+00013e70: 2020 2020 203a 7061 7261 6d20 6665 6174       :param feat
+00013e80: 7572 655f 7665 6374 6f72 3a20 5468 6520  ure_vector: The 
+00013e90: 6e65 7720 3a70 793a 636c 6173 733a 607e  new :py:class:`~
+00013ea0: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
+00013eb0: 6f72 652e 4665 6174 7572 6556 6563 746f  ore.FeatureVecto
+00013ec0: 7260 2074 6f20 6372 6561 7465 2e0a 2020  r` to create..  
+00013ed0: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
+00013ee0: 6a65 6374 3a20 4e61 6d65 206f 6620 7072  ject: Name of pr
+00013ef0: 6f6a 6563 7420 7468 6973 2066 6561 7475  oject this featu
+00013f00: 7265 2d76 6563 746f 7220 6265 6c6f 6e67  re-vector belong
+00013f10: 7320 746f 2e0a 2020 2020 2020 2020 3a70  s to..        :p
+00013f20: 6172 616d 2076 6572 7369 6f6e 6564 3a20  aram versioned: 
+00013f30: 5768 6574 6865 7220 746f 206d 6169 6e74  Whether to maint
+00013f40: 6169 6e20 7665 7273 696f 6e73 2066 6f72  ain versions for
+00013f50: 2074 6869 7320 6665 6174 7572 652d 7665   this feature-ve
+00013f60: 6374 6f72 2e20 416c 6c20 7665 7273 696f  ctor. All versio
+00013f70: 6e73 206f 6620 6120 7665 7273 696f 6e65  ns of a versione
+00013f80: 6420 6f62 6a65 6374 0a20 2020 2020 2020  d object.       
+00013f90: 2020 2020 2077 696c 6c20 6265 206b 6570       will be kep
+00013fa0: 7420 696e 2074 6865 2044 4220 616e 6420  t in the DB and 
+00013fb0: 6361 6e20 6265 2072 6574 7269 6576 6564  can be retrieved
+00013fc0: 2075 6e74 696c 2065 7870 6c69 6369 746c   until explicitl
+00013fd0: 7920 6465 6c65 7465 642e 0a20 2020 2020  y deleted..     
+00013fe0: 2020 203a 7265 7475 726e 733a 2054 6865     :returns: The
+00013ff0: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
+00014000: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
+00014010: 2e46 6561 7475 7265 5665 6374 6f72 6020  .FeatureVector` 
+00014020: 6f62 6a65 6374 2028 6173 2064 6963 7429  object (as dict)
+00014030: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00014040: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00014050: 6e63 6528 6665 6174 7572 655f 7665 6374  nce(feature_vect
+00014060: 6f72 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  or, mlrun.common
+00014070: 2e73 6368 656d 6173 2e46 6561 7475 7265  .schemas.Feature
+00014080: 5665 6374 6f72 293a 0a20 2020 2020 2020  Vector):.       
+00014090: 2020 2020 2066 6561 7475 7265 5f76 6563       feature_vec
+000140a0: 746f 7220 3d20 6665 6174 7572 655f 7665  tor = feature_ve
+000140b0: 6374 6f72 2e64 6963 7428 290a 2020 2020  ctor.dict().    
+000140c0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+000140d0: 6e63 6528 6665 6174 7572 655f 7665 6374  nce(feature_vect
+000140e0: 6f72 2c20 4665 6174 7572 6556 6563 746f  or, FeatureVecto
+000140f0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00014100: 6665 6174 7572 655f 7665 6374 6f72 203d  feature_vector =
+00014110: 2066 6561 7475 7265 5f76 6563 746f 722e   feature_vector.
+00014120: 746f 5f64 6963 7428 290a 0a20 2020 2020  to_dict()..     
+00014130: 2020 2070 726f 6a65 6374 203d 2028 0a20     project = (. 
+00014140: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
+00014150: 6374 0a20 2020 2020 2020 2020 2020 206f  ct.            o
+00014160: 7220 6665 6174 7572 655f 7665 6374 6f72  r feature_vector
+00014170: 5b22 6d65 7461 6461 7461 225d 2e67 6574  ["metadata"].get
+00014180: 2822 7072 6f6a 6563 7422 2c20 4e6f 6e65  ("project", None
+00014190: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
+000141a0: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+000141b0: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+000141c0: 290a 2020 2020 2020 2020 7061 7468 203d  ).        path =
+000141d0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+000141e0: 6a65 6374 7d2f 6665 6174 7572 652d 7665  ject}/feature-ve
+000141f0: 6374 6f72 7322 0a20 2020 2020 2020 2070  ctors".        p
+00014200: 6172 616d 7320 3d20 7b22 7665 7273 696f  arams = {"versio
+00014210: 6e65 6422 3a20 7665 7273 696f 6e65 647d  ned": versioned}
+00014220: 0a0a 2020 2020 2020 2020 6e61 6d65 203d  ..        name =
+00014230: 2066 6561 7475 7265 5f76 6563 746f 725b   feature_vector[
+00014240: 226d 6574 6164 6174 6122 5d5b 226e 616d  "metadata"]["nam
+00014250: 6522 5d0a 2020 2020 2020 2020 6572 726f  e"].        erro
+00014260: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
+00014270: 696c 6564 2063 7265 6174 696e 6720 6665  iled creating fe
+00014280: 6174 7572 652d 7665 6374 6f72 207b 7072  ature-vector {pr
+00014290: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
+000142a0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
+000142b0: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
+000142c0: 2020 2020 2020 2020 2022 504f 5354 222c           "POST",
+000142d0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+000142e0: 682c 0a20 2020 2020 2020 2020 2020 2065  h,.            e
+000142f0: 7272 6f72 5f6d 6573 7361 6765 2c0a 2020  rror_message,.  
+00014300: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00014310: 3d70 6172 616d 732c 0a20 2020 2020 2020  =params,.       
+00014320: 2020 2020 2062 6f64 793d 6469 6374 5f74       body=dict_t
+00014330: 6f5f 6a73 6f6e 2866 6561 7475 7265 5f76  o_json(feature_v
+00014340: 6563 746f 7229 2c0a 2020 2020 2020 2020  ector),.        
+00014350: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00014360: 2072 6573 702e 6a73 6f6e 2829 0a0a 2020   resp.json()..  
+00014370: 2020 6465 6620 6765 745f 6665 6174 7572    def get_featur
+00014380: 655f 7665 6374 6f72 280a 2020 2020 2020  e_vector(.      
+00014390: 2020 7365 6c66 2c20 6e61 6d65 3a20 7374    self, name: st
+000143a0: 722c 2070 726f 6a65 6374 3a20 7374 7220  r, project: str 
+000143b0: 3d20 2222 2c20 7461 673a 2073 7472 203d  = "", tag: str =
+000143c0: 204e 6f6e 652c 2075 6964 3a20 7374 7220   None, uid: str 
+000143d0: 3d20 4e6f 6e65 0a20 2020 2029 202d 3e20  = None.    ) -> 
+000143e0: 4665 6174 7572 6556 6563 746f 723a 0a20  FeatureVector:. 
+000143f0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00014400: 2061 2073 7065 6369 6669 6320 6665 6174   a specific feat
+00014410: 7572 652d 7665 6374 6f72 2072 6566 6572  ure-vector refer
+00014420: 656e 6365 6420 6279 2069 7473 2074 6167  enced by its tag
+00014430: 206f 7220 7569 642e 2049 6620 6e6f 6e65   or uid. If none
+00014440: 2061 7265 2070 726f 7669 6465 642c 2060   are provided, `
+00014450: 606c 6174 6573 7460 6020 7461 6720 7769  `latest`` tag wi
+00014460: 6c6c 0a20 2020 2020 2020 2062 6520 7573  ll.        be us
+00014470: 6564 2e22 2222 0a0a 2020 2020 2020 2020  ed."""..        
+00014480: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
+00014490: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
+000144a0: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
+000144b0: 2020 2020 7265 6665 7265 6e63 6520 3d20      reference = 
+000144c0: 7365 6c66 2e5f 7265 736f 6c76 655f 7265  self._resolve_re
+000144d0: 6665 7265 6e63 6528 7461 672c 2075 6964  ference(tag, uid
+000144e0: 290a 2020 2020 2020 2020 7061 7468 203d  ).        path =
+000144f0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+00014500: 6a65 6374 7d2f 6665 6174 7572 652d 7665  ject}/feature-ve
+00014510: 6374 6f72 732f 7b6e 616d 657d 2f72 6566  ctors/{name}/ref
+00014520: 6572 656e 6365 732f 7b72 6566 6572 656e  erences/{referen
+00014530: 6365 7d22 0a20 2020 2020 2020 2065 7272  ce}".        err
+00014540: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
+00014550: 6169 6c65 6420 7265 7472 6965 7669 6e67  ailed retrieving
+00014560: 2066 6561 7475 7265 2d76 6563 746f 7220   feature-vector 
+00014570: 7b70 726f 6a65 6374 7d2f 7b6e 616d 657d  {project}/{name}
+00014580: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
+00014590: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+000145a0: 4745 5422 2c20 7061 7468 2c20 6572 726f  GET", path, erro
+000145b0: 725f 6d65 7373 6167 6529 0a20 2020 2020  r_message).     
+000145c0: 2020 2072 6574 7572 6e20 4665 6174 7572     return Featur
+000145d0: 6556 6563 746f 722e 6672 6f6d 5f64 6963  eVector.from_dic
+000145e0: 7428 7265 7370 2e6a 736f 6e28 2929 0a0a  t(resp.json())..
+000145f0: 2020 2020 6465 6620 6c69 7374 5f66 6561      def list_fea
+00014600: 7475 7265 5f76 6563 746f 7273 280a 2020  ture_vectors(.  
+00014610: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00014620: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
+00014630: 203d 2022 222c 0a20 2020 2020 2020 206e   = "",.        n
+00014640: 616d 653a 2073 7472 203d 204e 6f6e 652c  ame: str = None,
+00014650: 0a20 2020 2020 2020 2074 6167 3a20 7374  .        tag: st
+00014660: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+00014670: 2020 7374 6174 653a 2073 7472 203d 204e    state: str = N
+00014680: 6f6e 652c 0a20 2020 2020 2020 206c 6162  one,.        lab
+00014690: 656c 733a 204c 6973 745b 7374 725d 203d  els: List[str] =
+000146a0: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
+000146b0: 6172 7469 7469 6f6e 5f62 793a 2055 6e69  artition_by: Uni
+000146c0: 6f6e 5b0a 2020 2020 2020 2020 2020 2020  on[.            
+000146d0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+000146e0: 656d 6173 2e46 6561 7475 7265 5374 6f72  emas.FeatureStor
+000146f0: 6550 6172 7469 7469 6f6e 4279 4669 656c  ePartitionByFiel
+00014700: 642c 2073 7472 0a20 2020 2020 2020 205d  d, str.        ]
+00014710: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00014720: 2072 6f77 735f 7065 725f 7061 7274 6974   rows_per_partit
+00014730: 696f 6e3a 2069 6e74 203d 2031 2c0a 2020  ion: int = 1,.  
+00014740: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+00014750: 736f 7274 5f62 793a 2055 6e69 6f6e 5b6d  sort_by: Union[m
+00014760: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00014770: 6d61 732e 536f 7274 4669 656c 642c 2073  mas.SortField, s
+00014780: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00014790: 2020 2020 7061 7274 6974 696f 6e5f 6f72      partition_or
+000147a0: 6465 723a 2055 6e69 6f6e 5b0a 2020 2020  der: Union[.    
+000147b0: 2020 2020 2020 2020 6d6c 7275 6e2e 636f          mlrun.co
+000147c0: 6d6d 6f6e 2e73 6368 656d 6173 2e4f 7264  mmon.schemas.Ord
+000147d0: 6572 5479 7065 2c20 7374 720a 2020 2020  erType, str.    
+000147e0: 2020 2020 5d20 3d20 6d6c 7275 6e2e 636f      ] = mlrun.co
+000147f0: 6d6d 6f6e 2e73 6368 656d 6173 2e4f 7264  mmon.schemas.Ord
+00014800: 6572 5479 7065 2e64 6573 632c 0a20 2020  erType.desc,.   
+00014810: 2029 202d 3e20 4c69 7374 5b46 6561 7475   ) -> List[Featu
+00014820: 7265 5665 6374 6f72 5d3a 0a20 2020 2020  reVector]:.     
+00014830: 2020 2022 2222 5265 7472 6965 7665 2061     """Retrieve a
+00014840: 206c 6973 7420 6f66 2066 6561 7475 7265   list of feature
+00014850: 2d76 6563 746f 7273 206d 6174 6368 696e  -vectors matchin
+00014860: 6720 7468 6520 6372 6974 6572 6961 2070  g the criteria p
+00014870: 726f 7669 6465 642e 0a0a 2020 2020 2020  rovided...      
+00014880: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+00014890: 3a20 5072 6f6a 6563 7420 6e61 6d65 2e0a  : Project name..
+000148a0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+000148b0: 616d 653a 204e 616d 6520 6f66 2066 6561  ame: Name of fea
+000148c0: 7475 7265 2d76 6563 746f 7220 746f 206d  ture-vector to m
+000148d0: 6174 6368 2e20 5468 6973 2069 7320 6120  atch. This is a 
+000148e0: 6c69 6b65 2071 7565 7279 2c20 616e 6420  like query, and 
+000148f0: 6973 2063 6173 652d 696e 7365 6e73 6974  is case-insensit
+00014900: 6976 652e 0a20 2020 2020 2020 203a 7061  ive..        :pa
+00014910: 7261 6d20 7461 673a 204d 6174 6368 2066  ram tag: Match f
+00014920: 6561 7475 7265 2d76 6563 746f 7273 2077  eature-vectors w
+00014930: 6974 6820 7370 6563 6966 6963 2074 6167  ith specific tag
+00014940: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00014950: 2073 7461 7465 3a20 4d61 7463 6820 6665   state: Match fe
+00014960: 6174 7572 652d 7665 6374 6f72 7320 7769  ature-vectors wi
+00014970: 7468 2061 2073 7065 6369 6669 6320 7374  th a specific st
+00014980: 6174 652e 0a20 2020 2020 2020 203a 7061  ate..        :pa
+00014990: 7261 6d20 6c61 6265 6c73 3a20 4d61 7463  ram labels: Matc
+000149a0: 6820 6665 6174 7572 652d 7665 6374 6f72  h feature-vector
+000149b0: 7320 7768 6963 6820 6861 7665 2074 6865  s which have the
+000149c0: 7365 206c 6162 656c 732e 0a20 2020 2020  se labels..     
+000149d0: 2020 203a 7061 7261 6d20 7061 7274 6974     :param partit
+000149e0: 696f 6e5f 6279 3a20 4669 656c 6420 746f  ion_by: Field to
+000149f0: 2067 726f 7570 2072 6573 756c 7473 2062   group results b
+00014a00: 792e 204f 6e6c 7920 616c 6c6f 7765 6420  y. Only allowed 
+00014a10: 7661 6c75 6520 6973 2060 6e61 6d65 602e  value is `name`.
+00014a20: 2057 6865 6e20 6070 6172 7469 7469 6f6e   When `partition
+00014a30: 5f62 7960 2069 7320 7370 6563 6966 6965  _by` is specifie
+00014a40: 642c 0a20 2020 2020 2020 2020 2020 2074  d,.            t
+00014a50: 6865 2060 7061 7274 6974 696f 6e5f 736f  he `partition_so
+00014a60: 7274 5f62 7960 2070 6172 616d 6574 6572  rt_by` parameter
+00014a70: 206d 7573 7420 6265 2070 726f 7669 6465   must be provide
+00014a80: 6420 6173 2077 656c 6c2e 0a20 2020 2020  d as well..     
+00014a90: 2020 203a 7061 7261 6d20 726f 7773 5f70     :param rows_p
+00014aa0: 6572 5f70 6172 7469 7469 6f6e 3a20 486f  er_partition: Ho
+00014ab0: 7720 6d61 6e79 2074 6f70 2072 6f77 7320  w many top rows 
+00014ac0: 2870 6572 2073 6f72 7469 6e67 2064 6566  (per sorting def
+00014ad0: 696e 6564 2062 7920 6070 6172 7469 7469  ined by `partiti
+00014ae0: 6f6e 5f73 6f72 745f 6279 6020 616e 6420  on_sort_by` and 
+00014af0: 6070 6172 7469 7469 6f6e 5f6f 7264 6572  `partition_order
+00014b00: 6029 0a20 2020 2020 2020 2020 2020 2074  `).            t
+00014b10: 6f20 7265 7475 726e 2070 6572 2067 726f  o return per gro
+00014b20: 7570 2e20 4465 6661 756c 7420 7661 6c75  up. Default valu
+00014b30: 6520 6973 2031 2e0a 2020 2020 2020 2020  e is 1..        
+00014b40: 3a70 6172 616d 2070 6172 7469 7469 6f6e  :param partition
+00014b50: 5f73 6f72 745f 6279 3a20 5768 6174 2066  _sort_by: What f
+00014b60: 6965 6c64 2074 6f20 736f 7274 2074 6865  ield to sort the
+00014b70: 2072 6573 756c 7473 2062 792c 2077 6974   results by, wit
+00014b80: 6869 6e20 6561 6368 2070 6172 7469 7469  hin each partiti
+00014b90: 6f6e 2064 6566 696e 6564 2062 7920 6070  on defined by `p
+00014ba0: 6172 7469 7469 6f6e 5f62 7960 2e0a 2020  artition_by`..  
+00014bb0: 2020 2020 2020 2020 2020 4375 7272 656e            Curren
+00014bc0: 746c 7920 7468 6520 6f6e 6c79 2061 6c6c  tly the only all
+00014bd0: 6f77 6564 2076 616c 7565 7320 6172 6520  owed values are 
+00014be0: 6063 7265 6174 6564 6020 616e 6420 6075  `created` and `u
+00014bf0: 7064 6174 6564 602e 0a20 2020 2020 2020  pdated`..       
+00014c00: 203a 7061 7261 6d20 7061 7274 6974 696f   :param partitio
+00014c10: 6e5f 6f72 6465 723a 204f 7264 6572 206f  n_order: Order o
+00014c20: 6620 736f 7274 696e 6720 7769 7468 696e  f sorting within
+00014c30: 2070 6172 7469 7469 6f6e 7320 2d20 6061   partitions - `a
+00014c40: 7363 6020 6f72 2060 6465 7363 602e 2044  sc` or `desc`. D
+00014c50: 6566 6175 6c74 2069 7320 6064 6573 6360  efault is `desc`
+00014c60: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00014c70: 6e73 3a20 4c69 7374 206f 6620 6d61 7463  ns: List of matc
+00014c80: 6869 6e67 203a 7079 3a63 6c61 7373 3a60  hing :py:class:`
+00014c90: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
+00014ca0: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
+00014cb0: 6f72 6020 6f62 6a65 6374 732e 0a20 2020  or` objects..   
+00014cc0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00014cd0: 2020 7072 6f6a 6563 7420 3d20 7072 6f6a    project = proj
+00014ce0: 6563 7420 6f72 2063 6f6e 6669 672e 6465  ect or config.de
+00014cf0: 6661 756c 745f 7072 6f6a 6563 740a 0a20  fault_project.. 
+00014d00: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+00014d10: 7b0a 2020 2020 2020 2020 2020 2020 226e  {.            "n
+00014d20: 616d 6522 3a20 6e61 6d65 2c0a 2020 2020  ame": name,.    
+00014d30: 2020 2020 2020 2020 2273 7461 7465 223a          "state":
+00014d40: 2073 7461 7465 2c0a 2020 2020 2020 2020   state,.        
+00014d50: 2020 2020 2274 6167 223a 2074 6167 2c0a      "tag": tag,.
+00014d60: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
+00014d70: 656c 223a 206c 6162 656c 7320 6f72 205b  el": labels or [
+00014d80: 5d2c 0a20 2020 2020 2020 207d 0a20 2020  ],.        }.   
+00014d90: 2020 2020 2069 6620 7061 7274 6974 696f       if partitio
+00014da0: 6e5f 6279 3a0a 2020 2020 2020 2020 2020  n_by:.          
+00014db0: 2020 7061 7261 6d73 2e75 7064 6174 6528    params.update(
+00014dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014dd0: 2073 656c 662e 5f67 656e 6572 6174 655f   self._generate_
+00014de0: 7061 7274 6974 696f 6e5f 6279 5f70 6172  partition_by_par
+00014df0: 616d 7328 0a20 2020 2020 2020 2020 2020  ams(.           
+00014e00: 2020 2020 2020 2020 206d 6c72 756e 2e63           mlrun.c
+00014e10: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4665  ommon.schemas.Fe
+00014e20: 6174 7572 6553 746f 7265 5061 7274 6974  atureStorePartit
+00014e30: 696f 6e42 7946 6965 6c64 2c0a 2020 2020  ionByField,.    
+00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e50: 7061 7274 6974 696f 6e5f 6279 2c0a 2020  partition_by,.  
+00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e70: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
+00014e80: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+00014e90: 2020 2020 2020 2020 2020 7061 7274 6974            partit
+00014ea0: 696f 6e5f 736f 7274 5f62 792c 0a20 2020  ion_sort_by,.   
+00014eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ec0: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
+00014ed0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014ee0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00014ef0: 290a 0a20 2020 2020 2020 2070 6174 6820  )..        path 
+00014f00: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+00014f10: 6f6a 6563 747d 2f66 6561 7475 7265 2d76  oject}/feature-v
+00014f20: 6563 746f 7273 220a 0a20 2020 2020 2020  ectors"..       
+00014f30: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+00014f40: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
+00014f50: 2246 6169 6c65 6420 6c69 7374 696e 6720  "Failed listing 
+00014f60: 6665 6174 7572 652d 7665 6374 6f72 732c  feature-vectors,
+00014f70: 2070 726f 6a65 6374 3a20 7b70 726f 6a65   project: {proje
+00014f80: 6374 7d2c 2071 7565 7279 3a20 7b70 6172  ct}, query: {par
+00014f90: 616d 737d 220a 2020 2020 2020 2020 290a  ams}".        ).
+00014fa0: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
+00014fb0: 656c 662e 6170 695f 6361 6c6c 2822 4745  elf.api_call("GE
+00014fc0: 5422 2c20 7061 7468 2c20 6572 726f 725f  T", path, error_
+00014fd0: 6d65 7373 6167 652c 2070 6172 616d 733d  message, params=
+00014fe0: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00014ff0: 6665 6174 7572 655f 7665 6374 6f72 7320  feature_vectors 
+00015000: 3d20 7265 7370 2e6a 736f 6e28 295b 2266  = resp.json()["f
+00015010: 6561 7475 7265 5f76 6563 746f 7273 225d  eature_vectors"]
+00015020: 0a20 2020 2020 2020 2069 6620 6665 6174  .        if feat
+00015030: 7572 655f 7665 6374 6f72 733a 0a20 2020  ure_vectors:.   
+00015040: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00015050: 5b46 6561 7475 7265 5665 6374 6f72 2e66  [FeatureVector.f
+00015060: 726f 6d5f 6469 6374 286f 626a 2920 666f  rom_dict(obj) fo
+00015070: 7220 6f62 6a20 696e 2066 6561 7475 7265  r obj in feature
+00015080: 5f76 6563 746f 7273 5d0a 0a20 2020 2064  _vectors]..    d
+00015090: 6566 2073 746f 7265 5f66 6561 7475 7265  ef store_feature
+000150a0: 5f76 6563 746f 7228 0a20 2020 2020 2020  _vector(.       
+000150b0: 2073 656c 662c 0a20 2020 2020 2020 2066   self,.        f
+000150c0: 6561 7475 7265 5f76 6563 746f 723a 2055  eature_vector: U
+000150d0: 6e69 6f6e 5b64 6963 742c 206d 6c72 756e  nion[dict, mlrun
+000150e0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+000150f0: 4665 6174 7572 6556 6563 746f 722c 2046  FeatureVector, F
+00015100: 6561 7475 7265 5665 6374 6f72 5d2c 0a20  eatureVector],. 
+00015110: 2020 2020 2020 206e 616d 653d 4e6f 6e65         name=None
+00015120: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+00015130: 743d 2222 2c0a 2020 2020 2020 2020 7461  t="",.        ta
+00015140: 673d 4e6f 6e65 2c0a 2020 2020 2020 2020  g=None,.        
+00015150: 7569 643d 4e6f 6e65 2c0a 2020 2020 2020  uid=None,.      
+00015160: 2020 7665 7273 696f 6e65 643d 5472 7565    versioned=True
+00015170: 2c0a 2020 2020 2920 2d3e 2064 6963 743a  ,.    ) -> dict:
+00015180: 0a20 2020 2020 2020 2022 2222 5374 6f72  .        """Stor
+00015190: 6520 6120 3a70 793a 636c 6173 733a 607e  e a :py:class:`~
+000151a0: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
+000151b0: 6f72 652e 4665 6174 7572 6556 6563 746f  ore.FeatureVecto
+000151c0: 7260 206f 626a 6563 7420 696e 2074 6865  r` object in the
+000151d0: 203a 7079 3a6d 6f64 3a60 6d6c 7275 6e60   :py:mod:`mlrun`
+000151e0: 2044 422e 2054 6865 0a20 2020 2020 2020   DB. The.       
+000151f0: 2066 6561 7475 7265 2d76 6563 746f 7220   feature-vector 
+00015200: 6361 6e20 6265 2065 6974 6865 7220 6120  can be either a 
+00015210: 6e65 7720 6f62 6a65 6374 206f 7220 6120  new object or a 
+00015220: 6d6f 6469 6669 6361 7469 6f6e 2074 6f20  modification to 
+00015230: 6578 6973 7469 6e67 206f 626a 6563 7420  existing object 
+00015240: 7265 6665 7265 6e63 6564 2062 7920 7468  referenced by th
+00015250: 6520 7061 7261 6d73 0a20 2020 2020 2020  e params.       
+00015260: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
+00015270: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00015280: 6d20 6665 6174 7572 655f 7665 6374 6f72  m feature_vector
+00015290: 3a20 5468 6520 3a70 793a 636c 6173 733a  : The :py:class:
+000152a0: 607e 6d6c 7275 6e2e 6665 6174 7572 655f  `~mlrun.feature_
+000152b0: 7374 6f72 652e 4665 6174 7572 6556 6563  store.FeatureVec
+000152c0: 746f 7260 2074 6f20 7374 6f72 652e 0a20  tor` to store.. 
+000152d0: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
+000152e0: 6d65 3a20 2020 204e 616d 6520 6f66 2066  me:    Name of f
+000152f0: 6561 7475 7265 2076 6563 746f 722e 0a20  eature vector.. 
+00015300: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+00015310: 6f6a 6563 743a 204e 616d 6520 6f66 2070  oject: Name of p
+00015320: 726f 6a65 6374 2074 6869 7320 6665 6174  roject this feat
+00015330: 7572 652d 7665 6374 6f72 2062 656c 6f6e  ure-vector belon
+00015340: 6773 2074 6f2e 0a20 2020 2020 2020 203a  gs to..        :
+00015350: 7061 7261 6d20 7461 673a 2054 6865 2060  param tag: The `
+00015360: 6074 6167 6060 206f 6620 7468 6520 6f62  `tag`` of the ob
+00015370: 6a65 6374 2074 6f20 7265 706c 6163 6520  ject to replace 
+00015380: 696e 2074 6865 2044 422c 2066 6f72 2065  in the DB, for e
+00015390: 7861 6d70 6c65 2060 606c 6174 6573 7460  xample ``latest`
+000153a0: 602e 0a20 2020 2020 2020 203a 7061 7261  `..        :para
+000153b0: 6d20 7569 643a 2054 6865 2060 6075 6964  m uid: The ``uid
+000153c0: 6060 206f 6620 7468 6520 6f62 6a65 6374  `` of the object
+000153d0: 2074 6f20 7265 706c 6163 6520 696e 2074   to replace in t
+000153e0: 6865 2044 422e 2049 6620 7573 696e 6720  he DB. If using 
+000153f0: 7468 6973 2070 6172 616d 6574 6572 2c20  this parameter, 
+00015400: 7468 6520 6d6f 6469 6669 6564 206f 626a  the modified obj
+00015410: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
+00015420: 6d75 7374 2068 6176 6520 7468 6520 7361  must have the sa
+00015430: 6d65 2060 6075 6964 6060 206f 6620 7468  me ``uid`` of th
+00015440: 6520 7072 6576 696f 7573 6c79 2d65 7869  e previously-exi
+00015450: 7374 696e 6720 6f62 6a65 6374 2e20 5468  sting object. Th
+00015460: 6973 2063 616e 6e6f 7420 6265 2075 7365  is cannot be use
+00015470: 6420 666f 7220 6e6f 6e2d 7665 7273 696f  d for non-versio
+00015480: 6e65 6420 6f62 6a65 6374 732e 0a20 2020  ned objects..   
+00015490: 2020 2020 203a 7061 7261 6d20 7665 7273       :param vers
+000154a0: 696f 6e65 643a 2057 6865 7468 6572 2074  ioned: Whether t
+000154b0: 6f20 6d61 696e 7461 696e 2076 6572 7369  o maintain versi
+000154c0: 6f6e 7320 666f 7220 7468 6973 2066 6561  ons for this fea
+000154d0: 7475 7265 2d76 6563 746f 722e 2041 6c6c  ture-vector. All
+000154e0: 2076 6572 7369 6f6e 7320 6f66 2061 2076   versions of a v
+000154f0: 6572 7369 6f6e 6564 206f 626a 6563 740a  ersioned object.
+00015500: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00015510: 2062 6520 6b65 7074 2069 6e20 7468 6520   be kept in the 
+00015520: 4442 2061 6e64 2063 616e 2062 6520 7265  DB and can be re
+00015530: 7472 6965 7665 6420 756e 7469 6c20 6578  trieved until ex
+00015540: 706c 6963 6974 6c79 2064 656c 6574 6564  plicitly deleted
+00015550: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00015560: 6e73 3a20 5468 6520 3a70 793a 636c 6173  ns: The :py:clas
+00015570: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
+00015580: 655f 7374 6f72 652e 4665 6174 7572 6556  e_store.FeatureV
+00015590: 6563 746f 7260 206f 626a 6563 7420 2861  ector` object (a
+000155a0: 7320 6469 6374 292e 0a20 2020 2020 2020  s dict)..       
+000155b0: 2022 2222 0a0a 2020 2020 2020 2020 7265   """..        re
+000155c0: 6665 7265 6e63 6520 3d20 7365 6c66 2e5f  ference = self._
+000155d0: 7265 736f 6c76 655f 7265 6665 7265 6e63  resolve_referenc
+000155e0: 6528 7461 672c 2075 6964 290a 2020 2020  e(tag, uid).    
+000155f0: 2020 2020 7061 7261 6d73 203d 207b 2276      params = {"v
+00015600: 6572 7369 6f6e 6564 223a 2076 6572 7369  ersioned": versi
+00015610: 6f6e 6564 7d0a 0a20 2020 2020 2020 2069  oned}..        i
+00015620: 6620 6973 696e 7374 616e 6365 2866 6561  f isinstance(fea
+00015630: 7475 7265 5f76 6563 746f 722c 206d 6c72  ture_vector, mlr
+00015640: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+00015650: 732e 4665 6174 7572 6556 6563 746f 7229  s.FeatureVector)
+00015660: 3a0a 2020 2020 2020 2020 2020 2020 6665  :.            fe
+00015670: 6174 7572 655f 7665 6374 6f72 203d 2066  ature_vector = f
+00015680: 6561 7475 7265 5f76 6563 746f 722e 6469  eature_vector.di
+00015690: 6374 2829 0a20 2020 2020 2020 2065 6c69  ct().        eli
+000156a0: 6620 6973 696e 7374 616e 6365 2866 6561  f isinstance(fea
+000156b0: 7475 7265 5f76 6563 746f 722c 2046 6561  ture_vector, Fea
+000156c0: 7475 7265 5665 6374 6f72 293a 0a20 2020  tureVector):.   
+000156d0: 2020 2020 2020 2020 2066 6561 7475 7265           feature
+000156e0: 5f76 6563 746f 7220 3d20 6665 6174 7572  _vector = featur
+000156f0: 655f 7665 6374 6f72 2e74 6f5f 6469 6374  e_vector.to_dict
+00015700: 2829 0a0a 2020 2020 2020 2020 6e61 6d65  ()..        name
+00015710: 203d 206e 616d 6520 6f72 2066 6561 7475   = name or featu
+00015720: 7265 5f76 6563 746f 725b 226d 6574 6164  re_vector["metad
+00015730: 6174 6122 5d5b 226e 616d 6522 5d0a 2020  ata"]["name"].  
+00015740: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
+00015750: 280a 2020 2020 2020 2020 2020 2020 7072  (.            pr
+00015760: 6f6a 6563 740a 2020 2020 2020 2020 2020  oject.          
+00015770: 2020 6f72 2066 6561 7475 7265 5f76 6563    or feature_vec
+00015780: 746f 725b 226d 6574 6164 6174 6122 5d2e  tor["metadata"].
+00015790: 6765 7428 2270 726f 6a65 6374 2229 0a20  get("project"). 
+000157a0: 2020 2020 2020 2020 2020 206f 7220 636f             or co
+000157b0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
+000157c0: 6a65 6374 0a20 2020 2020 2020 2029 0a20  ject.        ). 
+000157d0: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+000157e0: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
+000157f0: 747d 2f66 6561 7475 7265 2d76 6563 746f  t}/feature-vecto
+00015800: 7273 2f7b 6e61 6d65 7d2f 7265 6665 7265  rs/{name}/refere
+00015810: 6e63 6573 2f7b 7265 6665 7265 6e63 657d  nces/{reference}
+00015820: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
+00015830: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+00015840: 6564 2073 746f 7269 6e67 2066 6561 7475  ed storing featu
+00015850: 7265 2d76 6563 746f 7220 7b70 726f 6a65  re-vector {proje
+00015860: 6374 7d2f 7b6e 616d 657d 220a 2020 2020  ct}/{name}".    
+00015870: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+00015880: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+00015890: 2020 2020 2020 2250 5554 222c 2070 6174        "PUT", pat
+000158a0: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
+000158b0: 2c20 7061 7261 6d73 3d70 6172 616d 732c  , params=params,
+000158c0: 2062 6f64 793d 6469 6374 5f74 6f5f 6a73   body=dict_to_js
+000158d0: 6f6e 2866 6561 7475 7265 5f76 6563 746f  on(feature_vecto
+000158e0: 7229 0a20 2020 2020 2020 2029 0a20 2020  r).        ).   
+000158f0: 2020 2020 2072 6574 7572 6e20 7265 7370       return resp
+00015900: 2e6a 736f 6e28 290a 0a20 2020 2064 6566  .json()..    def
+00015910: 2070 6174 6368 5f66 6561 7475 7265 5f76   patch_feature_v
+00015920: 6563 746f 7228 0a20 2020 2020 2020 2073  ector(.        s
+00015930: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
+00015940: 652c 0a20 2020 2020 2020 2066 6561 7475  e,.        featu
+00015950: 7265 5f76 6563 746f 725f 7570 6461 7465  re_vector_update
+00015960: 3a20 6469 6374 2c0a 2020 2020 2020 2020  : dict,.        
+00015970: 7072 6f6a 6563 743d 2222 2c0a 2020 2020  project="",.    
+00015980: 2020 2020 7461 673d 4e6f 6e65 2c0a 2020      tag=None,.  
+00015990: 2020 2020 2020 7569 643d 4e6f 6e65 2c0a        uid=None,.
+000159a0: 2020 2020 2020 2020 7061 7463 685f 6d6f          patch_mo
+000159b0: 6465 3a20 556e 696f 6e5b 0a20 2020 2020  de: Union[.     
+000159c0: 2020 2020 2020 2073 7472 2c20 6d6c 7275         str, mlru
+000159d0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+000159e0: 2e50 6174 6368 4d6f 6465 0a20 2020 2020  .PatchMode.     
+000159f0: 2020 205d 203d 206d 6c72 756e 2e63 6f6d     ] = mlrun.com
+00015a00: 6d6f 6e2e 7363 6865 6d61 732e 5061 7463  mon.schemas.Patc
+00015a10: 684d 6f64 652e 7265 706c 6163 652c 0a20  hMode.replace,. 
+00015a20: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00015a30: 224d 6f64 6966 7920 2870 6174 6368 2920  "Modify (patch) 
+00015a40: 616e 2065 7869 7374 696e 6720 3a70 793a  an existing :py:
+00015a50: 636c 6173 733a 607e 6d6c 7275 6e2e 6665  class:`~mlrun.fe
+00015a60: 6174 7572 655f 7374 6f72 652e 4665 6174  ature_store.Feat
+00015a70: 7572 6556 6563 746f 7260 206f 626a 6563  ureVector` objec
+00015a80: 742e 0a20 2020 2020 2020 2054 6865 206f  t..        The o
+00015a90: 626a 6563 7420 6973 2069 6465 6e74 6966  bject is identif
+00015aa0: 6965 6420 6279 2069 7473 206e 616d 6520  ied by its name 
+00015ab0: 2861 6e64 2070 726f 6a65 6374 2069 7420  (and project it 
+00015ac0: 6265 6c6f 6e67 7320 746f 292c 2061 7320  belongs to), as 
+00015ad0: 7765 6c6c 2061 7320 6f70 7469 6f6e 616c  well as optional
+00015ae0: 6c79 2061 2060 6074 6167 6060 206f 7220  ly a ``tag`` or 
+00015af0: 6974 730a 2020 2020 2020 2020 6060 7569  its.        ``ui
+00015b00: 6460 6020 2866 6f72 2076 6572 7369 6f6e  d`` (for version
+00015b10: 6564 206f 626a 6563 7429 2e20 4966 2062  ed object). If b
+00015b20: 6f74 6820 6060 7461 6760 6020 616e 6420  oth ``tag`` and 
+00015b30: 6060 7569 6460 6020 6172 6520 6f6d 6974  ``uid`` are omit
+00015b40: 7465 6420 7468 656e 2074 6865 206f 626a  ted then the obj
+00015b50: 6563 7420 7769 7468 2074 6167 2060 606c  ect with tag ``l
+00015b60: 6174 6573 7460 600a 2020 2020 2020 2020  atest``.        
+00015b70: 6973 206d 6f64 6966 6965 642e 0a0a 2020  is modified...  
+00015b80: 2020 2020 2020 3a70 6172 616d 206e 616d        :param nam
+00015b90: 653a 204e 616d 6520 6f66 2074 6865 206f  e: Name of the o
+00015ba0: 626a 6563 7420 746f 2070 6174 6368 2e0a  bject to patch..
+00015bb0: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+00015bc0: 6561 7475 7265 5f76 6563 746f 725f 7570  eature_vector_up
+00015bd0: 6461 7465 3a20 5468 6520 6d6f 6469 6669  date: The modifi
+00015be0: 6361 7469 6f6e 7320 6e65 6564 6564 2069  cations needed i
+00015bf0: 6e20 7468 6520 6f62 6a65 6374 2e20 5468  n the object. Th
+00015c00: 6973 2070 6172 616d 6574 6572 206f 6e6c  is parameter onl
+00015c10: 7920 6861 7320 7468 6520 6368 616e 6765  y has the change
+00015c20: 7320 696e 2069 742c 0a20 2020 2020 2020  s in it,.       
+00015c30: 2020 2020 206e 6f74 2061 2066 756c 6c20       not a full 
+00015c40: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
+00015c50: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
+00015c60: 5072 6f6a 6563 7420 7768 6963 6820 636f  Project which co
+00015c70: 6e74 6169 6e73 2074 6865 206d 6f64 6966  ntains the modif
+00015c80: 6965 6420 6f62 6a65 6374 2e0a 2020 2020  ied object..    
+00015c90: 2020 2020 3a70 6172 616d 2074 6167 3a20      :param tag: 
+00015ca0: 5468 6520 7461 6720 6f66 2074 6865 206f  The tag of the o
+00015cb0: 626a 6563 7420 746f 206d 6f64 6966 792e  bject to modify.
+00015cc0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00015cd0: 7569 643a 2075 6964 206f 6620 7468 6520  uid: uid of the 
+00015ce0: 6f62 6a65 6374 2074 6f20 6d6f 6469 6679  object to modify
+00015cf0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00015d00: 2070 6174 6368 5f6d 6f64 653a 2054 6865   patch_mode: The
+00015d10: 2073 7472 6174 6567 7920 666f 7220 6d65   strategy for me
+00015d20: 7267 696e 6720 7468 6520 6368 616e 6765  rging the change
+00015d30: 7320 7769 7468 2074 6865 2065 7869 7374  s with the exist
+00015d40: 696e 6720 6f62 6a65 6374 2e20 4361 6e20  ing object. Can 
+00015d50: 6265 2065 6974 6865 7220 6060 7265 706c  be either ``repl
+00015d60: 6163 6560 600a 2020 2020 2020 2020 2020  ace``.          
+00015d70: 2020 6f72 2060 6061 6464 6974 6976 6560    or ``additive`
+00015d80: 602e 0a20 2020 2020 2020 2022 2222 0a20  `..        """. 
+00015d90: 2020 2020 2020 2072 6566 6572 656e 6365         reference
+00015da0: 203d 2073 656c 662e 5f72 6573 6f6c 7665   = self._resolve
+00015db0: 5f72 6566 6572 656e 6365 2874 6167 2c20  _reference(tag, 
+00015dc0: 7569 6429 0a20 2020 2020 2020 2070 726f  uid).        pro
+00015dd0: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
+00015de0: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
+00015df0: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
+00015e00: 2068 6561 6465 7273 203d 207b 6d6c 7275   headers = {mlru
+00015e10: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00015e20: 2e48 6561 6465 724e 616d 6573 2e70 6174  .HeaderNames.pat
+00015e30: 6368 5f6d 6f64 653a 2070 6174 6368 5f6d  ch_mode: patch_m
+00015e40: 6f64 657d 0a20 2020 2020 2020 2070 6174  ode}.        pat
+00015e50: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
+00015e60: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
+00015e70: 2d76 6563 746f 7273 2f7b 6e61 6d65 7d2f  -vectors/{name}/
+00015e80: 7265 6665 7265 6e63 6573 2f7b 7265 6665  references/{refe
+00015e90: 7265 6e63 657d 220a 2020 2020 2020 2020  rence}".        
+00015ea0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+00015eb0: 6622 4661 696c 6564 2075 7064 6174 696e  f"Failed updatin
+00015ec0: 6720 6665 6174 7572 652d 7665 6374 6f72  g feature-vector
+00015ed0: 207b 7072 6f6a 6563 747d 2f7b 6e61 6d65   {project}/{name
+00015ee0: 7d22 0a20 2020 2020 2020 2073 656c 662e  }".        self.
+00015ef0: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+00015f00: 2020 2020 2020 2250 4154 4348 222c 0a20        "PATCH",. 
+00015f10: 2020 2020 2020 2020 2020 2070 6174 682c             path,
+00015f20: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+00015f30: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
+00015f40: 2020 2020 2020 2020 626f 6479 3d64 6963          body=dic
+00015f50: 745f 746f 5f6a 736f 6e28 6665 6174 7572  t_to_json(featur
+00015f60: 655f 7665 6374 6f72 5f75 7064 6174 6529  e_vector_update)
+00015f70: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
+00015f80: 6164 6572 733d 6865 6164 6572 732c 0a20  aders=headers,. 
+00015f90: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00015fa0: 6620 6465 6c65 7465 5f66 6561 7475 7265  f delete_feature
+00015fb0: 5f76 6563 746f 7228 7365 6c66 2c20 6e61  _vector(self, na
+00015fc0: 6d65 2c20 7072 6f6a 6563 743d 2222 2c20  me, project="", 
+00015fd0: 7461 673d 4e6f 6e65 2c20 7569 643d 4e6f  tag=None, uid=No
+00015fe0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00015ff0: 4465 6c65 7465 2061 203a 7079 3a63 6c61  Delete a :py:cla
+00016000: 7373 3a60 7e6d 6c72 756e 2e66 6561 7475  ss:`~mlrun.featu
+00016010: 7265 5f73 746f 7265 2e46 6561 7475 7265  re_store.Feature
+00016020: 5665 6374 6f72 6020 6f62 6a65 6374 2066  Vector` object f
+00016030: 726f 6d20 7468 6520 4442 2e0a 2020 2020  rom the DB..    
+00016040: 2020 2020 4966 2060 6074 6167 6060 206f      If ``tag`` o
+00016050: 7220 6060 7569 6460 6020 6172 6520 7370  r ``uid`` are sp
+00016060: 6563 6966 6965 642c 2074 6865 6e20 6a75  ecified, then ju
+00016070: 7374 2074 6865 2076 6572 7369 6f6e 2072  st the version r
+00016080: 6566 6572 656e 6365 6420 6279 2074 6865  eferenced by the
+00016090: 6d20 7769 6c6c 2062 6520 6465 6c65 7465  m will be delete
+000160a0: 642e 2055 7369 6e67 2062 6f74 680a 2020  d. Using both.  
+000160b0: 2020 2020 2020 6973 206e 6f74 2061 6c6c        is not all
+000160c0: 6f77 6564 2e0a 2020 2020 2020 2020 4966  owed..        If
+000160d0: 206e 6f6e 6520 6172 6520 7370 6563 6966   none are specif
+000160e0: 6965 642c 2074 6865 6e20 616c 6c20 696e  ied, then all in
+000160f0: 7374 616e 6365 7320 6f66 2074 6865 206f  stances of the o
+00016100: 626a 6563 7420 7768 6f73 6520 6e61 6d65  bject whose name
+00016110: 2069 7320 6060 6e61 6d65 6060 2077 696c   is ``name`` wil
+00016120: 6c20 6265 2064 656c 6574 6564 2e0a 2020  l be deleted..  
+00016130: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016140: 2020 7072 6f6a 6563 7420 3d20 7072 6f6a    project = proj
+00016150: 6563 7420 6f72 2063 6f6e 6669 672e 6465  ect or config.de
+00016160: 6661 756c 745f 7072 6f6a 6563 740a 2020  fault_project.  
+00016170: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
+00016180: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
+00016190: 7d2f 6665 6174 7572 652d 7665 6374 6f72  }/feature-vector
+000161a0: 732f 7b6e 616d 657d 220a 2020 2020 2020  s/{name}".      
+000161b0: 2020 6966 2074 6167 206f 7220 7569 643a    if tag or uid:
+000161c0: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
+000161d0: 6572 656e 6365 203d 2073 656c 662e 5f72  erence = self._r
+000161e0: 6573 6f6c 7665 5f72 6566 6572 656e 6365  esolve_reference
+000161f0: 2874 6167 2c20 7569 6429 0a20 2020 2020  (tag, uid).     
+00016200: 2020 2020 2020 2070 6174 6820 3d20 7061         path = pa
+00016210: 7468 202b 2066 222f 7265 6665 7265 6e63  th + f"/referenc
+00016220: 6573 2f7b 7265 6665 7265 6e63 657d 220a  es/{reference}".
+00016230: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+00016240: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+00016250: 6420 6465 6c65 7469 6e67 2066 6561 7475  d deleting featu
+00016260: 7265 2d76 6563 746f 7220 7b6e 616d 657d  re-vector {name}
+00016270: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
+00016280: 7069 5f63 616c 6c28 2244 454c 4554 4522  pi_call("DELETE"
+00016290: 2c20 7061 7468 2c20 6572 726f 725f 6d65  , path, error_me
+000162a0: 7373 6167 6529 0a0a 2020 2020 6465 6620  ssage)..    def 
+000162b0: 7461 675f 6f62 6a65 6374 7328 0a20 2020  tag_objects(.   
+000162c0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000162d0: 2020 2070 726f 6a65 6374 3a20 7374 722c     project: str,
+000162e0: 0a20 2020 2020 2020 2074 6167 5f6e 616d  .        tag_nam
+000162f0: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
+00016300: 6f62 6a65 6374 733a 2055 6e69 6f6e 5b6d  objects: Union[m
+00016310: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00016320: 6d61 732e 5461 674f 626a 6563 7473 2c20  mas.TagObjects, 
+00016330: 6469 6374 5d2c 0a20 2020 2020 2020 2072  dict],.        r
+00016340: 6570 6c61 6365 3a20 626f 6f6c 203d 2046  eplace: bool = F
+00016350: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
+00016360: 2020 2020 2022 2222 5461 6720 6120 6c69       """Tag a li
+00016370: 7374 206f 6620 6f62 6a65 6374 732e 0a0a  st of objects...
+00016380: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00016390: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
+000163a0: 7768 6963 6820 636f 6e74 6169 6e73 2074  which contains t
+000163b0: 6865 206f 626a 6563 7473 2e0a 2020 2020  he objects..    
+000163c0: 2020 2020 3a70 6172 616d 2074 6167 5f6e      :param tag_n
+000163d0: 616d 653a 2054 6865 2074 6167 2074 6f20  ame: The tag to 
+000163e0: 7365 7420 6f6e 2074 6865 206f 626a 6563  set on the objec
+000163f0: 7473 2e0a 2020 2020 2020 2020 3a70 6172  ts..        :par
+00016400: 616d 206f 626a 6563 7473 3a20 5468 6520  am objects: The 
+00016410: 6f62 6a65 6374 7320 746f 2074 6167 2e0a  objects to tag..
+00016420: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
+00016430: 6570 6c61 6365 3a20 5768 6574 6865 7220  eplace: Whether 
+00016440: 746f 2072 6570 6c61 6365 2074 6865 2065  to replace the e
+00016450: 7869 7374 696e 6720 7461 6773 206f 6620  xisting tags of 
+00016460: 7468 6520 6f62 6a65 6374 7320 6f72 2074  the objects or t
+00016470: 6f20 6164 6420 7468 6520 6e65 7720 7461  o add the new ta
+00016480: 6720 746f 2074 6865 6d2e 0a20 2020 2020  g to them..     
+00016490: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+000164a0: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
+000164b0: 732f 7b70 726f 6a65 6374 7d2f 7461 6773  s/{project}/tags
+000164c0: 2f7b 7461 675f 6e61 6d65 7d22 0a20 2020  /{tag_name}".   
+000164d0: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+000164e0: 6765 203d 2066 2246 6169 6c65 6420 746f  ge = f"Failed to
+000164f0: 2074 6167 207b 7461 675f 6e61 6d65 7d20   tag {tag_name} 
+00016500: 6f6e 206f 626a 6563 7473 207b 6f62 6a65  on objects {obje
+00016510: 6374 737d 220a 2020 2020 2020 2020 6d65  cts}".        me
+00016520: 7468 6f64 203d 2022 504f 5354 2220 6966  thod = "POST" if
+00016530: 2072 6570 6c61 6365 2065 6c73 6520 2250   replace else "P
+00016540: 5554 220a 2020 2020 2020 2020 7365 6c66  UT".        self
+00016550: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
+00016560: 2020 2020 2020 206d 6574 686f 642c 0a20         method,. 
+00016570: 2020 2020 2020 2020 2020 2070 6174 682c             path,
+00016580: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+00016590: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
+000165a0: 2020 2020 2020 2020 626f 6479 3d64 6963          body=dic
+000165b0: 745f 746f 5f6a 736f 6e28 0a20 2020 2020  t_to_json(.     
+000165c0: 2020 2020 2020 2020 2020 206f 626a 6563             objec
+000165d0: 7473 2e64 6963 7428 290a 2020 2020 2020  ts.dict().      
+000165e0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+000165f0: 6e73 7461 6e63 6528 6f62 6a65 6374 732c  nstance(objects,
+00016600: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+00016610: 6865 6d61 732e 5461 674f 626a 6563 7473  hemas.TagObjects
+00016620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016630: 2020 656c 7365 206f 626a 6563 7473 0a20    else objects. 
+00016640: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00016650: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00016660: 2064 656c 6574 655f 6f62 6a65 6374 735f   delete_objects_
+00016670: 7461 6728 0a20 2020 2020 2020 2073 656c  tag(.        sel
+00016680: 662c 0a20 2020 2020 2020 2070 726f 6a65  f,.        proje
+00016690: 6374 3a20 7374 722c 0a20 2020 2020 2020  ct: str,.       
+000166a0: 2074 6167 5f6e 616d 653a 2073 7472 2c0a   tag_name: str,.
+000166b0: 2020 2020 2020 2020 7461 675f 6f62 6a65          tag_obje
+000166c0: 6374 733a 2055 6e69 6f6e 5b6d 6c72 756e  cts: Union[mlrun
+000166d0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+000166e0: 5461 674f 626a 6563 7473 2c20 6469 6374  TagObjects, dict
+000166f0: 5d2c 0a20 2020 2029 3a0a 2020 2020 2020  ],.    ):.      
+00016700: 2020 2222 2244 656c 6574 6520 6120 7461    """Delete a ta
+00016710: 6720 6672 6f6d 2061 206c 6973 7420 6f66  g from a list of
+00016720: 206f 626a 6563 7473 2e0a 0a20 2020 2020   objects...     
+00016730: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00016740: 743a 2050 726f 6a65 6374 2077 6869 6368  t: Project which
+00016750: 2063 6f6e 7461 696e 7320 7468 6520 6f62   contains the ob
+00016760: 6a65 6374 732e 0a20 2020 2020 2020 203a  jects..        :
+00016770: 7061 7261 6d20 7461 675f 6e61 6d65 3a20  param tag_name: 
+00016780: 5468 6520 7461 6720 746f 2064 656c 6574  The tag to delet
+00016790: 6520 6672 6f6d 2074 6865 206f 626a 6563  e from the objec
+000167a0: 7473 2e0a 2020 2020 2020 2020 3a70 6172  ts..        :par
+000167b0: 616d 2074 6167 5f6f 626a 6563 7473 3a20  am tag_objects: 
+000167c0: 5468 6520 6f62 6a65 6374 7320 746f 2064  The objects to d
+000167d0: 656c 6574 6520 7468 6520 7461 6720 6672  elete the tag fr
+000167e0: 6f6d 2e0a 0a20 2020 2020 2020 2022 2222  om...        """
+000167f0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00016800: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+00016810: 6563 747d 2f74 6167 732f 7b74 6167 5f6e  ect}/tags/{tag_n
+00016820: 616d 657d 220a 2020 2020 2020 2020 6572  ame}".        er
+00016830: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
+00016840: 4661 696c 6564 2064 656c 6574 696e 6720  Failed deleting 
+00016850: 7461 6720 6672 6f6d 207b 7461 675f 6e61  tag from {tag_na
+00016860: 6d65 7d22 0a20 2020 2020 2020 2073 656c  me}".        sel
+00016870: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+00016880: 2020 2020 2020 2020 2244 454c 4554 4522          "DELETE"
+00016890: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+000168a0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+000168b0: 6572 726f 725f 6d65 7373 6167 652c 0a20  error_message,. 
+000168c0: 2020 2020 2020 2020 2020 2062 6f64 793d             body=
+000168d0: 6469 6374 5f74 6f5f 6a73 6f6e 280a 2020  dict_to_json(.  
+000168e0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+000168f0: 675f 6f62 6a65 6374 732e 6469 6374 2829  g_objects.dict()
+00016900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016910: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
+00016920: 6167 5f6f 626a 6563 7473 2c20 6d6c 7275  ag_objects, mlru
+00016930: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00016940: 2e54 6167 4f62 6a65 6374 7329 0a20 2020  .TagObjects).   
+00016950: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00016960: 6520 7461 675f 6f62 6a65 6374 730a 2020  e tag_objects.  
+00016970: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00016980: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00016990: 7461 675f 6172 7469 6661 6374 7328 0a20  tag_artifacts(. 
+000169a0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+000169b0: 2020 2020 2061 7274 6966 6163 7473 3a20       artifacts: 
+000169c0: 556e 696f 6e5b 4c69 7374 5b41 7274 6966  Union[List[Artif
+000169d0: 6163 745d 2c20 4c69 7374 5b64 6963 745d  act], List[dict]
+000169e0: 2c20 4172 7469 6661 6374 2c20 6469 6374  , Artifact, dict
+000169f0: 5d2c 0a20 2020 2020 2020 2070 726f 6a65  ],.        proje
+00016a00: 6374 3a20 7374 722c 0a20 2020 2020 2020  ct: str,.       
+00016a10: 2074 6167 5f6e 616d 653a 2073 7472 2c0a   tag_name: str,.
+00016a20: 2020 2020 2020 2020 7265 706c 6163 653a          replace:
+00016a30: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+00016a40: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00016a50: 2254 6167 2061 206c 6973 7420 6f66 2061  "Tag a list of a
+00016a60: 7274 6966 6163 7473 2e0a 0a20 2020 2020  rtifacts...     
+00016a70: 2020 203a 7061 7261 6d20 6172 7469 6661     :param artifa
+00016a80: 6374 733a 2054 6865 2061 7274 6966 6163  cts: The artifac
+00016a90: 7473 2074 6f20 7461 672e 2043 616e 2062  ts to tag. Can b
+00016aa0: 6520 6120 6c69 7374 206f 6620 3a70 793a  e a list of :py:
+00016ab0: 636c 6173 733a 607e 6d6c 7275 6e2e 6172  class:`~mlrun.ar
+00016ac0: 7469 6661 6374 732e 4172 7469 6661 6374  tifacts.Artifact
+00016ad0: 6020 6f62 6a65 6374 7320 6f72 0a20 2020  ` objects or.   
+00016ae0: 2020 2020 2020 2020 2064 6963 7469 6f6e           diction
+00016af0: 6172 6965 732c 206f 7220 6120 7369 6e67  aries, or a sing
+00016b00: 6c65 206f 626a 6563 742e 0a20 2020 2020  le object..     
+00016b10: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00016b20: 743a 2050 726f 6a65 6374 2077 6869 6368  t: Project which
+00016b30: 2063 6f6e 7461 696e 7320 7468 6520 6172   contains the ar
+00016b40: 7469 6661 6374 732e 0a20 2020 2020 2020  tifacts..       
+00016b50: 203a 7061 7261 6d20 7461 675f 6e61 6d65   :param tag_name
+00016b60: 3a20 5468 6520 7461 6720 746f 2073 6574  : The tag to set
+00016b70: 206f 6e20 7468 6520 6172 7469 6661 6374   on the artifact
+00016b80: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+00016b90: 6d20 7265 706c 6163 653a 2049 6620 5472  m replace: If Tr
+00016ba0: 7565 2c20 7265 706c 6163 6520 6578 6973  ue, replace exis
+00016bb0: 7469 6e67 2074 6167 732c 206f 7468 6572  ting tags, other
+00016bc0: 7769 7365 2061 7070 656e 6420 746f 2065  wise append to e
+00016bd0: 7869 7374 696e 6720 7461 6773 2e0a 2020  xisting tags..  
+00016be0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016bf0: 2020 7461 675f 6f62 6a65 6374 7320 3d20    tag_objects = 
+00016c00: 7365 6c66 2e5f 7265 736f 6c76 655f 6172  self._resolve_ar
+00016c10: 7469 6661 6374 735f 746f 5f74 6167 5f6f  tifacts_to_tag_o
+00016c20: 626a 6563 7473 2861 7274 6966 6163 7473  bjects(artifacts
+00016c30: 290a 2020 2020 2020 2020 7365 6c66 2e74  ).        self.t
+00016c40: 6167 5f6f 626a 6563 7473 2870 726f 6a65  ag_objects(proje
+00016c50: 6374 2c20 7461 675f 6e61 6d65 2c20 6f62  ct, tag_name, ob
+00016c60: 6a65 6374 733d 7461 675f 6f62 6a65 6374  jects=tag_object
+00016c70: 732c 2072 6570 6c61 6365 3d72 6570 6c61  s, replace=repla
+00016c80: 6365 290a 0a20 2020 2064 6566 2064 656c  ce)..    def del
+00016c90: 6574 655f 6172 7469 6661 6374 735f 7461  ete_artifacts_ta
+00016ca0: 6773 280a 2020 2020 2020 2020 7365 6c66  gs(.        self
+00016cb0: 2c0a 2020 2020 2020 2020 6172 7469 6661  ,.        artifa
+00016cc0: 6374 732c 0a20 2020 2020 2020 2070 726f  cts,.        pro
+00016cd0: 6a65 6374 3a20 7374 722c 0a20 2020 2020  ject: str,.     
+00016ce0: 2020 2074 6167 5f6e 616d 653a 2073 7472     tag_name: str
+00016cf0: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+00016d00: 2022 2222 4465 6c65 7465 2074 6167 2066   """Delete tag f
+00016d10: 726f 6d20 6120 6c69 7374 206f 6620 6172  rom a list of ar
+00016d20: 7469 6661 6374 732e 0a0a 2020 2020 2020  tifacts...      
+00016d30: 2020 3a70 6172 616d 2061 7274 6966 6163    :param artifac
+00016d40: 7473 3a20 5468 6520 6172 7469 6661 6374  ts: The artifact
+00016d50: 7320 746f 2064 656c 6574 6520 7468 6520  s to delete the 
+00016d60: 7461 6720 6672 6f6d 2e20 4361 6e20 6265  tag from. Can be
+00016d70: 2061 206c 6973 7420 6f66 203a 7079 3a63   a list of :py:c
+00016d80: 6c61 7373 3a60 7e6d 6c72 756e 2e61 7274  lass:`~mlrun.art
+00016d90: 6966 6163 7473 2e41 7274 6966 6163 7460  ifacts.Artifact`
+00016da0: 0a20 2020 2020 2020 2020 2020 206f 626a  .            obj
+00016db0: 6563 7473 206f 7220 6469 6374 696f 6e61  ects or dictiona
+00016dc0: 7269 6573 2c20 6f72 2061 2073 696e 676c  ries, or a singl
+00016dd0: 6520 6f62 6a65 6374 2e0a 2020 2020 2020  e object..      
+00016de0: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+00016df0: 3a20 5072 6f6a 6563 7420 7768 6963 6820  : Project which 
+00016e00: 636f 6e74 6169 6e73 2074 6865 2061 7274  contains the art
+00016e10: 6966 6163 7473 2e0a 2020 2020 2020 2020  ifacts..        
+00016e20: 3a70 6172 616d 2074 6167 5f6e 616d 653a  :param tag_name:
+00016e30: 2054 6865 2074 6167 2074 6f20 7365 7420   The tag to set 
+00016e40: 6f6e 2074 6865 2061 7274 6966 6163 7473  on the artifacts
+00016e50: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00016e60: 2020 2020 2020 7461 675f 6f62 6a65 6374        tag_object
+00016e70: 7320 3d20 7365 6c66 2e5f 7265 736f 6c76  s = self._resolv
+00016e80: 655f 6172 7469 6661 6374 735f 746f 5f74  e_artifacts_to_t
+00016e90: 6167 5f6f 626a 6563 7473 2861 7274 6966  ag_objects(artif
+00016ea0: 6163 7473 290a 2020 2020 2020 2020 7365  acts).        se
+00016eb0: 6c66 2e64 656c 6574 655f 6f62 6a65 6374  lf.delete_object
+00016ec0: 735f 7461 6728 7072 6f6a 6563 742c 2074  s_tag(project, t
+00016ed0: 6167 5f6e 616d 652c 2074 6167 5f6f 626a  ag_name, tag_obj
+00016ee0: 6563 7473 290a 0a20 2020 2064 6566 206c  ects)..    def l
+00016ef0: 6973 745f 7072 6f6a 6563 7473 280a 2020  ist_projects(.  
+00016f00: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00016f10: 2020 2020 6f77 6e65 723a 2073 7472 203d      owner: str =
+00016f20: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
+00016f30: 6f72 6d61 745f 3a20 556e 696f 6e5b 0a20  ormat_: Union[. 
+00016f40: 2020 2020 2020 2020 2020 2073 7472 2c20             str, 
+00016f50: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00016f60: 656d 6173 2e50 726f 6a65 6374 7346 6f72  emas.ProjectsFor
+00016f70: 6d61 740a 2020 2020 2020 2020 5d20 3d20  mat.        ] = 
+00016f80: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00016f90: 656d 6173 2e50 726f 6a65 6374 7346 6f72  emas.ProjectsFor
+00016fa0: 6d61 742e 6675 6c6c 2c0a 2020 2020 2020  mat.full,.      
+00016fb0: 2020 6c61 6265 6c73 3a20 4c69 7374 5b73    labels: List[s
+00016fc0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00016fd0: 2020 2020 7374 6174 653a 2055 6e69 6f6e      state: Union
+00016fe0: 5b73 7472 2c20 6d6c 7275 6e2e 636f 6d6d  [str, mlrun.comm
+00016ff0: 6f6e 2e73 6368 656d 6173 2e50 726f 6a65  on.schemas.Proje
+00017000: 6374 5374 6174 655d 203d 204e 6f6e 652c  ctState] = None,
+00017010: 0a20 2020 2029 202d 3e20 4c69 7374 5b55  .    ) -> List[U
+00017020: 6e69 6f6e 5b6d 6c72 756e 2e70 726f 6a65  nion[mlrun.proje
+00017030: 6374 732e 4d6c 7275 6e50 726f 6a65 6374  cts.MlrunProject
+00017040: 2c20 7374 725d 5d3a 0a20 2020 2020 2020  , str]]:.       
+00017050: 2022 2222 5265 7475 726e 2061 206c 6973   """Return a lis
+00017060: 7420 6f66 2074 6865 2065 7869 7374 696e  t of the existin
+00017070: 6720 7072 6f6a 6563 7473 2c20 706f 7465  g projects, pote
+00017080: 6e74 6961 6c6c 7920 6669 6c74 6572 6564  ntially filtered
+00017090: 2062 7920 7370 6563 6966 6963 2063 7269   by specific cri
+000170a0: 7465 7269 612e 0a0a 2020 2020 2020 2020  teria...        
+000170b0: 3a70 6172 616d 206f 776e 6572 3a20 4c69  :param owner: Li
+000170c0: 7374 206f 6e6c 7920 7072 6f6a 6563 7473  st only projects
+000170d0: 2062 656c 6f6e 6769 6e67 2074 6f20 7468   belonging to th
+000170e0: 6973 2073 7065 6369 6669 6320 6f77 6e65  is specific owne
+000170f0: 722e 0a20 2020 2020 2020 203a 7061 7261  r..        :para
+00017100: 6d20 666f 726d 6174 5f3a 2046 6f72 6d61  m format_: Forma
+00017110: 7420 6f66 2074 6865 2072 6573 756c 7473  t of the results
+00017120: 2e20 506f 7373 6962 6c65 2076 616c 7565  . Possible value
+00017130: 7320 6172 653a 0a0a 2020 2020 2020 2020  s are:..        
+00017140: 2020 2020 2d20 6060 6675 6c6c 6060 2028      - ``full`` (
+00017150: 6465 6661 756c 7420 7661 6c75 6529 202d  default value) -
+00017160: 2052 6574 7572 6e20 6675 6c6c 2070 726f   Return full pro
+00017170: 6a65 6374 206f 626a 6563 7473 2e0a 2020  ject objects..  
+00017180: 2020 2020 2020 2020 2020 2d20 6060 6d69            - ``mi
+00017190: 6e69 6d61 6c60 6020 2d20 5265 7475 726e  nimal`` - Return
+000171a0: 206d 696e 696d 616c 2070 726f 6a65 6374   minimal project
+000171b0: 206f 626a 6563 7473 2028 6d69 6e69 6d69   objects (minimi
+000171c0: 7a61 7469 6f6e 2068 6170 7065 6e73 2069  zation happens i
+000171d0: 6e20 7468 6520 4245 292e 0a20 2020 2020  n the BE)..     
+000171e0: 2020 2020 2020 202d 2060 606e 616d 655f         - ``name_
+000171f0: 6f6e 6c79 6060 202d 2052 6574 7572 6e20  only`` - Return 
+00017200: 6a75 7374 2074 6865 206e 616d 6573 206f  just the names o
+00017210: 6620 7468 6520 7072 6f6a 6563 7473 2e0a  f the projects..
+00017220: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00017230: 6c61 6265 6c73 3a20 4669 6c74 6572 2062  labels: Filter b
+00017240: 7920 6c61 6265 6c73 2061 7474 6163 6865  y labels attache
+00017250: 6420 746f 2074 6865 2070 726f 6a65 6374  d to the project
+00017260: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00017270: 2073 7461 7465 3a20 4669 6c74 6572 2062   state: Filter b
+00017280: 7920 7072 6f6a 6563 7427 7320 7374 6174  y project's stat
+00017290: 652e 2043 616e 2062 6520 6569 7468 6572  e. Can be either
+000172a0: 2060 606f 6e6c 696e 6560 6020 6f72 2060   ``online`` or `
+000172b0: 6061 7263 6869 7665 6460 602e 0a20 2020  `archived``..   
+000172c0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+000172d0: 2020 7061 7261 6d73 203d 207b 0a20 2020    params = {.   
+000172e0: 2020 2020 2020 2020 2022 6f77 6e65 7222           "owner"
+000172f0: 3a20 6f77 6e65 722c 0a20 2020 2020 2020  : owner,.       
+00017300: 2020 2020 2022 7374 6174 6522 3a20 7374       "state": st
+00017310: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
+00017320: 2022 666f 726d 6174 223a 2066 6f72 6d61   "format": forma
+00017330: 745f 2c0a 2020 2020 2020 2020 2020 2020  t_,.            
+00017340: 226c 6162 656c 223a 206c 6162 656c 7320  "label": labels 
+00017350: 6f72 205b 5d2c 0a20 2020 2020 2020 207d  or [],.        }
+00017360: 0a0a 2020 2020 2020 2020 6572 726f 725f  ..        error_
+00017370: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+00017380: 6564 206c 6973 7469 6e67 2070 726f 6a65  ed listing proje
+00017390: 6374 732c 2071 7565 7279 3a20 7b70 6172  cts, query: {par
+000173a0: 616d 737d 220a 2020 2020 2020 2020 7265  ams}".        re
+000173b0: 7370 6f6e 7365 203d 2073 656c 662e 6170  sponse = self.ap
+000173c0: 695f 6361 6c6c 2822 4745 5422 2c20 2270  i_call("GET", "p
+000173d0: 726f 6a65 6374 7322 2c20 6572 726f 725f  rojects", error_
+000173e0: 6d65 7373 6167 652c 2070 6172 616d 733d  message, params=
+000173f0: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00017400: 6966 2066 6f72 6d61 745f 203d 3d20 6d6c  if format_ == ml
+00017410: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00017420: 6173 2e50 726f 6a65 6374 7346 6f72 6d61  as.ProjectsForma
+00017430: 742e 6e61 6d65 5f6f 6e6c 793a 0a0a 2020  t.name_only:..  
+00017440: 2020 2020 2020 2020 2020 2320 7072 6f6a            # proj
+00017450: 6563 7473 2069 7320 6a75 7374 2061 206c  ects is just a l
+00017460: 6973 7420 6f66 2073 7472 696e 6773 0a20  ist of strings. 
+00017470: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017480: 6e20 7265 7370 6f6e 7365 2e6a 736f 6e28  n response.json(
+00017490: 295b 2270 726f 6a65 6374 7322 5d0a 0a20  )["projects"].. 
+000174a0: 2020 2020 2020 2023 2066 6f72 7761 7264         # forward
+000174b0: 7320 636f 6d70 6174 6962 696c 6974 7920  s compatibility 
+000174c0: 2d20 7765 2077 616e 7420 746f 2062 6520  - we want to be 
+000174d0: 6162 6c65 2074 6f20 6861 6e64 6c65 206e  able to handle n
+000174e0: 6577 2066 6f72 6d61 7473 2074 6861 7420  ew formats that 
+000174f0: 6d69 6768 7420 6265 2061 6464 6564 2069  might be added i
+00017500: 6e20 7468 6520 6675 7475 7265 0a20 2020  n the future.   
+00017510: 2020 2020 2023 2069 6620 666f 726d 6174       # if format
+00017520: 2069 7320 6e6f 7420 6b6e 6f77 6e20 746f   is not known to
+00017530: 2074 6865 2061 7069 2c20 6974 2069 7320   the api, it is 
+00017540: 7570 2074 6f20 7468 6520 7365 7276 6572  up to the server
+00017550: 2074 6f20 7265 7475 726e 2065 6974 6865   to return eithe
+00017560: 7220 616e 2065 7272 6f72 206f 7220 6120  r an error or a 
+00017570: 6465 6661 756c 7420 666f 726d 6174 0a20  default format. 
+00017580: 2020 2020 2020 2072 6574 7572 6e20 5b0a         return [.
+00017590: 2020 2020 2020 2020 2020 2020 6d6c 7275              mlru
+000175a0: 6e2e 7072 6f6a 6563 7473 2e4d 6c72 756e  n.projects.Mlrun
+000175b0: 5072 6f6a 6563 742e 6672 6f6d 5f64 6963  Project.from_dic
+000175c0: 7428 7072 6f6a 6563 745f 6469 6374 290a  t(project_dict).
+000175d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000175e0: 7072 6f6a 6563 745f 6469 6374 2069 6e20  project_dict in 
+000175f0: 7265 7370 6f6e 7365 2e6a 736f 6e28 295b  response.json()[
+00017600: 2270 726f 6a65 6374 7322 5d0a 2020 2020  "projects"].    
+00017610: 2020 2020 5d0a 0a20 2020 2064 6566 2067      ]..    def g
+00017620: 6574 5f70 726f 6a65 6374 2873 656c 662c  et_project(self,
+00017630: 206e 616d 653a 2073 7472 2920 2d3e 206d   name: str) -> m
+00017640: 6c72 756e 2e70 726f 6a65 6374 732e 4d6c  lrun.projects.Ml
+00017650: 7275 6e50 726f 6a65 6374 3a0a 2020 2020  runProject:.    
+00017660: 2020 2020 2222 2247 6574 2064 6574 6169      """Get detai
+00017670: 6c73 2066 6f72 2061 2073 7065 6369 6669  ls for a specifi
+00017680: 6320 7072 6f6a 6563 742e 2222 220a 0a20  c project.""".. 
+00017690: 2020 2020 2020 2069 6620 6e6f 7420 6e61         if not na
+000176a0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+000176b0: 7261 6973 6520 4d4c 5275 6e49 6e76 616c  raise MLRunInval
+000176c0: 6964 4172 6775 6d65 6e74 4572 726f 7228  idArgumentError(
+000176d0: 224e 616d 6520 6d75 7374 2062 6520 7072  "Name must be pr
+000176e0: 6f76 6964 6564 2229 0a0a 2020 2020 2020  ovided")..      
+000176f0: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
+00017700: 6374 732f 7b6e 616d 657d 220a 2020 2020  cts/{name}".    
+00017710: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+00017720: 6520 3d20 6622 4661 696c 6564 2072 6574  e = f"Failed ret
+00017730: 7269 6576 696e 6720 7072 6f6a 6563 7420  rieving project 
+00017740: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
+00017750: 7265 7370 6f6e 7365 203d 2073 656c 662e  response = self.
+00017760: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+00017770: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
+00017780: 6167 6529 0a20 2020 2020 2020 2072 6574  age).        ret
+00017790: 7572 6e20 6d6c 7275 6e2e 7072 6f6a 6563  urn mlrun.projec
+000177a0: 7473 2e4d 6c72 756e 5072 6f6a 6563 742e  ts.MlrunProject.
+000177b0: 6672 6f6d 5f64 6963 7428 7265 7370 6f6e  from_dict(respon
+000177c0: 7365 2e6a 736f 6e28 2929 0a0a 2020 2020  se.json())..    
+000177d0: 6465 6620 6465 6c65 7465 5f70 726f 6a65  def delete_proje
+000177e0: 6374 280a 2020 2020 2020 2020 7365 6c66  ct(.        self
+000177f0: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
+00017800: 7374 722c 0a20 2020 2020 2020 2064 656c  str,.        del
+00017810: 6574 696f 6e5f 7374 7261 7465 6779 3a20  etion_strategy: 
+00017820: 556e 696f 6e5b 0a20 2020 2020 2020 2020  Union[.         
+00017830: 2020 2073 7472 2c20 6d6c 7275 6e2e 636f     str, mlrun.co
+00017840: 6d6d 6f6e 2e73 6368 656d 6173 2e44 656c  mmon.schemas.Del
+00017850: 6574 696f 6e53 7472 6174 6567 790a 2020  etionStrategy.  
+00017860: 2020 2020 2020 5d20 3d20 6d6c 7275 6e2e        ] = mlrun.
+00017870: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e44  common.schemas.D
+00017880: 656c 6574 696f 6e53 7472 6174 6567 792e  eletionStrategy.
+00017890: 6465 6661 756c 7428 292c 0a20 2020 2029  default(),.    )
+000178a0: 3a0a 2020 2020 2020 2020 2222 2244 656c  :.        """Del
+000178b0: 6574 6520 6120 7072 6f6a 6563 742e 0a0a  ete a project...
+000178c0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+000178d0: 616d 653a 204e 616d 6520 6f66 2074 6865  ame: Name of the
+000178e0: 2070 726f 6a65 6374 2074 6f20 6465 6c65   project to dele
+000178f0: 7465 2e0a 2020 2020 2020 2020 3a70 6172  te..        :par
+00017900: 616d 2064 656c 6574 696f 6e5f 7374 7261  am deletion_stra
+00017910: 7465 6779 3a20 486f 7720 746f 2074 7265  tegy: How to tre
+00017920: 6174 2063 6869 6c64 206f 626a 6563 7473  at child objects
+00017930: 206f 6620 7468 6520 7072 6f6a 6563 742e   of the project.
+00017940: 2050 6f73 7369 626c 6520 7661 6c75 6573   Possible values
+00017950: 2061 7265 3a0a 0a20 2020 2020 2020 2020   are:..         
+00017960: 2020 202d 2060 6072 6573 7472 6963 7460     - ``restrict`
+00017970: 6020 2864 6566 6175 6c74 2920 2d20 5072  ` (default) - Pr
+00017980: 6f6a 6563 7420 6d75 7374 206e 6f74 2068  oject must not h
+00017990: 6176 6520 616e 7920 6368 696c 6420 6f62  ave any child ob
+000179a0: 6a65 6374 7320 7768 656e 2064 656c 6574  jects when delet
+000179b0: 6564 2e20 4966 2075 7369 6e67 2074 6869  ed. If using thi
+000179c0: 7320 6d6f 6465 2077 6869 6c65 0a20 2020  s mode while.   
+000179d0: 2020 2020 2020 2020 2020 2063 6869 6c64             child
+000179e0: 206f 626a 6563 7473 2065 7869 7374 2c20   objects exist, 
+000179f0: 7468 6520 6f70 6572 6174 696f 6e20 7769  the operation wi
+00017a00: 6c6c 2066 6169 6c2e 0a20 2020 2020 2020  ll fail..       
+00017a10: 2020 2020 202d 2060 6063 6173 6361 6465       - ``cascade
+00017a20: 6060 202d 2041 7574 6f6d 6174 6963 616c  `` - Automatical
+00017a30: 6c79 2064 656c 6574 6520 616c 6c20 6368  ly delete all ch
+00017a40: 696c 6420 6f62 6a65 6374 7320 7768 656e  ild objects when
+00017a50: 2064 656c 6574 696e 6720 7468 6520 7072   deleting the pr
+00017a60: 6f6a 6563 742e 0a20 2020 2020 2020 2022  oject..        "
+00017a70: 2222 0a0a 2020 2020 2020 2020 7061 7468  ""..        path
+00017a80: 203d 2066 2270 726f 6a65 6374 732f 7b6e   = f"projects/{n
+00017a90: 616d 657d 220a 2020 2020 2020 2020 6865  ame}".        he
+00017aa0: 6164 6572 7320 3d20 7b0a 2020 2020 2020  aders = {.      
+00017ab0: 2020 2020 2020 6d6c 7275 6e2e 636f 6d6d        mlrun.comm
+00017ac0: 6f6e 2e73 6368 656d 6173 2e48 6561 6465  on.schemas.Heade
+00017ad0: 724e 616d 6573 2e64 656c 6574 696f 6e5f  rNames.deletion_
+00017ae0: 7374 7261 7465 6779 3a20 6465 6c65 7469  strategy: deleti
+00017af0: 6f6e 5f73 7472 6174 6567 790a 2020 2020  on_strategy.    
+00017b00: 2020 2020 7d0a 2020 2020 2020 2020 6572      }.        er
+00017b10: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
+00017b20: 4661 696c 6564 2064 656c 6574 696e 6720  Failed deleting 
+00017b30: 7072 6f6a 6563 7420 7b6e 616d 657d 220a  project {name}".
+00017b40: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+00017b50: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+00017b60: 2822 4445 4c45 5445 222c 2070 6174 682c  ("DELETE", path,
+00017b70: 2065 7272 6f72 5f6d 6573 7361 6765 2c20   error_message, 
+00017b80: 6865 6164 6572 733d 6865 6164 6572 7329  headers=headers)
+00017b90: 0a20 2020 2020 2020 2069 6620 7265 7370  .        if resp
+00017ba0: 6f6e 7365 2e73 7461 7475 735f 636f 6465  onse.status_code
+00017bb0: 203d 3d20 6874 7470 2e48 5454 5053 7461   == http.HTTPSta
+00017bc0: 7475 732e 4143 4345 5054 4544 3a0a 2020  tus.ACCEPTED:.  
+00017bd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00017be0: 2073 656c 662e 5f77 6169 745f 666f 725f   self._wait_for_
+00017bf0: 7072 6f6a 6563 745f 746f 5f62 655f 6465  project_to_be_de
+00017c00: 6c65 7465 6428 6e61 6d65 290a 0a20 2020  leted(name)..   
+00017c10: 2064 6566 2073 746f 7265 5f70 726f 6a65   def store_proje
+00017c20: 6374 280a 2020 2020 2020 2020 7365 6c66  ct(.        self
+00017c30: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
+00017c40: 7374 722c 0a20 2020 2020 2020 2070 726f  str,.        pro
+00017c50: 6a65 6374 3a20 556e 696f 6e5b 6469 6374  ject: Union[dict
+00017c60: 2c20 6d6c 7275 6e2e 7072 6f6a 6563 7473  , mlrun.projects
+00017c70: 2e4d 6c72 756e 5072 6f6a 6563 742c 206d  .MlrunProject, m
+00017c80: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00017c90: 6d61 732e 5072 6f6a 6563 745d 2c0a 2020  mas.Project],.  
+00017ca0: 2020 2920 2d3e 206d 6c72 756e 2e70 726f    ) -> mlrun.pro
+00017cb0: 6a65 6374 732e 4d6c 7275 6e50 726f 6a65  jects.MlrunProje
+00017cc0: 6374 3a0a 2020 2020 2020 2020 2222 2253  ct:.        """S
+00017cd0: 746f 7265 2061 2070 726f 6a65 6374 2069  tore a project i
+00017ce0: 6e20 7468 6520 4442 2e20 5468 6973 206f  n the DB. This o
+00017cf0: 7065 7261 7469 6f6e 2077 696c 6c20 6f76  peration will ov
+00017d00: 6572 7772 6974 6520 6578 6973 7469 6e67  erwrite existing
+00017d10: 2070 726f 6a65 6374 206f 6620 7468 6520   project of the 
+00017d20: 7361 6d65 206e 616d 6520 6966 2065 7869  same name if exi
+00017d30: 7374 732e 2222 220a 0a20 2020 2020 2020  sts."""..       
+00017d40: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
+00017d50: 7473 2f7b 6e61 6d65 7d22 0a20 2020 2020  ts/{name}".     
+00017d60: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+00017d70: 203d 2066 2246 6169 6c65 6420 7374 6f72   = f"Failed stor
+00017d80: 696e 6720 7072 6f6a 6563 7420 7b6e 616d  ing project {nam
+00017d90: 657d 220a 2020 2020 2020 2020 6966 2069  e}".        if i
+00017da0: 7369 6e73 7461 6e63 6528 7072 6f6a 6563  sinstance(projec
+00017db0: 742c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  t, mlrun.common.
+00017dc0: 7363 6865 6d61 732e 5072 6f6a 6563 7429  schemas.Project)
+00017dd0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00017de0: 6f6a 6563 7420 3d20 7072 6f6a 6563 742e  oject = project.
+00017df0: 6469 6374 2829 0a20 2020 2020 2020 2065  dict().        e
+00017e00: 6c69 6620 6973 696e 7374 616e 6365 2870  lif isinstance(p
+00017e10: 726f 6a65 6374 2c20 6d6c 7275 6e2e 7072  roject, mlrun.pr
+00017e20: 6f6a 6563 7473 2e4d 6c72 756e 5072 6f6a  ojects.MlrunProj
+00017e30: 6563 7429 3a0a 2020 2020 2020 2020 2020  ect):.          
+00017e40: 2020 7072 6f6a 6563 7420 3d20 7072 6f6a    project = proj
+00017e50: 6563 742e 746f 5f64 6963 7428 290a 2020  ect.to_dict().  
+00017e60: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
+00017e70: 2073 656c 662e 6170 695f 6361 6c6c 280a   self.api_call(.
+00017e80: 2020 2020 2020 2020 2020 2020 2250 5554              "PUT
+00017e90: 222c 0a20 2020 2020 2020 2020 2020 2070  ",.            p
+00017ea0: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+00017eb0: 2065 7272 6f72 5f6d 6573 7361 6765 2c0a   error_message,.
+00017ec0: 2020 2020 2020 2020 2020 2020 626f 6479              body
+00017ed0: 3d64 6963 745f 746f 5f6a 736f 6e28 7072  =dict_to_json(pr
+00017ee0: 6f6a 6563 7429 2c0a 2020 2020 2020 2020  oject),.        
+00017ef0: 290a 2020 2020 2020 2020 6966 2072 6573  ).        if res
+00017f00: 706f 6e73 652e 7374 6174 7573 5f63 6f64  ponse.status_cod
+00017f10: 6520 3d3d 2068 7474 702e 4854 5450 5374  e == http.HTTPSt
+00017f20: 6174 7573 2e41 4343 4550 5445 443a 0a20  atus.ACCEPTED:. 
+00017f30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017f40: 6e20 7365 6c66 2e5f 7761 6974 5f66 6f72  n self._wait_for
+00017f50: 5f70 726f 6a65 6374 5f74 6f5f 7265 6163  _project_to_reac
+00017f60: 685f 7465 726d 696e 616c 5f73 7461 7465  h_terminal_state
+00017f70: 286e 616d 6529 0a20 2020 2020 2020 2072  (name).        r
+00017f80: 6574 7572 6e20 6d6c 7275 6e2e 7072 6f6a  eturn mlrun.proj
+00017f90: 6563 7473 2e4d 6c72 756e 5072 6f6a 6563  ects.MlrunProjec
+00017fa0: 742e 6672 6f6d 5f64 6963 7428 7265 7370  t.from_dict(resp
+00017fb0: 6f6e 7365 2e6a 736f 6e28 2929 0a0a 2020  onse.json())..  
+00017fc0: 2020 6465 6620 7061 7463 685f 7072 6f6a    def patch_proj
+00017fd0: 6563 7428 0a20 2020 2020 2020 2073 656c  ect(.        sel
+00017fe0: 662c 0a20 2020 2020 2020 206e 616d 653a  f,.        name:
+00017ff0: 2073 7472 2c0a 2020 2020 2020 2020 7072   str,.        pr
+00018000: 6f6a 6563 743a 2064 6963 742c 0a20 2020  oject: dict,.   
+00018010: 2020 2020 2070 6174 6368 5f6d 6f64 653a       patch_mode:
+00018020: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
+00018030: 2020 2020 7374 722c 206d 6c72 756e 2e63      str, mlrun.c
+00018040: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5061  ommon.schemas.Pa
+00018050: 7463 684d 6f64 650a 2020 2020 2020 2020  tchMode.        
+00018060: 5d20 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e  ] = mlrun.common
+00018070: 2e73 6368 656d 6173 2e50 6174 6368 4d6f  .schemas.PatchMo
+00018080: 6465 2e72 6570 6c61 6365 2c0a 2020 2020  de.replace,.    
+00018090: 2920 2d3e 206d 6c72 756e 2e70 726f 6a65  ) -> mlrun.proje
+000180a0: 6374 732e 4d6c 7275 6e50 726f 6a65 6374  cts.MlrunProject
+000180b0: 3a0a 2020 2020 2020 2020 2222 2250 6174  :.        """Pat
+000180c0: 6368 2061 6e20 6578 6973 7469 6e67 2070  ch an existing p
+000180d0: 726f 6a65 6374 206f 626a 6563 742e 0a0a  roject object...
+000180e0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+000180f0: 616d 653a 204e 616d 6520 6f66 2070 726f  ame: Name of pro
+00018100: 6a65 6374 2074 6f20 7061 7463 682e 0a20  ject to patch.. 
+00018110: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+00018120: 6f6a 6563 743a 2054 6865 2061 6374 7561  oject: The actua
+00018130: 6c20 6368 616e 6765 7320 746f 2074 6865  l changes to the
+00018140: 2070 726f 6a65 6374 206f 626a 6563 742e   project object.
+00018150: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00018160: 7061 7463 685f 6d6f 6465 3a20 5468 6520  patch_mode: The 
+00018170: 7374 7261 7465 6779 2066 6f72 206d 6572  strategy for mer
+00018180: 6769 6e67 2074 6865 2063 6861 6e67 6573  ging the changes
+00018190: 2077 6974 6820 7468 6520 6578 6973 7469   with the existi
+000181a0: 6e67 206f 626a 6563 742e 2043 616e 2062  ng object. Can b
+000181b0: 6520 6569 7468 6572 2060 6072 6570 6c61  e either ``repla
+000181c0: 6365 6060 0a20 2020 2020 2020 2020 2020  ce``.           
+000181d0: 206f 7220 6060 6164 6469 7469 7665 6060   or ``additive``
+000181e0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+000181f0: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+00018200: 7072 6f6a 6563 7473 2f7b 6e61 6d65 7d22  projects/{name}"
+00018210: 0a20 2020 2020 2020 2068 6561 6465 7273  .        headers
+00018220: 203d 207b 6d6c 7275 6e2e 636f 6d6d 6f6e   = {mlrun.common
+00018230: 2e73 6368 656d 6173 2e48 6561 6465 724e  .schemas.HeaderN
+00018240: 616d 6573 2e70 6174 6368 5f6d 6f64 653a  ames.patch_mode:
+00018250: 2070 6174 6368 5f6d 6f64 657d 0a20 2020   patch_mode}.   
+00018260: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+00018270: 6765 203d 2066 2246 6169 6c65 6420 7061  ge = f"Failed pa
+00018280: 7463 6869 6e67 2070 726f 6a65 6374 207b  tching project {
+00018290: 6e61 6d65 7d22 0a20 2020 2020 2020 2072  name}".        r
+000182a0: 6573 706f 6e73 6520 3d20 7365 6c66 2e61  esponse = self.a
+000182b0: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
+000182c0: 2020 2020 2022 5041 5443 4822 2c20 7061       "PATCH", pa
+000182d0: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
+000182e0: 652c 2062 6f64 793d 6469 6374 5f74 6f5f  e, body=dict_to_
+000182f0: 6a73 6f6e 2870 726f 6a65 6374 292c 2068  json(project), h
+00018300: 6561 6465 7273 3d68 6561 6465 7273 0a20  eaders=headers. 
+00018310: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00018320: 2072 6574 7572 6e20 6d6c 7275 6e2e 7072   return mlrun.pr
+00018330: 6f6a 6563 7473 2e4d 6c72 756e 5072 6f6a  ojects.MlrunProj
+00018340: 6563 742e 6672 6f6d 5f64 6963 7428 7265  ect.from_dict(re
+00018350: 7370 6f6e 7365 2e6a 736f 6e28 2929 0a0a  sponse.json())..
+00018360: 2020 2020 6465 6620 6372 6561 7465 5f70      def create_p
+00018370: 726f 6a65 6374 280a 2020 2020 2020 2020  roject(.        
+00018380: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
+00018390: 6f6a 6563 743a 2055 6e69 6f6e 5b64 6963  oject: Union[dic
+000183a0: 742c 206d 6c72 756e 2e70 726f 6a65 6374  t, mlrun.project
+000183b0: 732e 4d6c 7275 6e50 726f 6a65 6374 2c20  s.MlrunProject, 
+000183c0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+000183d0: 656d 6173 2e50 726f 6a65 6374 5d2c 0a20  emas.Project],. 
+000183e0: 2020 2029 202d 3e20 6d6c 7275 6e2e 7072     ) -> mlrun.pr
+000183f0: 6f6a 6563 7473 2e4d 6c72 756e 5072 6f6a  ojects.MlrunProj
+00018400: 6563 743a 0a20 2020 2020 2020 2022 2222  ect:.        """
+00018410: 4372 6561 7465 2061 206e 6577 2070 726f  Create a new pro
+00018420: 6a65 6374 2e20 4120 7072 6f6a 6563 7420  ject. A project 
+00018430: 7769 7468 2074 6865 2073 616d 6520 6e61  with the same na
+00018440: 6d65 206d 7573 7420 6e6f 7420 6578 6973  me must not exis
+00018450: 7420 7072 696f 7220 746f 2063 7265 6174  t prior to creat
+00018460: 696f 6e2e 2222 220a 0a20 2020 2020 2020  ion."""..       
+00018470: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
+00018480: 726f 6a65 6374 2c20 6d6c 7275 6e2e 636f  roject, mlrun.co
+00018490: 6d6d 6f6e 2e73 6368 656d 6173 2e50 726f  mmon.schemas.Pro
+000184a0: 6a65 6374 293a 0a20 2020 2020 2020 2020  ject):.         
+000184b0: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
+000184c0: 6a65 6374 2e64 6963 7428 290a 2020 2020  ject.dict().    
+000184d0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+000184e0: 6e63 6528 7072 6f6a 6563 742c 206d 6c72  nce(project, mlr
+000184f0: 756e 2e70 726f 6a65 6374 732e 4d6c 7275  un.projects.Mlru
+00018500: 6e50 726f 6a65 6374 293a 0a20 2020 2020  nProject):.     
+00018510: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+00018520: 2070 726f 6a65 6374 2e74 6f5f 6469 6374   project.to_dict
+00018530: 2829 0a20 2020 2020 2020 2070 726f 6a65  ().        proje
+00018540: 6374 5f6e 616d 6520 3d20 7072 6f6a 6563  ct_name = projec
+00018550: 745b 226d 6574 6164 6174 6122 5d5b 226e  t["metadata"]["n
+00018560: 616d 6522 5d0a 2020 2020 2020 2020 6572  ame"].        er
+00018570: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
+00018580: 4661 696c 6564 2063 7265 6174 696e 6720  Failed creating 
+00018590: 7072 6f6a 6563 7420 7b70 726f 6a65 6374  project {project
+000185a0: 5f6e 616d 657d 220a 2020 2020 2020 2020  _name}".        
+000185b0: 7265 7370 6f6e 7365 203d 2073 656c 662e  response = self.
+000185c0: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+000185d0: 2020 2020 2020 2250 4f53 5422 2c0a 2020        "POST",.  
+000185e0: 2020 2020 2020 2020 2020 2270 726f 6a65            "proje
+000185f0: 6374 7322 2c0a 2020 2020 2020 2020 2020  cts",.          
+00018600: 2020 6572 726f 725f 6d65 7373 6167 652c    error_message,
+00018610: 0a20 2020 2020 2020 2020 2020 2062 6f64  .            bod
+00018620: 793d 6469 6374 5f74 6f5f 6a73 6f6e 2870  y=dict_to_json(p
+00018630: 726f 6a65 6374 292c 0a20 2020 2020 2020  roject),.       
+00018640: 2029 0a20 2020 2020 2020 2069 6620 7265   ).        if re
+00018650: 7370 6f6e 7365 2e73 7461 7475 735f 636f  sponse.status_co
+00018660: 6465 203d 3d20 6874 7470 2e48 5454 5053  de == http.HTTPS
+00018670: 7461 7475 732e 4143 4345 5054 4544 3a0a  tatus.ACCEPTED:.
+00018680: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018690: 726e 2073 656c 662e 5f77 6169 745f 666f  rn self._wait_fo
+000186a0: 725f 7072 6f6a 6563 745f 746f 5f72 6561  r_project_to_rea
+000186b0: 6368 5f74 6572 6d69 6e61 6c5f 7374 6174  ch_terminal_stat
+000186c0: 6528 7072 6f6a 6563 745f 6e61 6d65 290a  e(project_name).
+000186d0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+000186e0: 6c72 756e 2e70 726f 6a65 6374 732e 4d6c  lrun.projects.Ml
+000186f0: 7275 6e50 726f 6a65 6374 2e66 726f 6d5f  runProject.from_
+00018700: 6469 6374 2872 6573 706f 6e73 652e 6a73  dict(response.js
+00018710: 6f6e 2829 290a 0a20 2020 2064 6566 205f  on())..    def _
+00018720: 7761 6974 5f66 6f72 5f70 726f 6a65 6374  wait_for_project
+00018730: 5f74 6f5f 7265 6163 685f 7465 726d 696e  _to_reach_termin
+00018740: 616c 5f73 7461 7465 280a 2020 2020 2020  al_state(.      
+00018750: 2020 7365 6c66 2c20 7072 6f6a 6563 745f    self, project_
+00018760: 6e61 6d65 3a20 7374 720a 2020 2020 2920  name: str.    ) 
+00018770: 2d3e 206d 6c72 756e 2e70 726f 6a65 6374  -> mlrun.project
+00018780: 732e 4d6c 7275 6e50 726f 6a65 6374 3a0a  s.MlrunProject:.
+00018790: 2020 2020 2020 2020 6465 6620 5f76 6572          def _ver
+000187a0: 6966 795f 7072 6f6a 6563 745f 696e 5f74  ify_project_in_t
+000187b0: 6572 6d69 6e61 6c5f 7374 6174 6528 293a  erminal_state():
+000187c0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+000187d0: 6a65 6374 203d 2073 656c 662e 6765 745f  ject = self.get_
+000187e0: 7072 6f6a 6563 7428 7072 6f6a 6563 745f  project(project_
+000187f0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00018800: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
+00018810: 2020 2020 2020 2070 726f 6a65 6374 2e73         project.s
+00018820: 7461 7475 732e 7374 6174 650a 2020 2020  tatus.state.    
+00018830: 2020 2020 2020 2020 2020 2020 6e6f 7420              not 
+00018840: 696e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  in mlrun.common.
+00018850: 7363 6865 6d61 732e 5072 6f6a 6563 7453  schemas.ProjectS
+00018860: 7461 7465 2e74 6572 6d69 6e61 6c5f 7374  tate.terminal_st
+00018870: 6174 6573 2829 0a20 2020 2020 2020 2020  ates().         
+00018880: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+00018890: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+000188a0: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+000188b0: 2020 2020 2020 2020 2020 2066 2250 726f             f"Pro
+000188c0: 6a65 6374 206e 6f74 2069 6e20 7465 726d  ject not in term
+000188d0: 696e 616c 2073 7461 7465 2e20 5374 6174  inal state. Stat
+000188e0: 653a 207b 7072 6f6a 6563 742e 7374 6174  e: {project.stat
+000188f0: 7573 2e73 7461 7465 7d22 0a20 2020 2020  us.state}".     
+00018900: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00018910: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018920: 7072 6f6a 6563 740a 0a20 2020 2020 2020  project..       
+00018930: 2072 6574 7572 6e20 6d6c 7275 6e2e 7574   return mlrun.ut
+00018940: 696c 732e 6865 6c70 6572 732e 7265 7472  ils.helpers.retr
+00018950: 795f 756e 7469 6c5f 7375 6363 6573 7366  y_until_successf
+00018960: 756c 280a 2020 2020 2020 2020 2020 2020  ul(.            
+00018970: 7365 6c66 2e5f 7761 6974 5f66 6f72 5f70  self._wait_for_p
+00018980: 726f 6a65 6374 5f74 6572 6d69 6e61 6c5f  roject_terminal_
+00018990: 7374 6174 655f 7265 7472 795f 696e 7465  state_retry_inte
+000189a0: 7276 616c 2c0a 2020 2020 2020 2020 2020  rval,.          
+000189b0: 2020 3132 302c 0a20 2020 2020 2020 2020    120,.         
+000189c0: 2020 206c 6f67 6765 722c 0a20 2020 2020     logger,.     
+000189d0: 2020 2020 2020 2046 616c 7365 2c0a 2020         False,.  
+000189e0: 2020 2020 2020 2020 2020 5f76 6572 6966            _verif
+000189f0: 795f 7072 6f6a 6563 745f 696e 5f74 6572  y_project_in_ter
+00018a00: 6d69 6e61 6c5f 7374 6174 652c 0a20 2020  minal_state,.   
+00018a10: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00018a20: 5f77 6169 745f 666f 725f 6261 636b 6772  _wait_for_backgr
+00018a30: 6f75 6e64 5f74 6173 6b5f 746f 5f72 6561  ound_task_to_rea
+00018a40: 6368 5f74 6572 6d69 6e61 6c5f 7374 6174  ch_terminal_stat
+00018a50: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+00018a60: 206e 616d 653a 2073 7472 0a20 2020 2029   name: str.    )
+00018a70: 202d 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e   -> mlrun.common
+00018a80: 2e73 6368 656d 6173 2e42 6163 6b67 726f  .schemas.Backgro
+00018a90: 756e 6454 6173 6b3a 0a20 2020 2020 2020  undTask:.       
+00018aa0: 2064 6566 205f 7665 7269 6679 5f62 6163   def _verify_bac
+00018ab0: 6b67 726f 756e 645f 7461 736b 5f69 6e5f  kground_task_in_
+00018ac0: 7465 726d 696e 616c 5f73 7461 7465 2829  terminal_state()
+00018ad0: 3a0a 2020 2020 2020 2020 2020 2020 6261  :.            ba
+00018ae0: 636b 6772 6f75 6e64 5f74 6173 6b20 3d20  ckground_task = 
+00018af0: 7365 6c66 2e67 6574 5f62 6163 6b67 726f  self.get_backgro
+00018b00: 756e 645f 7461 736b 286e 616d 6529 0a20  und_task(name). 
+00018b10: 2020 2020 2020 2020 2020 2073 7461 7465             state
+00018b20: 203d 2062 6163 6b67 726f 756e 645f 7461   = background_ta
+00018b30: 736b 2e73 7461 7475 732e 7374 6174 650a  sk.status.state.
+00018b40: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00018b50: 7461 7465 206e 6f74 2069 6e20 6d6c 7275  tate not in mlru
+00018b60: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00018b70: 2e42 6163 6b67 726f 756e 6454 6173 6b53  .BackgroundTaskS
+00018b80: 7461 7465 2e74 6572 6d69 6e61 6c5f 7374  tate.terminal_st
+00018b90: 6174 6573 2829 3a0a 2020 2020 2020 2020  ates():.        
+00018ba0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00018bb0: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+00018bc0: 2020 2020 2020 2020 2020 2020 2066 2242               f"B
+00018bd0: 6163 6b67 726f 756e 6420 7461 736b 206e  ackground task n
+00018be0: 6f74 2069 6e20 7465 726d 696e 616c 2073  ot in terminal s
+00018bf0: 7461 7465 2e20 6e61 6d65 3d7b 6e61 6d65  tate. name={name
+00018c00: 7d2c 2073 7461 7465 3d7b 7374 6174 657d  }, state={state}
+00018c10: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00018c20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00018c30: 7265 7475 726e 2062 6163 6b67 726f 756e  return backgroun
+00018c40: 645f 7461 736b 0a0a 2020 2020 2020 2020  d_task..        
+00018c50: 7265 7475 726e 206d 6c72 756e 2e75 7469  return mlrun.uti
+00018c60: 6c73 2e68 656c 7065 7273 2e72 6574 7279  ls.helpers.retry
+00018c70: 5f75 6e74 696c 5f73 7563 6365 7373 6675  _until_successfu
+00018c80: 6c28 0a20 2020 2020 2020 2020 2020 2073  l(.            s
+00018c90: 656c 662e 5f77 6169 745f 666f 725f 6261  elf._wait_for_ba
+00018ca0: 636b 6772 6f75 6e64 5f74 6173 6b5f 7465  ckground_task_te
+00018cb0: 726d 696e 616c 5f73 7461 7465 5f72 6574  rminal_state_ret
+00018cc0: 7279 5f69 6e74 6572 7661 6c2c 0a20 2020  ry_interval,.   
+00018cd0: 2020 2020 2020 2020 2036 3020 2a20 3630           60 * 60
+00018ce0: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+00018cf0: 6767 6572 2c0a 2020 2020 2020 2020 2020  gger,.          
+00018d00: 2020 4661 6c73 652c 0a20 2020 2020 2020    False,.       
+00018d10: 2020 2020 205f 7665 7269 6679 5f62 6163       _verify_bac
+00018d20: 6b67 726f 756e 645f 7461 736b 5f69 6e5f  kground_task_in_
+00018d30: 7465 726d 696e 616c 5f73 7461 7465 2c0a  terminal_state,.
+00018d40: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00018d50: 6566 205f 7761 6974 5f66 6f72 5f70 726f  ef _wait_for_pro
+00018d60: 6a65 6374 5f74 6f5f 6265 5f64 656c 6574  ject_to_be_delet
+00018d70: 6564 2873 656c 662c 2070 726f 6a65 6374  ed(self, project
+00018d80: 5f6e 616d 653a 2073 7472 293a 0a20 2020  _name: str):.   
+00018d90: 2020 2020 2064 6566 205f 7665 7269 6679       def _verify
+00018da0: 5f70 726f 6a65 6374 5f64 656c 6574 6564  _project_deleted
+00018db0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00018dc0: 7072 6f6a 6563 7473 203d 2073 656c 662e  projects = self.
+00018dd0: 6c69 7374 5f70 726f 6a65 6374 7328 0a20  list_projects(. 
+00018de0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00018df0: 6f72 6d61 745f 3d6d 6c72 756e 2e63 6f6d  ormat_=mlrun.com
+00018e00: 6d6f 6e2e 7363 6865 6d61 732e 5072 6f6a  mon.schemas.Proj
+00018e10: 6563 7473 466f 726d 6174 2e6e 616d 655f  ectsFormat.name_
+00018e20: 6f6e 6c79 0a20 2020 2020 2020 2020 2020  only.           
+00018e30: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+00018e40: 6620 7072 6f6a 6563 745f 6e61 6d65 2069  f project_name i
+00018e50: 6e20 7072 6f6a 6563 7473 3a0a 2020 2020  n projects:.    
+00018e60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00018e70: 6520 4578 6365 7074 696f 6e28 6622 5072  e Exception(f"Pr
+00018e80: 6f6a 6563 7420 7b70 726f 6a65 6374 5f6e  oject {project_n
+00018e90: 616d 657d 2073 7469 6c6c 2065 7869 7374  ame} still exist
+00018ea0: 7322 290a 0a20 2020 2020 2020 2072 6574  s")..        ret
+00018eb0: 7572 6e20 6d6c 7275 6e2e 7574 696c 732e  urn mlrun.utils.
+00018ec0: 6865 6c70 6572 732e 7265 7472 795f 756e  helpers.retry_un
+00018ed0: 7469 6c5f 7375 6363 6573 7366 756c 280a  til_successful(.
+00018ee0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00018ef0: 2e5f 7761 6974 5f66 6f72 5f70 726f 6a65  ._wait_for_proje
+00018f00: 6374 5f64 656c 6574 696f 6e5f 696e 7465  ct_deletion_inte
+00018f10: 7276 616c 2c0a 2020 2020 2020 2020 2020  rval,.          
+00018f20: 2020 3132 302c 0a20 2020 2020 2020 2020    120,.         
+00018f30: 2020 206c 6f67 6765 722c 0a20 2020 2020     logger,.     
+00018f40: 2020 2020 2020 2046 616c 7365 2c0a 2020         False,.  
+00018f50: 2020 2020 2020 2020 2020 5f76 6572 6966            _verif
+00018f60: 795f 7072 6f6a 6563 745f 6465 6c65 7465  y_project_delete
+00018f70: 642c 0a20 2020 2020 2020 2029 0a0a 2020  d,.        )..  
+00018f80: 2020 6465 6620 6372 6561 7465 5f70 726f    def create_pro
+00018f90: 6a65 6374 5f73 6563 7265 7473 280a 2020  ject_secrets(.  
+00018fa0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00018fb0: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
+00018fc0: 2c0a 2020 2020 2020 2020 7072 6f76 6964  ,.        provid
+00018fd0: 6572 3a20 556e 696f 6e5b 0a20 2020 2020  er: Union[.     
+00018fe0: 2020 2020 2020 2073 7472 2c20 6d6c 7275         str, mlru
+00018ff0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00019000: 2e53 6563 7265 7450 726f 7669 6465 724e  .SecretProviderN
+00019010: 616d 650a 2020 2020 2020 2020 5d20 3d20  ame.        ] = 
+00019020: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00019030: 656d 6173 2e53 6563 7265 7450 726f 7669  emas.SecretProvi
+00019040: 6465 724e 616d 652e 6b75 6265 726e 6574  derName.kubernet
+00019050: 6573 2c0a 2020 2020 2020 2020 7365 6372  es,.        secr
+00019060: 6574 733a 2064 6963 7420 3d20 4e6f 6e65  ets: dict = None
+00019070: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+00019080: 2022 2222 4372 6561 7465 2070 726f 6a65   """Create proje
+00019090: 6374 2d63 6f6e 7465 7874 2073 6563 7265  ct-context secre
+000190a0: 7473 2075 7369 6e67 2065 6974 6865 7220  ts using either 
+000190b0: 6060 7661 756c 7460 6020 6f72 2060 606b  ``vault`` or ``k
+000190c0: 7562 6572 6e65 7465 7360 6020 7072 6f76  ubernetes`` prov
+000190d0: 6964 6572 2e0a 2020 2020 2020 2020 5768  ider..        Wh
+000190e0: 656e 2075 7369 6e67 2077 6974 6820 5661  en using with Va
+000190f0: 756c 742c 2074 6869 7320 7769 6c6c 2063  ult, this will c
+00019100: 7265 6174 6520 6e65 6564 6564 2056 6175  reate needed Vau
+00019110: 6c74 2073 7472 7563 7475 7265 7320 666f  lt structures fo
+00019120: 7220 7374 6f72 696e 6720 7365 6372 6574  r storing secret
+00019130: 7320 696e 2070 726f 6a65 6374 2d63 6f6e  s in project-con
+00019140: 7465 7874 2c20 616e 640a 2020 2020 2020  text, and.      
+00019150: 2020 7374 6f72 6520 6120 7365 7420 6f66    store a set of
+00019160: 2073 6563 7265 7420 7661 6c75 6573 2e20   secret values. 
+00019170: 5468 6520 6d65 7468 6f64 2067 656e 6572  The method gener
+00019180: 6174 6573 204b 7562 6572 6e65 7465 7320  ates Kubernetes 
+00019190: 7365 7276 6963 652d 6163 636f 756e 7420  service-account 
+000191a0: 616e 6420 7468 6520 5661 756c 7420 6175  and the Vault au
+000191b0: 7468 656e 7469 6361 7469 6f6e 0a20 2020  thentication.   
+000191c0: 2020 2020 2073 7472 7563 7475 7265 7320       structures 
+000191d0: 7468 6174 2061 7265 2072 6571 7569 7265  that are require
+000191e0: 6420 666f 7220 6675 6e63 7469 6f6e 2050  d for function P
+000191f0: 6f64 7320 746f 2061 7574 6865 6e74 6963  ods to authentic
+00019200: 6174 6520 7769 7468 2056 6175 6c74 2061  ate with Vault a
+00019210: 6e64 2062 6520 6162 6c65 2074 6f20 6578  nd be able to ex
+00019220: 7472 6163 7420 7365 6372 6574 2076 616c  tract secret val
+00019230: 7565 730a 2020 2020 2020 2020 7061 7373  ues.        pass
+00019240: 6564 2061 7320 7061 7274 206f 6620 7468  ed as part of th
+00019250: 6569 7220 636f 6e74 6578 742e 0a0a 2020  eir context...  
+00019260: 2020 2020 2020 4e6f 7465 3a0a 2020 2020        Note:.    
+00019270: 2020 2020 2020 2020 2020 2020 5468 6973              This
+00019280: 206d 6574 686f 6420 7573 6564 2077 6974   method used wit
+00019290: 6820 5661 756c 7420 6973 2063 7572 7265  h Vault is curre
+000192a0: 6e74 6c79 2069 6e20 7465 6368 6e69 6361  ntly in technica
+000192b0: 6c20 7072 6576 6965 772c 2061 6e64 2072  l preview, and r
+000192c0: 6571 7569 7265 7320 6120 4861 7368 6943  equires a HashiC
+000192d0: 6f72 7020 5661 756c 740a 2020 2020 2020  orp Vault.      
+000192e0: 2020 2020 2020 2020 2020 696e 6672 6173            infras
+000192f0: 7472 7563 7475 7265 2070 726f 7065 726c  tructure properl
+00019300: 7920 7365 7420 7570 2061 6e64 2063 6f6e  y set up and con
+00019310: 6e65 6374 6564 2074 6f20 7468 6520 4d4c  nected to the ML
+00019320: 5275 6e20 4150 4920 7365 7276 6572 2e0a  Run API server..
+00019330: 0a20 2020 2020 2020 2057 6865 6e20 7573  .        When us
+00019340: 6564 2077 6974 6820 4b75 6265 726e 6574  ed with Kubernet
+00019350: 6573 2c20 7468 6973 2077 696c 6c20 6d61  es, this will ma
+00019360: 6b65 2073 7572 6520 7468 6174 2074 6865  ke sure that the
+00019370: 2070 726f 6a65 6374 2d73 7065 6369 6669   project-specifi
+00019380: 6320 6b38 7320 7365 6372 6574 2069 7320  c k8s secret is 
+00019390: 6372 6561 7465 642c 2061 6e64 2077 696c  created, and wil
+000193a0: 6c0a 2020 2020 2020 2020 706f 7075 6c61  l.        popula
+000193b0: 7465 2069 7420 7769 7468 2074 6865 2073  te it with the s
+000193c0: 6563 7265 7473 2070 726f 7669 6465 642c  ecrets provided,
+000193d0: 2072 6570 6c61 6369 6e67 2074 6865 6972   replacing their
+000193e0: 2076 616c 7565 7320 6966 2074 6865 7920   values if they 
+000193f0: 6578 6973 742e 0a0a 2020 2020 2020 2020  exist...        
+00019400: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
+00019410: 5468 6520 7072 6f6a 6563 7420 636f 6e74  The project cont
+00019420: 6578 7420 666f 7220 7768 6963 6820 746f  ext for which to
+00019430: 2067 656e 6572 6174 6520 7468 6520 696e   generate the in
+00019440: 6672 6120 616e 6420 7374 6f72 6520 7365  fra and store se
+00019450: 6372 6574 732e 0a20 2020 2020 2020 203a  crets..        :
+00019460: 7061 7261 6d20 7072 6f76 6964 6572 3a20  param provider: 
+00019470: 5468 6520 6e61 6d65 206f 6620 7468 6520  The name of the 
+00019480: 7365 6372 6574 732d 7072 6f76 6964 6572  secrets-provider
+00019490: 2074 6f20 776f 726b 2077 6974 682e 2041   to work with. A
+000194a0: 6363 6570 7473 2061 0a20 2020 2020 2020  ccepts a.       
+000194b0: 2020 2020 203a 7079 3a63 6c61 7373 3a60       :py:class:`
+000194c0: 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  ~mlrun.common.sc
+000194d0: 6865 6d61 732e 7365 6372 6574 2e53 6563  hemas.secret.Sec
+000194e0: 7265 7450 726f 7669 6465 724e 616d 6560  retProviderName`
+000194f0: 2065 6e75 6d2e 0a20 2020 2020 2020 203a   enum..        :
+00019500: 7061 7261 6d20 7365 6372 6574 733a 2041  param secrets: A
+00019510: 2073 6574 206f 6620 7365 6372 6574 2076   set of secret v
+00019520: 616c 7565 7320 746f 2073 746f 7265 2e0a  alues to store..
+00019530: 2020 2020 2020 2020 2020 2020 4578 616d              Exam
+00019540: 706c 653a 3a0a 0a20 2020 2020 2020 2020  ple::..         
+00019550: 2020 2020 2020 2073 6563 7265 7473 203d         secrets =
+00019560: 207b 2770 6173 7377 6f72 6427 3a20 276d   {'password': 'm
+00019570: 7950 6173 7377 3072 6427 2c20 2761 7773  yPassw0rd', 'aws
+00019580: 5f6b 6579 273a 2027 3131 3132 3232 3333  _key': '11122233
+00019590: 3327 7d0a 2020 2020 2020 2020 2020 2020  3'}.            
+000195a0: 2020 2020 6462 2e63 7265 6174 655f 7072      db.create_pr
+000195b0: 6f6a 6563 745f 7365 6372 6574 7328 0a20  oject_secrets(. 
+000195c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195d0: 2020 2022 7072 6f6a 6563 7431 222c 0a20     "project1",. 
+000195e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195f0: 2020 2070 726f 7669 6465 723d 6d6c 7275     provider=mlru
+00019600: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00019610: 2e53 6563 7265 7450 726f 7669 6465 724e  .SecretProviderN
+00019620: 616d 652e 6b75 6265 726e 6574 6573 2c0a  ame.kubernetes,.
+00019630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019640: 2020 2020 7365 6372 6574 733d 7365 6372      secrets=secr
+00019650: 6574 730a 2020 2020 2020 2020 2020 2020  ets.            
+00019660: 2020 2020 290a 2020 2020 2020 2020 2222      ).        ""
+00019670: 220a 2020 2020 2020 2020 7061 7468 203d  ".        path =
+00019680: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+00019690: 6a65 6374 7d2f 7365 6372 6574 7322 0a20  ject}/secrets". 
+000196a0: 2020 2020 2020 2073 6563 7265 7473 5f69         secrets_i
+000196b0: 6e70 7574 203d 206d 6c72 756e 2e63 6f6d  nput = mlrun.com
+000196c0: 6d6f 6e2e 7363 6865 6d61 732e 5365 6372  mon.schemas.Secr
+000196d0: 6574 7344 6174 6128 0a20 2020 2020 2020  etsData(.       
+000196e0: 2020 2020 2073 6563 7265 7473 3d73 6563       secrets=sec
+000196f0: 7265 7473 2c20 7072 6f76 6964 6572 3d70  rets, provider=p
+00019700: 726f 7669 6465 720a 2020 2020 2020 2020  rovider.        
+00019710: 290a 2020 2020 2020 2020 626f 6479 203d  ).        body =
+00019720: 2073 6563 7265 7473 5f69 6e70 7574 2e64   secrets_input.d
+00019730: 6963 7428 290a 2020 2020 2020 2020 6572  ict().        er
+00019740: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
+00019750: 4661 696c 6564 2063 7265 6174 696e 6720  Failed creating 
+00019760: 7365 6372 6574 2070 726f 7669 6465 7220  secret provider 
+00019770: 7b70 726f 6a65 6374 7d2f 7b70 726f 7669  {project}/{provi
+00019780: 6465 727d 220a 2020 2020 2020 2020 7365  der}".        se
+00019790: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
+000197a0: 2020 2020 2020 2020 2022 504f 5354 222c           "POST",
+000197b0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+000197c0: 682c 0a20 2020 2020 2020 2020 2020 2065  h,.            e
+000197d0: 7272 6f72 5f6d 6573 7361 6765 2c0a 2020  rror_message,.  
+000197e0: 2020 2020 2020 2020 2020 626f 6479 3d64            body=d
+000197f0: 6963 745f 746f 5f6a 736f 6e28 626f 6479  ict_to_json(body
+00019800: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00019810: 2020 6465 6620 6c69 7374 5f70 726f 6a65    def list_proje
+00019820: 6374 5f73 6563 7265 7473 280a 2020 2020  ct_secrets(.    
+00019830: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00019840: 2020 7072 6f6a 6563 743a 2073 7472 2c0a    project: str,.
+00019850: 2020 2020 2020 2020 746f 6b65 6e3a 2073          token: s
+00019860: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
+00019870: 2020 2070 726f 7669 6465 723a 2055 6e69     provider: Uni
+00019880: 6f6e 5b0a 2020 2020 2020 2020 2020 2020  on[.            
+00019890: 7374 722c 206d 6c72 756e 2e63 6f6d 6d6f  str, mlrun.commo
+000198a0: 6e2e 7363 6865 6d61 732e 5365 6372 6574  n.schemas.Secret
+000198b0: 5072 6f76 6964 6572 4e61 6d65 0a20 2020  ProviderName.   
+000198c0: 2020 2020 205d 203d 206d 6c72 756e 2e63       ] = mlrun.c
+000198d0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5365  ommon.schemas.Se
+000198e0: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
+000198f0: 2e6b 7562 6572 6e65 7465 732c 0a20 2020  .kubernetes,.   
+00019900: 2020 2020 2073 6563 7265 7473 3a20 4c69       secrets: Li
+00019910: 7374 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  st[str] = None,.
+00019920: 2020 2020 2920 2d3e 206d 6c72 756e 2e63      ) -> mlrun.c
+00019930: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5365  ommon.schemas.Se
+00019940: 6372 6574 7344 6174 613a 0a20 2020 2020  cretsData:.     
+00019950: 2020 2022 2222 5265 7472 6965 7665 2070     """Retrieve p
+00019960: 726f 6a65 6374 2d63 6f6e 7465 7874 2073  roject-context s
+00019970: 6563 7265 7473 2066 726f 6d20 5661 756c  ecrets from Vaul
+00019980: 742e 0a0a 2020 2020 2020 2020 4e6f 7465  t...        Note
+00019990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000199a0: 2020 5468 6973 206d 6574 686f 6420 666f    This method fo
+000199b0: 7220 5661 756c 7420 6675 6e63 7469 6f6e  r Vault function
+000199c0: 616c 6974 7920 6973 2063 7572 7265 6e74  ality is current
+000199d0: 6c79 2069 6e20 7465 6368 6e69 6361 6c20  ly in technical 
+000199e0: 7072 6576 6965 772c 2061 6e64 2072 6571  preview, and req
+000199f0: 7569 7265 7320 6120 4861 7368 6943 6f72  uires a HashiCor
+00019a00: 7020 5661 756c 740a 2020 2020 2020 2020  p Vault.        
+00019a10: 2020 2020 2020 2020 696e 6672 6173 7472          infrastr
+00019a20: 7563 7475 7265 2070 726f 7065 726c 7920  ucture properly 
+00019a30: 7365 7420 7570 2061 6e64 2063 6f6e 6e65  set up and conne
+00019a40: 6374 6564 2074 6f20 7468 6520 4d4c 5275  cted to the MLRu
+00019a50: 6e20 4150 4920 7365 7276 6572 2e0a 0a20  n API server... 
+00019a60: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+00019a70: 6f6a 6563 743a 2054 6865 2070 726f 6a65  oject: The proje
+00019a80: 6374 206e 616d 652e 0a20 2020 2020 2020  ct name..       
+00019a90: 203a 7061 7261 6d20 746f 6b65 6e3a 2056   :param token: V
+00019aa0: 6175 6c74 2074 6f6b 656e 2074 6f20 7573  ault token to us
+00019ab0: 6520 666f 7220 7265 7472 6965 7669 6e67  e for retrieving
+00019ac0: 2073 6563 7265 7473 2e0a 2020 2020 2020   secrets..      
+00019ad0: 2020 2020 2020 4d75 7374 2062 6520 6120        Must be a 
+00019ae0: 7661 6c69 6420 5661 756c 7420 746f 6b65  valid Vault toke
+00019af0: 6e2c 2077 6974 6820 7065 726d 6973 7369  n, with permissi
+00019b00: 6f6e 7320 746f 2072 6574 7269 6576 6520  ons to retrieve 
+00019b10: 7365 6372 6574 7320 6f66 2074 6865 2070  secrets of the p
+00019b20: 726f 6a65 6374 2069 6e20 7175 6573 7469  roject in questi
+00019b30: 6f6e 2e0a 2020 2020 2020 2020 3a70 6172  on..        :par
+00019b40: 616d 2070 726f 7669 6465 723a 2054 6865  am provider: The
+00019b50: 206e 616d 6520 6f66 2074 6865 2073 6563   name of the sec
+00019b60: 7265 7473 2d70 726f 7669 6465 7220 746f  rets-provider to
+00019b70: 2077 6f72 6b20 7769 7468 2e20 4375 7272   work with. Curr
+00019b80: 656e 746c 7920 6f6e 6c79 2060 6076 6175  ently only ``vau
+00019b90: 6c74 6060 2069 7320 6163 6365 7074 6564  lt`` is accepted
+00019ba0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00019bb0: 2073 6563 7265 7473 3a20 4120 6c69 7374   secrets: A list
+00019bc0: 206f 6620 7365 6372 6574 206e 616d 6573   of secret names
+00019bd0: 2074 6f20 7265 7472 6965 7665 2e20 416e   to retrieve. An
+00019be0: 2065 6d70 7479 206c 6973 7420 6060 5b5d   empty list ``[]
+00019bf0: 6060 2077 696c 6c20 7265 7472 6965 7665  `` will retrieve
+00019c00: 2061 6c6c 2073 6563 7265 7473 2061 7373   all secrets ass
+00019c10: 6967 6e65 640a 2020 2020 2020 2020 2020  igned.          
+00019c20: 2020 746f 2074 6869 7320 7370 6563 6966    to this specif
+00019c30: 6963 2070 726f 6a65 6374 2e20 6060 6b75  ic project. ``ku
+00019c40: 6265 726e 6574 6573 6060 2070 726f 7669  bernetes`` provi
+00019c50: 6465 7220 6f6e 6c79 2073 7570 706f 7274  der only support
+00019c60: 7320 616e 2065 6d70 7479 206c 6973 742e  s an empty list.
+00019c70: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00019c80: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00019c90: 2020 2020 2020 2070 726f 7669 6465 7220         provider 
+00019ca0: 3d3d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  == mlrun.common.
+00019cb0: 7363 6865 6d61 732e 5365 6372 6574 5072  schemas.SecretPr
+00019cc0: 6f76 6964 6572 4e61 6d65 2e76 6175 6c74  oviderName.vault
+00019cd0: 2e76 616c 7565 0a20 2020 2020 2020 2020  .value.         
+00019ce0: 2020 2061 6e64 206e 6f74 2074 6f6b 656e     and not token
+00019cf0: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
+00019d00: 2020 2020 2020 2020 7261 6973 6520 4d4c          raise ML
+00019d10: 5275 6e49 6e76 616c 6964 4172 6775 6d65  RunInvalidArgume
+00019d20: 6e74 4572 726f 7228 0a20 2020 2020 2020  ntError(.       
+00019d30: 2020 2020 2020 2020 2022 4120 7661 756c           "A vaul
+00019d40: 7420 746f 6b65 6e20 6d75 7374 2062 6520  t token must be 
+00019d50: 7072 6f76 6964 6564 2077 6865 6e20 6163  provided when ac
+00019d60: 6365 7373 696e 6720 7661 756c 7420 7365  cessing vault se
+00019d70: 6372 6574 7322 0a20 2020 2020 2020 2020  crets".         
+00019d80: 2020 2029 0a0a 2020 2020 2020 2020 7061     )..        pa
+00019d90: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+00019da0: 7b70 726f 6a65 6374 7d2f 7365 6372 6574  {project}/secret
+00019db0: 7322 0a20 2020 2020 2020 2070 6172 616d  s".        param
+00019dc0: 7320 3d20 7b22 7072 6f76 6964 6572 223a  s = {"provider":
+00019dd0: 2070 726f 7669 6465 722c 2022 7365 6372   provider, "secr
+00019de0: 6574 223a 2073 6563 7265 7473 7d0a 2020  et": secrets}.  
+00019df0: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+00019e00: 7b6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  {mlrun.common.sc
+00019e10: 6865 6d61 732e 4865 6164 6572 4e61 6d65  hemas.HeaderName
+00019e20: 732e 7365 6372 6574 5f73 746f 7265 5f74  s.secret_store_t
+00019e30: 6f6b 656e 3a20 746f 6b65 6e7d 0a20 2020  oken: token}.   
+00019e40: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+00019e50: 6765 203d 2066 2246 6169 6c65 6420 7265  ge = f"Failed re
+00019e60: 7472 6965 7669 6e67 2073 6563 7265 7473  trieving secrets
+00019e70: 207b 7072 6f6a 6563 747d 2f7b 7072 6f76   {project}/{prov
+00019e80: 6964 6572 7d22 0a20 2020 2020 2020 2072  ider}".        r
+00019e90: 6573 756c 7420 3d20 7365 6c66 2e61 7069  esult = self.api
+00019ea0: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
+00019eb0: 2020 2022 4745 5422 2c0a 2020 2020 2020     "GET",.      
+00019ec0: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
+00019ed0: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
+00019ee0: 7373 6167 652c 0a20 2020 2020 2020 2020  ssage,.         
+00019ef0: 2020 2070 6172 616d 733d 7061 7261 6d73     params=params
+00019f00: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
+00019f10: 6164 6572 733d 6865 6164 6572 732c 0a20  aders=headers,. 
+00019f20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00019f30: 2072 6574 7572 6e20 6d6c 7275 6e2e 636f   return mlrun.co
+00019f40: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6563  mmon.schemas.Sec
+00019f50: 7265 7473 4461 7461 282a 2a72 6573 756c  retsData(**resul
+00019f60: 742e 6a73 6f6e 2829 290a 0a20 2020 2064  t.json())..    d
+00019f70: 6566 206c 6973 745f 7072 6f6a 6563 745f  ef list_project_
+00019f80: 7365 6372 6574 5f6b 6579 7328 0a20 2020  secret_keys(.   
+00019f90: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00019fa0: 2020 2070 726f 6a65 6374 3a20 7374 722c     project: str,
+00019fb0: 0a20 2020 2020 2020 2070 726f 7669 6465  .        provide
+00019fc0: 723a 2055 6e69 6f6e 5b0a 2020 2020 2020  r: Union[.      
+00019fd0: 2020 2020 2020 7374 722c 206d 6c72 756e        str, mlrun
+00019fe0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00019ff0: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
+0001a000: 6d65 0a20 2020 2020 2020 205d 203d 206d  me.        ] = m
+0001a010: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001a020: 6d61 732e 5365 6372 6574 5072 6f76 6964  mas.SecretProvid
+0001a030: 6572 4e61 6d65 2e6b 7562 6572 6e65 7465  erName.kubernete
+0001a040: 732c 0a20 2020 2020 2020 2074 6f6b 656e  s,.        token
+0001a050: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
+0001a060: 2020 2920 2d3e 206d 6c72 756e 2e63 6f6d    ) -> mlrun.com
+0001a070: 6d6f 6e2e 7363 6865 6d61 732e 5365 6372  mon.schemas.Secr
+0001a080: 6574 4b65 7973 4461 7461 3a0a 2020 2020  etKeysData:.    
+0001a090: 2020 2020 2222 2252 6574 7269 6576 6520      """Retrieve 
+0001a0a0: 7072 6f6a 6563 742d 636f 6e74 6578 7420  project-context 
+0001a0b0: 7365 6372 6574 206b 6579 7320 6672 6f6d  secret keys from
+0001a0c0: 2056 6175 6c74 206f 7220 4b75 6265 726e   Vault or Kubern
+0001a0d0: 6574 6573 2e0a 0a20 2020 2020 2020 204e  etes...        N
+0001a0e0: 6f74 653a 0a20 2020 2020 2020 2020 2020  ote:.           
+0001a0f0: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
+0001a100: 2066 6f72 2056 6175 6c74 2066 756e 6374   for Vault funct
+0001a110: 696f 6e61 6c69 7479 2069 7320 6375 7272  ionality is curr
+0001a120: 656e 746c 7920 696e 2074 6563 686e 6963  ently in technic
+0001a130: 616c 2070 7265 7669 6577 2c20 616e 6420  al preview, and 
+0001a140: 7265 7175 6972 6573 2061 2048 6173 6869  requires a Hashi
+0001a150: 436f 7270 2056 6175 6c74 0a20 2020 2020  Corp Vault.     
+0001a160: 2020 2020 2020 2020 2020 2069 6e66 7261             infra
+0001a170: 7374 7275 6374 7572 6520 7072 6f70 6572  structure proper
+0001a180: 6c79 2073 6574 2075 7020 616e 6420 636f  ly set up and co
+0001a190: 6e6e 6563 7465 6420 746f 2074 6865 204d  nnected to the M
+0001a1a0: 4c52 756e 2041 5049 2073 6572 7665 722e  LRun API server.
+0001a1b0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001a1c0: 2070 726f 6a65 6374 3a20 5468 6520 7072   project: The pr
+0001a1d0: 6f6a 6563 7420 6e61 6d65 2e0a 2020 2020  oject name..    
+0001a1e0: 2020 2020 3a70 6172 616d 2070 726f 7669      :param provi
+0001a1f0: 6465 723a 2054 6865 206e 616d 6520 6f66  der: The name of
+0001a200: 2074 6865 2073 6563 7265 7473 2d70 726f   the secrets-pro
+0001a210: 7669 6465 7220 746f 2077 6f72 6b20 7769  vider to work wi
+0001a220: 7468 2e20 4163 6365 7074 7320 610a 2020  th. Accepts a.  
+0001a230: 2020 2020 2020 2020 2020 3a70 793a 636c            :py:cl
+0001a240: 6173 733a 607e 6d6c 7275 6e2e 636f 6d6d  ass:`~mlrun.comm
+0001a250: 6f6e 2e73 6368 656d 6173 2e73 6563 7265  on.schemas.secre
+0001a260: 742e 5365 6372 6574 5072 6f76 6964 6572  t.SecretProvider
+0001a270: 4e61 6d65 6020 656e 756d 2e0a 2020 2020  Name` enum..    
+0001a280: 2020 2020 3a70 6172 616d 2074 6f6b 656e      :param token
+0001a290: 3a20 5661 756c 7420 746f 6b65 6e20 746f  : Vault token to
+0001a2a0: 2075 7365 2066 6f72 2072 6574 7269 6576   use for retriev
+0001a2b0: 696e 6720 7365 6372 6574 732e 204f 6e6c  ing secrets. Onl
+0001a2c0: 7920 696e 2075 7365 2069 6620 6060 7072  y in use if ``pr
+0001a2d0: 6f76 6964 6572 6060 2069 7320 6060 7661  ovider`` is ``va
+0001a2e0: 756c 7460 602e 0a20 2020 2020 2020 2020  ult``..         
+0001a2f0: 2020 204d 7573 7420 6265 2061 2076 616c     Must be a val
+0001a300: 6964 2056 6175 6c74 2074 6f6b 656e 2c20  id Vault token, 
+0001a310: 7769 7468 2070 6572 6d69 7373 696f 6e73  with permissions
+0001a320: 2074 6f20 7265 7472 6965 7665 2073 6563   to retrieve sec
+0001a330: 7265 7473 206f 6620 7468 6520 7072 6f6a  rets of the proj
+0001a340: 6563 7420 696e 2071 7565 7374 696f 6e2e  ect in question.
+0001a350: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0001a360: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+0001a370: 2020 2020 2020 2070 726f 7669 6465 7220         provider 
+0001a380: 3d3d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  == mlrun.common.
+0001a390: 7363 6865 6d61 732e 5365 6372 6574 5072  schemas.SecretPr
+0001a3a0: 6f76 6964 6572 4e61 6d65 2e76 6175 6c74  oviderName.vault
+0001a3b0: 2e76 616c 7565 0a20 2020 2020 2020 2020  .value.         
+0001a3c0: 2020 2061 6e64 206e 6f74 2074 6f6b 656e     and not token
+0001a3d0: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
+0001a3e0: 2020 2020 2020 2020 7261 6973 6520 4d4c          raise ML
+0001a3f0: 5275 6e49 6e76 616c 6964 4172 6775 6d65  RunInvalidArgume
+0001a400: 6e74 4572 726f 7228 0a20 2020 2020 2020  ntError(.       
+0001a410: 2020 2020 2020 2020 2022 4120 7661 756c           "A vaul
+0001a420: 7420 746f 6b65 6e20 6d75 7374 2062 6520  t token must be 
+0001a430: 7072 6f76 6964 6564 2077 6865 6e20 6163  provided when ac
+0001a440: 6365 7373 696e 6720 7661 756c 7420 7365  cessing vault se
+0001a450: 6372 6574 7322 0a20 2020 2020 2020 2020  crets".         
+0001a460: 2020 2029 0a0a 2020 2020 2020 2020 7061     )..        pa
+0001a470: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+0001a480: 7b70 726f 6a65 6374 7d2f 7365 6372 6574  {project}/secret
+0001a490: 2d6b 6579 7322 0a20 2020 2020 2020 2070  -keys".        p
+0001a4a0: 6172 616d 7320 3d20 7b22 7072 6f76 6964  arams = {"provid
+0001a4b0: 6572 223a 2070 726f 7669 6465 727d 0a20  er": provider}. 
+0001a4c0: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
+0001a4d0: 2028 0a20 2020 2020 2020 2020 2020 207b   (.            {
+0001a4e0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+0001a4f0: 656d 6173 2e48 6561 6465 724e 616d 6573  emas.HeaderNames
+0001a500: 2e73 6563 7265 745f 7374 6f72 655f 746f  .secret_store_to
+0001a510: 6b65 6e3a 2074 6f6b 656e 7d0a 2020 2020  ken: token}.    
+0001a520: 2020 2020 2020 2020 6966 2070 726f 7669          if provi
+0001a530: 6465 7220 3d3d 206d 6c72 756e 2e63 6f6d  der == mlrun.com
+0001a540: 6d6f 6e2e 7363 6865 6d61 732e 5365 6372  mon.schemas.Secr
+0001a550: 6574 5072 6f76 6964 6572 4e61 6d65 2e76  etProviderName.v
+0001a560: 6175 6c74 2e76 616c 7565 0a20 2020 2020  ault.value.     
+0001a570: 2020 2020 2020 2065 6c73 6520 4e6f 6e65         else None
+0001a580: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001a590: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+0001a5a0: 203d 2066 2246 6169 6c65 6420 7265 7472   = f"Failed retr
+0001a5b0: 6965 7669 6e67 2073 6563 7265 7420 6b65  ieving secret ke
+0001a5c0: 7973 207b 7072 6f6a 6563 747d 2f7b 7072  ys {project}/{pr
+0001a5d0: 6f76 6964 6572 7d22 0a20 2020 2020 2020  ovider}".       
+0001a5e0: 2072 6573 756c 7420 3d20 7365 6c66 2e61   result = self.a
+0001a5f0: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
+0001a600: 2020 2020 2022 4745 5422 2c0a 2020 2020       "GET",.    
+0001a610: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
+0001a620: 2020 2020 2020 2020 2020 6572 726f 725f            error_
+0001a630: 6d65 7373 6167 652c 0a20 2020 2020 2020  message,.       
+0001a640: 2020 2020 2070 6172 616d 733d 7061 7261       params=para
+0001a650: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
+0001a660: 6865 6164 6572 733d 6865 6164 6572 732c  headers=headers,
+0001a670: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001a680: 2020 2072 6574 7572 6e20 6d6c 7275 6e2e     return mlrun.
+0001a690: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
+0001a6a0: 6563 7265 744b 6579 7344 6174 6128 2a2a  ecretKeysData(**
+0001a6b0: 7265 7375 6c74 2e6a 736f 6e28 2929 0a0a  result.json())..
+0001a6c0: 2020 2020 6465 6620 6465 6c65 7465 5f70      def delete_p
+0001a6d0: 726f 6a65 6374 5f73 6563 7265 7473 280a  roject_secrets(.
+0001a6e0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0001a6f0: 2020 2020 2020 7072 6f6a 6563 743a 2073        project: s
+0001a700: 7472 2c0a 2020 2020 2020 2020 7072 6f76  tr,.        prov
+0001a710: 6964 6572 3a20 556e 696f 6e5b 0a20 2020  ider: Union[.   
+0001a720: 2020 2020 2020 2020 2073 7472 2c20 6d6c           str, ml
+0001a730: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001a740: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
+0001a750: 724e 616d 650a 2020 2020 2020 2020 5d20  rName.        ] 
+0001a760: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+0001a770: 6368 656d 6173 2e53 6563 7265 7450 726f  chemas.SecretPro
+0001a780: 7669 6465 724e 616d 652e 6b75 6265 726e  viderName.kubern
+0001a790: 6574 6573 2c0a 2020 2020 2020 2020 7365  etes,.        se
+0001a7a0: 6372 6574 733a 204c 6973 745b 7374 725d  crets: List[str]
+0001a7b0: 203d 204e 6f6e 652c 0a20 2020 2029 3a0a   = None,.    ):.
+0001a7c0: 2020 2020 2020 2020 2222 2244 656c 6574          """Delet
+0001a7d0: 6520 7072 6f6a 6563 742d 636f 6e74 6578  e project-contex
+0001a7e0: 7420 7365 6372 6574 7320 6672 6f6d 204b  t secrets from K
+0001a7f0: 7562 6572 6e65 7465 732e 0a0a 2020 2020  ubernetes...    
+0001a800: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
+0001a810: 6374 3a20 5468 6520 7072 6f6a 6563 7420  ct: The project 
+0001a820: 6e61 6d65 2e0a 2020 2020 2020 2020 3a70  name..        :p
+0001a830: 6172 616d 2070 726f 7669 6465 723a 2054  aram provider: T
+0001a840: 6865 206e 616d 6520 6f66 2074 6865 2073  he name of the s
+0001a850: 6563 7265 7473 2d70 726f 7669 6465 7220  ecrets-provider 
+0001a860: 746f 2077 6f72 6b20 7769 7468 2e20 4375  to work with. Cu
+0001a870: 7272 656e 746c 7920 6f6e 6c79 2060 606b  rrently only ``k
+0001a880: 7562 6572 6e65 7465 7360 6020 6973 2073  ubernetes`` is s
+0001a890: 7570 706f 7274 6564 2e0a 2020 2020 2020  upported..      
+0001a8a0: 2020 3a70 6172 616d 2073 6563 7265 7473    :param secrets
+0001a8b0: 3a20 4120 6c69 7374 206f 6620 7365 6372  : A list of secr
+0001a8c0: 6574 206e 616d 6573 2074 6f20 6465 6c65  et names to dele
+0001a8d0: 7465 2e20 416e 2065 6d70 7479 206c 6973  te. An empty lis
+0001a8e0: 7420 7769 6c6c 2064 656c 6574 6520 616c  t will delete al
+0001a8f0: 6c20 7365 6372 6574 7320 6173 7369 676e  l secrets assign
+0001a900: 6564 0a20 2020 2020 2020 2020 2020 2074  ed.            t
+0001a910: 6f20 7468 6973 2073 7065 6369 6669 6320  o this specific 
+0001a920: 7072 6f6a 6563 742e 0a20 2020 2020 2020  project..       
+0001a930: 2022 2222 0a0a 2020 2020 2020 2020 7061   """..        pa
+0001a940: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+0001a950: 7b70 726f 6a65 6374 7d2f 7365 6372 6574  {project}/secret
+0001a960: 7322 0a20 2020 2020 2020 2070 6172 616d  s".        param
+0001a970: 7320 3d20 7b22 7072 6f76 6964 6572 223a  s = {"provider":
+0001a980: 2070 726f 7669 6465 722c 2022 7365 6372   provider, "secr
+0001a990: 6574 223a 2073 6563 7265 7473 7d0a 2020  et": secrets}.  
+0001a9a0: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+0001a9b0: 6167 6520 3d20 6622 4661 696c 6564 2064  age = f"Failed d
+0001a9c0: 656c 6574 696e 6720 7365 6372 6574 7320  eleting secrets 
+0001a9d0: 7b70 726f 6a65 6374 7d2f 7b70 726f 7669  {project}/{provi
+0001a9e0: 6465 727d 220a 2020 2020 2020 2020 7365  der}".        se
+0001a9f0: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
+0001aa00: 2020 2020 2020 2020 2022 4445 4c45 5445           "DELETE
+0001aa10: 222c 0a20 2020 2020 2020 2020 2020 2070  ",.            p
+0001aa20: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+0001aa30: 2065 7272 6f72 5f6d 6573 7361 6765 2c0a   error_message,.
+0001aa40: 2020 2020 2020 2020 2020 2020 7061 7261              para
+0001aa50: 6d73 3d70 6172 616d 732c 0a20 2020 2020  ms=params,.     
+0001aa60: 2020 2029 0a0a 2020 2020 6465 6620 6372     )..    def cr
+0001aa70: 6561 7465 5f75 7365 725f 7365 6372 6574  eate_user_secret
+0001aa80: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+0001aa90: 0a20 2020 2020 2020 2075 7365 723a 2073  .        user: s
+0001aaa0: 7472 2c0a 2020 2020 2020 2020 7072 6f76  tr,.        prov
+0001aab0: 6964 6572 3a20 556e 696f 6e5b 0a20 2020  ider: Union[.   
+0001aac0: 2020 2020 2020 2020 2073 7472 2c20 6d6c           str, ml
+0001aad0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001aae0: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
+0001aaf0: 724e 616d 650a 2020 2020 2020 2020 5d20  rName.        ] 
+0001ab00: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+0001ab10: 6368 656d 6173 2e53 6563 7265 7450 726f  chemas.SecretPro
+0001ab20: 7669 6465 724e 616d 652e 7661 756c 742c  viderName.vault,
+0001ab30: 0a20 2020 2020 2020 2073 6563 7265 7473  .        secrets
+0001ab40: 3a20 6469 6374 203d 204e 6f6e 652c 0a20  : dict = None,. 
+0001ab50: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+0001ab60: 2243 7265 6174 6520 7573 6572 2d63 6f6e  "Create user-con
+0001ab70: 7465 7874 2073 6563 7265 7420 696e 2056  text secret in V
+0001ab80: 6175 6c74 2e20 506c 6561 7365 2072 6566  ault. Please ref
+0001ab90: 6572 2074 6f20 3a70 793a 6675 6e63 3a60  er to :py:func:`
+0001aba0: 6372 6561 7465 5f70 726f 6a65 6374 5f73  create_project_s
+0001abb0: 6563 7265 7473 6020 666f 7220 6d6f 7265  ecrets` for more
+0001abc0: 2064 6574 6169 6c73 0a20 2020 2020 2020   details.       
+0001abd0: 2061 6e64 2073 7461 7475 7320 6f66 2074   and status of t
+0001abe0: 6869 7320 6675 6e63 7469 6f6e 616c 6974  his functionalit
+0001abf0: 792e 0a0a 2020 2020 2020 2020 4e6f 7465  y...        Note
+0001ac00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ac10: 2020 5468 6973 206d 6574 686f 6420 6973    This method is
+0001ac20: 2063 7572 7265 6e74 6c79 2069 6e20 7465   currently in te
+0001ac30: 6368 6e69 6361 6c20 7072 6576 6965 772c  chnical preview,
+0001ac40: 2061 6e64 2072 6571 7569 7265 7320 6120   and requires a 
+0001ac50: 4861 7368 6943 6f72 7020 5661 756c 7420  HashiCorp Vault 
+0001ac60: 696e 6672 6173 7472 7563 7475 7265 0a20  infrastructure. 
+0001ac70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001ac80: 726f 7065 726c 7920 7365 7420 7570 2061  roperly set up a
+0001ac90: 6e64 2063 6f6e 6e65 6374 6564 2074 6f20  nd connected to 
+0001aca0: 7468 6520 4d4c 5275 6e20 4150 4920 7365  the MLRun API se
+0001acb0: 7276 6572 2e0a 0a20 2020 2020 2020 203a  rver...        :
+0001acc0: 7061 7261 6d20 7573 6572 3a20 5468 6520  param user: The 
+0001acd0: 7573 6572 2063 6f6e 7465 7874 2066 6f72  user context for
+0001ace0: 2077 6869 6368 2074 6f20 6765 6e65 7261   which to genera
+0001acf0: 7465 2074 6865 2069 6e66 7261 2061 6e64  te the infra and
+0001ad00: 2073 746f 7265 2073 6563 7265 7473 2e0a   store secrets..
+0001ad10: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+0001ad20: 726f 7669 6465 723a 2054 6865 206e 616d  rovider: The nam
+0001ad30: 6520 6f66 2074 6865 2073 6563 7265 7473  e of the secrets
+0001ad40: 2d70 726f 7669 6465 7220 746f 2077 6f72  -provider to wor
+0001ad50: 6b20 7769 7468 2e20 4375 7272 656e 746c  k with. Currentl
+0001ad60: 7920 6f6e 6c79 2060 6076 6175 6c74 6060  y only ``vault``
+0001ad70: 2069 7320 7375 7070 6f72 7465 642e 0a20   is supported.. 
+0001ad80: 2020 2020 2020 203a 7061 7261 6d20 7365         :param se
+0001ad90: 6372 6574 733a 2041 2073 6574 206f 6620  crets: A set of 
+0001ada0: 7365 6372 6574 2076 616c 7565 7320 746f  secret values to
+0001adb0: 2073 746f 7265 2077 6974 6869 6e20 7468   store within th
+0001adc0: 6520 5661 756c 742e 0a20 2020 2020 2020  e Vault..       
+0001add0: 2022 2222 0a20 2020 2020 2020 2070 6174   """.        pat
+0001ade0: 6820 3d20 2275 7365 722d 7365 6372 6574  h = "user-secret
+0001adf0: 7322 0a20 2020 2020 2020 2073 6563 7265  s".        secre
+0001ae00: 7473 5f63 7265 6174 696f 6e5f 7265 7175  ts_creation_requ
+0001ae10: 6573 7420 3d20 6d6c 7275 6e2e 636f 6d6d  est = mlrun.comm
+0001ae20: 6f6e 2e73 6368 656d 6173 2e55 7365 7253  on.schemas.UserS
+0001ae30: 6563 7265 7443 7265 6174 696f 6e52 6571  ecretCreationReq
+0001ae40: 7565 7374 280a 2020 2020 2020 2020 2020  uest(.          
+0001ae50: 2020 7573 6572 3d75 7365 722c 0a20 2020    user=user,.   
+0001ae60: 2020 2020 2020 2020 2070 726f 7669 6465           provide
+0001ae70: 723d 7072 6f76 6964 6572 2c0a 2020 2020  r=provider,.    
+0001ae80: 2020 2020 2020 2020 7365 6372 6574 733d          secrets=
+0001ae90: 7365 6372 6574 732c 0a20 2020 2020 2020  secrets,.       
+0001aea0: 2029 0a20 2020 2020 2020 2062 6f64 7920   ).        body 
+0001aeb0: 3d20 7365 6372 6574 735f 6372 6561 7469  = secrets_creati
+0001aec0: 6f6e 5f72 6571 7565 7374 2e64 6963 7428  on_request.dict(
+0001aed0: 290a 2020 2020 2020 2020 6572 726f 725f  ).        error_
+0001aee0: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+0001aef0: 6564 2063 7265 6174 696e 6720 7573 6572  ed creating user
+0001af00: 2073 6563 7265 7473 202d 207b 7573 6572   secrets - {user
+0001af10: 7d22 0a20 2020 2020 2020 2073 656c 662e  }".        self.
+0001af20: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+0001af30: 2020 2020 2020 2250 4f53 5422 2c0a 2020        "POST",.  
+0001af40: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
+0001af50: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0001af60: 725f 6d65 7373 6167 652c 0a20 2020 2020  r_message,.     
+0001af70: 2020 2020 2020 2062 6f64 793d 6469 6374         body=dict
+0001af80: 5f74 6f5f 6a73 6f6e 2862 6f64 7929 2c0a  _to_json(body),.
+0001af90: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
+0001afa0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+0001afb0: 2064 6566 205f 7661 6c69 6461 7465 5f76   def _validate_v
+0001afc0: 6572 7369 6f6e 5f63 6f6d 7061 7469 6269  ersion_compatibi
+0001afd0: 6c69 7479 2873 6572 7665 725f 7665 7273  lity(server_vers
+0001afe0: 696f 6e2c 2063 6c69 656e 745f 7665 7273  ion, client_vers
+0001aff0: 696f 6e29 202d 3e20 626f 6f6c 3a0a 2020  ion) -> bool:.  
+0001b000: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001b010: 2020 2020 2020 2070 6172 7365 645f 7365         parsed_se
+0001b020: 7276 6572 5f76 6572 7369 6f6e 203d 2073  rver_version = s
+0001b030: 656d 7665 722e 5665 7273 696f 6e49 6e66  emver.VersionInf
+0001b040: 6f2e 7061 7273 6528 7365 7276 6572 5f76  o.parse(server_v
+0001b050: 6572 7369 6f6e 290a 2020 2020 2020 2020  ersion).        
+0001b060: 2020 2020 7061 7273 6564 5f63 6c69 656e      parsed_clien
+0001b070: 745f 7665 7273 696f 6e20 3d20 7365 6d76  t_version = semv
+0001b080: 6572 2e56 6572 7369 6f6e 496e 666f 2e70  er.VersionInfo.p
+0001b090: 6172 7365 2863 6c69 656e 745f 7665 7273  arse(client_vers
+0001b0a0: 696f 6e29 0a20 2020 2020 2020 2065 7863  ion).        exc
+0001b0b0: 6570 7420 5661 6c75 6545 7272 6f72 3a0a  ept ValueError:.
+0001b0c0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+0001b0d0: 6973 2077 696c 6c20 6d6f 7374 6c79 2068  is will mostly h
+0001b0e0: 6170 7065 6e20 696e 2064 6576 2073 6365  appen in dev sce
+0001b0f0: 6e61 7269 6f73 2077 6865 6e20 7468 6520  narios when the 
+0001b100: 7665 7273 696f 6e20 6973 2075 6e73 7461  version is unsta
+0001b110: 626c 6520 616e 6420 7375 6368 202d 2074  ble and such - t
+0001b120: 6865 7265 666f 7265 2077 6527 7265 2069  herefore we're i
+0001b130: 676e 6f72 696e 670a 2020 2020 2020 2020  gnoring.        
+0001b140: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+0001b150: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+0001b160: 2020 2020 2255 6e61 626c 6520 746f 2070      "Unable to p
+0001b170: 6172 7365 2073 6572 7665 7220 6f72 2063  arse server or c
+0001b180: 6c69 656e 7420 7665 7273 696f 6e2e 2041  lient version. A
+0001b190: 7373 756d 696e 6720 636f 6d70 6174 6962  ssuming compatib
+0001b1a0: 6c65 222c 0a20 2020 2020 2020 2020 2020  le",.           
+0001b1b0: 2020 2020 2073 6572 7665 725f 7665 7273       server_vers
+0001b1c0: 696f 6e3d 7365 7276 6572 5f76 6572 7369  ion=server_versi
+0001b1d0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0001b1e0: 2020 2020 636c 6965 6e74 5f76 6572 7369      client_versi
+0001b1f0: 6f6e 3d63 6c69 656e 745f 7665 7273 696f  on=client_versio
+0001b200: 6e2c 0a20 2020 2020 2020 2020 2020 2029  n,.            )
+0001b210: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001b220: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+0001b230: 2069 6620 2870 6172 7365 645f 7365 7276   if (parsed_serv
+0001b240: 6572 5f76 6572 7369 6f6e 2e6d 616a 6f72  er_version.major
+0001b250: 203d 3d20 3020 616e 6420 7061 7273 6564   == 0 and parsed
+0001b260: 5f73 6572 7665 725f 7665 7273 696f 6e2e  _server_version.
+0001b270: 6d69 6e6f 7220 3d3d 2030 2920 6f72 2028  minor == 0) or (
+0001b280: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+0001b290: 7365 645f 636c 6965 6e74 5f76 6572 7369  sed_client_versi
+0001b2a0: 6f6e 2e6d 616a 6f72 203d 3d20 3020 616e  on.major == 0 an
+0001b2b0: 6420 7061 7273 6564 5f63 6c69 656e 745f  d parsed_client_
+0001b2c0: 7665 7273 696f 6e2e 6d69 6e6f 7220 3d3d  version.minor ==
+0001b2d0: 2030 0a20 2020 2020 2020 2029 3a0a 2020   0.        ):.  
+0001b2e0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0001b2f0: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+0001b300: 2020 2020 2020 2020 2020 2253 6572 7665            "Serve
+0001b310: 7220 6f72 2063 6c69 656e 7420 7665 7273  r or client vers
+0001b320: 696f 6e20 6973 2075 6e73 7461 626c 652e  ion is unstable.
+0001b330: 2041 7373 756d 696e 6720 636f 6d70 6174   Assuming compat
+0001b340: 6962 6c65 222c 0a20 2020 2020 2020 2020  ible",.         
+0001b350: 2020 2020 2020 2073 6572 7665 725f 7665         server_ve
+0001b360: 7273 696f 6e3d 7365 7276 6572 5f76 6572  rsion=server_ver
+0001b370: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
+0001b380: 2020 2020 2020 636c 6965 6e74 5f76 6572        client_ver
+0001b390: 7369 6f6e 3d63 6c69 656e 745f 7665 7273  sion=client_vers
+0001b3a0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0001b3b0: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+0001b3c0: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
+0001b3d0: 2020 2069 6620 7061 7273 6564 5f73 6572     if parsed_ser
+0001b3e0: 7665 725f 7665 7273 696f 6e2e 6d61 6a6f  ver_version.majo
+0001b3f0: 7220 213d 2070 6172 7365 645f 636c 6965  r != parsed_clie
+0001b400: 6e74 5f76 6572 7369 6f6e 2e6d 616a 6f72  nt_version.major
+0001b410: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+0001b420: 6767 6572 2e77 6172 6e69 6e67 280a 2020  gger.warning(.  
+0001b430: 2020 2020 2020 2020 2020 2020 2020 2253                "S
+0001b440: 6572 7665 7220 616e 6420 636c 6965 6e74  erver and client
+0001b450: 2076 6572 7369 6f6e 7320 6172 6520 696e   versions are in
+0001b460: 636f 6d70 6174 6962 6c65 222c 0a20 2020  compatible",.   
+0001b470: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0001b480: 7365 645f 7365 7276 6572 5f76 6572 7369  sed_server_versi
+0001b490: 6f6e 3d70 6172 7365 645f 7365 7276 6572  on=parsed_server
+0001b4a0: 5f76 6572 7369 6f6e 2c0a 2020 2020 2020  _version,.      
+0001b4b0: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
+0001b4c0: 5f63 6c69 656e 745f 7665 7273 696f 6e3d  _client_version=
+0001b4d0: 7061 7273 6564 5f63 6c69 656e 745f 7665  parsed_client_ve
+0001b4e0: 7273 696f 6e2c 0a20 2020 2020 2020 2020  rsion,.         
+0001b4f0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001b500: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0001b510: 2020 2020 2020 6966 2070 6172 7365 645f        if parsed_
+0001b520: 7365 7276 6572 5f76 6572 7369 6f6e 2e6d  server_version.m
+0001b530: 696e 6f72 203e 2070 6172 7365 645f 636c  inor > parsed_cl
+0001b540: 6965 6e74 5f76 6572 7369 6f6e 2e6d 696e  ient_version.min
+0001b550: 6f72 202b 2032 3a0a 2020 2020 2020 2020  or + 2:.        
+0001b560: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+0001b570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b580: 2022 4261 636b 7761 7264 7320 636f 6d70   "Backwards comp
+0001b590: 6174 6962 696c 6974 7920 6d69 6768 7420  atibility might 
+0001b5a0: 6e6f 7420 6170 706c 7920 6265 7477 6565  not apply betwee
+0001b5b0: 6e20 7468 6520 7365 7276 6572 2061 6e64  n the server and
+0001b5c0: 2063 6c69 656e 7420 7665 7273 696f 6e22   client version"
+0001b5d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b5e0: 2020 7061 7273 6564 5f73 6572 7665 725f    parsed_server_
+0001b5f0: 7665 7273 696f 6e3d 7061 7273 6564 5f73  version=parsed_s
+0001b600: 6572 7665 725f 7665 7273 696f 6e2c 0a20  erver_version,. 
+0001b610: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001b620: 6172 7365 645f 636c 6965 6e74 5f76 6572  arsed_client_ver
+0001b630: 7369 6f6e 3d70 6172 7365 645f 636c 6965  sion=parsed_clie
+0001b640: 6e74 5f76 6572 7369 6f6e 2c0a 2020 2020  nt_version,.    
+0001b650: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001b660: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001b670: 7365 0a20 2020 2020 2020 2069 6620 7061  se.        if pa
+0001b680: 7273 6564 5f63 6c69 656e 745f 7665 7273  rsed_client_vers
+0001b690: 696f 6e2e 6d69 6e6f 7220 3e20 7061 7273  ion.minor > pars
+0001b6a0: 6564 5f73 6572 7665 725f 7665 7273 696f  ed_server_versio
+0001b6b0: 6e2e 6d69 6e6f 723a 0a20 2020 2020 2020  n.minor:.       
+0001b6c0: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
+0001b6d0: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
+0001b6e0: 2020 2020 2022 436c 6965 6e74 2076 6572       "Client ver
+0001b6f0: 7369 6f6e 2077 6974 6820 6869 6768 6572  sion with higher
+0001b700: 2076 6572 7369 6f6e 2074 6861 6e20 7365   version than se
+0001b710: 7276 6572 2076 6572 7369 6f6e 2069 736e  rver version isn
+0001b720: 2774 2073 7570 706f 7274 6564 2c22 0a20  't supported,". 
+0001b730: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001b740: 2061 6c69 676e 2079 6f75 7220 636c 6965   align your clie
+0001b750: 6e74 2074 6f20 7468 6520 7365 7276 6572  nt to the server
+0001b760: 2076 6572 7369 6f6e 222c 0a20 2020 2020   version",.     
+0001b770: 2020 2020 2020 2020 2020 2070 6172 7365             parse
+0001b780: 645f 7365 7276 6572 5f76 6572 7369 6f6e  d_server_version
+0001b790: 3d70 6172 7365 645f 7365 7276 6572 5f76  =parsed_server_v
+0001b7a0: 6572 7369 6f6e 2c0a 2020 2020 2020 2020  ersion,.        
+0001b7b0: 2020 2020 2020 2020 7061 7273 6564 5f63          parsed_c
+0001b7c0: 6c69 656e 745f 7665 7273 696f 6e3d 7061  lient_version=pa
+0001b7d0: 7273 6564 5f63 6c69 656e 745f 7665 7273  rsed_client_vers
+0001b7e0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0001b7f0: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+0001b800: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+0001b810: 2020 2020 6966 2070 6172 7365 645f 7365      if parsed_se
+0001b820: 7276 6572 5f76 6572 7369 6f6e 2e6d 696e  rver_version.min
+0001b830: 6f72 2021 3d20 7061 7273 6564 5f63 6c69  or != parsed_cli
+0001b840: 656e 745f 7665 7273 696f 6e2e 6d69 6e6f  ent_version.mino
+0001b850: 723a 0a20 2020 2020 2020 2020 2020 206c  r:.            l
+0001b860: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
+0001b870: 2020 2020 2020 2020 2020 2020 2253 6572              "Ser
+0001b880: 7665 7220 616e 6420 636c 6965 6e74 2076  ver and client v
+0001b890: 6572 7369 6f6e 7320 6172 6520 6e6f 7420  ersions are not 
+0001b8a0: 7468 6520 7361 6d65 2062 7574 2063 6f6d  the same but com
+0001b8b0: 7061 7469 626c 6522 2c0a 2020 2020 2020  patible",.      
+0001b8c0: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
+0001b8d0: 5f73 6572 7665 725f 7665 7273 696f 6e3d  _server_version=
+0001b8e0: 7061 7273 6564 5f73 6572 7665 725f 7665  parsed_server_ve
+0001b8f0: 7273 696f 6e2c 0a20 2020 2020 2020 2020  rsion,.         
+0001b900: 2020 2020 2020 2070 6172 7365 645f 636c         parsed_cl
+0001b910: 6965 6e74 5f76 6572 7369 6f6e 3d70 6172  ient_version=par
+0001b920: 7365 645f 636c 6965 6e74 5f76 6572 7369  sed_client_versi
+0001b930: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0001b940: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001b950: 2054 7275 650a 0a20 2020 2064 6566 2063   True..    def c
+0001b960: 7265 6174 655f 6d6f 6465 6c5f 656e 6470  reate_model_endp
+0001b970: 6f69 6e74 280a 2020 2020 2020 2020 7365  oint(.        se
+0001b980: 6c66 2c0a 2020 2020 2020 2020 7072 6f6a  lf,.        proj
+0001b990: 6563 743a 2073 7472 2c0a 2020 2020 2020  ect: str,.      
+0001b9a0: 2020 656e 6470 6f69 6e74 5f69 643a 2073    endpoint_id: s
+0001b9b0: 7472 2c0a 2020 2020 2020 2020 6d6f 6465  tr,.        mode
+0001b9c0: 6c5f 656e 6470 6f69 6e74 3a20 556e 696f  l_endpoint: Unio
+0001b9d0: 6e5b 0a20 2020 2020 2020 2020 2020 206d  n[.            m
+0001b9e0: 6c72 756e 2e6d 6f64 656c 5f6d 6f6e 6974  lrun.model_monit
+0001b9f0: 6f72 696e 672e 6d6f 6465 6c5f 656e 6470  oring.model_endp
+0001ba00: 6f69 6e74 2e4d 6f64 656c 456e 6470 6f69  oint.ModelEndpoi
+0001ba10: 6e74 2c20 6469 6374 0a20 2020 2020 2020  nt, dict.       
+0001ba20: 205d 2c0a 2020 2020 293a 0a20 2020 2020   ],.    ):.     
+0001ba30: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+0001ba40: 7265 6174 6573 2061 2044 4220 7265 636f  reates a DB reco
+0001ba50: 7264 2077 6974 6820 7468 6520 6769 7665  rd with the give
+0001ba60: 6e20 6d6f 6465 6c5f 656e 6470 6f69 6e74  n model_endpoint
+0001ba70: 2072 6563 6f72 642e 0a0a 2020 2020 2020   record...      
+0001ba80: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+0001ba90: 3a20 5468 6520 6e61 6d65 206f 6620 7468  : The name of th
+0001baa0: 6520 7072 6f6a 6563 742e 0a20 2020 2020  e project..     
+0001bab0: 2020 203a 7061 7261 6d20 656e 6470 6f69     :param endpoi
+0001bac0: 6e74 5f69 643a 2054 6865 2069 6420 6f66  nt_id: The id of
+0001bad0: 2074 6865 2065 6e64 706f 696e 742e 0a20   the endpoint.. 
+0001bae0: 2020 2020 2020 203a 7061 7261 6d20 6d6f         :param mo
+0001baf0: 6465 6c5f 656e 6470 6f69 6e74 3a20 416e  del_endpoint: An
+0001bb00: 206f 626a 6563 7420 7265 7072 6573 656e   object represen
+0001bb10: 7469 6e67 2074 6865 206d 6f64 656c 2065  ting the model e
+0001bb20: 6e64 706f 696e 742e 0a20 2020 2020 2020  ndpoint..       
+0001bb30: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
+0001bb40: 2069 7369 6e73 7461 6e63 6528 0a20 2020   isinstance(.   
+0001bb50: 2020 2020 2020 2020 206d 6f64 656c 5f65           model_e
+0001bb60: 6e64 706f 696e 742c 206d 6c72 756e 2e6d  ndpoint, mlrun.m
+0001bb70: 6f64 656c 5f6d 6f6e 6974 6f72 696e 672e  odel_monitoring.
+0001bb80: 6d6f 6465 6c5f 656e 6470 6f69 6e74 2e4d  model_endpoint.M
+0001bb90: 6f64 656c 456e 6470 6f69 6e74 0a20 2020  odelEndpoint.   
+0001bba0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0001bbb0: 2020 2020 6d6f 6465 6c5f 656e 6470 6f69      model_endpoi
+0001bbc0: 6e74 203d 206d 6f64 656c 5f65 6e64 706f  nt = model_endpo
+0001bbd0: 696e 742e 746f 5f64 6963 7428 290a 0a20  int.to_dict().. 
+0001bbe0: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+0001bbf0: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
+0001bc00: 747d 2f6d 6f64 656c 2d65 6e64 706f 696e  t}/model-endpoin
+0001bc10: 7473 2f7b 656e 6470 6f69 6e74 5f69 647d  ts/{endpoint_id}
+0001bc20: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
+0001bc30: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
+0001bc40: 2020 2020 206d 6574 686f 643d 2250 4f53       method="POS
+0001bc50: 5422 2c0a 2020 2020 2020 2020 2020 2020  T",.            
+0001bc60: 7061 7468 3d70 6174 682c 0a20 2020 2020  path=path,.     
+0001bc70: 2020 2020 2020 2062 6f64 793d 6469 6374         body=dict
+0001bc80: 5f74 6f5f 6a73 6f6e 286d 6f64 656c 5f65  _to_json(model_e
+0001bc90: 6e64 706f 696e 7429 2c0a 2020 2020 2020  ndpoint),.      
+0001bca0: 2020 290a 0a20 2020 2064 6566 2064 656c    )..    def del
+0001bcb0: 6574 655f 6d6f 6465 6c5f 656e 6470 6f69  ete_model_endpoi
+0001bcc0: 6e74 280a 2020 2020 2020 2020 7365 6c66  nt(.        self
+0001bcd0: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+0001bce0: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
+0001bcf0: 656e 6470 6f69 6e74 5f69 643a 2073 7472  endpoint_id: str
+0001bd00: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+0001bd10: 2022 2222 0a20 2020 2020 2020 2044 656c   """.        Del
+0001bd20: 6574 6573 2074 6865 2044 4220 7265 636f  etes the DB reco
+0001bd30: 7264 206f 6620 6120 6769 7665 6e20 6d6f  rd of a given mo
+0001bd40: 6465 6c20 656e 6470 6f69 6e74 2c20 7072  del endpoint, pr
+0001bd50: 6f6a 6563 7420 616e 6420 656e 6470 6f69  oject and endpoi
+0001bd60: 6e74 5f69 6420 6172 6520 7573 6564 2066  nt_id are used f
+0001bd70: 6f72 206c 6f6f 6b75 700a 0a20 2020 2020  or lookup..     
+0001bd80: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+0001bd90: 743a 2054 6865 206e 616d 6520 6f66 2074  t: The name of t
+0001bda0: 6865 2070 726f 6a65 6374 0a20 2020 2020  he project.     
+0001bdb0: 2020 203a 7061 7261 6d20 656e 6470 6f69     :param endpoi
+0001bdc0: 6e74 5f69 643a 2054 6865 2069 6420 6f66  nt_id: The id of
+0001bdd0: 2074 6865 2065 6e64 706f 696e 740a 2020   the endpoint.  
+0001bde0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0001bdf0: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
+0001be00: 6563 7473 2f7b 7072 6f6a 6563 747d 2f6d  ects/{project}/m
+0001be10: 6f64 656c 2d65 6e64 706f 696e 7473 2f7b  odel-endpoints/{
+0001be20: 656e 6470 6f69 6e74 5f69 647d 220a 2020  endpoint_id}".  
+0001be30: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+0001be40: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+0001be50: 206d 6574 686f 643d 2244 454c 4554 4522   method="DELETE"
+0001be60: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+0001be70: 7468 3d70 6174 682c 0a20 2020 2020 2020  th=path,.       
+0001be80: 2029 0a0a 2020 2020 6465 6620 6c69 7374   )..    def list
+0001be90: 5f6d 6f64 656c 5f65 6e64 706f 696e 7473  _model_endpoints
+0001bea0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0001beb0: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
+0001bec0: 2073 7472 2c0a 2020 2020 2020 2020 6d6f   str,.        mo
+0001bed0: 6465 6c3a 204f 7074 696f 6e61 6c5b 7374  del: Optional[st
+0001bee0: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
+0001bef0: 2020 2066 756e 6374 696f 6e3a 204f 7074     function: Opt
+0001bf00: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0001bf10: 652c 0a20 2020 2020 2020 206c 6162 656c  e,.        label
+0001bf20: 733a 204c 6973 745b 7374 725d 203d 204e  s: List[str] = N
+0001bf30: 6f6e 652c 0a20 2020 2020 2020 2073 7461  one,.        sta
+0001bf40: 7274 3a20 7374 7220 3d20 226e 6f77 2d31  rt: str = "now-1
+0001bf50: 6822 2c0a 2020 2020 2020 2020 656e 643a  h",.        end:
+0001bf60: 2073 7472 203d 2022 6e6f 7722 2c0a 2020   str = "now",.  
+0001bf70: 2020 2020 2020 6d65 7472 6963 733a 204f        metrics: O
+0001bf80: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
+0001bf90: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
+0001bfa0: 2020 2074 6f70 5f6c 6576 656c 3a20 626f     top_level: bo
+0001bfb0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+0001bfc0: 2020 2020 7569 6473 3a20 4f70 7469 6f6e      uids: Option
+0001bfd0: 616c 5b4c 6973 745b 7374 725d 5d20 3d20  al[List[str]] = 
+0001bfe0: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 204c  None,.    ) -> L
+0001bff0: 6973 745b 6d6c 7275 6e2e 6d6f 6465 6c5f  ist[mlrun.model_
+0001c000: 6d6f 6e69 746f 7269 6e67 2e6d 6f64 656c  monitoring.model
+0001c010: 5f65 6e64 706f 696e 742e 4d6f 6465 6c45  _endpoint.ModelE
+0001c020: 6e64 706f 696e 745d 3a0a 2020 2020 2020  ndpoint]:.      
+0001c030: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+0001c040: 7475 726e 7320 6120 6c69 7374 206f 6620  turns a list of 
+0001c050: 604d 6f64 656c 456e 6470 6f69 6e74 6020  `ModelEndpoint` 
+0001c060: 6f62 6a65 6374 732e 2045 6163 6820 604d  objects. Each `M
+0001c070: 6f64 656c 456e 6470 6f69 6e74 6020 6f62  odelEndpoint` ob
+0001c080: 6a65 6374 2072 6570 7265 7365 6e74 7320  ject represents 
+0001c090: 7468 6520 6375 7272 656e 7420 7374 6174  the current stat
+0001c0a0: 6520 6f66 2061 0a20 2020 2020 2020 206d  e of a.        m
+0001c0b0: 6f64 656c 2065 6e64 706f 696e 742e 2054  odel endpoint. T
+0001c0c0: 6869 7320 6675 6e63 7469 6f6e 7320 7375  his functions su
+0001c0d0: 7070 6f72 7473 2066 696c 7465 7269 6e67  pports filtering
+0001c0e0: 2062 7920 7468 6520 666f 6c6c 6f77 696e   by the followin
+0001c0f0: 6720 7061 7261 6d65 7465 7273 3a0a 2020  g parameters:.  
+0001c100: 2020 2020 2020 3129 206d 6f64 656c 0a20        1) model. 
+0001c110: 2020 2020 2020 2032 2920 6675 6e63 7469         2) functi
+0001c120: 6f6e 0a20 2020 2020 2020 2033 2920 6c61  on.        3) la
+0001c130: 6265 6c73 0a20 2020 2020 2020 2034 2920  bels.        4) 
+0001c140: 746f 7020 6c65 7665 6c0a 2020 2020 2020  top level.      
+0001c150: 2020 3529 2075 6964 730a 2020 2020 2020    5) uids.      
+0001c160: 2020 4279 2064 6566 6175 6c74 2c20 7768    By default, wh
+0001c170: 656e 206e 6f20 6669 6c74 6572 7320 6172  en no filters ar
+0001c180: 6520 6170 706c 6965 642c 2061 6c6c 2061  e applied, all a
+0001c190: 7661 696c 6162 6c65 2065 6e64 706f 696e  vailable endpoin
+0001c1a0: 7473 2066 6f72 2074 6865 2067 6976 656e  ts for the given
+0001c1b0: 2070 726f 6a65 6374 2077 696c 6c20 6265   project will be
+0001c1c0: 206c 6973 7465 642e 0a0a 2020 2020 2020   listed...      
+0001c1d0: 2020 496e 2061 6464 6974 696f 6e2c 2074    In addition, t
+0001c1e0: 6869 7320 6675 6e63 7469 6f6e 7320 7072  his functions pr
+0001c1f0: 6f76 6964 6573 2061 2066 6163 6164 6520  ovides a facade 
+0001c200: 666f 7220 6c69 7374 696e 6720 656e 6470  for listing endp
+0001c210: 6f69 6e74 2072 656c 6174 6564 206d 6574  oint related met
+0001c220: 7269 6373 2e20 5468 6973 2066 6163 6164  rics. This facad
+0001c230: 6520 6973 2074 696d 652d 6261 7365 640a  e is time-based.
+0001c240: 2020 2020 2020 2020 616e 6420 6465 7065          and depe
+0001c250: 6e64 7320 6f6e 2074 6865 2027 7374 6172  nds on the 'star
+0001c260: 7427 2061 6e64 2027 656e 6427 2070 6172  t' and 'end' par
+0001c270: 616d 6574 6572 732e 2042 7920 6465 6661  ameters. By defa
+0001c280: 756c 742c 2077 6865 6e20 7468 6520 6d65  ult, when the me
+0001c290: 7472 6963 7320 7061 7261 6d65 7465 7220  trics parameter 
+0001c2a0: 6973 204e 6f6e 652c 206e 6f20 6d65 7472  is None, no metr
+0001c2b0: 6963 7320 6172 650a 2020 2020 2020 2020  ics are.        
+0001c2c0: 6164 6465 6420 746f 2074 6865 206f 7574  added to the out
+0001c2d0: 7075 7420 6f66 2074 6869 7320 6675 6e63  put of this func
+0001c2e0: 7469 6f6e 2e0a 0a20 2020 2020 2020 203a  tion...        :
+0001c2f0: 7061 7261 6d20 7072 6f6a 6563 743a 2054  param project: T
+0001c300: 6865 206e 616d 6520 6f66 2074 6865 2070  he name of the p
+0001c310: 726f 6a65 6374 0a20 2020 2020 2020 203a  roject.        :
+0001c320: 7061 7261 6d20 6d6f 6465 6c3a 2054 6865  param model: The
+0001c330: 206e 616d 6520 6f66 2074 6865 206d 6f64   name of the mod
+0001c340: 656c 2074 6f20 6669 6c74 6572 2062 790a  el to filter by.
+0001c350: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+0001c360: 756e 6374 696f 6e3a 2054 6865 206e 616d  unction: The nam
+0001c370: 6520 6f66 2074 6865 2066 756e 6374 696f  e of the functio
+0001c380: 6e20 746f 2066 696c 7465 7220 6279 0a20  n to filter by. 
+0001c390: 2020 2020 2020 203a 7061 7261 6d20 6c61         :param la
+0001c3a0: 6265 6c73 3a20 4120 6c69 7374 206f 6620  bels: A list of 
+0001c3b0: 6c61 6265 6c73 2074 6f20 6669 6c74 6572  labels to filter
+0001c3c0: 2062 792e 204c 6162 656c 2066 696c 7465   by. Label filte
+0001c3d0: 7273 2077 6f72 6b20 6279 2065 6974 6865  rs work by eithe
+0001c3e0: 7220 6669 6c74 6572 696e 6720 6120 7370  r filtering a sp
+0001c3f0: 6563 6966 6963 2076 616c 7565 206f 6620  ecific value of 
+0001c400: 610a 2020 2020 2020 2020 206c 6162 656c  a.         label
+0001c410: 2028 692e 652e 206c 6973 7428 226b 6579   (i.e. list("key
+0001c420: 3d76 616c 7565 2229 2920 6f72 2062 7920  =value")) or by 
+0001c430: 6c6f 6f6b 696e 6720 666f 7220 7468 6520  looking for the 
+0001c440: 6578 6973 7465 6e63 6520 6f66 2061 2067  existence of a g
+0001c450: 6976 656e 206b 6579 2028 692e 652e 2022  iven key (i.e. "
+0001c460: 6b65 7922 290a 2020 2020 2020 2020 3a70  key").        :p
+0001c470: 6172 616d 206d 6574 7269 6373 3a20 4120  aram metrics: A 
+0001c480: 6c69 7374 206f 6620 6d65 7472 6963 7320  list of metrics 
+0001c490: 746f 2072 6574 7572 6e20 666f 7220 6561  to return for ea
+0001c4a0: 6368 2065 6e64 706f 696e 742c 2072 6561  ch endpoint, rea
+0001c4b0: 6420 6d6f 7265 2069 6e20 2754 696d 654d  d more in 'TimeM
+0001c4c0: 6574 7269 6327 0a20 2020 2020 2020 203a  etric'.        :
+0001c4d0: 7061 7261 6d20 7374 6172 743a 2054 6865  param start: The
+0001c4e0: 2073 7461 7274 2074 696d 6520 6f66 2074   start time of t
+0001c4f0: 6865 206d 6574 7269 6373 2e20 4361 6e20  he metrics. Can 
+0001c500: 6265 2072 6570 7265 7365 6e74 6564 2062  be represented b
+0001c510: 7920 6120 7374 7269 6e67 2063 6f6e 7461  y a string conta
+0001c520: 696e 696e 6720 616e 2052 4643 2033 3333  ining an RFC 333
+0001c530: 390a 2020 2020 2020 2020 2020 2020 2020  9.              
+0001c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c550: 2020 2074 696d 652c 2061 2055 6e69 7820     time, a Unix 
+0001c560: 7469 6d65 7374 616d 7020 696e 206d 696c  timestamp in mil
+0001c570: 6c69 7365 636f 6e64 732c 2061 2072 656c  liseconds, a rel
+0001c580: 6174 6976 6520 7469 6d65 2028 6027 6e6f  ative time (`'no
+0001c590: 7727 6020 6f72 0a20 2020 2020 2020 2020  w'` or.         
+0001c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5b0: 2020 2020 2020 2020 6027 6e6f 772d 5b30          `'now-[0
+0001c5c0: 2d39 5d2b 5b6d 6864 5d27 602c 2077 6865  -9]+[mhd]'`, whe
+0001c5d0: 7265 2060 6d60 203d 206d 696e 7574 6573  re `m` = minutes
+0001c5e0: 2c20 6068 6020 3d20 686f 7572 732c 2061  , `h` = hours, a
+0001c5f0: 6e64 2060 2764 2760 203d 0a20 2020 2020  nd `'d'` =.     
+0001c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c610: 2020 2020 2020 2020 2020 2020 6461 7973              days
+0001c620: 292c 206f 7220 3020 666f 7220 7468 6520  ), or 0 for the 
+0001c630: 6561 726c 6965 7374 2074 696d 652e 0a20  earliest time.. 
+0001c640: 2020 2020 2020 203a 7061 7261 6d20 656e         :param en
+0001c650: 643a 2054 6865 2065 6e64 2074 696d 6520  d: The end time 
+0001c660: 6f66 2074 6865 206d 6574 7269 6373 2e20  of the metrics. 
+0001c670: 4361 6e20 6265 2072 6570 7265 7365 6e74  Can be represent
+0001c680: 6564 2062 7920 6120 7374 7269 6e67 2063  ed by a string c
+0001c690: 6f6e 7461 696e 696e 6720 616e 2052 4643  ontaining an RFC
+0001c6a0: 2033 3333 390a 2020 2020 2020 2020 2020   3339.          
+0001c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6c0: 2020 2020 2020 2074 696d 652c 2061 2055         time, a U
+0001c6d0: 6e69 7820 7469 6d65 7374 616d 7020 696e  nix timestamp in
+0001c6e0: 206d 696c 6c69 7365 636f 6e64 732c 2061   milliseconds, a
+0001c6f0: 2072 656c 6174 6976 6520 7469 6d65 2028   relative time (
+0001c700: 6027 6e6f 7727 6020 6f72 0a20 2020 2020  `'now'` or.     
+0001c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c720: 2020 2020 2020 2020 2020 2020 6027 6e6f              `'no
+0001c730: 772d 5b30 2d39 5d2b 5b6d 6864 5d27 602c  w-[0-9]+[mhd]'`,
+0001c740: 2077 6865 7265 2060 6d60 203d 206d 696e   where `m` = min
+0001c750: 7574 6573 2c20 6068 6020 3d20 686f 7572  utes, `h` = hour
+0001c760: 732c 2061 6e64 2060 2764 2760 203d 0a20  s, and `'d'` =. 
+0001c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c790: 6461 7973 292c 206f 7220 3020 666f 7220  days), or 0 for 
+0001c7a0: 7468 6520 6561 726c 6965 7374 2074 696d  the earliest tim
+0001c7b0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0001c7c0: 6d20 746f 705f 6c65 7665 6c3a 2069 6620  m top_level: if 
+0001c7d0: 7472 7565 2077 696c 6c20 7265 7475 726e  true will return
+0001c7e0: 206f 6e6c 7920 726f 7574 6572 7320 616e   only routers an
+0001c7f0: 6420 656e 6470 6f69 6e74 2074 6861 7420  d endpoint that 
+0001c800: 6172 6520 4e4f 5420 6368 696c 6472 656e  are NOT children
+0001c810: 206f 6620 616e 7920 726f 7574 6572 0a20   of any router. 
+0001c820: 2020 2020 2020 203a 7061 7261 6d20 7569         :param ui
+0001c830: 6473 3a20 6966 2070 6173 7365 6420 7769  ds: if passed wi
+0001c840: 6c6c 2072 6574 7572 6e20 6120 6c69 7374  ll return a list
+0001c850: 2060 4d6f 6465 6c45 6e64 706f 696e 7460   `ModelEndpoint`
+0001c860: 206f 626a 6563 7420 7769 7468 2075 6964   object with uid
+0001c870: 2069 6e20 7569 6473 0a20 2020 2020 2020   in uids.       
+0001c880: 2022 2222 0a0a 2020 2020 2020 2020 7061   """..        pa
+0001c890: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+0001c8a0: 7b70 726f 6a65 6374 7d2f 6d6f 6465 6c2d  {project}/model-
+0001c8b0: 656e 6470 6f69 6e74 7322 0a0a 2020 2020  endpoints"..    
+0001c8c0: 2020 2020 6966 206c 6162 656c 7320 616e      if labels an
+0001c8d0: 6420 6973 696e 7374 616e 6365 286c 6162  d isinstance(lab
+0001c8e0: 656c 732c 2064 6963 7429 3a0a 2020 2020  els, dict):.    
+0001c8f0: 2020 2020 2020 2020 6c61 6265 6c73 203d          labels =
+0001c900: 205b 6622 7b6b 6579 7d3d 7b76 616c 7565   [f"{key}={value
+0001c910: 7d22 2066 6f72 206b 6579 2c20 7661 6c75  }" for key, valu
+0001c920: 6520 696e 206c 6162 656c 732e 6974 656d  e in labels.item
+0001c930: 7328 295d 0a0a 2020 2020 2020 2020 7265  s()]..        re
+0001c940: 7370 6f6e 7365 203d 2073 656c 662e 6170  sponse = self.ap
+0001c950: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
+0001c960: 2020 2020 6d65 7468 6f64 3d22 4745 5422      method="GET"
+0001c970: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+0001c980: 7468 3d70 6174 682c 0a20 2020 2020 2020  th=path,.       
+0001c990: 2020 2020 2070 6172 616d 733d 7b0a 2020       params={.  
+0001c9a0: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+0001c9b0: 6f64 656c 223a 206d 6f64 656c 2c0a 2020  odel": model,.  
+0001c9c0: 2020 2020 2020 2020 2020 2020 2020 2266                "f
+0001c9d0: 756e 6374 696f 6e22 3a20 6675 6e63 7469  unction": functi
+0001c9e0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0001c9f0: 2020 2020 226c 6162 656c 223a 206c 6162      "label": lab
+0001ca00: 656c 7320 6f72 205b 5d2c 0a20 2020 2020  els or [],.     
+0001ca10: 2020 2020 2020 2020 2020 2022 7374 6172             "star
+0001ca20: 7422 3a20 7374 6172 742c 0a20 2020 2020  t": start,.     
+0001ca30: 2020 2020 2020 2020 2020 2022 656e 6422             "end"
+0001ca40: 3a20 656e 642c 0a20 2020 2020 2020 2020  : end,.         
+0001ca50: 2020 2020 2020 2022 6d65 7472 6963 223a         "metric":
+0001ca60: 206d 6574 7269 6373 206f 7220 5b5d 2c0a   metrics or [],.
+0001ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca80: 2274 6f70 2d6c 6576 656c 223a 2074 6f70  "top-level": top
+0001ca90: 5f6c 6576 656c 2c0a 2020 2020 2020 2020  _level,.        
+0001caa0: 2020 2020 2020 2020 2275 6964 223a 2075          "uid": u
+0001cab0: 6964 732c 0a20 2020 2020 2020 2020 2020  ids,.           
+0001cac0: 207d 2c0a 2020 2020 2020 2020 290a 0a20   },.        ).. 
+0001cad0: 2020 2020 2020 2023 2047 656e 6572 6174         # Generat
+0001cae0: 6520 6120 6c69 7374 206f 6620 6120 6d6f  e a list of a mo
+0001caf0: 6465 6c20 656e 6470 6f69 6e74 2064 6963  del endpoint dic
+0001cb00: 7469 6f6e 6172 6965 730a 2020 2020 2020  tionaries.      
+0001cb10: 2020 6d6f 6465 6c5f 656e 6470 6f69 6e74    model_endpoint
+0001cb20: 7320 3d20 7265 7370 6f6e 7365 2e6a 736f  s = response.jso
+0001cb30: 6e28 295b 2265 6e64 706f 696e 7473 225d  n()["endpoints"]
+0001cb40: 0a20 2020 2020 2020 2069 6620 6d6f 6465  .        if mode
+0001cb50: 6c5f 656e 6470 6f69 6e74 733a 0a20 2020  l_endpoints:.   
+0001cb60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001cb70: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0001cb80: 2020 6d6c 7275 6e2e 6d6f 6465 6c5f 6d6f    mlrun.model_mo
+0001cb90: 6e69 746f 7269 6e67 2e6d 6f64 656c 5f65  nitoring.model_e
+0001cba0: 6e64 706f 696e 742e 4d6f 6465 6c45 6e64  ndpoint.ModelEnd
+0001cbb0: 706f 696e 742e 6672 6f6d 5f64 6963 7428  point.from_dict(
+0001cbc0: 6f62 6a29 0a20 2020 2020 2020 2020 2020  obj).           
+0001cbd0: 2020 2020 2066 6f72 206f 626a 2069 6e20       for obj in 
+0001cbe0: 6d6f 6465 6c5f 656e 6470 6f69 6e74 730a  model_endpoints.
+0001cbf0: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+0001cc00: 2020 2020 2020 7265 7475 726e 205b 5d0a        return [].
+0001cc10: 0a20 2020 2064 6566 2067 6574 5f6d 6f64  .    def get_mod
+0001cc20: 656c 5f65 6e64 706f 696e 7428 0a20 2020  el_endpoint(.   
+0001cc30: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0001cc40: 2020 2070 726f 6a65 6374 3a20 7374 722c     project: str,
+0001cc50: 0a20 2020 2020 2020 2065 6e64 706f 696e  .        endpoin
+0001cc60: 745f 6964 3a20 7374 722c 0a20 2020 2020  t_id: str,.     
+0001cc70: 2020 2073 7461 7274 3a20 4f70 7469 6f6e     start: Option
+0001cc80: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+0001cc90: 2020 2020 2020 2020 656e 643a 204f 7074          end: Opt
+0001cca0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0001ccb0: 652c 0a20 2020 2020 2020 206d 6574 7269  e,.        metri
+0001ccc0: 6373 3a20 4f70 7469 6f6e 616c 5b4c 6973  cs: Optional[Lis
+0001ccd0: 745b 7374 725d 5d20 3d20 4e6f 6e65 2c0a  t[str]] = None,.
+0001cce0: 2020 2020 2020 2020 6665 6174 7572 655f          feature_
+0001ccf0: 616e 616c 7973 6973 3a20 626f 6f6c 203d  analysis: bool =
+0001cd00: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
+0001cd10: 206d 6c72 756e 2e6d 6f64 656c 5f6d 6f6e   mlrun.model_mon
+0001cd20: 6974 6f72 696e 672e 6d6f 6465 6c5f 656e  itoring.model_en
+0001cd30: 6470 6f69 6e74 2e4d 6f64 656c 456e 6470  dpoint.ModelEndp
+0001cd40: 6f69 6e74 3a0a 2020 2020 2020 2020 2222  oint:.        ""
+0001cd50: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
+0001cd60: 7320 6120 7369 6e67 6c65 2060 4d6f 6465  s a single `Mode
+0001cd70: 6c45 6e64 706f 696e 7460 206f 626a 6563  lEndpoint` objec
+0001cd80: 7420 7769 7468 2061 6464 6974 696f 6e61  t with additiona
+0001cd90: 6c20 6d65 7472 6963 7320 616e 6420 6665  l metrics and fe
+0001cda0: 6174 7572 6520 7265 6c61 7465 6420 6461  ature related da
+0001cdb0: 7461 2e0a 0a20 2020 2020 2020 203a 7061  ta...        :pa
+0001cdc0: 7261 6d20 7072 6f6a 6563 743a 2020 2020  ram project:    
 0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cde0: 2020 2020 2020 3020 666f 7220 7468 6520        0 for the 
-0001cdf0: 6561 726c 6965 7374 2074 696d 652e 0a20  earliest time.. 
-0001ce00: 2020 2020 2020 203a 7061 7261 6d20 656e         :param en
-0001ce10: 643a 2020 2020 2020 2020 2020 2020 2020  d:              
-0001ce20: 2020 2020 2020 2020 2020 5468 6520 656e            The en
-0001ce30: 6420 7469 6d65 206f 6620 7468 6520 6d65  d time of the me
-0001ce40: 7472 6963 732e 2043 616e 2062 6520 7265  trics. Can be re
-0001ce50: 7072 6573 656e 7465 6420 6279 2061 2073  presented by a s
-0001ce60: 7472 696e 6720 636f 6e74 6169 6e69 6e67  tring containing
-0001ce70: 2061 6e0a 2020 2020 2020 2020 2020 2020   an.            
-0001ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce90: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-0001cea0: 4643 2033 3333 3920 7469 6d65 2c20 6120  FC 3339 time, a 
-0001ceb0: 556e 6978 2074 696d 6573 7461 6d70 2069  Unix timestamp i
-0001cec0: 6e20 6d69 6c6c 6973 6563 6f6e 6473 2c20  n milliseconds, 
-0001ced0: 6120 7265 6c61 7469 7665 2074 696d 6520  a relative time 
-0001cee0: 2860 276e 6f77 2760 206f 720a 2020 2020  (`'now'` or.    
-0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf10: 2020 2020 2020 2060 276e 6f77 2d5b 302d         `'now-[0-
-0001cf20: 395d 2b5b 6d68 645d 2760 2c20 7768 6572  9]+[mhd]'`, wher
-0001cf30: 6520 606d 6020 3d20 6d69 6e75 7465 732c  e `m` = minutes,
-0001cf40: 2060 6860 203d 2068 6f75 7273 2c20 616e   `h` = hours, an
-0001cf50: 6420 6027 6427 6020 3d20 6461 7973 292c  d `'d'` = days),
-0001cf60: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-0001cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf80: 2020 2020 2020 2020 2020 2020 2020 2030                 0
-0001cf90: 2066 6f72 2074 6865 2065 6172 6c69 6573   for the earlies
-0001cfa0: 7420 7469 6d65 2e0a 2020 2020 2020 2020  t time..        
-0001cfb0: 3a70 6172 616d 206d 6574 7269 6373 3a20  :param metrics: 
+0001cde0: 5468 6520 6e61 6d65 206f 6620 7468 6520  The name of the 
+0001cdf0: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+0001ce00: 3a70 6172 616d 2065 6e64 706f 696e 745f  :param endpoint_
+0001ce10: 6964 3a20 2020 2020 2020 2020 2020 2020  id:             
+0001ce20: 2020 2054 6865 2075 6e69 7175 6520 6964     The unique id
+0001ce30: 206f 6620 7468 6520 6d6f 6465 6c20 656e   of the model en
+0001ce40: 6470 6f69 6e74 2e0a 2020 2020 2020 2020  dpoint..        
+0001ce50: 3a70 6172 616d 2073 7461 7274 3a20 2020  :param start:   
+0001ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce70: 2020 2054 6865 2073 7461 7274 2074 696d     The start tim
+0001ce80: 6520 6f66 2074 6865 206d 6574 7269 6373  e of the metrics
+0001ce90: 2e20 4361 6e20 6265 2072 6570 7265 7365  . Can be represe
+0001cea0: 6e74 6564 2062 7920 6120 7374 7269 6e67  nted by a string
+0001ceb0: 2063 6f6e 7461 696e 696e 6720 616e 0a20   containing an. 
+0001cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cee0: 2020 2020 2020 2020 2020 5246 4320 3333            RFC 33
+0001cef0: 3339 2074 696d 652c 2061 2055 6e69 7820  39 time, a Unix 
+0001cf00: 7469 6d65 7374 616d 7020 696e 206d 696c  timestamp in mil
+0001cf10: 6c69 7365 636f 6e64 732c 2061 2072 656c  liseconds, a rel
+0001cf20: 6174 6976 6520 7469 6d65 2028 6027 6e6f  ative time (`'no
+0001cf30: 7727 6020 6f72 0a20 2020 2020 2020 2020  w'` or.         
+0001cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf60: 2020 6027 6e6f 772d 5b30 2d39 5d2b 5b6d    `'now-[0-9]+[m
+0001cf70: 6864 5d27 602c 2077 6865 7265 2060 6d60  hd]'`, where `m`
+0001cf80: 203d 206d 696e 7574 6573 2c20 6068 6020   = minutes, `h` 
+0001cf90: 3d20 686f 7572 732c 2061 6e64 2060 2764  = hours, and `'d
+0001cfa0: 2760 203d 2064 6179 7329 2c20 6f72 0a20  '` = days), or. 
+0001cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfd0: 2020 2041 206c 6973 7420 6f66 206d 6574     A list of met
-0001cfe0: 7269 6373 2074 6f20 7265 7475 726e 2066  rics to return f
-0001cff0: 6f72 2074 6865 206d 6f64 656c 2065 6e64  or the model end
-0001d000: 706f 696e 742e 2054 6865 7265 2061 7265  point. There are
-0001d010: 2070 7265 2d64 6566 696e 6564 0a20 2020   pre-defined.   
-0001d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d040: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
-0001d050: 666f 7220 6d6f 6465 6c20 656e 6470 6f69  for model endpoi
-0001d060: 6e74 7320 7375 6368 2061 7320 7072 6564  nts such as pred
-0001d070: 6963 7469 6f6e 735f 7065 725f 7365 636f  ictions_per_seco
-0001d080: 6e64 2061 6e64 0a20 2020 2020 2020 2020  nd and.         
-0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0b0: 2020 6c61 7465 6e63 795f 6176 675f 356d    latency_avg_5m
-0001d0c0: 2062 7574 2061 6c73 6f20 6375 7374 6f6d   but also custom
-0001d0d0: 206d 6574 7269 6373 2064 6566 696e 6564   metrics defined
-0001d0e0: 2062 7920 7468 6520 7573 6572 2e20 506c   by the user. Pl
-0001d0f0: 6561 7365 206e 6f74 6520 7468 6174 0a20  ease note that. 
-0001d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d120: 2020 2020 2020 2020 2020 7468 6573 6520            these 
-0001d130: 6d65 7472 6963 7320 6172 6520 7374 6f72  metrics are stor
-0001d140: 6564 2069 6e20 7468 6520 7469 6d65 2073  ed in the time s
-0001d150: 6572 6965 7320 4442 2061 6e64 2074 6865  eries DB and the
-0001d160: 2072 6573 756c 7473 2077 696c 6c20 6265   results will be
-0001d170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d190: 2020 2020 2020 2020 2020 2020 6170 7065              appe
-0001d1a0: 6172 6564 2075 6e64 6572 206d 6f64 656c  ared under model
-0001d1b0: 5f65 6e64 706f 696e 742e 7370 6563 2e6d  _endpoint.spec.m
-0001d1c0: 6574 7269 6373 2e0a 2020 2020 2020 2020  etrics..        
-0001d1d0: 3a70 6172 616d 2066 6561 7475 7265 5f61  :param feature_a
-0001d1e0: 6e61 6c79 7369 733a 2020 2020 2020 2020  nalysis:        
-0001d1f0: 2020 2057 6865 6e20 5472 7565 2c20 7468     When True, th
-0001d200: 6520 6261 7365 2066 6561 7475 7265 2073  e base feature s
-0001d210: 7461 7469 7374 6963 7320 616e 6420 6375  tatistics and cu
-0001d220: 7272 656e 7420 6665 6174 7572 6520 7374  rrent feature st
-0001d230: 6174 6973 7469 6373 2077 696c 6c0a 2020  atistics will.  
-0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d260: 2020 2020 2020 2020 2062 6520 6164 6465           be adde
-0001d270: 6420 746f 2074 6865 206f 7574 7075 7420  d to the output 
-0001d280: 6f66 2074 6865 2072 6573 756c 7469 6e67  of the resulting
-0001d290: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
-0001d2a0: 2020 3a72 6574 7572 6e3a 2041 2060 4d6f    :return: A `Mo
-0001d2b0: 6465 6c45 6e64 706f 696e 7460 206f 626a  delEndpoint` obj
-0001d2c0: 6563 742e 0a20 2020 2020 2020 2022 2222  ect..        """
-0001d2d0: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
-0001d2e0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-0001d2f0: 6a65 6374 7d2f 6d6f 6465 6c2d 656e 6470  ject}/model-endp
-0001d300: 6f69 6e74 732f 7b65 6e64 706f 696e 745f  oints/{endpoint_
-0001d310: 6964 7d22 0a20 2020 2020 2020 2072 6573  id}".        res
-0001d320: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
-0001d330: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-0001d340: 2020 206d 6574 686f 643d 2247 4554 222c     method="GET",
-0001d350: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0001d360: 683d 7061 7468 2c0a 2020 2020 2020 2020  h=path,.        
-0001d370: 2020 2020 7061 7261 6d73 3d7b 0a20 2020      params={.   
-0001d380: 2020 2020 2020 2020 2020 2020 2022 7374               "st
-0001d390: 6172 7422 3a20 7374 6172 742c 0a20 2020  art": start,.   
-0001d3a0: 2020 2020 2020 2020 2020 2020 2022 656e               "en
-0001d3b0: 6422 3a20 656e 642c 0a20 2020 2020 2020  d": end,.       
-0001d3c0: 2020 2020 2020 2020 2022 6d65 7472 6963           "metric
-0001d3d0: 223a 206d 6574 7269 6373 206f 7220 5b5d  ": metrics or []
-0001d3e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d3f0: 2020 2266 6561 7475 7265 5f61 6e61 6c79    "feature_analy
-0001d400: 7369 7322 3a20 6665 6174 7572 655f 616e  sis": feature_an
-0001d410: 616c 7973 6973 2c0a 2020 2020 2020 2020  alysis,.        
-0001d420: 2020 2020 7d2c 0a20 2020 2020 2020 2029      },.        )
-0001d430: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001d440: 206d 6c72 756e 2e6d 6f64 656c 5f6d 6f6e   mlrun.model_mon
-0001d450: 6974 6f72 696e 672e 6d6f 6465 6c5f 656e  itoring.model_en
-0001d460: 6470 6f69 6e74 2e4d 6f64 656c 456e 6470  dpoint.ModelEndp
-0001d470: 6f69 6e74 2e66 726f 6d5f 6469 6374 280a  oint.from_dict(.
-0001d480: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-0001d490: 6f6e 7365 2e6a 736f 6e28 290a 2020 2020  onse.json().    
-0001d4a0: 2020 2020 290a 0a20 2020 2064 6566 2070      )..    def p
-0001d4b0: 6174 6368 5f6d 6f64 656c 5f65 6e64 706f  atch_model_endpo
-0001d4c0: 696e 7428 0a20 2020 2020 2020 2073 656c  int(.        sel
-0001d4d0: 662c 0a20 2020 2020 2020 2070 726f 6a65  f,.        proje
-0001d4e0: 6374 3a20 7374 722c 0a20 2020 2020 2020  ct: str,.       
-0001d4f0: 2065 6e64 706f 696e 745f 6964 3a20 7374   endpoint_id: st
-0001d500: 722c 0a20 2020 2020 2020 2061 7474 7269  r,.        attri
-0001d510: 6275 7465 733a 2064 6963 742c 0a20 2020  butes: dict,.   
-0001d520: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
-0001d530: 2020 2020 2020 2020 5570 6461 7465 7320          Updates 
-0001d540: 6d6f 6465 6c20 656e 6470 6f69 6e74 2077  model endpoint w
-0001d550: 6974 6820 7072 6f76 6964 6564 2061 7474  ith provided att
-0001d560: 7269 6275 7465 732e 0a0a 2020 2020 2020  ributes...      
-0001d570: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
-0001d580: 3a20 5468 6520 6e61 6d65 206f 6620 7468  : The name of th
-0001d590: 6520 7072 6f6a 6563 742e 0a20 2020 2020  e project..     
-0001d5a0: 2020 203a 7061 7261 6d20 656e 6470 6f69     :param endpoi
-0001d5b0: 6e74 5f69 643a 2054 6865 2069 6420 6f66  nt_id: The id of
-0001d5c0: 2074 6865 2065 6e64 706f 696e 742e 0a20   the endpoint.. 
-0001d5d0: 2020 2020 2020 203a 7061 7261 6d20 6174         :param at
-0001d5e0: 7472 6962 7574 6573 3a20 4469 6374 696f  tributes: Dictio
-0001d5f0: 6e61 7279 206f 6620 6174 7472 6962 7574  nary of attribut
-0001d600: 6573 2074 6861 7420 7769 6c6c 2062 6520  es that will be 
-0001d610: 7573 6564 2066 6f72 2075 7064 6174 6520  used for update 
-0001d620: 7468 6520 6d6f 6465 6c20 656e 6470 6f69  the model endpoi
-0001d630: 6e74 2e20 5468 6520 6b65 7973 0a20 2020  nt. The keys.   
-0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d650: 2020 2020 2020 2020 6f66 2074 6869 7320          of this 
-0001d660: 6469 6374 696f 6e61 7279 2073 686f 756c  dictionary shoul
-0001d670: 6420 6578 6973 7420 696e 2074 6865 2074  d exist in the t
-0001d680: 6172 6765 7420 7461 626c 652e 204e 6f74  arget table. Not
-0001d690: 6520 7468 6174 2074 6865 2076 616c 7565  e that the value
-0001d6a0: 7320 7368 6f75 6c64 2062 650a 2020 2020  s should be.    
-0001d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6c0: 2020 2020 2020 2066 726f 6d20 7479 7065         from type
-0001d6d0: 2073 7472 696e 6720 6f72 2066 726f 6d20   string or from 
-0001d6e0: 6120 7661 6c69 6420 6e75 6d65 7269 6361  a valid numerica
-0001d6f0: 6c20 7479 7065 2073 7563 6820 6173 2069  l type such as i
-0001d700: 6e74 206f 7220 666c 6f61 742e 0a20 2020  nt or float..   
-0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d720: 2020 2020 2020 2020 204d 6f72 6520 6465           More de
-0001d730: 7461 696c 7320 6162 6f75 7420 7468 6520  tails about the 
-0001d740: 6d6f 6465 6c20 656e 6470 6f69 6e74 2061  model endpoint a
-0001d750: 7661 696c 6162 6c65 2061 7474 7269 6275  vailable attribu
-0001d760: 7465 7320 6361 6e20 6265 2066 6f75 6e64  tes can be found
-0001d770: 2075 6e64 6572 0a20 2020 2020 2020 2020   under.         
-0001d780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d790: 2020 3a70 793a 636c 6173 733a 607e 6d6c    :py:class:`~ml
-0001d7a0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0001d7b0: 6173 2e4d 6f64 656c 456e 6470 6f69 6e74  as.ModelEndpoint
-0001d7c0: 602e 0a0a 2020 2020 2020 2020 2020 2020  `...            
-0001d7d0: 2020 2020 2020 2020 2020 2020 2020 2045                 E
-0001d7e0: 7861 6d70 6c65 3a3a 0a0a 2020 2020 2020  xample::..      
-0001d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d800: 2020 2020 2020 2020 2020 2320 4765 6e65            # Gene
-0001d810: 7261 7465 2063 7572 7265 6e74 2073 7461  rate current sta
-0001d820: 7473 2066 6f72 2074 776f 2066 6561 7475  ts for two featu
-0001d830: 7265 730a 2020 2020 2020 2020 2020 2020  res.            
-0001d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d850: 2020 2020 6375 7272 656e 745f 7374 6174      current_stat
-0001d860: 7320 3d20 7b27 7476 645f 7375 6d27 3a20  s = {'tvd_sum': 
-0001d870: 322e 322c 0a20 2020 2020 2020 2020 2020  2.2,.           
-0001d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8a0: 2020 2020 2020 2774 7664 5f6d 6561 6e27        'tvd_mean'
-0001d8b0: 3a20 302e 352c 0a20 2020 2020 2020 2020  : 0.5,.         
-0001d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8e0: 2020 2020 2020 2020 2768 656c 6c69 6e67          'helling
-0001d8f0: 6572 5f73 756d 273a 2033 2e36 2c0a 2020  er_sum': 3.6,.  
-0001d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d920: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001d930: 6865 6c6c 696e 6765 725f 6d65 616e 273a  hellinger_mean':
-0001d940: 2030 2e39 2c0a 2020 2020 2020 2020 2020   0.9,.          
-0001d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d970: 2020 2020 2020 2027 6b6c 645f 7375 6d27         'kld_sum'
-0001d980: 3a20 3234 2e32 2c0a 2020 2020 2020 2020  : 24.2,.        
-0001d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9b0: 2020 2020 2020 2020 2027 6b6c 645f 6d65           'kld_me
-0001d9c0: 616e 273a 2036 2e30 2c0a 2020 2020 2020  an': 6.0,.      
-0001d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfd0: 2020 2020 2020 2020 2020 3020 666f 7220            0 for 
+0001cfe0: 7468 6520 6561 726c 6965 7374 2074 696d  the earliest tim
+0001cff0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0001d000: 6d20 656e 643a 2020 2020 2020 2020 2020  m end:          
+0001d010: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+0001d020: 6520 656e 6420 7469 6d65 206f 6620 7468  e end time of th
+0001d030: 6520 6d65 7472 6963 732e 2043 616e 2062  e metrics. Can b
+0001d040: 6520 7265 7072 6573 656e 7465 6420 6279  e represented by
+0001d050: 2061 2073 7472 696e 6720 636f 6e74 6169   a string contai
+0001d060: 6e69 6e67 2061 6e0a 2020 2020 2020 2020  ning an.        
+0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d090: 2020 2052 4643 2033 3333 3920 7469 6d65     RFC 3339 time
+0001d0a0: 2c20 6120 556e 6978 2074 696d 6573 7461  , a Unix timesta
+0001d0b0: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
+0001d0c0: 6473 2c20 6120 7265 6c61 7469 7665 2074  ds, a relative t
+0001d0d0: 696d 6520 2860 276e 6f77 2760 206f 720a  ime (`'now'` or.
+0001d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d100: 2020 2020 2020 2020 2020 2060 276e 6f77             `'now
+0001d110: 2d5b 302d 395d 2b5b 6d68 645d 2760 2c20  -[0-9]+[mhd]'`, 
+0001d120: 7768 6572 6520 606d 6020 3d20 6d69 6e75  where `m` = minu
+0001d130: 7465 732c 2060 6860 203d 2068 6f75 7273  tes, `h` = hours
+0001d140: 2c20 616e 6420 6027 6427 6020 3d20 6461  , and `'d'` = da
+0001d150: 7973 292c 206f 720a 2020 2020 2020 2020  ys), or.        
+0001d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d180: 2020 2030 2066 6f72 2074 6865 2065 6172     0 for the ear
+0001d190: 6c69 6573 7420 7469 6d65 2e0a 2020 2020  liest time..    
+0001d1a0: 2020 2020 3a70 6172 616d 206d 6574 7269      :param metri
+0001d1b0: 6373 3a20 2020 2020 2020 2020 2020 2020  cs:             
+0001d1c0: 2020 2020 2020 2041 206c 6973 7420 6f66         A list of
+0001d1d0: 206d 6574 7269 6373 2074 6f20 7265 7475   metrics to retu
+0001d1e0: 726e 2066 6f72 2074 6865 206d 6f64 656c  rn for the model
+0001d1f0: 2065 6e64 706f 696e 742e 2054 6865 7265   endpoint. There
+0001d200: 2061 7265 2070 7265 2d64 6566 696e 6564   are pre-defined
+0001d210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d230: 2020 2020 2020 2020 2020 2020 6d65 7472              metr
+0001d240: 6963 7320 666f 7220 6d6f 6465 6c20 656e  ics for model en
+0001d250: 6470 6f69 6e74 7320 7375 6368 2061 7320  dpoints such as 
+0001d260: 7072 6564 6963 7469 6f6e 735f 7065 725f  predictions_per_
+0001d270: 7365 636f 6e64 2061 6e64 0a20 2020 2020  second and.     
+0001d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2a0: 2020 2020 2020 6c61 7465 6e63 795f 6176        latency_av
+0001d2b0: 675f 356d 2062 7574 2061 6c73 6f20 6375  g_5m but also cu
+0001d2c0: 7374 6f6d 206d 6574 7269 6373 2064 6566  stom metrics def
+0001d2d0: 696e 6564 2062 7920 7468 6520 7573 6572  ined by the user
+0001d2e0: 2e20 506c 6561 7365 206e 6f74 6520 7468  . Please note th
+0001d2f0: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
+0001d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d310: 2020 2020 2020 2020 2020 2020 2020 7468                th
+0001d320: 6573 6520 6d65 7472 6963 7320 6172 6520  ese metrics are 
+0001d330: 7374 6f72 6564 2069 6e20 7468 6520 7469  stored in the ti
+0001d340: 6d65 2073 6572 6965 7320 4442 2061 6e64  me series DB and
+0001d350: 2074 6865 2072 6573 756c 7473 2077 696c   the results wil
+0001d360: 6c20 6265 0a20 2020 2020 2020 2020 2020  l be.           
+0001d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d390: 6170 7065 6172 6564 2075 6e64 6572 206d  appeared under m
+0001d3a0: 6f64 656c 5f65 6e64 706f 696e 742e 7370  odel_endpoint.sp
+0001d3b0: 6563 2e6d 6574 7269 6373 2e0a 2020 2020  ec.metrics..    
+0001d3c0: 2020 2020 3a70 6172 616d 2066 6561 7475      :param featu
+0001d3d0: 7265 5f61 6e61 6c79 7369 733a 2020 2020  re_analysis:    
+0001d3e0: 2020 2020 2020 2057 6865 6e20 5472 7565         When True
+0001d3f0: 2c20 7468 6520 6261 7365 2066 6561 7475  , the base featu
+0001d400: 7265 2073 7461 7469 7374 6963 7320 616e  re statistics an
+0001d410: 6420 6375 7272 656e 7420 6665 6174 7572  d current featur
+0001d420: 6520 7374 6174 6973 7469 6373 2077 696c  e statistics wil
+0001d430: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+0001d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d450: 2020 2020 2020 2020 2020 2020 2062 6520               be 
+0001d460: 6164 6465 6420 746f 2074 6865 206f 7574  added to the out
+0001d470: 7075 7420 6f66 2074 6865 2072 6573 756c  put of the resul
+0001d480: 7469 6e67 206f 626a 6563 742e 0a0a 2020  ting object...  
+0001d490: 2020 2020 2020 3a72 6574 7572 6e3a 2041        :return: A
+0001d4a0: 2060 4d6f 6465 6c45 6e64 706f 696e 7460   `ModelEndpoint`
+0001d4b0: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+0001d4c0: 2022 2222 0a0a 2020 2020 2020 2020 7061   """..        pa
+0001d4d0: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+0001d4e0: 7b70 726f 6a65 6374 7d2f 6d6f 6465 6c2d  {project}/model-
+0001d4f0: 656e 6470 6f69 6e74 732f 7b65 6e64 706f  endpoints/{endpo
+0001d500: 696e 745f 6964 7d22 0a20 2020 2020 2020  int_id}".       
+0001d510: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
+0001d520: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
+0001d530: 2020 2020 2020 206d 6574 686f 643d 2247         method="G
+0001d540: 4554 222c 0a20 2020 2020 2020 2020 2020  ET",.           
+0001d550: 2070 6174 683d 7061 7468 2c0a 2020 2020   path=path,.    
+0001d560: 2020 2020 2020 2020 7061 7261 6d73 3d7b          params={
+0001d570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d580: 2022 7374 6172 7422 3a20 7374 6172 742c   "start": start,
+0001d590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d5a0: 2022 656e 6422 3a20 656e 642c 0a20 2020   "end": end,.   
+0001d5b0: 2020 2020 2020 2020 2020 2020 2022 6d65               "me
+0001d5c0: 7472 6963 223a 206d 6574 7269 6373 206f  tric": metrics o
+0001d5d0: 7220 5b5d 2c0a 2020 2020 2020 2020 2020  r [],.          
+0001d5e0: 2020 2020 2020 2266 6561 7475 7265 5f61        "feature_a
+0001d5f0: 6e61 6c79 7369 7322 3a20 6665 6174 7572  nalysis": featur
+0001d600: 655f 616e 616c 7973 6973 2c0a 2020 2020  e_analysis,.    
+0001d610: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+0001d620: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
+0001d630: 7475 726e 206d 6c72 756e 2e6d 6f64 656c  turn mlrun.model
+0001d640: 5f6d 6f6e 6974 6f72 696e 672e 6d6f 6465  _monitoring.mode
+0001d650: 6c5f 656e 6470 6f69 6e74 2e4d 6f64 656c  l_endpoint.Model
+0001d660: 456e 6470 6f69 6e74 2e66 726f 6d5f 6469  Endpoint.from_di
+0001d670: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
+0001d680: 7265 7370 6f6e 7365 2e6a 736f 6e28 290a  response.json().
+0001d690: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+0001d6a0: 6566 2070 6174 6368 5f6d 6f64 656c 5f65  ef patch_model_e
+0001d6b0: 6e64 706f 696e 7428 0a20 2020 2020 2020  ndpoint(.       
+0001d6c0: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
+0001d6d0: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
+0001d6e0: 2020 2020 2065 6e64 706f 696e 745f 6964       endpoint_id
+0001d6f0: 3a20 7374 722c 0a20 2020 2020 2020 2061  : str,.        a
+0001d700: 7474 7269 6275 7465 733a 2064 6963 742c  ttributes: dict,
+0001d710: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0001d720: 2222 220a 2020 2020 2020 2020 5570 6461  """.        Upda
+0001d730: 7465 7320 6d6f 6465 6c20 656e 6470 6f69  tes model endpoi
+0001d740: 6e74 2077 6974 6820 7072 6f76 6964 6564  nt with provided
+0001d750: 2061 7474 7269 6275 7465 732e 0a0a 2020   attributes...  
+0001d760: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
+0001d770: 6a65 6374 3a20 5468 6520 6e61 6d65 206f  ject: The name o
+0001d780: 6620 7468 6520 7072 6f6a 6563 742e 0a20  f the project.. 
+0001d790: 2020 2020 2020 203a 7061 7261 6d20 656e         :param en
+0001d7a0: 6470 6f69 6e74 5f69 643a 2054 6865 2069  dpoint_id: The i
+0001d7b0: 6420 6f66 2074 6865 2065 6e64 706f 696e  d of the endpoin
+0001d7c0: 742e 0a20 2020 2020 2020 203a 7061 7261  t..        :para
+0001d7d0: 6d20 6174 7472 6962 7574 6573 3a20 4469  m attributes: Di
+0001d7e0: 6374 696f 6e61 7279 206f 6620 6174 7472  ctionary of attr
+0001d7f0: 6962 7574 6573 2074 6861 7420 7769 6c6c  ibutes that will
+0001d800: 2062 6520 7573 6564 2066 6f72 2075 7064   be used for upd
+0001d810: 6174 6520 7468 6520 6d6f 6465 6c20 656e  ate the model en
+0001d820: 6470 6f69 6e74 2e20 5468 6520 6b65 7973  dpoint. The keys
+0001d830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d840: 2020 2020 2020 2020 2020 2020 6f66 2074              of t
+0001d850: 6869 7320 6469 6374 696f 6e61 7279 2073  his dictionary s
+0001d860: 686f 756c 6420 6578 6973 7420 696e 2074  hould exist in t
+0001d870: 6865 2074 6172 6765 7420 7461 626c 652e  he target table.
+0001d880: 204e 6f74 6520 7468 6174 2074 6865 2076   Note that the v
+0001d890: 616c 7565 7320 7368 6f75 6c64 2062 650a  alues should be.
+0001d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8b0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+0001d8c0: 7479 7065 2073 7472 696e 6720 6f72 2066  type string or f
+0001d8d0: 726f 6d20 6120 7661 6c69 6420 6e75 6d65  rom a valid nume
+0001d8e0: 7269 6361 6c20 7479 7065 2073 7563 6820  rical type such 
+0001d8f0: 6173 2069 6e74 206f 7220 666c 6f61 742e  as int or float.
+0001d900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d910: 2020 2020 2020 2020 2020 2020 204d 6f72               Mor
+0001d920: 6520 6465 7461 696c 7320 6162 6f75 7420  e details about 
+0001d930: 7468 6520 6d6f 6465 6c20 656e 6470 6f69  the model endpoi
+0001d940: 6e74 2061 7661 696c 6162 6c65 2061 7474  nt available att
+0001d950: 7269 6275 7465 7320 6361 6e20 6265 2066  ributes can be f
+0001d960: 6f75 6e64 2075 6e64 6572 0a20 2020 2020  ound under.     
+0001d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d980: 2020 2020 2020 3a70 793a 636c 6173 733a        :py:class:
+0001d990: 607e 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  `~mlrun.common.s
+0001d9a0: 6368 656d 6173 2e4d 6f64 656c 456e 6470  chemas.ModelEndp
+0001d9b0: 6f69 6e74 602e 0a0a 2020 2020 2020 2020  oint`...        
+0001d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9d0: 2020 2045 7861 6d70 6c65 3a3a 0a0a 2020     Example::..  
 0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9f0: 2020 2020 2020 2020 2020 2027 6631 273a             'f1':
-0001da00: 207b 2774 7664 273a 2030 2e35 2c20 2768   {'tvd': 0.5, 'h
-0001da10: 656c 6c69 6e67 6572 273a 2031 2e30 2c20  ellinger': 1.0, 
-0001da20: 276b 6c64 273a 2036 2e34 7d2c 0a20 2020  'kld': 6.4},.   
+0001d9f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001da00: 4765 6e65 7261 7465 2063 7572 7265 6e74  Generate current
+0001da10: 2073 7461 7473 2066 6f72 2074 776f 2066   stats for two f
+0001da20: 6561 7475 7265 730a 2020 2020 2020 2020  eatures.        
 0001da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da50: 2020 2020 2020 2020 2020 2020 2020 2766                'f
-0001da60: 3227 3a20 7b27 7476 6427 3a20 302e 352c  2': {'tvd': 0.5,
-0001da70: 2027 6865 6c6c 696e 6765 7227 3a20 312e   'hellinger': 1.
-0001da80: 302c 2027 6b6c 6427 3a20 362e 357d 7d0a  0, 'kld': 6.5}}.
-0001da90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dab0: 2023 2043 7265 6174 6520 6174 7472 6962   # Create attrib
-0001dac0: 7574 6573 2064 6963 7469 6f6e 6172 7920  utes dictionary 
-0001dad0: 6163 636f 7264 696e 6720 746f 2074 6865  according to the
-0001dae0: 2072 6571 7569 7265 6420 666f 726d 6174   required format
-0001daf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001da40: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+0001da50: 7374 6174 7320 3d20 7b27 7476 645f 7375  stats = {'tvd_su
+0001da60: 6d27 3a20 322e 322c 0a20 2020 2020 2020  m': 2.2,.       
+0001da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da90: 2020 2020 2020 2020 2020 2774 7664 5f6d            'tvd_m
+0001daa0: 6561 6e27 3a20 302e 352c 0a20 2020 2020  ean': 0.5,.     
+0001dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dad0: 2020 2020 2020 2020 2020 2020 2768 656c              'hel
+0001dae0: 6c69 6e67 6572 5f73 756d 273a 2033 2e36  linger_sum': 3.6
+0001daf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0001db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db10: 2061 7474 7269 6275 7465 7320 3d20 7b60   attributes = {`
-0001db20: 6375 7272 656e 745f 7374 6174 7360 3a20  current_stats`: 
-0001db30: 6a73 6f6e 2e64 756d 7073 2863 7572 7265  json.dumps(curre
-0001db40: 6e74 5f73 7461 7473 292c 0a20 2020 2020  nt_stats),.     
+0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db20: 2020 2027 6865 6c6c 696e 6765 725f 6d65     'hellinger_me
+0001db30: 616e 273a 2030 2e39 2c0a 2020 2020 2020  an': 0.9,.      
+0001db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db70: 2020 2020 2020 2020 2060 6472 6966 745f           `drift_
-0001db80: 7374 6174 7573 603a 2022 4452 4946 545f  status`: "DRIFT_
-0001db90: 4445 5445 4354 4544 227d 0a0a 2020 2020  DETECTED"}..    
-0001dba0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0001dbb0: 2061 7474 7269 6275 7465 7320 3d20 7b22   attributes = {"
-0001dbc0: 6174 7472 6962 7574 6573 223a 205f 6173  attributes": _as
-0001dbd0: 5f6a 736f 6e28 6174 7472 6962 7574 6573  _json(attributes
-0001dbe0: 297d 0a20 2020 2020 2020 2070 6174 6820  )}.        path 
-0001dbf0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-0001dc00: 6f6a 6563 747d 2f6d 6f64 656c 2d65 6e64  oject}/model-end
-0001dc10: 706f 696e 7473 2f7b 656e 6470 6f69 6e74  points/{endpoint
-0001dc20: 5f69 647d 220a 2020 2020 2020 2020 7365  _id}".        se
-0001dc30: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-0001dc40: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-0001dc50: 2250 4154 4348 222c 0a20 2020 2020 2020  "PATCH",.       
-0001dc60: 2020 2020 2070 6174 683d 7061 7468 2c0a       path=path,.
-0001dc70: 2020 2020 2020 2020 2020 2020 7061 7261              para
-0001dc80: 6d73 3d61 7474 7269 6275 7465 732c 0a20  ms=attributes,. 
-0001dc90: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0001dca0: 6620 6372 6561 7465 5f68 7562 5f73 6f75  f create_hub_sou
-0001dcb0: 7263 6528 0a20 2020 2020 2020 2073 656c  rce(.        sel
-0001dcc0: 662c 2073 6f75 7263 653a 2055 6e69 6f6e  f, source: Union
-0001dcd0: 5b64 6963 742c 206d 6c72 756e 2e63 6f6d  [dict, mlrun.com
-0001dce0: 6d6f 6e2e 7363 6865 6d61 732e 496e 6465  mon.schemas.Inde
-0001dcf0: 7865 6448 7562 536f 7572 6365 5d0a 2020  xedHubSource].  
-0001dd00: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0001dd10: 0a20 2020 2020 2020 2041 6464 2061 206e  .        Add a n
-0001dd20: 6577 2068 7562 2073 6f75 7263 652e 0a0a  ew hub source...
-0001dd30: 2020 2020 2020 2020 4d4c 5275 6e20 6d61          MLRun ma
-0001dd40: 696e 7461 696e 7320 616e 206f 7264 6572  intains an order
-0001dd50: 6564 206c 6973 7420 6f66 2068 7562 2073  ed list of hub s
-0001dd60: 6f75 7263 6573 2028 e280 9c73 6f75 7263  ources (...sourc
-0001dd70: 6573 e280 9d29 2045 6163 6820 736f 7572  es...) Each sour
-0001dd80: 6365 2068 6173 0a20 2020 2020 2020 2069  ce has.        i
-0001dd90: 7473 2064 6574 6169 6c73 2072 6567 6973  ts details regis
-0001dda0: 7465 7265 6420 616e 6420 6974 7320 6f72  tered and its or
-0001ddb0: 6465 7220 7769 7468 696e 2074 6865 206c  der within the l
-0001ddc0: 6973 742e 2057 6865 6e20 6372 6561 7469  ist. When creati
-0001ddd0: 6e67 2061 206e 6577 2073 6f75 7263 652c  ng a new source,
-0001dde0: 2074 6865 2073 7065 6369 616c 206f 7264   the special ord
-0001ddf0: 6572 2060 602d 3160 600a 2020 2020 2020  er ``-1``.      
-0001de00: 2020 6361 6e20 6265 2075 7365 6420 746f    can be used to
-0001de10: 206d 6172 6b20 7468 6973 2073 6f75 7263   mark this sourc
-0001de20: 6520 6173 206c 6173 7420 696e 2074 6865  e as last in the
-0001de30: 206c 6973 742e 2048 6f77 6576 6572 2c20   list. However, 
-0001de40: 6f6e 6365 2074 6865 2073 6f75 7263 6520  once the source 
-0001de50: 6973 2069 6e20 7468 6520 4d4c 5275 6e20  is in the MLRun 
-0001de60: 6c69 7374 2c0a 2020 2020 2020 2020 6974  list,.        it
-0001de70: 7320 6f72 6465 7220 7769 6c6c 2061 6c77  s order will alw
-0001de80: 6179 7320 6265 2060 603e 3060 602e 0a0a  ays be ``>0``...
-0001de90: 2020 2020 2020 2020 5468 6520 676c 6f62          The glob
-0001dea0: 616c 2068 7562 2073 6f75 7263 6520 616c  al hub source al
-0001deb0: 7761 7973 2065 7869 7374 7320 696e 2074  ways exists in t
-0001dec0: 6865 206c 6973 742c 2061 6e64 2069 7320  he list, and is 
-0001ded0: 616c 7761 7973 2074 6865 206c 6173 7420  always the last 
-0001dee0: 736f 7572 6365 0a20 2020 2020 2020 2028  source.        (
-0001def0: 6060 6f72 6465 7220 3d20 2d31 6060 292e  ``order = -1``).
-0001df00: 2049 7420 6361 6e6e 6f74 2062 6520 6d6f   It cannot be mo
-0001df10: 6469 6669 6564 206e 6f72 2063 616e 2069  dified nor can i
-0001df20: 7420 6265 206d 6f76 6564 2074 6f20 616e  t be moved to an
-0001df30: 6f74 6865 7220 6f72 6465 7220 696e 2074  other order in t
-0001df40: 6865 206c 6973 742e 0a0a 2020 2020 2020  he list...      
-0001df50: 2020 5468 6520 736f 7572 6365 206f 626a    The source obj
-0001df60: 6563 7420 6d61 7920 636f 6e74 6169 6e20  ect may contain 
-0001df70: 6372 6564 656e 7469 616c 7320 7768 6963  credentials whic
-0001df80: 6820 6172 6520 6e65 6564 6564 2074 6f20  h are needed to 
-0001df90: 6163 6365 7373 2074 6865 2064 6174 6173  access the datas
-0001dfa0: 746f 7265 2077 6865 7265 2074 6865 2073  tore where the s
-0001dfb0: 6f75 7263 6520 6973 2073 746f 7265 642e  ource is stored.
-0001dfc0: 0a20 2020 2020 2020 2054 6865 7365 2063  .        These c
-0001dfd0: 7265 6465 6e74 6961 6c73 2061 7265 206e  redentials are n
-0001dfe0: 6f74 206b 6570 7420 696e 2074 6865 204d  ot kept in the M
-0001dff0: 4c52 756e 2044 422c 2062 7574 2061 7265  LRun DB, but are
-0001e000: 2073 746f 7265 6420 696e 7369 6465 2061   stored inside a
-0001e010: 206b 7562 6572 6e65 7465 7320 7365 6372   kubernetes secr
-0001e020: 6574 206f 626a 6563 7420 6d61 696e 7461  et object mainta
-0001e030: 696e 6564 2062 790a 2020 2020 2020 2020  ined by.        
-0001e040: 4d4c 5275 6e2e 2054 6865 7920 6172 6520  MLRun. They are 
-0001e050: 6e6f 7420 7265 7475 726e 6564 2074 6872  not returned thr
-0001e060: 6f75 6768 2061 6e79 2041 5049 2066 726f  ough any API fro
-0001e070: 6d20 4d4c 5275 6e2e 0a0a 2020 2020 2020  m MLRun...      
-0001e080: 2020 4578 616d 706c 653a 3a0a 0a20 2020    Example::..   
-0001e090: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
-0001e0a0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-0001e0b0: 656d 6173 0a0a 2020 2020 2020 2020 2020  emas..          
-0001e0c0: 2020 2320 4164 6420 6120 7072 6976 6174    # Add a privat
-0001e0d0: 6520 736f 7572 6365 2061 7320 7468 6520  e source as the 
-0001e0e0: 6c61 7374 206f 6e65 2028 7769 6c6c 2062  last one (will b
-0001e0f0: 6520 2331 2069 6e20 7468 6520 6c69 7374  e #1 in the list
-0001e100: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-0001e110: 6976 6174 655f 736f 7572 6365 203d 206d  ivate_source = m
-0001e120: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001e130: 6d61 732e 496e 6465 7865 6448 7562 6553  mas.IndexedHubeS
-0001e140: 6f75 7263 6528 0a20 2020 2020 2020 2020  ource(.         
-0001e150: 2020 2020 2020 206f 7264 6572 3d2d 312c         order=-1,
-0001e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e170: 2073 6f75 7263 653d 6d6c 7275 6e2e 636f   source=mlrun.co
-0001e180: 6d6d 6f6e 2e73 6368 656d 6173 2e48 7562  mmon.schemas.Hub
-0001e190: 536f 7572 6365 280a 2020 2020 2020 2020  Source(.        
-0001e1a0: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
-0001e1b0: 6461 7461 3d6d 6c72 756e 2e63 6f6d 6d6f  data=mlrun.commo
-0001e1c0: 6e2e 7363 6865 6d61 732e 4875 624f 626a  n.schemas.HubObj
-0001e1d0: 6563 744d 6574 6164 6174 6128 0a20 2020  ectMetadata(.   
-0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1f0: 2020 2020 206e 616d 653d 2270 7269 7622       name="priv"
-0001e200: 2c20 6465 7363 7269 7074 696f 6e3d 2261  , description="a
-0001e210: 2070 7269 7661 7465 2073 6f75 7263 6522   private source"
-0001e220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e230: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-0001e240: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-0001e250: 3d6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  =mlrun.common.sc
-0001e260: 6865 6d61 732e 4875 6253 6f75 7263 6553  hemas.HubSourceS
-0001e270: 7065 6328 7061 7468 3d22 2f6c 6f63 616c  pec(path="/local
-0001e280: 2f70 6174 682f 746f 2f73 6f75 7263 6522  /path/to/source"
-0001e290: 2c20 6368 616e 6e65 6c3d 2264 6576 656c  , channel="devel
-0001e2a0: 6f70 6d65 6e74 2229 0a20 2020 2020 2020  opment").       
-0001e2b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001e2c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001e2d0: 2020 2020 2064 622e 6372 6561 7465 5f68       db.create_h
-0001e2e0: 7562 5f73 6f75 7263 6528 7072 6976 6174  ub_source(privat
-0001e2f0: 655f 736f 7572 6365 290a 0a20 2020 2020  e_source)..     
-0001e300: 2020 2020 2020 2023 2041 6464 2061 6e6f         # Add ano
-0001e310: 7468 6572 2073 6f75 7263 6520 6173 2031  ther source as 1
-0001e320: 7374 2069 6e20 7468 6520 6c69 7374 202d  st in the list -
-0001e330: 2077 696c 6c20 7075 7368 2070 7265 7669   will push previ
-0001e340: 6f75 7320 6f6e 6520 746f 2062 6520 2332  ous one to be #2
-0001e350: 0a20 2020 2020 2020 2020 2020 2061 6e6f  .            ano
-0001e360: 7468 6572 5f73 6f75 7263 6520 3d20 6d6c  ther_source = ml
-0001e370: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0001e380: 6173 2e49 6e64 6578 6564 4875 6253 6f75  as.IndexedHubSou
-0001e390: 7263 6528 0a20 2020 2020 2020 2020 2020  rce(.           
-0001e3a0: 2020 2020 206f 7264 6572 3d31 2c0a 2020       order=1,.  
-0001e3b0: 2020 2020 2020 2020 2020 2020 2020 736f                so
-0001e3c0: 7572 6365 3d6d 6c72 756e 2e63 6f6d 6d6f  urce=mlrun.commo
-0001e3d0: 6e2e 7363 6865 6d61 732e 4875 6253 6f75  n.schemas.HubSou
-0001e3e0: 7263 6528 0a20 2020 2020 2020 2020 2020  rce(.           
-0001e3f0: 2020 2020 2020 2020 206d 6574 6164 6174           metadat
-0001e400: 613d 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  a=mlrun.common.s
-0001e410: 6368 656d 6173 2e48 7562 4f62 6a65 6374  chemas.HubObject
-0001e420: 4d65 7461 6461 7461 280a 2020 2020 2020  Metadata(.      
+0001db60: 2020 2020 2020 2020 2020 2027 6b6c 645f             'kld_
+0001db70: 7375 6d27 3a20 3234 2e32 2c0a 2020 2020  sum': 24.2,.    
+0001db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dba0: 2020 2020 2020 2020 2020 2020 2027 6b6c               'kl
+0001dbb0: 645f 6d65 616e 273a 2036 2e30 2c0a 2020  d_mean': 6.0,.  
+0001dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbe0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001dbf0: 6631 273a 207b 2774 7664 273a 2030 2e35  f1': {'tvd': 0.5
+0001dc00: 2c20 2768 656c 6c69 6e67 6572 273a 2031  , 'hellinger': 1
+0001dc10: 2e30 2c20 276b 6c64 273a 2036 2e34 7d2c  .0, 'kld': 6.4},
+0001dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc50: 2020 2766 3227 3a20 7b27 7476 6427 3a20    'f2': {'tvd': 
+0001dc60: 302e 352c 2027 6865 6c6c 696e 6765 7227  0.5, 'hellinger'
+0001dc70: 3a20 312e 302c 2027 6b6c 6427 3a20 362e  : 1.0, 'kld': 6.
+0001dc80: 357d 7d0a 0a20 2020 2020 2020 2020 2020  5}}..           
+0001dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dca0: 2020 2020 2023 2043 7265 6174 6520 6174       # Create at
+0001dcb0: 7472 6962 7574 6573 2064 6963 7469 6f6e  tributes diction
+0001dcc0: 6172 7920 6163 636f 7264 696e 6720 746f  ary according to
+0001dcd0: 2074 6865 2072 6571 7569 7265 6420 666f   the required fo
+0001dce0: 726d 6174 0a20 2020 2020 2020 2020 2020  rmat.           
+0001dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd00: 2020 2020 2061 7474 7269 6275 7465 7320       attributes 
+0001dd10: 3d20 7b60 6375 7272 656e 745f 7374 6174  = {`current_stat
+0001dd20: 7360 3a20 6a73 6f6e 2e64 756d 7073 2863  s`: json.dumps(c
+0001dd30: 7572 7265 6e74 5f73 7461 7473 292c 0a20  urrent_stats),. 
+0001dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd60: 2020 2020 2020 2020 2020 2020 2060 6472               `dr
+0001dd70: 6966 745f 7374 6174 7573 603a 2022 4452  ift_status`: "DR
+0001dd80: 4946 545f 4445 5445 4354 4544 227d 0a0a  IFT_DETECTED"}..
+0001dd90: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0001dda0: 2020 2020 2061 7474 7269 6275 7465 7320       attributes 
+0001ddb0: 3d20 7b22 6174 7472 6962 7574 6573 223a  = {"attributes":
+0001ddc0: 205f 6173 5f6a 736f 6e28 6174 7472 6962   _as_json(attrib
+0001ddd0: 7574 6573 297d 0a20 2020 2020 2020 2070  utes)}.        p
+0001dde0: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
+0001ddf0: 2f7b 7072 6f6a 6563 747d 2f6d 6f64 656c  /{project}/model
+0001de00: 2d65 6e64 706f 696e 7473 2f7b 656e 6470  -endpoints/{endp
+0001de10: 6f69 6e74 5f69 647d 220a 2020 2020 2020  oint_id}".      
+0001de20: 2020 7365 6c66 2e61 7069 5f63 616c 6c28    self.api_call(
+0001de30: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+0001de40: 686f 643d 2250 4154 4348 222c 0a20 2020  hod="PATCH",.   
+0001de50: 2020 2020 2020 2020 2070 6174 683d 7061           path=pa
+0001de60: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0001de70: 7061 7261 6d73 3d61 7474 7269 6275 7465  params=attribute
+0001de80: 732c 0a20 2020 2020 2020 2029 0a0a 2020  s,.        )..  
+0001de90: 2020 6465 6620 6372 6561 7465 5f68 7562    def create_hub
+0001dea0: 5f73 6f75 7263 6528 0a20 2020 2020 2020  _source(.       
+0001deb0: 2073 656c 662c 2073 6f75 7263 653a 2055   self, source: U
+0001dec0: 6e69 6f6e 5b64 6963 742c 206d 6c72 756e  nion[dict, mlrun
+0001ded0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0001dee0: 496e 6465 7865 6448 7562 536f 7572 6365  IndexedHubSource
+0001def0: 5d0a 2020 2020 293a 0a20 2020 2020 2020  ].    ):.       
+0001df00: 2022 2222 0a20 2020 2020 2020 2041 6464   """.        Add
+0001df10: 2061 206e 6577 2068 7562 2073 6f75 7263   a new hub sourc
+0001df20: 652e 0a0a 2020 2020 2020 2020 4d4c 5275  e...        MLRu
+0001df30: 6e20 6d61 696e 7461 696e 7320 616e 206f  n maintains an o
+0001df40: 7264 6572 6564 206c 6973 7420 6f66 2068  rdered list of h
+0001df50: 7562 2073 6f75 7263 6573 2028 e280 9c73  ub sources (...s
+0001df60: 6f75 7263 6573 e280 9d29 2045 6163 6820  ources...) Each 
+0001df70: 736f 7572 6365 2068 6173 0a20 2020 2020  source has.     
+0001df80: 2020 2069 7473 2064 6574 6169 6c73 2072     its details r
+0001df90: 6567 6973 7465 7265 6420 616e 6420 6974  egistered and it
+0001dfa0: 7320 6f72 6465 7220 7769 7468 696e 2074  s order within t
+0001dfb0: 6865 206c 6973 742e 2057 6865 6e20 6372  he list. When cr
+0001dfc0: 6561 7469 6e67 2061 206e 6577 2073 6f75  eating a new sou
+0001dfd0: 7263 652c 2074 6865 2073 7065 6369 616c  rce, the special
+0001dfe0: 206f 7264 6572 2060 602d 3160 600a 2020   order ``-1``.  
+0001dff0: 2020 2020 2020 6361 6e20 6265 2075 7365        can be use
+0001e000: 6420 746f 206d 6172 6b20 7468 6973 2073  d to mark this s
+0001e010: 6f75 7263 6520 6173 206c 6173 7420 696e  ource as last in
+0001e020: 2074 6865 206c 6973 742e 2048 6f77 6576   the list. Howev
+0001e030: 6572 2c20 6f6e 6365 2074 6865 2073 6f75  er, once the sou
+0001e040: 7263 6520 6973 2069 6e20 7468 6520 4d4c  rce is in the ML
+0001e050: 5275 6e20 6c69 7374 2c0a 2020 2020 2020  Run list,.      
+0001e060: 2020 6974 7320 6f72 6465 7220 7769 6c6c    its order will
+0001e070: 2061 6c77 6179 7320 6265 2060 603e 3060   always be ``>0`
+0001e080: 602e 0a0a 2020 2020 2020 2020 5468 6520  `...        The 
+0001e090: 676c 6f62 616c 2068 7562 2073 6f75 7263  global hub sourc
+0001e0a0: 6520 616c 7761 7973 2065 7869 7374 7320  e always exists 
+0001e0b0: 696e 2074 6865 206c 6973 742c 2061 6e64  in the list, and
+0001e0c0: 2069 7320 616c 7761 7973 2074 6865 206c   is always the l
+0001e0d0: 6173 7420 736f 7572 6365 0a20 2020 2020  ast source.     
+0001e0e0: 2020 2028 6060 6f72 6465 7220 3d20 2d31     (``order = -1
+0001e0f0: 6060 292e 2049 7420 6361 6e6e 6f74 2062  ``). It cannot b
+0001e100: 6520 6d6f 6469 6669 6564 206e 6f72 2063  e modified nor c
+0001e110: 616e 2069 7420 6265 206d 6f76 6564 2074  an it be moved t
+0001e120: 6f20 616e 6f74 6865 7220 6f72 6465 7220  o another order 
+0001e130: 696e 2074 6865 206c 6973 742e 0a0a 2020  in the list...  
+0001e140: 2020 2020 2020 5468 6520 736f 7572 6365        The source
+0001e150: 206f 626a 6563 7420 6d61 7920 636f 6e74   object may cont
+0001e160: 6169 6e20 6372 6564 656e 7469 616c 7320  ain credentials 
+0001e170: 7768 6963 6820 6172 6520 6e65 6564 6564  which are needed
+0001e180: 2074 6f20 6163 6365 7373 2074 6865 2064   to access the d
+0001e190: 6174 6173 746f 7265 2077 6865 7265 2074  atastore where t
+0001e1a0: 6865 2073 6f75 7263 6520 6973 2073 746f  he source is sto
+0001e1b0: 7265 642e 0a20 2020 2020 2020 2054 6865  red..        The
+0001e1c0: 7365 2063 7265 6465 6e74 6961 6c73 2061  se credentials a
+0001e1d0: 7265 206e 6f74 206b 6570 7420 696e 2074  re not kept in t
+0001e1e0: 6865 204d 4c52 756e 2044 422c 2062 7574  he MLRun DB, but
+0001e1f0: 2061 7265 2073 746f 7265 6420 696e 7369   are stored insi
+0001e200: 6465 2061 206b 7562 6572 6e65 7465 7320  de a kubernetes 
+0001e210: 7365 6372 6574 206f 626a 6563 7420 6d61  secret object ma
+0001e220: 696e 7461 696e 6564 2062 790a 2020 2020  intained by.    
+0001e230: 2020 2020 4d4c 5275 6e2e 2054 6865 7920      MLRun. They 
+0001e240: 6172 6520 6e6f 7420 7265 7475 726e 6564  are not returned
+0001e250: 2074 6872 6f75 6768 2061 6e79 2041 5049   through any API
+0001e260: 2066 726f 6d20 4d4c 5275 6e2e 0a0a 2020   from MLRun...  
+0001e270: 2020 2020 2020 4578 616d 706c 653a 3a0a        Example::.
+0001e280: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
+0001e290: 6f72 7420 6d6c 7275 6e2e 636f 6d6d 6f6e  ort mlrun.common
+0001e2a0: 2e73 6368 656d 6173 0a0a 2020 2020 2020  .schemas..      
+0001e2b0: 2020 2020 2020 2320 4164 6420 6120 7072        # Add a pr
+0001e2c0: 6976 6174 6520 736f 7572 6365 2061 7320  ivate source as 
+0001e2d0: 7468 6520 6c61 7374 206f 6e65 2028 7769  the last one (wi
+0001e2e0: 6c6c 2062 6520 2331 2069 6e20 7468 6520  ll be #1 in the 
+0001e2f0: 6c69 7374 290a 2020 2020 2020 2020 2020  list).          
+0001e300: 2020 7072 6976 6174 655f 736f 7572 6365    private_source
+0001e310: 203d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e   = mlrun.common.
+0001e320: 7363 6865 6d61 732e 496e 6465 7865 6448  schemas.IndexedH
+0001e330: 7562 6553 6f75 7263 6528 0a20 2020 2020  ubeSource(.     
+0001e340: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0001e350: 3d2d 312c 0a20 2020 2020 2020 2020 2020  =-1,.           
+0001e360: 2020 2020 2073 6f75 7263 653d 6d6c 7275       source=mlru
+0001e370: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0001e380: 2e48 7562 536f 7572 6365 280a 2020 2020  .HubSource(.    
+0001e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3a0: 6d65 7461 6461 7461 3d6d 6c72 756e 2e63  metadata=mlrun.c
+0001e3b0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4875  ommon.schemas.Hu
+0001e3c0: 624f 626a 6563 744d 6574 6164 6174 6128  bObjectMetadata(
+0001e3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e3e0: 2020 2020 2020 2020 206e 616d 653d 2270           name="p
+0001e3f0: 7269 7622 2c20 6465 7363 7269 7074 696f  riv", descriptio
+0001e400: 6e3d 2261 2070 7269 7661 7465 2073 6f75  n="a private sou
+0001e410: 7263 6522 0a20 2020 2020 2020 2020 2020  rce".           
+0001e420: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
 0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e440: 2020 6e61 6d65 3d22 7072 6976 2d32 222c    name="priv-2",
-0001e450: 2064 6573 6372 6970 7469 6f6e 3d22 616e   description="an
-0001e460: 6f74 6865 7220 736f 7572 6365 220a 2020  other source".  
-0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e480: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
-0001e490: 2020 2020 2020 2020 2073 7065 633d 6d6c           spec=ml
-0001e4a0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0001e4b0: 6173 2e48 7562 536f 7572 6365 5370 6563  as.HubSourceSpec
-0001e4c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001e4d0: 2020 2020 2020 2020 2020 7061 7468 3d22            path="
-0001e4e0: 2f6c 6f63 616c 2f70 6174 682f 746f 2f73  /local/path/to/s
-0001e4f0: 6f75 7263 652f 3222 2c0a 2020 2020 2020  ource/2",.      
-0001e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e510: 2020 6368 616e 6e65 6c3d 2264 6576 656c    channel="devel
-0001e520: 6f70 6d65 6e74 222c 0a20 2020 2020 2020  opment",.       
-0001e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e540: 2063 7265 6465 6e74 6961 6c73 3d7b 2e2e   credentials={..
-0001e550: 2e7d 0a20 2020 2020 2020 2020 2020 2020  .}.             
-0001e560: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001e570: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001e580: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001e590: 2020 2020 2064 622e 6372 6561 7465 5f68       db.create_h
-0001e5a0: 7562 5f73 6f75 7263 6528 616e 6f74 6865  ub_source(anothe
-0001e5b0: 725f 736f 7572 6365 290a 0a20 2020 2020  r_source)..     
-0001e5c0: 2020 203a 7061 7261 6d20 736f 7572 6365     :param source
-0001e5d0: 3a20 5468 6520 736f 7572 6365 2061 6e64  : The source and
-0001e5e0: 2069 7473 206f 7264 6572 2c20 6f66 2074   its order, of t
-0001e5f0: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
-0001e600: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
-0001e610: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-0001e620: 2e68 7562 2e49 6e64 6578 6564 4875 6253  .hub.IndexedHubS
-0001e630: 6f75 7263 6560 2c20 6f72 2069 6e20 6469  ource`, or in di
-0001e640: 6374 696f 6e61 7279 2066 6f72 6d2e 0a20  ctionary form.. 
-0001e650: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
-0001e660: 2054 6865 2073 6f75 7263 6520 6f62 6a65   The source obje
-0001e670: 6374 2061 7320 696e 7365 7274 6564 2069  ct as inserted i
-0001e680: 6e74 6f20 7468 6520 6461 7461 6261 7365  nto the database
-0001e690: 2c20 7769 7468 2063 7265 6465 6e74 6961  , with credentia
-0001e6a0: 6c73 2073 7472 6970 7065 642e 0a20 2020  ls stripped..   
-0001e6b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001e6c0: 2070 6174 6820 3d20 2268 7562 2f73 6f75   path = "hub/sou
-0001e6d0: 7263 6573 220a 2020 2020 2020 2020 6966  rces".        if
-0001e6e0: 2069 7369 6e73 7461 6e63 6528 736f 7572   isinstance(sour
-0001e6f0: 6365 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  ce, mlrun.common
-0001e700: 2e73 6368 656d 6173 2e49 6e64 6578 6564  .schemas.Indexed
-0001e710: 4875 6253 6f75 7263 6529 3a0a 2020 2020  HubSource):.    
-0001e720: 2020 2020 2020 2020 736f 7572 6365 203d          source =
-0001e730: 2073 6f75 7263 652e 6469 6374 2829 0a20   source.dict(). 
-0001e740: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-0001e750: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-0001e760: 6d65 7468 6f64 3d22 504f 5354 222c 2070  method="POST", p
-0001e770: 6174 683d 7061 7468 2c20 6a73 6f6e 3d73  ath=path, json=s
-0001e780: 6f75 7263 6529 0a20 2020 2020 2020 2072  ource).        r
-0001e790: 6574 7572 6e20 6d6c 7275 6e2e 636f 6d6d  eturn mlrun.comm
-0001e7a0: 6f6e 2e73 6368 656d 6173 2e49 6e64 6578  on.schemas.Index
-0001e7b0: 6564 4875 6253 6f75 7263 6528 2a2a 7265  edHubSource(**re
-0001e7c0: 7370 6f6e 7365 2e6a 736f 6e28 2929 0a0a  sponse.json())..
-0001e7d0: 2020 2020 6465 6620 7374 6f72 655f 6875      def store_hu
-0001e7e0: 625f 736f 7572 6365 280a 2020 2020 2020  b_source(.      
-0001e7f0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0001e800: 736f 7572 6365 5f6e 616d 653a 2073 7472  source_name: str
-0001e810: 2c0a 2020 2020 2020 2020 736f 7572 6365  ,.        source
-0001e820: 3a20 556e 696f 6e5b 6469 6374 2c20 6d6c  : Union[dict, ml
-0001e830: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0001e840: 6173 2e49 6e64 6578 6564 4875 6253 6f75  as.IndexedHubSou
-0001e850: 7263 655d 2c0a 2020 2020 293a 0a20 2020  rce],.    ):.   
-0001e860: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001e870: 2043 7265 6174 6520 6f72 2072 6570 6c61   Create or repla
-0001e880: 6365 2061 2068 7562 2073 6f75 7263 652e  ce a hub source.
-0001e890: 0a20 2020 2020 2020 2046 6f72 2061 6e20  .        For an 
-0001e8a0: 6578 616d 706c 6520 6f66 2074 6865 2073  example of the s
-0001e8b0: 6f75 7263 6520 666f 726d 6174 2061 6e64  ource format and
-0001e8c0: 2065 7870 6c61 6e61 7469 6f6e 206f 6620   explanation of 
-0001e8d0: 7468 6520 736f 7572 6365 206f 7264 6572  the source order
-0001e8e0: 206c 6f67 6963 2c0a 2020 2020 2020 2020   logic,.        
-0001e8f0: 706c 6561 7365 2073 6565 203a 7079 3a66  please see :py:f
-0001e900: 756e 633a 607e 6372 6561 7465 5f68 7562  unc:`~create_hub
-0001e910: 5f73 6f75 7263 6560 2e20 5468 6973 206d  _source`. This m
-0001e920: 6574 686f 6420 6361 6e20 6265 2075 7365  ethod can be use
-0001e930: 6420 746f 206d 6f64 6966 7920 7468 6520  d to modify the 
-0001e940: 736f 7572 6365 2069 7473 656c 6620 6f72  source itself or
-0001e950: 2069 7473 0a20 2020 2020 2020 206f 7264   its.        ord
-0001e960: 6572 2069 6e20 7468 6520 6c69 7374 206f  er in the list o
-0001e970: 6620 736f 7572 6365 732e 0a0a 2020 2020  f sources...    
-0001e980: 2020 2020 3a70 6172 616d 2073 6f75 7263      :param sourc
-0001e990: 655f 6e61 6d65 3a20 4e61 6d65 206f 6620  e_name: Name of 
-0001e9a0: 7468 6520 736f 7572 6365 206f 626a 6563  the source objec
-0001e9b0: 7420 746f 206d 6f64 6966 792f 6372 6561  t to modify/crea
-0001e9c0: 7465 2e20 4974 206d 7573 7420 6d61 7463  te. It must matc
-0001e9d0: 6820 7468 6520 6060 736f 7572 6365 2e6d  h the ``source.m
-0001e9e0: 6574 6164 6174 612e 6e61 6d65 6060 0a20  etadata.name``. 
-0001e9f0: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0001ea00: 6574 6572 2069 6e20 7468 6520 736f 7572  eter in the sour
-0001ea10: 6365 2069 7473 656c 662e 0a20 2020 2020  ce itself..     
-0001ea20: 2020 203a 7061 7261 6d20 736f 7572 6365     :param source
-0001ea30: 3a20 536f 7572 6365 206f 626a 6563 7420  : Source object 
-0001ea40: 746f 2073 746f 7265 2069 6e20 7468 6520  to store in the 
-0001ea50: 6461 7461 6261 7365 2e0a 2020 2020 2020  database..      
-0001ea60: 2020 3a72 6574 7572 6e73 3a20 5468 6520    :returns: The 
-0001ea70: 736f 7572 6365 206f 626a 6563 7420 6173  source object as
-0001ea80: 2073 746f 7265 6420 696e 2074 6865 2044   stored in the D
-0001ea90: 422e 0a20 2020 2020 2020 2022 2222 0a20  B..        """. 
-0001eaa0: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-0001eab0: 6875 622f 736f 7572 6365 732f 7b73 6f75  hub/sources/{sou
-0001eac0: 7263 655f 6e61 6d65 7d22 0a20 2020 2020  rce_name}".     
-0001ead0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0001eae0: 2873 6f75 7263 652c 206d 6c72 756e 2e63  (source, mlrun.c
-0001eaf0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 496e  ommon.schemas.In
-0001eb00: 6465 7865 6448 7562 536f 7572 6365 293a  dexedHubSource):
-0001eb10: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
-0001eb20: 7263 6520 3d20 736f 7572 6365 2e64 6963  rce = source.dic
-0001eb30: 7428 290a 0a20 2020 2020 2020 2072 6573  t()..        res
-0001eb40: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
-0001eb50: 5f63 616c 6c28 6d65 7468 6f64 3d22 5055  _call(method="PU
-0001eb60: 5422 2c20 7061 7468 3d70 6174 682c 206a  T", path=path, j
-0001eb70: 736f 6e3d 736f 7572 6365 290a 2020 2020  son=source).    
-0001eb80: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
-0001eb90: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0001eba0: 496e 6465 7865 6448 7562 536f 7572 6365  IndexedHubSource
-0001ebb0: 282a 2a72 6573 706f 6e73 652e 6a73 6f6e  (**response.json
-0001ebc0: 2829 290a 0a20 2020 2064 6566 206c 6973  ())..    def lis
-0001ebd0: 745f 6875 625f 736f 7572 6365 7328 7365  t_hub_sources(se
-0001ebe0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0001ebf0: 0a20 2020 2020 2020 204c 6973 7420 6875  .        List hu
-0001ec00: 6220 736f 7572 6365 7320 696e 2074 6865  b sources in the
-0001ec10: 204d 4c52 756e 2044 422e 0a20 2020 2020   MLRun DB..     
-0001ec20: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-0001ec30: 6174 6820 3d20 2268 7562 2f73 6f75 7263  ath = "hub/sourc
-0001ec40: 6573 220a 2020 2020 2020 2020 7265 7370  es".        resp
-0001ec50: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
-0001ec60: 6361 6c6c 286d 6574 686f 643d 2247 4554  call(method="GET
-0001ec70: 222c 2070 6174 683d 7061 7468 292e 6a73  ", path=path).js
-0001ec80: 6f6e 2829 0a20 2020 2020 2020 2072 6573  on().        res
-0001ec90: 756c 7473 203d 205b 5d0a 2020 2020 2020  ults = [].      
-0001eca0: 2020 666f 7220 6974 656d 2069 6e20 7265    for item in re
-0001ecb0: 7370 6f6e 7365 3a0a 2020 2020 2020 2020  sponse:.        
-0001ecc0: 2020 2020 7265 7375 6c74 732e 6170 7065      results.appe
-0001ecd0: 6e64 286d 6c72 756e 2e63 6f6d 6d6f 6e2e  nd(mlrun.common.
-0001ece0: 7363 6865 6d61 732e 496e 6465 7865 6448  schemas.IndexedH
-0001ecf0: 7562 536f 7572 6365 282a 2a69 7465 6d29  ubSource(**item)
-0001ed00: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001ed10: 2072 6573 756c 7473 0a0a 2020 2020 6465   results..    de
-0001ed20: 6620 6765 745f 6875 625f 736f 7572 6365  f get_hub_source
-0001ed30: 2873 656c 662c 2073 6f75 7263 655f 6e61  (self, source_na
-0001ed40: 6d65 3a20 7374 7229 3a0a 2020 2020 2020  me: str):.      
-0001ed50: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0001ed60: 7472 6965 7665 2061 2068 7562 2073 6f75  trieve a hub sou
-0001ed70: 7263 6520 6672 6f6d 2074 6865 2044 422e  rce from the DB.
-0001ed80: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001ed90: 2073 6f75 7263 655f 6e61 6d65 3a20 4e61   source_name: Na
-0001eda0: 6d65 206f 6620 7468 6520 6875 6220 736f  me of the hub so
-0001edb0: 7572 6365 2074 6f20 7265 7472 6965 7665  urce to retrieve
-0001edc0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0001edd0: 2020 2020 2020 7061 7468 203d 2066 2268        path = f"h
-0001ede0: 7562 2f73 6f75 7263 6573 2f7b 736f 7572  ub/sources/{sour
-0001edf0: 6365 5f6e 616d 657d 220a 2020 2020 2020  ce_name}".      
-0001ee00: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
-0001ee10: 662e 6170 695f 6361 6c6c 286d 6574 686f  f.api_call(metho
-0001ee20: 643d 2247 4554 222c 2070 6174 683d 7061  d="GET", path=pa
-0001ee30: 7468 290a 2020 2020 2020 2020 7265 7475  th).        retu
-0001ee40: 726e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  rn mlrun.common.
-0001ee50: 7363 6865 6d61 732e 496e 6465 7865 6448  schemas.IndexedH
-0001ee60: 7562 536f 7572 6365 282a 2a72 6573 706f  ubSource(**respo
-0001ee70: 6e73 652e 6a73 6f6e 2829 290a 0a20 2020  nse.json())..   
-0001ee80: 2064 6566 2064 656c 6574 655f 6875 625f   def delete_hub_
-0001ee90: 736f 7572 6365 2873 656c 662c 2073 6f75  source(self, sou
-0001eea0: 7263 655f 6e61 6d65 3a20 7374 7229 3a0a  rce_name: str):.
-0001eeb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001eec0: 2020 2020 4465 6c65 7465 2061 2068 7562      Delete a hub
-0001eed0: 2073 6f75 7263 6520 6672 6f6d 2074 6865   source from the
-0001eee0: 2044 422e 0a20 2020 2020 2020 2054 6865   DB..        The
-0001eef0: 2073 6f75 7263 6520 7769 6c6c 2062 6520   source will be 
-0001ef00: 6465 6c65 7465 6420 6672 6f6d 2074 6865  deleted from the
-0001ef10: 206c 6973 742c 2061 6e64 2061 6e79 2066   list, and any f
-0001ef20: 6f6c 6c6f 7769 6e67 2073 6f75 7263 6573  ollowing sources
-0001ef30: 2077 696c 6c20 6265 2070 726f 6d6f 7465   will be promote
-0001ef40: 6420 2d20 666f 7220 6578 616d 706c 652c  d - for example,
-0001ef50: 2069 6620 7468 650a 2020 2020 2020 2020   if the.        
-0001ef60: 3173 7420 736f 7572 6365 2069 7320 6465  1st source is de
-0001ef70: 6c65 7465 642c 2074 6865 2032 6e64 2073  leted, the 2nd s
-0001ef80: 6f75 7263 6520 7769 6c6c 2062 6563 6f6d  ource will becom
-0001ef90: 6520 2331 2069 6e20 7468 6520 6c69 7374  e #1 in the list
-0001efa0: 2e0a 2020 2020 2020 2020 5468 6520 676c  ..        The gl
-0001efb0: 6f62 616c 2068 7562 2073 6f75 7263 6520  obal hub source 
-0001efc0: 6361 6e6e 6f74 2062 6520 6465 6c65 7465  cannot be delete
-0001efd0: 642e 0a0a 2020 2020 2020 2020 3a70 6172  d...        :par
-0001efe0: 616d 2073 6f75 7263 655f 6e61 6d65 3a20  am source_name: 
-0001eff0: 4e61 6d65 206f 6620 7468 6520 6875 6220  Name of the hub 
-0001f000: 736f 7572 6365 2074 6f20 6465 6c65 7465  source to delete
-0001f010: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0001f020: 2020 2020 2020 7061 7468 203d 2066 2268        path = f"h
-0001f030: 7562 2f73 6f75 7263 6573 2f7b 736f 7572  ub/sources/{sour
-0001f040: 6365 5f6e 616d 657d 220a 2020 2020 2020  ce_name}".      
-0001f050: 2020 7365 6c66 2e61 7069 5f63 616c 6c28    self.api_call(
-0001f060: 6d65 7468 6f64 3d22 4445 4c45 5445 222c  method="DELETE",
-0001f070: 2070 6174 683d 7061 7468 290a 0a20 2020   path=path)..   
-0001f080: 2064 6566 2067 6574 5f68 7562 5f63 6174   def get_hub_cat
-0001f090: 616c 6f67 280a 2020 2020 2020 2020 7365  alog(.        se
-0001f0a0: 6c66 2c0a 2020 2020 2020 2020 736f 7572  lf,.        sour
-0001f0b0: 6365 5f6e 616d 653a 2073 7472 2c0a 2020  ce_name: str,.  
-0001f0c0: 2020 2020 2020 7665 7273 696f 6e3a 2073        version: s
-0001f0d0: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
-0001f0e0: 2020 2074 6167 3a20 7374 7220 3d20 4e6f     tag: str = No
-0001f0f0: 6e65 2c0a 2020 2020 2020 2020 666f 7263  ne,.        forc
-0001f100: 655f 7265 6672 6573 683a 2062 6f6f 6c20  e_refresh: bool 
-0001f110: 3d20 4661 6c73 652c 0a20 2020 2029 3a0a  = False,.    ):.
-0001f120: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001f130: 2020 2020 5265 7472 6965 7665 2074 6865      Retrieve the
-0001f140: 2069 7465 6d20 6361 7461 6c6f 6720 666f   item catalog fo
-0001f150: 7220 6120 7370 6563 6966 6965 6420 6875  r a specified hu
-0001f160: 6220 736f 7572 6365 2e0a 2020 2020 2020  b source..      
-0001f170: 2020 5468 6520 6c69 7374 206f 6620 6974    The list of it
-0001f180: 656d 7320 6361 6e20 6265 2066 696c 7465  ems can be filte
-0001f190: 7265 6420 6163 636f 7264 696e 6720 746f  red according to
-0001f1a0: 2076 6172 696f 7573 2066 696c 7465 7273   various filters
-0001f1b0: 2c20 7573 696e 6720 6974 656d 2773 206d  , using item's m
-0001f1c0: 6574 6164 6174 6120 746f 2066 696c 7465  etadata to filte
-0001f1d0: 722e 0a0a 2020 2020 2020 2020 3a70 6172  r...        :par
-0001f1e0: 616d 2073 6f75 7263 655f 6e61 6d65 3a20  am source_name: 
-0001f1f0: 4e61 6d65 206f 6620 7468 6520 736f 7572  Name of the sour
-0001f200: 6365 2e0a 2020 2020 2020 2020 3a70 6172  ce..        :par
-0001f210: 616d 2076 6572 7369 6f6e 3a20 4669 6c74  am version: Filt
-0001f220: 6572 2069 7465 6d73 2061 6363 6f72 6469  er items accordi
-0001f230: 6e67 2074 6f20 7468 6569 7220 7665 7273  ng to their vers
-0001f240: 696f 6e2e 0a20 2020 2020 2020 203a 7061  ion..        :pa
-0001f250: 7261 6d20 7461 673a 2046 696c 7465 7220  ram tag: Filter 
-0001f260: 6974 656d 7320 6261 7365 6420 6f6e 2074  items based on t
-0001f270: 6167 2e0a 2020 2020 2020 2020 3a70 6172  ag..        :par
-0001f280: 616d 2066 6f72 6365 5f72 6566 7265 7368  am force_refresh
-0001f290: 3a20 4d61 6b65 2074 6865 2073 6572 7665  : Make the serve
-0001f2a0: 7220 6665 7463 6820 7468 6520 6361 7461  r fetch the cata
-0001f2b0: 6c6f 6720 6672 6f6d 2074 6865 2061 6374  log from the act
-0001f2c0: 7561 6c20 6875 6220 736f 7572 6365 2c0a  ual hub source,.
-0001f2d0: 2020 2020 2020 2020 2020 2020 7261 7468              rath
-0001f2e0: 6572 2074 6861 6e20 7265 6c79 206f 6e20  er than rely on 
-0001f2f0: 6361 6368 6564 2069 6e66 6f72 6d61 7469  cached informati
-0001f300: 6f6e 2077 6869 6368 206d 6179 2065 7869  on which may exi
-0001f310: 7374 2066 726f 6d20 7072 6576 696f 7573  st from previous
-0001f320: 2067 6574 2072 6571 7565 7374 732e 2046   get requests. F
-0001f330: 6f72 2065 7861 6d70 6c65 2c0a 2020 2020  or example,.    
-0001f340: 2020 2020 2020 2020 6966 2074 6865 2073          if the s
-0001f350: 6f75 7263 6520 7761 7320 7265 2d62 7569  ource was re-bui
-0001f360: 6c74 2c0a 2020 2020 2020 2020 2020 2020  lt,.            
-0001f370: 7468 6973 2077 696c 6c20 6d61 6b65 2074  this will make t
-0001f380: 6865 2073 6572 7665 7220 6765 7420 7468  he server get th
-0001f390: 6520 7570 6461 7465 6420 696e 666f 726d  e updated inform
-0001f3a0: 6174 696f 6e2e 2044 6566 6175 6c74 2069  ation. Default i
-0001f3b0: 7320 6060 4661 6c73 6560 602e 0a20 2020  s ``False``..   
-0001f3c0: 2020 2020 203a 7265 7475 726e 733a 203a       :returns: :
-0001f3d0: 7079 3a63 6c61 7373 3a60 7e6d 6c72 756e  py:class:`~mlrun
-0001f3e0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0001f3f0: 6875 622e 4875 6243 6174 616c 6f67 6020  hub.HubCatalog` 
-0001f400: 6f62 6a65 6374 2c20 7768 6963 6820 6973  object, which is
-0001f410: 2065 7373 656e 7469 616c 6c79 2061 206c   essentially a l
-0001f420: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-0001f430: 6f66 203a 7079 3a63 6c61 7373 3a60 7e6d  of :py:class:`~m
-0001f440: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001f450: 6d61 732e 6875 622e 4875 6249 7465 6d60  mas.hub.HubItem`
-0001f460: 2065 6e74 7269 6573 2e0a 2020 2020 2020   entries..      
-0001f470: 2020 2222 220a 2020 2020 2020 2020 7061    """.        pa
-0001f480: 7468 203d 2028 6622 6875 622f 736f 7572  th = (f"hub/sour
-0001f490: 6365 732f 7b73 6f75 7263 655f 6e61 6d65  ces/{source_name
-0001f4a0: 7d2f 6974 656d 7322 2c29 0a20 2020 2020  }/items",).     
-0001f4b0: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
-0001f4c0: 2020 2020 2020 2020 2020 2276 6572 7369            "versi
-0001f4d0: 6f6e 223a 2076 6572 7369 6f6e 2c0a 2020  on": version,.  
-0001f4e0: 2020 2020 2020 2020 2020 2274 6167 223a            "tag":
-0001f4f0: 2074 6167 2c0a 2020 2020 2020 2020 2020   tag,.          
-0001f500: 2020 2266 6f72 6365 2d72 6566 7265 7368    "force-refresh
-0001f510: 223a 2066 6f72 6365 5f72 6566 7265 7368  ": force_refresh
-0001f520: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
-0001f530: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
-0001f540: 656c 662e 6170 695f 6361 6c6c 286d 6574  elf.api_call(met
-0001f550: 686f 643d 2247 4554 222c 2070 6174 683d  hod="GET", path=
-0001f560: 7061 7468 2c20 7061 7261 6d73 3d70 6172  path, params=par
-0001f570: 616d 7329 0a20 2020 2020 2020 2072 6574  ams).        ret
-0001f580: 7572 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e  urn mlrun.common
-0001f590: 2e73 6368 656d 6173 2e48 7562 4361 7461  .schemas.HubCata
-0001f5a0: 6c6f 6728 2a2a 7265 7370 6f6e 7365 2e6a  log(**response.j
-0001f5b0: 736f 6e28 2929 0a0a 2020 2020 6465 6620  son())..    def 
-0001f5c0: 6765 745f 6875 625f 6974 656d 280a 2020  get_hub_item(.  
-0001f5d0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0001f5e0: 2020 2020 736f 7572 6365 5f6e 616d 653a      source_name:
-0001f5f0: 2073 7472 2c0a 2020 2020 2020 2020 6974   str,.        it
-0001f600: 656d 5f6e 616d 653a 2073 7472 2c0a 2020  em_name: str,.  
-0001f610: 2020 2020 2020 7665 7273 696f 6e3a 2073        version: s
-0001f620: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
-0001f630: 2020 2074 6167 3a20 7374 7220 3d20 226c     tag: str = "l
-0001f640: 6174 6573 7422 2c0a 2020 2020 2020 2020  atest",.        
-0001f650: 666f 7263 655f 7265 6672 6573 683a 2062  force_refresh: b
-0001f660: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0001f670: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
-0001f680: 2020 2020 2020 2020 5265 7472 6965 7665          Retrieve
-0001f690: 2061 2073 7065 6369 6669 6320 6875 6220   a specific hub 
-0001f6a0: 6974 656d 2e0a 0a20 2020 2020 2020 203a  item...        :
-0001f6b0: 7061 7261 6d20 736f 7572 6365 5f6e 616d  param source_nam
-0001f6c0: 653a 204e 616d 6520 6f66 2073 6f75 7263  e: Name of sourc
-0001f6d0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-0001f6e0: 6d20 6974 656d 5f6e 616d 653a 204e 616d  m item_name: Nam
-0001f6f0: 6520 6f66 2074 6865 2069 7465 6d20 746f  e of the item to
-0001f700: 2072 6574 7269 6576 652c 2061 7320 6974   retrieve, as it
-0001f710: 2061 7070 6561 7273 2069 6e20 7468 6520   appears in the 
-0001f720: 6361 7461 6c6f 672e 0a20 2020 2020 2020  catalog..       
-0001f730: 203a 7061 7261 6d20 7665 7273 696f 6e3a   :param version:
-0001f740: 2047 6574 2061 2073 7065 6369 6669 6320   Get a specific 
-0001f750: 7665 7273 696f 6e20 6f66 2074 6865 2069  version of the i
-0001f760: 7465 6d2e 2044 6566 6175 6c74 2069 7320  tem. Default is 
-0001f770: 6060 4e6f 6e65 6060 2e0a 2020 2020 2020  ``None``..      
-0001f780: 2020 3a70 6172 616d 2074 6167 3a20 4765    :param tag: Ge
-0001f790: 7420 6120 7370 6563 6966 6963 2076 6572  t a specific ver
-0001f7a0: 7369 6f6e 206f 6620 7468 6520 6974 656d  sion of the item
-0001f7b0: 2069 6465 6e74 6966 6965 6420 6279 2074   identified by t
-0001f7c0: 6167 2e20 4465 6661 756c 7420 6973 2060  ag. Default is `
-0001f7d0: 606c 6174 6573 7460 602e 0a20 2020 2020  `latest``..     
-0001f7e0: 2020 203a 7061 7261 6d20 666f 7263 655f     :param force_
-0001f7f0: 7265 6672 6573 683a 204d 616b 6520 7468  refresh: Make th
-0001f800: 6520 7365 7276 6572 2066 6574 6368 2074  e server fetch t
-0001f810: 6865 2069 6e66 6f72 6d61 7469 6f6e 2066  he information f
-0001f820: 726f 6d20 7468 6520 6163 7475 616c 2068  rom the actual h
-0001f830: 7562 0a20 2020 2020 2020 2020 2020 2073  ub.            s
-0001f840: 6f75 7263 652c 2072 6174 6865 7220 7468  ource, rather th
-0001f850: 616e 0a20 2020 2020 2020 2020 2020 2072  an.            r
-0001f860: 656c 7920 6f6e 2063 6163 6865 6420 696e  ely on cached in
-0001f870: 666f 726d 6174 696f 6e2e 2044 6566 6175  formation. Defau
-0001f880: 6c74 2069 7320 6060 4661 6c73 6560 602e  lt is ``False``.
-0001f890: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0001f8a0: 733a 203a 7079 3a63 6c61 7373 3a60 7e6d  s: :py:class:`~m
-0001f8b0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001f8c0: 6d61 732e 6875 622e 4875 6249 7465 6d60  mas.hub.HubItem`
-0001f8d0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0001f8e0: 2020 2020 2020 7061 7468 203d 2028 6622        path = (f"
-0001f8f0: 6875 622f 736f 7572 6365 732f 7b73 6f75  hub/sources/{sou
-0001f900: 7263 655f 6e61 6d65 7d2f 6974 656d 732f  rce_name}/items/
-0001f910: 7b69 7465 6d5f 6e61 6d65 7d22 2c29 0a20  {item_name}",). 
-0001f920: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-0001f930: 7b0a 2020 2020 2020 2020 2020 2020 2276  {.            "v
-0001f940: 6572 7369 6f6e 223a 2076 6572 7369 6f6e  ersion": version
-0001f950: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
-0001f960: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
-0001f970: 2020 2020 2020 2266 6f72 6365 2d72 6566        "force-ref
-0001f980: 7265 7368 223a 2066 6f72 6365 5f72 6566  resh": force_ref
-0001f990: 7265 7368 2c0a 2020 2020 2020 2020 7d0a  resh,.        }.
-0001f9a0: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-0001f9b0: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
-0001f9c0: 286d 6574 686f 643d 2247 4554 222c 2070  (method="GET", p
-0001f9d0: 6174 683d 7061 7468 2c20 7061 7261 6d73  ath=path, params
-0001f9e0: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
-0001f9f0: 2072 6574 7572 6e20 6d6c 7275 6e2e 636f   return mlrun.co
-0001fa00: 6d6d 6f6e 2e73 6368 656d 6173 2e48 7562  mmon.schemas.Hub
-0001fa10: 4974 656d 282a 2a72 6573 706f 6e73 652e  Item(**response.
-0001fa20: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
-0001fa30: 2067 6574 5f68 7562 5f61 7373 6574 280a   get_hub_asset(.
-0001fa40: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0001fa50: 2020 2020 2020 736f 7572 6365 5f6e 616d        source_nam
-0001fa60: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
-0001fa70: 6974 656d 5f6e 616d 653a 2073 7472 2c0a  item_name: str,.
-0001fa80: 2020 2020 2020 2020 6173 7365 745f 6e61          asset_na
-0001fa90: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
-0001faa0: 2076 6572 7369 6f6e 3a20 7374 7220 3d20   version: str = 
-0001fab0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7461  None,.        ta
-0001fac0: 673a 2073 7472 203d 2022 6c61 7465 7374  g: str = "latest
-0001fad0: 222c 0a20 2020 2029 3a0a 2020 2020 2020  ",.    ):.      
-0001fae0: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
-0001faf0: 7420 6875 6220 6173 7365 7420 6672 6f6d  t hub asset from
-0001fb00: 2069 7465 6d2e 0a0a 2020 2020 2020 2020   item...        
-0001fb10: 3a70 6172 616d 2073 6f75 7263 655f 6e61  :param source_na
-0001fb20: 6d65 3a20 4e61 6d65 206f 6620 736f 7572  me: Name of sour
-0001fb30: 6365 2e0a 2020 2020 2020 2020 3a70 6172  ce..        :par
-0001fb40: 616d 2069 7465 6d5f 6e61 6d65 3a20 2020  am item_name:   
-0001fb50: 4e61 6d65 206f 6620 7468 6520 6974 656d  Name of the item
-0001fb60: 2077 6869 6368 2068 6f6c 6473 2074 6865   which holds the
-0001fb70: 2061 7373 6574 2e0a 2020 2020 2020 2020   asset..        
-0001fb80: 3a70 6172 616d 2061 7373 6574 5f6e 616d  :param asset_nam
-0001fb90: 653a 2020 4e61 6d65 206f 6620 7468 6520  e:  Name of the 
-0001fba0: 6173 7365 7420 746f 2072 6574 7269 6576  asset to retriev
-0001fbb0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-0001fbc0: 6d20 7665 7273 696f 6e3a 2047 6574 2061  m version: Get a
-0001fbd0: 2073 7065 6369 6669 6320 7665 7273 696f   specific versio
-0001fbe0: 6e20 6f66 2074 6865 2069 7465 6d2e 2044  n of the item. D
-0001fbf0: 6566 6175 6c74 2069 7320 6060 4e6f 6e65  efault is ``None
-0001fc00: 6060 2e0a 2020 2020 2020 2020 3a70 6172  ``..        :par
-0001fc10: 616d 2074 6167 3a20 4765 7420 6120 7370  am tag: Get a sp
-0001fc20: 6563 6966 6963 2076 6572 7369 6f6e 206f  ecific version o
-0001fc30: 6620 7468 6520 6974 656d 2069 6465 6e74  f the item ident
-0001fc40: 6966 6965 6420 6279 2074 6167 2e20 4465  ified by tag. De
-0001fc50: 6661 756c 7420 6973 2060 606c 6174 6573  fault is ``lates
-0001fc60: 7460 602e 0a0a 2020 2020 2020 2020 3a72  t``...        :r
-0001fc70: 6574 7572 6e3a 2068 7474 7020 7265 7370  eturn: http resp
-0001fc80: 6f6e 7365 2077 6974 6820 7468 6520 6173  onse with the as
-0001fc90: 7365 7420 696e 2074 6865 2063 6f6e 7465  set in the conte
-0001fca0: 6e74 2061 7474 7269 6275 7465 0a20 2020  nt attribute.   
-0001fcb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001fcc0: 2070 6174 6820 3d20 2866 2268 7562 2f73   path = (f"hub/s
-0001fcd0: 6f75 7263 6573 2f7b 736f 7572 6365 5f6e  ources/{source_n
-0001fce0: 616d 657d 2f69 7465 6d73 2f7b 6974 656d  ame}/items/{item
-0001fcf0: 5f6e 616d 657d 2f61 7373 6574 732f 7b61  _name}/assets/{a
-0001fd00: 7373 6574 5f6e 616d 657d 222c 290a 2020  sset_name}",).  
-0001fd10: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
-0001fd20: 0a20 2020 2020 2020 2020 2020 2022 7665  .            "ve
-0001fd30: 7273 696f 6e22 3a20 7665 7273 696f 6e2c  rsion": version,
-0001fd40: 0a20 2020 2020 2020 2020 2020 2022 7461  .            "ta
-0001fd50: 6722 3a20 7461 672c 0a20 2020 2020 2020  g": tag,.       
-0001fd60: 207d 0a20 2020 2020 2020 2072 6573 706f   }.        respo
-0001fd70: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
-0001fd80: 616c 6c28 6d65 7468 6f64 3d22 4745 5422  all(method="GET"
-0001fd90: 2c20 7061 7468 3d70 6174 682c 2070 6172  , path=path, par
-0001fda0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
-0001fdb0: 2020 2020 7265 7475 726e 2072 6573 706f      return respo
-0001fdc0: 6e73 650a 0a20 2020 2064 6566 2076 6572  nse..    def ver
-0001fdd0: 6966 795f 6175 7468 6f72 697a 6174 696f  ify_authorizatio
-0001fde0: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
-0001fdf0: 0a20 2020 2020 2020 2061 7574 686f 7269  .        authori
-0001fe00: 7a61 7469 6f6e 5f76 6572 6966 6963 6174  zation_verificat
-0001fe10: 696f 6e5f 696e 7075 743a 206d 6c72 756e  ion_input: mlrun
-0001fe20: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0001fe30: 4175 7468 6f72 697a 6174 696f 6e56 6572  AuthorizationVer
-0001fe40: 6966 6963 6174 696f 6e49 6e70 7574 2c0a  ificationInput,.
-0001fe50: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0001fe60: 2222 5665 7269 6669 6573 2061 7574 686f  ""Verifies autho
-0001fe70: 7269 7a61 7469 6f6e 2066 6f72 2074 6865  rization for the
-0001fe80: 2070 726f 7669 6465 6420 6163 7469 6f6e   provided action
-0001fe90: 206f 6e20 7468 6520 7072 6f76 6964 6564   on the provided
-0001fea0: 2072 6573 6f75 7263 652e 0a0a 2020 2020   resource...    
-0001feb0: 2020 2020 3a70 6172 616d 2061 7574 686f      :param autho
-0001fec0: 7269 7a61 7469 6f6e 5f76 6572 6966 6963  rization_verific
-0001fed0: 6174 696f 6e5f 696e 7075 743a 2049 6e73  ation_input: Ins
-0001fee0: 7461 6e63 6520 6f66 0a20 2020 2020 2020  tance of.       
-0001fef0: 2020 2020 203a 7079 3a63 6c61 7373 3a60       :py:class:`
-0001ff00: 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  ~mlrun.common.sc
-0001ff10: 6865 6d61 732e 4175 7468 6f72 697a 6174  hemas.Authorizat
-0001ff20: 696f 6e56 6572 6966 6963 6174 696f 6e49  ionVerificationI
-0001ff30: 6e70 7574 6020 7468 6174 2069 6e63 6c75  nput` that inclu
-0001ff40: 6465 7320 616c 6c20 7468 6520 6e65 6564  des all the need
-0001ff50: 6564 2070 6172 616d 6574 6572 7320 666f  ed parameters fo
-0001ff60: 720a 2020 2020 2020 2020 2020 2020 7468  r.            th
-0001ff70: 6520 6175 7468 2076 6572 6966 6963 6174  e auth verificat
-0001ff80: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
-0001ff90: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-0001ffa0: 7373 6167 6520 3d20 2241 7574 686f 7269  ssage = "Authori
-0001ffb0: 7a61 7469 6f6e 2063 6865 636b 2066 6169  zation check fai
-0001ffc0: 6c65 6422 0a20 2020 2020 2020 2073 656c  led".        sel
-0001ffd0: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-0001ffe0: 2020 2020 2020 2020 2250 4f53 5422 2c0a          "POST",.
-0001fff0: 2020 2020 2020 2020 2020 2020 2261 7574              "aut
-00020000: 686f 7269 7a61 7469 6f6e 2f76 6572 6966  horization/verif
-00020010: 6963 6174 696f 6e73 222c 0a20 2020 2020  ications",.     
-00020020: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-00020030: 7361 6765 2c0a 2020 2020 2020 2020 2020  sage,.          
-00020040: 2020 626f 6479 3d64 6963 745f 746f 5f6a    body=dict_to_j
-00020050: 736f 6e28 6175 7468 6f72 697a 6174 696f  son(authorizatio
-00020060: 6e5f 7665 7269 6669 6361 7469 6f6e 5f69  n_verification_i
-00020070: 6e70 7574 2e64 6963 7428 2929 2c0a 2020  nput.dict()),.  
-00020080: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-00020090: 2074 7269 6767 6572 5f6d 6967 7261 7469   trigger_migrati
-000200a0: 6f6e 7328 7365 6c66 2920 2d3e 204f 7074  ons(self) -> Opt
-000200b0: 696f 6e61 6c5b 6d6c 7275 6e2e 636f 6d6d  ional[mlrun.comm
-000200c0: 6f6e 2e73 6368 656d 6173 2e42 6163 6b67  on.schemas.Backg
-000200d0: 726f 756e 6454 6173 6b5d 3a0a 2020 2020  roundTask]:.    
-000200e0: 2020 2020 2222 2254 7269 6767 6572 206d      """Trigger m
-000200f0: 6967 7261 7469 6f6e 7320 2877 696c 6c20  igrations (will 
-00020100: 646f 206e 6f74 6869 6e67 2069 6620 6e6f  do nothing if no
-00020110: 206d 6967 7261 7469 6f6e 7320 6172 6520   migrations are 
-00020120: 6e65 6564 6564 2920 616e 6420 7761 6974  needed) and wait
-00020130: 2066 6f72 2074 6865 6d20 746f 2066 696e   for them to fin
-00020140: 6973 6820 6966 2061 6374 7561 6c6c 790a  ish if actually.
-00020150: 2020 2020 2020 2020 7472 6967 6765 7265          triggere
-00020160: 640a 2020 2020 2020 2020 3a72 6574 7572  d.        :retur
-00020170: 6e73 3a20 3a70 793a 636c 6173 733a 607e  ns: :py:class:`~
-00020180: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00020190: 656d 6173 2e42 6163 6b67 726f 756e 6454  emas.BackgroundT
-000201a0: 6173 6b60 2e0a 2020 2020 2020 2020 2222  ask`..        ""
-000201b0: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
-000201c0: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
-000201d0: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-000201e0: 2250 4f53 5422 2c0a 2020 2020 2020 2020  "POST",.        
-000201f0: 2020 2020 226f 7065 7261 7469 6f6e 732f      "operations/
-00020200: 6d69 6772 6174 696f 6e73 222c 0a20 2020  migrations",.   
-00020210: 2020 2020 2020 2020 2022 4661 696c 6564           "Failed
-00020220: 2074 7269 6767 6572 696e 6720 6d69 6772   triggering migr
-00020230: 6174 696f 6e73 222c 0a20 2020 2020 2020  ations",.       
-00020240: 2029 0a20 2020 2020 2020 2069 6620 7265   ).        if re
-00020250: 7370 6f6e 7365 2e73 7461 7475 735f 636f  sponse.status_co
-00020260: 6465 203d 3d20 6874 7470 2e48 5454 5053  de == http.HTTPS
-00020270: 7461 7475 732e 4143 4345 5054 4544 3a0a  tatus.ACCEPTED:.
-00020280: 2020 2020 2020 2020 2020 2020 6261 636b              back
-00020290: 6772 6f75 6e64 5f74 6173 6b20 3d20 6d6c  ground_task = ml
-000202a0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-000202b0: 6173 2e42 6163 6b67 726f 756e 6454 6173  as.BackgroundTas
-000202c0: 6b28 2a2a 7265 7370 6f6e 7365 2e6a 736f  k(**response.jso
-000202d0: 6e28 2929 0a20 2020 2020 2020 2020 2020  n()).           
-000202e0: 2072 6574 7572 6e20 7365 6c66 2e5f 7761   return self._wa
-000202f0: 6974 5f66 6f72 5f62 6163 6b67 726f 756e  it_for_backgroun
-00020300: 645f 7461 736b 5f74 6f5f 7265 6163 685f  d_task_to_reach_
-00020310: 7465 726d 696e 616c 5f73 7461 7465 280a  terminal_state(.
-00020320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020330: 6261 636b 6772 6f75 6e64 5f74 6173 6b2e  background_task.
-00020340: 6d65 7461 6461 7461 2e6e 616d 650a 2020  metadata.name.  
-00020350: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00020360: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00020370: 0a20 2020 2064 6566 2073 6574 5f72 756e  .    def set_run
-00020380: 5f6e 6f74 6966 6963 6174 696f 6e73 280a  _notifications(.
-00020390: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000203a0: 2020 2020 2020 7072 6f6a 6563 743a 2073        project: s
-000203b0: 7472 2c0a 2020 2020 2020 2020 7275 6e5f  tr,.        run_
-000203c0: 7569 643a 2073 7472 2c0a 2020 2020 2020  uid: str,.      
-000203d0: 2020 6e6f 7469 6669 6361 7469 6f6e 733a    notifications:
-000203e0: 2074 7970 696e 672e 4c69 7374 5b6d 6c72   typing.List[mlr
-000203f0: 756e 2e6d 6f64 656c 2e4e 6f74 6966 6963  un.model.Notific
-00020400: 6174 696f 6e5d 203d 204e 6f6e 652c 0a20  ation] = None,. 
-00020410: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00020420: 220a 2020 2020 2020 2020 5365 7420 6e6f  ".        Set no
-00020430: 7469 6669 6361 7469 6f6e 7320 6f6e 2061  tifications on a
-00020440: 2072 756e 2e20 5468 6973 2077 696c 6c20   run. This will 
-00020450: 6f76 6572 7269 6465 2061 6e79 2065 7869  override any exi
-00020460: 7374 696e 6720 6e6f 7469 6669 6361 7469  sting notificati
-00020470: 6f6e 7320 6f6e 2074 6865 2072 756e 2e0a  ons on the run..
-00020480: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00020490: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
-000204a0: 636f 6e74 6169 6e69 6e67 2074 6865 2072  containing the r
-000204b0: 756e 2e0a 2020 2020 2020 2020 3a70 6172  un..        :par
-000204c0: 616d 2072 756e 5f75 6964 3a20 5549 4420  am run_uid: UID 
-000204d0: 6f66 2074 6865 2072 756e 2e0a 2020 2020  of the run..    
-000204e0: 2020 2020 3a70 6172 616d 206e 6f74 6966      :param notif
-000204f0: 6963 6174 696f 6e73 3a20 4c69 7374 206f  ications: List o
-00020500: 6620 6e6f 7469 6669 6361 7469 6f6e 7320  f notifications 
-00020510: 746f 2073 6574 206f 6e20 7468 6520 7275  to set on the ru
-00020520: 6e2e 2044 6566 6175 6c74 2069 7320 616e  n. Default is an
-00020530: 2065 6d70 7479 206c 6973 742e 0a20 2020   empty list..   
-00020540: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00020550: 206e 6f74 6966 6963 6174 696f 6e73 203d   notifications =
-00020560: 206e 6f74 6966 6963 6174 696f 6e73 206f   notifications o
-00020570: 7220 5b5d 0a0a 2020 2020 2020 2020 7365  r []..        se
-00020580: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-00020590: 2020 2020 2020 2020 2022 5055 5422 2c0a           "PUT",.
-000205a0: 2020 2020 2020 2020 2020 2020 6622 7072              f"pr
-000205b0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
-000205c0: 2f72 756e 732f 7b72 756e 5f75 6964 7d2f  /runs/{run_uid}/
-000205d0: 6e6f 7469 6669 6361 7469 6f6e 7322 2c0a  notifications",.
-000205e0: 2020 2020 2020 2020 2020 2020 6622 4661              f"Fa
-000205f0: 696c 6564 2074 6f20 7365 7420 6e6f 7469  iled to set noti
-00020600: 6669 6361 7469 6f6e 7320 6f6e 2072 756e  fications on run
-00020610: 2e20 7569 643d 7b72 756e 5f75 6964 7d2c  . uid={run_uid},
-00020620: 2070 726f 6a65 6374 3d7b 7072 6f6a 6563   project={projec
-00020630: 747d 222c 0a20 2020 2020 2020 2020 2020  t}",.           
-00020640: 206a 736f 6e3d 7b0a 2020 2020 2020 2020   json={.        
-00020650: 2020 2020 2020 2020 226e 6f74 6966 6963          "notific
-00020660: 6174 696f 6e73 223a 205b 0a20 2020 2020  ations": [.     
-00020670: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00020680: 6f74 6966 6963 6174 696f 6e2e 746f 5f64  otification.to_d
-00020690: 6963 7428 2920 666f 7220 6e6f 7469 6669  ict() for notifi
-000206a0: 6361 7469 6f6e 2069 6e20 6e6f 7469 6669  cation in notifi
-000206b0: 6361 7469 6f6e 730a 2020 2020 2020 2020  cations.        
-000206c0: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
-000206d0: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
-000206e0: 2020 290a 0a20 2020 2064 6566 2073 6574    )..    def set
-000206f0: 5f73 6368 6564 756c 655f 6e6f 7469 6669  _schedule_notifi
-00020700: 6361 7469 6f6e 7328 0a20 2020 2020 2020  cations(.       
-00020710: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-00020720: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
-00020730: 2020 2020 2073 6368 6564 756c 655f 6e61       schedule_na
-00020740: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
-00020750: 206e 6f74 6966 6963 6174 696f 6e73 3a20   notifications: 
-00020760: 7479 7069 6e67 2e4c 6973 745b 6d6c 7275  typing.List[mlru
-00020770: 6e2e 6d6f 6465 6c2e 4e6f 7469 6669 6361  n.model.Notifica
-00020780: 7469 6f6e 5d20 3d20 4e6f 6e65 2c0a 2020  tion] = None,.  
-00020790: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-000207a0: 0a20 2020 2020 2020 2053 6574 206e 6f74  .        Set not
-000207b0: 6966 6963 6174 696f 6e73 206f 6e20 6120  ifications on a 
-000207c0: 7363 6865 6475 6c65 2e20 5468 6973 2077  schedule. This w
-000207d0: 696c 6c20 6f76 6572 7269 6465 2061 6e79  ill override any
-000207e0: 2065 7869 7374 696e 6720 6e6f 7469 6669   existing notifi
-000207f0: 6361 7469 6f6e 7320 6f6e 2074 6865 2073  cations on the s
-00020800: 6368 6564 756c 652e 0a20 2020 2020 2020  chedule..       
-00020810: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
-00020820: 2050 726f 6a65 6374 2063 6f6e 7461 696e   Project contain
-00020830: 696e 6720 7468 6520 7363 6865 6475 6c65  ing the schedule
-00020840: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00020850: 2073 6368 6564 756c 655f 6e61 6d65 3a20   schedule_name: 
-00020860: 4e61 6d65 206f 6620 7468 6520 7363 6865  Name of the sche
-00020870: 6475 6c65 2e0a 2020 2020 2020 2020 3a70  dule..        :p
-00020880: 6172 616d 206e 6f74 6966 6963 6174 696f  aram notificatio
-00020890: 6e73 3a20 4c69 7374 206f 6620 6e6f 7469  ns: List of noti
-000208a0: 6669 6361 7469 6f6e 7320 746f 2073 6574  fications to set
-000208b0: 206f 6e20 7468 6520 7363 6865 6475 6c65   on the schedule
-000208c0: 2e20 4465 6661 756c 7420 6973 2061 6e20  . Default is an 
-000208d0: 656d 7074 7920 6c69 7374 2e0a 2020 2020  empty list..    
-000208e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000208f0: 6e6f 7469 6669 6361 7469 6f6e 7320 3d20  notifications = 
-00020900: 6e6f 7469 6669 6361 7469 6f6e 7320 6f72  notifications or
-00020910: 205b 5d0a 0a20 2020 2020 2020 2073 656c   []..        sel
-00020920: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-00020930: 2020 2020 2020 2020 2250 5554 222c 0a20          "PUT",. 
-00020940: 2020 2020 2020 2020 2020 2066 2270 726f             f"pro
-00020950: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-00020960: 7363 6865 6475 6c65 732f 7b73 6368 6564  schedules/{sched
-00020970: 756c 655f 6e61 6d65 7d2f 6e6f 7469 6669  ule_name}/notifi
-00020980: 6361 7469 6f6e 7322 2c0a 2020 2020 2020  cations",.      
-00020990: 2020 2020 2020 6622 4661 696c 6564 2074        f"Failed t
-000209a0: 6f20 7365 7420 6e6f 7469 6669 6361 7469  o set notificati
-000209b0: 6f6e 7320 6f6e 2073 6368 6564 756c 652e  ons on schedule.
-000209c0: 2073 6368 6564 756c 653d 7b73 6368 6564   schedule={sched
-000209d0: 756c 655f 6e61 6d65 7d2c 2070 726f 6a65  ule_name}, proje
-000209e0: 6374 3d7b 7072 6f6a 6563 747d 222c 0a20  ct={project}",. 
-000209f0: 2020 2020 2020 2020 2020 206a 736f 6e3d             json=
-00020a00: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00020a10: 2020 226e 6f74 6966 6963 6174 696f 6e73    "notifications
-00020a20: 223a 205b 0a20 2020 2020 2020 2020 2020  ": [.           
-00020a30: 2020 2020 2020 2020 206e 6f74 6966 6963           notific
-00020a40: 6174 696f 6e2e 746f 5f64 6963 7428 2920  ation.to_dict() 
-00020a50: 666f 7220 6e6f 7469 6669 6361 7469 6f6e  for notification
-00020a60: 2069 6e20 6e6f 7469 6669 6361 7469 6f6e   in notification
-00020a70: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00020a80: 2020 5d2c 0a20 2020 2020 2020 2020 2020    ],.           
-00020a90: 207d 2c0a 2020 2020 2020 2020 290a 0a0a   },.        )...
-00020aa0: 6465 6620 5f61 735f 6a73 6f6e 286f 626a  def _as_json(obj
-00020ab0: 293a 0a20 2020 2066 6e20 3d20 6765 7461  ):.    fn = geta
-00020ac0: 7474 7228 6f62 6a2c 2022 746f 5f6a 736f  ttr(obj, "to_jso
-00020ad0: 6e22 2c20 4e6f 6e65 290a 2020 2020 6966  n", None).    if
-00020ae0: 2066 6e3a 0a20 2020 2020 2020 2072 6574   fn:.        ret
-00020af0: 7572 6e20 666e 2829 0a20 2020 2072 6574  urn fn().    ret
-00020b00: 7572 6e20 6469 6374 5f74 6f5f 6a73 6f6e  urn dict_to_json
-00020b10: 286f 626a 290a                           (obj).
+0001e440: 7370 6563 3d6d 6c72 756e 2e63 6f6d 6d6f  spec=mlrun.commo
+0001e450: 6e2e 7363 6865 6d61 732e 4875 6253 6f75  n.schemas.HubSou
+0001e460: 7263 6553 7065 6328 7061 7468 3d22 2f6c  rceSpec(path="/l
+0001e470: 6f63 616c 2f70 6174 682f 746f 2f73 6f75  ocal/path/to/sou
+0001e480: 7263 6522 2c20 6368 616e 6e65 6c3d 2264  rce", channel="d
+0001e490: 6576 656c 6f70 6d65 6e74 2229 0a20 2020  evelopment").   
+0001e4a0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001e4b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001e4c0: 2020 2020 2020 2020 2064 622e 6372 6561           db.crea
+0001e4d0: 7465 5f68 7562 5f73 6f75 7263 6528 7072  te_hub_source(pr
+0001e4e0: 6976 6174 655f 736f 7572 6365 290a 0a20  ivate_source).. 
+0001e4f0: 2020 2020 2020 2020 2020 2023 2041 6464             # Add
+0001e500: 2061 6e6f 7468 6572 2073 6f75 7263 6520   another source 
+0001e510: 6173 2031 7374 2069 6e20 7468 6520 6c69  as 1st in the li
+0001e520: 7374 202d 2077 696c 6c20 7075 7368 2070  st - will push p
+0001e530: 7265 7669 6f75 7320 6f6e 6520 746f 2062  revious one to b
+0001e540: 6520 2332 0a20 2020 2020 2020 2020 2020  e #2.           
+0001e550: 2061 6e6f 7468 6572 5f73 6f75 7263 6520   another_source 
+0001e560: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+0001e570: 6368 656d 6173 2e49 6e64 6578 6564 4875  chemas.IndexedHu
+0001e580: 6253 6f75 7263 6528 0a20 2020 2020 2020  bSource(.       
+0001e590: 2020 2020 2020 2020 206f 7264 6572 3d31           order=1
+0001e5a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e5b0: 2020 736f 7572 6365 3d6d 6c72 756e 2e63    source=mlrun.c
+0001e5c0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4875  ommon.schemas.Hu
+0001e5d0: 6253 6f75 7263 6528 0a20 2020 2020 2020  bSource(.       
+0001e5e0: 2020 2020 2020 2020 2020 2020 206d 6574               met
+0001e5f0: 6164 6174 613d 6d6c 7275 6e2e 636f 6d6d  adata=mlrun.comm
+0001e600: 6f6e 2e73 6368 656d 6173 2e48 7562 4f62  on.schemas.HubOb
+0001e610: 6a65 6374 4d65 7461 6461 7461 280a 2020  jectMetadata(.  
+0001e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e630: 2020 2020 2020 6e61 6d65 3d22 7072 6976        name="priv
+0001e640: 2d32 222c 2064 6573 6372 6970 7469 6f6e  -2", description
+0001e650: 3d22 616e 6f74 6865 7220 736f 7572 6365  ="another source
+0001e660: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001e670: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+0001e680: 2020 2020 2020 2020 2020 2020 2073 7065               spe
+0001e690: 633d 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  c=mlrun.common.s
+0001e6a0: 6368 656d 6173 2e48 7562 536f 7572 6365  chemas.HubSource
+0001e6b0: 5370 6563 280a 2020 2020 2020 2020 2020  Spec(.          
+0001e6c0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0001e6d0: 7468 3d22 2f6c 6f63 616c 2f70 6174 682f  th="/local/path/
+0001e6e0: 746f 2f73 6f75 7263 652f 3222 2c0a 2020  to/source/2",.  
+0001e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e700: 2020 2020 2020 6368 616e 6e65 6c3d 2264        channel="d
+0001e710: 6576 656c 6f70 6d65 6e74 222c 0a20 2020  evelopment",.   
+0001e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e730: 2020 2020 2063 7265 6465 6e74 6961 6c73       credentials
+0001e740: 3d7b 2e2e 2e7d 0a20 2020 2020 2020 2020  ={...}.         
+0001e750: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001e760: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001e770: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001e780: 2020 2020 2020 2020 2064 622e 6372 6561           db.crea
+0001e790: 7465 5f68 7562 5f73 6f75 7263 6528 616e  te_hub_source(an
+0001e7a0: 6f74 6865 725f 736f 7572 6365 290a 0a20  other_source).. 
+0001e7b0: 2020 2020 2020 203a 7061 7261 6d20 736f         :param so
+0001e7c0: 7572 6365 3a20 5468 6520 736f 7572 6365  urce: The source
+0001e7d0: 2061 6e64 2069 7473 206f 7264 6572 2c20   and its order, 
+0001e7e0: 6f66 2074 7970 650a 2020 2020 2020 2020  of type.        
+0001e7f0: 2020 2020 3a70 793a 636c 6173 733a 607e      :py:class:`~
+0001e800: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+0001e810: 656d 6173 2e68 7562 2e49 6e64 6578 6564  emas.hub.Indexed
+0001e820: 4875 6253 6f75 7263 6560 2c20 6f72 2069  HubSource`, or i
+0001e830: 6e20 6469 6374 696f 6e61 7279 2066 6f72  n dictionary for
+0001e840: 6d2e 0a20 2020 2020 2020 203a 7265 7475  m..        :retu
+0001e850: 726e 733a 2054 6865 2073 6f75 7263 6520  rns: The source 
+0001e860: 6f62 6a65 6374 2061 7320 696e 7365 7274  object as insert
+0001e870: 6564 2069 6e74 6f20 7468 6520 6461 7461  ed into the data
+0001e880: 6261 7365 2c20 7769 7468 2063 7265 6465  base, with crede
+0001e890: 6e74 6961 6c73 2073 7472 6970 7065 642e  ntials stripped.
+0001e8a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001e8b0: 2020 2020 2070 6174 6820 3d20 2268 7562       path = "hub
+0001e8c0: 2f73 6f75 7263 6573 220a 2020 2020 2020  /sources".      
+0001e8d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001e8e0: 736f 7572 6365 2c20 6d6c 7275 6e2e 636f  source, mlrun.co
+0001e8f0: 6d6d 6f6e 2e73 6368 656d 6173 2e49 6e64  mmon.schemas.Ind
+0001e900: 6578 6564 4875 6253 6f75 7263 6529 3a0a  exedHubSource):.
+0001e910: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+0001e920: 6365 203d 2073 6f75 7263 652e 6469 6374  ce = source.dict
+0001e930: 2829 0a20 2020 2020 2020 2072 6573 706f  ().        respo
+0001e940: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
+0001e950: 616c 6c28 6d65 7468 6f64 3d22 504f 5354  all(method="POST
+0001e960: 222c 2070 6174 683d 7061 7468 2c20 6a73  ", path=path, js
+0001e970: 6f6e 3d73 6f75 7263 6529 0a20 2020 2020  on=source).     
+0001e980: 2020 2072 6574 7572 6e20 6d6c 7275 6e2e     return mlrun.
+0001e990: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e49  common.schemas.I
+0001e9a0: 6e64 6578 6564 4875 6253 6f75 7263 6528  ndexedHubSource(
+0001e9b0: 2a2a 7265 7370 6f6e 7365 2e6a 736f 6e28  **response.json(
+0001e9c0: 2929 0a0a 2020 2020 6465 6620 7374 6f72  ))..    def stor
+0001e9d0: 655f 6875 625f 736f 7572 6365 280a 2020  e_hub_source(.  
+0001e9e0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001e9f0: 2020 2020 736f 7572 6365 5f6e 616d 653a      source_name:
+0001ea00: 2073 7472 2c0a 2020 2020 2020 2020 736f   str,.        so
+0001ea10: 7572 6365 3a20 556e 696f 6e5b 6469 6374  urce: Union[dict
+0001ea20: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+0001ea30: 6368 656d 6173 2e49 6e64 6578 6564 4875  chemas.IndexedHu
+0001ea40: 6253 6f75 7263 655d 2c0a 2020 2020 293a  bSource],.    ):
+0001ea50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001ea60: 2020 2020 2043 7265 6174 6520 6f72 2072       Create or r
+0001ea70: 6570 6c61 6365 2061 2068 7562 2073 6f75  eplace a hub sou
+0001ea80: 7263 652e 0a20 2020 2020 2020 2046 6f72  rce..        For
+0001ea90: 2061 6e20 6578 616d 706c 6520 6f66 2074   an example of t
+0001eaa0: 6865 2073 6f75 7263 6520 666f 726d 6174  he source format
+0001eab0: 2061 6e64 2065 7870 6c61 6e61 7469 6f6e   and explanation
+0001eac0: 206f 6620 7468 6520 736f 7572 6365 206f   of the source o
+0001ead0: 7264 6572 206c 6f67 6963 2c0a 2020 2020  rder logic,.    
+0001eae0: 2020 2020 706c 6561 7365 2073 6565 203a      please see :
+0001eaf0: 7079 3a66 756e 633a 607e 6372 6561 7465  py:func:`~create
+0001eb00: 5f68 7562 5f73 6f75 7263 6560 2e20 5468  _hub_source`. Th
+0001eb10: 6973 206d 6574 686f 6420 6361 6e20 6265  is method can be
+0001eb20: 2075 7365 6420 746f 206d 6f64 6966 7920   used to modify 
+0001eb30: 7468 6520 736f 7572 6365 2069 7473 656c  the source itsel
+0001eb40: 6620 6f72 2069 7473 0a20 2020 2020 2020  f or its.       
+0001eb50: 206f 7264 6572 2069 6e20 7468 6520 6c69   order in the li
+0001eb60: 7374 206f 6620 736f 7572 6365 732e 0a0a  st of sources...
+0001eb70: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0001eb80: 6f75 7263 655f 6e61 6d65 3a20 4e61 6d65  ource_name: Name
+0001eb90: 206f 6620 7468 6520 736f 7572 6365 206f   of the source o
+0001eba0: 626a 6563 7420 746f 206d 6f64 6966 792f  bject to modify/
+0001ebb0: 6372 6561 7465 2e20 4974 206d 7573 7420  create. It must 
+0001ebc0: 6d61 7463 6820 7468 6520 6060 736f 7572  match the ``sour
+0001ebd0: 6365 2e6d 6574 6164 6174 612e 6e61 6d65  ce.metadata.name
+0001ebe0: 6060 0a20 2020 2020 2020 2020 2020 2070  ``.            p
+0001ebf0: 6172 616d 6574 6572 2069 6e20 7468 6520  arameter in the 
+0001ec00: 736f 7572 6365 2069 7473 656c 662e 0a20  source itself.. 
+0001ec10: 2020 2020 2020 203a 7061 7261 6d20 736f         :param so
+0001ec20: 7572 6365 3a20 536f 7572 6365 206f 626a  urce: Source obj
+0001ec30: 6563 7420 746f 2073 746f 7265 2069 6e20  ect to store in 
+0001ec40: 7468 6520 6461 7461 6261 7365 2e0a 2020  the database..  
+0001ec50: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
+0001ec60: 5468 6520 736f 7572 6365 206f 626a 6563  The source objec
+0001ec70: 7420 6173 2073 746f 7265 6420 696e 2074  t as stored in t
+0001ec80: 6865 2044 422e 0a20 2020 2020 2020 2022  he DB..        "
+0001ec90: 2222 0a20 2020 2020 2020 2070 6174 6820  "".        path 
+0001eca0: 3d20 6622 6875 622f 736f 7572 6365 732f  = f"hub/sources/
+0001ecb0: 7b73 6f75 7263 655f 6e61 6d65 7d22 0a20  {source_name}". 
+0001ecc0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0001ecd0: 616e 6365 2873 6f75 7263 652c 206d 6c72  ance(source, mlr
+0001ece0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0001ecf0: 732e 496e 6465 7865 6448 7562 536f 7572  s.IndexedHubSour
+0001ed00: 6365 293a 0a20 2020 2020 2020 2020 2020  ce):.           
+0001ed10: 2073 6f75 7263 6520 3d20 736f 7572 6365   source = source
+0001ed20: 2e64 6963 7428 290a 0a20 2020 2020 2020  .dict()..       
+0001ed30: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
+0001ed40: 2e61 7069 5f63 616c 6c28 6d65 7468 6f64  .api_call(method
+0001ed50: 3d22 5055 5422 2c20 7061 7468 3d70 6174  ="PUT", path=pat
+0001ed60: 682c 206a 736f 6e3d 736f 7572 6365 290a  h, json=source).
+0001ed70: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+0001ed80: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001ed90: 6d61 732e 496e 6465 7865 6448 7562 536f  mas.IndexedHubSo
+0001eda0: 7572 6365 282a 2a72 6573 706f 6e73 652e  urce(**response.
+0001edb0: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
+0001edc0: 206c 6973 745f 6875 625f 736f 7572 6365   list_hub_source
+0001edd0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0001ede0: 2022 2222 0a20 2020 2020 2020 204c 6973   """.        Lis
+0001edf0: 7420 6875 6220 736f 7572 6365 7320 696e  t hub sources in
+0001ee00: 2074 6865 204d 4c52 756e 2044 422e 0a20   the MLRun DB.. 
+0001ee10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001ee20: 2020 2070 6174 6820 3d20 2268 7562 2f73     path = "hub/s
+0001ee30: 6f75 7263 6573 220a 2020 2020 2020 2020  ources".        
+0001ee40: 7265 7370 6f6e 7365 203d 2073 656c 662e  response = self.
+0001ee50: 6170 695f 6361 6c6c 286d 6574 686f 643d  api_call(method=
+0001ee60: 2247 4554 222c 2070 6174 683d 7061 7468  "GET", path=path
+0001ee70: 292e 6a73 6f6e 2829 0a20 2020 2020 2020  ).json().       
+0001ee80: 2072 6573 756c 7473 203d 205b 5d0a 2020   results = [].  
+0001ee90: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+0001eea0: 6e20 7265 7370 6f6e 7365 3a0a 2020 2020  n response:.    
+0001eeb0: 2020 2020 2020 2020 7265 7375 6c74 732e          results.
+0001eec0: 6170 7065 6e64 286d 6c72 756e 2e63 6f6d  append(mlrun.com
+0001eed0: 6d6f 6e2e 7363 6865 6d61 732e 496e 6465  mon.schemas.Inde
+0001eee0: 7865 6448 7562 536f 7572 6365 282a 2a69  xedHubSource(**i
+0001eef0: 7465 6d29 290a 2020 2020 2020 2020 7265  tem)).        re
+0001ef00: 7475 726e 2072 6573 756c 7473 0a0a 2020  turn results..  
+0001ef10: 2020 6465 6620 6765 745f 6875 625f 736f    def get_hub_so
+0001ef20: 7572 6365 2873 656c 662c 2073 6f75 7263  urce(self, sourc
+0001ef30: 655f 6e61 6d65 3a20 7374 7229 3a0a 2020  e_name: str):.  
+0001ef40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001ef50: 2020 5265 7472 6965 7665 2061 2068 7562    Retrieve a hub
+0001ef60: 2073 6f75 7263 6520 6672 6f6d 2074 6865   source from the
+0001ef70: 2044 422e 0a0a 2020 2020 2020 2020 3a70   DB...        :p
+0001ef80: 6172 616d 2073 6f75 7263 655f 6e61 6d65  aram source_name
+0001ef90: 3a20 4e61 6d65 206f 6620 7468 6520 6875  : Name of the hu
+0001efa0: 6220 736f 7572 6365 2074 6f20 7265 7472  b source to retr
+0001efb0: 6965 7665 2e0a 2020 2020 2020 2020 2222  ieve..        ""
+0001efc0: 220a 2020 2020 2020 2020 7061 7468 203d  ".        path =
+0001efd0: 2066 2268 7562 2f73 6f75 7263 6573 2f7b   f"hub/sources/{
+0001efe0: 736f 7572 6365 5f6e 616d 657d 220a 2020  source_name}".  
+0001eff0: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
+0001f000: 2073 656c 662e 6170 695f 6361 6c6c 286d   self.api_call(m
+0001f010: 6574 686f 643d 2247 4554 222c 2070 6174  ethod="GET", pat
+0001f020: 683d 7061 7468 290a 2020 2020 2020 2020  h=path).        
+0001f030: 7265 7475 726e 206d 6c72 756e 2e63 6f6d  return mlrun.com
+0001f040: 6d6f 6e2e 7363 6865 6d61 732e 496e 6465  mon.schemas.Inde
+0001f050: 7865 6448 7562 536f 7572 6365 282a 2a72  xedHubSource(**r
+0001f060: 6573 706f 6e73 652e 6a73 6f6e 2829 290a  esponse.json()).
+0001f070: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
+0001f080: 6875 625f 736f 7572 6365 2873 656c 662c  hub_source(self,
+0001f090: 2073 6f75 7263 655f 6e61 6d65 3a20 7374   source_name: st
+0001f0a0: 7229 3a0a 2020 2020 2020 2020 2222 220a  r):.        """.
+0001f0b0: 2020 2020 2020 2020 4465 6c65 7465 2061          Delete a
+0001f0c0: 2068 7562 2073 6f75 7263 6520 6672 6f6d   hub source from
+0001f0d0: 2074 6865 2044 422e 0a20 2020 2020 2020   the DB..       
+0001f0e0: 2054 6865 2073 6f75 7263 6520 7769 6c6c   The source will
+0001f0f0: 2062 6520 6465 6c65 7465 6420 6672 6f6d   be deleted from
+0001f100: 2074 6865 206c 6973 742c 2061 6e64 2061   the list, and a
+0001f110: 6e79 2066 6f6c 6c6f 7769 6e67 2073 6f75  ny following sou
+0001f120: 7263 6573 2077 696c 6c20 6265 2070 726f  rces will be pro
+0001f130: 6d6f 7465 6420 2d20 666f 7220 6578 616d  moted - for exam
+0001f140: 706c 652c 2069 6620 7468 650a 2020 2020  ple, if the.    
+0001f150: 2020 2020 3173 7420 736f 7572 6365 2069      1st source i
+0001f160: 7320 6465 6c65 7465 642c 2074 6865 2032  s deleted, the 2
+0001f170: 6e64 2073 6f75 7263 6520 7769 6c6c 2062  nd source will b
+0001f180: 6563 6f6d 6520 2331 2069 6e20 7468 6520  ecome #1 in the 
+0001f190: 6c69 7374 2e0a 2020 2020 2020 2020 5468  list..        Th
+0001f1a0: 6520 676c 6f62 616c 2068 7562 2073 6f75  e global hub sou
+0001f1b0: 7263 6520 6361 6e6e 6f74 2062 6520 6465  rce cannot be de
+0001f1c0: 6c65 7465 642e 0a0a 2020 2020 2020 2020  leted...        
+0001f1d0: 3a70 6172 616d 2073 6f75 7263 655f 6e61  :param source_na
+0001f1e0: 6d65 3a20 4e61 6d65 206f 6620 7468 6520  me: Name of the 
+0001f1f0: 6875 6220 736f 7572 6365 2074 6f20 6465  hub source to de
+0001f200: 6c65 7465 2e0a 2020 2020 2020 2020 2222  lete..        ""
+0001f210: 220a 2020 2020 2020 2020 7061 7468 203d  ".        path =
+0001f220: 2066 2268 7562 2f73 6f75 7263 6573 2f7b   f"hub/sources/{
+0001f230: 736f 7572 6365 5f6e 616d 657d 220a 2020  source_name}".  
+0001f240: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+0001f250: 616c 6c28 6d65 7468 6f64 3d22 4445 4c45  all(method="DELE
+0001f260: 5445 222c 2070 6174 683d 7061 7468 290a  TE", path=path).
+0001f270: 0a20 2020 2064 6566 2067 6574 5f68 7562  .    def get_hub
+0001f280: 5f63 6174 616c 6f67 280a 2020 2020 2020  _catalog(.      
+0001f290: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0001f2a0: 736f 7572 6365 5f6e 616d 653a 2073 7472  source_name: str
+0001f2b0: 2c0a 2020 2020 2020 2020 7665 7273 696f  ,.        versio
+0001f2c0: 6e3a 2073 7472 203d 204e 6f6e 652c 0a20  n: str = None,. 
+0001f2d0: 2020 2020 2020 2074 6167 3a20 7374 7220         tag: str 
+0001f2e0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001f2f0: 666f 7263 655f 7265 6672 6573 683a 2062  force_refresh: b
+0001f300: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0001f310: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
+0001f320: 2020 2020 2020 2020 5265 7472 6965 7665          Retrieve
+0001f330: 2074 6865 2069 7465 6d20 6361 7461 6c6f   the item catalo
+0001f340: 6720 666f 7220 6120 7370 6563 6966 6965  g for a specifie
+0001f350: 6420 6875 6220 736f 7572 6365 2e0a 2020  d hub source..  
+0001f360: 2020 2020 2020 5468 6520 6c69 7374 206f        The list o
+0001f370: 6620 6974 656d 7320 6361 6e20 6265 2066  f items can be f
+0001f380: 696c 7465 7265 6420 6163 636f 7264 696e  iltered accordin
+0001f390: 6720 746f 2076 6172 696f 7573 2066 696c  g to various fil
+0001f3a0: 7465 7273 2c20 7573 696e 6720 6974 656d  ters, using item
+0001f3b0: 2773 206d 6574 6164 6174 6120 746f 2066  's metadata to f
+0001f3c0: 696c 7465 722e 0a0a 2020 2020 2020 2020  ilter...        
+0001f3d0: 3a70 6172 616d 2073 6f75 7263 655f 6e61  :param source_na
+0001f3e0: 6d65 3a20 4e61 6d65 206f 6620 7468 6520  me: Name of the 
+0001f3f0: 736f 7572 6365 2e0a 2020 2020 2020 2020  source..        
+0001f400: 3a70 6172 616d 2076 6572 7369 6f6e 3a20  :param version: 
+0001f410: 4669 6c74 6572 2069 7465 6d73 2061 6363  Filter items acc
+0001f420: 6f72 6469 6e67 2074 6f20 7468 6569 7220  ording to their 
+0001f430: 7665 7273 696f 6e2e 0a20 2020 2020 2020  version..       
+0001f440: 203a 7061 7261 6d20 7461 673a 2046 696c   :param tag: Fil
+0001f450: 7465 7220 6974 656d 7320 6261 7365 6420  ter items based 
+0001f460: 6f6e 2074 6167 2e0a 2020 2020 2020 2020  on tag..        
+0001f470: 3a70 6172 616d 2066 6f72 6365 5f72 6566  :param force_ref
+0001f480: 7265 7368 3a20 4d61 6b65 2074 6865 2073  resh: Make the s
+0001f490: 6572 7665 7220 6665 7463 6820 7468 6520  erver fetch the 
+0001f4a0: 6361 7461 6c6f 6720 6672 6f6d 2074 6865  catalog from the
+0001f4b0: 2061 6374 7561 6c20 6875 6220 736f 7572   actual hub sour
+0001f4c0: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+0001f4d0: 7261 7468 6572 2074 6861 6e20 7265 6c79  rather than rely
+0001f4e0: 206f 6e20 6361 6368 6564 2069 6e66 6f72   on cached infor
+0001f4f0: 6d61 7469 6f6e 2077 6869 6368 206d 6179  mation which may
+0001f500: 2065 7869 7374 2066 726f 6d20 7072 6576   exist from prev
+0001f510: 696f 7573 2067 6574 2072 6571 7565 7374  ious get request
+0001f520: 732e 2046 6f72 2065 7861 6d70 6c65 2c0a  s. For example,.
+0001f530: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+0001f540: 6865 2073 6f75 7263 6520 7761 7320 7265  he source was re
+0001f550: 2d62 7569 6c74 2c0a 2020 2020 2020 2020  -built,.        
+0001f560: 2020 2020 7468 6973 2077 696c 6c20 6d61      this will ma
+0001f570: 6b65 2074 6865 2073 6572 7665 7220 6765  ke the server ge
+0001f580: 7420 7468 6520 7570 6461 7465 6420 696e  t the updated in
+0001f590: 666f 726d 6174 696f 6e2e 2044 6566 6175  formation. Defau
+0001f5a0: 6c74 2069 7320 6060 4661 6c73 6560 602e  lt is ``False``.
+0001f5b0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0001f5c0: 733a 203a 7079 3a63 6c61 7373 3a60 7e6d  s: :py:class:`~m
+0001f5d0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001f5e0: 6d61 732e 6875 622e 4875 6243 6174 616c  mas.hub.HubCatal
+0001f5f0: 6f67 6020 6f62 6a65 6374 2c20 7768 6963  og` object, whic
+0001f600: 6820 6973 2065 7373 656e 7469 616c 6c79  h is essentially
+0001f610: 2061 206c 6973 740a 2020 2020 2020 2020   a list.        
+0001f620: 2020 2020 6f66 203a 7079 3a63 6c61 7373      of :py:class
+0001f630: 3a60 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e  :`~mlrun.common.
+0001f640: 7363 6865 6d61 732e 6875 622e 4875 6249  schemas.hub.HubI
+0001f650: 7465 6d60 2065 6e74 7269 6573 2e0a 2020  tem` entries..  
+0001f660: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001f670: 2020 7061 7468 203d 2028 6622 6875 622f    path = (f"hub/
+0001f680: 736f 7572 6365 732f 7b73 6f75 7263 655f  sources/{source_
+0001f690: 6e61 6d65 7d2f 6974 656d 7322 2c29 0a20  name}/items",). 
+0001f6a0: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+0001f6b0: 7b0a 2020 2020 2020 2020 2020 2020 2276  {.            "v
+0001f6c0: 6572 7369 6f6e 223a 2076 6572 7369 6f6e  ersion": version
+0001f6d0: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
+0001f6e0: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
+0001f6f0: 2020 2020 2020 2266 6f72 6365 2d72 6566        "force-ref
+0001f700: 7265 7368 223a 2066 6f72 6365 5f72 6566  resh": force_ref
+0001f710: 7265 7368 2c0a 2020 2020 2020 2020 7d0a  resh,.        }.
+0001f720: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+0001f730: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+0001f740: 286d 6574 686f 643d 2247 4554 222c 2070  (method="GET", p
+0001f750: 6174 683d 7061 7468 2c20 7061 7261 6d73  ath=path, params
+0001f760: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
+0001f770: 2072 6574 7572 6e20 6d6c 7275 6e2e 636f   return mlrun.co
+0001f780: 6d6d 6f6e 2e73 6368 656d 6173 2e48 7562  mmon.schemas.Hub
+0001f790: 4361 7461 6c6f 6728 2a2a 7265 7370 6f6e  Catalog(**respon
+0001f7a0: 7365 2e6a 736f 6e28 2929 0a0a 2020 2020  se.json())..    
+0001f7b0: 6465 6620 6765 745f 6875 625f 6974 656d  def get_hub_item
+0001f7c0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0001f7d0: 2020 2020 2020 2020 736f 7572 6365 5f6e          source_n
+0001f7e0: 616d 653a 2073 7472 2c0a 2020 2020 2020  ame: str,.      
+0001f7f0: 2020 6974 656d 5f6e 616d 653a 2073 7472    item_name: str
+0001f800: 2c0a 2020 2020 2020 2020 7665 7273 696f  ,.        versio
+0001f810: 6e3a 2073 7472 203d 204e 6f6e 652c 0a20  n: str = None,. 
+0001f820: 2020 2020 2020 2074 6167 3a20 7374 7220         tag: str 
+0001f830: 3d20 226c 6174 6573 7422 2c0a 2020 2020  = "latest",.    
+0001f840: 2020 2020 666f 7263 655f 7265 6672 6573      force_refres
+0001f850: 683a 2062 6f6f 6c20 3d20 4661 6c73 652c  h: bool = False,
+0001f860: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0001f870: 2222 220a 2020 2020 2020 2020 5265 7472  """.        Retr
+0001f880: 6965 7665 2061 2073 7065 6369 6669 6320  ieve a specific 
+0001f890: 6875 6220 6974 656d 2e0a 0a20 2020 2020  hub item...     
+0001f8a0: 2020 203a 7061 7261 6d20 736f 7572 6365     :param source
+0001f8b0: 5f6e 616d 653a 204e 616d 6520 6f66 2073  _name: Name of s
+0001f8c0: 6f75 7263 652e 0a20 2020 2020 2020 203a  ource..        :
+0001f8d0: 7061 7261 6d20 6974 656d 5f6e 616d 653a  param item_name:
+0001f8e0: 204e 616d 6520 6f66 2074 6865 2069 7465   Name of the ite
+0001f8f0: 6d20 746f 2072 6574 7269 6576 652c 2061  m to retrieve, a
+0001f900: 7320 6974 2061 7070 6561 7273 2069 6e20  s it appears in 
+0001f910: 7468 6520 6361 7461 6c6f 672e 0a20 2020  the catalog..   
+0001f920: 2020 2020 203a 7061 7261 6d20 7665 7273       :param vers
+0001f930: 696f 6e3a 2047 6574 2061 2073 7065 6369  ion: Get a speci
+0001f940: 6669 6320 7665 7273 696f 6e20 6f66 2074  fic version of t
+0001f950: 6865 2069 7465 6d2e 2044 6566 6175 6c74  he item. Default
+0001f960: 2069 7320 6060 4e6f 6e65 6060 2e0a 2020   is ``None``..  
+0001f970: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
+0001f980: 3a20 4765 7420 6120 7370 6563 6966 6963  : Get a specific
+0001f990: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
+0001f9a0: 6974 656d 2069 6465 6e74 6966 6965 6420  item identified 
+0001f9b0: 6279 2074 6167 2e20 4465 6661 756c 7420  by tag. Default 
+0001f9c0: 6973 2060 606c 6174 6573 7460 602e 0a20  is ``latest``.. 
+0001f9d0: 2020 2020 2020 203a 7061 7261 6d20 666f         :param fo
+0001f9e0: 7263 655f 7265 6672 6573 683a 204d 616b  rce_refresh: Mak
+0001f9f0: 6520 7468 6520 7365 7276 6572 2066 6574  e the server fet
+0001fa00: 6368 2074 6865 2069 6e66 6f72 6d61 7469  ch the informati
+0001fa10: 6f6e 2066 726f 6d20 7468 6520 6163 7475  on from the actu
+0001fa20: 616c 2068 7562 0a20 2020 2020 2020 2020  al hub.         
+0001fa30: 2020 2073 6f75 7263 652c 2072 6174 6865     source, rathe
+0001fa40: 7220 7468 616e 0a20 2020 2020 2020 2020  r than.         
+0001fa50: 2020 2072 656c 7920 6f6e 2063 6163 6865     rely on cache
+0001fa60: 6420 696e 666f 726d 6174 696f 6e2e 2044  d information. D
+0001fa70: 6566 6175 6c74 2069 7320 6060 4661 6c73  efault is ``Fals
+0001fa80: 6560 602e 0a20 2020 2020 2020 203a 7265  e``..        :re
+0001fa90: 7475 726e 733a 203a 7079 3a63 6c61 7373  turns: :py:class
+0001faa0: 3a60 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e  :`~mlrun.common.
+0001fab0: 7363 6865 6d61 732e 6875 622e 4875 6249  schemas.hub.HubI
+0001fac0: 7465 6d60 2e0a 2020 2020 2020 2020 2222  tem`..        ""
+0001fad0: 220a 2020 2020 2020 2020 7061 7468 203d  ".        path =
+0001fae0: 2028 6622 6875 622f 736f 7572 6365 732f   (f"hub/sources/
+0001faf0: 7b73 6f75 7263 655f 6e61 6d65 7d2f 6974  {source_name}/it
+0001fb00: 656d 732f 7b69 7465 6d5f 6e61 6d65 7d22  ems/{item_name}"
+0001fb10: 2c29 0a20 2020 2020 2020 2070 6172 616d  ,).        param
+0001fb20: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+0001fb30: 2020 2276 6572 7369 6f6e 223a 2076 6572    "version": ver
+0001fb40: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
+0001fb50: 2020 2274 6167 223a 2074 6167 2c0a 2020    "tag": tag,.  
+0001fb60: 2020 2020 2020 2020 2020 2266 6f72 6365            "force
+0001fb70: 2d72 6566 7265 7368 223a 2066 6f72 6365  -refresh": force
+0001fb80: 5f72 6566 7265 7368 2c0a 2020 2020 2020  _refresh,.      
+0001fb90: 2020 7d0a 2020 2020 2020 2020 7265 7370    }.        resp
+0001fba0: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
+0001fbb0: 6361 6c6c 286d 6574 686f 643d 2247 4554  call(method="GET
+0001fbc0: 222c 2070 6174 683d 7061 7468 2c20 7061  ", path=path, pa
+0001fbd0: 7261 6d73 3d70 6172 616d 7329 0a20 2020  rams=params).   
+0001fbe0: 2020 2020 2072 6574 7572 6e20 6d6c 7275       return mlru
+0001fbf0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0001fc00: 2e48 7562 4974 656d 282a 2a72 6573 706f  .HubItem(**respo
+0001fc10: 6e73 652e 6a73 6f6e 2829 290a 0a20 2020  nse.json())..   
+0001fc20: 2064 6566 2067 6574 5f68 7562 5f61 7373   def get_hub_ass
+0001fc30: 6574 280a 2020 2020 2020 2020 7365 6c66  et(.        self
+0001fc40: 2c0a 2020 2020 2020 2020 736f 7572 6365  ,.        source
+0001fc50: 5f6e 616d 653a 2073 7472 2c0a 2020 2020  _name: str,.    
+0001fc60: 2020 2020 6974 656d 5f6e 616d 653a 2073      item_name: s
+0001fc70: 7472 2c0a 2020 2020 2020 2020 6173 7365  tr,.        asse
+0001fc80: 745f 6e61 6d65 3a20 7374 722c 0a20 2020  t_name: str,.   
+0001fc90: 2020 2020 2076 6572 7369 6f6e 3a20 7374       version: st
+0001fca0: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+0001fcb0: 2020 7461 673a 2073 7472 203d 2022 6c61    tag: str = "la
+0001fcc0: 7465 7374 222c 0a20 2020 2029 3a0a 2020  test",.    ):.  
+0001fcd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001fce0: 2020 4765 7420 6875 6220 6173 7365 7420    Get hub asset 
+0001fcf0: 6672 6f6d 2069 7465 6d2e 0a0a 2020 2020  from item...    
+0001fd00: 2020 2020 3a70 6172 616d 2073 6f75 7263      :param sourc
+0001fd10: 655f 6e61 6d65 3a20 4e61 6d65 206f 6620  e_name: Name of 
+0001fd20: 736f 7572 6365 2e0a 2020 2020 2020 2020  source..        
+0001fd30: 3a70 6172 616d 2069 7465 6d5f 6e61 6d65  :param item_name
+0001fd40: 3a20 2020 4e61 6d65 206f 6620 7468 6520  :   Name of the 
+0001fd50: 6974 656d 2077 6869 6368 2068 6f6c 6473  item which holds
+0001fd60: 2074 6865 2061 7373 6574 2e0a 2020 2020   the asset..    
+0001fd70: 2020 2020 3a70 6172 616d 2061 7373 6574      :param asset
+0001fd80: 5f6e 616d 653a 2020 4e61 6d65 206f 6620  _name:  Name of 
+0001fd90: 7468 6520 6173 7365 7420 746f 2072 6574  the asset to ret
+0001fda0: 7269 6576 652e 0a20 2020 2020 2020 203a  rieve..        :
+0001fdb0: 7061 7261 6d20 7665 7273 696f 6e3a 2047  param version: G
+0001fdc0: 6574 2061 2073 7065 6369 6669 6320 7665  et a specific ve
+0001fdd0: 7273 696f 6e20 6f66 2074 6865 2069 7465  rsion of the ite
+0001fde0: 6d2e 2044 6566 6175 6c74 2069 7320 6060  m. Default is ``
+0001fdf0: 4e6f 6e65 6060 2e0a 2020 2020 2020 2020  None``..        
+0001fe00: 3a70 6172 616d 2074 6167 3a20 4765 7420  :param tag: Get 
+0001fe10: 6120 7370 6563 6966 6963 2076 6572 7369  a specific versi
+0001fe20: 6f6e 206f 6620 7468 6520 6974 656d 2069  on of the item i
+0001fe30: 6465 6e74 6966 6965 6420 6279 2074 6167  dentified by tag
+0001fe40: 2e20 4465 6661 756c 7420 6973 2060 606c  . Default is ``l
+0001fe50: 6174 6573 7460 602e 0a0a 2020 2020 2020  atest``...      
+0001fe60: 2020 3a72 6574 7572 6e3a 2068 7474 7020    :return: http 
+0001fe70: 7265 7370 6f6e 7365 2077 6974 6820 7468  response with th
+0001fe80: 6520 6173 7365 7420 696e 2074 6865 2063  e asset in the c
+0001fe90: 6f6e 7465 6e74 2061 7474 7269 6275 7465  ontent attribute
+0001fea0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001feb0: 2020 2020 2070 6174 6820 3d20 2866 2268       path = (f"h
+0001fec0: 7562 2f73 6f75 7263 6573 2f7b 736f 7572  ub/sources/{sour
+0001fed0: 6365 5f6e 616d 657d 2f69 7465 6d73 2f7b  ce_name}/items/{
+0001fee0: 6974 656d 5f6e 616d 657d 2f61 7373 6574  item_name}/asset
+0001fef0: 732f 7b61 7373 6574 5f6e 616d 657d 222c  s/{asset_name}",
+0001ff00: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
+0001ff10: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0001ff20: 2022 7665 7273 696f 6e22 3a20 7665 7273   "version": vers
+0001ff30: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0001ff40: 2022 7461 6722 3a20 7461 672c 0a20 2020   "tag": tag,.   
+0001ff50: 2020 2020 207d 0a20 2020 2020 2020 2072       }.        r
+0001ff60: 6573 706f 6e73 6520 3d20 7365 6c66 2e61  esponse = self.a
+0001ff70: 7069 5f63 616c 6c28 6d65 7468 6f64 3d22  pi_call(method="
+0001ff80: 4745 5422 2c20 7061 7468 3d70 6174 682c  GET", path=path,
+0001ff90: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
+0001ffa0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0001ffb0: 6573 706f 6e73 650a 0a20 2020 2064 6566  esponse..    def
+0001ffc0: 2076 6572 6966 795f 6175 7468 6f72 697a   verify_authoriz
+0001ffd0: 6174 696f 6e28 0a20 2020 2020 2020 2073  ation(.        s
+0001ffe0: 656c 662c 0a20 2020 2020 2020 2061 7574  elf,.        aut
+0001fff0: 686f 7269 7a61 7469 6f6e 5f76 6572 6966  horization_verif
+00020000: 6963 6174 696f 6e5f 696e 7075 743a 206d  ication_input: m
+00020010: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00020020: 6d61 732e 4175 7468 6f72 697a 6174 696f  mas.Authorizatio
+00020030: 6e56 6572 6966 6963 6174 696f 6e49 6e70  nVerificationInp
+00020040: 7574 2c0a 2020 2020 293a 0a20 2020 2020  ut,.    ):.     
+00020050: 2020 2022 2222 5665 7269 6669 6573 2061     """Verifies a
+00020060: 7574 686f 7269 7a61 7469 6f6e 2066 6f72  uthorization for
+00020070: 2074 6865 2070 726f 7669 6465 6420 6163   the provided ac
+00020080: 7469 6f6e 206f 6e20 7468 6520 7072 6f76  tion on the prov
+00020090: 6964 6564 2072 6573 6f75 7263 652e 0a0a  ided resource...
+000200a0: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
+000200b0: 7574 686f 7269 7a61 7469 6f6e 5f76 6572  uthorization_ver
+000200c0: 6966 6963 6174 696f 6e5f 696e 7075 743a  ification_input:
+000200d0: 2049 6e73 7461 6e63 6520 6f66 0a20 2020   Instance of.   
+000200e0: 2020 2020 2020 2020 203a 7079 3a63 6c61           :py:cla
+000200f0: 7373 3a60 7e6d 6c72 756e 2e63 6f6d 6d6f  ss:`~mlrun.commo
+00020100: 6e2e 7363 6865 6d61 732e 4175 7468 6f72  n.schemas.Author
+00020110: 697a 6174 696f 6e56 6572 6966 6963 6174  izationVerificat
+00020120: 696f 6e49 6e70 7574 6020 7468 6174 2069  ionInput` that i
+00020130: 6e63 6c75 6465 7320 616c 6c20 7468 6520  ncludes all the 
+00020140: 6e65 6564 6564 2070 6172 616d 6574 6572  needed parameter
+00020150: 7320 666f 720a 2020 2020 2020 2020 2020  s for.          
+00020160: 2020 7468 6520 6175 7468 2076 6572 6966    the auth verif
+00020170: 6963 6174 696f 6e0a 2020 2020 2020 2020  ication.        
+00020180: 2222 220a 2020 2020 2020 2020 6572 726f  """.        erro
+00020190: 725f 6d65 7373 6167 6520 3d20 2241 7574  r_message = "Aut
+000201a0: 686f 7269 7a61 7469 6f6e 2063 6865 636b  horization check
+000201b0: 2066 6169 6c65 6422 0a20 2020 2020 2020   failed".       
+000201c0: 2073 656c 662e 6170 695f 6361 6c6c 280a   self.api_call(.
+000201d0: 2020 2020 2020 2020 2020 2020 2250 4f53              "POS
+000201e0: 5422 2c0a 2020 2020 2020 2020 2020 2020  T",.            
+000201f0: 2261 7574 686f 7269 7a61 7469 6f6e 2f76  "authorization/v
+00020200: 6572 6966 6963 6174 696f 6e73 222c 0a20  erifications",. 
+00020210: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00020220: 5f6d 6573 7361 6765 2c0a 2020 2020 2020  _message,.      
+00020230: 2020 2020 2020 626f 6479 3d64 6963 745f        body=dict_
+00020240: 746f 5f6a 736f 6e28 6175 7468 6f72 697a  to_json(authoriz
+00020250: 6174 696f 6e5f 7665 7269 6669 6361 7469  ation_verificati
+00020260: 6f6e 5f69 6e70 7574 2e64 6963 7428 2929  on_input.dict())
+00020270: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00020280: 2064 6566 2074 7269 6767 6572 5f6d 6967   def trigger_mig
+00020290: 7261 7469 6f6e 7328 7365 6c66 2920 2d3e  rations(self) ->
+000202a0: 204f 7074 696f 6e61 6c5b 6d6c 7275 6e2e   Optional[mlrun.
+000202b0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e42  common.schemas.B
+000202c0: 6163 6b67 726f 756e 6454 6173 6b5d 3a0a  ackgroundTask]:.
+000202d0: 2020 2020 2020 2020 2222 2254 7269 6767          """Trigg
+000202e0: 6572 206d 6967 7261 7469 6f6e 7320 2877  er migrations (w
+000202f0: 696c 6c20 646f 206e 6f74 6869 6e67 2069  ill do nothing i
+00020300: 6620 6e6f 206d 6967 7261 7469 6f6e 7320  f no migrations 
+00020310: 6172 6520 6e65 6564 6564 2920 616e 6420  are needed) and 
+00020320: 7761 6974 2066 6f72 2074 6865 6d20 746f  wait for them to
+00020330: 2066 696e 6973 6820 6966 2061 6374 7561   finish if actua
+00020340: 6c6c 790a 2020 2020 2020 2020 7472 6967  lly.        trig
+00020350: 6765 7265 640a 2020 2020 2020 2020 3a72  gered.        :r
+00020360: 6574 7572 6e73 3a20 3a70 793a 636c 6173  eturns: :py:clas
+00020370: 733a 607e 6d6c 7275 6e2e 636f 6d6d 6f6e  s:`~mlrun.common
+00020380: 2e73 6368 656d 6173 2e42 6163 6b67 726f  .schemas.Backgro
+00020390: 756e 6454 6173 6b60 2e0a 2020 2020 2020  undTask`..      
+000203a0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+000203b0: 7370 6f6e 7365 203d 2073 656c 662e 6170  sponse = self.ap
+000203c0: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
+000203d0: 2020 2020 2250 4f53 5422 2c0a 2020 2020      "POST",.    
+000203e0: 2020 2020 2020 2020 226f 7065 7261 7469          "operati
+000203f0: 6f6e 732f 6d69 6772 6174 696f 6e73 222c  ons/migrations",
+00020400: 0a20 2020 2020 2020 2020 2020 2022 4661  .            "Fa
+00020410: 696c 6564 2074 7269 6767 6572 696e 6720  iled triggering 
+00020420: 6d69 6772 6174 696f 6e73 222c 0a20 2020  migrations",.   
+00020430: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
+00020440: 6620 7265 7370 6f6e 7365 2e73 7461 7475  f response.statu
+00020450: 735f 636f 6465 203d 3d20 6874 7470 2e48  s_code == http.H
+00020460: 5454 5053 7461 7475 732e 4143 4345 5054  TTPStatus.ACCEPT
+00020470: 4544 3a0a 2020 2020 2020 2020 2020 2020  ED:.            
+00020480: 6261 636b 6772 6f75 6e64 5f74 6173 6b20  background_task 
+00020490: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+000204a0: 6368 656d 6173 2e42 6163 6b67 726f 756e  chemas.Backgroun
+000204b0: 6454 6173 6b28 2a2a 7265 7370 6f6e 7365  dTask(**response
+000204c0: 2e6a 736f 6e28 2929 0a20 2020 2020 2020  .json()).       
+000204d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000204e0: 2e5f 7761 6974 5f66 6f72 5f62 6163 6b67  ._wait_for_backg
+000204f0: 726f 756e 645f 7461 736b 5f74 6f5f 7265  round_task_to_re
+00020500: 6163 685f 7465 726d 696e 616c 5f73 7461  ach_terminal_sta
+00020510: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
+00020520: 2020 2020 6261 636b 6772 6f75 6e64 5f74      background_t
+00020530: 6173 6b2e 6d65 7461 6461 7461 2e6e 616d  ask.metadata.nam
+00020540: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
+00020550: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00020560: 6f6e 650a 0a20 2020 2064 6566 2073 6574  one..    def set
+00020570: 5f72 756e 5f6e 6f74 6966 6963 6174 696f  _run_notificatio
+00020580: 6e73 280a 2020 2020 2020 2020 7365 6c66  ns(.        self
+00020590: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+000205a0: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
+000205b0: 7275 6e5f 7569 643a 2073 7472 2c0a 2020  run_uid: str,.  
+000205c0: 2020 2020 2020 6e6f 7469 6669 6361 7469        notificati
+000205d0: 6f6e 733a 2074 7970 696e 672e 4c69 7374  ons: typing.List
+000205e0: 5b6d 6c72 756e 2e6d 6f64 656c 2e4e 6f74  [mlrun.model.Not
+000205f0: 6966 6963 6174 696f 6e5d 203d 204e 6f6e  ification] = Non
+00020600: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+00020610: 2020 2222 220a 2020 2020 2020 2020 5365    """.        Se
+00020620: 7420 6e6f 7469 6669 6361 7469 6f6e 7320  t notifications 
+00020630: 6f6e 2061 2072 756e 2e20 5468 6973 2077  on a run. This w
+00020640: 696c 6c20 6f76 6572 7269 6465 2061 6e79  ill override any
+00020650: 2065 7869 7374 696e 6720 6e6f 7469 6669   existing notifi
+00020660: 6361 7469 6f6e 7320 6f6e 2074 6865 2072  cations on the r
+00020670: 756e 2e0a 2020 2020 2020 2020 3a70 6172  un..        :par
+00020680: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+00020690: 6563 7420 636f 6e74 6169 6e69 6e67 2074  ect containing t
+000206a0: 6865 2072 756e 2e0a 2020 2020 2020 2020  he run..        
+000206b0: 3a70 6172 616d 2072 756e 5f75 6964 3a20  :param run_uid: 
+000206c0: 5549 4420 6f66 2074 6865 2072 756e 2e0a  UID of the run..
+000206d0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+000206e0: 6f74 6966 6963 6174 696f 6e73 3a20 4c69  otifications: Li
+000206f0: 7374 206f 6620 6e6f 7469 6669 6361 7469  st of notificati
+00020700: 6f6e 7320 746f 2073 6574 206f 6e20 7468  ons to set on th
+00020710: 6520 7275 6e2e 2044 6566 6175 6c74 2069  e run. Default i
+00020720: 7320 616e 2065 6d70 7479 206c 6973 742e  s an empty list.
+00020730: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00020740: 2020 2020 206e 6f74 6966 6963 6174 696f       notificatio
+00020750: 6e73 203d 206e 6f74 6966 6963 6174 696f  ns = notificatio
+00020760: 6e73 206f 7220 5b5d 0a0a 2020 2020 2020  ns or []..      
+00020770: 2020 7365 6c66 2e61 7069 5f63 616c 6c28    self.api_call(
+00020780: 0a20 2020 2020 2020 2020 2020 2022 5055  .            "PU
+00020790: 5422 2c0a 2020 2020 2020 2020 2020 2020  T",.            
+000207a0: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+000207b0: 6563 747d 2f72 756e 732f 7b72 756e 5f75  ect}/runs/{run_u
+000207c0: 6964 7d2f 6e6f 7469 6669 6361 7469 6f6e  id}/notification
+000207d0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+000207e0: 6622 4661 696c 6564 2074 6f20 7365 7420  f"Failed to set 
+000207f0: 6e6f 7469 6669 6361 7469 6f6e 7320 6f6e  notifications on
+00020800: 2072 756e 2e20 7569 643d 7b72 756e 5f75   run. uid={run_u
+00020810: 6964 7d2c 2070 726f 6a65 6374 3d7b 7072  id}, project={pr
+00020820: 6f6a 6563 747d 222c 0a20 2020 2020 2020  oject}",.       
+00020830: 2020 2020 206a 736f 6e3d 7b0a 2020 2020       json={.    
+00020840: 2020 2020 2020 2020 2020 2020 226e 6f74              "not
+00020850: 6966 6963 6174 696f 6e73 223a 205b 0a20  ifications": [. 
+00020860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020870: 2020 206e 6f74 6966 6963 6174 696f 6e2e     notification.
+00020880: 746f 5f64 6963 7428 2920 666f 7220 6e6f  to_dict() for no
+00020890: 7469 6669 6361 7469 6f6e 2069 6e20 6e6f  tification in no
+000208a0: 7469 6669 6361 7469 6f6e 730a 2020 2020  tifications.    
+000208b0: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
+000208c0: 2020 2020 2020 2020 2020 207d 2c0a 2020             },.  
+000208d0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+000208e0: 2073 6574 5f73 6368 6564 756c 655f 6e6f   set_schedule_no
+000208f0: 7469 6669 6361 7469 6f6e 7328 0a20 2020  tifications(.   
+00020900: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00020910: 2020 2070 726f 6a65 6374 3a20 7374 722c     project: str,
+00020920: 0a20 2020 2020 2020 2073 6368 6564 756c  .        schedul
+00020930: 655f 6e61 6d65 3a20 7374 722c 0a20 2020  e_name: str,.   
+00020940: 2020 2020 206e 6f74 6966 6963 6174 696f       notificatio
+00020950: 6e73 3a20 7479 7069 6e67 2e4c 6973 745b  ns: typing.List[
+00020960: 6d6c 7275 6e2e 6d6f 6465 6c2e 4e6f 7469  mlrun.model.Noti
+00020970: 6669 6361 7469 6f6e 5d20 3d20 4e6f 6e65  fication] = None
+00020980: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+00020990: 2022 2222 0a20 2020 2020 2020 2053 6574   """.        Set
+000209a0: 206e 6f74 6966 6963 6174 696f 6e73 206f   notifications o
+000209b0: 6e20 6120 7363 6865 6475 6c65 2e20 5468  n a schedule. Th
+000209c0: 6973 2077 696c 6c20 6f76 6572 7269 6465  is will override
+000209d0: 2061 6e79 2065 7869 7374 696e 6720 6e6f   any existing no
+000209e0: 7469 6669 6361 7469 6f6e 7320 6f6e 2074  tifications on t
+000209f0: 6865 2073 6368 6564 756c 652e 0a20 2020  he schedule..   
+00020a00: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
+00020a10: 6563 743a 2050 726f 6a65 6374 2063 6f6e  ect: Project con
+00020a20: 7461 696e 696e 6720 7468 6520 7363 6865  taining the sche
+00020a30: 6475 6c65 2e0a 2020 2020 2020 2020 3a70  dule..        :p
+00020a40: 6172 616d 2073 6368 6564 756c 655f 6e61  aram schedule_na
+00020a50: 6d65 3a20 4e61 6d65 206f 6620 7468 6520  me: Name of the 
+00020a60: 7363 6865 6475 6c65 2e0a 2020 2020 2020  schedule..      
+00020a70: 2020 3a70 6172 616d 206e 6f74 6966 6963    :param notific
+00020a80: 6174 696f 6e73 3a20 4c69 7374 206f 6620  ations: List of 
+00020a90: 6e6f 7469 6669 6361 7469 6f6e 7320 746f  notifications to
+00020aa0: 2073 6574 206f 6e20 7468 6520 7363 6865   set on the sche
+00020ab0: 6475 6c65 2e20 4465 6661 756c 7420 6973  dule. Default is
+00020ac0: 2061 6e20 656d 7074 7920 6c69 7374 2e0a   an empty list..
+00020ad0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00020ae0: 2020 2020 6e6f 7469 6669 6361 7469 6f6e      notification
+00020af0: 7320 3d20 6e6f 7469 6669 6361 7469 6f6e  s = notification
+00020b00: 7320 6f72 205b 5d0a 0a20 2020 2020 2020  s or []..       
+00020b10: 2073 656c 662e 6170 695f 6361 6c6c 280a   self.api_call(.
+00020b20: 2020 2020 2020 2020 2020 2020 2250 5554              "PUT
+00020b30: 222c 0a20 2020 2020 2020 2020 2020 2066  ",.            f
+00020b40: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
+00020b50: 6374 7d2f 7363 6865 6475 6c65 732f 7b73  ct}/schedules/{s
+00020b60: 6368 6564 756c 655f 6e61 6d65 7d2f 6e6f  chedule_name}/no
+00020b70: 7469 6669 6361 7469 6f6e 7322 2c0a 2020  tifications",.  
+00020b80: 2020 2020 2020 2020 2020 6622 4661 696c            f"Fail
+00020b90: 6564 2074 6f20 7365 7420 6e6f 7469 6669  ed to set notifi
+00020ba0: 6361 7469 6f6e 7320 6f6e 2073 6368 6564  cations on sched
+00020bb0: 756c 652e 2073 6368 6564 756c 653d 7b73  ule. schedule={s
+00020bc0: 6368 6564 756c 655f 6e61 6d65 7d2c 2070  chedule_name}, p
+00020bd0: 726f 6a65 6374 3d7b 7072 6f6a 6563 747d  roject={project}
+00020be0: 222c 0a20 2020 2020 2020 2020 2020 206a  ",.            j
+00020bf0: 736f 6e3d 7b0a 2020 2020 2020 2020 2020  son={.          
+00020c00: 2020 2020 2020 226e 6f74 6966 6963 6174        "notificat
+00020c10: 696f 6e73 223a 205b 0a20 2020 2020 2020  ions": [.       
+00020c20: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+00020c30: 6966 6963 6174 696f 6e2e 746f 5f64 6963  ification.to_dic
+00020c40: 7428 2920 666f 7220 6e6f 7469 6669 6361  t() for notifica
+00020c50: 7469 6f6e 2069 6e20 6e6f 7469 6669 6361  tion in notifica
+00020c60: 7469 6f6e 730a 2020 2020 2020 2020 2020  tions.          
+00020c70: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
+00020c80: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00020c90: 290a 0a20 2020 2064 6566 2073 746f 7265  )..    def store
+00020ca0: 5f72 756e 5f6e 6f74 6966 6963 6174 696f  _run_notificatio
+00020cb0: 6e73 280a 2020 2020 2020 2020 7365 6c66  ns(.        self
+00020cc0: 2c0a 2020 2020 2020 2020 6e6f 7469 6669  ,.        notifi
+00020cd0: 6361 7469 6f6e 5f6f 626a 6563 7473 3a20  cation_objects: 
+00020ce0: 7479 7069 6e67 2e4c 6973 745b 6d6c 7275  typing.List[mlru
+00020cf0: 6e2e 6d6f 6465 6c2e 4e6f 7469 6669 6361  n.model.Notifica
+00020d00: 7469 6f6e 5d2c 0a20 2020 2020 2020 2072  tion],.        r
+00020d10: 756e 5f75 6964 3a20 7374 722c 0a20 2020  un_uid: str,.   
+00020d20: 2020 2020 2070 726f 6a65 6374 3a20 7374       project: st
+00020d30: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+00020d40: 2020 6d61 736b 5f70 6172 616d 733a 2062    mask_params: b
+00020d50: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
+00020d60: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00020d70: 2020 2020 2020 2046 6f72 2069 6e74 6572         For inter
+00020d80: 6e61 6c20 7573 652e 0a20 2020 2020 2020  nal use..       
+00020d90: 2054 6865 206e 6f74 6966 6963 6174 696f   The notificatio
+00020da0: 6e20 6d65 6368 616e 6973 6d20 6d61 7920  n mechanism may 
+00020db0: 7275 6e20 226c 6f63 616c 6c79 2220 666f  run "locally" fo
+00020dc0: 7220 6365 7274 6169 6e20 7275 6e74 696d  r certain runtim
+00020dd0: 6573 2e0a 2020 2020 2020 2020 486f 7765  es..        Howe
+00020de0: 7665 722c 2074 6865 2075 7064 6174 6573  ver, the updates
+00020df0: 206f 6363 7572 2069 6e20 7468 6520 4150   occur in the AP
+00020e00: 4920 736f 206e 6f74 6869 6e67 2074 6f20  I so nothing to 
+00020e10: 646f 2068 6572 652e 0a20 2020 2020 2020  do here..       
+00020e20: 2022 2222 0a20 2020 2020 2020 2070 6173   """.        pas
+00020e30: 730a 0a20 2020 2064 6566 2073 7562 6d69  s..    def submi
+00020e40: 745f 776f 726b 666c 6f77 280a 2020 2020  t_workflow(.    
+00020e50: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00020e60: 2020 7072 6f6a 6563 743a 2073 7472 2c0a    project: str,.
+00020e70: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
+00020e80: 722c 0a20 2020 2020 2020 2077 6f72 6b66  r,.        workf
+00020e90: 6c6f 775f 7370 6563 3a20 556e 696f 6e5b  low_spec: Union[
+00020ea0: 0a20 2020 2020 2020 2020 2020 206d 6c72  .            mlr
+00020eb0: 756e 2e70 726f 6a65 6374 732e 7069 7065  un.projects.pipe
+00020ec0: 6c69 6e65 732e 576f 726b 666c 6f77 5370  lines.WorkflowSp
+00020ed0: 6563 2c0a 2020 2020 2020 2020 2020 2020  ec,.            
+00020ee0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00020ef0: 656d 6173 2e57 6f72 6b66 6c6f 7753 7065  emas.WorkflowSpe
+00020f00: 632c 0a20 2020 2020 2020 2020 2020 2064  c,.            d
+00020f10: 6963 742c 0a20 2020 2020 2020 205d 2c0a  ict,.        ],.
+00020f20: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
+00020f30: 733a 204f 7074 696f 6e61 6c5b 4469 6374  s: Optional[Dict
+00020f40: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00020f50: 2020 6172 7469 6661 6374 5f70 6174 683a    artifact_path:
+00020f60: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00020f70: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
+00020f80: 6f75 7263 653a 204f 7074 696f 6e61 6c5b  ource: Optional[
+00020f90: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00020fa0: 2020 2020 2072 756e 5f6e 616d 653a 204f       run_name: O
+00020fb0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+00020fc0: 6f6e 652c 0a20 2020 2020 2020 206e 616d  one,.        nam
+00020fd0: 6573 7061 6365 3a20 4f70 7469 6f6e 616c  espace: Optional
+00020fe0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+00020ff0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00021000: 0a20 2020 2020 2020 2053 7562 6d69 7474  .        Submitt
+00021010: 696e 6720 776f 726b 666c 6f77 2066 6f72  ing workflow for
+00021020: 2061 2072 656d 6f74 6520 6578 6563 7574   a remote execut
+00021030: 696f 6e2e 0a0a 2020 2020 2020 2020 3a70  ion...        :p
+00021040: 6172 616d 2070 726f 6a65 6374 3a20 2020  aram project:   
+00021050: 2020 2020 2020 7072 6f6a 6563 7420 6e61        project na
+00021060: 6d65 0a20 2020 2020 2020 203a 7061 7261  me.        :para
+00021070: 6d20 6e61 6d65 3a20 2020 2020 2020 2020  m name:         
+00021080: 2020 2077 6f72 6b66 6c6f 7720 6e61 6d65     workflow name
+00021090: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000210a0: 776f 726b 666c 6f77 5f73 7065 633a 2020  workflow_spec:  
+000210b0: 2074 6865 2077 6f72 6b66 6c6f 7720 7370   the workflow sp
+000210c0: 6563 2074 6f20 6578 6563 7574 650a 2020  ec to execute.  
+000210d0: 2020 2020 2020 3a70 6172 616d 2061 7267        :param arg
+000210e0: 756d 656e 7473 3a20 2020 2020 2020 6172  uments:       ar
+000210f0: 6775 6d65 6e74 7320 666f 7220 7468 6520  guments for the 
+00021100: 776f 726b 666c 6f77 0a20 2020 2020 2020  workflow.       
+00021110: 203a 7061 7261 6d20 6172 7469 6661 6374   :param artifact
+00021120: 5f70 6174 683a 2020 2061 7274 6966 6163  _path:   artifac
+00021130: 7420 7461 7267 6574 2070 6174 6820 6f66  t target path of
+00021140: 2074 6865 2077 6f72 6b66 6c6f 770a 2020   the workflow.  
+00021150: 2020 2020 2020 3a70 6172 616d 2073 6f75        :param sou
+00021160: 7263 653a 2020 2020 2020 2020 2020 736f  rce:          so
+00021170: 7572 6365 2075 726c 206f 6620 7468 6520  urce url of the 
+00021180: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+00021190: 3a70 6172 616d 2072 756e 5f6e 616d 653a  :param run_name:
+000211a0: 2020 2020 2020 2020 7275 6e20 6e61 6d65          run name
+000211b0: 2074 6f20 6f76 6572 7269 6465 2074 6865   to override the
+000211c0: 2064 6566 6175 6c74 3a20 2777 6f72 6b66   default: 'workf
+000211d0: 6c6f 772d 7275 6e6e 6572 2d3c 776f 726b  low-runner-<work
+000211e0: 666c 6f77 206e 616d 653e 270a 2020 2020  flow name>'.    
+000211f0: 2020 2020 3a70 6172 616d 206e 616d 6573      :param names
+00021200: 7061 6365 3a20 2020 2020 2020 6b75 6265  pace:       kube
+00021210: 726e 6574 6573 206e 616d 6573 7061 6365  rnetes namespace
+00021220: 2069 6620 6f74 6865 7220 7468 616e 2064   if other than d
+00021230: 6566 6175 6c74 0a0a 2020 2020 2020 2020  efault..        
+00021240: 3a72 6574 7572 6e73 3a20 2020 203a 7079  :returns:    :py
+00021250: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e63  :class:`~mlrun.c
+00021260: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 576f  ommon.schemas.Wo
+00021270: 726b 666c 6f77 5265 7370 6f6e 7365 602e  rkflowResponse`.
+00021280: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00021290: 2020 2020 2069 6d61 6765 203d 2028 0a20       image = (. 
+000212a0: 2020 2020 2020 2020 2020 2077 6f72 6b66             workf
+000212b0: 6c6f 775f 7370 6563 2e69 6d61 6765 0a20  low_spec.image. 
+000212c0: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
+000212d0: 7361 7474 7228 776f 726b 666c 6f77 5f73  sattr(workflow_s
+000212e0: 7065 632c 2022 696d 6167 6522 290a 2020  pec, "image").  
+000212f0: 2020 2020 2020 2020 2020 656c 7365 2077            else w
+00021300: 6f72 6b66 6c6f 775f 7370 6563 2e67 6574  orkflow_spec.get
+00021310: 2822 696d 6167 6522 2c20 4e6f 6e65 290a  ("image", None).
+00021320: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00021330: 2020 7265 7120 3d20 7b0a 2020 2020 2020    req = {.      
+00021340: 2020 2020 2020 2261 7267 756d 656e 7473        "arguments
+00021350: 223a 2061 7267 756d 656e 7473 2c0a 2020  ": arguments,.  
+00021360: 2020 2020 2020 2020 2020 2261 7274 6966            "artif
+00021370: 6163 745f 7061 7468 223a 2061 7274 6966  act_path": artif
+00021380: 6163 745f 7061 7468 2c0a 2020 2020 2020  act_path,.      
+00021390: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
+000213a0: 736f 7572 6365 2c0a 2020 2020 2020 2020  source,.        
+000213b0: 2020 2020 2272 756e 5f6e 616d 6522 3a20      "run_name": 
+000213c0: 7275 6e5f 6e61 6d65 2c0a 2020 2020 2020  run_name,.      
+000213d0: 2020 2020 2020 226e 616d 6573 7061 6365        "namespace
+000213e0: 223a 206e 616d 6573 7061 6365 2c0a 2020  ": namespace,.  
+000213f0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00021400: 6966 2069 7369 6e73 7461 6e63 6528 776f  if isinstance(wo
+00021410: 726b 666c 6f77 5f73 7065 632c 206d 6c72  rkflow_spec, mlr
+00021420: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+00021430: 732e 576f 726b 666c 6f77 5370 6563 293a  s.WorkflowSpec):
+00021440: 0a20 2020 2020 2020 2020 2020 2072 6571  .            req
+00021450: 5b22 7370 6563 225d 203d 2077 6f72 6b66  ["spec"] = workf
+00021460: 6c6f 775f 7370 6563 2e64 6963 7428 290a  low_spec.dict().
+00021470: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+00021480: 6e73 7461 6e63 6528 776f 726b 666c 6f77  nstance(workflow
+00021490: 5f73 7065 632c 206d 6c72 756e 2e70 726f  _spec, mlrun.pro
+000214a0: 6a65 6374 732e 7069 7065 6c69 6e65 732e  jects.pipelines.
+000214b0: 576f 726b 666c 6f77 5370 6563 293a 0a20  WorkflowSpec):. 
+000214c0: 2020 2020 2020 2020 2020 2072 6571 5b22             req["
+000214d0: 7370 6563 225d 203d 2077 6f72 6b66 6c6f  spec"] = workflo
+000214e0: 775f 7370 6563 2e74 6f5f 6469 6374 2829  w_spec.to_dict()
+000214f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00021500: 2020 2020 2020 2020 2020 2072 6571 5b22             req["
+00021510: 7370 6563 225d 203d 2077 6f72 6b66 6c6f  spec"] = workflo
+00021520: 775f 7370 6563 0a20 2020 2020 2020 2072  w_spec.        r
+00021530: 6571 5b22 7370 6563 225d 5b22 696d 6167  eq["spec"]["imag
+00021540: 6522 5d20 3d20 696d 6167 650a 2020 2020  e"] = image.    
+00021550: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
+00021560: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
+00021570: 2020 2020 2020 2020 2020 2250 4f53 5422            "POST"
+00021580: 2c0a 2020 2020 2020 2020 2020 2020 6622  ,.            f"
+00021590: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
+000215a0: 747d 2f77 6f72 6b66 6c6f 7773 2f7b 6e61  t}/workflows/{na
+000215b0: 6d65 7d2f 7375 626d 6974 222c 0a20 2020  me}/submit",.   
+000215c0: 2020 2020 2020 2020 206a 736f 6e3d 7265           json=re
+000215d0: 712c 0a20 2020 2020 2020 2029 0a20 2020  q,.        ).   
+000215e0: 2020 2020 2072 6574 7572 6e20 6d6c 7275       return mlru
+000215f0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00021600: 2e57 6f72 6b66 6c6f 7752 6573 706f 6e73  .WorkflowRespons
+00021610: 6528 2a2a 7265 7370 6f6e 7365 2e6a 736f  e(**response.jso
+00021620: 6e28 2929 0a0a 2020 2020 6465 6620 6765  n())..    def ge
+00021630: 745f 776f 726b 666c 6f77 5f69 6428 0a20  t_workflow_id(. 
+00021640: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00021650: 2020 2020 2070 726f 6a65 6374 3a20 7374       project: st
+00021660: 722c 0a20 2020 2020 2020 206e 616d 653a  r,.        name:
+00021670: 2073 7472 2c0a 2020 2020 2020 2020 7275   str,.        ru
+00021680: 6e5f 6964 3a20 7374 722c 0a20 2020 2020  n_id: str,.     
+00021690: 2020 2065 6e67 696e 653a 2073 7472 203d     engine: str =
+000216a0: 2022 222c 0a20 2020 2029 3a0a 2020 2020   "",.    ):.    
+000216b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000216c0: 5265 7472 6965 7665 2077 6f72 6b66 6c6f  Retrieve workflo
+000216d0: 7720 6964 2066 726f 6d20 7468 6520 7569  w id from the ui
+000216e0: 6420 6f66 2074 6865 2077 6f72 6b66 6c6f  d of the workflo
+000216f0: 7720 7275 6e6e 6572 2e0a 0a20 2020 2020  w runner...     
+00021700: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00021710: 743a 2070 726f 6a65 6374 206e 616d 650a  t: project name.
+00021720: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+00021730: 616d 653a 2020 2020 776f 726b 666c 6f77  ame:    workflow
+00021740: 206e 616d 650a 2020 2020 2020 2020 3a70   name.        :p
+00021750: 6172 616d 2072 756e 5f69 643a 2020 7468  aram run_id:  th
+00021760: 6520 6964 206f 6620 7468 6520 776f 726b  e id of the work
+00021770: 666c 6f77 2072 756e 6e65 7220 2d20 7468  flow runner - th
+00021780: 6520 6a6f 6220 7468 6174 2072 756e 7320  e job that runs 
+00021790: 7468 6520 776f 726b 666c 6f77 0a20 2020  the workflow.   
+000217a0: 2020 2020 203a 7061 7261 6d20 656e 6769       :param engi
+000217b0: 6e65 3a20 2070 6970 656c 696e 6520 7275  ne:  pipeline ru
+000217c0: 6e6e 6572 0a0a 2020 2020 2020 2020 3a72  nner..        :r
+000217d0: 6574 7572 6e73 3a20 2020 3a70 793a 636c  eturns:   :py:cl
+000217e0: 6173 733a 607e 6d6c 7275 6e2e 636f 6d6d  ass:`~mlrun.comm
+000217f0: 6f6e 2e73 6368 656d 6173 2e47 6574 576f  on.schemas.GetWo
+00021800: 726b 666c 6f77 5265 7370 6f6e 7365 602e  rkflowResponse`.
+00021810: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00021820: 2020 2020 2070 6172 616d 7320 3d20 7b7d       params = {}
+00021830: 0a20 2020 2020 2020 2069 6620 656e 6769  .        if engi
+00021840: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00021850: 7061 7261 6d73 5b22 656e 6769 6e65 225d  params["engine"]
+00021860: 203d 2065 6e67 696e 650a 2020 2020 2020   = engine.      
+00021870: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
+00021880: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+00021890: 2020 2020 2020 2020 2247 4554 222c 0a20          "GET",. 
+000218a0: 2020 2020 2020 2020 2020 2066 2270 726f             f"pro
+000218b0: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
+000218c0: 776f 726b 666c 6f77 732f 7b6e 616d 657d  workflows/{name}
+000218d0: 2f72 756e 732f 7b72 756e 5f69 647d 222c  /runs/{run_id}",
+000218e0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+000218f0: 616d 733d 7061 7261 6d73 2c0a 2020 2020  ams=params,.    
+00021900: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+00021910: 7475 726e 206d 6c72 756e 2e63 6f6d 6d6f  turn mlrun.commo
+00021920: 6e2e 7363 6865 6d61 732e 4765 7457 6f72  n.schemas.GetWor
+00021930: 6b66 6c6f 7752 6573 706f 6e73 6528 2a2a  kflowResponse(**
+00021940: 7265 7370 6f6e 7365 2e6a 736f 6e28 2929  response.json())
+00021950: 0a0a 2020 2020 6465 6620 6c6f 6164 5f70  ..    def load_p
+00021960: 726f 6a65 6374 280a 2020 2020 2020 2020  roject(.        
+00021970: 7365 6c66 2c0a 2020 2020 2020 2020 6e61  self,.        na
+00021980: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
+00021990: 2075 726c 3a20 7374 722c 0a20 2020 2020   url: str,.     
+000219a0: 2020 2073 6563 7265 7473 3a20 4f70 7469     secrets: Opti
+000219b0: 6f6e 616c 5b44 6963 745d 203d 204e 6f6e  onal[Dict] = Non
+000219c0: 652c 0a20 2020 2020 2020 2073 6176 655f  e,.        save_
+000219d0: 7365 6372 6574 733a 2062 6f6f 6c20 3d20  secrets: bool = 
+000219e0: 5472 7565 2c0a 2020 2020 2920 2d3e 2073  True,.    ) -> s
+000219f0: 7472 3a0a 2020 2020 2020 2020 2222 220a  tr:.        """.
+00021a00: 2020 2020 2020 2020 4c6f 6164 696e 6720          Loading 
+00021a10: 6120 7072 6f6a 6563 7420 7265 6d6f 7465  a project remote
+00021a20: 6c79 2066 726f 6d20 7468 6520 6769 7665  ly from the give
+00021a30: 6e20 736f 7572 6365 2e0a 2020 2020 2020  n source..      
+00021a40: 2020 3a70 6172 616d 206e 616d 653a 2020    :param name:  
+00021a50: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
+00021a60: 7420 6e61 6d65 0a20 2020 2020 2020 203a  t name.        :
+00021a70: 7061 7261 6d20 7572 6c3a 2020 2020 2020  param url:      
+00021a80: 2020 2020 2020 2067 6974 206f 7220 7461         git or ta
+00021a90: 722e 677a 206f 7220 2e7a 6970 2073 6f75  r.gz or .zip sou
+00021aa0: 7263 6573 2061 7263 6869 7665 2070 6174  rces archive pat
+00021ab0: 6820 652e 672e 3a0a 2020 2020 2020 2020  h e.g.:.        
+00021ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ad0: 2020 2020 2020 2020 6769 743a 2f2f 6769          git://gi
+00021ae0: 7468 7562 2e63 6f6d 2f6d 6c72 756e 2f64  thub.com/mlrun/d
+00021af0: 656d 6f2d 7867 622d 7072 6f6a 6563 742e  emo-xgb-project.
+00021b00: 6769 740a 2020 2020 2020 2020 2020 2020  git.            
+00021b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021b20: 2020 2020 6874 7470 3a2f 2f6d 7973 6974      http://mysit
+00021b30: 652f 6172 6368 6976 6564 2d70 726f 6a65  e/archived-proje
+00021b40: 6374 2e7a 6970 0a20 2020 2020 2020 2020  ct.zip.         
+00021b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021b60: 2020 2020 2020 2054 6865 2067 6974 2070         The git p
+00021b70: 726f 6a65 6374 2073 686f 756c 6420 696e  roject should in
+00021b80: 636c 7564 6520 7468 6520 7072 6f6a 6563  clude the projec
+00021b90: 7420 7961 6d6c 2066 696c 652e 0a20 2020  t yaml file..   
+00021ba0: 2020 2020 203a 7061 7261 6d20 7365 6372       :param secr
+00021bb0: 6574 733a 2020 2020 2020 2020 2053 6563  ets:         Sec
+00021bc0: 7265 7473 2074 6f20 7374 6f72 6520 696e  rets to store in
+00021bd0: 2070 726f 6a65 6374 2069 6e20 6f72 6465   project in orde
+00021be0: 7220 746f 206c 6f61 6420 6974 2066 726f  r to load it fro
+00021bf0: 6d20 7468 6520 7072 6f76 6964 6564 2075  m the provided u
+00021c00: 726c 2e0a 2020 2020 2020 2020 2020 2020  rl..            
+00021c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c20: 2020 2020 466f 7220 6d6f 7265 2069 6e66      For more inf
+00021c30: 6f72 6d61 7469 6f6e 2073 6565 203a 7079  ormation see :py
+00021c40: 3a66 756e 633a 606d 6c72 756e 2e6c 6f61  :func:`mlrun.loa
+00021c50: 645f 7072 6f6a 6563 7460 2066 756e 6374  d_project` funct
+00021c60: 696f 6e2e 0a20 2020 2020 2020 203a 7061  ion..        :pa
+00021c70: 7261 6d20 7361 7665 5f73 6563 7265 7473  ram save_secrets
+00021c80: 3a20 2020 2057 6865 7468 6572 2074 6f20  :    Whether to 
+00021c90: 7374 6f72 6520 7365 6372 6574 7320 696e  store secrets in
+00021ca0: 2074 6865 206c 6f61 6465 6420 7072 6f6a   the loaded proj
+00021cb0: 6563 742e 0a20 2020 2020 2020 2020 2020  ect..           
+00021cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021cd0: 2020 2020 2053 6574 7469 6e67 2074 6f20       Setting to 
+00021ce0: 4661 6c73 6520 7769 6c6c 2063 6175 7365  False will cause
+00021cf0: 2077 6169 7469 6e67 2066 6f72 2074 6865   waiting for the
+00021d00: 2070 726f 6365 7373 2063 6f6d 706c 6574   process complet
+00021d10: 696f 6e2e 0a0a 2020 2020 2020 2020 3a72  ion...        :r
+00021d20: 6574 7572 6e73 3a20 2020 2020 2020 2020  eturns:         
+00021d30: 2020 2020 2020 5468 6520 7465 726d 696e        The termin
+00021d40: 616c 2073 7461 7465 206f 6620 6c6f 6164  al state of load
+00021d50: 2070 726f 6a65 6374 2070 726f 6365 7373   project process
+00021d60: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00021d70: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
+00021d80: 2275 726c 223a 2075 726c 7d0a 2020 2020  "url": url}.    
+00021d90: 2020 2020 626f 6479 203d 204e 6f6e 650a      body = None.
+00021da0: 2020 2020 2020 2020 6966 2073 6563 7265          if secre
+00021db0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00021dc0: 7072 6f76 6964 6572 203d 206d 6c72 756e  provider = mlrun
+00021dd0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00021de0: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
+00021df0: 6d65 2e6b 7562 6572 6e65 7465 730a 2020  me.kubernetes.  
+00021e00: 2020 2020 2020 2020 2020 7365 6372 6574            secret
+00021e10: 735f 696e 7075 7420 3d20 6d6c 7275 6e2e  s_input = mlrun.
+00021e20: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
+00021e30: 6563 7265 7473 4461 7461 280a 2020 2020  ecretsData(.    
+00021e40: 2020 2020 2020 2020 2020 2020 7072 6f76              prov
+00021e50: 6964 6572 3d70 726f 7669 6465 722c 2073  ider=provider, s
+00021e60: 6563 7265 7473 3d73 6563 7265 7473 0a20  ecrets=secrets. 
+00021e70: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00021e80: 2020 2020 2020 2020 2062 6f64 7920 3d20           body = 
+00021e90: 7365 6372 6574 735f 696e 7075 742e 6469  secrets_input.di
+00021ea0: 6374 2829 0a20 2020 2020 2020 2072 6573  ct().        res
+00021eb0: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
+00021ec0: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
+00021ed0: 2020 2022 504f 5354 222c 2066 2270 726f     "POST", f"pro
+00021ee0: 6a65 6374 732f 7b6e 616d 657d 2f6c 6f61  jects/{name}/loa
+00021ef0: 6422 2c20 7061 7261 6d73 3d70 6172 616d  d", params=param
+00021f00: 732c 2062 6f64 793d 6469 6374 5f74 6f5f  s, body=dict_to_
+00021f10: 6a73 6f6e 2862 6f64 7929 0a20 2020 2020  json(body).     
+00021f20: 2020 2029 0a20 2020 2020 2020 2072 6573     ).        res
+00021f30: 706f 6e73 6520 3d20 7265 7370 6f6e 7365  ponse = response
+00021f40: 2e6a 736f 6e28 290a 2020 2020 2020 2020  .json().        
+00021f50: 7275 6e20 3d20 6d6c 7275 6e2e 5275 6e4f  run = mlrun.RunO
+00021f60: 626a 6563 742e 6672 6f6d 5f64 6963 7428  bject.from_dict(
+00021f70: 7265 7370 6f6e 7365 5b22 6461 7461 225d  response["data"]
+00021f80: 290a 2020 2020 2020 2020 7374 6174 652c  ).        state,
+00021f90: 205f 203d 2072 756e 2e6c 6f67 7328 290a   _ = run.logs().
+00021fa0: 0a20 2020 2020 2020 2069 6620 7365 6372  .        if secr
+00021fb0: 6574 7320 616e 6420 6e6f 7420 7361 7665  ets and not save
+00021fc0: 5f73 6563 7265 7473 3a0a 2020 2020 2020  _secrets:.      
+00021fd0: 2020 2020 2020 7365 6c66 2e64 656c 6574        self.delet
+00021fe0: 655f 7072 6f6a 6563 745f 7365 6372 6574  e_project_secret
+00021ff0: 7328 7072 6f6a 6563 743d 6e61 6d65 2c20  s(project=name, 
+00022000: 7365 6372 6574 733d 6c69 7374 2873 6563  secrets=list(sec
+00022010: 7265 7473 2e6b 6579 7328 2929 290a 2020  rets.keys())).  
+00022020: 2020 2020 2020 2020 2020 6966 2073 7461            if sta
+00022030: 7465 2021 3d20 2263 6f6d 706c 6574 6564  te != "completed
+00022040: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00022050: 2020 206c 6f67 6765 722e 6572 726f 7228     logger.error(
+00022060: 224c 6f61 6420 7072 6f6a 6563 7420 7461  "Load project ta
+00022070: 736b 2066 6169 6c65 642c 2064 656c 6574  sk failed, delet
+00022080: 696e 6720 7072 6f6a 6563 7422 290a 2020  ing project").  
+00022090: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000220a0: 6c66 2e64 656c 6574 655f 7072 6f6a 6563  lf.delete_projec
+000220b0: 7428 6e61 6d65 2c20 6d6c 7275 6e2e 636f  t(name, mlrun.co
+000220c0: 6d6d 6f6e 2e73 6368 656d 6173 2e44 656c  mmon.schemas.Del
+000220d0: 6574 696f 6e53 7472 6174 6567 792e 6361  etionStrategy.ca
+000220e0: 7363 6164 6529 0a0a 2020 2020 2020 2020  scade)..        
+000220f0: 7265 7475 726e 2073 7461 7465 0a0a 0a64  return state...d
+00022100: 6566 205f 6173 5f6a 736f 6e28 6f62 6a29  ef _as_json(obj)
+00022110: 3a0a 2020 2020 666e 203d 2067 6574 6174  :.    fn = getat
+00022120: 7472 286f 626a 2c20 2274 6f5f 6a73 6f6e  tr(obj, "to_json
+00022130: 222c 204e 6f6e 6529 0a20 2020 2069 6620  ", None).    if 
+00022140: 666e 3a0a 2020 2020 2020 2020 7265 7475  fn:.        retu
+00022150: 726e 2066 6e28 290a 2020 2020 7265 7475  rn fn().    retu
+00022160: 726e 2064 6963 745f 746f 5f6a 736f 6e28  rn dict_to_json(
+00022170: 6f62 6a29 0a                             obj).
```

## mlrun/db/nopdb.py

```diff
@@ -27,29 +27,30 @@
 class NopDB(RunDBInterface):
     def __init__(self, url=None, *args, **kwargs):
         self.url = url
 
     def __getattribute__(self, attr):
         def nop(*args, **kwargs):
             env_var_message = (
-                "MLRUN_DBPATH is not set. Set this environment variable to the URL of the API "
+                "MLRUN_DBPATH is misconfigured. Set this environment variable to the URL of the API "
                 "server in order to connect"
             )
             if config.httpdb.nop_db.raise_error:
                 raise mlrun.errors.MLRunBadRequestError(env_var_message)
 
             if config.httpdb.nop_db.verbose:
                 logger.warning(
                     "Could not detect path to API server, not connected to API server!"
                 )
                 logger.warning(env_var_message)
 
             return
 
-        if attr == "connect":
+        # ignore __class__ because __getattribute__ overrides the parent class's method and it spams logs
+        if attr in ["connect", "__class__"]:
             return super().__getattribute__(attr)
         else:
             nop()
             return super().__getattribute__(attr)
 
     def connect(self, secrets=None):
         pass
@@ -89,14 +90,15 @@
         partition_by: Union[mlrun.common.schemas.RunPartitionByField, str] = None,
         rows_per_partition: int = 1,
         partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
         partition_order: Union[
             mlrun.common.schemas.OrderType, str
         ] = mlrun.common.schemas.OrderType.desc,
         max_partitions: int = 0,
+        with_notifications: bool = False,
     ):
         pass
 
     def del_run(self, uid, project="", iter=0):
         pass
 
     def del_runs(self, name="", project="", labels=None, state="", days_ago=0):
```

## mlrun/feature_store/__init__.py

```diff
@@ -49,10 +49,11 @@
     preview,
 )
 from .common import RunConfig
 from .feature_set import FeatureSet
 from .feature_vector import (
     FeatureVector,
     FixedWindowType,
+    JoinGraph,
     OfflineVectorResponse,
     OnlineVectorService,
 )
```

## mlrun/feature_store/api.py

```diff
@@ -31,15 +31,14 @@
     BaseStoreTarget,
     get_default_prefix_for_source,
     get_target_driver,
     kind_to_driver,
     validate_target_list,
     validate_target_paths_for_engine,
 )
-from ..db import RunDBError
 from ..model import DataSource, DataTargetBase
 from ..runtimes import RuntimeKinds
 from ..runtimes.function_reference import FunctionReference
 from ..serving.server import Response
 from ..utils import get_caller_globals, logger, normalize_name
 from .common import (
     RunConfig,
@@ -413,15 +412,15 @@
 
     if featureset:
         if isinstance(featureset, str):
             # need to strip store prefix from the uri
             _, stripped_name = parse_store_uri(featureset)
             try:
                 featureset = get_feature_set_by_uri(stripped_name)
-            except RunDBError as exc:
+            except mlrun.db.RunDBError as exc:
                 # TODO: this handling is needed because the generic httpdb error handling doesn't raise the correct
                 #  error class and doesn't propagate the correct message, until it solved we're manually handling this
                 #  case to give better user experience, remove this when the error handling is fixed.
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     f"{exc}. Make sure the feature set is saved in DB (call feature_set.save())"
                 )
```

## mlrun/feature_store/feature_set.py

```diff
@@ -414,24 +414,14 @@
         fullname = (
             f"{self._metadata.project or mlconf.default_project}/{self._metadata.name}"
         )
         if self._metadata.tag:
             fullname += ":" + self._metadata.tag
         return fullname
 
-    def _override_run_db(
-        self,
-        session,
-    ):
-        # Import here, since this method only runs in API context. If this import was global, client would need
-        # API requirements and would fail.
-        from ..api.api.utils import get_run_db_instance
-
-        self._run_db = get_run_db_instance(session)
-
     def _get_run_db(self):
         if self._run_db:
             return self._run_db
         else:
             return mlrun.get_run_db()
 
     def get_target_path(self, name=None):
```

## mlrun/feature_store/feature_vector.py

```diff
@@ -9,14 +9,15 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import collections
 import logging
+import typing
 from copy import copy
 from enum import Enum
 from typing import List, Union
 
 import numpy as np
 import pandas as pd
 
@@ -26,16 +27,24 @@
 from ..datastore import get_store_uri
 from ..datastore.targets import get_offline_target
 from ..feature_store.common import (
     get_feature_set_by_uri,
     parse_feature_string,
     parse_project_name_from_feature_string,
 )
-from ..features import Feature
-from ..model import DataSource, DataTarget, ModelObj, ObjectList, VersionedObjMetadata
+from ..feature_store.feature_set import FeatureSet
+from ..features import Entity, Feature
+from ..model import (
+    DataSource,
+    DataTarget,
+    ModelObj,
+    ObjectDict,
+    ObjectList,
+    VersionedObjMetadata,
+)
 from ..runtimes.function_reference import FunctionReference
 from ..serving.states import RootFlowStep
 from ..utils import StorePrefix
 
 
 class FeatureVectorSpec(ModelObj):
     def __init__(
@@ -46,25 +55,33 @@
         entity_fields=None,
         timestamp_field=None,
         graph=None,
         label_feature=None,
         with_indexes=None,
         function=None,
         analysis=None,
+        relations=None,
+        join_graph=None,
     ):
         self._graph: RootFlowStep = None
         self._entity_fields: ObjectList = None
         self._entity_source: DataSource = None
         self._function: FunctionReference = None
+        self._relations: typing.Dict[str, ObjectDict] = None
+        self._join_graph: JoinGraph = None
 
         self.description = description
         self.features: List[str] = features or []
         self.entity_source = entity_source
         self.entity_fields = entity_fields or []
         self.graph = graph
+        self.join_graph = join_graph
+        self.relations: typing.Dict[str, typing.Dict[str, Union[Entity, str]]] = (
+            relations or {}
+        )
         self.timestamp_field = timestamp_field
         self.label_feature = label_feature
         self.with_indexes = with_indexes
         self.function = function
         self.analysis = analysis or {}
 
     @property
@@ -100,14 +117,46 @@
         """reference to template graph processing function"""
         return self._function
 
     @function.setter
     def function(self, function):
         self._function = self._verify_dict(function, "function", FunctionReference)
 
+    @property
+    def relations(self) -> typing.Dict[str, ObjectDict]:
+        """feature set relations dict"""
+        return self._relations
+
+    @relations.setter
+    def relations(
+        self, relations: typing.Dict[str, typing.Dict[str, Union[Entity, str]]]
+    ):
+        temp_relations = {}
+        for fs_name, relation in relations.items():
+            for col, ent in relation.items():
+                if isinstance(ent, str):
+                    relation[col] = Entity(ent)
+            temp_relations[fs_name] = ObjectDict.from_dict(
+                {"entity": Entity}, relation, "entity"
+            )
+        self._relations = ObjectDict.from_dict(
+            {"object_dict": ObjectDict}, temp_relations, "object_dict"
+        )
+
+    @property
+    def join_graph(self):
+        return self._join_graph
+
+    @join_graph.setter
+    def join_graph(self, join_graph):
+        if join_graph is not None:
+            self._join_graph = self._verify_dict(join_graph, "join_graph", JoinGraph)
+        else:
+            self._join_graph = None
+
 
 class FeatureVectorStatus(ModelObj):
     def __init__(
         self,
         state=None,
         targets=None,
         features=None,
@@ -147,27 +196,290 @@
         return self._features
 
     @features.setter
     def features(self, features: List[Feature]):
         self._features = ObjectList.from_list(Feature, features)
 
 
+class JoinGraph(ModelObj):
+    """
+    explain here about the class
+    """
+
+    default_graph_name = "$__join_graph_fv__$"
+    first_join_type = "first"
+    _dict_fields = ["name", "first_feature_set", "steps"]
+
+    def __init__(
+        self,
+        name: str = None,
+        first_feature_set: Union[str, FeatureSet] = None,
+    ):
+        """
+        JoinGraph is a class that represents a graph of data joins between feature sets. It allows users to define
+        data joins step by step, specifying the join type for each step. The graph can be used to build a sequence of
+        joins that will be executed in order, allowing the creation of complex join operations between feature sets.
+
+
+        Example:
+        # Create a new JoinGraph and add steps for joining feature sets.
+        join_graph = JoinGraph(name="my_join_graph", first_feature_set="featureset1")
+        join_graph.inner("featureset2")
+        join_graph.left("featureset3", asof_join=True)
+
+
+        :param name:                (str, optional) The name of the join graph. If not provided,
+                                    a default name will be used.
+        :param first_feature_set:   (str or FeatureSet, optional) The first feature set to join. It can be
+                                    specified either as a string representing the name of the feature set or as a
+                                    FeatureSet object.
+        """
+        self.name = name or self.default_graph_name
+        self._steps: ObjectList = None
+        self._feature_sets = None
+        if first_feature_set:
+            self._start(first_feature_set)
+
+    def inner(self, other_operand: typing.Union[str, FeatureSet]):
+        """
+        Specifies an inner join with the given feature set
+
+        :param other_operand:       (str or FeatureSet) The name of the feature set or a FeatureSet object to join with.
+
+        :return:                    JoinGraph: The updated JoinGraph object with the specified inner join.
+        """
+        return self._join_operands(other_operand, "inner")
+
+    def outer(self, other_operand: typing.Union[str, FeatureSet]):
+        """
+        Specifies an outer join with the given feature set
+
+        :param other_operand:       (str or FeatureSet) The name of the feature set or a FeatureSet object to join with.
+        :return:                    JoinGraph: The updated JoinGraph object with the specified outer join.
+        """
+        return self._join_operands(other_operand, "outer")
+
+    def left(self, other_operand: typing.Union[str, FeatureSet], asof_join):
+        """
+        Specifies a left join with the given feature set
+
+        :param other_operand:       (str or FeatureSet) The name of the feature set or a FeatureSet object to join with.
+        :param asof_join:           (bool) A flag indicating whether to perform an as-of join.
+
+        :return:                    JoinGraph: The updated JoinGraph object with the specified left join.
+        """
+        return self._join_operands(other_operand, "left", asof_join=asof_join)
+
+    def right(self, other_operand: typing.Union[str, FeatureSet]):
+        """
+        Specifies a right join with the given feature set
+
+        :param other_operand:       (str or FeatureSet) The name of the feature set or a FeatureSet object to join with.
+
+        :return:                    JoinGraph: The updated JoinGraph object with the specified right join.
+        """
+        return self._join_operands(other_operand, "right")
+
+    def _join_operands(
+        self,
+        other_operand: typing.Union[str, FeatureSet],
+        join_type: str,
+        asof_join: bool = False,
+    ):
+        if isinstance(other_operand, FeatureSet):
+            other_operand = other_operand.metadata.name
+
+        first_key_num = len(self._steps.keys()) if self._steps else 0
+        left_last_step_name, left_all_feature_sets = (
+            self.last_step_name,
+            self.all_feature_sets_names,
+        )
+        is_first_fs = (
+            join_type == JoinGraph.first_join_type or left_all_feature_sets == self.name
+        )
+        # create_new_step
+        new_step = _JoinStep(
+            f"step_{first_key_num}",
+            left_last_step_name if not is_first_fs else "",
+            other_operand,
+            left_all_feature_sets if not is_first_fs else [],
+            other_operand,
+            join_type,
+            asof_join,
+        )
+
+        if self.steps is not None:
+            self.steps.update(new_step)
+        else:
+            self.steps = [new_step]
+        return self
+
+    def _start(self, other_operand: typing.Union[str, FeatureSet]):
+        return self._join_operands(other_operand, JoinGraph.first_join_type)
+
+    def _init_all_join_keys(self, feature_set_objects, vector):
+        for step in self.steps:
+            step.init_join_keys(feature_set_objects, vector)
+
+    @property
+    def all_feature_sets_names(self):
+        """
+         Returns a list of all feature set names included in the join graph.
+
+        :return:                    List[str]: A list of feature set names.
+        """
+        if self._steps:
+            return self._steps[-1].left_feature_set_names + [
+                self._steps[-1].right_feature_set_name
+            ]
+        else:
+            return self.name
+
+    @property
+    def last_step_name(self):
+        """
+        Returns the name of the last step in the join graph.
+
+        :return:                    str: The name of the last step.
+        """
+        if self._steps:
+            return self._steps[-1].name
+        else:
+            return self.name
+
+    @property
+    def steps(self):
+        """
+        Returns the list of join steps as ObjectList, which can be used to iterate over the steps
+        or access the properties of each step.
+        :return:                    ObjectList: The list of join steps.
+        """
+        return self._steps
+
+    @steps.setter
+    def steps(self, steps):
+        """
+         Setter for the steps property. It allows updating the join steps.
+
+        :param steps:               (List[_JoinStep]) The list of join steps.
+        """
+        self._steps = ObjectList.from_list(child_class=_JoinStep, children=steps)
+
+
+class _JoinStep(ModelObj):
+    def __init__(
+        self,
+        name: str = None,
+        left_step_name: str = None,
+        right_step_name: str = None,
+        left_feature_set_names: Union[str, List[str]] = None,
+        right_feature_set_name: str = None,
+        join_type: str = "inner",
+        asof_join: bool = False,
+    ):
+        self.name = name
+        self.left_step_name = left_step_name
+        self.right_step_name = right_step_name
+        self.left_feature_set_names = (
+            left_feature_set_names
+            if isinstance(left_feature_set_names, list)
+            else [left_feature_set_names]
+        )
+        self.right_feature_set_name = right_feature_set_name
+        self.join_type = join_type
+        self.asof_join = asof_join
+
+        self.left_keys = []
+        self.right_keys = []
+
+    def init_join_keys(
+        self,
+        feature_set_objects: ObjectList,
+        vector,
+    ):
+        self.left_keys = []
+        self.right_keys = []
+
+        if (
+            self.join_type == JoinGraph.first_join_type
+            or not self.left_feature_set_names
+        ):
+            self.left_keys = self.right_keys = list(
+                feature_set_objects[self.right_feature_set_name].spec.entities.keys()
+            )
+            self.join_type = (
+                "inner"
+                if self.join_type == JoinGraph.first_join_type
+                else self.join_type
+            )
+            return
+
+        for left_fset in self.left_feature_set_names:
+            left_keys, right_keys = self._check_relation(
+                vector.get_feature_set_relations(feature_set_objects[left_fset]),
+                list(feature_set_objects[left_fset].spec.entities),
+                feature_set_objects[self.right_feature_set_name],
+            )
+            self.left_keys.extend(left_keys)
+            self.right_keys.extend(right_keys)
+
+        if not self.left_keys:
+            raise mlrun.errors.MLRunRuntimeError(
+                f"{self.name} can't be preform due to undefined relation between "
+                f"{self.left_feature_set_names} to {self.right_feature_set_name}"
+            )
+
+    @staticmethod
+    def _check_relation(
+        relation: typing.Dict[str, Union[str, Entity]],
+        entities: List[Entity],
+        right_fset_fields,
+    ):
+        right_feature_set_entity_list = right_fset_fields.spec.entities
+
+        if all(ent in entities for ent in right_feature_set_entity_list) and len(
+            right_feature_set_entity_list
+        ) == len(entities):
+            # entities wise
+            return list(right_feature_set_entity_list.keys()), list(
+                right_feature_set_entity_list.keys()
+            )
+        curr_col_relation_list = list(
+            map(
+                lambda ent: (
+                    list(relation.keys())[list(relation.values()).index(ent)]
+                    if ent in list(relation.values())
+                    else False
+                ),
+                right_feature_set_entity_list,
+            )
+        )
+
+        if all(curr_col_relation_list):
+            # relation wise
+            return curr_col_relation_list, list(right_feature_set_entity_list.keys())
+
+        return [], []
+
+
 class FeatureVector(ModelObj):
     """Feature vector, specify selected features, their metadata and material views"""
 
     kind = mlrun.common.schemas.ObjectKind.feature_vector.value
     _dict_fields = ["kind", "metadata", "spec", "status"]
 
     def __init__(
         self,
         name=None,
         features=None,
         label_feature=None,
         description=None,
         with_indexes=None,
+        join_graph: JoinGraph = None,
+        relations: typing.Dict[str, typing.Dict[str, Union[Entity, str]]] = None,
     ):
         """Feature vector, specify selected features, their metadata and material views
 
         example::
 
             import mlrun.feature_store as fstore
             features = ["quotes.bid", "quotes.asks_sum_5h as asks_5h", "stocks.*"]
@@ -182,24 +494,38 @@
 
         :param name:           List of names of targets to delete (default: delete all ingested targets)
         :param features:       list of feature to collect to this vector.
                                 Format [<project>/]<feature_set>.<feature_name or `*`> [as <alias>]
         :param label_feature:  feature name to be used as label data
         :param description:    text description of the vector
         :param with_indexes:   whether to keep the entity and timestamp columns in the response
+        :param join_graph:     An optional JoinGraph object representing the graph of data joins
+                               between feature sets for this feature vector, specified the order and the join types.
+        :param relations:      {<feature_set name>: {<column_name>: <other entity object/name>, ...}...}
+                               An optional dictionary specifying the relations between feature sets in the
+                               feature vector. The keys of the dictionary are feature set names, and the values
+                               are dictionaries where the keys represent column names(of the feature set),
+                               and the values represent the target entities to join with.
+                               The relations provided here will take precedence over the relations that were specified
+                               on the feature sets themselves. In case a specific feature set is not mentioned as a key
+                               here, the function will fall back to using the default relations defined in the
+                               feature set.
+
         """
         self._spec: FeatureVectorSpec = None
         self._metadata = None
         self._status = None
 
         self.spec = FeatureVectorSpec(
             description=description,
             features=features,
             label_feature=label_feature,
             with_indexes=with_indexes,
+            relations=relations,
+            join_graph=join_graph,
         )
         self.metadata = VersionedObjMetadata(name=name)
         self.status = None
 
         self._entity_df = None
         self._feature_set_fields = {}
         self.feature_set_objects = {}
@@ -376,14 +702,26 @@
                     feature = feature_set.spec.features[name].copy()
                     feature.origin = f"{feature_set.fullname}.{name}"
                     self.status.features[name] = feature
 
         self.status.index_keys = index_keys
         return feature_set_objects, feature_set_fields
 
+    def get_feature_set_relations(self, feature_set: Union[str, FeatureSet]):
+        if isinstance(feature_set, str):
+            feature_set = get_feature_set_by_uri(
+                feature_set,
+                self.metadata.project,
+            )
+        name = feature_set.metadata.name
+        feature_set_relations = feature_set.spec.relations or {}
+        if self.spec.relations and name in self.spec.relations:
+            feature_set_relations = self.spec.relations[name]
+        return feature_set_relations
+
 
 class OnlineVectorService:
     """get_online_feature_service response object"""
 
     def __init__(
         self,
         vector,
```

## mlrun/feature_store/ingestion.py

```diff
@@ -274,25 +274,20 @@
     task.metadata.uid = uuid.uuid4().hex
     featureset.status.run_uri = task.metadata.uid
     featureset.save()
 
     # when running in server side we want to set the function db connection to the actual DB and not to use the httpdb
     function.set_db_connection(featureset._get_run_db())
 
-    # when running on server side there are multiple enrichments and validations to be applied on a function,
-    # auth_info is an attribute which is been added only on server side.
-    if run_config.auth_info:
-        # using from to not conflict with other mlrun imports
-        from mlrun.api.api.utils import apply_enrichment_and_validation_on_function
-
-        # apply_enrichment_and_validation_on_function is a server side function we don't want to import it on client
-        apply_enrichment_and_validation_on_function(function, run_config.auth_info)
-
     run = function.run(
-        task, schedule=schedule, local=run_config.local, watch=run_config.watch
+        task,
+        schedule=schedule,
+        local=run_config.local,
+        watch=run_config.watch,
+        auth_info=run_config.auth_info,
     )
     if run_config.watch:
         featureset.reload()
     return run
 
 
 def entities_to_index(featureset: FeatureSet, data: pd.DataFrame) -> pd.DataFrame:
```

## mlrun/feature_store/retrieval/base.py

```diff
@@ -12,21 +12,20 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import abc
 import typing
 from datetime import datetime
 
-import dask.dataframe as dd
 import pandas as pd
 
 import mlrun
 from mlrun.datastore.targets import CSVTarget, ParquetTarget
 from mlrun.feature_store.feature_set import FeatureSet
-from mlrun.feature_store.feature_vector import Feature
+from mlrun.feature_store.feature_vector import Feature, JoinGraph
 
 from ...utils import logger, str_to_timestamp
 from ..feature_vector import OfflineVectorResponse
 
 
 class BaseMerger(abc.ABC):
     """abstract feature merger class"""
@@ -38,14 +37,15 @@
     # `_order_by`, `_filter`, `_drop_columns_from_result`, `_rename_columns_and_select`, `_get_engine_df` functions.
     support_offline = False
     engine = None
 
     def __init__(self, vector, **engine_args):
         self._relation = dict()
         self._join_type = "inner"
+        self._default_join_type = "default_join"
         self.vector = vector
 
         self._result_df = None
         self._drop_columns = []
         self._index_columns = []
         self._drop_indexes = True
         self._target = None
@@ -192,29 +192,42 @@
         feature_sets = []
         dfs = []
         keys = (
             []
         )  # the struct of key is [[[],[]], ..] So that each record indicates which way the corresponding
         # featureset is connected to the previous one, and within each record the left keys are indicated in index 0
         # and the right keys in index 1, this keys will be the keys that will be used in this join
+        join_types = []
 
-        fs_link_list = self._create_linked_relation_list(
-            feature_set_objects, feature_set_fields
+        entity_rows_keys = (
+            list(entity_rows.columns) if entity_rows is not None else None
         )
+        join_graph = self._get_graph(
+            feature_set_objects, feature_set_fields, entity_rows_keys
+        )
+        if entity_rows_keys:
+            entity_rows = self._convert_entity_rows_to_engine_df(entity_rows)
+            dfs.append(entity_rows)
+            keys.append([[], []])
+            feature_sets.append(None)
+            join_types.append(None)
 
         filtered = False
-        for node in fs_link_list:
-            name = node.name
+        for step in join_graph.steps:
+            name = step.right_feature_set_name
             feature_set = feature_set_objects[name]
+            saved_columns_for_relation = list(
+                self.vector.get_feature_set_relations(feature_set).keys()
+            )
             feature_sets.append(feature_set)
             columns = feature_set_fields[name]
             self._origin_alias.update({name: alias for name, alias in columns})
             column_names = [name for name, _ in columns]
 
-            for column in node.data["save_cols"]:
+            for column in saved_columns_for_relation:
                 if column not in column_names:
                     column_names.append(column)
                     if column not in self._index_columns:
                         self._append_drop_column(column)
 
             if isinstance(timestamp_for_filtering, dict):
                 time_column = timestamp_for_filtering.get(
@@ -243,42 +256,43 @@
                 name,
                 column_names,
                 start_time if time_column else None,
                 end_time if time_column else None,
                 time_column,
             )
 
-            column_names += node.data["save_index"]
-            node.data["save_cols"] += node.data["save_index"]
             fs_entities_and_timestamp = list(feature_set.spec.entities.keys())
+            column_names += fs_entities_and_timestamp
+            saved_columns_for_relation += fs_entities_and_timestamp
             if feature_set.spec.timestamp_key:
                 column_names.append(feature_set.spec.timestamp_key)
-                node.data["save_cols"].append(feature_set.spec.timestamp_key)
+                saved_columns_for_relation.append(feature_set.spec.timestamp_key)
                 fs_entities_and_timestamp.append(feature_set.spec.timestamp_key)
 
             # rename columns to be unique for each feature set and select if needed
             rename_col_dict = {
                 column: f"{column}_{name}"
                 for column in column_names
-                if column not in node.data["save_cols"]
+                if column not in saved_columns_for_relation
             }
             df_temp = self._rename_columns_and_select(
                 df,
                 rename_col_dict,
                 columns=list(set(column_names + fs_entities_and_timestamp)),
             )
 
             if df_temp is not None:
                 df = df_temp
                 del df_temp
 
             dfs.append(df)
             del df
 
-            keys.append([node.data["left_keys"], node.data["right_keys"]])
+            keys.append([step.left_keys, step.right_keys])
+            join_types.append([step.join_type, step.asof_join])
 
             # update alias according to the unique column name
             new_columns = []
             if not self._drop_indexes:
                 new_columns.extend([(ind, ind) for ind in fs_entities_and_timestamp])
             for column, alias in columns:
                 if column in rename_col_dict:
@@ -289,39 +303,21 @@
 
         # None of the feature sets was filtered as required
         if not filtered and (start_time or end_time):
             raise mlrun.errors.MLRunRuntimeError(
                 "start_time and end_time can only be provided in conjunction with "
                 "a timestamp column, or when the at least one feature_set has a timestamp key"
             )
-        # convert pandas entity_rows to spark\dask DF if needed
-        if (
-            entity_rows is not None
-            and not hasattr(entity_rows, "rdd")
-            and self.engine == "spark"
-        ):
-            entity_rows = self.spark.createDataFrame(entity_rows)
-        elif (
-            entity_rows is not None
-            and not hasattr(entity_rows, "dask")
-            and self.engine == "dask"
-        ):
-            entity_rows = dd.from_pandas(
-                entity_rows, npartitions=len(entity_rows.columns)
-            )
-
         # join the feature data frames
         result_timestamp = self.merge(
-            entity_df=entity_rows,
-            entity_timestamp_column=entity_timestamp_column
-            if entity_rows is not None
-            else None,
+            entity_timestamp_column=entity_timestamp_column,
             featuresets=feature_sets,
             featureset_dfs=dfs,
             keys=keys,
+            join_types=join_types,
         )
 
         all_columns = None
         if not self._drop_indexes and result_timestamp:
             if result_timestamp not in self._alias.values():
                 self._update_alias(key=result_timestamp, val=result_timestamp)
             all_columns = list(self._alias.keys())
@@ -382,49 +378,54 @@
         raise NotImplementedError
 
     def _unpersist_df(self, df):
         pass
 
     def merge(
         self,
-        entity_df,
         entity_timestamp_column: str,
         featuresets: list,
         featureset_dfs: list,
         keys: list = None,
+        join_types: list = None,
     ):
         """join the entities and feature set features into a result dataframe"""
-        merged_df = entity_df
-        if entity_df is None and featureset_dfs:
-            merged_df = featureset_dfs.pop(0)
-            featureset = featuresets.pop(0)
-            if keys is not None:
-                keys.pop(0)
-            else:
-                # keys can be multiple keys on each side of the join
-                keys = [[[], []]] * len(featureset_dfs)
-            entity_timestamp_column = (
-                entity_timestamp_column or featureset.spec.timestamp_key
-            )
-        elif entity_df is not None and featureset_dfs:
-            # when `entity_rows` passed to `get_offline_features`
-            # keys[0] mention the way that `entity_rows`  joins to the first `featureset`
-            # and it can join only by the entities of the first `featureset`
-            keys[0][0] = keys[0][1] = list(featuresets[0].spec.entities.keys())
 
-        for featureset, featureset_df, lr_key in zip(featuresets, featureset_dfs, keys):
-            if featureset.spec.timestamp_key and entity_timestamp_column:
+        merged_df = featureset_dfs.pop(0)
+        featureset = featuresets.pop(0)
+        keys.pop(0)
+        join_types.pop(0)
+
+        if not entity_timestamp_column and featureset:
+            entity_timestamp_column = featureset.spec.timestamp_key
+
+        for featureset, featureset_df, lr_key, join_type in zip(
+            featuresets, featureset_dfs, keys, join_types
+        ):
+            join_type, as_of = join_type
+            if (
+                featureset.spec.timestamp_key
+                and entity_timestamp_column
+                and join_type == self._default_join_type
+            ):
                 merge_func = self._asof_join
-            else:
+            elif join_type == self._default_join_type:
+                merge_func = self._join
+            elif join_type != self._default_join_type and not as_of:
+                self._join_type = join_type
                 merge_func = self._join
+            else:
+                self._join_type = join_type
+                merge_func = self._asof_join
 
             merged_df = merge_func(
                 merged_df,
                 entity_timestamp_column,
-                featureset,
+                featureset.metadata.name,
+                featureset.spec.timestamp_key,
                 featureset_df,
                 lr_key[0],
                 lr_key[1],
             )
             entity_timestamp_column = (
                 entity_timestamp_column or featureset.spec.timestamp_key
             )
@@ -437,26 +438,28 @@
         self._result_df = merged_df
         return entity_timestamp_column
 
     def _asof_join(
         self,
         entity_df,
         entity_timestamp_column: str,
-        featureset,
+        featureset_name: str,
+        featureset_timstamp: str,
         featureset_df,
         left_keys: list,
         right_keys: list,
     ):
         raise NotImplementedError("_asof_join() operation not implemented in class")
 
     def _join(
         self,
         entity_df,
         entity_timestamp_column: str,
-        featureset,
+        featureset_name: str,
+        featureset_timestamp: str,
         featureset_df,
         left_keys: list,
         right_keys: list,
     ):
         raise NotImplementedError("_join() operation not implemented in class")
 
     def get_status(self):
@@ -476,30 +479,64 @@
         return size
 
     def to_csv(self, target_path, **kw):
         """return results as csv file"""
         size = CSVTarget(path=target_path).write_dataframe(self._result_df, **kw)
         return size
 
+    def _get_graph(
+        self, feature_set_objects, feature_set_fields, entity_rows_keys=None
+    ):
+        join_graph = self.vector.spec.join_graph
+        if not join_graph:
+            fs_link_list = self._create_linked_relation_list(
+                feature_set_objects, feature_set_fields, entity_rows_keys
+            )
+            join_graph = None
+            for i, node in enumerate(fs_link_list):
+                if node.name != self._entity_rows_node_name and join_graph is None:
+                    join_graph = JoinGraph(first_feature_set=node.name)
+                elif node.name == self._entity_rows_node_name:
+                    continue
+                else:
+                    join_graph.inner(other_operand=node.name)
+
+                last_step = join_graph.steps[-1]
+                last_step.join_type = self._default_join_type
+                last_step.left_keys = node.left_keys
+                last_step.right_keys = node.right_keys
+        else:
+            join_graph._init_all_join_keys(feature_set_objects, self.vector)
+        return join_graph
+
     class _Node:
-        def __init__(self, name: str, order: int, data=None):
+        def __init__(
+            self,
+            name: str,
+            order: int,
+            left_keys: typing.List[str] = None,
+            right_keys: typing.List[str] = None,
+        ):
             self.name = name
-            self.data = data
+            self.left_keys = left_keys if left_keys is not None else []
+            self.right_keys = right_keys if right_keys is not None else []
             # order of this feature_set in the original list
             self.order = order
             self.next = None
 
         def __repr__(self):
             return self.name
 
         def __eq__(self, other):
             return self.name == other.name
 
         def __copy__(self):
-            return BaseMerger._Node(self.name, self.order, self.data.copy())
+            return BaseMerger._Node(
+                self.name, self.order, self.left_keys, self.right_keys
+            )
 
     class _LinkedList:
         def __init__(self, head=None):
             self.head = head
             self.len = 1 if head is not None else 0
 
         def __repr__(self):
@@ -561,17 +598,14 @@
 
         def concat(self, other):
             other_iter = iter(other)
             other_head = next(other_iter)
             node = self.find_node(other_head.name)
             if node is None:
                 return
-            for col in other_head.data["save_cols"]:
-                if col not in node.data["save_cols"]:
-                    node.data["save_cols"].append(col)
             for other_node in other_iter:
                 if self.find_node(other_node.name) is None:
                     while node is not None and other_node.order > node.order:
                         node = node.next
                     if node:
                         self.add_after(node, other_node)
                     else:
@@ -583,58 +617,52 @@
     ):
         feature_set_names = list(feature_set_fields.keys())
         if len(feature_set_names) == 1 and not entity_rows_keys:
             return BaseMerger._LinkedList(
                 head=BaseMerger._Node(
                     name=feature_set_names[0],
                     order=0,
-                    data={
-                        "left_keys": [],
-                        "right_keys": [],
-                        "save_cols": [],
-                        "save_index": [],
-                    },
                 )
             )
         relation_linked_lists = []
         feature_set_entity_list_dict = {
             name: feature_set_objects[name].spec.entities for name in feature_set_names
         }
-        entity_relation_val_list = {
-            name: list(feature_set_objects[name].spec.relations.values())
+        relation_val_list = {
+            name: list(
+                self.vector.get_feature_set_relations(
+                    feature_set_objects[name]
+                ).values()
+            )
             for name in feature_set_names
         }
-        entity_relation_key_list = {
-            name: list(feature_set_objects[name].spec.relations.keys())
+        relation_key_list = {
+            name: list(
+                self.vector.get_feature_set_relations(feature_set_objects[name]).keys()
+            )
             for name in feature_set_names
         }
 
         def _create_relation(name: str, order):
             relations = BaseMerger._LinkedList()
             main_node = BaseMerger._Node(
                 name,
-                data={
-                    "left_keys": [],
-                    "right_keys": [],
-                    "save_cols": [],
-                    "save_index": [],
-                },
                 order=order,
             )
             relations.add_first(main_node)
             return relations
 
         def _build_relation(
             fs_name_in: str, name_in_order, linked_list_relation, head_order
         ):
             name_head = linked_list_relation.head.name
             feature_set_in_entity_list = feature_set_entity_list_dict[fs_name_in]
             feature_set_in_entity_list_names = list(feature_set_in_entity_list.keys())
-            entity_relation_list = entity_relation_val_list[name_head]
-            col_relation_list = entity_relation_key_list[name_head]
+            entity_relation_list = relation_val_list[name_head]
+            col_relation_list = relation_key_list[name_head]
             curr_col_relation_list = list(
                 map(
                     lambda ent: (
                         col_relation_list[entity_relation_list.index(ent)]
                         if ent in entity_relation_list
                         else False
                     ),
@@ -645,67 +673,50 @@
             if all(
                 curr_col_relation_list
             ):  # checking if feature_set have relation with feature_set_in
                 # add to the link list feature set according to the defined relation
                 linked_list_relation.add_last(
                     BaseMerger._Node(
                         fs_name_in,
-                        data={
-                            "left_keys": curr_col_relation_list,
-                            "right_keys": feature_set_in_entity_list_names,
-                            "save_cols": [],
-                            "save_index": [],
-                        },
+                        left_keys=curr_col_relation_list,
+                        right_keys=feature_set_in_entity_list_names,
                         order=name_in_order,
                     )
                 )
-                linked_list_relation.head.data["save_cols"].extend(
-                    curr_col_relation_list
-                )
             elif name_in_order > head_order and sorted(
                 feature_set_in_entity_list_names
             ) == sorted(feature_set_entity_list_dict[name_head].keys()):
                 # add to the link list feature set according to indexes match
                 keys = feature_set_in_entity_list_names
                 linked_list_relation.add_last(
                     BaseMerger._Node(
                         fs_name_in,
-                        data={
-                            "left_keys": keys,
-                            "right_keys": keys,
-                            "save_cols": [],
-                            "save_index": keys,
-                        },
+                        left_keys=keys,
+                        right_keys=keys,
                         order=name_in_order,
                     )
                 )
-                linked_list_relation.head.data["save_index"] = keys
             return linked_list_relation
 
         def _build_entity_rows_relation(entity_rows_relation, fs_name, fs_order):
             feature_set_entity_list = feature_set_entity_list_dict[fs_name]
             feature_set_entity_list_names = list(feature_set_entity_list.keys())
 
             if all([ent in entity_rows_keys for ent in feature_set_entity_list_names]):
                 # add to the link list feature set according to indexes match,
                 # only if all entities in the feature set exist in the entity rows
                 keys = feature_set_entity_list_names
                 entity_rows_relation.add_last(
                     BaseMerger._Node(
                         fs_name,
-                        data={
-                            "left_keys": keys,
-                            "right_keys": keys,
-                            "save_cols": [],
-                            "save_index": keys,
-                        },
+                        left_keys=keys,
+                        right_keys=keys,
                         order=fs_order,
                     )
                 )
-                entity_rows_relation.head.data["save_index"] = keys
 
         if entity_rows_keys is not None:
             entity_rows_linked_relation = _create_relation(
                 self._entity_rows_node_name, -1
             )
             relation_linked_lists.append(entity_rows_linked_relation)
             linked_list_len_goal = len(feature_set_objects) + 1
@@ -801,7 +812,10 @@
     def _order_by(self, order_by_active: typing.List[str]):
         """
         Order by `order_by_active` along all axis.
 
         :param order_by_active: list of names to sort by.
         """
         raise NotImplementedError
+
+    def _convert_entity_rows_to_engine_df(self, entity_rows):
+        raise NotImplementedError
```

## mlrun/feature_store/retrieval/dask_merger.py

```diff
@@ -37,65 +37,66 @@
         df = df.reset_index(drop=to_drop)
         return df
 
     def _asof_join(
         self,
         entity_df,
         entity_timestamp_column: str,
-        featureset,
-        featureset_df,
+        featureset_name: str,
+        featureset_timestamp: str,
+        featureset_df: list,
         left_keys: list,
         right_keys: list,
     ):
         def sort_partition(partition, timestamp):
             return partition.sort_values(timestamp)
 
         entity_df = entity_df.map_partitions(
             sort_partition, timestamp=entity_timestamp_column
         )
         featureset_df = featureset_df.map_partitions(
-            sort_partition, timestamp=featureset.spec.timestamp_key
+            sort_partition, timestamp=featureset_timestamp
         )
 
         merged_df = merge_asof(
             entity_df,
             featureset_df,
             left_on=entity_timestamp_column,
-            right_on=featureset.spec.timestamp_key,
+            right_on=featureset_timestamp,
             left_by=left_keys or None,
             right_by=right_keys or None,
-            suffixes=("", f"_{featureset.metadata.name}_"),
+            suffixes=("", f"_{featureset_name}_"),
         )
         for col in merged_df.columns:
-            if re.findall(f"_{featureset.metadata.name}_$", col):
+            if re.findall(f"_{featureset_name}_$", col):
                 self._append_drop_column(col)
 
         return merged_df
 
     def _join(
         self,
         entity_df,
         entity_timestamp_column: str,
-        featureset,
+        featureset_name,
+        featureset_timestamp,
         featureset_df,
         left_keys: list,
         right_keys: list,
     ):
 
-        fs_name = featureset.metadata.name
         merged_df = merge(
             entity_df,
             featureset_df,
             how=self._join_type,
             left_on=left_keys,
             right_on=right_keys,
-            suffixes=("", f"_{fs_name}_"),
+            suffixes=("", f"_{featureset_name}_"),
         )
         for col in merged_df.columns:
-            if re.findall(f"_{fs_name}_$", col):
+            if re.findall(f"_{featureset_name}_$", col):
                 self._append_drop_column(col)
         return merged_df
 
     def get_status(self):
         if self._result_df is None:
             raise RuntimeError("unexpected status, no result df")
         return "completed"
@@ -151,7 +152,13 @@
         )
 
     def _filter(self, query):
         self._result_df = self._result_df.query(query)
 
     def _order_by(self, order_by_active):
         self._result_df.sort_values(by=order_by_active)
+
+    def _convert_entity_rows_to_engine_df(self, entity_rows):
+        if entity_rows is not None and not hasattr(entity_rows, "dask"):
+            return dd.from_pandas(entity_rows, npartitions=len(entity_rows.columns))
+
+        return entity_rows
```

## mlrun/feature_store/retrieval/job.py

```diff
@@ -58,17 +58,20 @@
         if not function_ref.url:
             function_ref.code = default_code
         run_config.function = function_ref
 
     function = run_config.to_function(kind, merger.get_default_image(kind))
 
     # Avoid overriding a handler that was provided by the user
-    # The user shouldn't have to provide a handler, but we leave this option open just in case
     if not run_config.handler:
         function.with_code(body=default_code)
+    else:
+        raise mlrun.errors.MLRunInvalidArgumentError(
+            "get_offline_features does not support run_config with a handler"
+        )
 
     function.metadata.project = vector.metadata.project
     function.metadata.name = function.metadata.name or name
 
     if run_config.kind == RuntimeKinds.remotespark:
         if not spark_service:
             raise mlrun.errors.MLRunInvalidArgumentError(
```

## mlrun/feature_store/retrieval/local_merger.py

```diff
@@ -26,80 +26,77 @@
     def __init__(self, vector, **engine_args):
         super().__init__(vector, **engine_args)
 
     def _asof_join(
         self,
         entity_df,
         entity_timestamp_column: str,
-        featureset,
-        featureset_df,
+        featureset_name,
+        featureset_timstamp,
+        featureset_df: list,
         left_keys: list,
         right_keys: list,
     ):
 
-        indexes = None
-        if not right_keys:
-            indexes = list(featureset.spec.entities.keys())
         index_col_not_in_entity = "index" not in entity_df.columns
         index_col_not_in_featureset = "index" not in featureset_df.columns
         entity_df[entity_timestamp_column] = pd.to_datetime(
             entity_df[entity_timestamp_column]
         )
-        featureset_df[featureset.spec.timestamp_key] = pd.to_datetime(
-            featureset_df[featureset.spec.timestamp_key]
+        featureset_df[featureset_timstamp] = pd.to_datetime(
+            featureset_df[featureset_timstamp]
         )
         entity_df.sort_values(by=entity_timestamp_column, inplace=True)
-        featureset_df.sort_values(by=featureset.spec.timestamp_key, inplace=True)
+        featureset_df.sort_values(by=featureset_timstamp, inplace=True)
 
         merged_df = pd.merge_asof(
             entity_df,
             featureset_df,
             left_on=entity_timestamp_column,
-            right_on=featureset.spec.timestamp_key,
-            by=indexes,
+            right_on=featureset_timstamp,
             left_by=left_keys or None,
             right_by=right_keys or None,
-            suffixes=("", f"_{featureset.metadata.name}_"),
+            suffixes=("", f"_{featureset_name}_"),
         )
         for col in merged_df.columns:
-            if re.findall(f"_{featureset.metadata.name}_$", col):
+            if re.findall(f"_{featureset_name}_$", col):
                 self._append_drop_column(col)
         # Undo indexing tricks for asof merge
         # to return the correct indexes and not
         # overload `index` columns
         if (
-            indexes
-            and "index" not in indexes
+            "index" not in left_keys
+            and "index" not in right_keys
             and index_col_not_in_entity
             and index_col_not_in_featureset
             and "index" in merged_df.columns
         ):
             merged_df.drop(columns="index", inplace=True)
         return merged_df
 
     def _join(
         self,
         entity_df,
         entity_timestamp_column: str,
-        featureset,
+        featureset_name,
+        featureset_timestamp,
         featureset_df,
         left_keys: list,
         right_keys: list,
     ):
-        fs_name = featureset.metadata.name
         merged_df = pd.merge(
             entity_df,
             featureset_df,
             how=self._join_type,
             left_on=left_keys,
             right_on=right_keys,
-            suffixes=("", f"_{fs_name}_"),
+            suffixes=("", f"_{featureset_name}_"),
         )
         for col in merged_df.columns:
-            if re.findall(f"_{fs_name}_$", col):
+            if re.findall(f"_{featureset_name}_$", col):
                 self._append_drop_column(col)
         return merged_df
 
     def _create_engine_env(self):
         pass
 
     def _get_engine_df(
@@ -131,7 +128,10 @@
         self._result_df.drop(columns=self._drop_columns, inplace=True, errors="ignore")
 
     def _filter(self, query):
         self._result_df.query(query, inplace=True)
 
     def _order_by(self, order_by_active):
         self._result_df.sort_values(by=order_by_active, ignore_index=True, inplace=True)
+
+    def _convert_entity_rows_to_engine_df(self, entity_rows):
+        return entity_rows
```

## mlrun/feature_store/retrieval/spark_merger.py

```diff
@@ -37,53 +37,56 @@
     def _unpersist_df(self, df):
         df.unpersist()
 
     def _asof_join(
         self,
         entity_df,
         entity_timestamp_column: str,
-        featureset,
-        featureset_df,
+        featureset_name: str,
+        featureset_timstamp: str,
+        featureset_df: list,
         left_keys: list,
         right_keys: list,
     ):
 
         """Perform an as of join between entity and featureset.
         Join conditions:
         Args:
             entity_df (DataFrame): Spark dataframe representing the entities, to be joined with
                 the feature tables.
             entity_timestamp_column (str): Column name in entity_df which represents
                 event timestamp.
-            featureset_df (Dataframe): Spark dataframe representing the feature table.
+            featureset (Dataframe): Spark dataframe representing the feature table.
             featureset (FeatureSet): Feature set specification, which provides information on
                 how the join should be performed, such as the entity primary keys.
         Returns:
             DataFrame: Join result, which contains all the original columns from entity_df, as well
                 as all the features specified in featureset, where the feature columns will
                 be prefixed with featureset_df name.
+                :param featureset_name:
+                :param featureset_timstamp:
         """
 
         from pyspark.sql import Window
         from pyspark.sql.functions import col, monotonically_increasing_id, row_number
 
         entity_with_id = entity_df.withColumn("_row_nr", monotonically_increasing_id())
         rename_right_keys = {}
-        for key in right_keys + [featureset.spec.timestamp_key]:
+        for key in right_keys + [featureset_timstamp]:
             if key in entity_df.columns:
                 rename_right_keys[key] = f"ft__{key}"
         # get columns for projection
         projection = [
             col(col_name).alias(rename_right_keys.get(col_name, col_name))
             for col_name in featureset_df.columns
         ]
 
         aliased_featureset_df = featureset_df.select(projection)
         right_timestamp = rename_right_keys.get(
-            featureset.spec.timestamp_key, featureset.spec.timestamp_key
+            featureset_timstamp, featureset_timstamp
         )
 
         # set join conditions
         join_cond = (
             entity_with_id[entity_timestamp_column]
             >= aliased_featureset_df[right_timestamp]
         )
@@ -102,52 +105,51 @@
         window = Window.partitionBy("_row_nr").orderBy(
             col(right_timestamp).desc(),
         )
         filter_most_recent_feature_timestamp = conditional_join.withColumn(
             "_rank", row_number().over(window)
         ).filter(col("_rank") == 1)
 
-        for key in right_keys + [featureset.spec.timestamp_key]:
+        for key in right_keys + [featureset_timstamp]:
             if key in entity_df.columns + [entity_timestamp_column]:
                 filter_most_recent_feature_timestamp = (
                     filter_most_recent_feature_timestamp.drop(
                         aliased_featureset_df[f"ft__{key}"]
                     )
                 )
         return filter_most_recent_feature_timestamp.drop("_row_nr", "_rank").orderBy(
             col(entity_timestamp_column)
         )
 
     def _join(
         self,
         entity_df,
         entity_timestamp_column: str,
-        featureset,
+        featureset_name,
+        featureset_timestamp,
         featureset_df,
         left_keys: list,
         right_keys: list,
     ):
 
         """
         spark dataframes join
 
-        Args:
-        entity_df (DataFrame): Spark dataframe representing the entities, to be joined with
+        :param entity_df (DataFrame): Spark dataframe representing the entities, to be joined with
             the feature tables.
-        entity_timestamp_column (str): Column name in entity_df which represents
+        :param entity_timestamp_column (str): Column name in entity_df which represents
             event timestamp.
-        featureset_df (Dataframe): Spark dataframe representing the feature table.
-        featureset (FeatureSet): Feature set specification, which provide information on
-            how the join should be performed, such as the entity primary keys.
+        :param featureset_df (Dataframe): Spark dataframe representing the feature table.
+        :param featureset_name:
+        :param featureset_timestamp:
 
         Returns:
             DataFrame: Join result, which contains all the original columns from entity_df, as well
                 as all the features specified in featureset, where the feature columns will
                 be prefixed with featureset_df name.
-
         """
         if left_keys != right_keys:
             join_cond = [
                 entity_df[key_l] == featureset_df[key_r]
                 for key_l, key_r in zip(left_keys, right_keys)
             ]
         else:
@@ -266,7 +268,12 @@
 
     def _order_by(self, order_by_active):
         from pyspark.sql.functions import col
 
         self._result_df = self._result_df.orderBy(
             *[col(col_name).asc_nulls_last() for col_name in order_by_active]
         )
+
+    def _convert_entity_rows_to_engine_df(self, entity_rows):
+        if entity_rows is not None and not hasattr(entity_rows, "rdd"):
+            return self.spark.createDataFrame(entity_rows)
+        return entity_rows
```

## mlrun/feature_store/retrieval/storey_merger.py

```diff
@@ -37,76 +37,82 @@
     ):
         graph = self.vector.spec.graph.copy()
         start_states, default_final_state, responders = graph.check_and_process_graph(
             allow_empty=True
         )
         next = graph
 
-        fs_link_list = self._create_linked_relation_list(
+        join_graph = self._get_graph(
             feature_set_objects, feature_set_fields, entity_keys
         )
 
         all_columns = []
         save_column = []
         entity_keys = []
+        del_columns = []
         end_aliases = {}
-        for node in fs_link_list:
-            name = node.name
-            if name == self._entity_rows_node_name:
-                continue
-            featureset = feature_set_objects[name]
+        for step in join_graph.steps:
+            name = step.right_feature_set_name
+            feature_set = feature_set_objects[name]
             columns = feature_set_fields[name]
             column_names = [name for name, alias in columns]
             aliases = {name: alias for name, alias in columns if alias}
             all_columns += [aliases.get(name, name) for name in column_names]
-            for col in node.data["save_cols"]:
+            saved_columns_for_relation = list(
+                self.vector.get_feature_set_relations(feature_set).keys()
+            )
+
+            for col in saved_columns_for_relation:
                 if col not in column_names:
                     column_names.append(col)
+                    del_columns.append(col)
                 else:
                     save_column.append(col)
 
-            entity_list = node.data["right_keys"] or list(
-                featureset.spec.entities.keys()
-            )
+            entity_list = step.right_keys or list(feature_set.spec.entities.keys())
             if not entity_keys:
                 # if entity_keys not provided by the user we will set it to be the entity of the first feature set
                 entity_keys = entity_list
             end_aliases.update(
                 {
                     k: v
-                    for k, v in zip(entity_list, node.data["left_keys"])
+                    for k, v in zip(entity_list, step.left_keys)
                     if k != v and v in save_column
                 }
             )
-            mapping = {
-                k: v for k, v in zip(node.data["left_keys"], entity_list) if k != v
-            }
+            mapping = {k: v for k, v in zip(step.left_keys, entity_list) if k != v}
             if mapping:
                 next = next.to(
                     "storey.Rename",
                     f"rename-{name}",
                     mapping=mapping,
                 )
 
             next = next.to(
                 "storey.QueryByKey",
                 f"query-{name}",
                 features=column_names,
-                table=featureset.uri,
+                table=feature_set.uri,
                 key_field=entity_list,
                 aliases=aliases,
                 fixed_window_type=fixed_window_type.to_qbk_fixed_window_type(),
             )
         if end_aliases:
             # run if the user want to save a column that related to another entity
             next = next.to(
                 "storey.Rename",
                 "rename-entity-to-features",
                 mapping=end_aliases,
             )
+        if del_columns:
+            next = next.to(
+                "storey.flow.DropColumns",
+                "drop-unnecessary-columns",
+                columns=del_columns,
+            )
         for name in start_states:
             next.set_next(name)
 
         if not start_states:  # graph was empty
             next.respond()
         elif not responders and default_final_state:  # graph has clear state sequence
             graph[default_final_state].respond()
```

## mlrun/launcher/base.py

```diff
@@ -70,17 +70,17 @@
         param_file_secrets: Optional[Dict[str, str]] = None,
         notifications: Optional[List[mlrun.model.Notification]] = None,
         returns: Optional[List[Union[str, Dict[str, str]]]] = None,
     ) -> "mlrun.run.RunObject":
         """run the function from the server/client[local/remote]"""
         pass
 
-    @staticmethod
     @abc.abstractmethod
     def enrich_runtime(
+        self,
         runtime: "mlrun.runtimes.base.BaseRuntime",
         project_name: Optional[str] = "",
     ):
         pass
 
     @staticmethod
     @abc.abstractmethod
@@ -381,16 +381,16 @@
             run = mlrun.run.RunObject.from_dict(result)
             logger.info(
                 "Run execution finished",
                 status=run.status.state,
                 name=run.metadata.name,
             )
             if run.status.state in [
-                mlrun.runtimes.base.RunStates.error,
-                mlrun.runtimes.base.RunStates.aborted,
+                mlrun.runtimes.constants.RunStates.error,
+                mlrun.runtimes.constants.RunStates.aborted,
             ]:
                 if runtime._is_remote and not runtime.is_child:
                     logger.error(
                         "Run did not finish successfully",
                         state=run.status.state,
                         status=run.status.to_dict(),
                     )
```

## mlrun/launcher/client.py

```diff
@@ -27,17 +27,18 @@
 
 
 class ClientBaseLauncher(launcher.BaseLauncher, abc.ABC):
     """
     Abstract class for common code between client launchers
     """
 
-    @staticmethod
     def enrich_runtime(
-        runtime: "mlrun.runtimes.base.BaseRuntime", project_name: Optional[str] = ""
+        self,
+        runtime: "mlrun.runtimes.base.BaseRuntime",
+        project_name: Optional[str] = "",
     ):
         runtime.try_auto_mount_based_on_config()
         runtime._fill_credentials()
 
     @staticmethod
     def prepare_image_for_deploy(runtime: "mlrun.runtimes.BaseRuntime"):
         """
```

## mlrun/launcher/factory.py

```diff
@@ -7,52 +7,55 @@
 #     http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-from typing import Optional, Type
+from dependency_injector import containers, providers
 
 import mlrun.config
 import mlrun.errors
 import mlrun.launcher.base
 import mlrun.launcher.local
 import mlrun.launcher.remote
 import mlrun.utils.singleton
 
 
 class LauncherFactory(
     metaclass=mlrun.utils.singleton.AbstractSingleton,
 ):
     def __init__(self):
-        self._launcher_cls: Optional[Type[mlrun.launcher.base.BaseLauncher]] = None
+        self._launcher_container = LauncherContainer()
 
     def create_launcher(
         self, is_remote: bool, **kwargs
     ) -> mlrun.launcher.base.BaseLauncher:
         """
         Creates the appropriate launcher for the specified run.
         ServerSideLauncher - if running as API.
         ClientRemoteLauncher - if the run is remote and local was not specified.
         ClientLocalLauncher - if the run is not remote or local was specified.
 
         :param is_remote:   Whether the runtime requires remote execution.
 
         :return:            The appropriate launcher for the specified run.
         """
-        if self._launcher_cls:
-            return self._launcher_cls(**kwargs)
+        if mlrun.config.is_running_as_api():
+            return self._launcher_container.server_side_launcher(**kwargs)
 
         local = kwargs.get("local", False)
         if is_remote and not local:
-            return mlrun.launcher.remote.ClientRemoteLauncher(**kwargs)
+            return self._launcher_container.client_remote_launcher(**kwargs)
 
-        return mlrun.launcher.local.ClientLocalLauncher(**kwargs)
+        return self._launcher_container.client_local_launcher(**kwargs)
 
-    def set_launcher(self, launcher_cls: Type[mlrun.launcher.base.BaseLauncher]):
-        """
-        Launcher setter for injection of a custom launcher.
-        This allows us to override the launcher from external packages without having to import them.
-        :param launcher_cls:    The launcher class to use.
-        """
-        self._launcher_cls = launcher_cls
+
+class LauncherContainer(containers.DeclarativeContainer):
+    client_remote_launcher = providers.Factory(
+        mlrun.launcher.remote.ClientRemoteLauncher
+    )
+    client_local_launcher = providers.Factory(mlrun.launcher.local.ClientLocalLauncher)
+
+    # Provider for injection of a server side launcher.
+    # This allows us to override the launcher from external packages without having to import them.
+    server_side_launcher = providers.Factory(mlrun.launcher.base.BaseLauncher)
```

## mlrun/model_monitoring/helpers.py

```diff
@@ -10,17 +10,18 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 
+import typing
+
 import mlrun.common.model_monitoring.helpers
 import mlrun.common.schemas
-from mlrun.config import is_running_as_api
 
 
 def get_stream_path(project: str = None):
     """Get stream path from the project secret. If wasn't set, take it from the system configurations"""
 
     stream_uri = mlrun.get_secret_or_env(
         mlrun.common.schemas.model_monitoring.ProjectSecretKeys.STREAM_PATH
@@ -31,35 +32,24 @@
     )
 
     return mlrun.common.model_monitoring.helpers.parse_monitoring_stream_path(
         stream_uri=stream_uri, project=project
     )
 
 
-def get_connection_string(project: str = None):
-    """Get endpoint store connection string from the project secret.
-    If wasn't set, take it from the system configurations"""
-
-    if is_running_as_api():
-        # Running on API server side
-        import mlrun.api.crud.secrets
-        import mlrun.common.schemas
-
-        return (
-            mlrun.api.crud.secrets.Secrets().get_project_secret(
-                project=project,
-                provider=mlrun.common.schemas.secret.SecretProviderName.kubernetes,
-                allow_secrets_from_k8s=True,
-                secret_key=mlrun.common.schemas.model_monitoring.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION,
-            )
-            or mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection
-        )
-    else:
-        # Running on stream server side
-        import mlrun
-
-        return (
-            mlrun.get_secret_or_env(
-                mlrun.common.schemas.model_monitoring.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION
-            )
-            or mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection
+def get_connection_string(secret_provider: typing.Callable = None) -> str:
+    """Get endpoint store connection string from the project secret. If wasn't set, take it from the system
+    configurations.
+
+    :param secret_provider: An optional secret provider to get the connection string secret.
+
+    :return:                Valid SQL connection string.
+
+    """
+
+    return (
+        mlrun.get_secret_or_env(
+            key=mlrun.common.schemas.model_monitoring.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION,
+            secret_provider=secret_provider,
         )
+        or mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection
+    )
```

## mlrun/model_monitoring/model_monitoring_batch.py

```diff
@@ -19,14 +19,15 @@
 import os
 import re
 from enum import Enum
 from typing import Any, ClassVar, Dict, List, Optional, Tuple, Union
 
 import numpy as np
 import pandas as pd
+import v3io
 import v3io.dataplane
 import v3io_frames
 
 import mlrun.common.helpers
 import mlrun.common.model_monitoring.helpers
 import mlrun.common.schemas.model_monitoring
 import mlrun.data_types.infer
@@ -799,35 +800,45 @@
                     mlrun.common.schemas.model_monitoring.EventFieldType.UID
                 ],
                 attributes=attributes,
             )
 
             if not mlrun.mlconf.is_ce_mode():
                 # Update drift results in TSDB
-                self._update_drift_in_input_stream(
+                self._update_drift_in_v3io_tsdb(
                     endpoint_id=endpoint[
                         mlrun.common.schemas.model_monitoring.EventFieldType.UID
                     ],
                     drift_status=drift_status,
                     drift_measure=drift_measure,
                     drift_result=drift_result,
                     timestamp=timestamp,
                 )
-                logger.info(
-                    "Done updating drift measures",
+
+            else:
+                # Update drift results in Prometheus
+                self._update_drift_in_prometheus(
                     endpoint_id=endpoint[
                         mlrun.common.schemas.model_monitoring.EventFieldType.UID
                     ],
+                    drift_status=drift_status,
+                    drift_result=drift_result,
                 )
 
         except Exception as e:
             logger.error(
                 f"Exception for endpoint {endpoint[mlrun.common.schemas.model_monitoring.EventFieldType.UID]}"
             )
             self.exception = e
+        logger.info(
+            "Done updating drift measures",
+            endpoint_id=endpoint[
+                mlrun.common.schemas.model_monitoring.EventFieldType.UID
+            ],
+        )
 
     def _get_interval_range(self) -> Tuple[datetime.datetime, datetime.datetime]:
         """Getting batch interval time range"""
         minutes, hours, days = (
             self.batch_dict[
                 mlrun.common.schemas.model_monitoring.EventFieldType.MINUTES
             ],
@@ -848,15 +859,15 @@
         batch_list = re.sub(pattern, "", self.batch_dict).split(",")
         # Initialize the dictionary of batch interval ranges
         self.batch_dict = {}
         for pair in batch_list:
             pair_list = pair.split(":")
             self.batch_dict[pair_list[0]] = float(pair_list[1])
 
-    def _update_drift_in_input_stream(
+    def _update_drift_in_v3io_tsdb(
         self,
         endpoint_id: str,
         drift_status: DriftStatus,
         drift_measure: float,
         drift_result: Dict[str, Dict[str, Any]],
         timestamp: pd._libs.tslibs.timestamps.Timestamp,
     ):
@@ -916,14 +927,71 @@
             logger.warn(
                 "Could not write drift measures to TSDB",
                 err=err,
                 tsdb_path=self.tsdb_path,
                 endpoint=endpoint_id,
             )
 
+    def _update_drift_in_prometheus(
+        self,
+        endpoint_id: str,
+        drift_status: DriftStatus,
+        drift_result: Dict[str, Dict[str, Any]],
+    ):
+        """Push drift metrics to Prometheus registry. Please note that the metrics are being pushed through HTTP
+        to the monitoring stream pod that writes them into a local registry. Afterwards, Prometheus wil scrape these
+        metrics that will be available in the Grafana charts.
+
+        :param endpoint_id:   The unique id of the model endpoint.
+        :param drift_status:  Drift status result. Possible values can be found under DriftStatus enum class.
+        :param drift_result:  A dictionary that includes the drift results for each feature.
+
+
+        """
+        stream_http_path = (
+            mlrun.mlconf.model_endpoint_monitoring.default_http_sink.format(
+                project=self.project
+            )
+        )
+
+        statistical_metrics = ["hellinger_mean", "tvd_mean", "kld_mean"]
+        metrics = []
+        for metric in statistical_metrics:
+            metrics.append(
+                {
+                    mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID: endpoint_id,
+                    mlrun.common.schemas.model_monitoring.EventFieldType.METRIC: metric,
+                    mlrun.common.schemas.model_monitoring.EventFieldType.VALUE: drift_result[
+                        metric
+                    ],
+                }
+            )
+
+        http_session = mlrun.utils.HTTPSessionWithRetry(
+            retry_on_post=True,
+            verbose=True,
+        )
+
+        http_session.request(
+            method="POST",
+            url=stream_http_path + "/monitoring-batch-metrics",
+            data=json.dumps(metrics),
+        )
+
+        drift_status_dict = {
+            mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID: endpoint_id,
+            mlrun.common.schemas.model_monitoring.EventFieldType.DRIFT_STATUS: drift_status.value,
+        }
+
+        http_session.request(
+            method="POST",
+            url=stream_http_path + "/monitoring-drift-status",
+            data=json.dumps(drift_status_dict),
+        )
+
 
 def handler(context: mlrun.run.MLClientCtx):
     batch_processor = BatchProcessor(
         context=context,
         project=context.project,
     )
     batch_processor.post_init()
```

## mlrun/model_monitoring/stream_processing.py

```diff
@@ -17,16 +17,21 @@
 import json
 import os
 import typing
 
 import pandas as pd
 import storey
 
+import mlrun
 import mlrun.common.model_monitoring.helpers
+import mlrun.config
+import mlrun.datastore.targets
 import mlrun.feature_store.steps
+import mlrun.model_monitoring.prometheus
+import mlrun.utils
 import mlrun.utils.v3io_clients
 from mlrun.common.schemas.model_monitoring.constants import (
     EventFieldType,
     EventKeyMetrics,
     EventLiveStats,
     FileTargetKind,
     ModelEndpointTarget,
@@ -37,17 +42,17 @@
 
 # Stream processing code
 class EventStreamProcessor:
     def __init__(
         self,
         project: str,
         parquet_batching_max_events: int,
+        parquet_batching_timeout_secs: int,
         parquet_target: str,
         sample_window: int = 10,
-        parquet_batching_timeout_secs: int = 30 * 60,  # Default 30 minutes
         aggregate_windows: typing.Optional[typing.List[str]] = None,
         aggregate_period: str = "30s",
         model_monitoring_access_key: str = None,
     ):
         # General configurations, mainly used for the storey steps in the future serving graph
         self.project = project
         self.sample_window = sample_window
@@ -70,14 +75,16 @@
         )
 
         self.storage_options = None
         if not mlrun.mlconf.is_ce_mode():
             self._initialize_v3io_configurations(
                 model_monitoring_access_key=model_monitoring_access_key
             )
+        elif self.parquet_path.startswith("s3://"):
+            self.storage_options = mlrun.mlconf.get_s3_storage_options()
 
     def _initialize_v3io_configurations(
         self,
         tsdb_batching_max_events: int = 10,
         tsdb_batching_timeout_secs: int = 60 * 5,  # Default 5 minutes
         v3io_access_key: typing.Optional[str] = None,
         v3io_framesd: typing.Optional[str] = None,
@@ -128,48 +135,74 @@
 
     def apply_monitoring_serving_graph(self, fn):
         """
         Apply monitoring serving graph to a given serving function. The following serving graph includes about 20 steps
         of different operations that are executed on the events from the model server. Each event has
         metadata (function_uri, timestamp, class, etc.) but also inputs and predictions from the model server.
         Throughout the serving graph, the results are written to 3 different databases:
-        1. KV/SQL (steps 7-9): Stores metadata and stats about the average latency and the amount of predictions over
+        1. KV/SQL (steps 9-11): Stores metadata and stats about the average latency and the amount of predictions over
            time per endpoint. for example the amount of predictions of endpoint x in the last 5 min. This data is used
            by the monitoring dashboards in grafana. The model endpoints table also contains data on the model endpoint
            from other processes, such as current_stats that is being calculated by the monitoring batch job
            process. If the target is from type KV, then the model endpoints table can be found under
            v3io:///users/pipelines/project-name/model-endpoints/endpoints/. If the target is SQL, then the table
            is stored within the database that was defined in the provided connection string and can be found
            under mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection.
-        2. TSDB (steps 12-18): Stores live data of different key metric dictionaries in tsdb target. Results can be
-           found under v3io:///users/pipelines/project-name/model-endpoints/events/. At the moment, this part supports
-           3 different key metric dictionaries: base_metrics (average latency and predictions over time),
+        2. V3IO TSDB/Prometheus (steps 13-21): Stores live data of different key metric dictionaries in tsdb target.
+           This data is being used by the monitoring dashboards in grafana. If using V3IO TSDB (steps 13-19), results
+           can be found under  v3io:///users/pipelines/project-name/model-endpoints/events/. In that case, we generate
+           3 different key  metric dictionaries: base_metrics (average latency and predictions over time),
            endpoint_features (Prediction and feature names and values), and custom_metrics (user-defined metrics).
-           This data is also being used by the monitoring dashboards in grafana.
-        3. Parquet (steps 19-20): This Parquet file includes the required data for the model monitoring batch job
+           If using Prometheus (steps 20-21), we update metrics in the Prometheus registry that is stored in the
+           monitoring stream local memory.
+        3. Parquet (steps 22-23): This Parquet file includes the required data for the model monitoring batch job
            that run every hour by default. If defined, the parquet target path can be found under
            mlrun.mlconf.model_endpoint_monitoring.offline. Otherwise, the default parquet path is under
            mlrun.mlconf.model_endpoint_monitoring.user_space.
 
         :param fn: A serving function.
         """
 
         graph = fn.set_topology("flow")
 
-        # Step 1 - Process endpoint event: splitting into sub-events and validate event data
+        # Step 1 - Event routing based on the provided path
+        def apply_event_routing():
+            graph.add_step(
+                "EventRouting",
+                full_event=True,
+                project=self.project,
+            ).respond()
+
+        apply_event_routing()
+
+        # Step 2 - Filter out events with no '-' in path which indicates that the event is supposed to be processed
+        # through the next steps of the stream graph
+        def apply_storey_filter_stream_events():
+            # Remove none values from each event
+            graph.add_step(
+                "storey.Filter",
+                "filter_stream_event",
+                _fn="('-' not in event.path)",
+                full_event=True,
+            )
+
+        apply_storey_filter_stream_events()
+
+        # Step 3 - Process endpoint event: splitting into sub-events and validate event data
         def apply_process_endpoint_event():
             graph.add_step(
                 "ProcessEndpointEvent",
                 full_event=True,
                 project=self.project,
+                after="filter_stream_event",
             )
 
         apply_process_endpoint_event()
 
-        # Steps 2,3 - Applying Storey operations of filtering and flatten
+        # Steps 4,5 - Applying Storey operations of filtering and flatten
         def apply_storey_filter_and_flatmap():
             # Remove none values from each event
             graph.add_step(
                 "storey.Filter",
                 "filter_none",
                 _fn="(event is not None)",
                 after="ProcessEndpointEvent",
@@ -178,29 +211,29 @@
             # flatten the events
             graph.add_step(
                 "storey.FlatMap", "flatten_events", _fn="(event)", after="filter_none"
             )
 
         apply_storey_filter_and_flatmap()
 
-        # Step 4 - Validating feature names and map each feature to its value
+        # Step 6 - Validating feature names and map each feature to its value
         def apply_map_feature_names():
             graph.add_step(
                 "MapFeatureNames",
                 name="MapFeatureNames",
                 infer_columns_from_data=True,
                 project=self.project,
                 after="flatten_events",
             )
 
         apply_map_feature_names()
 
-        # Step 5 - Calculate number of predictions and average latency
+        # Step 7 - Calculate number of predictions and average latency
         def apply_storey_aggregations():
-            # Step 5.1 - Calculate number of predictions and average latency for each window (5 min and 1 hour)
+            # Step 7.1 - Calculate number of predictions for each window (5 min and 1 hour by default)
             graph.add_step(
                 class_name="storey.AggregateByKey",
                 aggregates=[
                     {
                         "name": EventFieldType.LATENCY,
                         "column": EventFieldType.LATENCY,
                         "operations": ["count", "avg"],
@@ -210,92 +243,93 @@
                 ],
                 name=EventFieldType.LATENCY,
                 after="MapFeatureNames",
                 step_name="Aggregates",
                 table=".",
                 key_field=EventFieldType.ENDPOINT_ID,
             )
-
-            # Step 5.2 - Rename the latency counter field to prediction counter
+            # Step 7.2 - Calculate average latency time for each window (5 min and 1 hour by default)
             graph.add_step(
                 class_name="storey.Rename",
                 mapping={
                     "latency_count_5m": EventLiveStats.PREDICTIONS_COUNT_5M,
                     "latency_count_1h": EventLiveStats.PREDICTIONS_COUNT_1H,
                 },
                 name="Rename",
                 after=EventFieldType.LATENCY,
             )
 
         apply_storey_aggregations()
 
-        # Step 6 - Emits the event in window size of events based on sample_window size (10 by default)
+        # Step 8 - Emits the event in window size of events based on sample_window size (10 by default)
         def apply_storey_sample_window():
             graph.add_step(
                 "storey.steps.SampleWindow",
                 name="sample",
                 after="Rename",
                 window_size=self.sample_window,
                 key=EventFieldType.ENDPOINT_ID,
             )
 
         apply_storey_sample_window()
 
-        # Steps 7-9 - KV/SQL branch
-        # Step 7 - Filter relevant keys from the event before writing the data into the database table
+        # Steps 9-11 - KV/SQL branch
+        # Step 9 - Filter relevant keys from the event before writing the data into the database table
         def apply_process_before_endpoint_update():
             graph.add_step(
                 "ProcessBeforeEndpointUpdate",
                 name="ProcessBeforeEndpointUpdate",
                 after="sample",
             )
 
         apply_process_before_endpoint_update()
 
-        # Step 8 - Write the filtered event to KV/SQL table. At this point, the serving graph updates the stats
+        # Step 10 - Write the filtered event to KV/SQL table. At this point, the serving graph updates the stats
         # about average latency and the amount of predictions over time
         def apply_update_endpoint():
             graph.add_step(
                 "UpdateEndpoint",
                 name="UpdateEndpoint",
                 after="ProcessBeforeEndpointUpdate",
                 project=self.project,
                 model_endpoint_store_target=self.model_endpoint_store_target,
             )
 
         apply_update_endpoint()
 
-        # Step 9 (only for KV target) - Apply infer_schema on the model endpoints table for generating schema file
+        # Step 11 (only for KV target) - Apply infer_schema on the model endpoints table for generating schema file
         # which will be used by Grafana monitoring dashboards
         def apply_infer_schema():
             graph.add_step(
                 "InferSchema",
                 name="InferSchema",
                 after="UpdateEndpoint",
                 v3io_framesd=self.v3io_framesd,
                 container=self.kv_container,
                 table=self.kv_path,
             )
 
         if self.model_endpoint_store_target == ModelEndpointTarget.V3IO_NOSQL:
             apply_infer_schema()
 
-        # Steps 11-18 - TSDB branch (not supported in CE environment at the moment)
-
+        # Steps 12-19 - TSDB branch (skip to Prometheus if in CE env)
+        # Steps 20-21 - Prometheus branch
         if not mlrun.mlconf.is_ce_mode():
-            # Step 11 - Before writing data to TSDB, create dictionary of 2-3 dictionaries that contains
+            # TSDB branch
+
+            # Step 12 - Before writing data to TSDB, create dictionary of 2-3 dictionaries that contains
             # stats and details about the events
             def apply_process_before_tsdb():
                 graph.add_step(
                     "ProcessBeforeTSDB", name="ProcessBeforeTSDB", after="sample"
                 )
 
             apply_process_before_tsdb()
 
-            # Steps 12-18: - Unpacked keys from each dictionary and write to TSDB target
+            # Steps 13-19: - Unpacked keys from each dictionary and write to TSDB target
             def apply_filter_and_unpacked_keys(name, keys):
                 graph.add_step(
                     "FilterAndUnpackKeys",
                     name=name,
                     after="ProcessBeforeTSDB",
                     keys=[keys],
                 )
@@ -318,29 +352,29 @@
                         EventFieldType.ENDPOINT_TYPE,
                     ],
                     max_events=self.tsdb_batching_max_events,
                     flush_after_seconds=self.tsdb_batching_timeout_secs,
                     key=EventFieldType.ENDPOINT_ID,
                 )
 
-            # Steps 12-13 - unpacked base_metrics dictionary
+            # Steps 13-14 - unpacked base_metrics dictionary
             apply_filter_and_unpacked_keys(
                 name="FilterAndUnpackKeys1",
                 keys=EventKeyMetrics.BASE_METRICS,
             )
             apply_tsdb_target(name="tsdb1", after="FilterAndUnpackKeys1")
 
-            # Steps 14-15 - unpacked endpoint_features dictionary
+            # Steps 15-16 - unpacked endpoint_features dictionary
             apply_filter_and_unpacked_keys(
                 name="FilterAndUnpackKeys2",
                 keys=EventKeyMetrics.ENDPOINT_FEATURES,
             )
             apply_tsdb_target(name="tsdb2", after="FilterAndUnpackKeys2")
 
-            # Steps 16-18 - unpacked custom_metrics dictionary. In addition, use storey.Filter remove none values
+            # Steps 17-19 - unpacked custom_metrics dictionary. In addition, use storey.Filter remove none values
             apply_filter_and_unpacked_keys(
                 name="FilterAndUnpackKeys3",
                 keys=EventKeyMetrics.CUSTOM_METRICS,
             )
 
             def apply_storey_filter():
                 graph.add_step(
@@ -348,28 +382,49 @@
                     "FilterNotNone",
                     after="FilterAndUnpackKeys3",
                     _fn="(event is not None)",
                 )
 
             apply_storey_filter()
             apply_tsdb_target(name="tsdb3", after="FilterNotNone")
+        else:
+            # Prometheus branch
+
+            # Step 20 - Increase the prediction counter by 1 and update the latency value
+            graph.add_step(
+                "IncCounter",
+                name="IncCounter",
+                after="MapFeatureNames",
+                project=self.project,
+            )
 
-        # Steps 19-20 - Parquet branch
-        # Step 19 - Filter and validate different keys before writing the data to Parquet target
+            # Step 21 - Record a sample of features and labels
+            def apply_record_features_to_prometheus():
+                graph.add_step(
+                    "RecordFeatures",
+                    name="RecordFeaturesToPrometheus",
+                    after="sample",
+                    project=self.project,
+                )
+
+            apply_record_features_to_prometheus()
+
+        # Steps 22-23 - Parquet branch
+        # Step 22 - Filter and validate different keys before writing the data to Parquet target
         def apply_process_before_parquet():
             graph.add_step(
                 "ProcessBeforeParquet",
                 name="ProcessBeforeParquet",
                 after="MapFeatureNames",
                 _fn="(event)",
             )
 
         apply_process_before_parquet()
 
-        # Step 20 - Write the Parquet target file, partitioned by key (endpoint_id) and time.
+        # Step 23 - Write the Parquet target file, partitioned by key (endpoint_id) and time.
         def apply_parquet_target():
             graph.add_step(
                 "storey.ParquetTarget",
                 name="ParquetTarget",
                 after="ProcessBeforeParquet",
                 graph_shape="cylinder",
                 path=self.parquet_path,
@@ -611,14 +666,19 @@
         self.resume_state(endpoint_id)
 
         # If error key has been found in the current event,
         # increase the error counter by 1 and raise the error description
         error = event.get("error")
         if error:
             self.error_count[endpoint_id] += 1
+            mlrun.model_monitoring.prometheus.write_errors(
+                project=self.project,
+                endpoint_id=event["endpoint_id"],
+                model_name=event["model"],
+            )
             raise mlrun.errors.MLRunInvalidArgumentError(str(error))
 
         # Validate event fields
         model_class = event.get("model_class") or event.get("class")
         timestamp = event.get("when")
         request_id = event.get("request", {}).get("id") or event.get("resp", {}).get(
             "id"
@@ -1064,14 +1124,106 @@
                 container=self.container,
                 address=self.v3io_framesd,
             ).execute(backend="kv", table=self.table, command="infer_schema")
 
         return event
 
 
+class EventRouting(mlrun.feature_store.steps.MapClass):
+    """
+    Router the event according to the configured path under event.path. Please note that this step returns the result
+    to the caller. At the moment there are several paths:
+
+    - /model-monitoring-metrics (GET): return Prometheus registry results as a text. Will be used by Prometheus client
+    to scrape the results from the monitoring stream memory.
+
+    - /monitoring-batch-metrics (POST): update the Prometheus registry with the provided statistical metrics such as the
+     statistical metrics from the monitoring batch job. Note that the event body is a list of dictionaries of different
+     metrics.
+
+    - /monitoring-drift-status (POST): update the Prometheus registry with the provided model drift status.
+
+    """
+
+    def __init__(
+        self,
+        project: str,
+        **kwargs,
+    ):
+        super().__init__(**kwargs)
+        self.project: str = project
+
+    def do(self, event):
+        if event.path == "/model-monitoring-metrics":
+            # Return a parsed Prometheus registry file
+            event.body = mlrun.model_monitoring.prometheus.get_registry()
+        elif event.path == "/monitoring-batch-metrics":
+            # Update statistical metrics
+            for event_metric in event.body:
+                mlrun.model_monitoring.prometheus.write_drift_metrics(
+                    project=self.project,
+                    endpoint_id=event_metric[EventFieldType.ENDPOINT_ID],
+                    metric=event_metric[EventFieldType.METRIC],
+                    value=event_metric[EventFieldType.VALUE],
+                )
+        elif event.path == "/monitoring-drift-status":
+            # Update drift status
+            mlrun.model_monitoring.prometheus.write_drift_status(
+                project=self.project,
+                endpoint_id=event.body[EventFieldType.ENDPOINT_ID],
+                drift_status=event.body[EventFieldType.DRIFT_STATUS],
+            )
+
+        return event
+
+
+class IncCounter(mlrun.feature_store.steps.MapClass):
+    """Increase prediction counter by 1 and update the total latency value"""
+
+    def __init__(self, project: str, **kwargs):
+        super().__init__(**kwargs)
+        self.project: str = project
+
+    def do(self, event):
+        # Compute prediction per second
+
+        mlrun.model_monitoring.prometheus.write_predictions_and_latency_metrics(
+            project=self.project,
+            endpoint_id=event[EventFieldType.ENDPOINT_ID],
+            latency=event[EventFieldType.LATENCY],
+            model_name=event[EventFieldType.MODEL],
+            endpoint_type=event[EventFieldType.ENDPOINT_TYPE],
+        )
+
+        return event
+
+
+class RecordFeatures(mlrun.feature_store.steps.MapClass):
+    """Record a sample of features and labels in Prometheus registry"""
+
+    def __init__(self, project: str, **kwargs):
+        super().__init__(**kwargs)
+        self.project: str = project
+
+    def do(self, event):
+        # Generate a dictionary of features and predictions
+        features = {
+            **event[EventFieldType.NAMED_PREDICTIONS],
+            **event[EventFieldType.NAMED_FEATURES],
+        }
+
+        mlrun.model_monitoring.prometheus.write_income_features(
+            project=self.project,
+            endpoint_id=event[EventFieldType.ENDPOINT_ID],
+            features=features,
+        )
+
+        return event
+
+
 def update_endpoint_record(
     project: str,
     endpoint_id: str,
     attributes: dict,
 ):
     model_endpoint_store = mlrun.model_monitoring.get_model_endpoint_store(
         project=project,
```

## mlrun/model_monitoring/stores/__init__.py

```diff
@@ -13,14 +13,15 @@
 # limitations under the License.
 
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
 import enum
 import typing
 
+import mlrun.common.schemas.secret
 import mlrun.errors
 
 from .model_endpoint_store import ModelEndpointStore
 
 
 class ModelEndpointStoreType(enum.Enum):
     """Enum class to handle the different store type values for saving a model endpoint record."""
@@ -29,27 +30,29 @@
     SQL = "sql"
 
     def to_endpoint_store(
         self,
         project: str,
         access_key: str = None,
         endpoint_store_connection: str = None,
+        secret_provider: typing.Callable = None,
     ) -> ModelEndpointStore:
         """
         Return a ModelEndpointStore object based on the provided enum value.
 
         :param project:                    The name of the project.
         :param access_key:                 Access key with permission to the DB table. Note that if access key is None
                                            and the endpoint target is from type KV then the access key will be
                                            retrieved from the environment variable.
         :param endpoint_store_connection: A valid connection string for model endpoint target. Contains several
                                           key-value pairs that required for the database connection.
                                           e.g. A root user with password 1234, tries to connect a schema called
                                           mlrun within a local MySQL DB instance:
                                           'mysql+pymysql://root:1234@localhost:3306/mlrun'.
+        :param secret_provider:           An optional secret provider to get the connection string secret.
 
         :return: `ModelEndpointStore` object.
 
         """
 
         if self.value == ModelEndpointStoreType.v3io_nosql.value:
             from .kv_model_endpoint_store import KVModelEndpointStore
@@ -57,49 +60,52 @@
             # Get V3IO access key from env
             access_key = access_key or mlrun.mlconf.get_v3io_access_key()
 
             return KVModelEndpointStore(project=project, access_key=access_key)
 
         # Assuming SQL store target if store type is not KV.
         # Update these lines once there are more than two store target types.
-        from mlrun.model_monitoring.helpers import get_connection_string
 
-        sql_connection_string = endpoint_store_connection or get_connection_string(
-            project=project
-        )
         from .sql_model_endpoint_store import SQLModelEndpointStore
 
         return SQLModelEndpointStore(
-            project=project, sql_connection_string=sql_connection_string
+            project=project,
+            sql_connection_string=endpoint_store_connection,
+            secret_provider=secret_provider,
         )
 
     @classmethod
     def _missing_(cls, value: typing.Any):
         """A lookup function to handle an invalid value.
         :param value: Provided enum (invalid) value.
         """
         valid_values = list(cls.__members__.keys())
         raise mlrun.errors.MLRunInvalidArgumentError(
             f"{value} is not a valid endpoint store, please choose a valid value: %{valid_values}."
         )
 
 
 def get_model_endpoint_store(
-    project: str, access_key: str = None
+    project: str,
+    access_key: str = None,
+    secret_provider: typing.Callable = None,
 ) -> ModelEndpointStore:
     """
     Getting the DB target type based on mlrun.config.model_endpoint_monitoring.store_type.
 
-    :param project:    The name of the project.
-    :param access_key: Access key with permission to the DB table.
+    :param project:         The name of the project.
+    :param access_key:      Access key with permission to the DB table.
+    :param secret_provider: An optional secret provider to get the connection string secret.
 
     :return: `ModelEndpointStore` object. Using this object, the user can apply different operations on the
              model endpoint record such as write, update, get and delete.
     """
 
     # Get store type value from ModelEndpointStoreType enum class
     model_endpoint_store_type = ModelEndpointStoreType(
         mlrun.mlconf.model_endpoint_monitoring.store_type
     )
 
     # Convert into model endpoint store target object
-    return model_endpoint_store_type.to_endpoint_store(project, access_key)
+    return model_endpoint_store_type.to_endpoint_store(
+        project=project, access_key=access_key, secret_provider=secret_provider
+    )
```

## mlrun/model_monitoring/stores/sql_model_endpoint_store.py

```diff
@@ -41,28 +41,30 @@
 
     _engine = None
 
     def __init__(
         self,
         project: str,
         sql_connection_string: str = None,
+        secret_provider: typing.Callable = None,
     ):
         """
         Initialize SQL store target object.
 
         :param project:               The name of the project.
         :param sql_connection_string: Valid connection string or a path to SQL database with model endpoints table.
+        :param secret_provider:       An optional secret provider to get the connection string secret.
         """
 
         super().__init__(project=project)
 
         self.sql_connection_string = (
             sql_connection_string
             or mlrun.model_monitoring.helpers.get_connection_string(
-                project=self.project
+                secret_provider=secret_provider
             )
         )
 
         self.table_name = (
             mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_ENDPOINTS
         )
```

## mlrun/package/packager.py

```diff
@@ -103,47 +103,45 @@
       type hint and optionally stored artifact type in the data item (in case it was packaged before), matches the
       ``PACKABLE_OBJECT_TYPE`` to the type hint given (same logic as IDE matchups, meaning subclasses considered as
       unpackable) and checks if the artifact type is in the returned supported artifacts list from
       ``get_supported_artifact_types``.
 
     Preferably, each packager should handle a single type of object.
 
-    Linking Artifacts (extra data)
-    ------------------------------
+    **Linking Artifacts (extra data)**
 
     In order to link between packages (using the extra data or metrics spec attributes of an artifact), you should use
     the key as if it exists and as value ellipses (...). The manager will link all packages once it is done packing.
 
     For example, given extra data keys in the log hint as `extra_data`, setting them to an artifact should be::
 
         artifact = Artifact(key="my_artifact")
         artifact.spec.extra_data = {key: ... for key in extra_data}
 
-    Clearing Outputs
-    ----------------
+    **Clearing Outputs**
 
     Some of the packagers may produce files and temporary directories that should be deleted once done with logging the
     artifact. The packager can mark paths of files and directories to delete after logging using the class method
     ``future_clear``.
 
     For example, in the following packager's ``pack`` method we can write a text file, create an Artifact and then mark
     the text file to be deleted once the artifact is logged::
 
         with open("./some_file.txt", "w") as file:
             file.write("Pack me")
         artifact = Artifact(key="my_artifact")
-        cls.future_clear(path="./some_file.txt")
+        cls.add_future_clearing_path(path="./some_file.txt")
         return artifact, None
     """
 
-    # The type of object this packager can pack and unpack:
+    #: The type of object this packager can pack and unpack.
     PACKABLE_OBJECT_TYPE: Type = ...
 
-    # The priority of this packager in the packagers collection of the manager (lower is better)
-    PRIORITY = ...
+    #: The priority of this packager in the packagers collection of the manager (lower is better).
+    PRIORITY: int = ...
 
     # List of all paths to be deleted by the manager of this packager post logging the packages:
     _CLEARING_PATH_LIST: List[str] = []
 
     @classmethod
     @abstractmethod
     def get_default_packing_artifact_type(cls, obj: Any) -> str:
```

## mlrun/package/packagers/default_packager.py

```diff
@@ -12,24 +12,131 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import inspect
 from types import MethodType
 from typing import Any, List, Tuple, Type, Union
 
+import docstring_parser
+
 from mlrun.artifacts import Artifact
 from mlrun.datastore import DataItem
 from mlrun.utils import logger
 
 from ..errors import MLRunPackagePackingError, MLRunPackageUnpackingError
-from ..packager import Packager
+from ..packager import Packager, _PackagerMeta
 from ..utils import DEFAULT_PICKLE_MODULE, ArtifactType, Pickler, TypeHintUtils
 
 
-class DefaultPackager(Packager):
+class _DefaultPackagerMeta(_PackagerMeta):
+    """
+    Metaclass for `DefaultPackager` to override `__doc__` attribute into a class property. This way sphinx will get a
+    dynamically generated docstring that will include a summary of the packager.
+    """
+
+    def __new__(mcls, name: str, bases: tuple, namespace: dict, **kwargs):
+        """
+        Create a new DefaultPackager metaclass that saves the original packager docstring to another attribute named
+        `_packager_doc`.
+
+        :param name:      A string representing the name of the class being instantiated.
+        :param bases:     A tuple of classes from which the class will inherit.
+        :param namespace: The namespace of the class holding its attributes (from here the docstring will be taken).
+        """
+        # Save the original doc string to a separate class variable as it will be overriden later on by the metaclass
+        # property `__doc__`:
+        namespace["_packager_doc"] = namespace.get("__doc__", "")
+
+        # Continue creating the metaclass:
+        return super().__new__(mcls, name, bases, namespace, **kwargs)
+
+    @property
+    def __doc__(cls) -> str:
+        """
+        Override the `__doc__` attribute of a `DefaultPackager` to be a property in order to auto-summarize the
+        packager's class docstring. The summary is concatenated after the original class doc string.
+
+        The summary will be in the following structure:
+
+        <cls._packager_doc>
+
+        .. rubric:: Packager Summary
+
+        **Packing Type**: ``<cls.PACKABLE_OBJECT_TYPE>``
+
+        **Packing Sub-Classes**: True / False
+
+        **Artifact Types**:
+
+        * **type 1**: ...
+
+          * configuration 1 - ...
+          * configuration 2 - ...
+
+        * **type 2**: ...
+
+          * configuration 1: ...
+          * configuration 2: ...
+
+        :returns: The original docstring with the generated packager summary.
+        """
+        # Get the original packager class doc string:
+        packager_doc_string = cls._packager_doc.split("\n")
+        packager_doc_string = "\n".join(line[4:] for line in packager_doc_string)
+
+        # Parse the packable type section:
+        type_name = (
+            "Any type"
+            if cls.PACKABLE_OBJECT_TYPE is ...
+            else (
+                f"``{str(cls.PACKABLE_OBJECT_TYPE)}``"
+                if TypeHintUtils.is_typing_type(type_hint=cls.PACKABLE_OBJECT_TYPE)
+                else f"``{cls.PACKABLE_OBJECT_TYPE.__module__}.{cls.PACKABLE_OBJECT_TYPE.__name__}``"
+            )
+        )
+        packing_type = f"**Packing Type**: {type_name}"
+
+        # Subclasses support section:
+        packing_sub_classes = f"**Packing Sub-Classes**: {cls.PACK_SUBCLASSES}"
+
+        # Artifact types section:
+        artifact_types = "**Artifact Types**:"
+        for artifact_type in cls.get_supported_artifact_types():
+            # Get the packing method docstring:
+            method_doc = docstring_parser.parse(
+                getattr(cls, f"pack_{artifact_type}").__doc__
+            )
+            # Add the artifact type bullet:
+            artifact_type_doc = f"{method_doc.short_description or ''}{method_doc.long_description or ''}".replace(
+                "\n", ""
+            )
+            artifact_types += f"\n\n* **{artifact_type}** - " + artifact_type_doc
+            # Add the artifact type configurations (ignoring the `obj` and `key` parameters):
+            configurations_doc = "\n\n  * ".join(
+                "{} - {}".format(
+                    parameter.arg_name, parameter.description.replace("\n", "")
+                )
+                for parameter in method_doc.params[2:]
+            )
+            if configurations_doc:
+                artifact_types += f"\n\n  * {configurations_doc}"
+
+        # Construct the final doc string and return:
+        doc = (
+            f"{packager_doc_string}"
+            "\n\n.. rubric:: Packager Summary"
+            f"\n\n{packing_type}"
+            f"\n\n{packing_sub_classes}"
+            f"\n\n{artifact_types}"
+            f"\n\n"
+        )
+        return doc
+
+
+class DefaultPackager(Packager, metaclass=_DefaultPackagerMeta):
     """
     A default packager that handles all types and pack them as pickle files.
 
     The default packager implements all the required methods and have a default logic that should be satisfying most
     use cases. In order to work with this class, you shouldn't override the abstract class methods, but follow the
     guidelines below:
 
@@ -85,44 +192,48 @@
       need may change according to the object that's about to be packed.
     * The abstract class method ``get_default_unpacking_artifact_type``: The method is implemented to return the new
       class variable ``DEFAULT_UNPACKING_ARTIFACT_TYPE``. You may still override the method if the default artifact type
       you need may change according to the data item that's about to be unpacked.
 
     Important to remember (from the ``Packager`` docstring):
 
-    * Linking artifacts ("extra data"): In order to link between packages (using the extra data or metrics spec
+    * **Linking artifacts** ("extra data"): In order to link between packages (using the extra data or metrics spec
       attributes of an artifact), you should use the key as if it exists and as value ellipses (...). The manager will
       link all packages once it is done packing.
 
       For example, given extra data keys in the log hint as `extra_data`, setting them to an artifact should be::
 
           artifact = Artifact(key="my_artifact")
           artifact.spec.extra_data = {key: ... for key in extra_data}
 
-    * Clearing outputs: Some packagers may produce files and temporary directories that should be deleted once done with
-      logging the artifact. The packager can mark paths of files and directories to delete after logging using the class
-      method ``future_clear``.
+    * **Clearing outputs**: Some packagers may produce files and temporary directories that should be deleted once done
+      with logging the artifact. The packager can mark paths of files and directories to delete after logging using the
+      class method ``future_clear``.
 
       For example, in the following packager's ``pack`` method we can write a text file, create an Artifact and then
       mark the text file to be deleted once the artifact is logged::
 
           with open("./some_file.txt", "w") as file:
               file.write("Pack me")
           artifact = Artifact(key="my_artifact")
           cls.future_clear(path="./some_file.txt")
           return artifact, None
+
     """
 
-    # The type of object this packager can pack and unpack:
+    #: The type of object this packager can pack and unpack.
     PACKABLE_OBJECT_TYPE: Type = ...
-    # A flag for indicating whether to pack all subclasses of the `PACKABLE_OBJECT_TYPE` as well:
+
+    #: A flag for indicating whether to pack all subclasses of the `PACKABLE_OBJECT_TYPE` as well.
     PACK_SUBCLASSES = False
-    # The default artifact type to pack as:
+
+    #: The default artifact type to pack as.
     DEFAULT_PACKING_ARTIFACT_TYPE = ArtifactType.OBJECT
-    # The default artifact type to unpack from:
+
+    #: The default artifact type to unpack from.
     DEFAULT_UNPACKING_ARTIFACT_TYPE = ArtifactType.OBJECT
 
     @classmethod
     def get_default_packing_artifact_type(cls, obj: Any) -> str:
         """
         Get the default artifact type for packing an object of this packager.
```

## mlrun/platforms/__init__.py

```diff
@@ -19,16 +19,14 @@
 
 from .iguazio import (
     V3ioStreamClient,
     VolumeMount,
     add_or_refresh_credentials,
     is_iguazio_session_cookie,
     mount_v3io,
-    mount_v3io_extended,
-    mount_v3io_legacy,
     v3io_cred,
 )
 from .other import (
     auto_mount,
     mount_configmap,
     mount_hostpath,
     mount_pvc,
```

## mlrun/platforms/iguazio.py

```diff
@@ -21,54 +21,25 @@
 from urllib.parse import urlparse
 
 import kfp.dsl
 import requests
 import semver
 import urllib3
 import v3io
-from deprecated import deprecated
 
 import mlrun.errors
 from mlrun.config import config as mlconf
 from mlrun.errors import err_to_str
 from mlrun.utils import dict_to_json
 
 _cached_control_session = None
 
 VolumeMount = namedtuple("Mount", ["path", "sub_path"])
 
 
-# TODO: Remove in 1.5.0
-@deprecated(
-    version="1.3.0",
-    reason="'mount_v3io_extended' will be removed in 1.5.0, use 'mount_v3io' instead",
-    category=FutureWarning,
-)
-def mount_v3io_extended(
-    name="v3io", remote="", mounts=None, access_key="", user="", secret=None
-):
-    """Modifier function to apply to a Container Op to volume mount a v3io path
-    :param name:            the volume name
-    :param remote:          the v3io path to use for the volume. ~/ prefix will be replaced with /users/<username>/
-    :param mounts:          list of mount & volume sub paths (type VolumeMount).
-                            empty mounts & remote will default to mount /v3io & /User.
-    :param access_key:      the access key used to auth against v3io. if not given V3IO_ACCESS_KEY env var will be used
-    :param user:            the username used to auth against v3io. if not given V3IO_USERNAME env var will be used
-    :param secret:          k8s secret name which would be used to get the username and access key to auth against v3io.
-    """
-    return mount_v3io(
-        name=name,
-        remote=remote,
-        volume_mounts=mounts,
-        access_key=access_key,
-        user=user,
-        secret=secret,
-    )
-
-
 def mount_v3io(
     name="v3io",
     remote="",
     access_key="",
     user="",
     secret=None,
     volume_mounts=None,
@@ -105,41 +76,14 @@
         if not secret:
             container_op = v3io_cred(access_key=access_key, user=user)(container_op)
         return container_op
 
     return _attach_volume_mounts_and_creds
 
 
-# TODO: Remove in 1.5.0
-@deprecated(
-    version="1.3.0",
-    reason="'mount_v3io_legacy' will be removed in 1.5.0, use 'mount_v3io' instead",
-    category=FutureWarning,
-)
-def mount_v3io_legacy(
-    name="v3io", remote="~/", mount_path="/User", access_key="", user="", secret=None
-):
-    """Modifier function to apply to a Container Op to volume mount a v3io path
-    :param name:            the volume name
-    :param remote:          the v3io path to use for the volume. ~/ prefix will be replaced with /users/<username>/
-    :param mount_path:      the volume mount path
-    :param access_key:      the access key used to auth against v3io. if not given V3IO_ACCESS_KEY env var will be used
-    :param user:            the username used to auth against v3io. if not given V3IO_USERNAME env var will be used
-    :param secret:          k8s secret name which would be used to get the username and access key to auth against v3io.
-    """
-    return mount_v3io(
-        name=name,
-        remote=remote,
-        volume_mounts=[VolumeMount(path=mount_path, sub_path="")],
-        access_key=access_key,
-        user=user,
-        secret=secret,
-    )
-
-
 def _enrich_and_validate_v3io_mounts(remote="", volume_mounts=None, user=""):
     if remote and not volume_mounts:
         raise mlrun.errors.MLRunInvalidArgumentError(
             "volume_mounts must be specified when remote is given"
         )
 
     # Empty remote & volume_mounts defaults are volume mounts of /v3io and /User
```

## mlrun/projects/pipelines.py

```diff
@@ -12,29 +12,33 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import abc
 import builtins
 import importlib.util as imputil
 import os
 import tempfile
-import time
 import traceback
 import typing
 import uuid
-import warnings
 
 import kfp.compiler
 from kfp import dsl
 from kfp.compiler import compiler
 
 import mlrun
 import mlrun.common.schemas
 import mlrun.utils.notifications
 from mlrun.errors import err_to_str
-from mlrun.utils import get_ui_url, logger, new_pipe_metadata
+from mlrun.utils import (
+    get_ui_url,
+    logger,
+    new_pipe_metadata,
+    normalize_workflow_name,
+    retry_until_successful,
+)
 
 from ..common.helpers import parse_versioned_object_uri
 from ..config import config
 from ..run import _run_pipeline, wait_for_pipeline_completion
 from ..runtimes.pod import AutoMountType
 
 
@@ -68,40 +72,31 @@
         self,
         engine=None,
         code=None,
         path=None,
         args=None,
         name=None,
         handler=None,
-        # TODO: deprecated, remove in 1.5.0
-        ttl=None,
         args_schema: dict = None,
         schedule: typing.Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
         cleanup_ttl: int = None,
+        image: str = None,
     ):
-        if ttl:
-            warnings.warn(
-                "'ttl' is deprecated, use 'cleanup_ttl' instead. "
-                "This will be removed in 1.5.0",
-                # TODO: Remove this in 1.5.0
-                FutureWarning,
-            )
-
         self.engine = engine
         self.code = code
         self.path = path
         self.args = args
         self.name = name
         self.handler = handler
-        self.ttl = cleanup_ttl or ttl
-        self.cleanup_ttl = cleanup_ttl or ttl
+        self.cleanup_ttl = cleanup_ttl
         self.args_schema = args_schema
         self.run_local = False
         self._tmp_path = None
         self.schedule = schedule
+        self.image = image
 
     def get_source_file(self, context=""):
         if not self.code and not self.path:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "workflow must have code or path properties"
             )
         if self.code:
@@ -549,15 +544,15 @@
             functions,
             secrets=project._secrets,
         )
         artifact_path = artifact_path or project.spec.artifact_path
 
         conf = new_pipe_metadata(
             artifact_path=artifact_path,
-            cleanup_ttl=workflow_spec.cleanup_ttl or workflow_spec.ttl,
+            cleanup_ttl=workflow_spec.cleanup_ttl,
         )
         compiler.Compiler().compile(pipeline, target, pipeline_conf=conf)
         workflow_spec.clear_tmp()
         pipeline_context.clear()
 
     @classmethod
     def run(
@@ -582,15 +577,15 @@
         id = _run_pipeline(
             workflow_handler,
             project=project.metadata.name,
             arguments=workflow_spec.args,
             experiment=name or workflow_spec.name,
             namespace=namespace,
             artifact_path=artifact_path,
-            cleanup_ttl=workflow_spec.cleanup_ttl or workflow_spec.ttl,
+            cleanup_ttl=workflow_spec.cleanup_ttl,
         )
         project.notifiers.push_pipeline_start_message(
             project.metadata.name,
             project.get_param("commit_id", None),
             id,
             True,
         )
@@ -743,169 +738,88 @@
 
 
 class _RemoteRunner(_PipelineRunner):
     """remote pipelines runner"""
 
     engine = "remote"
 
-    @staticmethod
-    def _prepare_load_and_run_function(
-        source: str,
-        project_name: str,
-        save: bool,
-        workflow_name: str,
-        workflow_spec: WorkflowSpec,
-        artifact_path: str,
-        workflow_handler: str,
-        namespace: str,
-        subpath: str,
-    ) -> typing.Tuple[mlrun.runtimes.RemoteRuntime, "mlrun.RunObject"]:
-        """
-        Helper function for creating the runspec of the load and run function.
-        For internal use only.
-        :param source:              The source of the project.
-        :param project_name:        project name
-        :param save:                either to save the project in the DB
-        :param workflow_name:       workflow name
-        :param workflow_spec:       workflow to run
-        :param artifact_path:       path to store artifacts
-        :param workflow_handler:    workflow function handler (for running workflow function directly)
-        :param namespace:           kubernetes namespace if other than default
-        :param subpath:             project subpath (within the archive)
-        :return:
-        """
-        # Creating the load project and workflow running function:
-        load_and_run_fn = mlrun.new_function(
-            name=mlrun.mlconf.default_workflow_runner_name.format(workflow_name),
-            project=project_name,
-            kind="job",
-            image=mlrun.mlconf.default_base_image,
-        )
-        runspec = mlrun.RunObject(
-            spec=mlrun.model.RunSpec(
-                parameters={
-                    "url": source,
-                    "project_name": project_name,
-                    "save": save,
-                    "workflow_name": workflow_name or workflow_spec.name,
-                    "workflow_path": workflow_spec.path,
-                    "workflow_arguments": workflow_spec.args,
-                    "artifact_path": artifact_path,
-                    "workflow_handler": workflow_handler or workflow_spec.handler,
-                    "namespace": namespace,
-                    "ttl": workflow_spec.cleanup_ttl or workflow_spec.ttl,
-                    "engine": workflow_spec.engine,
-                    "local": workflow_spec.run_local,
-                    "schedule": workflow_spec.schedule,
-                    "subpath": subpath,
-                },
-                handler="mlrun.projects.load_and_run",
-            ),
-            metadata=mlrun.model.RunMetadata(name=workflow_name),
-        )
-
-        runspec = runspec.set_label("job-type", "workflow-runner").set_label(
-            "workflow", workflow_name
-        )
-        return load_and_run_fn, runspec
-
     @classmethod
     def run(
         cls,
-        project,
+        project: "mlrun.projects.MlrunProject",
         workflow_spec: WorkflowSpec,
-        name=None,
-        workflow_handler=None,
-        secrets=None,
-        artifact_path=None,
-        namespace=None,
-        source=None,
+        name: str = None,
+        workflow_handler: typing.Union[str, typing.Callable] = None,
+        secrets: mlrun.secrets.SecretsStore = None,
+        artifact_path: str = None,
+        namespace: str = None,
+        source: str = None,
     ) -> typing.Optional[_PipelineRunStatus]:
-        workflow_name = name.split("-")[-1] if f"{project.name}-" in name else name
-
-        run_id = None
-
-        # If the user provided a source we want to load the project from the source
-        # (like from a specific commit/branch from git repo) without changing the source of the project (save=False).
-        save, current_source = (
-            (False, source) if source else (True, project.spec.source)
-        )
-        if "://" not in current_source:
-            raise mlrun.errors.MLRunInvalidArgumentError(
-                f"Remote workflows can only be performed by a project with remote source (e.g git:// or http://),"
-                f" but the specified source '{current_source}' is not remote. "
-                f"Either put your code in Git, or archive it and then set a source to it."
-                f" For more details, read"
-                f" https://docs.mlrun.org/en/latest/concepts/scheduled-jobs.html#scheduling-a-workflow"
-            )
-
-        # Creating the load project and workflow running function:
-        load_and_run_fn, runspec = cls._prepare_load_and_run_function(
-            source=current_source,
-            project_name=project.name,
-            save=save,
-            workflow_name=workflow_name,
-            workflow_spec=workflow_spec,
-            artifact_path=artifact_path,
-            workflow_handler=workflow_handler,
-            namespace=namespace,
-            subpath=project.spec.subpath,
-        )
+        workflow_name = normalize_workflow_name(name=name, project_name=project.name)
+        workflow_id = None
 
         # The returned engine for this runner is the engine of the workflow.
         # In this way wait_for_completion/get_run_status would be executed by the correct pipeline runner.
         inner_engine = get_workflow_engine(workflow_spec.engine)
-
-        msg = "executing workflow"
-        if workflow_spec.schedule:
-            msg += " scheduling"
-        logger.info(
-            f"{msg} '{load_and_run_fn.metadata.name}' remotely with {workflow_spec.engine} engine"
-        )
-
+        run_db = mlrun.get_run_db()
         try:
-            run = load_and_run_fn.run(
-                runspec=runspec,
-                local=False,
-                schedule=workflow_spec.schedule,
+            workflow_response = run_db.submit_workflow(
+                project=project.name,
+                name=workflow_name,
+                workflow_spec=workflow_spec,
                 artifact_path=artifact_path,
+                source=source,
+                run_name=config.workflows.default_workflow_runner_name.format(
+                    workflow_name
+                ),
+                namespace=namespace,
             )
             if workflow_spec.schedule:
                 return
-            # Fetching workflow id:
-            while not run_id:
-                run.refresh()
-                run_id = run.status.results.get("workflow_id", None)
-                time.sleep(1)
+
+            # Getting workflow id from run:
+            response = retry_until_successful(
+                1,
+                getattr(mlrun.mlconf.workflows.timeouts, inner_engine.engine),
+                logger,
+                False,
+                run_db.get_workflow_id,
+                project=project.name,
+                name=workflow_response.name,
+                run_id=workflow_response.run_id,
+                engine=workflow_spec.engine,
+            )
+            workflow_id = response.workflow_id
             # After fetching the workflow_id the workflow executed successfully
             state = mlrun.run.RunStatuses.succeeded
+            pipeline_context.clear()
 
         except Exception as e:
             trace = traceback.format_exc()
             logger.error(trace)
             project.notifiers.push(
                 f":x: Workflow {workflow_name} run failed!, error: {e}\n{trace}",
                 "error",
             )
             state = mlrun.run.RunStatuses.failed
             return _PipelineRunStatus(
-                run_id,
-                inner_engine,
+                run_id=workflow_id,
+                engine=inner_engine,
                 project=project,
                 workflow=workflow_spec,
                 state=state,
             )
 
         project.notifiers.push_pipeline_start_message(
             project.metadata.name,
         )
         pipeline_context.clear()
         return _PipelineRunStatus(
-            run_id,
-            inner_engine,
+            run_id=workflow_id,
+            engine=inner_engine,
             project=project,
             workflow=workflow_spec,
             state=state,
         )
 
 
 def create_pipeline(project, pipeline, functions, secrets=None, handler=None):
@@ -915,23 +829,14 @@
     mod = imputil.module_from_spec(spec)
     spec.loader.exec_module(mod)
 
     setattr(mod, "funcs", functions)  # should be replaced with "functions" in future
     setattr(mod, "functions", functions)
     setattr(mod, "this_project", project)
 
-    if hasattr(mod, "init_functions"):
-        # TODO: remove in 1.5.0
-        warnings.warn(
-            "'init_functions' is deprecated in 1.3.0 and will be removed in 1.5.0. "
-            "Place function initialization in the pipeline code.",
-            FutureWarning,
-        )
-        getattr(mod, "init_functions")(functions, project, secrets)
-
     # verify all functions are in this project (init_functions may add new functions)
     for f in functions.values():
         f.metadata.project = project.metadata.name
 
     if not handler and hasattr(mod, "kfpipeline"):
         handler = "kfpipeline"
     if not handler and hasattr(mod, "pipeline"):
@@ -972,20 +877,19 @@
     workflow_path: str = None,
     workflow_arguments: typing.Dict[str, typing.Any] = None,
     artifact_path: str = None,
     workflow_handler: typing.Union[str, typing.Callable] = None,
     namespace: str = None,
     sync: bool = False,
     dirty: bool = False,
-    # TODO: deprecated, remove in 1.5.0
-    ttl: int = None,
     engine: str = None,
     local: bool = None,
     schedule: typing.Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
     cleanup_ttl: int = None,
+    load_only: bool = False,
 ):
     """
     Auxiliary function that the RemoteRunner run once or run every schedule.
     This function loads a project from a given remote source and then runs the workflow.
 
     :param context:             mlrun context.
     :param url:                 remote url that represents the project's source.
@@ -1000,40 +904,32 @@
     :param workflow_arguments:  kubeflow pipelines arguments (parameters)
     :param artifact_path:       target path/url for workflow artifacts, the string
                                 '{{workflow.uid}}' will be replaced by workflow id
     :param workflow_handler:    workflow function handler (for running workflow function directly)
     :param namespace:           kubernetes namespace if other than default
     :param sync:                force functions sync before run
     :param dirty:               allow running the workflow when the git repo is dirty
-    :param ttl:                 pipeline cleanup ttl in secs (time to wait after workflow completion, at which point the
-                                workflow and all its resources are deleted) (deprecated, use cleanup_ttl instead)
     :param engine:              workflow engine running the workflow.
                                 supported values are 'kfp' (default) or 'local'
     :param local:               run local pipeline with local functions (set local=True in function.run())
     :param schedule:            ScheduleCronTrigger class instance or a standard crontab expression string
     :param cleanup_ttl:         pipeline cleanup ttl in secs (time to wait after workflow completion, at which point the
                                 workflow and all its resources are deleted)
+    :param load_only:           for just loading the project, inner use.
     """
-    if ttl:
-        warnings.warn(
-            "'ttl' is deprecated, use 'cleanup_ttl' instead. "
-            "This will be removed in 1.5.0",
-            # TODO: Remove this in 1.5.0
-            FutureWarning,
-        )
-
     try:
         project = mlrun.load_project(
             context=f"./{project_name}",
             url=url,
             name=project_name,
             init_git=init_git,
             subpath=subpath,
             clone=clone,
             save=save,
+            sync_functions=True,
         )
     except Exception as error:
         if schedule:
             notification_pusher = mlrun.utils.notifications.CustomNotificationPusher(
                 ["slack"]
             )
             url = get_ui_url(project_name, context.uid)
@@ -1052,26 +948,29 @@
             except Exception as exc:
                 logger.error("Failed to send slack notification", exc=exc)
 
         raise error
 
     context.logger.info(f"Loaded project {project.name} from remote successfully")
 
+    if load_only:
+        return
+
     workflow_log_message = workflow_name or workflow_path
     context.logger.info(f"Running workflow {workflow_log_message} from remote")
     run = project.run(
         name=workflow_name,
         workflow_path=workflow_path,
         arguments=workflow_arguments,
         artifact_path=artifact_path,
         workflow_handler=workflow_handler,
         namespace=namespace,
         sync=sync,
         watch=False,  # Required for fetching the workflow_id
         dirty=dirty,
-        cleanup_ttl=cleanup_ttl or ttl,
+        cleanup_ttl=cleanup_ttl,
         engine=engine,
         local=local,
     )
     context.log_result(key="workflow_id", value=run.run_id)
 
     context.log_result(key="engine", value=run._engine.engine, commit=True)
```

## mlrun/projects/project.py

```diff
@@ -371,15 +371,15 @@
     if repo:
         try:
             # handle cases where active_branch is not set (e.g. in Gitlab CI)
             project.spec.branch = repo.active_branch.name
         except Exception:
             pass
 
-    to_save = save and mlrun.mlconf.dbpath
+    to_save = bool(save and mlrun.mlconf.dbpath)
     if to_save:
         project.save()
 
     # Hook for initializing the project using a project_setup script
     project = project.setup(to_save)
 
     if to_save:
@@ -1241,14 +1241,15 @@
         workflow_path: str,
         embed=False,
         engine=None,
         args_schema: typing.List[EntrypointParam] = None,
         handler=None,
         schedule: typing.Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
         ttl=None,
+        image: str = None,
         **args,
     ):
         """add or update a workflow, specify a name and the code path
 
         :param name:          name of the workflow
         :param workflow_path: url/path for the workflow file
         :param embed:         add the workflow code into the project.yaml
@@ -1256,14 +1257,15 @@
         :param args_schema:   list of arg schema definitions (:py:class`~mlrun.model.EntrypointParam`)
         :param handler:       workflow function handler
         :param schedule:      ScheduleCronTrigger class instance or a standard crontab expression string
                               (which will be converted to the class using its `from_crontab` constructor),
                               see this link for help:
                               https://apscheduler.readthedocs.io/en/3.x/modules/triggers/cron.html#module-apscheduler.triggers.cron
         :param ttl:           pipeline ttl in secs (after that the pods will be removed)
+        :param image:         image for workflow runner job, only for scheduled and remote workflows
         :param args:          argument values (key=value, ..)
         """
 
         # validate the provided workflow_path
         if mlrun.utils.helpers.is_file_path_invalid(
             self.spec.get_code_path(), workflow_path
         ):
@@ -1295,14 +1297,16 @@
                 for schema in args_schema
             ]
             workflow["args_schema"] = args_schema
         workflow["engine"] = engine
         workflow["schedule"] = schedule
         if ttl:
             workflow["ttl"] = ttl
+        if image:
+            workflow["image"] = image
         self.spec.set_workflow(name, workflow)
 
     def set_artifact(
         self,
         key,
         artifact: typing.Union[str, dict, Artifact] = None,
         target_path: str = None,
@@ -2194,23 +2198,20 @@
         arguments: typing.Dict[str, typing.Any] = None,
         artifact_path: str = None,
         workflow_handler: typing.Union[str, typing.Callable] = None,
         namespace: str = None,
         sync: bool = False,
         watch: bool = False,
         dirty: bool = False,
-        # TODO: deprecated, remove in 1.5.0
-        ttl: int = None,
         engine: str = None,
         local: bool = None,
         schedule: typing.Union[
             str, mlrun.common.schemas.ScheduleCronTrigger, bool
         ] = None,
         timeout: int = None,
-        overwrite: bool = False,
         source: str = None,
         cleanup_ttl: int = None,
     ) -> _PipelineRunStatus:
         """run a workflow using kubeflow pipelines
 
         :param name:      name of the workflow
         :param workflow_path:
@@ -2222,52 +2223,32 @@
                           '{{workflow.uid}}' will be replaced by workflow id
         :param workflow_handler:
                           workflow function handler (for running workflow function directly)
         :param namespace: kubernetes namespace if other than default
         :param sync:      force functions sync before run
         :param watch:     wait for pipeline completion
         :param dirty:     allow running the workflow when the git repo is dirty
-        :param ttl:       pipeline cleanup ttl in secs (time to wait after workflow completion, at which point the
-                          workflow and all its resources are deleted) (deprecated, use cleanup_ttl instead)
         :param engine:    workflow engine running the workflow.
                           supported values are 'kfp' (default), 'local' or 'remote'.
                           for setting engine for remote running use 'remote:local' or 'remote:kfp'.
         :param local:     run local pipeline with local functions (set local=True in function.run())
         :param schedule:  ScheduleCronTrigger class instance or a standard crontab expression string
                           (which will be converted to the class using its `from_crontab` constructor),
                           see this link for help:
                           https://apscheduler.readthedocs.io/en/3.x/modules/triggers/cron.html#module-apscheduler.triggers.cron
                           for using the pre-defined workflow's schedule, set `schedule=True`
         :param timeout:   timeout in seconds to wait for pipeline completion (watch will be activated)
-        :param overwrite: (deprecated) replacing the schedule of the same workflow (under the same name) if exists
-                          with the new one.
         :param source:    remote source to use instead of the actual `project.spec.source` (used when engine is remote).
                           for other engines the source is to validate that the code is up-to-date
         :param cleanup_ttl:
                           pipeline cleanup ttl in secs (time to wait after workflow completion, at which point the
                           workflow and all its resources are deleted)
         :returns: run id
         """
 
-        if ttl:
-            warnings.warn(
-                "'ttl' is deprecated, use 'cleanup_ttl' instead. "
-                "This will be removed in 1.5.0",
-                # TODO: Remove this in 1.5.0
-                FutureWarning,
-            )
-
-        if overwrite:
-            warnings.warn(
-                "'overwrite' is deprecated, running a schedule is now an upsert operation. "
-                "This will be removed in 1.5.0",
-                # TODO: Remove this in 1.5.0
-                FutureWarning,
-            )
-
         arguments = arguments or {}
         need_repo = self.spec._need_repo()
         if self.spec.repo and self.spec.repo.is_dirty():
             msg = "you seem to have uncommitted git changes, use .push()"
             if dirty or not need_repo:
                 logger.warning("WARNING!, " + msg)
             else:
@@ -2292,17 +2273,15 @@
                 raise ValueError("workflow name or path must be specified")
 
         if workflow_path or (workflow_handler and callable(workflow_handler)):
             workflow_spec = WorkflowSpec(path=workflow_path, args=arguments)
         else:
             workflow_spec = self.spec._workflows[name].copy()
             workflow_spec.merge_args(arguments)
-        workflow_spec.cleanup_ttl = (
-            cleanup_ttl or ttl or workflow_spec.cleanup_ttl or workflow_spec.ttl
-        )
+        workflow_spec.cleanup_ttl = cleanup_ttl or workflow_spec.cleanup_ttl
         workflow_spec.run_local = local
 
         name = f"{self.metadata.name}-{name}" if name else self.metadata.name
         artifact_path = artifact_path or self._enrich_artifact_path_with_workflow_uid()
 
         if not schedule:
             workflow_spec.schedule = None
@@ -2367,19 +2346,14 @@
     def get_run_status(
         self,
         run,
         timeout=None,
         expected_statuses=None,
         notifiers: CustomNotificationPusher = None,
     ):
-        warnings.warn(
-            "This is deprecated in 1.3.0, and will be removed in 1.5.0. "
-            "Use `timeout` parameter in `project.run()` method instead",
-            FutureWarning,
-        )
         return run._engine.get_run_status(
             project=self,
             run=run,
             timeout=timeout,
             expected_statuses=expected_statuses,
             notifiers=notifiers,
         )
```

## mlrun/runtimes/__init__.py

```diff
@@ -26,30 +26,25 @@
 ]
 
 from mlrun.runtimes.utils import (
     resolve_mpijob_crd_version,
     resolve_spark_operator_version,
 )
 
-from .base import BaseRuntime, BaseRuntimeHandler, RunError, RuntimeClassMode  # noqa
+from .base import BaseRuntime, RunError, RuntimeClassMode  # noqa
 from .constants import MPIJobCRDVersions
-from .daskjob import DaskCluster, DaskRuntimeHandler, get_dask_resource  # noqa
+from .daskjob import DaskCluster, get_dask_resource  # noqa
 from .function import RemoteRuntime
-from .kubejob import KubejobRuntime, KubeRuntimeHandler  # noqa
+from .kubejob import KubejobRuntime  # noqa
 from .local import HandlerRuntime, LocalRuntime  # noqa
-from .mpijob import (  # noqa
-    MpiRuntimeV1,
-    MpiRuntimeV1Alpha1,
-    MpiV1Alpha1RuntimeHandler,
-    MpiV1RuntimeHandler,
-)
+from .mpijob import MpiRuntimeV1, MpiRuntimeV1Alpha1  # noqa
 from .nuclio import nuclio_init_hook
-from .remotesparkjob import RemoteSparkRuntime, RemoteSparkRuntimeHandler
+from .remotesparkjob import RemoteSparkRuntime
 from .serving import ServingRuntime, new_v2_model_server
-from .sparkjob import Spark3Runtime, SparkRuntimeHandler
+from .sparkjob import Spark3Runtime
 
 # for legacy imports (MLModelServer moved from here to /serving)
 from ..serving import MLModelServer, new_v1_model_server  # noqa isort: skip
 
 
 def new_model_server(
     name,
@@ -212,45 +207,14 @@
         ]:
             return True
         return False
 
 
 runtime_resources_map = {RuntimeKinds.dask: get_dask_resource()}
 
-runtime_handler_instances_cache = {}
-
-
-def get_runtime_handler(kind: str) -> BaseRuntimeHandler:
-    global runtime_handler_instances_cache
-    if kind == RuntimeKinds.mpijob:
-        mpijob_crd_version = resolve_mpijob_crd_version()
-        crd_version_to_runtime_handler_class = {
-            MPIJobCRDVersions.v1alpha1: MpiV1Alpha1RuntimeHandler,
-            MPIJobCRDVersions.v1: MpiV1RuntimeHandler,
-        }
-        runtime_handler_class = crd_version_to_runtime_handler_class[mpijob_crd_version]
-        if not runtime_handler_instances_cache.setdefault(RuntimeKinds.mpijob, {}).get(
-            mpijob_crd_version
-        ):
-            runtime_handler_instances_cache[RuntimeKinds.mpijob][
-                mpijob_crd_version
-            ] = runtime_handler_class()
-        return runtime_handler_instances_cache[RuntimeKinds.mpijob][mpijob_crd_version]
-
-    kind_runtime_handler_map = {
-        RuntimeKinds.dask: DaskRuntimeHandler,
-        RuntimeKinds.spark: SparkRuntimeHandler,
-        RuntimeKinds.remotespark: RemoteSparkRuntimeHandler,
-        RuntimeKinds.job: KubeRuntimeHandler,
-    }
-    runtime_handler_class = kind_runtime_handler_map[kind]
-    if not runtime_handler_instances_cache.get(kind):
-        runtime_handler_instances_cache[kind] = runtime_handler_class()
-    return runtime_handler_instances_cache[kind]
-
 
 def get_runtime_class(kind: str):
     if kind == RuntimeKinds.mpijob:
         mpijob_crd_version = resolve_mpijob_crd_version()
         crd_version_to_runtime = {
             MPIJobCRDVersions.v1alpha1: MpiRuntimeV1Alpha1,
             MPIJobCRDVersions.v1: MpiRuntimeV1,
```

## mlrun/runtimes/base.py

```diff
@@ -11,58 +11,50 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import enum
 import getpass
 import http
 import re
-import traceback
 import warnings
-from abc import ABC, abstractmethod
 from base64 import b64encode
-from datetime import datetime, timedelta, timezone
 from os import environ
-from typing import Callable, Dict, List, Optional, Tuple, Union
+from typing import Callable, Dict, List, Optional, Union
 
 import requests.exceptions
 from deprecated import deprecated
-from kubernetes.client.rest import ApiException
 from nuclio.build import mlrun_footer
-from sqlalchemy.orm import Session
 
 import mlrun.common.schemas
+import mlrun.db
 import mlrun.errors
 import mlrun.launcher.factory
 import mlrun.utils.helpers
 import mlrun.utils.notifications
 import mlrun.utils.regex
-from mlrun.api.constants import LogSources
-from mlrun.api.db.base import DBInterface
 from mlrun.utils.helpers import generate_object_uri, verify_field_regex
 
 from ..config import config
 from ..datastore import store_manager
-from ..db import RunDBError, get_or_set_dburl, get_run_db
 from ..errors import err_to_str
 from ..kfpops import mlrun_op
 from ..lists import RunList
 from ..model import BaseMetadata, HyperParamOptions, ImageBuilder, ModelObj, RunObject
 from ..utils import (
     dict_to_json,
     dict_to_yaml,
     enrich_image_url,
     get_in,
     get_parsed_docker_registry,
     logger,
     now_date,
     update_in,
 )
-from .constants import PodPhases, RunStates
 from .funcdoc import update_function_entry_points
-from .utils import RunError, calc_hash, get_k8s
+from .utils import RunError, calc_hash
 
 spec_fields = [
     "command",
     "args",
     "image",
     "mode",
     "build",
@@ -223,22 +215,24 @@
             self.metadata.project,
             self.metadata.name,
             tag=tag or self.metadata.tag,
             hash_key=hash_key,
         )
 
     def _ensure_run_db(self):
-        self.spec.rundb = self.spec.rundb or get_or_set_dburl()
+        self.spec.rundb = self.spec.rundb or mlrun.db.get_or_set_dburl()
 
     def _get_db(self):
         # TODO: remove this function and use the launcher db instead
         self._ensure_run_db()
         if not self._db_conn:
             if self.spec.rundb:
-                self._db_conn = get_run_db(self.spec.rundb, secrets=self._secrets)
+                self._db_conn = mlrun.db.get_run_db(
+                    self.spec.rundb, secrets=self._secrets
+                )
         return self._db_conn
 
     # This function is different than the auto_mount function, as it mounts to runtimes based on the configuration.
     # That's why it's named differently.
     def try_auto_mount_based_on_config(self):
         pass
 
@@ -289,14 +283,15 @@
         scrape_metrics: Optional[bool] = None,
         local: Optional[bool] = False,
         local_code_path: Optional[str] = None,
         auto_build: Optional[bool] = None,
         param_file_secrets: Optional[Dict[str, str]] = None,
         notifications: Optional[List[mlrun.model.Notification]] = None,
         returns: Optional[List[Union[str, Dict[str, str]]]] = None,
+        **launcher_kwargs,
     ) -> RunObject:
         """
         Run a local or remote task.
 
         :param runspec:        The run spec to generate the RunObject from. Can be RunTemplate | RunObject | dict.
         :param handler:        Pointer or name of a function handler.
         :param name:           Execution name.
@@ -336,15 +331,15 @@
                           artifact type is specified, the object's default artifact type will be used.
                         * A dictionary of configurations to use when logging. Further info per object type and artifact
                           type can be given there. The artifact key must appear in the dictionary as "key": "the_key".
 
         :return: Run context object (RunObject) with run metadata, results and status
         """
         launcher = mlrun.launcher.factory.LauncherFactory().create_launcher(
-            self._is_remote, local=local
+            self._is_remote, local=local, **launcher_kwargs
         )
         return launcher.launch(
             runtime=self,
             task=runspec,
             handler=handler,
             name=name,
             project=project,
@@ -369,15 +364,15 @@
     def _get_db_run(self, task: RunObject = None):
         if self._get_db() and task:
             project = task.metadata.project
             uid = task.metadata.uid
             iter = task.metadata.iteration
             try:
                 return self._get_db().read_run(uid, project, iter=iter)
-            except RunDBError:
+            except mlrun.db.RunDBError:
                 return None
         if task:
             return task.to_dict()
 
     def _generate_runtime_env(self, runobj: RunObject):
         runtime_env = {
             "MLRUN_EXEC_CONFIG": runobj.to_json(),
@@ -568,18 +563,18 @@
                 update_in(resp, "status.error", err_to_str(err))
             err = get_in(resp, "status.error")
             if err:
                 updates["status.error"] = err_to_str(err)
 
         elif not was_none and last_state != "completed":
             try:
-                runtime_handler = mlrun.runtimes.get_runtime_handler(kind)
-                updates = runtime_handler._get_run_completion_updates(resp)
+                runtime_cls = mlrun.runtimes.get_runtime_class(kind)
+                updates = runtime_cls._get_run_completion_updates(resp)
             except KeyError:
-                updates = BaseRuntimeHandler._get_run_completion_updates(resp)
+                updates = self._get_run_completion_updates(resp)
 
         uid = get_in(resp, "metadata.uid")
         logger.debug(
             "Run updates",
             name=get_in(resp, "metadata.name"),
             uid=uid,
             kind=kind,
@@ -599,14 +594,27 @@
 
     def _has_pipeline_param(self) -> bool:
         # check if the runtime has pipeline parameters
         # https://www.kubeflow.org/docs/components/pipelines/v1/sdk/parameters/
         matches = re.findall(mlrun.utils.regex.pipeline_param[0], self.to_json())
         return bool(matches)
 
+    @staticmethod
+    def _get_run_completion_updates(run: dict) -> dict:
+        """
+        Get the required updates for the run object when it's completed and update the run object state
+        Override this if the run completion is not resolved by a single execution
+        """
+        updates = {
+            "status.last_update": now_date().isoformat(),
+            "status.state": "completed",
+        }
+        update_in(run, "status.state", "completed")
+        return updates
+
     def full_image_path(
         self, image=None, client_version: str = None, client_python_version: str = None
     ):
         image = image or self.spec.image or ""
 
         image = enrich_image_url(image, client_version, client_python_version)
         if not image.startswith("."):
@@ -906,1230 +914,7 @@
                         line = p["name"]
                         if "type" in p:
                             line += f"({p['type']})"
                         line += "  - " + p.get("doc", "")
                         if "default" in p:
                             line += f", default={p['default']}"
                         print("    " + line)
-
-
-class BaseRuntimeHandler(ABC):
-    # setting here to allow tests to override
-    kind = "base"
-    class_modes: Dict[RuntimeClassMode, str] = {}
-    wait_for_deletion_interval = 10
-
-    @staticmethod
-    @abstractmethod
-    def _get_object_label_selector(object_id: str) -> str:
-        """
-        Should return the label selector to get only resources of a specific object (with id object_id)
-        """
-        pass
-
-    def _should_collect_logs(self) -> bool:
-        """
-        There are some runtimes which we don't collect logs for using the log collector
-        :return: whether it should collect log for it
-        """
-        return True
-
-    def _get_possible_mlrun_class_label_values(
-        self, class_mode: Union[RuntimeClassMode, str] = None
-    ) -> List[str]:
-        """
-        Should return the possible values of the mlrun/class label for runtime resources that are of this runtime
-        handler kind
-        """
-        if not class_mode:
-            return list(self.class_modes.values())
-        class_mode = self.class_modes.get(class_mode, None)
-        return [class_mode] if class_mode else []
-
-    def list_resources(
-        self,
-        project: str,
-        object_id: Optional[str] = None,
-        label_selector: str = None,
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ) -> Union[
-        mlrun.common.schemas.RuntimeResources,
-        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-    ]:
-        # We currently don't support removing runtime resources in non k8s env
-        if not get_k8s().is_running_inside_kubernetes_cluster():
-            return {}
-        namespace = get_k8s().resolve_namespace()
-        label_selector = self.resolve_label_selector(project, object_id, label_selector)
-        pods = self._list_pods(namespace, label_selector)
-        pod_resources = self._build_pod_resources(pods)
-        crd_objects = self._list_crd_objects(namespace, label_selector)
-        crd_resources = self._build_crd_resources(crd_objects)
-        response = self._build_list_resources_response(
-            pod_resources, crd_resources, group_by
-        )
-        response = self._enrich_list_resources_response(
-            response, namespace, label_selector, group_by
-        )
-        return response
-
-    def build_output_from_runtime_resources(
-        self,
-        runtime_resources_list: List[mlrun.common.schemas.RuntimeResources],
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ):
-        pod_resources = []
-        crd_resources = []
-        for runtime_resources in runtime_resources_list:
-            pod_resources += runtime_resources.pod_resources
-            crd_resources += runtime_resources.crd_resources
-        response = self._build_list_resources_response(
-            pod_resources, crd_resources, group_by
-        )
-        response = self._build_output_from_runtime_resources(
-            response, runtime_resources_list, group_by
-        )
-        return response
-
-    def delete_resources(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        label_selector: str = None,
-        force: bool = False,
-        grace_period: int = None,
-    ):
-        if grace_period is None:
-            grace_period = config.runtime_resources_deletion_grace_period
-        # We currently don't support removing runtime resources in non k8s env
-        if not get_k8s().is_running_inside_kubernetes_cluster():
-            return
-        namespace = get_k8s().resolve_namespace()
-        label_selector = self.resolve_label_selector("*", label_selector=label_selector)
-        crd_group, crd_version, crd_plural = self._get_crd_info()
-        if crd_group and crd_version and crd_plural:
-            deleted_resources = self._delete_crd_resources(
-                db,
-                db_session,
-                namespace,
-                label_selector,
-                force,
-                grace_period,
-            )
-        else:
-            deleted_resources = self._delete_pod_resources(
-                db,
-                db_session,
-                namespace,
-                label_selector,
-                force,
-                grace_period,
-            )
-        self._delete_extra_resources(
-            db,
-            db_session,
-            namespace,
-            deleted_resources,
-            label_selector,
-            force,
-            grace_period,
-        )
-
-    def delete_runtime_object_resources(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        object_id: str,
-        label_selector: str = None,
-        force: bool = False,
-        grace_period: int = None,
-    ):
-        if grace_period is None:
-            grace_period = config.runtime_resources_deletion_grace_period
-        label_selector = self._add_object_label_selector_if_needed(
-            object_id, label_selector
-        )
-        self.delete_resources(db, db_session, label_selector, force, grace_period)
-
-    def monitor_runs(self, db: DBInterface, db_session: Session):
-        namespace = get_k8s().resolve_namespace()
-        label_selector = self._get_default_label_selector()
-        crd_group, crd_version, crd_plural = self._get_crd_info()
-        runtime_resource_is_crd = False
-        if crd_group and crd_version and crd_plural:
-            runtime_resource_is_crd = True
-            runtime_resources = self._list_crd_objects(namespace, label_selector)
-        else:
-            runtime_resources = self._list_pods(namespace, label_selector)
-        project_run_uid_map = self._list_runs_for_monitoring(db, db_session)
-        # project -> uid -> {"name": <runtime-resource-name>}
-        run_runtime_resources_map = {}
-        for runtime_resource in runtime_resources:
-            project, uid, name = self._resolve_runtime_resource_run(runtime_resource)
-            run_runtime_resources_map.setdefault(project, {})
-            run_runtime_resources_map.get(project).update({uid: {"name": name}})
-            try:
-                self._monitor_runtime_resource(
-                    db,
-                    db_session,
-                    project_run_uid_map,
-                    runtime_resource,
-                    runtime_resource_is_crd,
-                    namespace,
-                    project,
-                    uid,
-                    name,
-                )
-            except Exception as exc:
-                logger.warning(
-                    "Failed monitoring runtime resource. Continuing",
-                    runtime_resource_name=runtime_resource["metadata"]["name"],
-                    namespace=namespace,
-                    exc=err_to_str(exc),
-                    traceback=traceback.format_exc(),
-                )
-        for project, runs in project_run_uid_map.items():
-            if runs:
-                for run_uid, run in runs.items():
-                    try:
-                        if not run:
-                            run = db.read_run(db_session, run_uid, project)
-                        if self.kind == run.get("metadata", {}).get("labels", {}).get(
-                            "kind", ""
-                        ):
-                            self._ensure_run_not_stuck_on_non_terminal_state(
-                                db,
-                                db_session,
-                                project,
-                                run_uid,
-                                run,
-                                run_runtime_resources_map,
-                            )
-                    except Exception as exc:
-                        logger.warning(
-                            "Failed ensuring run not stuck. Continuing",
-                            run_uid=run_uid,
-                            run=run,
-                            project=project,
-                            exc=err_to_str(exc),
-                            traceback=traceback.format_exc(),
-                        )
-
-    def _ensure_run_not_stuck_on_non_terminal_state(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        project: str,
-        run_uid: str,
-        run: dict = None,
-        run_runtime_resources_map: dict = None,
-    ):
-        """
-        Ensuring that a run does not become trapped in a non-terminal state as a result of not finding
-        corresponding k8s resource.
-        This can occur when a node is evicted or preempted, causing the resources to be removed from the resource
-        listing when the final state recorded in the database is non-terminal.
-        This will have a significant impact on scheduled jobs, since they will not be created until the
-        previous run reaches a terminal state (because of concurrency limit)
-        """
-        now = now_date()
-        db_run_state = run.get("status", {}).get("state")
-        if not db_run_state:
-            # we are setting the run state to a terminal state to avoid log spamming, this is mainly sanity as we are
-            # setting state to runs when storing new runs.
-            logger.info(
-                "Runs monitoring found a run without state, updating to a terminal state",
-                project=project,
-                uid=run_uid,
-                db_run_state=db_run_state,
-                now=now,
-            )
-            run.setdefault("status", {})["state"] = RunStates.error
-            run.setdefault("status", {})["last_update"] = now.isoformat()
-            db.store_run(db_session, run, run_uid, project)
-            return
-        if db_run_state in RunStates.non_terminal_states():
-            if run_runtime_resources_map and run_uid in run_runtime_resources_map.get(
-                project, {}
-            ):
-                # if found resource there is no need to continue
-                return
-            last_update_str = run.get("status", {}).get("last_update")
-            debounce_period = (
-                config.resolve_runs_monitoring_missing_runtime_resources_debouncing_interval()
-            )
-            if last_update_str is None:
-                logger.info(
-                    "Runs monitoring found run in non-terminal state without last update time set, "
-                    "updating last update time to now, to be able to evaluate next time if something changed",
-                    project=project,
-                    uid=run_uid,
-                    db_run_state=db_run_state,
-                    now=now,
-                    debounce_period=debounce_period,
-                )
-                run.setdefault("status", {})["last_update"] = now.isoformat()
-                db.store_run(db_session, run, run_uid, project)
-                return
-
-            if datetime.fromisoformat(last_update_str) > now - timedelta(
-                seconds=debounce_period
-            ):
-                # we are setting non-terminal states to runs before the run is actually applied to k8s, meaning there is
-                # a timeframe where the run exists and no runtime resources exist and it's ok, therefore we're applying
-                # a debounce period before setting the state to error
-                logger.warning(
-                    "Monitoring did not discover a runtime resource that corresponded to a run in a "
-                    "non-terminal state. but record has recently updated. Debouncing",
-                    project=project,
-                    uid=run_uid,
-                    db_run_state=db_run_state,
-                    last_update=datetime.fromisoformat(last_update_str),
-                    now=now,
-                    debounce_period=debounce_period,
-                )
-            else:
-                logger.info(
-                    "Updating run state", run_uid=run_uid, run_state=RunStates.error
-                )
-                run.setdefault("status", {})["state"] = RunStates.error
-                run.setdefault("status", {})[
-                    "reason"
-                ] = "A runtime resource related to this run could not be found"
-                run.setdefault("status", {})["last_update"] = now.isoformat()
-                db.store_run(db_session, run, run_uid, project)
-
-    def _add_object_label_selector_if_needed(
-        self,
-        object_id: Optional[str] = None,
-        label_selector: Optional[str] = None,
-    ):
-        if object_id:
-            object_label_selector = self._get_object_label_selector(object_id)
-            if label_selector:
-                label_selector = ",".join([object_label_selector, label_selector])
-            else:
-                label_selector = object_label_selector
-        return label_selector
-
-    @staticmethod
-    def _get_main_runtime_resource_label_selector() -> str:
-        """
-        There are some runtimes which might have multiple k8s resources attached to a one runtime, in this case
-        we don't want to pull logs from all but rather only for the "driver"/"launcher" etc
-        :return: the label selector
-        """
-        return ""
-
-    def _enrich_list_resources_response(
-        self,
-        response: Union[
-            mlrun.common.schemas.RuntimeResources,
-            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-        ],
-        namespace: str,
-        label_selector: str = None,
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ) -> Union[
-        mlrun.common.schemas.RuntimeResources,
-        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-    ]:
-        """
-        Override this to list resources other then pods or CRDs (which are handled by the base class)
-        """
-        return response
-
-    def _build_output_from_runtime_resources(
-        self,
-        response: Union[
-            mlrun.common.schemas.RuntimeResources,
-            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-        ],
-        runtime_resources_list: List[mlrun.common.schemas.RuntimeResources],
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ):
-        """
-        Override this to add runtime resources other than pods or CRDs (which are handled by the base class) to the
-        output
-        """
-        return response
-
-    def _delete_extra_resources(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        namespace: str,
-        deleted_resources: List[Dict],
-        label_selector: str = None,
-        force: bool = False,
-        grace_period: int = None,
-    ):
-        """
-        Override this to handle deletion of resources other than pods or CRDs (which are handled by the base class)
-        Note that this is happening after the deletion of the CRDs or the pods
-        Note to add this at the beginning:
-        if grace_period is None:
-            grace_period = config.runtime_resources_deletion_grace_period
-        """
-        pass
-
-    def _resolve_crd_object_status_info(
-        self, db: DBInterface, db_session: Session, crd_object
-    ) -> Tuple[bool, Optional[datetime], Optional[str]]:
-        """
-        Override this if the runtime has CRD resources.
-        :return: Tuple with:
-        1. bool determining whether the crd object is in terminal state
-        2. datetime of when the crd object got into terminal state (only when the crd object in terminal state)
-        3. the desired run state matching the crd object state
-        """
-        return False, None, None
-
-    def _update_ui_url(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        project: str,
-        uid: str,
-        crd_object,
-        run: Dict = None,
-    ):
-        """
-        Update the UI URL for relevant jobs.
-        """
-        pass
-
-    def _resolve_pod_status_info(
-        self, db: DBInterface, db_session: Session, pod: Dict
-    ) -> Tuple[bool, Optional[datetime], Optional[str]]:
-        """
-        :return: Tuple with:
-        1. bool determining whether the pod is in terminal state
-        2. datetime of when the pod got into terminal state (only when the pod in terminal state)
-        3. the run state matching the pod state
-        """
-        in_terminal_state = pod["status"]["phase"] in PodPhases.terminal_phases()
-        run_state = PodPhases.pod_phase_to_run_state(pod["status"]["phase"])
-        last_container_completion_time = None
-        if in_terminal_state:
-            for container_status in pod["status"].get("container_statuses", []):
-                if container_status.get("state", {}).get("terminated"):
-                    container_completion_time = container_status["state"][
-                        "terminated"
-                    ].get("finished_at")
-
-                    # take latest completion time
-                    if (
-                        not last_container_completion_time
-                        or last_container_completion_time < container_completion_time
-                    ):
-                        last_container_completion_time = container_completion_time
-
-        return in_terminal_state, last_container_completion_time, run_state
-
-    def _get_default_label_selector(
-        self, class_mode: Union[RuntimeClassMode, str] = None
-    ) -> str:
-        """
-        Override this to add a default label selector
-        """
-        class_values = self._get_possible_mlrun_class_label_values(class_mode)
-        if not class_values:
-            return ""
-        if len(class_values) == 1:
-            return f"mlrun/class={class_values[0]}"
-        return f"mlrun/class in ({', '.join(class_values)})"
-
-    @staticmethod
-    def _get_run_completion_updates(run: dict) -> dict:
-        """
-        Get the required updates for the run object when it's completed and update the run object state
-        Override this if the run completion is not resolved by a single execution
-        """
-        updates = {
-            "status.last_update": now_date().isoformat(),
-            "status.state": "completed",
-        }
-        update_in(run, "status.state", "completed")
-        return updates
-
-    @staticmethod
-    def _get_crd_info() -> Tuple[str, str, str]:
-        """
-        Override this if the runtime has CRD resources. this should return the CRD info:
-        crd group, crd version, crd plural
-        """
-        return "", "", ""
-
-    @staticmethod
-    def _are_resources_coupled_to_run_object() -> bool:
-        """
-        Some resources are tightly coupled to mlrun Run object, for example, for each Run of a Function of the job kind
-        a kubernetes job is being generated, on the opposite a Function of the daskjob kind generates a dask cluster,
-        and every Run is being executed using this cluster, i.e. no resources are created for the Run.
-        This function should return true for runtimes in which Run are coupled to the underlying resources and therefore
-        aspects of the Run (like its state) should be taken into consideration on resources deletion
-        """
-        return False
-
-    @staticmethod
-    def _expect_pods_without_uid() -> bool:
-        return False
-
-    def _list_pods(self, namespace: str, label_selector: str = None) -> List:
-        pods = get_k8s().list_pods(namespace, selector=label_selector)
-        # when we work with custom objects (list_namespaced_custom_object) it's always a dict, to be able to generalize
-        # code working on runtime resource (either a custom object or a pod) we're transforming to dicts
-        pods = [pod.to_dict() for pod in pods]
-        return pods
-
-    def _list_crd_objects(self, namespace: str, label_selector: str = None) -> List:
-        crd_group, crd_version, crd_plural = self._get_crd_info()
-        crd_objects = []
-        if crd_group and crd_version and crd_plural:
-            try:
-                crd_objects = get_k8s().crdapi.list_namespaced_custom_object(
-                    crd_group,
-                    crd_version,
-                    namespace,
-                    crd_plural,
-                    label_selector=label_selector,
-                )
-            except ApiException as exc:
-                # ignore error if crd is not defined
-                if exc.status != 404:
-                    raise
-            else:
-                crd_objects = crd_objects["items"]
-        return crd_objects
-
-    def resolve_label_selector(
-        self,
-        project: str,
-        object_id: Optional[str] = None,
-        label_selector: Optional[str] = None,
-        class_mode: Union[RuntimeClassMode, str] = None,
-        with_main_runtime_resource_label_selector: bool = False,
-    ) -> str:
-        default_label_selector = self._get_default_label_selector(class_mode=class_mode)
-
-        if label_selector:
-            label_selector = ",".join([default_label_selector, label_selector])
-        else:
-            label_selector = default_label_selector
-
-        if project and project != "*":
-            label_selector = ",".join([label_selector, f"mlrun/project={project}"])
-
-        label_selector = self._add_object_label_selector_if_needed(
-            object_id, label_selector
-        )
-
-        if with_main_runtime_resource_label_selector:
-            main_runtime_resource_label_selector = (
-                self._get_main_runtime_resource_label_selector()
-            )
-            if main_runtime_resource_label_selector:
-                label_selector = ",".join(
-                    [label_selector, main_runtime_resource_label_selector]
-                )
-
-        return label_selector
-
-    @staticmethod
-    def resolve_object_id(
-        run: dict,
-    ) -> Optional[str]:
-        """
-        Get the object id from the run object
-        Override this if the object id is not the run uid
-        :param run: run object
-        :return: object id
-        """
-        return run.get("metadata", {}).get("uid", None)
-
-    def _wait_for_pods_deletion(
-        self,
-        namespace: str,
-        deleted_pods: List[Dict],
-        label_selector: str = None,
-    ):
-        deleted_pod_names = [pod_dict["metadata"]["name"] for pod_dict in deleted_pods]
-
-        def _verify_pods_removed():
-            pods = get_k8s().v1api.list_namespaced_pod(
-                namespace, label_selector=label_selector
-            )
-            existing_pod_names = [pod.metadata.name for pod in pods.items]
-            still_in_deletion_pods = set(existing_pod_names).intersection(
-                deleted_pod_names
-            )
-            if still_in_deletion_pods:
-                raise RuntimeError(
-                    f"Pods are still in deletion process: {still_in_deletion_pods}"
-                )
-
-        if deleted_pod_names:
-            timeout = 180
-            logger.debug(
-                "Waiting for pods deletion",
-                timeout=timeout,
-                interval=self.wait_for_deletion_interval,
-            )
-            mlrun.utils.retry_until_successful(
-                self.wait_for_deletion_interval,
-                timeout,
-                logger,
-                True,
-                _verify_pods_removed,
-            )
-
-    def _wait_for_crds_underlying_pods_deletion(
-        self,
-        deleted_crds: List[Dict],
-        label_selector: str = None,
-    ):
-        # we're using here the run identifier as the common ground to identify which pods are relevant to which CRD, so
-        # if they are not coupled we are not able to wait - simply return
-        # NOTE - there are surely smarter ways to do this, without depending on the run object, but as of writing this
-        # none of the runtimes using CRDs are like that, so not handling it now
-        if not self._are_resources_coupled_to_run_object():
-            return
-
-        def _verify_crds_underlying_pods_removed():
-            project_uid_crd_map = {}
-            for crd in deleted_crds:
-                project, uid, _ = self._resolve_runtime_resource_run(crd)
-                if not uid or not project:
-                    logger.warning(
-                        "Could not resolve run uid from crd. Skipping waiting for pods deletion",
-                        crd=crd,
-                    )
-                    continue
-                project_uid_crd_map.setdefault(project, {})[uid] = crd["metadata"][
-                    "name"
-                ]
-            still_in_deletion_crds_to_pod_names = {}
-            jobs_runtime_resources: mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput = self.list_resources(
-                "*",
-                label_selector=label_selector,
-                group_by=mlrun.common.schemas.ListRuntimeResourcesGroupByField.job,
-            )
-            for project, project_jobs in jobs_runtime_resources.items():
-                if project not in project_uid_crd_map:
-                    continue
-                for job_uid, job_runtime_resources in jobs_runtime_resources[
-                    project
-                ].items():
-                    if job_uid not in project_uid_crd_map[project]:
-                        continue
-                    if job_runtime_resources.pod_resources:
-                        still_in_deletion_crds_to_pod_names[
-                            project_uid_crd_map[project][job_uid]
-                        ] = [
-                            pod_resource.name
-                            for pod_resource in job_runtime_resources.pod_resources
-                        ]
-            if still_in_deletion_crds_to_pod_names:
-                raise RuntimeError(
-                    f"CRD underlying pods are still in deletion process: {still_in_deletion_crds_to_pod_names}"
-                )
-
-        if deleted_crds:
-            timeout = 180
-            logger.debug(
-                "Waiting for CRDs underlying pods deletion",
-                timeout=timeout,
-                interval=self.wait_for_deletion_interval,
-            )
-            mlrun.utils.retry_until_successful(
-                self.wait_for_deletion_interval,
-                timeout,
-                logger,
-                True,
-                _verify_crds_underlying_pods_removed,
-            )
-
-    def _delete_pod_resources(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        namespace: str,
-        label_selector: str = None,
-        force: bool = False,
-        grace_period: int = None,
-    ) -> List[Dict]:
-        if grace_period is None:
-            grace_period = config.runtime_resources_deletion_grace_period
-        pods = get_k8s().v1api.list_namespaced_pod(
-            namespace, label_selector=label_selector
-        )
-        deleted_pods = []
-        for pod in pods.items:
-            pod_dict = pod.to_dict()
-
-            # best effort - don't let one failure in pod deletion to cut the whole operation
-            try:
-                (
-                    in_terminal_state,
-                    last_update,
-                    run_state,
-                ) = self._resolve_pod_status_info(db, db_session, pod_dict)
-                if not force:
-                    if not in_terminal_state:
-                        continue
-
-                    # give some grace period if we have last update time
-                    now = datetime.now(timezone.utc)
-                    if (
-                        last_update is not None
-                        and last_update + timedelta(seconds=float(grace_period)) > now
-                    ):
-                        continue
-
-                # if resources are tightly coupled to the run object - we want to perform some actions on the run object
-                # before deleting them
-                if self._are_resources_coupled_to_run_object():
-                    try:
-                        self._pre_deletion_runtime_resource_run_actions(
-                            db, db_session, pod_dict, run_state
-                        )
-                    except Exception as exc:
-                        # Don't prevent the deletion for failure in the pre deletion run actions
-                        logger.warning(
-                            "Failure in pod run pre-deletion actions. Continuing",
-                            exc=repr(exc),
-                            pod_name=pod.metadata.name,
-                        )
-
-                get_k8s().delete_pod(pod.metadata.name, namespace)
-                deleted_pods.append(pod_dict)
-            except Exception as exc:
-                logger.warning(
-                    f"Cleanup failed processing pod {pod.metadata.name}: {repr(exc)}. Continuing"
-                )
-        # TODO: don't wait for pods to be deleted, client should poll the deletion status
-        self._wait_for_pods_deletion(namespace, deleted_pods, label_selector)
-        return deleted_pods
-
-    def _delete_crd_resources(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        namespace: str,
-        label_selector: str = None,
-        force: bool = False,
-        grace_period: int = None,
-    ) -> List[Dict]:
-        if grace_period is None:
-            grace_period = config.runtime_resources_deletion_grace_period
-        crd_group, crd_version, crd_plural = self._get_crd_info()
-        deleted_crds = []
-        try:
-            crd_objects = get_k8s().crdapi.list_namespaced_custom_object(
-                crd_group,
-                crd_version,
-                namespace,
-                crd_plural,
-                label_selector=label_selector,
-            )
-        except ApiException as exc:
-            # ignore error if crd is not defined
-            if exc.status != 404:
-                raise
-        else:
-            for crd_object in crd_objects["items"]:
-                # best effort - don't let one failure in pod deletion to cut the whole operation
-                try:
-                    (
-                        in_terminal_state,
-                        last_update,
-                        desired_run_state,
-                    ) = self._resolve_crd_object_status_info(db, db_session, crd_object)
-                    if not force:
-                        if not in_terminal_state:
-                            continue
-
-                        # give some grace period if we have last update time
-                        now = datetime.now(timezone.utc)
-                        if (
-                            last_update is not None
-                            and last_update + timedelta(seconds=float(grace_period))
-                            > now
-                        ):
-                            continue
-
-                    # if resources are tightly coupled to the run object - we want to perform some actions on the run
-                    # object before deleting them
-                    if self._are_resources_coupled_to_run_object():
-                        try:
-                            self._pre_deletion_runtime_resource_run_actions(
-                                db,
-                                db_session,
-                                crd_object,
-                                desired_run_state,
-                            )
-                        except Exception as exc:
-                            # Don't prevent the deletion for failure in the pre deletion run actions
-                            logger.warning(
-                                "Failure in crd object run pre-deletion actions. Continuing",
-                                exc=err_to_str(exc),
-                                crd_object_name=crd_object["metadata"]["name"],
-                            )
-
-                    get_k8s().delete_crd(
-                        crd_object["metadata"]["name"],
-                        crd_group,
-                        crd_version,
-                        crd_plural,
-                        namespace,
-                    )
-                    deleted_crds.append(crd_object)
-                except Exception:
-                    exc = traceback.format_exc()
-                    crd_object_name = crd_object["metadata"]["name"]
-                    logger.warning(
-                        f"Cleanup failed processing CRD object {crd_object_name}: {err_to_str(exc)}. Continuing"
-                    )
-        self._wait_for_crds_underlying_pods_deletion(deleted_crds, label_selector)
-        return deleted_crds
-
-    def _pre_deletion_runtime_resource_run_actions(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        runtime_resource: Dict,
-        run_state: str,
-    ):
-        project, uid, name = self._resolve_runtime_resource_run(runtime_resource)
-
-        # if cannot resolve related run nothing to do
-        if not uid:
-            if not self._expect_pods_without_uid():
-                logger.warning(
-                    "Could not resolve run uid from runtime resource. Skipping pre-deletion actions",
-                    runtime_resource=runtime_resource,
-                )
-                raise ValueError("Could not resolve run uid from runtime resource")
-            else:
-                return
-
-        logger.info(
-            "Performing pre-deletion actions before cleaning up runtime resources",
-            project=project,
-            uid=uid,
-        )
-
-        self._ensure_run_state(db, db_session, project, uid, name, run_state)
-
-        self._ensure_run_logs_collected(db, db_session, project, uid)
-
-    def _is_runtime_resource_run_in_terminal_state(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        runtime_resource: Dict,
-    ) -> Tuple[bool, Optional[datetime]]:
-        """
-        A runtime can have different underlying resources (like pods or CRDs) - to generalize we call it runtime
-        resource. This function will verify whether the Run object related to this runtime resource is in transient
-        state. This is useful in order to determine whether an object can be removed. for example, a kubejob's pod
-        might be in completed state, but we would like to verify that the run is completed as well to verify the logs
-        were collected before we're removing the pod.
-
-        :returns: bool determining whether the run in terminal state, and the last update time if it exists
-        """
-        project, uid, _ = self._resolve_runtime_resource_run(runtime_resource)
-
-        # if no uid, assume in terminal state
-        if not uid:
-            return True, None
-
-        run = db.read_run(db_session, uid, project)
-        last_update = None
-        last_update_str = run.get("status", {}).get("last_update")
-        if last_update_str is not None:
-            last_update = datetime.fromisoformat(last_update_str)
-
-        if run.get("status", {}).get("state") not in RunStates.terminal_states():
-            return False, last_update
-
-        return True, last_update
-
-    def _list_runs_for_monitoring(
-        self, db: DBInterface, db_session: Session, states: list = None
-    ):
-        runs = db.list_runs(db_session, project="*", states=states)
-        project_run_uid_map = {}
-        run_with_missing_data = []
-        duplicated_runs = []
-        for run in runs:
-            project = run.get("metadata", {}).get("project")
-            uid = run.get("metadata", {}).get("uid")
-            if not uid or not project:
-                run_with_missing_data.append(run.get("metadata", {}))
-                continue
-            current_run = project_run_uid_map.setdefault(project, {}).get(uid)
-
-            # sanity
-            if current_run:
-                duplicated_runs = {
-                    "monitored_run": current_run.get(["metadata"]),
-                    "duplicated_run": run.get(["metadata"]),
-                }
-                continue
-
-            project_run_uid_map[project][uid] = run
-
-        # If there are duplications or runs with missing data it probably won't be fixed
-        # Monitoring is running periodically and we don't want to log on every problem we found which will spam the log
-        # so we're aggregating the problems and logging only once per aggregation
-        if duplicated_runs:
-            logger.warning(
-                "Found duplicated runs (same uid). Heuristically monitoring the first one found",
-                duplicated_runs=duplicated_runs,
-            )
-
-        if run_with_missing_data:
-            logger.warning(
-                "Found runs with missing data. They will not be monitored",
-                run_with_missing_data=run_with_missing_data,
-            )
-
-        return project_run_uid_map
-
-    def _monitor_runtime_resource(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        project_run_uid_map: Dict,
-        runtime_resource: Dict,
-        runtime_resource_is_crd: bool,
-        namespace: str,
-        project: str = None,
-        uid: str = None,
-        name: str = None,
-    ):
-        if not project and not uid and not name:
-            project, uid, name = self._resolve_runtime_resource_run(runtime_resource)
-        if not project or not uid:
-            # Currently any build pod won't have UID and therefore will cause this log message to be printed which
-            # spams the log
-            # TODO: uncomment the log message when builder become a kind / starts having a UID
-            # logger.warning(
-            #     "Could not resolve run project or uid from runtime resource, can not monitor run. Continuing",
-            #     project=project,
-            #     uid=uid,
-            #     runtime_resource_name=runtime_resource["metadata"]["name"],
-            #     namespace=namespace,
-            # )
-            return
-        run = project_run_uid_map.get(project, {}).get(uid)
-        if runtime_resource_is_crd:
-            (
-                _,
-                _,
-                run_state,
-            ) = self._resolve_crd_object_status_info(db, db_session, runtime_resource)
-        else:
-            (
-                _,
-                _,
-                run_state,
-            ) = self._resolve_pod_status_info(db, db_session, runtime_resource)
-        self._update_ui_url(db, db_session, project, uid, runtime_resource, run)
-        _, updated_run_state = self._ensure_run_state(
-            db,
-            db_session,
-            project,
-            uid,
-            name,
-            run_state,
-            run,
-            search_run=False,
-        )
-        if updated_run_state in RunStates.terminal_states():
-            self._ensure_run_logs_collected(db, db_session, project, uid)
-
-    def _build_list_resources_response(
-        self,
-        pod_resources: List[mlrun.common.schemas.RuntimeResource] = None,
-        crd_resources: List[mlrun.common.schemas.RuntimeResource] = None,
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ) -> Union[
-        mlrun.common.schemas.RuntimeResources,
-        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-    ]:
-        if crd_resources is None:
-            crd_resources = []
-        if pod_resources is None:
-            pod_resources = []
-
-        if group_by is None:
-            return mlrun.common.schemas.RuntimeResources(
-                crd_resources=crd_resources, pod_resources=pod_resources
-            )
-        else:
-            if group_by == mlrun.common.schemas.ListRuntimeResourcesGroupByField.job:
-                return self._build_grouped_by_job_list_resources_response(
-                    pod_resources, crd_resources
-                )
-            elif (
-                group_by
-                == mlrun.common.schemas.ListRuntimeResourcesGroupByField.project
-            ):
-                return self._build_grouped_by_project_list_resources_response(
-                    pod_resources, crd_resources
-                )
-            else:
-                raise NotImplementedError(
-                    f"Provided group by field is not supported. group_by={group_by}"
-                )
-
-    def _build_grouped_by_project_list_resources_response(
-        self,
-        pod_resources: List[mlrun.common.schemas.RuntimeResource] = None,
-        crd_resources: List[mlrun.common.schemas.RuntimeResource] = None,
-    ) -> mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput:
-        resources = {}
-        for pod_resource in pod_resources:
-            self._add_resource_to_grouped_by_project_resources_response(
-                resources, "pod_resources", pod_resource
-            )
-        for crd_resource in crd_resources:
-            self._add_resource_to_grouped_by_project_resources_response(
-                resources, "crd_resources", crd_resource
-            )
-        return resources
-
-    def _build_grouped_by_job_list_resources_response(
-        self,
-        pod_resources: List[mlrun.common.schemas.RuntimeResource] = None,
-        crd_resources: List[mlrun.common.schemas.RuntimeResource] = None,
-    ) -> mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput:
-        resources = {}
-        for pod_resource in pod_resources:
-            self._add_resource_to_grouped_by_job_resources_response(
-                resources, "pod_resources", pod_resource
-            )
-        for crd_resource in crd_resources:
-            self._add_resource_to_grouped_by_job_resources_response(
-                resources, "crd_resources", crd_resource
-            )
-        return resources
-
-    def _add_resource_to_grouped_by_project_resources_response(
-        self,
-        resources: mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-        resource_field_name: str,
-        resource: mlrun.common.schemas.RuntimeResource,
-    ):
-        if "mlrun/class" in resource.labels:
-            project = resource.labels.get("mlrun/project", "")
-            mlrun_class = resource.labels["mlrun/class"]
-            kind = self._resolve_kind_from_class(mlrun_class)
-            self._add_resource_to_grouped_by_field_resources_response(
-                project, kind, resources, resource_field_name, resource
-            )
-
-    def _add_resource_to_grouped_by_job_resources_response(
-        self,
-        resources: mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-        resource_field_name: str,
-        resource: mlrun.common.schemas.RuntimeResource,
-    ):
-        if "mlrun/uid" in resource.labels:
-            project = resource.labels.get("mlrun/project", config.default_project)
-            uid = resource.labels["mlrun/uid"]
-            self._add_resource_to_grouped_by_field_resources_response(
-                project, uid, resources, resource_field_name, resource
-            )
-
-    @staticmethod
-    def _add_resource_to_grouped_by_field_resources_response(
-        first_field_value: str,
-        second_field_value: str,
-        resources: mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-        resource_field_name: str,
-        resource: mlrun.common.schemas.RuntimeResource,
-    ):
-        if first_field_value not in resources:
-            resources[first_field_value] = {}
-        if second_field_value not in resources[first_field_value]:
-            resources[first_field_value][
-                second_field_value
-            ] = mlrun.common.schemas.RuntimeResources(
-                pod_resources=[], crd_resources=[]
-            )
-        if not getattr(
-            resources[first_field_value][second_field_value], resource_field_name
-        ):
-            setattr(
-                resources[first_field_value][second_field_value],
-                resource_field_name,
-                [],
-            )
-        getattr(
-            resources[first_field_value][second_field_value], resource_field_name
-        ).append(resource)
-
-    @staticmethod
-    def _resolve_kind_from_class(mlrun_class: str) -> str:
-        class_to_kind_map = {}
-        for kind in mlrun.runtimes.RuntimeKinds.runtime_with_handlers():
-            runtime_handler = mlrun.runtimes.get_runtime_handler(kind)
-            class_values = runtime_handler._get_possible_mlrun_class_label_values()
-            for value in class_values:
-                class_to_kind_map[value] = kind
-        return class_to_kind_map[mlrun_class]
-
-    @staticmethod
-    def _get_run_label_selector(project: str, run_uid: str):
-        return f"mlrun/project={project},mlrun/uid={run_uid}"
-
-    @staticmethod
-    def _ensure_run_logs_collected(
-        db: DBInterface, db_session: Session, project: str, uid: str
-    ):
-        # import here to avoid circular imports
-        import mlrun.api.crud as crud
-
-        log_file_exists, _ = crud.Logs().log_file_exists_for_run_uid(project, uid)
-        if not log_file_exists:
-            # this stays for now for backwards compatibility in case we would not use the log collector but rather
-            # the legacy method to pull logs
-            logs_from_k8s = crud.Logs()._get_logs_legacy_method(
-                db_session, project, uid, source=LogSources.K8S
-            )
-            if logs_from_k8s:
-                logger.info("Storing run logs", project=project, uid=uid)
-                crud.Logs().store_log(logs_from_k8s, project, uid, append=False)
-
-    @staticmethod
-    def _ensure_run_state(
-        db: DBInterface,
-        db_session: Session,
-        project: str,
-        uid: str,
-        name: str,
-        run_state: str,
-        run: Dict = None,
-        search_run: bool = True,
-    ) -> Tuple[bool, str]:
-        if run is None:
-            run = {}
-        if search_run:
-            try:
-                run = db.read_run(db_session, uid, project)
-            except mlrun.errors.MLRunNotFoundError:
-                run = {}
-        if not run:
-            logger.warning(
-                "Run not found. A new run will be created",
-                project=project,
-                uid=uid,
-                desired_run_state=run_state,
-                search_run=search_run,
-            )
-            run = {"metadata": {"project": project, "name": name, "uid": uid}}
-        db_run_state = run.get("status", {}).get("state")
-        if db_run_state:
-            if db_run_state == run_state:
-                return False, run_state
-            # if the current run state is terminal and different than the desired - log
-            if db_run_state in RunStates.terminal_states():
-                # This can happen when the SDK running in the user's Run updates the Run's state to terminal, but
-                # before it exits, when the runtime resource is still running, the API monitoring (here) is executed
-                if run_state not in RunStates.terminal_states():
-                    now = datetime.now(timezone.utc)
-                    last_update_str = run.get("status", {}).get("last_update")
-                    if last_update_str is not None:
-                        last_update = datetime.fromisoformat(last_update_str)
-                        debounce_period = config.runs_monitoring_interval
-                        if last_update > now - timedelta(
-                            seconds=float(debounce_period)
-                        ):
-                            logger.warning(
-                                "Monitoring found non-terminal state on runtime resource but record has recently "
-                                "updated to terminal state. Debouncing",
-                                project=project,
-                                uid=uid,
-                                db_run_state=db_run_state,
-                                run_state=run_state,
-                                last_update=last_update,
-                                now=now,
-                                debounce_period=debounce_period,
-                            )
-                            return False, run_state
-
-                logger.warning(
-                    "Run record has terminal state but monitoring found different state on runtime resource. Changing",
-                    project=project,
-                    uid=uid,
-                    db_run_state=db_run_state,
-                    run_state=run_state,
-                )
-
-        logger.info("Updating run state", run_state=run_state)
-        run.setdefault("status", {})["state"] = run_state
-        run.setdefault("status", {})["last_update"] = now_date().isoformat()
-        db.store_run(db_session, run, uid, project)
-
-        return True, run_state
-
-    @staticmethod
-    def _resolve_runtime_resource_run(runtime_resource: Dict) -> Tuple[str, str, str]:
-        project = (
-            runtime_resource.get("metadata", {}).get("labels", {}).get("mlrun/project")
-        )
-        if not project:
-            project = config.default_project
-        uid = runtime_resource.get("metadata", {}).get("labels", {}).get("mlrun/uid")
-        name = (
-            runtime_resource.get("metadata", {})
-            .get("labels", {})
-            .get("mlrun/name", "no-name")
-        )
-        return project, uid, name
-
-    @staticmethod
-    def _build_pod_resources(pods) -> List[mlrun.common.schemas.RuntimeResource]:
-        pod_resources = []
-        for pod in pods:
-            pod_resources.append(
-                mlrun.common.schemas.RuntimeResource(
-                    name=pod["metadata"]["name"],
-                    labels=pod["metadata"]["labels"],
-                    status=pod["status"],
-                )
-            )
-        return pod_resources
-
-    @staticmethod
-    def _build_crd_resources(
-        custom_objects,
-    ) -> List[mlrun.common.schemas.RuntimeResource]:
-        crd_resources = []
-        for custom_object in custom_objects:
-            crd_resources.append(
-                mlrun.common.schemas.RuntimeResource(
-                    name=custom_object["metadata"]["name"],
-                    labels=custom_object["metadata"]["labels"],
-                    status=custom_object.get("status", {}),
-                )
-            )
-        return crd_resources
```

## mlrun/runtimes/daskjob.py

```diff
@@ -11,41 +11,33 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import datetime
 import inspect
 import socket
 import time
-import typing
 from os import environ
-from typing import Dict, List, Optional, Union
-
-from deprecated import deprecated
-from kubernetes.client.rest import ApiException
-from sqlalchemy.orm import Session
 
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.k8s_utils
 import mlrun.utils
 import mlrun.utils.regex
-from mlrun.api.db.base import DBInterface
 from mlrun.errors import err_to_str
-from mlrun.runtimes.base import BaseRuntimeHandler
 
 from ..config import config
 from ..execution import MLClientCtx
 from ..model import RunObject
 from ..render import ipython_display
 from ..utils import logger, normalize_name, update_in
-from .base import FunctionStatus, RuntimeClassMode
+from .base import FunctionStatus
 from .kubejob import KubejobRuntime
 from .local import exec_from_params, load_module
 from .pod import KubeResourceSpec, kube_resource_spec_to_pod_spec
-from .utils import RunError, get_func_selector, get_k8s, get_resource_labels, log_std
+from .utils import RunError, get_func_selector, get_resource_labels, log_std
 
 
 def get_dask_resource():
     return {
         "scope": "function",
         "start": deploy_function,
         "status": get_obj_status,
@@ -402,24 +394,14 @@
             skip_deployed,
             is_kfp=is_kfp,
             mlrun_version_specifier=mlrun_version_specifier,
             builder_env=builder_env,
             show_on_failure=show_on_failure,
         )
 
-    # TODO: Remove in 1.5.0
-    @deprecated(
-        version="1.3.0",
-        reason="'Dask gpus' will be removed in 1.5.0, use 'with_scheduler_limits' / 'with_worker_limits' instead",
-        category=FutureWarning,
-    )
-    def gpus(self, gpus, gpu_type="nvidia.com/gpu"):
-        update_in(self.spec.scheduler_resources, ["limits", gpu_type], gpus)
-        update_in(self.spec.worker_resources, ["limits", gpu_type], gpus)
-
     def with_limits(
         self,
         mem=None,
         cpu=None,
         gpus=None,
         gpu_type="nvidia.com/gpu",
         patch: bool = False,
@@ -682,185 +664,7 @@
                 f"found running dask function {pod.metadata.name}, cluster={cluster}"
             )
             return status
         logger.info(
             f"found dask function {pod.metadata.name} in non ready state ({status})"
         )
     return status
-
-
-class DaskRuntimeHandler(BaseRuntimeHandler):
-    kind = "dask"
-    class_modes = {RuntimeClassMode.run: "dask"}
-
-    # Dask runtime resources are per function (and not per run).
-    # It means that monitoring runtime resources state doesn't say anything about the run state.
-    # Therefore dask run monitoring is done completely by the SDK, so overriding the monitoring method with no logic
-    def monitor_runs(
-        self, db: DBInterface, db_session: Session, leader_session: Optional[str] = None
-    ):
-        return
-
-    @staticmethod
-    def _get_object_label_selector(object_id: str) -> str:
-        return f"mlrun/function={object_id}"
-
-    @staticmethod
-    def resolve_object_id(
-        run: dict,
-    ) -> typing.Optional[str]:
-        """
-        Resolves the object ID from the run object.
-        In dask runtime, the object ID is the function name.
-        :param run: run object
-        :return: function name
-        """
-
-        function = run.get("spec", {}).get("function", None)
-        if function:
-
-            # a dask run's function field is in the format <project-name>/<function-name>@<run-uid>
-            # we only want the function name
-            project_and_function = function.split("@")[0]
-            return project_and_function.split("/")[-1]
-
-        return None
-
-    def _enrich_list_resources_response(
-        self,
-        response: Union[
-            mlrun.common.schemas.RuntimeResources,
-            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-        ],
-        namespace: str,
-        label_selector: str = None,
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ) -> Union[
-        mlrun.common.schemas.RuntimeResources,
-        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-    ]:
-        """
-        Handling listing service resources
-        """
-        enrich_needed = self._validate_if_enrich_is_needed_by_group_by(group_by)
-        if not enrich_needed:
-            return response
-        services = get_k8s().v1api.list_namespaced_service(
-            namespace, label_selector=label_selector
-        )
-        service_resources = []
-        for service in services.items:
-            service_resources.append(
-                mlrun.common.schemas.RuntimeResource(
-                    name=service.metadata.name, labels=service.metadata.labels
-                )
-            )
-        return self._enrich_service_resources_in_response(
-            response, service_resources, group_by
-        )
-
-    def _build_output_from_runtime_resources(
-        self,
-        response: Union[
-            mlrun.common.schemas.RuntimeResources,
-            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-        ],
-        runtime_resources_list: List[mlrun.common.schemas.RuntimeResources],
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ):
-        enrich_needed = self._validate_if_enrich_is_needed_by_group_by(group_by)
-        if not enrich_needed:
-            return response
-        service_resources = []
-        for runtime_resources in runtime_resources_list:
-            if runtime_resources.service_resources:
-                service_resources += runtime_resources.service_resources
-        return self._enrich_service_resources_in_response(
-            response, service_resources, group_by
-        )
-
-    def _validate_if_enrich_is_needed_by_group_by(
-        self,
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ) -> bool:
-        # Dask runtime resources are per function (and not per job) therefore, when grouping by job we're simply
-        # omitting the dask runtime resources
-        if group_by == mlrun.common.schemas.ListRuntimeResourcesGroupByField.job:
-            return False
-        elif group_by == mlrun.common.schemas.ListRuntimeResourcesGroupByField.project:
-            return True
-        elif group_by is not None:
-            raise NotImplementedError(
-                f"Provided group by field is not supported. group_by={group_by}"
-            )
-        return True
-
-    def _enrich_service_resources_in_response(
-        self,
-        response: Union[
-            mlrun.common.schemas.RuntimeResources,
-            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
-        ],
-        service_resources: List[mlrun.common.schemas.RuntimeResource],
-        group_by: Optional[
-            mlrun.common.schemas.ListRuntimeResourcesGroupByField
-        ] = None,
-    ):
-        if group_by == mlrun.common.schemas.ListRuntimeResourcesGroupByField.project:
-            for service_resource in service_resources:
-                self._add_resource_to_grouped_by_project_resources_response(
-                    response, "service_resources", service_resource
-                )
-        else:
-            response.service_resources = service_resources
-        return response
-
-    def _delete_extra_resources(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        namespace: str,
-        deleted_resources: List[Dict],
-        label_selector: str = None,
-        force: bool = False,
-        grace_period: int = None,
-    ):
-        """
-        Handling services deletion
-        """
-        if grace_period is None:
-            grace_period = config.runtime_resources_deletion_grace_period
-        service_names = []
-        for pod_dict in deleted_resources:
-            dask_component = (
-                pod_dict["metadata"].get("labels", {}).get("dask.org/component")
-            )
-            cluster_name = (
-                pod_dict["metadata"].get("labels", {}).get("dask.org/cluster-name")
-            )
-            if dask_component == "scheduler" and cluster_name:
-                service_names.append(cluster_name)
-
-        services = get_k8s().v1api.list_namespaced_service(
-            namespace, label_selector=label_selector
-        )
-        for service in services.items:
-            try:
-                if force or service.metadata.name in service_names:
-                    get_k8s().v1api.delete_namespaced_service(
-                        service.metadata.name, namespace
-                    )
-                    logger.info(f"Deleted service: {service.metadata.name}")
-            except ApiException as exc:
-                # ignore error if service is already removed
-                if exc.status != 404:
-                    raise
```

## mlrun/runtimes/function.py

```diff
@@ -24,19 +24,20 @@
 import requests
 import semver
 from aiohttp.client import ClientSession
 from kubernetes import client
 from nuclio.deploy import find_dashboard_url, get_deploy_status
 from nuclio.triggers import V3IOStreamTrigger
 
+import mlrun.db
 import mlrun.errors
 import mlrun.k8s_utils
 import mlrun.utils
+import mlrun.utils.helpers
 from mlrun.common.schemas import AuthInfo
-from mlrun.db import RunDBError
 
 from ..config import config as mlconf
 from ..errors import err_to_str
 from ..kfpops import deploy_op
 from ..lists import RunList
 from ..model import RunObject
 from ..platforms.iguazio import (
@@ -484,14 +485,24 @@
         :param ack_window_size:  stream ack window size (the consumer group will be updated with the
                                  event id - ack_window_size, on failure the events in the window will be retransmitted)
         :param kwargs:         extra V3IOStreamTrigger class attributes
         """
         endpoint = None
         if "://" in stream_path:
             endpoint, stream_path = parse_path(stream_path, suffix="")
+
+        # verify v3io stream trigger name is valid
+        mlrun.utils.helpers.validate_v3io_stream_consumer_group(group)
+
+        consumer_group = kwargs.pop("consumerGroup", None)
+        if consumer_group:
+            logger.warning(
+                "consumerGroup kwargs value is ignored. use group argument instead"
+            )
+
         container, path = split_path(stream_path)
         shards = shards or 1
         extra_attributes = extra_attributes or {}
         if ack_window_size:
             extra_attributes["ackWindowSize"] = ack_window_size
         self.add_trigger(
             name,
@@ -599,15 +610,15 @@
             sleep(
                 int(mlrun.mlconf.httpdb.logs.nuclio.pull_deploy_status_default_interval)
             )
             try:
                 text, last_log_timestamp = db.get_builder_status(
                     self, last_log_timestamp=last_log_timestamp, verbose=verbose
                 )
-            except RunDBError:
+            except mlrun.db.RunDBError:
                 raise ValueError("function or deploy process not found")
             state = self.status.state
             if text:
                 print(text)
 
         if state != "ready":
             logger.error("Nuclio function failed to deploy", function_state=state)
@@ -710,27 +721,27 @@
                 self.spec.command = f"http://{address}"
             return state, text, last_log_timestamp
 
         try:
             text, last_log_timestamp = self._get_db().get_builder_status(
                 self, last_log_timestamp=last_log_timestamp, verbose=verbose
             )
-        except RunDBError:
+        except mlrun.db.RunDBError:
             if raise_on_exception:
                 return "", "", None
             raise ValueError("function or deploy process not found")
         return self.status.state, text, last_log_timestamp
 
     def _get_runtime_env(self):
         # for runtime specific env var enrichment (before deploy)
         runtime_env = {
             "MLRUN_DEFAULT_PROJECT": self.metadata.project or mlconf.default_project,
         }
-        if self.spec.rundb or mlconf.httpdb.api_url:
-            runtime_env["MLRUN_DBPATH"] = self.spec.rundb or mlconf.httpdb.api_url
+        if mlconf.httpdb.api_url:
+            runtime_env["MLRUN_DBPATH"] = mlconf.httpdb.api_url
         if mlconf.namespace:
             runtime_env["MLRUN_NAMESPACE"] = mlconf.namespace
         if self.metadata.credentials.access_key:
             runtime_env[
                 mlrun.runtimes.constants.FunctionEnvironmentVariables.auth_session
             ] = self.metadata.credentials.access_key
         return runtime_env
```

## mlrun/runtimes/kubejob.py

```diff
@@ -16,23 +16,22 @@
 import time
 import warnings
 
 from kubernetes import client
 from kubernetes.client.rest import ApiException
 
 import mlrun.common.schemas
+import mlrun.db
 import mlrun.errors
-from mlrun.runtimes.base import BaseRuntimeHandler
 
-from ..db import RunDBError
 from ..errors import err_to_str
 from ..kfpops import build_op
 from ..model import RunObject
 from ..utils import get_in, logger
-from .base import RunError, RuntimeClassMode
+from .base import RunError
 from .pod import KubeResource, kube_resource_spec_to_pod_spec
 from .utils import get_k8s
 
 
 class KubejobRuntime(KubeResource):
     kind = "job"
     _is_nested = True
@@ -253,15 +252,15 @@
         return ready
 
     def _build_watch(self, watch=True, logs=True, show_on_failure=False):
         db = self._get_db()
         offset = 0
         try:
             text, _ = db.get_builder_status(self, 0, logs=logs)
-        except RunDBError:
+        except mlrun.db.RunDBError:
             raise ValueError("function or build process not found")
 
         def print_log(text):
             if text and (not show_on_failure or self.status.state == "error"):
                 print(text, end="")
 
         print_log(text)
@@ -356,18 +355,16 @@
             return None
 
         if workdir and os.path.isabs(workdir):
             return workdir
 
         if self.spec.clone_target_dir:
             workdir = workdir or ""
-            if workdir.startswith("./"):
-                # TODO: use 'removeprefix' when we drop python 3.7 support
-                # workdir.removeprefix("./")
-                workdir = workdir[2:]
+            workdir = workdir.removeprefix("./")
+
             return os.path.join(self.spec.clone_target_dir, workdir)
 
         return workdir
 
 
 def func_to_pod(image, runtime, extra_env, command, args, workdir):
     container = client.V1Container(
@@ -386,28 +383,7 @@
 
     if runtime.spec.image_pull_secret:
         pod_spec.image_pull_secrets = [
             client.V1LocalObjectReference(name=runtime.spec.image_pull_secret)
         ]
 
     return pod_spec
-
-
-class KubeRuntimeHandler(BaseRuntimeHandler):
-    kind = "job"
-    class_modes = {RuntimeClassMode.run: "job", RuntimeClassMode.build: "build"}
-
-    @staticmethod
-    def _expect_pods_without_uid() -> bool:
-        """
-        builder pods are handled as part of this runtime handler - they are not coupled to run object, therefore they
-        don't have the uid in their labels
-        """
-        return True
-
-    @staticmethod
-    def _are_resources_coupled_to_run_object() -> bool:
-        return True
-
-    @staticmethod
-    def _get_object_label_selector(object_id: str) -> str:
-        return f"mlrun/uid={object_id}"
```

## mlrun/runtimes/nuclio.py

```diff
@@ -12,15 +12,16 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import inspect
 import json
 import os
 import socket
 
-from ..db import get_or_set_dburl
+import mlrun.db
+
 from ..errors import err_to_str
 from ..execution import MLClientCtx
 from ..model import RunTemplate
 from ..serving.server import v2_serving_init
 from ..serving.v1_serving import nuclio_serving_init
 from .local import get_func_arg
 from .serving import serving_subkind
@@ -56,15 +57,15 @@
     if not inspect.isfunction(fhandler) or paths[0].startswith("_"):
         return context.Response(
             body=f"{paths[0]} is not a public function handler",
             content_type="text/plain",
             status_code=400,
         )
 
-    out = get_or_set_dburl()
+    out = mlrun.db.get_or_set_dburl()
     if out:
         context.logger.info(f"logging run results to: {out}")
 
     newspec = event.body
     if newspec and not isinstance(newspec, dict):
         newspec = json.loads(newspec)
```

## mlrun/runtimes/pod.py

```diff
@@ -16,15 +16,14 @@
 import typing
 import uuid
 from enum import Enum
 
 import dotenv
 import kfp.dsl
 import kubernetes.client as k8s_client
-from deprecated import deprecated
 
 import mlrun.errors
 import mlrun.utils.regex
 from mlrun.common.schemas import (
     NodeSelectorOperator,
     PreemptionModes,
     SecurityContextEnrichmentModes,
@@ -1010,23 +1009,14 @@
                     )
             else:
                 raise mlrun.errors.MLRunNotFoundError(f"{file_path} does not exist")
         for name, value in env_vars.items():
             self.set_env(name, value)
         return self
 
-    # TODO: Remove in 1.5.0
-    @deprecated(
-        version="1.3.0",
-        reason="'Job gpus' will be removed in 1.5.0, use 'with_limits' instead",
-        category=FutureWarning,
-    )
-    def gpus(self, gpus, gpu_type="nvidia.com/gpu"):
-        update_in(self.spec.resources, ["limits", gpu_type], gpus)
-
     def set_image_pull_configuration(
         self, image_pull_policy: str = None, image_pull_secret_name: str = None
     ):
         """
         Configure the image pull parameters for the runtime.
 
         :param image_pull_policy: The policy to use when pulling. One of `IfNotPresent`, `Always` or `Never`
```

## mlrun/runtimes/remotesparkjob.py

```diff
@@ -17,16 +17,15 @@
 import kubernetes.client
 
 import mlrun.errors
 from mlrun.config import config
 
 from ..model import RunObject
 from ..platforms.iguazio import mount_v3io, mount_v3iod
-from .base import RuntimeClassMode
-from .kubejob import KubejobRuntime, KubeRuntimeHandler
+from .kubejob import KubejobRuntime
 from .pod import KubeResourceSpec
 
 
 class RemoteSparkSpec(KubeResourceSpec):
     _dict_fields = KubeResourceSpec._dict_fields + ["provider"]
 
     def __init__(
@@ -206,22 +205,9 @@
             is_kfp=is_kfp,
             mlrun_version_specifier=mlrun_version_specifier,
             builder_env=builder_env,
             show_on_failure=show_on_failure,
         )
 
 
-class RemoteSparkRuntimeHandler(KubeRuntimeHandler):
-    kind = "remote-spark"
-    class_modes = {RuntimeClassMode.run: "remote-spark"}
-
-    @staticmethod
-    def _are_resources_coupled_to_run_object() -> bool:
-        return True
-
-    @staticmethod
-    def _get_object_label_selector(object_id: str) -> str:
-        return f"mlrun/uid={object_id}"
-
-
 def igz_spark_pre_hook():
     run(["/bin/bash", "/etc/config/v3io/spark-job-init.sh"])
```

## mlrun/runtimes/serving.py

```diff
@@ -470,15 +470,15 @@
                 if function_name not in self._spec.function_refs.keys():
                     raise ValueError(f"function reference {function_name} not present")
                 group = stream.options.get("group", f"{function_name}-consumer-group")
 
                 child_function = self._spec.function_refs[function_name]
                 trigger_args = stream.trigger_args or {}
 
-                if mlrun.mlconf.httpdb.nuclio.explicit_ack == "enabled":
+                if mlrun.mlconf.is_explicit_ack():
                     trigger_args["explicit_ack_mode"] = trigger_args.get(
                         "explicit_ack_mode", "explicitOnly"
                     )
                     extra_attributes = trigger_args.get("extra_attributes", {})
                     trigger_args["extra_attributes"] = extra_attributes
                     extra_attributes["workerAllocationMode"] = extra_attributes.get(
                         "workerAllocationMode", "static"
```

## mlrun/runtimes/mpijob/__init__.py

```diff
@@ -10,9 +10,9 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
-from .v1 import MpiRuntimeV1, MpiV1RuntimeHandler
-from .v1alpha1 import MpiRuntimeV1Alpha1, MpiV1Alpha1RuntimeHandler
+from .v1 import MpiRuntimeV1
+from .v1alpha1 import MpiRuntimeV1Alpha1
```

## mlrun/runtimes/mpijob/abstract.py

```diff
@@ -21,15 +21,15 @@
 from mlrun.config import config
 from mlrun.errors import err_to_str
 from mlrun.execution import MLClientCtx
 from mlrun.model import RunObject
 from mlrun.runtimes.kubejob import KubejobRuntime
 from mlrun.runtimes.pod import KubeResourceSpec
 from mlrun.runtimes.utils import RunError, get_k8s
-from mlrun.utils import get_in, logger
+from mlrun.utils import get_in, logger, update_in
 
 
 class MPIResourceSpec(KubeResourceSpec):
     _dict_fields = KubeResourceSpec._dict_fields + ["mpi_args"]
 
     def __init__(
         self,
@@ -134,14 +134,23 @@
 
     # should return the mpijob CRD information -> (group, version, plural)
     @staticmethod
     @abc.abstractmethod
     def _get_crd_info() -> typing.Tuple[str, str, str]:
         pass
 
+    @staticmethod
+    def _get_run_completion_updates(run: dict) -> dict:
+
+        # TODO: add a 'workers' section in run objects state, each worker will update its state while
+        #  the run state will be resolved by the server.
+        # update the run object state if empty so that it won't default to 'created' state
+        update_in(run, "status.state", "running", append=False, replace=False)
+        return {}
+
     def _pretty_print_jobs(self, items: typing.List):
         print(f"{'status':10} {'name':20} {'start':21} end")
         for i in items:
             status = self._get_job_launcher_status(i)
             name = get_in(i, "metadata.name", "")
             start_time = get_in(i, "status.startTime", "")
             end_time = get_in(i, "status.completionTime", "")
```

## mlrun/runtimes/mpijob/v1.py

```diff
@@ -9,25 +9,21 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import typing
 from copy import deepcopy
-from datetime import datetime
 
 from kubernetes import client
-from sqlalchemy.orm import Session
 
 import mlrun.runtimes.pod
-from mlrun.api.db.base import DBInterface
 from mlrun.config import config as mlconf
 from mlrun.execution import MLClientCtx
 from mlrun.model import RunObject
-from mlrun.runtimes.base import BaseRuntimeHandler, RunStates, RuntimeClassMode
 from mlrun.runtimes.constants import MPIJobCRDVersions, MPIJobV1CleanPodPolicies
 from mlrun.runtimes.mpijob.abstract import AbstractMPIJobRuntime, MPIResourceSpec
 from mlrun.utils import get_in, update_in
 
 
 class MPIV1ResourceSpec(MPIResourceSpec):
     _dict_fields = MPIResourceSpec._dict_fields + ["clean_pod_policy"]
@@ -313,80 +309,8 @@
 
     @staticmethod
     def _get_crd_info() -> typing.Tuple[str, str, str]:
         return (
             MpiRuntimeV1.crd_group,
             MpiRuntimeV1.crd_version,
             MpiRuntimeV1.crd_plural,
-        )
-
-
-class MpiV1RuntimeHandler(BaseRuntimeHandler):
-    kind = "mpijob"
-    class_modes = {
-        RuntimeClassMode.run: "mpijob",
-    }
-
-    def _resolve_crd_object_status_info(
-        self, db: DBInterface, db_session: Session, crd_object
-    ) -> typing.Tuple[bool, typing.Optional[datetime], typing.Optional[str]]:
-        """
-        https://github.com/kubeflow/mpi-operator/blob/master/pkg/apis/kubeflow/v1/types.go#L29
-        https://github.com/kubeflow/common/blob/master/pkg/apis/common/v1/types.go#L55
-        """
-        launcher_status = (
-            crd_object.get("status", {}).get("replicaStatuses", {}).get("Launcher", {})
-        )
-        # the launcher status also has running property, but it's empty for
-        # short period after the creation, so we're
-        # checking terminal state by the completion time existence
-        in_terminal_state = (
-            crd_object.get("status", {}).get("completionTime", None) is not None
-        )
-        desired_run_state = RunStates.running
-        completion_time = None
-        if in_terminal_state:
-            completion_time = datetime.fromisoformat(
-                crd_object.get("status", {})
-                .get("completionTime")
-                .replace("Z", "+00:00")
-            )
-            desired_run_state = (
-                RunStates.error
-                if launcher_status.get("failed", 0) > 0
-                else RunStates.completed
-            )
-        return in_terminal_state, completion_time, desired_run_state
-
-    @staticmethod
-    def _are_resources_coupled_to_run_object() -> bool:
-        return True
-
-    @staticmethod
-    def _get_object_label_selector(object_id: str) -> str:
-        return f"mlrun/uid={object_id}"
-
-    @staticmethod
-    def _get_main_runtime_resource_label_selector() -> str:
-        """
-        There are some runtimes which might have multiple k8s resources attached to a one runtime, in this case
-        we don't want to pull logs from all but rather only for the "driver"/"launcher" etc
-        :return: the label selector
-        """
-        return "mpi-job-role=launcher"
-
-    @staticmethod
-    def _get_run_completion_updates(run: dict) -> dict:
-
-        # TODO: add a 'workers' section in run objects state, each worker will update its state while
-        #  the run state will be resolved by the server.
-        # update the run object state if empty so that it won't default to 'created' state
-        update_in(run, "status.state", "running", append=False, replace=False)
-        return {}
-
-    @staticmethod
-    def _get_crd_info() -> typing.Tuple[str, str, str]:
-        return (
-            MpiRuntimeV1.crd_group,
-            MpiRuntimeV1.crd_version,
-            MpiRuntimeV1.crd_plural,
         )
```

## mlrun/runtimes/mpijob/v1alpha1.py

```diff
@@ -9,26 +9,22 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import typing
 from copy import deepcopy
-from datetime import datetime
 
 from kubernetes import client
-from sqlalchemy.orm import Session
 
 import mlrun.runtimes.pod
-from mlrun.api.db.base import DBInterface
 from mlrun.config import config as mlconf
 from mlrun.execution import MLClientCtx
 from mlrun.model import RunObject
-from mlrun.runtimes.base import BaseRuntimeHandler, RunStates, RuntimeClassMode
-from mlrun.runtimes.constants import MPIJobCRDVersions, MPIJobV1Alpha1States
+from mlrun.runtimes.constants import MPIJobCRDVersions
 from mlrun.runtimes.mpijob.abstract import AbstractMPIJobRuntime
 from mlrun.utils import get_in, update_in
 
 
 class MpiRuntimeV1Alpha1(AbstractMPIJobRuntime):
     _mpijob_template = {
         "apiVersion": "kubeflow.org/v1alpha1",
@@ -152,76 +148,7 @@
     @staticmethod
     def _get_crd_info() -> typing.Tuple[str, str, str]:
         return (
             MpiRuntimeV1Alpha1.crd_group,
             MpiRuntimeV1Alpha1.crd_version,
             MpiRuntimeV1Alpha1.crd_plural,
         )
-
-
-class MpiV1Alpha1RuntimeHandler(BaseRuntimeHandler):
-    kind = "mpijob"
-    class_modes = {
-        RuntimeClassMode.run: "mpijob",
-    }
-
-    def _resolve_crd_object_status_info(
-        self, db: DBInterface, db_session: Session, crd_object
-    ) -> typing.Tuple[bool, typing.Optional[datetime], typing.Optional[str]]:
-        """
-        https://github.com/kubeflow/mpi-operator/blob/master/pkg/apis/kubeflow/v1alpha1/types.go#L115
-        """
-        launcher_status = crd_object.get("status", {}).get("launcherStatus", "")
-        in_terminal_state = launcher_status in MPIJobV1Alpha1States.terminal_states()
-        desired_run_state = MPIJobV1Alpha1States.mpijob_state_to_run_state(
-            launcher_status
-        )
-        completion_time = None
-        if in_terminal_state:
-            completion_time = datetime.fromisoformat(
-                crd_object.get("status", {})
-                .get("completionTime")
-                .replace("Z", "+00:00")
-            )
-            desired_run_state = {
-                "Succeeded": RunStates.completed,
-                "Failed": RunStates.error,
-            }[launcher_status]
-        return in_terminal_state, completion_time, desired_run_state
-
-    @staticmethod
-    def _are_resources_coupled_to_run_object() -> bool:
-        return True
-
-    @staticmethod
-    def _get_object_label_selector(object_id: str) -> str:
-        return f"mlrun/uid={object_id}"
-
-    @staticmethod
-    def _get_main_runtime_resource_label_selector() -> str:
-        """
-        There are some runtimes which might have multiple k8s resources attached to a one runtime, in this case
-        we don't want to pull logs from all but rather only for the "driver"/"launcher" etc
-        :return: the label selector
-        """
-        return "mpi_role_type=launcher"
-
-    @staticmethod
-    def _get_run_completion_updates(run: dict) -> dict:
-
-        # TODO: add a 'workers' section in run objects state, each worker will update its state while
-        #  the run state will be resolved by the server.
-        # update the run object state if empty so that it won't default to 'created' state
-        update_in(run, "status.state", "running", append=False, replace=False)
-        return {}
-
-    @staticmethod
-    def _get_crd_info() -> typing.Tuple[str, str, str]:
-        return (
-            MpiRuntimeV1Alpha1.crd_group,
-            MpiRuntimeV1Alpha1.crd_version,
-            MpiRuntimeV1Alpha1.crd_plural,
-        )
-
-    @staticmethod
-    def _get_crd_object_status(crd_object) -> str:
-        return crd_object.get("status", {}).get("launcherStatus", "")
```

## mlrun/runtimes/sparkjob/__init__.py

```diff
@@ -10,9 +10,8 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
-from .abstract import SparkRuntimeHandler
 from .spark3job import Spark3Runtime
```

## mlrun/runtimes/sparkjob/abstract.py

```diff
@@ -10,42 +10,36 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import os.path
 import typing
 from copy import deepcopy
-from datetime import datetime
-from typing import Dict, Optional, Tuple
 
 from kubernetes import client
 from kubernetes.client.rest import ApiException
-from sqlalchemy.orm import Session
 
+import mlrun.db
 import mlrun.errors
 import mlrun.utils.regex
-from mlrun.api.db.base import DBInterface
 from mlrun.config import config
-from mlrun.db import get_run_db
 from mlrun.errors import err_to_str
-from mlrun.runtimes.base import BaseRuntimeHandler
-from mlrun.runtimes.constants import RunStates, SparkApplicationStates
 
 from ...execution import MLClientCtx
 from ...model import RunObject
 from ...platforms.iguazio import mount_v3io, mount_v3iod
 from ...utils import (
     get_in,
     logger,
     update_in,
     verify_and_update_in,
     verify_field_regex,
     verify_list_and_update_in,
 )
-from ..base import RunError, RuntimeClassMode
+from ..base import RunError
 from ..kubejob import KubejobRuntime
 from ..pod import KubeResourceSpec
 from ..utils import get_item_name, get_k8s
 
 _service_account = "sparkapp"
 _sparkjob_template = {
     "apiVersion": "sparkoperator.k8s.io/v1beta2",
@@ -238,15 +232,15 @@
         sj.spec.build.image = cls._get_default_deployed_mlrun_image_name(with_gpu)
 
         # setting required resources
         sj.with_executor_requests(cpu=1, mem="512m")
         sj.with_driver_requests(cpu=1, mem="512m")
 
         sj.deploy()
-        get_run_db().delete_function(name=sj.metadata.name)
+        mlrun.db.get_run_db().delete_function(name=sj.metadata.name)
 
     def _is_using_gpu(self):
         driver_limits = self.spec.driver_resources.get("limits")
         driver_gpu = None
         if driver_limits:
             _, driver_gpu = self._get_gpu_type_and_quantity(resources=driver_limits)
 
@@ -288,15 +282,15 @@
         :param builder_env:             Kaniko builder pod env vars dict (for config/credentials)
                                         e.g. builder_env={"GIT_TOKEN": token}
         :param show_on_failure:         show logs only in case of build failure
 
         :return True if the function is ready (deployed)
         """
         # connect will populate the config from the server config
-        get_run_db()
+        mlrun.db.get_run_db()
         if not self.spec.build.base_image:
             self.spec.build.base_image = self._default_image
         return super().deploy(
             watch=watch,
             with_mlrun=with_mlrun,
             skip_deployed=skip_deployed,
             is_kfp=is_kfp,
@@ -837,128 +831,7 @@
     @property
     def spec(self) -> AbstractSparkJobSpec:
         raise NotImplementedError()
 
     @spec.setter
     def spec(self, spec):
         raise NotImplementedError()
-
-
-class SparkRuntimeHandler(BaseRuntimeHandler):
-    kind = "spark"
-    class_modes = {
-        RuntimeClassMode.run: "spark",
-    }
-
-    def _resolve_crd_object_status_info(
-        self, db: DBInterface, db_session: Session, crd_object
-    ) -> Tuple[bool, Optional[datetime], Optional[str]]:
-        state = crd_object.get("status", {}).get("applicationState", {}).get("state")
-        in_terminal_state = state in SparkApplicationStates.terminal_states()
-        desired_run_state = SparkApplicationStates.spark_application_state_to_run_state(
-            state
-        )
-        completion_time = None
-        if in_terminal_state:
-            if crd_object.get("status", {}).get("terminationTime"):
-                completion_time = datetime.fromisoformat(
-                    crd_object.get("status", {})
-                    .get("terminationTime")
-                    .replace("Z", "+00:00")
-                )
-            else:
-                last_submission_attempt_time = crd_object.get("status", {}).get(
-                    "lastSubmissionAttemptTime"
-                )
-                if last_submission_attempt_time:
-                    last_submission_attempt_time = last_submission_attempt_time.replace(
-                        "Z", "+00:00"
-                    )
-                    completion_time = datetime.fromisoformat(
-                        last_submission_attempt_time
-                    )
-        return in_terminal_state, completion_time, desired_run_state
-
-    def _update_ui_url(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        project: str,
-        uid: str,
-        crd_object,
-        run: Dict = None,
-    ):
-        app_state = (
-            crd_object.get("status", {}).get("applicationState", {}).get("state")
-        )
-        state = SparkApplicationStates.spark_application_state_to_run_state(app_state)
-        ui_url = None
-        if state == RunStates.running:
-            ui_url = (
-                crd_object.get("status", {})
-                .get("driverInfo", {})
-                .get("webUIIngressAddress")
-            )
-        db_ui_url = run.get("status", {}).get("ui_url")
-        if db_ui_url == ui_url:
-            return
-        run.setdefault("status", {})["ui_url"] = ui_url
-        db.store_run(db_session, run, uid, project)
-
-    @staticmethod
-    def _are_resources_coupled_to_run_object() -> bool:
-        return True
-
-    @staticmethod
-    def _get_object_label_selector(object_id: str) -> str:
-        return f"mlrun/uid={object_id}"
-
-    @staticmethod
-    def _get_main_runtime_resource_label_selector() -> str:
-        """
-        There are some runtimes which might have multiple k8s resources attached to a one runtime, in this case
-        we don't want to pull logs from all but rather only for the "driver"/"launcher" etc
-        :return: the label selector
-        """
-        return "spark-role=driver"
-
-    @staticmethod
-    def _get_crd_info() -> Tuple[str, str, str]:
-        return (
-            AbstractSparkRuntime.group,
-            AbstractSparkRuntime.version,
-            AbstractSparkRuntime.plural,
-        )
-
-    def _delete_extra_resources(
-        self,
-        db: DBInterface,
-        db_session: Session,
-        namespace: str,
-        deleted_resources: typing.List[Dict],
-        label_selector: str = None,
-        force: bool = False,
-        grace_period: int = None,
-    ):
-        """
-        Handling config maps deletion
-        """
-        uids = []
-        for crd_dict in deleted_resources:
-            uid = crd_dict["metadata"].get("labels", {}).get("mlrun/uid", None)
-            uids.append(uid)
-
-        config_maps = get_k8s().v1api.list_namespaced_config_map(
-            namespace, label_selector=label_selector
-        )
-        for config_map in config_maps.items:
-            try:
-                uid = config_map.metadata.labels.get("mlrun/uid", None)
-                if force or uid in uids:
-                    get_k8s().v1api.delete_namespaced_config_map(
-                        config_map.metadata.name, namespace
-                    )
-                    logger.info(f"Deleted config map: {config_map.metadata.name}")
-            except ApiException as exc:
-                # ignore error if config map is already removed
-                if exc.status != 404:
-                    raise
```

## mlrun/serving/states.py

```diff
@@ -1512,11 +1512,11 @@
                 # if responder step (return result), add Complete()
                 step.async_object.to(storey.Complete(full_event=True))
                 wait_for_result = True
 
     source_args = context.get_param("source_args", {})
     default_source = storey.SyncEmitSource(
         context=context,
-        explicit_ack=mlrun.mlconf.httpdb.nuclio.explicit_ack == "enabled",
+        explicit_ack=mlrun.mlconf.is_explicit_ack(),
         **source_args,
     )
     return default_source, wait_for_result
```

## mlrun/utils/db.py

```diff
@@ -13,16 +13,14 @@
 # limitations under the License.
 #
 import pickle
 from datetime import datetime
 
 from sqlalchemy.orm import class_mapper
 
-run_time_fmt = "%Y-%m-%dT%H:%M:%S.%fZ"
-
 
 class BaseModel:
     def to_dict(self, exclude=None):
         """
         NOTE - this function (currently) does not handle serializing relationships
         """
         exclude = exclude or []
```

## mlrun/utils/helpers.py

```diff
@@ -31,21 +31,21 @@
 
 import git
 import numpy as np
 import pandas
 import semver
 import yaml
 from dateutil import parser
-from deprecated import deprecated
 from pandas._libs.tslibs.timestamps import Timedelta, Timestamp
 from yaml.representer import RepresenterError
 
 import mlrun
 import mlrun.common.schemas
 import mlrun.errors
+import mlrun.utils.regex
 import mlrun.utils.version.version
 from mlrun.errors import err_to_str
 
 from ..config import config
 from .logger import create_logger
 
 yaml.Dumper.ignore_aliases = lambda *args: True
@@ -234,14 +234,25 @@
         artifact_key,
         mlrun.utils.regex.artifact_key,
         raise_on_failure=raise_on_failure,
         log_message="Slashes are not permitted in the artifact key (both \\ and /)",
     )
 
 
+def validate_v3io_stream_consumer_group(
+    value: str, raise_on_failure: bool = True
+) -> bool:
+    return mlrun.utils.helpers.verify_field_regex(
+        "consumerGroup",
+        value,
+        mlrun.utils.regex.v3io_stream_consumer_group,
+        raise_on_failure=raise_on_failure,
+    )
+
+
 def get_regex_list_as_string(regex_list: List) -> str:
     """
     This function is used to combine a list of regex strings into a single regex,
     with and condition between them.
     """
     return "".join(["(?={regex})".format(regex=regex) for regex in regex_list]) + ".*$"
 
@@ -749,26 +760,14 @@
         conf.add_op_transformer(_set_artifact_path)
     if op_transformers:
         for op_transformer in op_transformers:
             conf.add_op_transformer(op_transformer)
     return conf
 
 
-# TODO: remove in 1.5.0
-@deprecated(
-    version="1.3.0",
-    reason="'new_pipe_meta' will be removed in 1.5.0",
-    category=FutureWarning,
-)
-def new_pipe_meta(artifact_path=None, ttl=None, *args):
-    return new_pipe_metadata(
-        artifact_path=artifact_path, cleanup_ttl=ttl, op_transformers=args
-    )
-
-
 def _convert_python_package_version_to_image_tag(version: typing.Optional[str]):
     return (
         version.replace("+", "-").replace("0.0.0-", "") if version is not None else None
     )
 
 
 def enrich_image_url(
@@ -1441,7 +1440,14 @@
     def __call__(self, *args, **kwargs):
         self._warn()
         return self._new_target(*args, **kwargs)
 
     def __getattr__(self, attr):
         self._warn()
         return getattr(self._new_target, attr)
+
+
+def normalize_workflow_name(name, project_name):
+    workflow_name = (
+        name.lstrip(project_name).lstrip("-") if project_name in name else name
+    )
+    return workflow_name
```

## mlrun/utils/regex.py

```diff
@@ -68,18 +68,23 @@
 sparkjob_service_name = dns_1035_label
 
 sparkjob_name = label_value + sprakjob_length + sparkjob_service_name
 
 # A project name have the following restrictions:
 # It should be a valid Nuclio Project CRD name which is dns 1123 subdomain
 # It should be a valid k8s label value since Nuclio use the project name in labels of resources
-# It should be a valid namespace name (cause we plan to map it to one) which is dns 1123 label
-# of the 3 restrictions, dns 1123 label is the most strict, so we enforce only it
+# It should be a valid namespace name (because we plan to map it to one) which is dns 1123 label
+# of the 3 restrictions, dns 1123 label is strictest, so we enforce only it
 project_name = dns_1123_label
 
 # Special characters are not permitted in tag names because they can be included in the url and cause problems.
 # We only accept letters, capital letters, numbers, dots, and hyphens, with a k8s character limit.
 tag_name = label_value
 
 secret_key = k8s_secret_and_config_map_key
 
 artifact_key = [r"[^\/\\]+$"]
+
+# must not start with _
+# must be alphanumeric or _
+# max 256 length
+v3io_stream_consumer_group = [r"^(?!_)[a-zA-Z0-9_]{1,256}$"]
```

## mlrun/utils/notifications/notification_pusher.py

```diff
@@ -16,18 +16,17 @@
 import datetime
 import os
 import typing
 from concurrent.futures import ThreadPoolExecutor
 
 from fastapi.concurrency import run_in_threadpool
 
-import mlrun.api.db.base
-import mlrun.api.db.session
 import mlrun.common.schemas
 import mlrun.config
+import mlrun.db.base
 import mlrun.lists
 import mlrun.model
 import mlrun.utils.helpers
 from mlrun.utils import logger
 from mlrun.utils.condition_evaluator import evaluate_condition_in_separate_process
 
 from .notification import NotificationBase, NotificationTypes
@@ -59,18 +58,15 @@
                     notification.status = (
                         mlrun.common.schemas.NotificationStatus.PENDING
                     )
 
                 if self._should_notify(run, notification):
                     self._load_notification(run, notification)
 
-    def push(
-        self,
-        db: mlrun.api.db.base.DBInterface = None,
-    ):
+    def push(self):
         """
         Asynchronously push notifications for all runs in the initialized runs list (if they should be pushed).
         When running from a sync environment, the notifications will be pushed asynchronously however the function will
         wait for all notifications to be pushed before returning.
         """
 
         if not len(self._sync_notifications) and not len(self._async_notifications):
@@ -78,26 +74,24 @@
 
         def _sync_push():
             for notification_data in self._sync_notifications:
                 self._push_notification_sync(
                     notification_data[0],
                     notification_data[1],
                     notification_data[2],
-                    db,
                 )
 
         async def _async_push():
             tasks = []
             for notification_data in self._async_notifications:
                 tasks.append(
                     self._push_notification_async(
                         notification_data[0],
                         notification_data[1],
                         notification_data[2],
-                        db,
                     )
                 )
 
             # return exceptions to "best-effort" fire all notifications
             await asyncio.gather(*tasks, return_exceptions=True)
 
         logger.debug(
@@ -196,108 +190,94 @@
         return message, severity, [run.to_dict()]
 
     def _push_notification_sync(
         self,
         notification: NotificationBase,
         run: mlrun.model.RunObject,
         notification_object: mlrun.model.Notification,
-        db: mlrun.api.db.base.DBInterface,
     ):
         message, severity, runs = self._prepare_notification_args(
             run, notification_object
         )
         logger.debug(
             "Pushing sync notification",
             notification=_sanitize_notification(notification_object),
             run_uid=run.metadata.uid,
         )
         try:
             notification.push(message, severity, runs)
             self._update_notification_status(
-                db,
                 run.metadata.uid,
                 run.metadata.project,
                 notification_object,
                 status=mlrun.common.schemas.NotificationStatus.SENT,
                 sent_time=datetime.datetime.now(tz=datetime.timezone.utc),
             )
         except Exception as exc:
             self._update_notification_status(
-                db,
                 run.metadata.uid,
                 run.metadata.project,
                 notification_object,
                 status=mlrun.common.schemas.NotificationStatus.ERROR,
             )
             raise exc
 
     async def _push_notification_async(
         self,
         notification: NotificationBase,
         run: mlrun.model.RunObject,
         notification_object: mlrun.model.Notification,
-        db: mlrun.api.db.base.DBInterface,
     ):
         message, severity, runs = self._prepare_notification_args(
             run, notification_object
         )
         logger.debug(
             "Pushing async notification",
             notification=_sanitize_notification(notification_object),
             run_uid=run.metadata.uid,
         )
         try:
             await notification.push(message, severity, runs)
 
             await run_in_threadpool(
                 self._update_notification_status,
-                db,
                 run.metadata.uid,
                 run.metadata.project,
                 notification_object,
                 status=mlrun.common.schemas.NotificationStatus.SENT,
                 sent_time=datetime.datetime.now(tz=datetime.timezone.utc),
             )
         except Exception as exc:
             await run_in_threadpool(
                 self._update_notification_status,
-                db,
                 run.metadata.uid,
                 run.metadata.project,
                 notification_object,
                 status=mlrun.common.schemas.NotificationStatus.ERROR,
             )
             raise exc
 
     @staticmethod
     def _update_notification_status(
-        db: mlrun.api.db.base.DBInterface,
         run_uid: str,
         project: str,
         notification: mlrun.model.Notification,
         status: str = None,
         sent_time: typing.Optional[datetime.datetime] = None,
     ):
-
-        # nothing to update if not running as api
-        # note, the notification mechanism may run "locally" for certain runtimes
-        if not mlrun.config.is_running_as_api():
-            return
-
-        # TODO: move to api side
-        db_session = mlrun.api.db.session.create_session()
+        db = mlrun.get_run_db()
         notification.status = status or notification.status
         notification.sent_time = sent_time or notification.sent_time
 
-        # store directly in db, no need to use crud as the secrets are already loaded
+        # There is no need to mask the params as the secrets are already loaded
         db.store_run_notifications(
-            db_session,
             [notification],
             run_uid,
             project,
+            mask_params=False,
         )
 
 
 class CustomNotificationPusher(object):
     def __init__(self, notification_types: typing.List[str] = None):
         notifications = {
             notification_type: NotificationTypes(notification_type).get_notification()()
```

## mlrun/utils/version/version.json

### Pretty-printed

 * *Similarity: 0.5%*

 * *Differences: {"'git_commit'": "'dcf0e7215136557c4f4d1159a1b494defce16d40'", "'version'": "'1.5.0-rc2'"}*

```diff
@@ -1,4 +1,4 @@
 {
-    "git_commit": "8657600387e10ed5be7da503d356e86e92c07c35",
-    "version": "1.5.0-rc1"
+    "git_commit": "dcf0e7215136557c4f4d1159a1b494defce16d40",
+    "version": "1.5.0-rc2"
 }
```

## Comparing `mlrun/db/sqldb.py` & `mlrun/api/rundb/sqldb.py`

 * *Files 12% similar despite different names*

```diff
@@ -11,50 +11,51 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import datetime
 from typing import List, Optional, Union
 
+from dependency_injector import containers, providers
+
+import mlrun.api.crud
 import mlrun.common.schemas
+import mlrun.db.factory
 import mlrun.model_monitoring.model_endpoint
 from mlrun.api.db.base import DBError
-from mlrun.api.db.sqldb.db import SQLDB as SQLAPIDB
+from mlrun.api.db.sqldb.db import SQLDB
 from mlrun.common.db.sql_session import create_session
+from mlrun.db import RunDBInterface
 
 # This class is a proxy for the real implementation that sits under mlrun.api.db.sqldb
 # The runtime objects (which manages the resources that do the real logic, like Nuclio functions, Dask jobs, etc...)
-# require a RunDB to manage their state, when a user run them locally this db will either be the
-# local filedb or the remote httpdb (we decided that we don't want to support SQLDB as an optional RunDB).
+# require a RunDB to manage their state, when a user run them locally this db will be a remote httpdb.
 # When the user submits something to run (task, function etc...) this runtime managers actually runs inside the api
 # service, in order to prevent the api from calling itself several times for each submission request (since the runDB
 # will be httpdb to that same api service) we have this class which is kind of a proxy between the RunDB interface to
 # the api service's DB interface
-from .base import RunDBError, RunDBInterface
 
 
-class SQLDB(RunDBInterface):
+class SQLRunDB(RunDBInterface):
     def __init__(
         self,
         dsn,
         session=None,
     ):
         self.session = session
         self.dsn = dsn
         self.db = None
 
     def connect(self, secrets=None):
         if not self.session:
             self.session = create_session()
-        self.db = SQLAPIDB(self.dsn)
+        self.db = SQLDB(self.dsn)
         return self
 
     def store_log(self, uid, project="", body=b"", append=False):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Logs().store_log,
             body,
             project,
             uid,
             append,
         )
@@ -67,43 +68,37 @@
         raise NotImplementedError(
             "This should be changed to async call, if you are running in the API, use `crud.get_log`"
             " method directly instead and not through the get_db().get_log() method"
             "This will be removed in 1.5.0",
         )
 
     def store_run(self, struct, uid, project="", iter=0):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Runs().store_run,
             self.session,
             struct,
             uid,
             iter,
             project,
         )
 
     def update_run(self, updates: dict, uid, project="", iter=0):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Runs().update_run,
             self.session,
             project,
             uid,
             iter,
             updates,
         )
 
     def abort_run(self, uid, project="", iter=0, timeout=45):
         raise NotImplementedError()
 
     def read_run(self, uid, project=None, iter=None):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Runs().get_run,
             self.session,
             uid,
             iter,
             project,
         )
@@ -127,16 +122,14 @@
         partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
         partition_order: Union[
             mlrun.common.schemas.OrderType, str
         ] = mlrun.common.schemas.OrderType.desc,
         max_partitions: int = 0,
         with_notifications: bool = False,
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Runs().list_runs,
             self.session,
             name,
             uid,
             project,
             labels,
@@ -153,54 +146,46 @@
             partition_sort_by,
             partition_order,
             max_partitions,
             with_notifications,
         )
 
     def del_run(self, uid, project=None, iter=None):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Runs().delete_run,
             self.session,
             uid,
             iter,
             project,
         )
 
     def del_runs(self, name=None, project=None, labels=None, state=None, days_ago=0):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Runs().delete_runs,
             self.session,
             name,
             project,
             labels,
             state,
             days_ago,
         )
 
     def store_artifact(self, key, artifact, uid, iter=None, tag="", project=""):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Artifacts().store_artifact,
             self.session,
             key,
             artifact,
             uid,
             iter,
             tag,
             project,
         )
 
     def read_artifact(self, key, tag="", iter=None, project=""):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Artifacts().get_artifact,
             self.session,
             key,
             tag,
             iter,
             project,
@@ -215,16 +200,14 @@
         since=None,
         until=None,
         iter: int = None,
         best_iteration: bool = False,
         kind: str = None,
         category: Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ):
-        import mlrun.api.crud
-
         if category and isinstance(category, str):
             category = mlrun.common.schemas.ArtifactCategories(category)
 
         return self._transform_db_error(
             mlrun.api.crud.Artifacts().list_artifacts,
             self.session,
             project,
@@ -236,74 +219,62 @@
             iter=iter,
             best_iteration=best_iteration,
             kind=kind,
             category=category,
         )
 
     def del_artifact(self, key, tag="", project=""):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Artifacts().delete_artifact,
             self.session,
             key,
             tag,
             project,
         )
 
     def del_artifacts(self, name="", project="", tag="", labels=None):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Artifacts().delete_artifacts,
             self.session,
             project,
             name,
             tag,
             labels,
         )
 
     def store_function(self, function, name, project="", tag="", versioned=False):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Functions().store_function,
             self.session,
             function,
             name,
             project,
             tag,
             versioned,
         )
 
     def get_function(self, name, project="", tag="", hash_key=""):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Functions().get_function,
             self.session,
             name,
             project,
             tag,
             hash_key,
         )
 
     def delete_function(self, name: str, project: str = ""):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Functions().delete_function,
             self.session,
             project,
             name,
         )
 
     def list_functions(self, name=None, project=None, tag=None, labels=None):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Functions().list_functions,
             db_session=self.session,
             project=project,
             name=name,
             tag=tag,
             labels=labels,
@@ -321,16 +292,14 @@
     def tag_objects(
         self,
         project: str,
         tag_name: str,
         tag_objects: mlrun.common.schemas.TagObjects,
         replace: bool = False,
     ):
-        import mlrun.api.crud
-
         if replace:
             return self._transform_db_error(
                 mlrun.api.crud.Tags().overwrite_object_tags_with_tag,
                 self.session,
                 project,
                 tag_name,
                 tag_objects,
@@ -346,16 +315,14 @@
 
     def delete_objects_tag(
         self,
         project: str,
         tag_name: str,
         tag_objects: mlrun.common.schemas.TagObjects,
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Tags().delete_tag_from_objects,
             self.session,
             project,
             tag_name,
             tag_objects,
         )
@@ -395,16 +362,14 @@
         return self._transform_db_error(self.db.list_schedules, self.session)
 
     def store_project(
         self,
         name: str,
         project: mlrun.common.schemas.Project,
     ) -> mlrun.common.schemas.Project:
-        import mlrun.api.crud
-
         if isinstance(project, dict):
             project = mlrun.common.schemas.Project(**project)
 
         return self._transform_db_error(
             mlrun.api.crud.Projects().store_project,
             self.session,
             name=name,
@@ -413,102 +378,88 @@
 
     def patch_project(
         self,
         name: str,
         project: dict,
         patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ) -> mlrun.common.schemas.Project:
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Projects().patch_project,
             self.session,
             name=name,
             project=project,
             patch_mode=patch_mode,
         )
 
     def create_project(
         self,
         project: mlrun.common.schemas.Project,
     ) -> mlrun.common.schemas.Project:
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Projects().create_project,
             self.session,
             project=project,
         )
 
     def delete_project(
         self,
         name: str,
         deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Projects().delete_project,
             self.session,
             name=name,
             deletion_strategy=deletion_strategy,
         )
 
     def get_project(
         self, name: str = None, project_id: int = None
     ) -> mlrun.common.schemas.Project:
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Projects().get_project,
             self.session,
             name=name,
         )
 
     def list_projects(
         self,
         owner: str = None,
         format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: List[str] = None,
         state: mlrun.common.schemas.ProjectState = None,
     ) -> mlrun.common.schemas.ProjectsOutput:
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.Projects().list_projects,
             self.session,
             owner=owner,
             format_=format_,
             labels=labels,
             state=state,
         )
 
     @staticmethod
     def _transform_db_error(func, *args, **kwargs):
         try:
             return func(*args, **kwargs)
         except DBError as exc:
-            raise RunDBError(exc.args)
+            raise mlrun.db.RunDBError(exc.args)
 
     def create_feature_set(self, feature_set, project="", versioned=True):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().create_feature_set,
             self.session,
             project,
             feature_set,
             versioned,
         )
 
     def get_feature_set(
         self, name: str, project: str = "", tag: str = None, uid: str = None
     ):
-        import mlrun.api.crud
-
         feature_set = self._transform_db_error(
             mlrun.api.crud.FeatureStore().get_feature_set,
             self.session,
             project,
             name,
             tag,
             uid,
@@ -519,16 +470,14 @@
         self,
         project: str,
         name: str = None,
         tag: str = None,
         entities: List[str] = None,
         labels: List[str] = None,
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().list_features,
             self.session,
             project,
             name,
             tag,
             entities,
@@ -538,16 +487,14 @@
     def list_entities(
         self,
         project: str,
         name: str = None,
         tag: str = None,
         labels: List[str] = None,
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().list_entities,
             self.session,
             project,
             name,
             tag,
             labels,
@@ -563,16 +510,14 @@
         features: List[str] = None,
         labels: List[str] = None,
         partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
         partition_sort_by: mlrun.common.schemas.SortField = None,
         partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().list_feature_sets,
             self.session,
             project,
             name,
             tag,
             state,
@@ -590,16 +535,14 @@
         feature_set: Union[dict, mlrun.common.schemas.FeatureSet],
         name=None,
         project="",
         tag=None,
         uid=None,
         versioned=True,
     ):
-        import mlrun.api.crud
-
         if isinstance(feature_set, dict):
             feature_set = mlrun.common.schemas.FeatureSet(**feature_set)
 
         name = name or feature_set.metadata.name
         project = project or feature_set.metadata.project
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().store_feature_set,
@@ -611,55 +554,47 @@
             uid,
             versioned,
         )
 
     def patch_feature_set(
         self, name, feature_set, project="", tag=None, uid=None, patch_mode="replace"
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().patch_feature_set,
             self.session,
             project,
             name,
             feature_set,
             tag,
             uid,
             patch_mode,
         )
 
     def delete_feature_set(self, name, project="", tag=None, uid=None):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().delete_feature_set,
             self.session,
             project,
             name,
             tag,
             uid,
         )
 
     def create_feature_vector(self, feature_vector, project="", versioned=True):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().create_feature_vector,
             self.session,
             project,
             feature_vector,
             versioned,
         )
 
     def get_feature_vector(
         self, name: str, project: str = "", tag: str = None, uid: str = None
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().get_feature_vector,
             self.session,
             project,
             name,
             tag,
             uid,
@@ -673,16 +608,14 @@
         state: str = None,
         labels: List[str] = None,
         partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
         partition_sort_by: mlrun.common.schemas.SortField = None,
         partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().list_feature_vectors,
             self.session,
             project,
             name,
             tag,
             state,
@@ -698,16 +631,14 @@
         feature_vector,
         name=None,
         project="",
         tag=None,
         uid=None,
         versioned=True,
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().store_feature_vector,
             self.session,
             project,
             name,
             feature_vector,
             tag,
@@ -720,39 +651,51 @@
         name,
         feature_vector_update: dict,
         project="",
         tag=None,
         uid=None,
         patch_mode="replace",
     ):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().patch_feature_vector,
             self.session,
             project,
             name,
             feature_vector_update,
             tag,
             uid,
             patch_mode,
         )
 
     def delete_feature_vector(self, name, project="", tag=None, uid=None):
-        import mlrun.api.crud
-
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().delete_feature_vector,
             self.session,
             project,
             name,
             tag,
             uid,
         )
 
+    def store_run_notifications(
+        self,
+        notification_objects: List[mlrun.model.Notification],
+        run_uid: str,
+        project: str = None,
+        mask_params: bool = True,
+    ):
+        return self._transform_db_error(
+            mlrun.api.crud.Notifications().store_run_notifications,
+            self.session,
+            notification_objects,
+            run_uid,
+            project,
+            mask_params,
+        )
+
     def list_pipelines(
         self,
         project: str,
         namespace: str = None,
         sort_by: str = "",
         page_token: str = "",
         filter_: str = "",
@@ -905,7 +848,16 @@
     def verify_authorization(
         self,
         authorization_verification_input: mlrun.common.schemas.AuthorizationVerificationInput,
     ):
         # on server side authorization is done in endpoint anyway, so for server side we can "pass" on check
         # done from ingest()
         pass
+
+    def watch_log(self, uid, project="", watch=True, offset=0):
+        raise NotImplementedError("Watching logs is not supported on the server")
+
+
+# Once this file is imported it will override the default RunDB implementation (RunDBContainer)
+@containers.override(mlrun.db.factory.RunDBContainer)
+class SQLRunDBContainer(containers.DeclarativeContainer):
+    run_db = providers.Factory(SQLRunDB)
```

## Comparing `mlrun/mlutils/__init__.py` & `mlrun/api/rundb/__init__.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,17 +1,13 @@
-# Copyright 2023 Iguazio
+# Copyright 2023 MLRun Authors
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
-#   http://www.apache.org/licenses/LICENSE-2.0
+#     http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-#
-# flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
-# for backwards compatibility
-from ..utils.helpers import create_class, create_function
```

## Comparing `mlrun-1.5.0rc1.dist-info/LICENSE` & `mlrun-1.5.0rc2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mlrun-1.5.0rc1.dist-info/METADATA` & `mlrun-1.5.0rc2.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mlrun
-Version: 1.5.0rc1
+Version: 1.5.0rc2
 Summary: Tracking and config of machine learning runs
 Home-page: https://github.com/mlrun/mlrun
 Author: Yaron Haviv
 Author-email: yaronh@iguazio.com
 License: MIT
 Platform: UNKNOWN
 Classifier: Development Status :: 4 - Beta
@@ -44,129 +44,130 @@
 Requires-Dist: alembic (~=1.9)
 Requires-Dist: mergedeep (~=1.3)
 Requires-Dist: v3io-frames (~=0.10.4)
 Requires-Dist: semver (~=2.13)
 Requires-Dist: dask (~=2021.11.2)
 Requires-Dist: distributed (~=2021.11.2)
 Requires-Dist: kubernetes (~=12.0)
+Requires-Dist: dependency-injector (~=4.41)
 Requires-Dist: humanfriendly (~=9.2)
 Requires-Dist: fastapi (~=0.95.2)
-Requires-Dist: fsspec (~=2023.1.0)
+Requires-Dist: fsspec (~=2023.6.0)
 Requires-Dist: v3iofs (~=0.1.15)
-Requires-Dist: storey (~=1.5.0)
+Requires-Dist: storey (~=1.5.2)
 Requires-Dist: deepdiff (~=5.0)
 Requires-Dist: pymysql (~=1.0)
 Requires-Dist: inflection (~=0.5.0)
 Requires-Dist: python-dotenv (~=0.17.0)
 Requires-Dist: setuptools (~=65.5)
 Requires-Dist: deprecated (~=1.2)
 Requires-Dist: jinja2 (~=3.1)
 Provides-Extra: all
-Requires-Dist: adlfs (~=2022.2.0) ; extra == 'all'
-Requires-Dist: aiobotocore (~=2.4.2) ; extra == 'all'
+Requires-Dist: adlfs (~=2023.4.0) ; extra == 'all'
+Requires-Dist: aiobotocore (~=2.5.2) ; extra == 'all'
 Requires-Dist: avro (~=1.11) ; extra == 'all'
 Requires-Dist: azure-core (~=1.24) ; extra == 'all'
 Requires-Dist: azure-identity (~=1.5) ; extra == 'all'
 Requires-Dist: azure-keyvault-secrets (~=4.2) ; extra == 'all'
 Requires-Dist: azure-storage-blob (~=12.13) ; extra == 'all'
 Requires-Dist: bokeh (>=2.4.2,~=2.4) ; extra == 'all'
-Requires-Dist: boto3 (~=1.24.59) ; extra == 'all'
-Requires-Dist: gcsfs (~=2023.1.0) ; extra == 'all'
+Requires-Dist: boto3 (~=1.26.161) ; extra == 'all'
+Requires-Dist: gcsfs (~=2023.6.0) ; extra == 'all'
 Requires-Dist: google-cloud-bigquery[bqstorage,pandas] (~=3.2) ; extra == 'all'
 Requires-Dist: google-cloud-storage (~=1.20) ; extra == 'all'
 Requires-Dist: google-cloud (~=0.34) ; extra == 'all'
 Requires-Dist: graphviz (~=0.20.0) ; extra == 'all'
 Requires-Dist: kafka-python (~=2.0) ; extra == 'all'
 Requires-Dist: msrest (~=0.6.21) ; extra == 'all'
 Requires-Dist: plotly (<5.12.0,~=5.4) ; extra == 'all'
 Requires-Dist: pyopenssl (>=23) ; extra == 'all'
 Requires-Dist: redis (~=4.3) ; extra == 'all'
-Requires-Dist: s3fs (~=2023.1.0) ; extra == 'all'
+Requires-Dist: s3fs (~=2023.6.0) ; extra == 'all'
 Provides-Extra: api
 Requires-Dist: uvicorn (~=0.20.0) ; extra == 'api'
 Requires-Dist: dask-kubernetes (~=0.11.0) ; extra == 'api'
 Requires-Dist: apscheduler (~=3.6) ; extra == 'api'
 Requires-Dist: sqlite3-to-mysql (~=1.4) ; extra == 'api'
 Requires-Dist: objgraph (~=3.5) ; extra == 'api'
 Requires-Dist: igz-mgmt (~=0.0.10) ; extra == 'api'
 Provides-Extra: azure-blob-storage
 Requires-Dist: msrest (~=0.6.21) ; extra == 'azure-blob-storage'
 Requires-Dist: azure-core (~=1.24) ; extra == 'azure-blob-storage'
 Requires-Dist: azure-storage-blob (~=12.13) ; extra == 'azure-blob-storage'
-Requires-Dist: adlfs (~=2022.2.0) ; extra == 'azure-blob-storage'
+Requires-Dist: adlfs (~=2023.4.0) ; extra == 'azure-blob-storage'
 Requires-Dist: pyopenssl (>=23) ; extra == 'azure-blob-storage'
 Provides-Extra: azure-key-vault
 Requires-Dist: azure-identity (~=1.5) ; extra == 'azure-key-vault'
 Requires-Dist: azure-keyvault-secrets (~=4.2) ; extra == 'azure-key-vault'
 Requires-Dist: pyopenssl (>=23) ; extra == 'azure-key-vault'
 Provides-Extra: bokeh
 Requires-Dist: bokeh (>=2.4.2,~=2.4) ; extra == 'bokeh'
 Provides-Extra: complete
-Requires-Dist: adlfs (~=2022.2.0) ; extra == 'complete'
-Requires-Dist: aiobotocore (~=2.4.2) ; extra == 'complete'
+Requires-Dist: adlfs (~=2023.4.0) ; extra == 'complete'
+Requires-Dist: aiobotocore (~=2.5.2) ; extra == 'complete'
 Requires-Dist: avro (~=1.11) ; extra == 'complete'
 Requires-Dist: azure-core (~=1.24) ; extra == 'complete'
 Requires-Dist: azure-identity (~=1.5) ; extra == 'complete'
 Requires-Dist: azure-keyvault-secrets (~=4.2) ; extra == 'complete'
 Requires-Dist: azure-storage-blob (~=12.13) ; extra == 'complete'
-Requires-Dist: boto3 (~=1.24.59) ; extra == 'complete'
-Requires-Dist: gcsfs (~=2023.1.0) ; extra == 'complete'
+Requires-Dist: boto3 (~=1.26.161) ; extra == 'complete'
+Requires-Dist: gcsfs (~=2023.6.0) ; extra == 'complete'
 Requires-Dist: google-cloud-bigquery[bqstorage,pandas] (~=3.2) ; extra == 'complete'
 Requires-Dist: graphviz (~=0.20.0) ; extra == 'complete'
 Requires-Dist: kafka-python (~=2.0) ; extra == 'complete'
 Requires-Dist: msrest (~=0.6.21) ; extra == 'complete'
 Requires-Dist: plotly (<5.12.0,~=5.4) ; extra == 'complete'
 Requires-Dist: pyopenssl (>=23) ; extra == 'complete'
 Requires-Dist: redis (~=4.3) ; extra == 'complete'
-Requires-Dist: s3fs (~=2023.1.0) ; extra == 'complete'
+Requires-Dist: s3fs (~=2023.6.0) ; extra == 'complete'
 Provides-Extra: complete-api
-Requires-Dist: adlfs (~=2022.2.0) ; extra == 'complete-api'
-Requires-Dist: aiobotocore (~=2.4.2) ; extra == 'complete-api'
+Requires-Dist: adlfs (~=2023.4.0) ; extra == 'complete-api'
+Requires-Dist: aiobotocore (~=2.5.2) ; extra == 'complete-api'
 Requires-Dist: apscheduler (~=3.6) ; extra == 'complete-api'
 Requires-Dist: avro (~=1.11) ; extra == 'complete-api'
 Requires-Dist: azure-core (~=1.24) ; extra == 'complete-api'
 Requires-Dist: azure-identity (~=1.5) ; extra == 'complete-api'
 Requires-Dist: azure-keyvault-secrets (~=4.2) ; extra == 'complete-api'
 Requires-Dist: azure-storage-blob (~=12.13) ; extra == 'complete-api'
-Requires-Dist: boto3 (~=1.24.59) ; extra == 'complete-api'
+Requires-Dist: boto3 (~=1.26.161) ; extra == 'complete-api'
 Requires-Dist: dask-kubernetes (~=0.11.0) ; extra == 'complete-api'
-Requires-Dist: gcsfs (~=2023.1.0) ; extra == 'complete-api'
+Requires-Dist: gcsfs (~=2023.6.0) ; extra == 'complete-api'
 Requires-Dist: google-cloud-bigquery[bqstorage,pandas] (~=3.2) ; extra == 'complete-api'
 Requires-Dist: graphviz (~=0.20.0) ; extra == 'complete-api'
 Requires-Dist: igz-mgmt (~=0.0.10) ; extra == 'complete-api'
 Requires-Dist: kafka-python (~=2.0) ; extra == 'complete-api'
 Requires-Dist: msrest (~=0.6.21) ; extra == 'complete-api'
 Requires-Dist: objgraph (~=3.5) ; extra == 'complete-api'
 Requires-Dist: plotly (<5.12.0,~=5.4) ; extra == 'complete-api'
 Requires-Dist: pyopenssl (>=23) ; extra == 'complete-api'
 Requires-Dist: redis (~=4.3) ; extra == 'complete-api'
-Requires-Dist: s3fs (~=2023.1.0) ; extra == 'complete-api'
+Requires-Dist: s3fs (~=2023.6.0) ; extra == 'complete-api'
 Requires-Dist: sqlite3-to-mysql (~=1.4) ; extra == 'complete-api'
 Requires-Dist: uvicorn (~=0.20.0) ; extra == 'complete-api'
 Provides-Extra: google-cloud
 Requires-Dist: google-cloud-storage (~=1.20) ; extra == 'google-cloud'
 Requires-Dist: google-cloud-bigquery[bqstorage,pandas] (~=3.2) ; extra == 'google-cloud'
 Requires-Dist: google-cloud (~=0.34) ; extra == 'google-cloud'
 Provides-Extra: google-cloud-bigquery
 Requires-Dist: google-cloud-bigquery[bqstorage,pandas] (~=3.2) ; extra == 'google-cloud-bigquery'
 Provides-Extra: google-cloud-storage
-Requires-Dist: gcsfs (~=2023.1.0) ; extra == 'google-cloud-storage'
+Requires-Dist: gcsfs (~=2023.6.0) ; extra == 'google-cloud-storage'
 Provides-Extra: graphviz
 Requires-Dist: graphviz (~=0.20.0) ; extra == 'graphviz'
 Provides-Extra: kafka
 Requires-Dist: kafka-python (~=2.0) ; extra == 'kafka'
 Requires-Dist: avro (~=1.11) ; extra == 'kafka'
 Provides-Extra: plotly
 Requires-Dist: plotly (<5.12.0,~=5.4) ; extra == 'plotly'
 Provides-Extra: redis
 Requires-Dist: redis (~=4.3) ; extra == 'redis'
 Provides-Extra: s3
-Requires-Dist: boto3 (~=1.24.59) ; extra == 's3'
-Requires-Dist: aiobotocore (~=2.4.2) ; extra == 's3'
-Requires-Dist: s3fs (~=2023.1.0) ; extra == 's3'
+Requires-Dist: boto3 (~=1.26.161) ; extra == 's3'
+Requires-Dist: aiobotocore (~=2.5.2) ; extra == 's3'
+Requires-Dist: s3fs (~=2023.6.0) ; extra == 's3'
 
 <a id="top"></a>
 [![Build Status](https://github.com/mlrun/mlrun/workflows/CI/badge.svg)](https://github.com/mlrun/mlrun/actions)
 [![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
 [![PyPI version fury.io](https://badge.fury.io/py/mlrun.svg)](https://pypi.python.org/pypi/mlrun/)
 [![Documentation](https://readthedocs.org/projects/mlrun/badge/?version=latest)](https://mlrun.readthedocs.io/en/latest/?badge=latest)
 [![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)
```

## Comparing `mlrun-1.5.0rc1.dist-info/RECORD` & `mlrun-1.5.0rc2.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -1,88 +1,90 @@
-mlrun/__init__.py,sha256=2lyTZ4KP8Qo-7Vbyln6QAyN_4cZGxB0dTa0-Ih3GAPo,8770
-mlrun/__main__.py,sha256=BIVMSZwO-AGL6HRFML7XsROQgIRFqtbnIldN4QzTWu0,49544
-mlrun/config.py,sha256=xkoTxYY5UquOg8DnlWQ7IKrOPeEz4GGbef2DvyLPoHk,56719
+mlrun/__init__.py,sha256=adWxPTY8n0qaMkwt3KVGPN2hZeHT4vcG7lWZxBewEg4,7279
+mlrun/__main__.py,sha256=WeCDL8gBtdACJtSoAIusxM8-lCPoUPbgt_b_GUEV6l8,48410
+mlrun/config.py,sha256=lkxnwIvJf48E-vWBUH25AKmr3ej4DIgaGcQOSAd4NEw,56571
 mlrun/errors.py,sha256=pYZZtJsMqkFktG6T8iTyfyESrrhOLfKvB3U_jUDHMo8,6780
-mlrun/execution.py,sha256=HC8VWHfzjekjFoIO7YrWqOKfNimAEkw-GRJWoKJrwWA,39600
+mlrun/execution.py,sha256=DPy9QzI18sRrI8vu4qXChl7QAPbc5swi_AU7E5YWBj0,39723
 mlrun/features.py,sha256=UQQ2uh5Xh9XsMGiYBqh3bKgDhOHANjv1gQgWyId9qQE,15624
 mlrun/k8s_utils.py,sha256=DhaLjX9Y4n6MZ-Gie2puEQ7LNQ9N6yUmnu6W_Y5ifMU,4876
-mlrun/kfpops.py,sha256=4yCeLqqkO0-vXeFE2AVjnH8k-KRh-6ObQoo6f6cNfnQ,29701
-mlrun/lists.py,sha256=zgJR-dqK0Q2VzLsj9fR1NwQSelKlqbOoyV22g8F62iw,8779
-mlrun/model.py,sha256=6iOLabmsn9dZPdJVUBJcD-CPBL2DLVAPYW0S69kBjdY,60635
-mlrun/render.py,sha256=p-I_a1wYFtipZm6REQYEL2RsZv8DyX-ZC_uDRG9EH9k,13016
-mlrun/run.py,sha256=XKCL-MUme0z9OnurQ9o7vizslXiG80ncQVF-Vr1kdik,51474
+mlrun/kfpops.py,sha256=ezBWKexTjI7krBegx5aKY_6qn0fo1a3oFSBUctcsDbQ,29489
+mlrun/lists.py,sha256=lMbcVvtS5MLI40JPtT5ithTojX8xUZx4RkZX0-L9zUE,8390
+mlrun/model.py,sha256=fiUSUifDw1WbQFTi6rA0HF9Re9nmQqSnEmaVF4NjXIo,60317
+mlrun/render.py,sha256=a_s-kzQ35bJg7e7cBxk3MCnoIK4qvDS2dGO8RzHgI1c,13016
+mlrun/run.py,sha256=UK2HdQ9kXmQGzE1H0_ogs-cS0mjmnF3dIe3C20EYATU,47007
 mlrun/secrets.py,sha256=hr2Ia9kLkoMM3KoxijXqO6AIJOUrrLxvz4Q7Xk39d4Y,7783
 mlrun/api/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/alembic.ini,sha256=oeSJRHwBbF3c3-N_RJilcZD-diq3F-oPv21gDIkrZGs,2105
 mlrun/api/constants.py,sha256=8xjdBYxt3-5_osRk_rII1nabyL3zMVOxnCJ6YrEhdFQ,685
 mlrun/api/initial_data.py,sha256=Ow2nWkgGc3AoJqZMaVnMpgLspJlREpBYfOquW9aV4eA,25653
-mlrun/api/launcher.py,sha256=mEzliYHvDO7X6hF5l5CV6n47DSznX7PItoOlFb_Xm4Y,8068
-mlrun/api/main.py,sha256=VXcEhpcXJusdYOieEDDQq-ejuzK6oFolrbeiOD31wzY,27304
+mlrun/api/launcher.py,sha256=kv7vf-HBxH-55KbY3tnYvxBGEJCzzvcJMCoNUsdnY4g,8681
+mlrun/api/main.py,sha256=4HLGz7lGW7b0WNuIoX3PzMzlCSuGqu47IVJ3rOrYB0k,27263
 mlrun/api/middlewares.py,sha256=JXI4HOR-2w9Cf30my4vMK-pC1zgAFHK65NzFYgRcOuI,5289
 mlrun/api/api/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
-mlrun/api/api/api.py,sha256=xlWyl79-XpiLp1fAIeFJ5jYvMmHYUm661Zi3rLq2e8U,4243
+mlrun/api/api/api.py,sha256=I2ctjy96mjVcncmMU94BoQU0KzFhrmVRYcI8zImQWkg,4402
 mlrun/api/api/deps.py,sha256=4jSegE1XNWvy93LKnI-NGvR-yhJdNqueVGHFJLKldpg,3197
-mlrun/api/api/utils.py,sha256=8DW0zJ--IhqSUVFRFsevXZsAxmHdbTFfOjGslCcUnms,40172
+mlrun/api/api/utils.py,sha256=50UM15EfFLXW_XtxZ_58AE540T8fvyJeZT55RNdn2GM,40170
 mlrun/api/api/endpoints/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/api/endpoints/artifacts.py,sha256=-MPAuhzyepyd6Fxa5ZFidcDksNGP_Vmd2DRnFND7ug0,10452
 mlrun/api/api/endpoints/auth.py,sha256=hoqYSELX_6Zi3Cvep2nGLJgBo4YbMJoCt3WwbEZrnDU,1199
 mlrun/api/api/endpoints/background_tasks.py,sha256=5SV4iDF-dZR878kp77VpANRb86BJYgffrHnGsM4gQ3o,3618
 mlrun/api/api/endpoints/client_spec.py,sha256=lN2By-KGzHuzNTGiJk0RK3SM6ZUr3VLgsudsymrtZE8,1214
 mlrun/api/api/endpoints/clusterization_spec.py,sha256=0eSG7TSt647V7-A-uI5CLRItkVOBqIBM9ep_fiMFqPI,1175
-mlrun/api/api/endpoints/feature_store.py,sha256=pFvKtnFcv3pw9hHxMBfdqZ-txl9tXKKpd6Ds9EMsQs4,29192
-mlrun/api/api/endpoints/files.py,sha256=Ivq6UO0GrVjXD_QhUEKCILH9qHXMJkQfml7WHlWNPXI,6370
+mlrun/api/api/endpoints/feature_store.py,sha256=mq6XVv9zaW7zU-XRHh8X2gTwk-z6a1QE3bcuOdR6jQU,28853
+mlrun/api/api/endpoints/files.py,sha256=2pYv6JG_SKxjNB4QqXu7ssmluEElSoOZ1NJeHASPz98,6709
 mlrun/api/api/endpoints/frontend_spec.py,sha256=ppmYdRS6_JqEDBcArTnT0EOXidVtiDoA1zYJwa_4A70,5946
-mlrun/api/api/endpoints/functions.py,sha256=_uVKRfs9TmqBpV2KlzPnryEPo0nIbMvtBdHKkfggavY,38107
+mlrun/api/api/endpoints/functions.py,sha256=Exi-B-SZg_3Jbu8Q820cS4D8K5nhGpULcDw0l2wlFds,38214
 mlrun/api/api/endpoints/grafana_proxy.py,sha256=5PvWjqTeb88kNtuTtZub9eFgr6I0ORlmPXGHk6G1QfM,6086
 mlrun/api/api/endpoints/healthz.py,sha256=DVNb94DLQhmQWxxo5d3AZbd82AL_PGuzU6NJ3IT5pkA,1344
 mlrun/api/api/endpoints/hub.py,sha256=3v9SQKUdZt2LNpGpegbQXaRsjGty4fujA9DBCVwGKUk,10312
-mlrun/api/api/endpoints/logs.py,sha256=SBhmnDybiA9GWp-93Ct_e57AtpeGvIG4s2k9NwXTeL0,2445
+mlrun/api/api/endpoints/logs.py,sha256=jMoRvAxgIIcwNahTbH_FPScND_m_Yez91SS92KUGahw,2975
 mlrun/api/api/endpoints/model_endpoints.py,sha256=nSqZZcSKl_mGb13Sa-CXCfIBBZwZvxkvFoGnb3VdX0M,15734
 mlrun/api/api/endpoints/operations.py,sha256=tLqaRsyVP8CxCv8H_IDg3GtJW040xY5F_D5exLF7bGg,3756
-mlrun/api/api/endpoints/pipelines.py,sha256=hKPzWOQXdhOdwZUt4Ik0jCFc_TbB6bTeGOhWuJhiegM,9231
-mlrun/api/api/endpoints/projects.py,sha256=NGpJzBRFDUTuNDz6PYtyJP72wV07_ZfFA5BPTQYPK7k,11494
-mlrun/api/api/endpoints/runs.py,sha256=ft4Gkup7L-nug_LY8q8NXX0hr7L-8q7RvOVpiqxa6TA,10372
+mlrun/api/api/endpoints/pipelines.py,sha256=1tyw8E9fS4K2MeVHSyd3ED1uPVLO0KUmddamsODdtLg,9098
+mlrun/api/api/endpoints/projects.py,sha256=nCHgjYNxC4_E33WB_kWoFj-3yULxE11f39xJcH0M8F8,14736
+mlrun/api/api/endpoints/runs.py,sha256=KgB65u6X7WS7JKo_9Z4psSHvrCWconB2ahnfwV6WXpE,11881
 mlrun/api/api/endpoints/runtime_resources.py,sha256=_Nv7CJTRI4gimlDbwufEWRJQhZFK9UNqIcJjDYwOkg0,9035
 mlrun/api/api/endpoints/schedules.py,sha256=Ko2dtaNKb3dHzjWR_LeoVFbhxCxkDDhaQ-ERRKmBC38,12544
 mlrun/api/api/endpoints/secrets.py,sha256=jPOQiTXMRUYcR9K0NT74ScNQaZpI1o-DMUnjtt6RsvE,6061
 mlrun/api/api/endpoints/submit.py,sha256=xKUX-9q6Zh0s9XOZueorn-Dc6knK4eSz3SS73Q0fXKc,5327
 mlrun/api/api/endpoints/tags.py,sha256=KIZziSd6XF2TR94b_4_UDsptXHecDXgOIwQYFRApGmA,4849
+mlrun/api/api/endpoints/workflows.py,sha256=vZEgZ6gEDdTRJgBxJPd8-XIsyNsNGUZxTrFSntMhG3c,13795
 mlrun/api/api/endpoints/internal/__init__.py,sha256=IVXgIyUv8lVStgCjFm3fZDDMIqEzmMAvkbbbOKwNJgo,1203
 mlrun/api/api/endpoints/internal/config.py,sha256=IVqf6YWokNXY3LC5o1BWqlEDVQ-AJdRrbWRwTFFAwfY,1043
 mlrun/api/api/endpoints/internal/memory_reports.py,sha256=PRVaj8i_WAbIqjP37xBlYfPunkZHTCXMprka0Qoxhxw,1718
-mlrun/api/crud/__init__.py,sha256=db07-1MAR-TrUI3NUUqvHV4ApGm0sYu1sCeDoxuJ5Mo,1209
+mlrun/api/crud/__init__.py,sha256=nQO8wnRDTpto2gs0CeivRodpr_Voa0eCqL-NthBpy-k,1248
 mlrun/api/crud/artifacts.py,sha256=Z0CzdgywxS352DD0MumACDfGg92VqZlOcBSw8FCRao8,5610
-mlrun/api/crud/client_spec.py,sha256=EUXRRpsonRjcFjYeCZrzOHcgcShrGperEAnq56Ly_2E,7378
+mlrun/api/crud/client_spec.py,sha256=mMeK2UQ6b68TvanFqLEeTn0sRJmKHg5smriIhnij50k,7536
 mlrun/api/crud/clusterization_spec.py,sha256=6riIRpWf1dGTRUSi1lLeydO-3KCcnpQ-Y_AuUCm5i7k,1055
 mlrun/api/crud/feature_store.py,sha256=Wizxaq6MXmj77Q4lR0-VawoSR3lmEDFQuaylmLtUTBM,18971
 mlrun/api/crud/functions.py,sha256=zub_q2QJ617kmokLMwdIHF5Mf7-o15amNXfFgOhg7n4,3556
 mlrun/api/crud/hub.py,sha256=qg1rkRPdLF5qDpaUKNSACmaEEHGhY1vThfOoiPiAfXw,12025
 mlrun/api/crud/logs.py,sha256=vFi9hynLqRT81erkGU2lhGmo394huYV3hoIkiInhspQ,9409
-mlrun/api/crud/notifications.py,sha256=8rMI5jLs4uI5v-kmIHUMLjps0QcUHOAZtcPWtaQpOck,5498
-mlrun/api/crud/pipelines.py,sha256=N_JIDhVnuIWnzOKEa_Or8eUcF-dl_HRjT-_R5CRmiQk,14999
+mlrun/api/crud/notifications.py,sha256=Y4n-JYbFatBdHpIAuWOwLa2ilcTpfsM89Kyo1gmLuI8,5739
+mlrun/api/crud/pipelines.py,sha256=Z5_0RebYRglvSz7pN0GTCCYRC723U4d8D0U_DsfI7WQ,14781
 mlrun/api/crud/projects.py,sha256=yUeQDqNYeVJLoPKZNRNMBMwBaYU_g9dBpkUHy4ow-tA,15240
 mlrun/api/crud/runs.py,sha256=W_ahD8aFZCqJBfiLmxVkcjvLpJYaeHHF729vmEHLH4o,5963
-mlrun/api/crud/runtime_resources.py,sha256=trqxzAXPBZ6T27wJ1MQjH8lmYf32BRSMqpwQmVP9pWQ,5575
-mlrun/api/crud/secrets.py,sha256=EAgteRRYXCLzO5Rq7e-CfoQ_j-I4tZo65H-FOSmJAio,21560
+mlrun/api/crud/runtime_resources.py,sha256=hAulDtCyWrMDTe35gIetg3ApiHumBmCA7Ap3Fo2fSqw,5645
+mlrun/api/crud/secrets.py,sha256=8E5-DUwZDb0XB6frYIx_pUdFLumfk-yAR7qXasJ1GZ8,22158
 mlrun/api/crud/tags.py,sha256=pcXXrmlfgCBCtw5uBX6hAHdqO96XIg0ov5vn-u6r5Q4,3277
+mlrun/api/crud/workflows.py,sha256=C92wZmMBWAtawzNkR9-WWy3B5qxskcb40x-6blAbWXQ,13193
 mlrun/api/crud/model_monitoring/__init__.py,sha256=_rZmfvis_Qkhephv_SEgzqUVuC4bY-D84mCyyztWRs0,759
-mlrun/api/crud/model_monitoring/deployment.py,sha256=XD3tBT6ECHhNt1l970xFRwoMlykHEOqJ7Q8SO7kW1Qs,19956
-mlrun/api/crud/model_monitoring/grafana.py,sha256=WUn6Gk_W3vl6On4NuRT0E9ht-Nkz3CoqBkzxocDahV4,17486
-mlrun/api/crud/model_monitoring/helpers.py,sha256=0TR8u7TjHMR5n5ZA6uDr55Frm_Jmj04HKT-HqdvcwVc,4613
-mlrun/api/crud/model_monitoring/model_endpoints.py,sha256=loxq2ZFuoYU-ffa5duHDTUXqQqCZhiL2qaE1SxOyB4E,30723
+mlrun/api/crud/model_monitoring/deployment.py,sha256=EJgxqFA-PjaKtXCPCK7k741UbAt2O1NGJqul6pASUic,21692
+mlrun/api/crud/model_monitoring/grafana.py,sha256=7D-sUY3PjFh7_HjYe-KWryvepxO9zLArVC3U7IChuqA,17494
+mlrun/api/crud/model_monitoring/helpers.py,sha256=ry6OvaeUJHbzNxwK8Fs8cWs1UdX2uMrximGP9oaMc2c,5581
+mlrun/api/crud/model_monitoring/model_endpoints.py,sha256=2ZqFrjP5YN1O2CcjhgPdCag3w5eL6zxaQQz2_BBdj8Y,31573
 mlrun/api/crud/runtimes/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/crud/runtimes/nuclio/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/crud/runtimes/nuclio/function.py,sha256=Tgca7uACPlyeoGiLkIHsX0d9SePy_a6pEW03ryGMdPc,18762
 mlrun/api/crud/runtimes/nuclio/helpers.py,sha256=lx1apUFTUvKC9Itq1jEF0xPL4IhcaKf0G_qTNyOO6jM,11510
 mlrun/api/db/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
-mlrun/api/db/base.py,sha256=2fLNvPoswwWorbq85OgTHxX6hqu584JPZdq-J6QJUiU,15311
+mlrun/api/db/base.py,sha256=wjlLwEf2plcHMBEXIeAXzEJeI6BihHf6nSRCC51dtIU,15769
 mlrun/api/db/init_db.py,sha256=WTHphTsHl-ZKszZsQk3V-lFTzIEbWYJADolleugQ8eg,739
 mlrun/api/db/session.py,sha256=VXNLPqYpLOVUqaWdkzgve2nzYxVCF991Wv98GALJGas,994
 mlrun/api/db/sqldb/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
-mlrun/api/db/sqldb/db.py,sha256=uX986AXcpitUtx61__1cjSgFuYctLvLG4rXmKd4FhP4,148913
+mlrun/api/db/sqldb/db.py,sha256=ZZmvotgc0JS2nZtDwFSQk-zXvfzIE7Vcau47B_Z-d9Y,151630
 mlrun/api/db/sqldb/helpers.py,sha256=Asc_cDFE2e7gbQ3SVriYyyK4yu94wfOemYPYCMpNLws,2340
 mlrun/api/db/sqldb/models/__init__.py,sha256=oD0qix1voOtUiP-fG04QK5VHOPageoclcSjw0PIoBQY,1105
 mlrun/api/db/sqldb/models/models_mysql.py,sha256=uMqx79fm5msRVJVfa1qvhWKW3tJAvziaHWptkmQi_XY,21345
 mlrun/api/db/sqldb/models/models_sqlite.py,sha256=y73PcQQgN8WtLAHYHGrquBE-5cho4ANiIYlnXV65zxY,19014
 mlrun/api/migrations_mysql/env.py,sha256=DYsmYYPMvbXxrkuEPzWUJcq9tzJrHIZkpJ0rrKdjmdw,2906
 mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py,sha256=JhNw92kyWYT80zhvUN4x2zyvme_O1-i-vRFuYH3DM18,1203
 mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py,sha256=mFG4HN_xHf13bf_Ow6L0AHwyl3lQK0wIvEYuwQgKBoY,4614
@@ -110,31 +112,40 @@
 mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py,sha256=6uIiHz_MlT1hs8JjxiKRA_JEizH1wzU7VprO-vzEJIY,1420
 mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py,sha256=0s4JdFH6fICbdJDJMTgjWjtqX0gjbHf-3IMVtogxabU,2034
 mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py,sha256=HfjkoI0J8cFOuzHYlVhtjT49K7KCjrkYOdu7pNLXj5Y,1828
 mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py,sha256=XxndhUXxVFypeFdOrudpWpV2kFcjEXb4ESoe95PLHb4,1380
 mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py,sha256=tIMEPe8YONGqDerbhjTyBk71krmqEKXAqaTNcK_OuBM,1831
 mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py,sha256=bjjjtMy5IgM-kWefKmql4B-xiS49bvSF5aYSR8mXzUE,3936
 mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py,sha256=9YQL4ikdN4URenEiAGWNdFwNkTpuF-Uccr5Eo8RENrk,2588
+mlrun/api/rundb/__init__.py,sha256=pZgS6ZN126aJme4z5spCX-RmdchShxMnQeCPya8AsQI,577
+mlrun/api/rundb/sqldb.py,sha256=siEq_GtZUCGaowImazXvMcApz5gCuPDp399X1xETH4Q,25246
+mlrun/api/runtime_handlers/__init__.py,sha256=zJ8yU2_X1ePSwCmmoPE80IKmKcYmif7gCCkdOt0c61A,2523
+mlrun/api/runtime_handlers/base.py,sha256=TCGatXtOeXLbkAYD0xvZlpu5G_eg5gj81PkGC9RJZy0,50942
+mlrun/api/runtime_handlers/daskjob.py,sha256=34dUUrjT-sn8G2B5kMb6NSbpaTY9e8RWxec8Z2_3gJc,7886
+mlrun/api/runtime_handlers/kubejob.py,sha256=sCAuyKa2AZWt44vcOSuQdx1z7ss0MW5dl3lEn8v3bu4,1309
+mlrun/api/runtime_handlers/mpijob.py,sha256=KmduYwOr3tU8VHTZMVyu20XxW_FoTMv2RCFo3xP55FQ,5433
+mlrun/api/runtime_handlers/remotesparkjob.py,sha256=fxLdwwpb45dfx5VkuDDjiRD0IYj0kxDlCllec_Fam_Y,1036
+mlrun/api/runtime_handlers/sparkjob.py,sha256=4f8PA6OSmhJ2EtDsuRdJV0Us7-hjILFp9iZYYTFwXRM,5440
 mlrun/api/schemas/__init__.py,sha256=ckAFziB1YgJTsIoY-Dd1iUh8nZMKLsLT_W40dCAixg8,13571
 mlrun/api/utils/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/utils/asyncio.py,sha256=Uaekrr2Gw55ivhqmxdXIDBgFmcH48p94XfEdhqq7ot8,1092
 mlrun/api/utils/background_tasks.py,sha256=ZlNkk-4I37s_efqg521AudbN52NRIOdbvbRpoWL_S54,7371
-mlrun/api/utils/builder.py,sha256=NHxboNTKnVUImlDtX3HylAGlNpf3ebGX_qTruNeFkhg,26977
+mlrun/api/utils/builder.py,sha256=JElO62tDSpAUpA4Fdxf5Z3MzKy4BQ6snnu2ZP6w71hY,26821
 mlrun/api/utils/helpers.py,sha256=WltrGj7UOURvHzdz99wo-Aixqh06Lqyrt31c1EQw7AE,2512
 mlrun/api/utils/memory_reports.py,sha256=l-texuripca1J5tfBmwzSc3l0t6dAMNO8JFjt9kptd8,3728
 mlrun/api/utils/periodic.py,sha256=0dyKI1bEYRJGwH1Ciqt52Brqys8MAesq84hli6ENZbg,2760
-mlrun/api/utils/scheduler.py,sha256=umhbdhl4OoKiWZ1lxHDLYl6hH1j5IZY_x05irDS0aJo,42624
+mlrun/api/utils/scheduler.py,sha256=dXwIIKTEwJShnejfYnHn44gR-CfzCS8SELZtDjquLn4,45705
 mlrun/api/utils/auth/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/utils/auth/verifier.py,sha256=21iHy2O77H_CNVSXdXr6O6uG6prJ3C9hvXQ1U9wXB4s,12383
 mlrun/api/utils/auth/providers/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/utils/auth/providers/base.py,sha256=WMVk7tgT_bZoQhyFcMt_FMQRr7NRrk4NnqDXerKgeH8,1381
 mlrun/api/utils/auth/providers/nop.py,sha256=FdThFkA2_Bgyg36bpPFcNOdRjdtO2WV3ZJjDUDad8PY,1460
 mlrun/api/utils/auth/providers/opa.py,sha256=JJXqh0nSlp7jCfpDvGCemyy893cUO9gZH6_myYN-oo8,10883
 mlrun/api/utils/clients/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
-mlrun/api/utils/clients/chief.py,sha256=6UrqH1tEug5HN3Y-QDEXlPzdv-CKqK1HUBKBmi2vbQE,13688
+mlrun/api/utils/clients/chief.py,sha256=u_T1ITKsvPU1H7vaI9zGvwZ4yVA6BxQHdsI2V6b6G5E,14075
 mlrun/api/utils/clients/iguazio.py,sha256=cVawmI28pSTathUktAJ5XHNF8oDZr2EWCfRN0fSeu0o,32674
 mlrun/api/utils/clients/log_collector.py,sha256=pkCJ6_5rYYfdKn4Oz5uNk7c2UyIaPTgdl_axG-cwfQI,12281
 mlrun/api/utils/clients/nuclio.py,sha256=rZOu_wbA1LHdqk_ZHMevmEG0WoO2QfXqpkaIwwx4TPc,9911
 mlrun/api/utils/clients/protocols/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/utils/clients/protocols/grpc.py,sha256=jV05P3uzU1KkNZCNbS7e1PXQa9E7gxzZSDMEP38aN-0,2567
 mlrun/api/utils/db/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/utils/db/alembic.py,sha256=lfIF2YSSe8hpZ8414e8qzKzwcTWWY9t-io-YwLoh0bA,3305
@@ -155,60 +166,61 @@
 mlrun/api/utils/projects/remotes/follower.py,sha256=hMEdSY58RIO40J68p3WhjKzqYw5ZgQU-5SBos-z9ZWw,2659
 mlrun/api/utils/projects/remotes/leader.py,sha256=yxOaVygWexYES2zkGf2BkqBbuXdlLzDs7guKhMpHMcM,2094
 mlrun/api/utils/projects/remotes/nop_follower.py,sha256=LBYFqVIO4nuzTAckPFAHU07Y8HdeFswcn9kkZrvZ0dY,4995
 mlrun/api/utils/projects/remotes/nop_leader.py,sha256=IJbuMrfxQhCY9EuSKo_RAHc4JhvdfXpFDLHgQBk3Iu4,3854
 mlrun/api/utils/runtimes/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/utils/runtimes/nuclio.py,sha256=xQtcQTItMo_cMrYBUpppVhaDKHG9tSV1nkeuYnuQrZo,1675
 mlrun/api/utils/singletons/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
-mlrun/api/utils/singletons/db.py,sha256=BozkPyTJPjmK5qh9YMAIlFb7XhAPxyxYg_tvJYkq4Vo,1203
+mlrun/api/utils/singletons/db.py,sha256=idTdQknaKVZVPzFeVfBe1JKDUtbH0rCNt8-zMOgxTdA,1313
 mlrun/api/utils/singletons/k8s.py,sha256=k5ERoQPUrj0hGc0TzhA-66DzNE4sPSX8jqtzd0STeOk,24570
 mlrun/api/utils/singletons/logs_dir.py,sha256=DUHIa-A87yUFqAGjPHFpMlvMiFMXGPZXjthzZCwiNKo,840
 mlrun/api/utils/singletons/project_member.py,sha256=11b_FmTC9kWvAVXuWwLOYpJT5TXT2I13sbzFjjtFMuI,1312
 mlrun/api/utils/singletons/scheduler.py,sha256=tlT826tOXQqaTgbQ8fcC4sx02JOliM_obUcSdtXtUa4,1064
 mlrun/artifacts/__init__.py,sha256=gLuGdv-6oSl_ePf3LT7hiaNNGTFSbI6X4_FJiOE8Y1Q,1123
 mlrun/artifacts/base.py,sha256=OKEJxlKZ58JLEOGmeP1W8IBPtb9O8-qaHaohRJc1vWA,31144
 mlrun/artifacts/dataset.py,sha256=7HnzOYtEQoHo4i5mJZggdQcNRbjzeBDhB6zTUc0g3ZI,20485
-mlrun/artifacts/manager.py,sha256=o7R232Xwal-XyhplMa3LJob0ZSWynD_JBAs-fst3PI0,12594
+mlrun/artifacts/manager.py,sha256=FnIcQDf6kOM7iX8I_OZXQJiFht1_z-4FhPMjzEzggog,12573
 mlrun/artifacts/model.py,sha256=5yu2lACWaMaU5RD-8l94c5Jnmr4-XNkTjjjGAypP8Eo,24241
 mlrun/artifacts/plots.py,sha256=DeII7_XDJecyaVpxZRmWFnO4MD3cULn7MJ6h6MPjHEQ,15383
 mlrun/common/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/common/constants.py,sha256=NpBgZV-ReSvPeMKPFp3DKzNWgiVebjGZrZ19pG_ZfRE,660
 mlrun/common/helpers.py,sha256=FqlMfRiZeGS6HZCOHaAJae2wDL1aRoijFBS5aZoPiIM,1108
 mlrun/common/types.py,sha256=V_jCEFCJZcycFVsPzEToCRQja5bqW0zRAAVaGN_QYxQ,790
 mlrun/common/db/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/common/db/sql_session.py,sha256=iWR8DWyziN2DSDiBgc5Wj3O7iVWDwfd0nJklAKwjoRM,2542
 mlrun/common/model_monitoring/__init__.py,sha256=x0EMEvxVjHsm858J1t6IEA9dtKTdFpJ9sKhss10ld8A,721
 mlrun/common/model_monitoring/helpers.py,sha256=5iszLVcUtWiDRnidYpPAR6kZWD76TVlWsFL4x7QOKaE,2312
-mlrun/common/schemas/__init__.py,sha256=MOh7nepRwoWNht8m12atUflaU2FhGVFJFSGp2cxTeKw,4384
+mlrun/common/schemas/__init__.py,sha256=qMo6x2PdZK3uSzht5Pp87l_83rzKFhppw0DmBqpGEBA,4496
 mlrun/common/schemas/artifact.py,sha256=vbXaY8eHxKt7YHKksD_PYEC-47eguxVb6wRAtMAW7Bk,1923
-mlrun/common/schemas/auth.py,sha256=vkv3cFQjFUsocraqo9smmDdkuWqZJVCsJ-vNc9FrlUU,5490
+mlrun/common/schemas/auth.py,sha256=rVPz0Yyy64bNxIMTRrR93ezMazk21S6EvV4aFUIpjXA,5730
 mlrun/common/schemas/background_task.py,sha256=1_nTVLDvTyYzsrzXQSfCwz_OlrcvrBlIwxy1ghDLyt8,1553
-mlrun/common/schemas/client_spec.py,sha256=ijEzcztL-8P4yxLmoLRWLu6dSb1AlahrOoOFpFqEI6Y,2751
+mlrun/common/schemas/client_spec.py,sha256=LxhNMyHtZF_5ch1o9wJE01XEKgJjy5m2vgWHuXQRIK0,2813
 mlrun/common/schemas/clusterization_spec.py,sha256=aeaFJZms7r7h2HDv6ML_GDAT6gboW-PxBbc3GKPalGk,888
 mlrun/common/schemas/constants.py,sha256=WpREVl6QW7sDJJO6LquRnCFi1cKEI-zI3AxkONEihts,6243
 mlrun/common/schemas/events.py,sha256=ROHJLo_fqYjc96pek7yhAUPpPRIuAR76lwxvNz8LIr8,1026
 mlrun/common/schemas/feature_store.py,sha256=LrJJ55TxpCF4RkmorB-i1IUTbixlP-jwLhdn19LLF-Q,3723
 mlrun/common/schemas/frontend_spec.py,sha256=bFjFic5hAWquaibR8fUaoDV8SRKrzdp9kTCjbeqT2Qc,2546
 mlrun/common/schemas/function.py,sha256=6eslF1HMlKqfIpryPCJLqYJkpkWUelQ72lE9_oAc5HU,4432
 mlrun/common/schemas/http.py,sha256=1PtYFhF6sqLSBRcuPMtYcUGmroBhaleqLmYidSdL9LM,705
 mlrun/common/schemas/hub.py,sha256=CZ38rx0CWX7wyGRkdzAcZp505k8w0M7z8hoiiEQ13Lw,4245
 mlrun/common/schemas/k8s.py,sha256=nmMnhgjVMLem5jyumoG2eQKioGK9eUVhQnOSb3hG7yw,1395
 mlrun/common/schemas/memory_reports.py,sha256=O5ajjqSimTPl9nzlZg2ewRbddDXWgqUr-zoadv_slZc,920
 mlrun/common/schemas/notification.py,sha256=yi5y14NGByWMvQflx9_cv1JbjyDYQT1_alv7YnmlUoY,1518
 mlrun/common/schemas/object.py,sha256=W735Gmu5D_x6LxNp1qsHMkhldjY5b_1H9QvAiiITRRc,1986
 mlrun/common/schemas/pipeline.py,sha256=tvpSHmXDR20uxWIHQ5KXf1zGKi1jaT5pDUIS26zJhLI,1184
-mlrun/common/schemas/project.py,sha256=yvP1fBhcCkkK4VhM2P0yLeRYpK3qBY4faKxC9L6ySa8,4177
+mlrun/common/schemas/project.py,sha256=mTJPTRaf1cUI_obZY6O_tIrBC6u4pE6RJhIrwNE7nuU,4224
 mlrun/common/schemas/regex.py,sha256=8_vbDeAE0SODJDj7yUFg1FbaB9CNydYQTJ29JxE74Kc,776
-mlrun/common/schemas/runs.py,sha256=tgq6PCYFVC1h94n_Iy8a6EkjRa12go1drWDUvfnjcEA,1010
+mlrun/common/schemas/runs.py,sha256=H9QhaN83cFUN42eE9TLgi1gs6Xdq11oQSZ96ESM94mI,745
 mlrun/common/schemas/runtime_resource.py,sha256=GyeqRwbBoLMq-0zWCkocvKl2nz9a62dAfguaPdqUzYw,1636
-mlrun/common/schemas/schedule.py,sha256=OCZkHvTRPU-A6tHJYgPZsVF17JWwKBu5atDxOy2J41I,4556
+mlrun/common/schemas/schedule.py,sha256=dFaPWY3CtuW1KKGcs-br1Gsm5vPjiTgcBZGfcbAAeug,4293
 mlrun/common/schemas/secret.py,sha256=51tCN1F8DFTq4y_XdHIMDy3I1TnMEBX8kO8BHKavYF4,1484
 mlrun/common/schemas/tag.py,sha256=2sm2Z5qM0jyakHuT_lxb-EQ2M5Unpodz4lj6MNkDEzo,905
-mlrun/common/schemas/model_monitoring/__init__.py,sha256=_Z0tUeQ5MlWL-LL-7Iicef7QY5dkTNUlBI9ygA2_poY,1300
-mlrun/common/schemas/model_monitoring/constants.py,sha256=TpxRiwVpEe6LzjCSzunin5SBJhxYt6_W1YDw9TYYFKk,5068
+mlrun/common/schemas/workflow.py,sha256=zlEod6UCWDVHK_DEuLEx30XhTUg2xwvpiJNIWLAML2s,1729
+mlrun/common/schemas/model_monitoring/__init__.py,sha256=H3E9QbwuDBaqz8LFC3irRYXgkAmYdcaPVWdDl3LFfvM,1322
+mlrun/common/schemas/model_monitoring/constants.py,sha256=HWv8cgBMaRA5fOpWTjH5a0PT_hz8lgwuRG3PmgIsedY,5376
 mlrun/common/schemas/model_monitoring/grafana.py,sha256=W6TcNc7mqPj040lfQrEadEQ37csdxLDgdU3QRLlELMQ,1444
 mlrun/common/schemas/model_monitoring/model_endpoints.py,sha256=4asvVsqhusAsBKXSvZ4_88oSBN9Kom7Ac8VQAbqqUI8,11152
 mlrun/data_types/__init__.py,sha256=EkxfkFoHb91zz3Aymq-KZfCHlPMzEc3bBqgzPUwmHWY,1087
 mlrun/data_types/data_types.py,sha256=qgRIdlSl9X-rAnwOW-F0hwPbDKOZI05JlSzV1O8ReaU,4647
 mlrun/data_types/infer.py,sha256=iEEQKZ6l-6PhHJWPwVyBJTEANNoP9xkrkYtryOH3O60,5813
 mlrun/data_types/spark.py,sha256=iNcpPsChTmDndqRp92eWN0ZoAszqWXvRR86rupx2ThQ,9426
 mlrun/datastore/__init__.py,sha256=ZHspikZYGqiCKqH5H3EA5txuckayC0BwXh9jONCSHzw,4089
@@ -218,41 +230,41 @@
 mlrun/datastore/dbfs_store.py,sha256=Zlr1SjU5pCZT3Uqa2xn0sCXtGc8i5bSCCGXtLoNojC8,6302
 mlrun/datastore/filestore.py,sha256=o4ex777XyxyV1CQBP7M2JyyssCVVAc4H3JrvNC9eryM,3791
 mlrun/datastore/google_cloud_storage.py,sha256=Y_X4ODhvvBeknE_Aqaky_Fdi0-EY5waZAglmAttgFgY,5114
 mlrun/datastore/helpers.py,sha256=-bKveE9rteLd0hJd6OSMuMbfz09W_OXyu1G5O2ihZjs,622
 mlrun/datastore/inmem.py,sha256=6PAltUk7uyYlDgnsaJPOkg_P98iku1ys2e2wpAmPRkc,2779
 mlrun/datastore/redis.py,sha256=bcUpBK_HzHxEyjtSHjxmcD2C6wYe_AI7kaLKeiwHH5w,4873
 mlrun/datastore/s3.py,sha256=Zd3Bmd9IMA3WEG4fWQnhJqyAjwW2PouHPpk4uDnMttg,7035
-mlrun/datastore/sources.py,sha256=QtNOQMgbKBf2yGx-j5MZhKH8prHjVwFhq6EczRzyzEI,37671
+mlrun/datastore/sources.py,sha256=SMHEnNkYEQRsltngPDliqCN1LY58dw4v080Bw2lGmLM,37649
 mlrun/datastore/spark_udf.py,sha256=NnnB3DZxZb-rqpRy7b-NC7QWXuuqFn3XkBDc86tU4mQ,1498
 mlrun/datastore/store_resources.py,sha256=SUY9oJieq3r8PEq8G661XxmXem_e-CxDoy2AJ7dpXBk,6906
 mlrun/datastore/targets.py,sha256=YAlwvuKbYTDeN3n5sujqWktV56K_Y4_c9lF8gvFdcKQ,63310
 mlrun/datastore/utils.py,sha256=tEuLkrb66l5rISjlhzZ6_aDZiZdhT1ZRQv4-sj_-YXc,5438
 mlrun/datastore/v3io.py,sha256=ywd-rrB5Uicdk7KGMk-nJ4mKPjvg2z5w6TVx5Bo5jIo,8099
 mlrun/datastore/wasbfs/__init__.py,sha256=s5Ul-0kAhYqFjKDR2X0O2vDGDbLQQduElb32Ev56Te4,1343
 mlrun/datastore/wasbfs/fs.py,sha256=FfKli7rBwres1pg8AxDlyyg1D5WukBEKb8Mi1SF5HqY,6152
-mlrun/db/__init__.py,sha256=v0oqIVmpH1gBrat8ElHxulot1He5BC-8I0FbVceXD84,2816
-mlrun/db/base.py,sha256=xFoxsTmNIoyv_5RHk0giA8aXeUb-HpEtl5udy4xiGik,16194
-mlrun/db/httpdb.py,sha256=Vsf1364lFPnIehViCy9Fp3YXvCZAArq__CwvzHhKBdg,133910
-mlrun/db/nopdb.py,sha256=0Fot6rj8UkD-kZ6pzZq8TFi3DKw5W063v5H5DQxHbWA,13209
-mlrun/db/sqldb.py,sha256=33tViPlLJ6r1j6brQR_vHD_yR4ecsiTlLb1k1whyDhg,25590
-mlrun/feature_store/__init__.py,sha256=uxmSztZwsMoqT3jYFhFqNMQE6zYqPjYbhI-SJJTf4Lw,1501
-mlrun/feature_store/api.py,sha256=HmmPPDkePYo_CPU6BJcbpWvfKPzd-JSGXiydzkIxG0Q,44918
+mlrun/db/__init__.py,sha256=Wy3NbZwgAneRHXCIKygQE-68tnAhvF7lVxrFSh9G6Y4,1145
+mlrun/db/base.py,sha256=2pHx82sHnXZL4CYpAPFw9kFT1b8g8ewOuR3gX1j1kXA,16494
+mlrun/db/factory.py,sha256=et3z63FTCt7kdbxwtEE8yNb33aSDM13gDKvrz5SeqBM,2117
+mlrun/db/httpdb.py,sha256=W46sgdFDalGqWW7ggyl0J4CJHrtQfP_Er6CgPPGEx9w,139637
+mlrun/db/nopdb.py,sha256=Y-6sPcjcpHD_NC2mPS8dJEQtEgCgUmVn3bBbs1UbcAk,13378
+mlrun/feature_store/__init__.py,sha256=HdRKopsv4pTM-FTw1320b41VncJsek3_iWBH4r4IGK0,1516
+mlrun/feature_store/api.py,sha256=Qoepu316lSDQi_Fsfb-6Pw6K97Ys9-pZxZQBrRTB-bs,44899
 mlrun/feature_store/common.py,sha256=sl2pmkuv5w4KtTMjt0ky34Qps0iuoXNWbyYGuBkCxjc,12809
-mlrun/feature_store/feature_set.py,sha256=YceJb0NSRCdTF5J6kk1qBrr-qNsEA5nKoXuIweRj0JM,48102
-mlrun/feature_store/feature_vector.py,sha256=UkdOBH9Xl73VmwGUN-3T3gi_w4PVR8-8wetmLM-20yE,22173
-mlrun/feature_store/ingestion.py,sha256=Assf4Ozi-BBBp63fKIInbTRNMEOIwQY649VrHhOjbAQ,11681
+mlrun/feature_store/feature_set.py,sha256=F9XtGm6j2sjSo-mXnyePSSgDVo0SiZW2ubYxEv2vFgI,47773
+mlrun/feature_store/feature_vector.py,sha256=1dfQYuzulR24Pt6gK1-hQCI0uj931LWGPbiFxmeRPLo,34934
+mlrun/feature_store/ingestion.py,sha256=JLkMYNFwaRu6qMTB0Kkgew9teJ2broAw3PHrdPb92YE,11185
 mlrun/feature_store/steps.py,sha256=EcZBJvSO-7UMUnzf-nv728cHRxGxHschzfXrmji7e5U,29357
 mlrun/feature_store/retrieval/__init__.py,sha256=6qtZFx8-vtsHv8ZGJuTv3UDe9m7XIlOq4ryEYC58Eww,1260
-mlrun/feature_store/retrieval/base.py,sha256=EsPBvBFzZ4dB0pbkgae4onzsDKRLjUFZNcjPNBMHvtw,30286
-mlrun/feature_store/retrieval/dask_merger.py,sha256=QUiCDbyCCFCRGC5Tpun8Ao4Dt9cCH8D6F7eQhcvfAGU,4623
-mlrun/feature_store/retrieval/job.py,sha256=K1WSoSjuSUSjO3dE_BQricZTmIlHfrPJH7vtKzg7VdA,7657
-mlrun/feature_store/retrieval/local_merger.py,sha256=irE-m-P7ZZlG2lXk2pOhvCKCg4Gd457jeB-NKWkYZc8,4252
-mlrun/feature_store/retrieval/spark_merger.py,sha256=bWStsJjxWGU51-JvCzKI3jQto7N6EAcD2NK94Av2T0A,9565
-mlrun/feature_store/retrieval/storey_merger.py,sha256=SMnG1SMiR0gO1Sp7UPthRf1HciKg4YR6BZUP2aH_dK4,6296
+mlrun/feature_store/retrieval/base.py,sha256=s_XsBGXEy2s2bM8kUAq9BqyYwB4Ri0cWQ6x1h9VvuNk,30622
+mlrun/feature_store/retrieval/dask_merger.py,sha256=Lxoj16c8hp9i5RHf-8BmG9NmReeEev6AHu96oEN2Gp8,4895
+mlrun/feature_store/retrieval/job.py,sha256=ZveUaLml6jU8EZCGoxM4vLKNWnjC7EDndGMH3aOuAu0,7714
+mlrun/feature_store/retrieval/local_merger.py,sha256=M0R2FWc-kuLVvyAYbawrxAJvqjshtaRK2gQqF6DjgxM,4218
+mlrun/feature_store/retrieval/spark_merger.py,sha256=6A1YJF2W3zbMqnQ1WrBVzRpNExW9vX54ybREO2B9aXU,9819
+mlrun/feature_store/retrieval/storey_merger.py,sha256=6bRnVm7YQBm3igviKeO0uXH3TSf74ZxspFnD4w23J5w,6539
 mlrun/frameworks/__init__.py,sha256=qRHe_nUfxpoLaSASAkIxcW6IyunMtxq5LXhjzZMO_1E,743
 mlrun/frameworks/parallel_coordinates.py,sha256=8buVHWA-mD1R5R9jm71XN5fvDyz9Bkp7D1xD4vFYHTE,11466
 mlrun/frameworks/_common/__init__.py,sha256=7afutDCDVp999gyWSWQZMJRKGuW3VP3MFil8cobRsyg,962
 mlrun/frameworks/_common/artifacts_library.py,sha256=se6gpxwidTIjPo3lY2LmmX16AUg3qUPnTYOkllnqPxQ,8515
 mlrun/frameworks/_common/mlrun_interface.py,sha256=_5nUwKid4I6WrzgncoIL0U38uaKDIrI59JPYQ1Abh-g,21018
 mlrun/frameworks/_common/model_handler.py,sha256=BmdABncjj2o4bNDSyxltGDlOW44cMXJ5_qn5f1Bx_fQ,55376
 mlrun/frameworks/_common/plan.py,sha256=NxRlH6bNCtK_qOu75c6fNsFrRP5GlFxOwbLC_focuyk,3469
@@ -330,118 +342,115 @@
 mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py,sha256=_9tF4KrSA2LKqE_uqwWMSHiRvNXPERwi8ABS96XqzNU,8791
 mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py,sha256=Ql-NLPbELuROju3boCidU8RVmPWZ7EqbvwBLTTOOrS0,28728
 mlrun/frameworks/xgboost/__init__.py,sha256=wPDaQcqb5tWgT8nxDWsLX4Ema7qieKm1ttQvplX13JY,10287
 mlrun/frameworks/xgboost/mlrun_interface.py,sha256=QcP_mTKBjxvRyWcNnju0BlvXBDOqNH9B1XBoxvEojAk,878
 mlrun/frameworks/xgboost/model_handler.py,sha256=XV8xndGhQsPkOX9djqiNVYFB0xiZPujhC0m4DUOU2zI,11617
 mlrun/frameworks/xgboost/utils.py,sha256=5zLzHoeI3n2FuA_rdGzi404QCTLfQx1TYEyUWhZogs8,1069
 mlrun/launcher/__init__.py,sha256=pZgS6ZN126aJme4z5spCX-RmdchShxMnQeCPya8AsQI,577
-mlrun/launcher/base.py,sha256=5Ika123_bh2yMy4hMb4DhBO3aPtu1aiB0ONn6Ir2pZI,15792
-mlrun/launcher/client.py,sha256=disDV9FkIBGguETGBgZqs2WtSjx6C9G_mMBnO_jT5s0,6169
-mlrun/launcher/factory.py,sha256=kjHvWyr0sw1VsawuvXHrHUDZwg-mfRaHmwF66ozGB_w,2182
+mlrun/launcher/base.py,sha256=-J_TDSiUjQqL1xAt0HqCVxhpXoY-euJMWMpq10WO2vw,15798
+mlrun/launcher/client.py,sha256=tz8ao6TFjWBSqW7-AoK-K8DBgYN3Eg6WVsLwDHeTj4k,6174
+mlrun/launcher/factory.py,sha256=tk6foFWox7f_xaeTgkWTx9ht_5fv0XzLDR8ucdb8oTE,2344
 mlrun/launcher/local.py,sha256=cWsXKfW-VOgAQOO795rh1YWalR-epRb0z0AbkYwL1x8,10815
 mlrun/launcher/remote.py,sha256=9vmM36ofsBqZrOQ5V7DntstdBwEElR2jM3u_ZSWtGkQ,6770
-mlrun/mlutils/__init__.py,sha256=c0Tc0aCRPDU0Jpk3kQy3s2Bc_0h1bnwmgQSN8oWbeUc,760
-mlrun/mlutils/data.py,sha256=4c5o3Tm4mrlVbYvmyDZpr9tAzMlrkmzE2damlLllNBY,5325
-mlrun/mlutils/models.py,sha256=fr_CdatlMVsiwf3RXwhZfLG2FWJBFz1Ku6TR9HdDNSI,2598
-mlrun/mlutils/plots.py,sha256=KmkKp9TFkHw4_WrgNbUwLMG-h0q7GjSO_Og0G8-iqTI,30120
 mlrun/model_monitoring/__init__.py,sha256=bC0NzTgk0lbMqZRvRsIPRRuGYX2ure5ENnTWNXzrmCw,872
 mlrun/model_monitoring/features_drift_table.py,sha256=tVWTOjU7q5oopKbu-dRfgGrrjJlLilQAavn9dVp01RI,23970
-mlrun/model_monitoring/helpers.py,sha256=YGvUC5Nvxojtpy9KPD80s6cmBq8n3b0-hVdAK0J7JrE,2388
+mlrun/model_monitoring/helpers.py,sha256=Vsrsbyn_i_VYPYeJTFDYqKl5QrK9bz3kPLqftuMrqV8,1902
 mlrun/model_monitoring/model_endpoint.py,sha256=yuKvIa5vJxsPk4dXPK6cKgfmZqsD_W2cdeNCWKEO6Tc,5214
-mlrun/model_monitoring/model_monitoring_batch.py,sha256=BHwc6OHuCuWoDIghIKNIWbqRU8f9i0ck0RMr4Vy25bE,37289
-mlrun/model_monitoring/stream_processing.py,sha256=c75mOBPcoOt080Sjfblpblznf3T7G5pLI5nzpQHJztU,43133
+mlrun/model_monitoring/model_monitoring_batch.py,sha256=A_-IY50kA5lkFlNzHZZICl1T4_3ZWWSzmac-OjL9HNc,39798
+mlrun/model_monitoring/prometheus.py,sha256=Z0UWmhQ-dpGGH31gCiGdfmhfj-RFRf1Tu1bYVe-k4jk,7605
+mlrun/model_monitoring/stream_processing.py,sha256=LqRMosAWF1ncKjP829zDTdpkx5pPcydv5QJp3RGQY_U,48755
 mlrun/model_monitoring/tracking_policy.py,sha256=HFlANGEFobdG8kHXFsSwK9Vuxs8D3WKFrYIDH-5hExA,4475
-mlrun/model_monitoring/stores/__init__.py,sha256=VeMMBKGKiHwXtH6rbmb9kyoXgNdm9TJeAOqLzTJ2T0E,4248
+mlrun/model_monitoring/stores/__init__.py,sha256=adU_G07jkD3JUT8__d0jAxs9nNomL7igKmd6uVM9L50,4525
 mlrun/model_monitoring/stores/kv_model_endpoint_store.py,sha256=cdsdlI6U7VInET2L6j9zQDYx0QG6bUdp7ePd-i6DXA4,20351
 mlrun/model_monitoring/stores/model_endpoint_store.py,sha256=zqGVidq9Clym1l15ZltIZMCTdFuZ1QUwXxEAma9-4Hs,5695
-mlrun/model_monitoring/stores/sql_model_endpoint_store.py,sha256=bfRW27MQWWPR4sWXenvqZgDvzbaO6nyOKv13FCIR-9s,15960
+mlrun/model_monitoring/stores/sql_model_endpoint_store.py,sha256=RDlcD8U24al8B6jApdIdYD4m1CGgbZYxSRQTiwwLmro,16123
 mlrun/model_monitoring/stores/models/__init__.py,sha256=rod--mpxH03wuyfbsp1Y-4vSx-vpvufohfBdrXR-4o0,884
 mlrun/model_monitoring/stores/models/base.py,sha256=IXPIE8iLAXmg8gfxA9iNMfToMpZ9BrIZf0VoZ1bd_Jc,655
 mlrun/model_monitoring/stores/models/mysql.py,sha256=0s6TC783RLrEXnbPahYpJrYuWIWHVhNvj2lrwQdi7fw,4153
 mlrun/model_monitoring/stores/models/sqlite.py,sha256=lZZgkhce_209T6QKXzoO98gtJQxk9M1nOQR38y-JWk0,4070
 mlrun/package/__init__.py,sha256=4A1houoObsq46gc4eSeaEanoJKTpund00KZomyciN2I,7101
 mlrun/package/context_handler.py,sha256=Tb8I9iX03SdKp1ZKrhbEmE_sgEYrvlPV9Q2cfyKUrbg,13974
 mlrun/package/errors.py,sha256=LKF8SSaRIdbkB7JQz6b9U4mZV42Ebnf6ZHu4wKuWqK4,1204
-mlrun/package/packager.py,sha256=wa9c9AbbxnZThU1vjiFBKlxOYrHuIg3jzLUTD_yGfI8,12606
+mlrun/package/packager.py,sha256=bm2no_rgGNZgv4ZQCc8EfkWBx1XlNfSSqJflZnkqFTQ,12578
 mlrun/package/packagers_manager.py,sha256=ilmV_0_cW-CIAiLVLoS0FINDdBzXFbCPccZBBlLxOCI,37275
 mlrun/package/packagers/__init__.py,sha256=rpxpuATMoxCMgHDaVamm0uwocy71e0CSXm85Q5X9tkU,769
-mlrun/package/packagers/default_packager.py,sha256=SaKUTv7hRWq8XuyeO87cYOebGixkZABgPAqwsHJvCZs,20060
+mlrun/package/packagers/default_packager.py,sha256=AI5rflcj1IErlsnVbMm6ffmfO6TQrZ98nndfpZ814oM,24227
 mlrun/package/packagers/numpy_packagers.py,sha256=ACG0cctrjvRCrYPiffEPV3K0XZiXG78zU_zn14uu8OI,20618
 mlrun/package/packagers/pandas_packagers.py,sha256=shWlNIeWGcrkDS-2oBxukNrBQ9XrSoeY5Mtvc8zAMIg,35951
 mlrun/package/packagers/python_standard_library_packagers.py,sha256=8yjqBN634Yaht3LsO-YclqmVZDD9pJxCKEC2vm5adb0,21528
 mlrun/package/utils/__init__.py,sha256=RXkhPH-zFLFFvOjMRJUVgVT33rusK5J4eTVLJ7bjN6k,1722
 mlrun/package/utils/_archiver.py,sha256=EF9r6BBwrFq7o8ig5nFlOnXJ-JsBnvSFTQphYuoGGAM,7567
 mlrun/package/utils/_formatter.py,sha256=EgdSMrJMgt-35myGuwfIOOKAe4jBi6QU7ssw1G0cacY,6393
 mlrun/package/utils/_pickler.py,sha256=S8UcTZ3XD68yqfY6ebD-loNC-C5goKfBR4cS5GOGbBI,10926
 mlrun/package/utils/_supported_format.py,sha256=fvwD1icALyV0wJUcRori6voH10j6KR3NN8n5o8HVw2E,2379
 mlrun/package/utils/log_hint_utils.py,sha256=ie7opnHlhVdh1mBkvYDFyWyFIjHn8Lm2FcxkiCmL9Z8,3709
 mlrun/package/utils/type_hint_utils.py,sha256=f-1AeFv2vwljH0ymXA4JmcIkH1lEf7HfsJ2A62H-X4A,14825
-mlrun/platforms/__init__.py,sha256=nGcTe4lvhh2opWBts2xhrxgGVDlD4EsF5PJ18dm5kEA,2400
-mlrun/platforms/iguazio.py,sha256=ya8-OXq4JSGC7_oNO1K9rmyrPt5zAI5NO2ZD3FM2xfc,23997
+mlrun/platforms/__init__.py,sha256=ArWn_iZiEE6qz7hvY_1RqMkFnHGuKjP3k5xYKnfKA58,2352
+mlrun/platforms/iguazio.py,sha256=BN3V2cv9a28S86EOat8nLvmChXoXbvfI900EspZPDwg,21581
 mlrun/platforms/other.py,sha256=z4pWqxXkVVuMLk-MbNb0Y_ZR5pmIsUm0R8vHnqpEnew,11852
 mlrun/projects/__init__.py,sha256=Lv5rfxyXJrw6WGOWJKhBz66M6t3_zsNMCfUD6waPwx4,1153
 mlrun/projects/operations.py,sha256=A3JzRNZnYE1_VXN5JSGrZHIFO7ngLt8Vzau7XoPhAjs,17602
-mlrun/projects/pipelines.py,sha256=FSLJLgj_KceidykiCkz21uLhLMdXeEbjSZHt5j4WzKA,38781
-mlrun/projects/project.py,sha256=WIDDyxvnvKwormv6uCikrdqiOYKtYX9YO0e_dsYRPJU,127746
-mlrun/runtimes/__init__.py,sha256=JcOEzlpwPsOr6vghC6ohfgGtIUY9oRUd7hhnYlr9sIw,8692
-mlrun/runtimes/base.py,sha256=5My0H-ypIHelidVoFA0N1NU5W_CvGHYs7bWkH7N0Fss,86542
+mlrun/projects/pipelines.py,sha256=AKnSGwX5TZc7GEQw-fnL6iozl3ty1FTT5siwiuXiiyE,34337
+mlrun/projects/project.py,sha256=hhs_xia96c47lkRkiWxeG3a0aFdZl2EZD2BEJ2U0NUI,126661
+mlrun/runtimes/__init__.py,sha256=jz7fUkICG9oywq2S1hxl7KWgUT8IvJG58cdbvueoCOM,7174
+mlrun/runtimes/base.py,sha256=B390d8NgCC54nQD_4tgwjiqIgUQuYbzU2tjhqnSUdAE,36681
 mlrun/runtimes/constants.py,sha256=TnkD0nQ7pcFq1aJvbweoM4BgbkhaA6fHhg9rnAkxDBE,6689
-mlrun/runtimes/daskjob.py,sha256=fudZeRpd28rLVpm7rv-loBWZ9iXzGRAv9Z2s-oJ6Oas,30353
+mlrun/runtimes/daskjob.py,sha256=eP6-A_0t2Kc1y9HCGLTpgY22dj_qu71pJ_OhMBilHfk,22830
 mlrun/runtimes/funcdoc.py,sha256=HRD-mQkSyRBPExNWEhTCX3Cj01MXyeuQqc6jKwg5aZ4,9994
-mlrun/runtimes/function.py,sha256=8YVXPsA0OX9kIxV7GZN7vdg1Iiwno9RZBaRTLTWPI0o,44880
+mlrun/runtimes/function.py,sha256=IkycL8e9VgX0cVoVFXQkp3R3Lh7R_R9YHMHbZ2KJVLs,45208
 mlrun/runtimes/function_reference.py,sha256=SJ0J-4ww0FQdijmdnUwGUKhMb-h5wtzqCPItTWKIL40,4911
 mlrun/runtimes/generators.py,sha256=_vuJVL4lDdyts0xK_R1Bw9zoblV-NsvSWr-bj-uXKB0,6530
-mlrun/runtimes/kubejob.py,sha256=9CUnSDsam06UJCsmqCwUK8G0QmNRQyHiKFwFMPQ8Gyk,15482
+mlrun/runtimes/kubejob.py,sha256=_WidtV52KIyay1Nk8br1Krrjh4MO_uuzSMef37nV_38,14634
 mlrun/runtimes/local.py,sha256=zRekoW7H6ve8awBCnhkkCXK1CVLUhpRWCkUiuW7lYO0,19579
-mlrun/runtimes/nuclio.py,sha256=dv3Cgx4Ym46Bvrfb_JjwPfwGBVwwrsI2hpo4x3gSC3I,2885
-mlrun/runtimes/pod.py,sha256=RQqxfq23NnfNra6Mw4t8S3IFrAC9OnrrFqNVBgPkWwQ,61740
-mlrun/runtimes/remotesparkjob.py,sha256=owddZlsc0wPJhgVsG-4rLsa7sqk4zxgVjh_8Sg7cKQI,7695
-mlrun/runtimes/serving.py,sha256=Gp9nF67dcdxql9lWY6lVX1oxyDOfEgjfDNhKNmzt_eA,30505
+mlrun/runtimes/nuclio.py,sha256=cb1Q8dowZaDqOLlxcblcTebOD6K3jrss0FOuIklq5UI,2877
+mlrun/runtimes/pod.py,sha256=SoerOZMadz3h4w15plOI1DCeqeSeHzUWhFnxS4CQuqc,61396
+mlrun/runtimes/remotesparkjob.py,sha256=R5y8zDFqkzJRfylZfxBBp5H4FiQNJin0cXEu7GbNm68,7289
+mlrun/runtimes/serving.py,sha256=K-SJxDUaUppiCoYOxK3RRv1GCSV4KF-OwZdkj2YfLg0,30483
 mlrun/runtimes/utils.py,sha256=wxX1K8vwcygizduqEhSnEh6DswPL2K-xWg568NTr2O8,20801
-mlrun/runtimes/mpijob/__init__.py,sha256=0fI7juivfMdSn_bfqdhHP5OoJl7WDfV6aB-AAkEyL_A,790
-mlrun/runtimes/mpijob/abstract.py,sha256=7fsHp9R-Dl5LsZ2vNPs_E9pjm9y6AD5iVmdGgYV1cVs,14713
-mlrun/runtimes/mpijob/v1.py,sha256=JEq4gWwII1vY91RO3eFGXDhfJdjbOGZGkIMSQkFOEEI,13845
-mlrun/runtimes/mpijob/v1alpha1.py,sha256=k4iYUvv7iM8F_66mXQST7K3yVETJYvYctaEIaVGMlX4,8460
-mlrun/runtimes/sparkjob/__init__.py,sha256=p8geeoPy2jQcE9xFxKsmDyUm9apqiIp23YBnjIokMt0,751
-mlrun/runtimes/sparkjob/abstract.py,sha256=uk9W1hCP9FLKxNt4xBn6TJLjy04vH6wN2THuAaO8nGM,35028
+mlrun/runtimes/mpijob/__init__.py,sha256=0I0EpRg76TClDXIL8FBu21_5lUTOoTyhC4MfnQn1iUY,742
+mlrun/runtimes/mpijob/abstract.py,sha256=4PqXLVWO8QQ1eGer-e_VpJb7tmkz9HW9h1B2ngtXH9U,15147
+mlrun/runtimes/mpijob/v1.py,sha256=oHf2gKRZloJkqhyjGU-CZtCcC4rC1Ptu3404a0bVAzs,10916
+mlrun/runtimes/mpijob/v1alpha1.py,sha256=JrmmaG0lvKoDgKXOHYA_XYhjPQJWCTl5pBnLLrg0Cdg,5650
+mlrun/runtimes/sparkjob/__init__.py,sha256=_KPvk0qefeLtHO6lxQE_AMOGiMTG_OT48eRCE4Z2ldw,709
+mlrun/runtimes/sparkjob/abstract.py,sha256=h3ZTGETbSoMo71CPhEKPT0wmEIPDR_eKgScfQj5PhZk,30404
 mlrun/runtimes/sparkjob/spark3job.py,sha256=6oDQISBnfiCJ9M0NHJCANu2p2AwS6i6htEOUy4TgUNs,28746
 mlrun/serving/__init__.py,sha256=_6HRAOuS2Ehjo3vwx5h1aI_-JppxEAsl4VfEERAbGFE,1078
 mlrun/serving/merger.py,sha256=PXLn3A21FiLteJHaDSLm5xKNT-80eTTjfHUJnBX1gKY,6116
 mlrun/serving/remote.py,sha256=XtCgEY-azxcP0VUG1TupZXQ_dttPkAKIAtszW-GfGpQ,18038
 mlrun/serving/routers.py,sha256=b_HlsS84vvRc0U1521qN50aqtVm2kdP7QH5KKal4LOM,55318
 mlrun/serving/server.py,sha256=QAJuhBOJiDh2OVIeuu8aVCyP5y9iactT-bQE3l43aD0,20439
 mlrun/serving/serving_wrapper.py,sha256=R670-S6PX_d5ER6jiHtRvacuPyFzQH0mEf2K0sBIIOM,836
-mlrun/serving/states.py,sha256=qqOSSdujPAlk3ILh29JUslt1FkIZK-Wqw3zTlU7nCoM,54310
+mlrun/serving/states.py,sha256=kOETQGjveeLVirTweBZYmAfyeK3yA2uY8iPatV2QeGQ,54288
 mlrun/serving/utils.py,sha256=MHu3RljqtuEu3KxYcbECOzfgQZbfvYK09Tg5IAdvFgg,3902
 mlrun/serving/v1_serving.py,sha256=m_W8ylcASCvdP66lZSD6yQjamYCUJ3VZdOEQY4F8ozk,11814
 mlrun/serving/v2_serving.py,sha256=fAMA52lBvpLFpUa8LKHjRAwBZp_sR0wUmmtrN1ChJC4,21823
 mlrun/utils/__init__.py,sha256=g2pbT3loDw0GWELOC_rBq1NojSMCFnWrD-TYcDgAZiI,826
 mlrun/utils/async_http.py,sha256=Rjnulj27T7PxgyD_bZlBCdjOV8APC9_YP68jBONlt7s,10636
 mlrun/utils/azure_vault.py,sha256=VNs2fz0XlFrV5Ggz3T0mR7mOWHefEcC14wM7QpsbY44,3456
 mlrun/utils/clones.py,sha256=Q1b1BA4-slooth0gEXoX-x8mhr1m6BgFBA72DXfCqJ8,6245
 mlrun/utils/condition_evaluator.py,sha256=oR-GjryAg76D4G79G-DzVkx631D6Gd4jJgbr_d3Btnw,1920
-mlrun/utils/db.py,sha256=p3mME60akvgqZiDLPTtsCL9SeAxA43IEK6fyYX8IsQ0,1702
-mlrun/utils/helpers.py,sha256=K58Xup5sP9ww3pT-N0sgw7LK2Z0ygcHpOBL5podI0wA,47157
+mlrun/utils/db.py,sha256=2pdIYKIA0GiwwuWLW0PJ_bPu9M1rd7ESBqnMr5wWuW4,1662
+mlrun/utils/helpers.py,sha256=P5-7EJSbf08OalcXHp2JullqXqrv6C6hKfJAd1wBbV8,47314
 mlrun/utils/http.py,sha256=i32dQYH35pt4gQjPdQugIaCtEOuKxPikRQyKBiHp1ew,8241
 mlrun/utils/logger.py,sha256=d5qUNJ-J_tNASi7A7-cRBOOXA0jJrEDEWFft8AAukLc,7035
-mlrun/utils/regex.py,sha256=MBNnPNEAitNBKYYt1WWXbv0Pz-tRkw3pUozE3GKmkF0,4303
+mlrun/utils/regex.py,sha256=V0kaw1-zuehkN20g_Pq6SgkJTBLRdBqNkXOGN_2TJEw,4430
 mlrun/utils/singleton.py,sha256=UUTQiBTXyzmjeYzsvTUsSxqyLJHOtesqif9GNfZO9rc,883
 mlrun/utils/v3io_clients.py,sha256=HL7Hma-pxaQBXMKcEnWqGLCpFgykwnszlabzeOHC9-E,1319
 mlrun/utils/vault.py,sha256=xUiKL17dCXjwQJ33YRzQj0oadUXATlFWPzKKYAESoQk,10447
 mlrun/utils/notifications/__init__.py,sha256=eUzQDBxSQmMZASRY-YAnYS6tL5801P0wEjycp3Dvoe0,990
-mlrun/utils/notifications/notification_pusher.py,sha256=Dmgdgsg1dA88h450yJlnm2QhHkMPO_2ayCdUHW4DYV8,19870
+mlrun/utils/notifications/notification_pusher.py,sha256=5pw2MK2rLm6dzswp5v3wqFl90brdSW2D2Ipx3d79iWk,19251
 mlrun/utils/notifications/notification/__init__.py,sha256=v2ULfsoGLlgBKS90ezou9wooBX7fo0NJgDsNdr51YEk,2113
 mlrun/utils/notifications/notification/base.py,sha256=t1sxExL2i2tJr3UuiQ9NTDONrpXcGBsrnxtAdemog2s,2293
 mlrun/utils/notifications/notification/console.py,sha256=3xNMf-PFANx6h6I6qpf-xRnI5S0001fHI4caYguNBgg,1971
 mlrun/utils/notifications/notification/git.py,sha256=5pJs3LFzuz2h3JO9vAGo3BL00-WZFdUcCaO2XaZh-1I,5221
 mlrun/utils/notifications/notification/ipython.py,sha256=qrBmtECiRG6sZpCIVMg7RZcWi5WqbgWl9Ktgg-oi2EY,1962
 mlrun/utils/notifications/notification/slack.py,sha256=5JysqIpUYUZKXPSeeZtbl7qb2L9dj7p2NvnEBcEsZkA,3898
 mlrun/utils/notifications/notification/webhook.py,sha256=iD4DhpJjfjaYj4o8NLQEY842-hNSnqj7SqKzSvnlmGE,1865
 mlrun/utils/version/__init__.py,sha256=7kkrB7hEZ3cLXoWj1kPoDwo4MaswsI2JVOBpbKgPAgc,614
-mlrun/utils/version/version.json,sha256=0geMQV6vBmcxX-h-1WjerHB6XCH3JpLbh9iS-je7zts,88
+mlrun/utils/version/version.json,sha256=Es3D4BIdpm72upkoVoWBapiYqv5XUe_6tPQpmUbBY9Q,88
 mlrun/utils/version/version.py,sha256=HMwseV8xjTQ__6T6yUWojx_z6yUj7Io7O4NcCCH_sz8,1970
-mlrun-1.5.0rc1.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-mlrun-1.5.0rc1.dist-info/METADATA,sha256=UMuONJKI3FHrTS_pTFmSTv_7lWVdypSP3ze3iyoO2us,17014
-mlrun-1.5.0rc1.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-mlrun-1.5.0rc1.dist-info/entry_points.txt,sha256=ZbXmb36B9JmK7EaleP8MIAbZSOQXQV0iwKR6si0HUWk,47
-mlrun-1.5.0rc1.dist-info/top_level.txt,sha256=NObLzw3maSF9wVrgSeYBv-fgnHkAJ1kEkh12DLdd5KM,6
-mlrun-1.5.0rc1.dist-info/RECORD,,
+mlrun-1.5.0rc2.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+mlrun-1.5.0rc2.dist-info/METADATA,sha256=5vsPSfVG3VTZpfHgYe9CMz11N0Pwj1M5NoktPI5WlLc,17062
+mlrun-1.5.0rc2.dist-info/WHEEL,sha256=AtBG6SXL3KF_v0NxLf0ehyVOh0cold-JbJYXNGorC6Q,92
+mlrun-1.5.0rc2.dist-info/entry_points.txt,sha256=ZbXmb36B9JmK7EaleP8MIAbZSOQXQV0iwKR6si0HUWk,47
+mlrun-1.5.0rc2.dist-info/top_level.txt,sha256=NObLzw3maSF9wVrgSeYBv-fgnHkAJ1kEkh12DLdd5KM,6
+mlrun-1.5.0rc2.dist-info/RECORD,,
```

